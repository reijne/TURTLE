_IF(ccpdft)
c---- memory counting routines -----------------------------------------
c
      subroutine memreq_xcfunc(idfun,
     &                         rks_sw,npts,mxp,
     &                         memory_fp)
      implicit none
c
c     Description
c
c     predict the memory requirements for xcfunc.
c
c     Evaluate the functional and its derivatives for all the grid
c     points in a batch.
c
c     If a exchange-correlation functional identifier is given the
c     subroutine for that functional is invoked. Otherwise the 
c     exchange functional and correlation functional are evaluated
c     separately.
c
c     Parameters:
c
INCLUDE(common/dft_dfder)
INCLUDE(common/dft_xcfunc)
c
c     Inputs:
c
      integer idfun       ! the number of derivatives required
      logical rks_sw      ! true if closed shell calculation
      integer npts        ! the number of grid points
      integer mxp         ! the maximum number of grid points
c
c     Workspace:
c
      REAL memory_fp(*)
c
c     Local Variables:
c
      integer ie
      integer iv,ivra,ivrb
      integer idv,idvgaa,idvgab,idvgbb
      integer idt
      integer ih,ihrara,ihrarb,ihrbrb
      integer idh,idhragaa,idhragab,idhragbb,idhrbgaa,idhrbgab,idhrbgbb,
     &        idhgaagaa,idhgaagab,idhgaagbb,idhgabgab,idhgabgbb,
     &        idhgbbgbb
      integer idf
      integer idg
c
c     Functions
c
      integer null_memory
      integer incr_memory
      external null_memory, incr_memory
c
c     Code:
c
      if (idfun.gt.2) call caserr("xcfunc: too high order derivative")
      if (idfun.lt.0) call caserr("xcfunc: too low  order derivative")
      ie  = null_memory()
      iv  = null_memory()
      idv = null_memory()
      idt = null_memory()
      ih  = null_memory()
      idh = null_memory()
      idf = null_memory()
      idg = null_memory()
c
      if (xc_fun.eq.XC_NONE) then
         if (rks_sw) then
c           call rks_zero
         else
c           call uks_zero
         endif
         if      (x_fun.eq.X_NONE) then
         else if (x_fun.eq.X_LDA) then
c        ...
         endif
         if (c_fun.ne.C_NONE) then
            ie = incr_memory(mxp,'d')
            if (rks_sw) then
               if (idfun.ge.1) then
                  iv = incr_memory(mxp,'d')
                  if (gradcorr_sw) then
                    idv = incr_memory(mxp,'d')
                  endif
                  if (kinetic_sw) then
                    idt = incr_memory(mxp,'d')
                  endif
               endif
               if (idfun.ge.2) then
                  ih = incr_memory(mxp,'d')
                  if (gradcorr_sw) then
                    idh = incr_memory(2*mxp,'d')
                  endif
                  if (kinetic_sw) then
                    idf = incr_memory(2*mxp,'d')
                  endif
                  if (gradcorr_sw.and.kinetic_sw) then
                    idg = incr_memory(mxp,'d')
                  endif
               endif
            else
               if (idfun.ge.1) then
                  iv = incr_memory(2*mxp,'d')
                  if (gradcorr_sw) then
                    idv = incr_memory(3*mxp,'d')
                  endif
                  if (kinetic_sw) then
                    idt = incr_memory(2*mxp,'d')
                  endif
               endif
               if (idfun.ge.2) then
                  ih = incr_memory(3*mxp,'d')
                  if (gradcorr_sw) then
                    idh = incr_memory(12*mxp,'d')
                  endif
                  if (kinetic_sw) then
                    idf = incr_memory(7*mxp,'d')
                  endif
                  if (gradcorr_sw.and.kinetic_sw) then
                    idg = incr_memory(6*mxp,'d')
                  endif
               endif
            endif
         endif
         if      (c_fun.eq.C_NONE) then
         else if (c_fun.eq.C_FT97) then
c        ...
         endif
         if (c_fun.ne.C_NONE) then
            if (rks_sw) then
               if (idfun.ge.2) then
                  if (gradcorr_sw.and.kinetic_sw) then
                    call decr_memory(idg,'d')
                  endif
                  if (kinetic_sw) then
                    call decr_memory(idf,'d')
                  endif
                  if (gradcorr_sw) then
                     call decr_memory(idh,'d')
                  endif
                  call decr_memory(ih,'d')
               endif
               if (idfun.ge.1) then
                  if (kinetic_sw) then
                    call decr_memory(idt,'d')
                  endif
                  if (gradcorr_sw) then
                    call decr_memory(idv,'d')
                  endif
                  call decr_memory(iv,'d')
               endif
            else
               if (idfun.ge.2) then
                  if (gradcorr_sw.and.kinetic_sw) then
                    call decr_memory(idg,'d')
                  endif
                  if (kinetic_sw) then
                    call decr_memory(idf,'d')
                  endif
                  if (gradcorr_sw) then
                    call decr_memory(idh,'d')
                  endif
                  call decr_memory(ih,'d')
               endif
               if (idfun.ge.1) then
                  if (kinetic_sw) then
                    call decr_memory(idt,'d')
                  endif
                  if (gradcorr_sw) then
                    call decr_memory(idv,'d')
                  endif
                  call decr_memory(iv,'d')
               endif
            endif
            call decr_memory(ie,'d')
         endif
      else if (xc_fun.eq.XC_B3LYP) then
c     ...
      endif
c
      end
c
c---- the routines that do the real work -------------------------------
c
      block data default_functional
INCLUDE(common/dft_xcfunc)
c
c     BLYP is the default functional
c
      data xc_fun,x_fun,c_fun/XC_NONE,X_B88,C_LYP/
      data gradcorr_sw,kinetic_sw/.true.,.false./
      data hf_exch_sw,hf_exch_wght/.false.,0.0d0/
      end



      logical function CD_gradcorr()
      implicit none
INCLUDE(common/dft_xcfunc)
c
c     Returns .true. if the current functional is a GGA and
c     .false. otherwise.
c
      CD_gradcorr = gradcorr_sw
      return
      end


      logical function CD_kinetic()
      implicit none
INCLUDE(common/dft_xcfunc)
c
c     Returns .true. if the current functional is a meta-GGA and
c     .false. otherwise.
c
      CD_kinetic = kinetic_sw
      return
      end


      logical function CD_has_HF_exchange()
      implicit none
INCLUDE(common/dft_xcfunc)
c
c     Returns .true. if the current functional requires
c     a non-zero fraction of Hartree-Fock (exact) exchange
c     and returns .false. otherwise. 
c
      CD_has_HF_exchange = hf_exch_sw
      return
      end


      REAL function CD_has_HF_exchange_weight()
      implicit none
INCLUDE(common/dft_xcfunc)
c
c     Returns the fraction of Hartree-Fock exchange
c     required by the current functional. 
c
      CD_has_HF_exchange_weight = hf_exch_wght
      return
      end

         

      integer function CD_set_functional(string)
      implicit none
      character string*(*)
INCLUDE(common/dft_xcfunc)
c
      CD_set_functional = 0
c
c     exchange functionals
c
c     write(*,*)"*** CD_set_functional: string=",string
      if      (string.eq.'null_x') then
         hf_exch_sw   = .false.
         xc_fun       = XC_NONE
         x_fun        = X_NONE
      else if (string.eq.'hf'.or.string.eq.'hf_x') then
         hf_exch_sw   = .true.
         hf_exch_wght = 1.0d0
         xc_fun       = XC_NONE
         x_fun        = X_NONE
      else if (string.eq.'lda_x'.or.string.eq.'s') then
         hf_exch_sw   = .false.
         xc_fun       = XC_NONE
         x_fun        = X_LDA
      else if (string.eq.'b88'.or.string.eq.'b88_x') then
         hf_exch_sw   = .false.
         xc_fun       = XC_NONE
         x_fun        = X_B88
      else if (string.eq.'b3_x'.or.string.eq.'b93_x') then
         hf_exch_sw   = .true.
         hf_exch_wght = 0.2d0
         xc_fun       = XC_NONE
         x_fun        = X_B3
      else if (string.eq.'b97_x') then
         hf_exch_sw   = .true.
         hf_exch_wght = 0.1943
         xc_fun       = XC_NONE
         x_fun        = X_B97
      else if (string.eq.'pbe_x') then
         hf_exch_sw   = .false.
         xc_fun       = XC_NONE
         x_fun        = X_PBE
      else if (string.eq.'pw91_x') then
         hf_exch_sw   = .false.
         xc_fun       = XC_NONE
         x_fun        = X_PW91
      else if (string.eq.'mpw_x') then
         hf_exch_sw   = .false.
         xc_fun       = XC_NONE
         x_fun        = X_MPW
      else if (string.eq.'edf1_x') then
         hf_exch_sw   = .false.
         xc_fun       = XC_NONE
         x_fun        = X_EDF1
      else if (string.eq.'ft97_x'.or.string.eq.'ft97b_x') then
         hf_exch_sw   = .false.
         xc_fun       = XC_NONE
         x_fun        = X_FT97B
      else if (string.eq.'ft97a_x') then
         hf_exch_sw   = .false.
         xc_fun       = XC_NONE
         x_fun        = X_FT97A
c
c     correlation functionals
c
      else if (string.eq.'null_c') then
         xc_fun       = XC_NONE
         c_fun        = C_NONE
      else if (string.eq.'b95_c') then
         xc_fun       = XC_NONE
         c_fun        = C_B95
      else if (string.eq.'edf1_c') then
         xc_fun       = XC_NONE
         c_fun        = C_EDF1
      else if (string.eq.'ft97_c') then
         xc_fun       = XC_NONE
         c_fun        = C_FT97
      else if (string.eq.'lyp') then
         xc_fun       = XC_NONE
         c_fun        = C_LYP
      else if (string.eq.'pbe_c') then
         xc_fun       = XC_NONE
         c_fun        = C_PBE
      else if (string.eq.'pz81') then
         xc_fun       = XC_NONE
         c_fun        = C_PZ81
      else if (string.eq.'p86') then
         xc_fun       = XC_NONE
         c_fun        = C_P86
      else if (string.eq.'pw91_c') then
         xc_fun       = XC_NONE
         c_fun        = C_PW91
      else if (string.eq.'pw92') then
         xc_fun       = XC_NONE
         c_fun        = C_PW92
      else if (string.eq.'vwn'.or.string.eq.'vwn5') then
         xc_fun       = XC_NONE
         c_fun        = C_VWN5
      else if (string.eq.'vwnrpa'.or.string.eq.'vwn5rpa') then
         xc_fun       = XC_NONE
         c_fun        = C_VWN5RPA
c
c     exchange-correlation functionals
c
      else if (string.eq.'null') then
         hf_exch_sw   = .false.
         xc_fun       = XC_NONE
         x_fun        = X_NONE
         c_fun        = C_NONE
      else if (string.eq.'svwn') then
         hf_exch_sw   = .false.
         hf_exch_wght = 0.0d0
         xc_fun       = XC_NONE
         x_fun        = X_LDA
         c_fun        = C_VWN5
      else if (string.eq.'bp86') then
         hf_exch_sw   = .false.
         hf_exch_wght = 0.0d0
         xc_fun       = XC_NONE
         x_fun        = X_B88
         c_fun        = C_P86
      else if (string.eq.'blyp') then
         hf_exch_sw   = .false.
         hf_exch_wght = 0.0d0
         xc_fun       = XC_NONE
         x_fun        = X_B88
         c_fun        = C_LYP
      else if (string.eq.'bhandh') then
         hf_exch_sw   = .true.
         hf_exch_wght = 0.5d0
         xc_fun       = XC_NONE
         x_fun        = X_HANDH
         c_fun        = C_LYP
      else if (string.eq.'b3lyp') then
         hf_exch_sw   = .true.
         hf_exch_wght = 0.2d0
         xc_fun       = XC_B3LYP
         x_fun        = X_NONE
         c_fun        = C_NONE
      else if (string.eq.'b3lyp_t') then
         hf_exch_sw   = .true.
         hf_exch_wght = 0.2d0
         xc_fun       = XC_B3LYP_VWN5
         x_fun        = X_NONE
         c_fun        = C_NONE
      else if (string.eq.'b3lyp_m') then
         hf_exch_sw   = .true.
         hf_exch_wght = 0.2d0
         xc_fun       = XC_B3LYP_VWN5RPA
         x_fun        = X_NONE
         c_fun        = C_NONE
      else if (string.eq.'b3pw91') then
         hf_exch_sw   = .true.
         hf_exch_wght = 0.2d0
         xc_fun       = XC_B3PW91
         x_fun        = X_NONE
         c_fun        = C_NONE
      else if (string.eq.'b97') then
         hf_exch_sw   = .true.
         hf_exch_wght = 0.1943d0
         xc_fun       = XC_B97
         x_fun        = X_NONE
         c_fun        = C_NONE
      else if (string.eq.'b97-1') then
         hf_exch_sw   = .true.
         hf_exch_wght = 0.21d0
         xc_fun       = XC_B97_1
         x_fun        = X_NONE
         c_fun        = C_NONE
      else if (string.eq.'b97-2') then
         hf_exch_sw   = .true.
         hf_exch_wght = 0.21d0
         xc_fun       = XC_B97_2
         x_fun        = X_NONE
         c_fun        = C_NONE
      else if (string.eq.'b97-3') then
         hf_exch_sw   = .true.
         hf_exch_wght = 0.2692880d0
         xc_fun       = XC_B97_3
         x_fun        = X_NONE
         c_fun        = C_NONE
      else if (string.eq.'b97-d') then
         hf_exch_sw   = .false.
         hf_exch_wght = 0.0d0
         xc_fun       = XC_B97_D
         x_fun        = X_NONE
         c_fun        = C_NONE
      else if (string.eq.'bb95') then
         hf_exch_sw   = .false.
         hf_exch_wght = 0.0d0
         xc_fun       = XC_BB95
         x_fun        = X_NONE
         c_fun        = C_NONE
      else if (string.eq.'b1b95') then
         hf_exch_sw   = .true.
         hf_exch_wght = 0.28d0
         xc_fun       = XC_B1B95
         x_fun        = X_NONE
         c_fun        = C_NONE
      else if (string.eq.'bb1k') then
         hf_exch_sw   = .true.
         hf_exch_wght = 0.42d0
         xc_fun       = XC_BB1K
         x_fun        = X_NONE
         c_fun        = C_NONE
      else if (string.eq.'edf1') then
         hf_exch_sw   = .false.
         hf_exch_wght = 0.0d0
         xc_fun       = XC_EDF1
         x_fun        = X_NONE
         c_fun        = C_NONE
      else if (string.eq.'ft97') then
         hf_exch_sw   = .false.
         hf_exch_wght = 0.0d0
         xc_fun       = XC_NONE
         x_fun        = X_FT97B
         c_fun        = C_FT97
      else if (string.eq.'ft97test') then
         hf_exch_sw   = .false.
         hf_exch_wght = 0.0d0
         xc_fun       = XC_FT97
         x_fun        = X_NONE
         c_fun        = C_NONE
      else if (string.eq.'hcth'.or.string.eq.'hcth93') then
         hf_exch_sw   = .false.
         hf_exch_wght = 0.0d0
         xc_fun       = XC_HCTH
         x_fun        = X_NONE
         c_fun        = C_NONE
      else if (string.eq.'hcth120') then
         hf_exch_sw   = .false.
         hf_exch_wght = 0.0d0
         xc_fun       = XC_HCTH120
         x_fun        = X_NONE
         c_fun        = C_NONE
      else if (string.eq.'hcth147') then
         hf_exch_sw   = .false.
         hf_exch_wght = 0.0d0
         xc_fun       = XC_HCTH147
         x_fun        = X_NONE
         c_fun        = C_NONE
      else if (string.eq.'hcth407') then
         hf_exch_sw   = .false.
         hf_exch_wght = 0.0d0
         xc_fun       = XC_HCTH407
         x_fun        = X_NONE
         c_fun        = C_NONE
      else if (string.eq.'kt1') then
         hf_exch_sw   = .false.
         hf_exch_wght = 0.0d0
         xc_fun       = XC_KT1
         x_fun        = X_NONE
         c_fun        = C_NONE
      else if (string.eq.'kt2') then
         hf_exch_sw   = .false.
         hf_exch_wght = 0.0d0
         xc_fun       = XC_KT2
         x_fun        = X_NONE
         c_fun        = C_NONE
      else if (string.eq.'mpw1k') then
         hf_exch_sw   = .true.
         hf_exch_wght = 0.428d0
         xc_fun       = XC_MPW1K
         x_fun        = X_NONE
         c_fun        = C_NONE
      else if (string.eq.'mpwb1k') then
         hf_exch_sw   = .true.
         hf_exch_wght = 0.44
         xc_fun       = XC_MPWB1K
         x_fun        = X_NONE
         c_fun        = C_NONE
      else if (string.eq.'pbe0') then
         hf_exch_sw   = .true.
         hf_exch_wght = 0.25d0
         xc_fun       = XC_NONE
         x_fun        = X_PBE0
         c_fun        = C_PBE
      else if (string.eq.'pbe') then
         hf_exch_sw   = .false.
         hf_exch_wght = 0.0d0
         xc_fun       = XC_PBE
         x_fun        = X_NONE
         c_fun        = C_NONE
      else if (string.eq.'revpbe') then
         hf_exch_sw   = .false.
         hf_exch_wght = 0.0d0
         xc_fun       = XC_REVPBE
         x_fun        = X_NONE
         c_fun        = C_NONE
      else if (string.eq.'rpbe') then
         hf_exch_sw   = .false.
         hf_exch_wght = 0.0d0
         xc_fun       = XC_RPBE
         x_fun        = X_NONE
         c_fun        = C_NONE
      else if (string.eq.'pw91') then
         hf_exch_sw   = .false.
         hf_exch_wght = 0.0d0
         xc_fun       = XC_PW91
         x_fun        = X_NONE
         c_fun        = C_NONE
c
c     default
c
      else
         CD_set_functional = 1
      endif
c        
      gradcorr_sw = (x_fun.eq.X_B88.or.
     &               x_fun.eq.X_B3.or.
     &               x_fun.eq.X_B97.or.
     &               x_fun.eq.X_PBE.or.
     &               x_fun.eq.X_PW91.or.
     &               x_fun.eq.X_MPW.or.
     &               x_fun.eq.X_EDF1.or.
     &               x_fun.eq.X_FT97B.or.
     &               c_fun.eq.C_EDF1.or.
     &               c_fun.eq.C_B95.or.
     &               c_fun.eq.C_FT97.or.
     &               c_fun.eq.C_LYP.or.
     &               c_fun.eq.C_PBE.or.
     &               c_fun.eq.C_PW91.or.
     &               c_fun.eq.C_P86.or.
     &               xc_fun.eq.XC_B3LYP.or.
     &               xc_fun.eq.XC_B3LYP_VWN5.or.
     &               xc_fun.eq.XC_B3LYP_VWN5RPA.or.
     &               xc_fun.eq.XC_B3PW91.or.
     &               xc_fun.eq.XC_B97.or.
     &               xc_fun.eq.XC_B97_1.or.
     &               xc_fun.eq.XC_B97_2.or.
     &               xc_fun.eq.XC_B97_3.or.
     &               xc_fun.eq.XC_B97_D.or.
     &               xc_fun.eq.XC_BB95.or.
     &               xc_fun.eq.XC_B1B95.or.
     &               xc_fun.eq.XC_BB1K.or.
     &               xc_fun.eq.XC_FT97.or.
     &               xc_fun.eq.XC_EDF1.or.
     &               xc_fun.eq.XC_HCTH.or.
     &               xc_fun.eq.XC_HCTH120.or.
     &               xc_fun.eq.XC_HCTH147.or.
     &               xc_fun.eq.XC_HCTH407.or.
     &               xc_fun.eq.XC_KT1.or.
     &               xc_fun.eq.XC_KT2.or.
     &               xc_fun.eq.XC_MPW1K.or.
     &               xc_fun.eq.XC_MPWB1K.or.
     &               xc_fun.eq.XC_PBE.or.
     &               xc_fun.eq.XC_REVPBE.or.
     &               xc_fun.eq.XC_RPBE.or.
     &               xc_fun.eq.XC_PW91.or.
     &               .false.)
      kinetic_sw = (c_fun.eq.C_B95.or.
     &              xc_fun.eq.XC_BB95.or.
     &              xc_fun.eq.XC_B1B95.or.
     &              xc_fun.eq.XC_BB1K.or.
     &              xc_fun.eq.XC_MPWB1K.or.
     &              .false.)
      return
      end


      subroutine xcfunc_print(iout)
      implicit none
c
c     Description
c
c     Print the selected functional and its literature reference.
c
c     Parameters:
c
INCLUDE(common/dft_xcfunc)
c
c     Inputs:
c
      integer iout        ! the output unit number
c
c     Outputs: None
c
c     Functions:
c
      logical CD_has_HF_exchange
      REAL    CD_has_HF_exchange_weight
c
c     Code:
c
      write(iout,*)
      write(iout,*)"Exchange/Correlation"
      write(iout,*)"--------------------"
      if (xc_fun.eq.XC_NONE) then
         if      (x_fun.eq.X_NONE) then
            write(iout,*)
     &      "null exchange functional selected"
         else if (x_fun.eq.X_LDA) then
            write(iout,*)
     &      "LDA exchange functional selected "
         else if (x_fun.eq.X_B88) then
            write(iout,*)
     &      "B88 exchange functional selected"
            write(iout,*)
     &      "(A.D. Becke, Phys.Rev. A38 (1988) 3098-3100)"
         else if (x_fun.eq.X_B3) then
            write(iout,*)
     &      "B3 exchange functional selected"
            write(iout,*)
     &      "(A.D. Becke,  J.Chem.Phys. 98 (1993) 5648-5652)"
         else if (x_fun.eq.X_B97) then
            write(iout,*)
     &      "B97 exchange functional selected"
            write(iout,*)
     &      "(A.D. Becke, J.Chem.Phys. 107 (1997) 8554-8560)"
         else if (x_fun.eq.X_PBE) then
            write(iout,*)
     &      "PBE exchange functional selected"
            write(iout,*)
     &      "(J.P. Perdew, K. Burke, M. Ernzerhof, Phys.Rev.Lett. 77"//
     &      " (1996) 3865-3868)"
         else if (x_fun.eq.X_PBE0) then
            write(iout,*)
     &      "PBE0 exchange functional selected"
            write(iout,*)
     &      "(J.P. Perdew, K. Burke, M. Ernzerhof, Phys.Rev.Lett. 77"//
     &      " (1996) 3865-3868) (At least, we guess....)"
         else if (x_fun.eq.X_PW91) then
            write(iout,*)
     &      "PW91 exchange functional selected"
            write(iout,*)
     &      "(J.P. Perdew, J.A. Chevary, S.H. Vosko, K.A. Jackson,"//
     &      " M.R. Pederson, C. Fiolhais,"
            write(iout,*)
     &      " Phys.Rev.B 46 (1992) 6671-6687)"
         else if (x_fun.eq.X_MPW) then
            write(iout,*)
     &      "mPW exchange functional selected"
            write(iout,*)
     &      "(C. Adamo, V. Barone, J.Chem.Phys. 108 (1998) 664-675)"
            write(iout,*)
     &      "(Y. Zhao, D.G. Truhlar, J.Phys.Chem.A 109 (2005)"//
     &      " 5656-5667)"
         else if (x_fun.eq.X_EDF1) then
            write(iout,*)
     &      "EDF1 exchange functional selected"
            write(iout,*)
     &      "(R.D. Adamson, P.M.W. Gill, J.A. Pople," //
     &      " Chem.Phys.Lett. 284 (1998) 6-11)"
         else if (x_fun.eq.X_FT97B) then
            write(iout,*)
     &      "FT97B exchange functional selected"
            write(iout,*)
     &      "(M. Filatov, W. Thiel, Mol.Phys. 91 (1997) 847-859)"
         else if (x_fun.eq.X_FT97A) then
            write(iout,*)
     &      "FT97A exchange functional selected"
            write(iout,*)
     &      "(M. Filatov, W. Thiel, Mol.Phys. 91 (1997) 847-859)"
         else if (x_fun.eq.X_HANDH) then
            write(iout,*)
     &      "BHandH exchange functional selected"
            write(iout,*)
     &      "(A.D. Becke, J. Phys. Chem. 98, (1993) 1372-1377)"
         else
            call caserr(
     &      "xcfunc_print: Illegal exchange functional id")
         endif
         if      (c_fun.eq.C_NONE) then
            write(iout,*)
     &      "null correlation functional selected"
         else if (c_fun.eq.C_B95) then
            write(iout,*)
     &      "B95 correlation functional selected"
            write(iout,*)
     &      "(A.D. Becke, J.Chem.Phys. 104 (1996)"//
     &      " 1040-1046)"
         else if (c_fun.eq.C_FT97) then
            write(iout,*)
     &      "FT97 correlation functional selected"
            write(iout,*)
     &      "(M. Filatov, W. Thiel, Int.J.Quant.Chem. " //
     &      " 62 (1997) 603-616)"
         else if (c_fun.eq.C_EDF1) then
            write(iout,*)
     &      "EDF1 correlation functional selected"
            write(iout,*)
     &      "(R.D. Adamson, P.M.W. Gill, J.A. Pople," //
     &      " Chem.Phys.Lett. 284 (1998) 6-11)"
         else if (c_fun.eq.C_LYP) then
            write(iout,*)
     &      "LYP correlation functional selected"
            write(iout,'(a81)')
     &      "(B. Miehlich, A. Savin, H. Stoll, H. Preuss," //
     &      " Chem.Phys.Lett. 157 (1989) 200-206)"
            write(iout,*)
     &      "(C. Lee, W. Yang, R.G. Parr, " //
     &      " Phys.Rev. B37 (1988) 785-789)"
         else if (c_fun.eq.C_PBE) then
            write(iout,*)
     &      "PBE correlation functional selected"
            write(iout,*)
     &      "(J.P. Perdew, K. Burke, M. Ernzerhof, Phys.Rev.Lett. 77"//
     &      " (1996) 3865-3868)"
         else if (c_fun.eq.C_PZ81) then
            write(iout,*)
     &      "PZ81 correlation functional selected"
            write(iout,*)
     &      "(J.P. Perdew, A. Zunger, Phys.Rev. B23 (1981) 5048-5079)"
         else if (c_fun.eq.C_P86) then
            write(iout,*)
     &      "P86 correlation functional selected"
            write(iout,*)
     &      "(J.P. Perdew, Phys.Rev. B33 (1986) 8822-8824)"
         else if (c_fun.eq.C_PW91) then
            write(iout,*)
     &      "PW91 correlation functional selected"
            write(iout,*)
     &      "(J.P. Perdew, J.A. Chevary, S.H. Vosko, K.A. Jackson,"//
     &      " M.R. Pederson, C. Fiolhais,"
            write(iout,*)
     &      " Phys.Rev.B 46 (1992) 6671-6687)"
         else if (c_fun.eq.C_PW92) then
            write(iout,*)
     &      "PW92 correlation functional selected"
            write(iout,*)
     &      "(J.P. Perdew, Y. Wang, Phys.Rev. B45 (1992) 13244-13249)"
         else if (c_fun.eq.C_VWN5) then
            write(iout,*)
     &      "VWN5 correlation functional selected"
            write(iout,*)
     &      "(S.H. Vosko, L. Wilk, M. Nusair," //
     &      " Can.J.Phys. 58 (1980) 1200-1211)"
         else if (c_fun.eq.C_VWN5RPA) then
            write(iout,*)
     &      "VWN5RPA correlation functional selected"
            write(iout,*)
     &      "(S.H. Vosko, L. Wilk, M. Nusair," //
     &      " Can.J.Phys. 58 (1980) 1200-1211)"
         else
            call caserr(
     &      "xcfunc_print: Illegal correlation functional id")
         endif
      else if (xc_fun.eq.XC_B3LYP) then
         write(iout,*)
     &   "B3LYP exchange-correlation functional selected"
         write(iout,*)
     &   "(P.J. Stephens, F.J. Devlin, C.F. Chabalowski, M.J. Frisch,"//
     &   " J.Phys.Chem. 98 (1994) 11623-11627)"
      else if (xc_fun.eq.XC_B3LYP_VWN5) then
         write(iout,*)
     &   "B3LYP variant VWN5 exchange-correlation functional selected"//
     &   " (as in TURBOMOLE 5.6 and MOLPRO 2002.8)"
         write(iout,*)
     &   "(P.J. Stephens, F.J. Devlin, C.F. Chabalowski, M.J. Frisch,"//
     &   " J.Phys.Chem. 98 (1994) 11623-11627)"
      else if (xc_fun.eq.XC_B3LYP_VWN5RPA) then
         write(iout,*)
     &   "B3LYP variant VWN5RPA exchange-correlation functional "//
     &   "selected"
         write(iout,*)
     &   "(P.J. Stephens, F.J. Devlin, C.F. Chabalowski, M.J. Frisch,"//
     &   " J.Phys.Chem. 98 (1994) 11623-11627)"
      else if (xc_fun.eq.XC_B3PW91) then
         write(iout,*)
     &   "B3PW91 exchange-correlation functional selected"
         write(iout,*)
     &   "(A.D. Becke, J.Chem.Phys. 98 (1993) 5648-5652)"
      else if (xc_fun.eq.XC_B97) then
         write(iout,*)
     &   "B97 exchange-correlation functional selected"
         write(iout,*)
     &   "(A.D. Becke, J.Chem.Phys. 107 (1997) 8554-8560)"
      else if (xc_fun.eq.XC_B97_1) then
         write(iout,*)
     &   "B97-1 exchange-correlation functional selected"
         write(iout,*)
     &   "(F.A. Hamprecht, A.J. Cohen, D.J. Tozer, N.C. Handy," //
     &   " J.Chem.Phys. 109 (1998) 6264-6271)"
         write(iout,*)
     &   "(A.D. Becke, J.Chem.Phys. 107 (1997) 8554-8560)"
      else if (xc_fun.eq.XC_B97_2) then
         write(iout,*)
     &   "B97-2 exchange-correlation functional selected"
         write(iout,*)
     &   "(P.J. Wilson, T.J. Bradley, D.J. Tozer," //
     &   " J.Chem.Phys. 115 (2001) 9233-9242)"
         write(iout,*)
     &   "(A.D. Becke, J.Chem.Phys. 107 (1997) 8554-8560)"
      else if (xc_fun.eq.XC_B97_3) then
         write(iout,*)
     &   "B97-3 exchange-correlation functional selected"
         write(iout,*)
     &   "(T.W. Keal, D.J. Tozer," //
     &   " J.Chem.Phys. 123 (2005) 121103/1-4)"
         write(iout,*)
     &   "(A.D. Becke, J.Chem.Phys. 107 (1997) 8554-8560)"
      else if (xc_fun.eq.XC_B97_D) then
         write(iout,*)
     &   "B97-D exchange-correlation functional selected"
         write(iout,*)
     &   "(S. Grimme, J.Comp.Chem. 27 (2006) 1787-1799," //
     &   " doi:10.1002/jcc.20495)"
         write(iout,*)
     &   "(A.D. Becke, J.Chem.Phys. 107 (1997) 8554-8560)"
      else if (xc_fun.eq.XC_BB95) then
         write(iout,*)
     &   "BB95 (Bx88/Bc95) exchange-correlation functional selected"
         write(iout,*)
     &   "(A.D. Becke, J.Chem.Phys. 104 (1996) 1040-1046)"
      else if (xc_fun.eq.XC_B1B95) then
         write(iout,*)
     &   "B1B95 (HF/Bx88/Bc95) exchange-correlation functional selected"
         write(iout,*)
     &   "(A.D. Becke, J.Chem.Phys. 104 (1996) 1040-1046)"
      else if (xc_fun.eq.XC_BB1K) then
         write(iout,*)
     &   "BB1K (HF/Bx88/Bc95) exchange-correlation functional selected"
         write(iout,*)
     &   "(Y. Zhao, B.J. Lynch, D.G. Truhlar," //
     &   " J.Phys.Chem. A108 (2004) 2715-2719)"
      else if (xc_fun.eq.XC_FT97) then
         write(iout,*)
     &   "FT97 exchange-correlation functional selected"
         write(iout,*)
     &   "(M. Filatov, W. Thiel, Mol.Phys. 91 (1997) 847-859)"
         write(iout,*)
     &   "(M. Filatov, W. Thiel, Int.J.Quant.Chem. " //
     &   " 62 (1997) 603-616)"
      else if (xc_fun.eq.XC_EDF1) then
         write(iout,*)
     &   "EDF1 exchange-correlation functional selected"
         write(iout,*)
     &   "(R.D. Adamson, P.M.W. Gill, J.A. Pople," //
     &   " Chem.Phys.Lett. 284 (1998) 6-11)"
      else if (xc_fun.eq.XC_HCTH) then
         write(iout,*)
     &   "HCTH exchange-correlation functional selected"
         write(iout,*)
     &   "(F.A. Hamprecht, A.J. Cohen, D.J. Tozer, N.C. Handy," //
     &   " J.Chem.Phys. 109 (1998) 6264-6271)"
      else if (xc_fun.eq.XC_HCTH120) then
         write(iout,*)
     &   "HCTH120 exchange-correlation functional selected"
         write(iout,*)
     &   "(A.D. Boese, N.L. Doltsinis, N.C. Handy, M. Sprik," //
     &   " J.Chem.Phys. 112 (2000) 1670-1678)"
      else if (xc_fun.eq.XC_HCTH147) then
         write(iout,*)
     &   "HCTH147 exchange-correlation functional selected"
         write(iout,*)
     &   "(A.D. Boese, N.L. Doltsinis, N.C. Handy, M. Sprik," //
     &   " J.Chem.Phys. 112 (2000) 1670-1678)"
      else if (xc_fun.eq.XC_HCTH407) then
         write(iout,*)
     &   "HCTH407 exchange-correlation functional selected"
         write(iout,*)
     &   "(A.D. Boese, N.C. Handy," //
     &   " J.Chem.Phys. 114 (2001) 5497-5503)"
      else if (xc_fun.eq.XC_KT1) then
         write(iout,*)
     &   "KT1 exchange-correlation functional selected"
         write(iout,*)
     &   "(T.W. Keal, D.J. Tozer," //
     &   " J.Chem.Phys. 119 (2003) 3015-3024)"
      else if (xc_fun.eq.XC_KT2) then
         write(iout,*)
     &   "KT2 exchange-correlation functional selected"
         write(iout,*)
     &   "(T.W. Keal, D.J. Tozer," //
     &   " J.Chem.Phys. 119 (2003) 3015-3024)"
      else if (xc_fun.eq.XC_MPW1K) then
         write(iout,*)
     &   "MPW1K exchange-correlation functional selected"
         write(iout,*)
     &   "(B.J. Lynch, P.L. Fast, M. Harris, D.G. Truhlar," //
     &   " J.Phys.Chem.A 104 (2000) 4811-4815)"
      else if (xc_fun.eq.XC_MPWB1K) then
         write(iout,*)
     &   "MPWB1K exchange-correlation functional selected"
         write(iout,*)
     &   "(Y. Zhao, D.G. Truhlar, J.Phys.Chem.A 108 (2004) 6908-6918)"
      else if (xc_fun.eq.XC_PBE) then
         write(iout,*)
     &   "PBE exchange-correlation functional selected"
         write(iout,*)
     &   "(J.P. Perdew, K. Burke, M. Ernzerhof, Phys.Rev.Lett. 77"//
     &   " (1996) 3865-3868)"
      else if (xc_fun.eq.XC_REVPBE) then
         write(iout,*)
     &   "REVPBE exchange-correlation functional selected"
         write(iout,*)
     &   "(Y. Zhang, W. Yang, Phys.Rev.Lett. 80"//
     &   " (1998) 890-890)"
      else if (xc_fun.eq.XC_RPBE) then
         write(iout,*)
     &   "RPBE exchange-correlation functional selected"
         write(iout,*)
     &   "(B. Hammer, L.B. Hansen, J.K. Noerskov, Phys.Rev.B. 59"//
     &   " (1999) 7413-7421)"
      else if (xc_fun.eq.XC_PW91) then
         write(iout,*)
     &   "PW91 exchange-correlation functional selected"
         write(iout,*)
     &   "(J.P. Perdew, J.A. Chevary, S.H. Vosko, K.A. Jackson,"//
     &   " M.R. Pederson, C. Fiolhais,"
         write(iout,*)
     &   " Phys.Rev.B 46 (1992) 6671-6687)"
      else
         call caserr(
     &      "xcfunc_print: Illegal exchange-correlation functional id")
      endif
      if (CD_has_HF_exchange()) then
         write(iout,'(1x,"Using ",f7.2,"% Hartree-Fock exchange")')
     &   100.0d0*CD_has_HF_exchange_weight()
      endif
c
      end
c
c-----------------------------------------------------------------------
c
c     XCFUNC stuff
c
c-----------------------------------------------------------------------
c
      subroutine xcfunc(idfun,rks_sw,
     &                  npts,mxp,mxpmx,rho,gamma,tau,
     &                  xc_ept,xc_vpt,xc_dvpt,xc_dtpt,xc_hpt,xc_dhpt,
     &                  memory_fp)
      implicit none
c
c     Description
c
c     Evaluate the functional and its derivatives for all the grid
c     points in a batch.
c
c     If a exchange-correlation functional identifier is given the
c     subroutine for that functional is invoked. Otherwise the 
c     exchange functional and correlation functional are evaluated
c     separately.
c
c     Parameters:
c
INCLUDE(common/dft_dfder)
INCLUDE(common/dft_xcfunc)
c
c     Inputs:
c
      integer idfun       ! the number of derivatives required
      logical rks_sw      ! true if closed shell calculation
      integer npts        ! the number of grid points
      integer mxp         ! the maximum number of grid points in 
                          ! this batch
      integer mxpmx       ! the maximum number of grid points throughout
      REAL    rho(mxp,2)   ! the electron density
      REAL    gamma(mxp,3) ! the dot-products of the gradient of rho
      REAL    tau(mxp,2)   ! the kinetic energy density
c
c     Outputs:
c
      REAL xc_ept(mxp)     ! the exchange-correlation energy
      REAL xc_vpt(mxp,2)   ! the derivative with respect to rho-s
      REAL xc_dvpt(mxp,3)  ! the derivative with respect to gamma-s
      REAL xc_dtpt(mxp,2)  ! the derivative with respect to tau-s
      REAL xc_hpt(mxp,3)   ! the 2nd derivative with respect to rho-s
      REAL xc_dhpt(mxp,12) ! the 2nd derivative with respect to 
                           ! rho-s and gamma-s
c     REAL xc_dfpt(mxp,7)  ! the 2nd derivative with respect to 
c                          ! rho-s and tau-s
c     REAL xc_dgpt(mxp,6)  ! the 2nd derivative with respect to 
c                          ! gamma-s and tau-s
      REAL xc_dfpt(1,7)    ! dummy array
      REAL xc_dgpt(1,6)    ! dummy array
c
c     Workspace:
c
      REAL memory_fp(*)
c
c     Local Variables:
c
      integer ie
      integer iv,ivra,ivrb
      integer idv,idvgaa,idvgab,idvgbb
      integer idt,idta,idtb
      integer ih,ihrara,ihrarb,ihrbrb
      integer idh,idhragaa,idhragab,idhragbb,idhrbgaa,idhrbgab,idhrbgbb,
     &        idhgaagaa,idhgaagab,idhgaagbb,idhgabgab,idhgabgbb,
     &        idhgbbgbb
      integer idf,idfrata,idfratb,idfrbta,idfrbtb,
     &        idftata,idftatb,idftbtb
      integer idg,idggaata,idggaatb,idggabta,idggabtb,idggbbta,idggbbtb
c
c     Functions
c
      integer null_memory
      integer allocate_memory
      external null_memory, allocate_memory
c
c     Code:
c
      if (idfun.gt.2) call caserr("xcfunc: too high order derivative")
      if (idfun.lt.0) call caserr("xcfunc: too low  order derivative")
      ie  = null_memory()
      iv  = null_memory()
      idv = null_memory()
      idt = null_memory()
      ih  = null_memory()
      idh = null_memory()
      idf = null_memory()
      idg = null_memory()
c
      if (xc_fun.eq.XC_NONE) then
         if (rks_sw) then
            call rks_zero(idfun,npts,rho(1,ira),gamma(1,igaa),
     &           tau(1,ita),
     &           xc_ept,xc_vpt(1,ira),xc_dvpt(1,igaa),xc_dtpt(1,ita),
     &           xc_hpt(1,irara),xc_dhpt(1,iragaa),
     &           xc_dhpt(1,igaagaa))
         else
            call uks_zero(idfun,npts,rho(1,ira),rho(1,irb),
     &           gamma(1,igaa),gamma(1,igbb),gamma(1,igab),
     &           tau(1,ita),tau(1,itb),
     &           xc_ept,xc_vpt(1,ira),xc_vpt(1,irb),
     &           xc_dvpt(1,igaa),xc_dvpt(1,igbb),xc_dvpt(1,igab),
     &           xc_dtpt(1,ita),xc_dtpt(1,itb),
     &           xc_hpt(1,irara),xc_hpt(1,irbrb),xc_hpt(1,irarb),
     &           xc_dhpt(1,iragaa),xc_dhpt(1,iragab),
     &           xc_dhpt(1,iragbb),xc_dhpt(1,irbgbb),
     &           xc_dhpt(1,irbgab),xc_dhpt(1,irbgaa),
     &           xc_dhpt(1,igaagaa),xc_dhpt(1,igaagab),
     &           xc_dhpt(1,igaagbb),xc_dhpt(1,igabgab),
     &           xc_dhpt(1,igabgbb),xc_dhpt(1,igbbgbb))
         endif
         if      (x_fun.eq.X_NONE) then
         else if (x_fun.eq.X_LDA) then
            if (rks_sw) then
               call rks_x_lda(idfun,npts,rho(1,ira),gamma(1,igaa),
     &              xc_ept,xc_vpt(1,ira),xc_dvpt(1,igaa),
     &              xc_hpt(1,irara),xc_dhpt(1,iragaa),
     &              xc_dhpt(1,igaagaa))
            else
               call uks_x_lda(idfun,npts,rho(1,ira),rho(1,irb),
     &              gamma(1,igaa),gamma(1,igbb),gamma(1,igab),
     &              xc_ept,xc_vpt(1,ira),xc_vpt(1,irb),
     &              xc_dvpt(1,igaa),xc_dvpt(1,igbb),xc_dvpt(1,igab),
     &              xc_hpt(1,irara),xc_hpt(1,irbrb),xc_hpt(1,irarb),
     &              xc_dhpt(1,iragaa),xc_dhpt(1,iragab),
     &              xc_dhpt(1,iragbb),xc_dhpt(1,irbgbb),
     &              xc_dhpt(1,irbgab),xc_dhpt(1,irbgaa),
     &              xc_dhpt(1,igaagaa),xc_dhpt(1,igaagab),
     &              xc_dhpt(1,igaagbb),xc_dhpt(1,igabgab),
     &              xc_dhpt(1,igabgbb),xc_dhpt(1,igbbgbb))
            endif
         else if (x_fun.eq.X_B88) then
            if (rks_sw) then
               call rks_x_b88(idfun,npts,rho(1,ira),gamma(1,igaa),
     &              xc_ept,xc_vpt(1,ira),xc_dvpt(1,igaa),
     &              xc_hpt(1,irara),xc_dhpt(1,iragaa),
     &              xc_dhpt(1,igaagaa))
            else
               call uks_x_b88(idfun,npts,rho(1,ira),rho(1,irb),
     &              gamma(1,igaa),gamma(1,igbb),gamma(1,igab),
     &              xc_ept,xc_vpt(1,ira),xc_vpt(1,irb),
     &              xc_dvpt(1,igaa),xc_dvpt(1,igbb),xc_dvpt(1,igab),
     &              xc_hpt(1,irara),xc_hpt(1,irbrb),xc_hpt(1,irarb),
     &              xc_dhpt(1,iragaa),xc_dhpt(1,iragab),
     &              xc_dhpt(1,iragbb),xc_dhpt(1,irbgbb),
     &              xc_dhpt(1,irbgab),xc_dhpt(1,irbgaa),
     &              xc_dhpt(1,igaagaa),xc_dhpt(1,igaagab),
     &              xc_dhpt(1,igaagbb),xc_dhpt(1,igabgab),
     &              xc_dhpt(1,igabgbb),xc_dhpt(1,igbbgbb))
            endif
         else if (x_fun.eq.X_B3) then
            if (rks_sw) then
               call rks_x_b3(idfun,npts,rho(1,ira),gamma(1,igaa),
     &              xc_ept,xc_vpt(1,ira),xc_dvpt(1,igaa),
     &              xc_hpt(1,irara),xc_dhpt(1,iragaa),
     &              xc_dhpt(1,igaagaa))
            else
               call uks_x_b3(idfun,npts,rho(1,ira),rho(1,irb),
     &              gamma(1,igaa),gamma(1,igbb),gamma(1,igab),
     &              xc_ept,xc_vpt(1,ira),xc_vpt(1,irb),
     &              xc_dvpt(1,igaa),xc_dvpt(1,igbb),xc_dvpt(1,igab),
     &              xc_hpt(1,irara),xc_hpt(1,irbrb),xc_hpt(1,irarb),
     &              xc_dhpt(1,iragaa),xc_dhpt(1,iragab),
     &              xc_dhpt(1,iragbb),xc_dhpt(1,irbgbb),
     &              xc_dhpt(1,irbgab),xc_dhpt(1,irbgaa),
     &              xc_dhpt(1,igaagaa),xc_dhpt(1,igaagab),
     &              xc_dhpt(1,igaagbb),xc_dhpt(1,igabgab),
     &              xc_dhpt(1,igabgbb),xc_dhpt(1,igbbgbb))
            endif
         else if (x_fun.eq.X_B97) then
            if (rks_sw) then
               call rks_x_b97(idfun,npts,rho(1,ira),gamma(1,igaa),
     &              xc_ept,xc_vpt(1,ira),xc_dvpt(1,igaa),
     &              xc_hpt(1,irara),xc_dhpt(1,iragaa),
     &              xc_dhpt(1,igaagaa))
            else
               call uks_x_b97(idfun,npts,rho(1,ira),rho(1,irb),
     &              gamma(1,igaa),gamma(1,igbb),gamma(1,igab),
     &              xc_ept,xc_vpt(1,ira),xc_vpt(1,irb),
     &              xc_dvpt(1,igaa),xc_dvpt(1,igbb),xc_dvpt(1,igab),
     &              xc_hpt(1,irara),xc_hpt(1,irbrb),xc_hpt(1,irarb),
     &              xc_dhpt(1,iragaa),xc_dhpt(1,iragab),
     &              xc_dhpt(1,iragbb),xc_dhpt(1,irbgbb),
     &              xc_dhpt(1,irbgab),xc_dhpt(1,irbgaa),
     &              xc_dhpt(1,igaagaa),xc_dhpt(1,igaagab),
     &              xc_dhpt(1,igaagbb),xc_dhpt(1,igabgab),
     &              xc_dhpt(1,igabgbb),xc_dhpt(1,igbbgbb))
            endif
         else if (x_fun.eq.X_PBE) then
            if (rks_sw) then
               call rks_x_pbe(idfun,npts,rho(1,ira),gamma(1,igaa),
     &              xc_ept,xc_vpt(1,ira),xc_dvpt(1,igaa),
     &              xc_hpt(1,irara),xc_dhpt(1,iragaa),
     &              xc_dhpt(1,igaagaa))
            else
               call uks_x_pbe(idfun,npts,rho(1,ira),rho(1,irb),
     &              gamma(1,igaa),gamma(1,igbb),gamma(1,igab),
     &              xc_ept,xc_vpt(1,ira),xc_vpt(1,irb),
     &              xc_dvpt(1,igaa),xc_dvpt(1,igbb),xc_dvpt(1,igab),
     &              xc_hpt(1,irara),xc_hpt(1,irbrb),xc_hpt(1,irarb),
     &              xc_dhpt(1,iragaa),xc_dhpt(1,iragab),
     &              xc_dhpt(1,iragbb),xc_dhpt(1,irbgbb),
     &              xc_dhpt(1,irbgab),xc_dhpt(1,irbgaa),
     &              xc_dhpt(1,igaagaa),xc_dhpt(1,igaagab),
     &              xc_dhpt(1,igaagbb),xc_dhpt(1,igabgab),
     &              xc_dhpt(1,igabgbb),xc_dhpt(1,igbbgbb))
            endif
         else if (x_fun.eq.X_PBE0) then
            if (rks_sw) then
               call rks_x_pbe0(idfun,npts,rho(1,ira),gamma(1,igaa),
     &              xc_ept,xc_vpt(1,ira),xc_dvpt(1,igaa),
     &              xc_hpt(1,irara),xc_dhpt(1,iragaa),
     &              xc_dhpt(1,igaagaa))
            else
               call uks_x_pbe0(idfun,npts,rho(1,ira),rho(1,irb),
     &              gamma(1,igaa),gamma(1,igbb),gamma(1,igab),
     &              xc_ept,xc_vpt(1,ira),xc_vpt(1,irb),
     &              xc_dvpt(1,igaa),xc_dvpt(1,igbb),xc_dvpt(1,igab),
     &              xc_hpt(1,irara),xc_hpt(1,irbrb),xc_hpt(1,irarb),
     &              xc_dhpt(1,iragaa),xc_dhpt(1,iragab),
     &              xc_dhpt(1,iragbb),xc_dhpt(1,irbgbb),
     &              xc_dhpt(1,irbgab),xc_dhpt(1,irbgaa),
     &              xc_dhpt(1,igaagaa),xc_dhpt(1,igaagab),
     &              xc_dhpt(1,igaagbb),xc_dhpt(1,igabgab),
     &              xc_dhpt(1,igabgbb),xc_dhpt(1,igbbgbb))
            endif
         else if (x_fun.eq.X_PW91) then
            if (rks_sw) then
               call rks_x_pw91(idfun,npts,rho(1,ira),gamma(1,igaa),
     &              xc_ept,xc_vpt(1,ira),xc_dvpt(1,igaa),
     &              xc_hpt(1,irara),xc_dhpt(1,iragaa),
     &              xc_dhpt(1,igaagaa))
            else
               call uks_x_pw91(idfun,npts,rho(1,ira),rho(1,irb),
     &              gamma(1,igaa),gamma(1,igbb),gamma(1,igab),
     &              xc_ept,xc_vpt(1,ira),xc_vpt(1,irb),
     &              xc_dvpt(1,igaa),xc_dvpt(1,igbb),xc_dvpt(1,igab),
     &              xc_hpt(1,irara),xc_hpt(1,irbrb),xc_hpt(1,irarb),
     &              xc_dhpt(1,iragaa),xc_dhpt(1,iragab),
     &              xc_dhpt(1,iragbb),xc_dhpt(1,irbgbb),
     &              xc_dhpt(1,irbgab),xc_dhpt(1,irbgaa),
     &              xc_dhpt(1,igaagaa),xc_dhpt(1,igaagab),
     &              xc_dhpt(1,igaagbb),xc_dhpt(1,igabgab),
     &              xc_dhpt(1,igabgbb),xc_dhpt(1,igbbgbb))
            endif
         else if (x_fun.eq.X_MPW) then
            if (rks_sw) then
               call rks_x_mpw(idfun,npts,rho(1,ira),gamma(1,igaa),
     &              xc_ept,xc_vpt(1,ira),xc_dvpt(1,igaa),
     &              xc_hpt(1,irara),xc_dhpt(1,iragaa),
     &              xc_dhpt(1,igaagaa))
            else
               call uks_x_mpw(idfun,npts,rho(1,ira),rho(1,irb),
     &              gamma(1,igaa),gamma(1,igbb),gamma(1,igab),
     &              xc_ept,xc_vpt(1,ira),xc_vpt(1,irb),
     &              xc_dvpt(1,igaa),xc_dvpt(1,igbb),xc_dvpt(1,igab),
     &              xc_hpt(1,irara),xc_hpt(1,irbrb),xc_hpt(1,irarb),
     &              xc_dhpt(1,iragaa),xc_dhpt(1,iragab),
     &              xc_dhpt(1,iragbb),xc_dhpt(1,irbgbb),
     &              xc_dhpt(1,irbgab),xc_dhpt(1,irbgaa),
     &              xc_dhpt(1,igaagaa),xc_dhpt(1,igaagab),
     &              xc_dhpt(1,igaagbb),xc_dhpt(1,igabgab),
     &              xc_dhpt(1,igabgbb),xc_dhpt(1,igbbgbb))
            endif
         else if (x_fun.eq.X_EDF1) then
            if (rks_sw) then
               call rks_x_edf1(idfun,npts,rho(1,ira),gamma(1,igaa),
     &              xc_ept,xc_vpt(1,ira),xc_dvpt(1,igaa),
     &              xc_hpt(1,irara),xc_dhpt(1,iragaa),
     &              xc_dhpt(1,igaagaa))
            else
               call uks_x_edf1(idfun,npts,rho(1,ira),rho(1,irb),
     &              gamma(1,igaa),gamma(1,igbb),gamma(1,igab),
     &              xc_ept,xc_vpt(1,ira),xc_vpt(1,irb),
     &              xc_dvpt(1,igaa),xc_dvpt(1,igbb),xc_dvpt(1,igab),
     &              xc_hpt(1,irara),xc_hpt(1,irbrb),xc_hpt(1,irarb),
     &              xc_dhpt(1,iragaa),xc_dhpt(1,iragab),
     &              xc_dhpt(1,iragbb),xc_dhpt(1,irbgbb),
     &              xc_dhpt(1,irbgab),xc_dhpt(1,irbgaa),
     &              xc_dhpt(1,igaagaa),xc_dhpt(1,igaagab),
     &              xc_dhpt(1,igaagbb),xc_dhpt(1,igabgab),
     &              xc_dhpt(1,igabgbb),xc_dhpt(1,igbbgbb))
            endif
         else if (x_fun.eq.X_FT97B) then
            if (rks_sw) then
               call rks_x_ft97b(idfun,npts,rho(1,ira),gamma(1,igaa),
     &              xc_ept,xc_vpt(1,ira),xc_dvpt(1,igaa),
     &              xc_hpt(1,irara),xc_dhpt(1,iragaa),
     &              xc_dhpt(1,igaagaa))
            else
               call uks_x_ft97b(idfun,npts,rho(1,ira),rho(1,irb),
     &              gamma(1,igaa),gamma(1,igbb),gamma(1,igab),
     &              xc_ept,xc_vpt(1,ira),xc_vpt(1,irb),
     &              xc_dvpt(1,igaa),xc_dvpt(1,igbb),xc_dvpt(1,igab),
     &              xc_hpt(1,irara),xc_hpt(1,irbrb),xc_hpt(1,irarb),
     &              xc_dhpt(1,iragaa),xc_dhpt(1,iragab),
     &              xc_dhpt(1,iragbb),xc_dhpt(1,irbgbb),
     &              xc_dhpt(1,irbgab),xc_dhpt(1,irbgaa),
     &              xc_dhpt(1,igaagaa),xc_dhpt(1,igaagab),
     &              xc_dhpt(1,igaagbb),xc_dhpt(1,igabgab),
     &              xc_dhpt(1,igabgbb),xc_dhpt(1,igbbgbb))
            endif
         else if (x_fun.eq.X_FT97A) then
            if (rks_sw) then
               call rks_x_ft97a(idfun,npts,rho(1,ira),gamma(1,igaa),
     &              xc_ept,xc_vpt(1,ira),xc_dvpt(1,igaa),
     &              xc_hpt(1,irara),xc_dhpt(1,iragaa),
     &              xc_dhpt(1,igaagaa))
            else
               call uks_x_ft97a(idfun,npts,rho(1,ira),rho(1,irb),
     &              gamma(1,igaa),gamma(1,igbb),gamma(1,igab),
     &              xc_ept,xc_vpt(1,ira),xc_vpt(1,irb),
     &              xc_dvpt(1,igaa),xc_dvpt(1,igbb),xc_dvpt(1,igab),
     &              xc_hpt(1,irara),xc_hpt(1,irbrb),xc_hpt(1,irarb),
     &              xc_dhpt(1,iragaa),xc_dhpt(1,iragab),
     &              xc_dhpt(1,iragbb),xc_dhpt(1,irbgbb),
     &              xc_dhpt(1,irbgab),xc_dhpt(1,irbgaa),
     &              xc_dhpt(1,igaagaa),xc_dhpt(1,igaagab),
     &              xc_dhpt(1,igaagbb),xc_dhpt(1,igabgab),
     &              xc_dhpt(1,igabgbb),xc_dhpt(1,igbbgbb))
            endif
         else if (x_fun.eq.X_HANDH) then
            if (rks_sw) then
               call rks_x_handh(idfun,npts,rho(1,ira),gamma(1,igaa),
     &              xc_ept,xc_vpt(1,ira),xc_dvpt(1,igaa),
     &              xc_hpt(1,irara),xc_dhpt(1,iragaa),
     &              xc_dhpt(1,igaagaa))
            else
               call uks_x_handh(idfun,npts,rho(1,ira),rho(1,irb),
     &              gamma(1,igaa),gamma(1,igbb),gamma(1,igab),
     &              xc_ept,xc_vpt(1,ira),xc_vpt(1,irb),
     &              xc_dvpt(1,igaa),xc_dvpt(1,igbb),xc_dvpt(1,igab),
     &              xc_hpt(1,irara),xc_hpt(1,irbrb),xc_hpt(1,irarb),
     &              xc_dhpt(1,iragaa),xc_dhpt(1,iragab),
     &              xc_dhpt(1,iragbb),xc_dhpt(1,irbgbb),
     &              xc_dhpt(1,irbgab),xc_dhpt(1,irbgaa),
     &              xc_dhpt(1,igaagaa),xc_dhpt(1,igaagab),
     &              xc_dhpt(1,igaagbb),xc_dhpt(1,igabgab),
     &              xc_dhpt(1,igabgbb),xc_dhpt(1,igbbgbb))
            endif
         else
            call caserr("xcfunc: Illegal exchange functional id")
         endif
         if (c_fun.ne.C_NONE) then
            ie = allocate_memory(mxpmx,'d')
            if (rks_sw) then
               if (idfun.ge.1) then
                  iv = allocate_memory(mxpmx,'d')
                  if (gradcorr_sw) then
                    idv = allocate_memory(mxpmx,'d')
                  endif
                  if (kinetic_sw) then
                    idt = allocate_memory(mxpmx,'d')
                  endif
               endif
               if (idfun.ge.2) then
                  ih = allocate_memory(mxpmx,'d')
                  if (gradcorr_sw) then
                    idh = allocate_memory(2*mxpmx,'d')
                    idhragaa  = idh+(iragaa-1)*mxp
                    idhgaagaa = idh+(igaagaa-1)*mxp
                  endif
                  if (kinetic_sw) then
                    idf = allocate_memory(2*mxpmx,'d')
                    idfrata = idf+(irata-1)*mxp
                    idftata = idf+(itata-1)*mxp
                  endif
                  if (gradcorr_sw.and.kinetic_sw) then
                    idg = allocate_memory(mxpmx,'d')
                  endif
               endif
            else
               if (idfun.ge.1) then
                  iv = allocate_memory(2*mxpmx,'d')
                  ivra = iv+(ira-1)*mxp
                  ivrb = iv+(irb-1)*mxp
                  if (gradcorr_sw) then
                    idv = allocate_memory(3*mxpmx,'d')
                    idvgaa = idv+(igaa-1)*mxp
                    idvgab = idv+(igab-1)*mxp
                    idvgbb = idv+(igbb-1)*mxp
                  endif
                  if (kinetic_sw) then
                    idt = allocate_memory(2*mxpmx,'d')
                    idta = idt+(ita-1)*mxp
                    idtb = idt+(itb-1)*mxp
                  endif
               endif
               if (idfun.ge.2) then
                  ih = allocate_memory(3*mxpmx,'d')
                  ihrara = ih+(irara-1)*mxp
                  ihrarb = ih+(irarb-1)*mxp
                  ihrbrb = ih+(irbrb-1)*mxp
                  if (gradcorr_sw) then
                    idh = allocate_memory(12*mxpmx,'d')
                    idhragaa  = idh+(iragaa-1)*mxp
                    idhragab  = idh+(iragab-1)*mxp
                    idhragbb  = idh+(iragbb-1)*mxp
                    idhrbgaa  = idh+(irbgaa-1)*mxp
                    idhrbgab  = idh+(irbgab-1)*mxp
                    idhrbgbb  = idh+(irbgbb-1)*mxp
                    idhgaagaa = idh+(igaagaa-1)*mxp
                    idhgaagab = idh+(igaagab-1)*mxp
                    idhgaagbb = idh+(igaagbb-1)*mxp
                    idhgabgab = idh+(igabgab-1)*mxp
                    idhgabgbb = idh+(igabgbb-1)*mxp
                    idhgbbgbb = idh+(igbbgbb-1)*mxp
                  endif
                  if (kinetic_sw) then
                    idf = allocate_memory(7*mxpmx,'d')
                    idfrata = idf+(irata-1)*mxp
                    idfratb = idf+(iratb-1)*mxp
                    idfrbta = idf+(irbta-1)*mxp
                    idfrbtb = idf+(irbtb-1)*mxp
                    idftata = idf+(itata-1)*mxp
                    idftatb = idf+(itatb-1)*mxp
                    idftbtb = idf+(itbtb-1)*mxp
                  endif
                  if (gradcorr_sw.and.kinetic_sw) then
                    idg = allocate_memory(6*mxpmx,'d')
                    idggaata = idg+(igaata-1)*mxp
                    idggaatb = idg+(igaatb-1)*mxp
                    idggabta = idg+(igabta-1)*mxp
                    idggabtb = idg+(igabtb-1)*mxp
                    idggbbta = idg+(igbbta-1)*mxp
                    idggbbtb = idg+(igbbtb-1)*mxp
                  endif
               endif
            endif
         endif
         if      (c_fun.eq.C_NONE) then
         else if (c_fun.eq.C_B95) then
            if (rks_sw) then
               call rks_c_b95(idfun,npts,rho(1,ira),gamma(1,igaa),
     &              tau(1,ita),
     &              memory_fp(ie),memory_fp(iv),memory_fp(idv),
     &              memory_fp(idt),
     &              memory_fp(ih),memory_fp(idhragaa),
     &              memory_fp(idhgaagaa),memory_fp(idfrata),
     &              memory_fp(idggaata),memory_fp(idftata))
            else
               call uks_c_b95(idfun,npts,rho(1,ira),rho(1,irb),
     &              gamma(1,igaa),gamma(1,igbb),gamma(1,igab),
     &              tau(1,ita),tau(1,itb),
     &              memory_fp(ie),memory_fp(ivra),memory_fp(ivrb),
     &              memory_fp(idvgaa),memory_fp(idvgbb),
     &              memory_fp(idvgab),
     &              memory_fp(idta),memory_fp(idtb),
     &              memory_fp(ihrara),memory_fp(ihrbrb),
     &              memory_fp(ihrarb),
     &              memory_fp(idhragaa),memory_fp(idhragab),
     &              memory_fp(idhragbb),memory_fp(idhrbgbb),
     &              memory_fp(idhrbgab),memory_fp(idhrbgaa),
     &              memory_fp(idhgaagaa),memory_fp(idhgaagab),
     &              memory_fp(idhgaagbb),memory_fp(idhgabgab),
     &              memory_fp(idhgabgbb),memory_fp(idhgbbgbb),
     &              memory_fp(idfrata),memory_fp(idfratb),
     &              memory_fp(idfrbta),memory_fp(idfrbtb),
     &              memory_fp(idggaata),memory_fp(idggaatb),
     &              memory_fp(idggabta),memory_fp(idggabtb),
     &              memory_fp(idggbbta),memory_fp(idggbbtb),
     &              memory_fp(idftata),memory_fp(idftbtb),
     &              memory_fp(idftatb))
            endif
         else if (c_fun.eq.C_FT97) then
            if (rks_sw) then
               call rks_c_ft97(idfun,npts,rho(1,ira),gamma(1,igaa),
     &              memory_fp(ie),memory_fp(iv),memory_fp(idv),
     &              memory_fp(ih),memory_fp(idhragaa),
     &              memory_fp(idhgaagaa))
            else
               call uks_c_ft97(idfun,npts,rho(1,ira),rho(1,irb),
     &              gamma(1,igaa),gamma(1,igbb),gamma(1,igab),
     &              memory_fp(ie),memory_fp(ivra),memory_fp(ivrb),
     &              memory_fp(idvgaa),memory_fp(idvgbb),
     &              memory_fp(idvgab),
     &              memory_fp(ihrara),memory_fp(ihrbrb),
     &              memory_fp(ihrarb),
     &              memory_fp(idhragaa),memory_fp(idhragab),
     &              memory_fp(idhragbb),memory_fp(idhrbgbb),
     &              memory_fp(idhrbgab),memory_fp(idhrbgaa),
     &              memory_fp(idhgaagaa),memory_fp(idhgaagab),
     &              memory_fp(idhgaagbb),memory_fp(idhgabgab),
     &              memory_fp(idhgabgbb),memory_fp(idhgbbgbb))
            endif
         else if (c_fun.eq.C_EDF1) then
            if (rks_sw) then
               call rks_c_edf1(idfun,npts,rho(1,ira),gamma(1,igaa),
     &              memory_fp(ie),memory_fp(iv),memory_fp(idv),
     &              memory_fp(ih),memory_fp(idhragaa),
     &              memory_fp(idhgaagaa))
            else
               call uks_c_edf1(idfun,npts,rho(1,ira),rho(1,irb),
     &              gamma(1,igaa),gamma(1,igbb),gamma(1,igab),
     &              memory_fp(ie),memory_fp(ivra),memory_fp(ivrb),
     &              memory_fp(idvgaa),memory_fp(idvgbb),
     &              memory_fp(idvgab),
     &              memory_fp(ihrara),memory_fp(ihrbrb),
     &              memory_fp(ihrarb),
     &              memory_fp(idhragaa),memory_fp(idhragab),
     &              memory_fp(idhragbb),memory_fp(idhrbgbb),
     &              memory_fp(idhrbgab),memory_fp(idhrbgaa),
     &              memory_fp(idhgaagaa),memory_fp(idhgaagab),
     &              memory_fp(idhgaagbb),memory_fp(idhgabgab),
     &              memory_fp(idhgabgbb),memory_fp(idhgbbgbb))
            endif
         else if (c_fun.eq.C_LYP) then
            if (rks_sw) then
               call rks_c_lyp(idfun,npts,rho(1,ira),gamma(1,igaa),
     &              memory_fp(ie),memory_fp(iv),memory_fp(idv),
     &              memory_fp(ih),memory_fp(idhragaa),
     &              memory_fp(idhgaagaa))
            else
               call uks_c_lyp(idfun,npts,rho(1,ira),rho(1,irb),
     &              gamma(1,igaa),gamma(1,igbb),gamma(1,igab),
     &              memory_fp(ie),memory_fp(ivra),memory_fp(ivrb),
     &              memory_fp(idvgaa),memory_fp(idvgbb),
     &              memory_fp(idvgab),
     &              memory_fp(ihrara),memory_fp(ihrbrb),
     &              memory_fp(ihrarb),
     &              memory_fp(idhragaa),memory_fp(idhragab),
     &              memory_fp(idhragbb),memory_fp(idhrbgbb),
     &              memory_fp(idhrbgab),memory_fp(idhrbgaa),
     &              memory_fp(idhgaagaa),memory_fp(idhgaagab),
     &              memory_fp(idhgaagbb),memory_fp(idhgabgab),
     &              memory_fp(idhgabgbb),memory_fp(idhgbbgbb))
            endif
         else if (c_fun.eq.C_PBE) then
            if (rks_sw) then
               call rks_c_pbe(idfun,npts,rho(1,ira),gamma(1,igaa),
     &              memory_fp(ie),memory_fp(iv),memory_fp(idv),
     &              memory_fp(ih),memory_fp(idhragaa),
     &              memory_fp(idhgaagaa))
            else
               call uks_c_pbe(idfun,npts,rho(1,ira),rho(1,irb),
     &              gamma(1,igaa),gamma(1,igbb),gamma(1,igab),
     &              memory_fp(ie),memory_fp(ivra),memory_fp(ivrb),
     &              memory_fp(idvgaa),memory_fp(idvgbb),
     &              memory_fp(idvgab),
     &              memory_fp(ihrara),memory_fp(ihrbrb),
     &              memory_fp(ihrarb),
     &              memory_fp(idhragaa),memory_fp(idhragab),
     &              memory_fp(idhragbb),memory_fp(idhrbgbb),
     &              memory_fp(idhrbgab),memory_fp(idhrbgaa),
     &              memory_fp(idhgaagaa),memory_fp(idhgaagab),
     &              memory_fp(idhgaagbb),memory_fp(idhgabgab),
     &              memory_fp(idhgabgbb),memory_fp(idhgbbgbb))
            endif
         else if (c_fun.eq.C_PZ81) then
            if (rks_sw) then
               call rks_c_pz81(idfun,npts,rho(1,ira),gamma(1,igaa),
     &              memory_fp(ie),memory_fp(iv),memory_fp(idv),
     &              memory_fp(ih),memory_fp(idhragaa),
     &              memory_fp(idhgaagaa))
            else
               call uks_c_pz81(idfun,npts,rho(1,ira),rho(1,irb),
     &              gamma(1,igaa),gamma(1,igbb),gamma(1,igab),
     &              memory_fp(ie),memory_fp(ivra),memory_fp(ivrb),
     &              memory_fp(idvgaa),memory_fp(idvgbb),
     &              memory_fp(idvgab),
     &              memory_fp(ihrara),memory_fp(ihrbrb),
     &              memory_fp(ihrarb),
     &              memory_fp(idhragaa),memory_fp(idhragab),
     &              memory_fp(idhragbb),memory_fp(idhrbgbb),
     &              memory_fp(idhrbgab),memory_fp(idhrbgaa),
     &              memory_fp(idhgaagaa),memory_fp(idhgaagab),
     &              memory_fp(idhgaagbb),memory_fp(idhgabgab),
     &              memory_fp(idhgabgbb),memory_fp(idhgbbgbb))
            endif
         else if (c_fun.eq.C_P86) then
            if (rks_sw) then
               call rks_c_p86(idfun,npts,rho(1,ira),gamma(1,igaa),
     &              memory_fp(ie),memory_fp(iv),memory_fp(idv),
     &              memory_fp(ih),memory_fp(idhragaa),
     &              memory_fp(idhgaagaa))
            else
               call uks_c_p86(idfun,npts,rho(1,ira),rho(1,irb),
     &              gamma(1,igaa),gamma(1,igbb),gamma(1,igab),
     &              memory_fp(ie),memory_fp(ivra),memory_fp(ivrb),
     &              memory_fp(idvgaa),memory_fp(idvgbb),
     &              memory_fp(idvgab),
     &              memory_fp(ihrara),memory_fp(ihrbrb),
     &              memory_fp(ihrarb),
     &              memory_fp(idhragaa),memory_fp(idhragab),
     &              memory_fp(idhragbb),memory_fp(idhrbgbb),
     &              memory_fp(idhrbgab),memory_fp(idhrbgaa),
     &              memory_fp(idhgaagaa),memory_fp(idhgaagab),
     &              memory_fp(idhgaagbb),memory_fp(idhgabgab),
     &              memory_fp(idhgabgbb),memory_fp(idhgbbgbb))
            endif
         else if (c_fun.eq.C_PW91) then
            if (rks_sw) then
               call rks_c_pw91(idfun,npts,rho(1,ira),gamma(1,igaa),
     &              memory_fp(ie),memory_fp(iv),memory_fp(idv),
     &              memory_fp(ih),memory_fp(idhragaa),
     &              memory_fp(idhgaagaa))
            else
               call uks_c_pw91(idfun,npts,rho(1,ira),rho(1,irb),
     &              gamma(1,igaa),gamma(1,igbb),gamma(1,igab),
     &              memory_fp(ie),memory_fp(ivra),memory_fp(ivrb),
     &              memory_fp(idvgaa),memory_fp(idvgbb),
     &              memory_fp(idvgab),
     &              memory_fp(ihrara),memory_fp(ihrbrb),
     &              memory_fp(ihrarb),
     &              memory_fp(idhragaa),memory_fp(idhragab),
     &              memory_fp(idhragbb),memory_fp(idhrbgbb),
     &              memory_fp(idhrbgab),memory_fp(idhrbgaa),
     &              memory_fp(idhgaagaa),memory_fp(idhgaagab),
     &              memory_fp(idhgaagbb),memory_fp(idhgabgab),
     &              memory_fp(idhgabgbb),memory_fp(idhgbbgbb))
            endif
         else if (c_fun.eq.C_PW92) then
            if (rks_sw) then
               call rks_c_pw92(idfun,npts,rho(1,ira),gamma(1,igaa),
     &              memory_fp(ie),memory_fp(iv),memory_fp(idv),
     &              memory_fp(ih),memory_fp(idhragaa),
     &              memory_fp(idhgaagaa))
            else
               call uks_c_pw92(idfun,npts,rho(1,ira),rho(1,irb),
     &              gamma(1,igaa),gamma(1,igbb),gamma(1,igab),
     &              memory_fp(ie),memory_fp(ivra),memory_fp(ivrb),
     &              memory_fp(idvgaa),memory_fp(idvgbb),
     &              memory_fp(idvgab),
     &              memory_fp(ihrara),memory_fp(ihrbrb),
     &              memory_fp(ihrarb),
     &              memory_fp(idhragaa),memory_fp(idhragab),
     &              memory_fp(idhragbb),memory_fp(idhrbgbb),
     &              memory_fp(idhrbgab),memory_fp(idhrbgaa),
     &              memory_fp(idhgaagaa),memory_fp(idhgaagab),
     &              memory_fp(idhgaagbb),memory_fp(idhgabgab),
     &              memory_fp(idhgabgbb),memory_fp(idhgbbgbb))
            endif
         else if (c_fun.eq.C_VWN5) then
            if (rks_sw) then
               call rks_c_vwn5(idfun,npts,rho(1,ira),gamma(1,igaa),
     &              memory_fp(ie),memory_fp(iv),memory_fp(idv),
     &              memory_fp(ih),memory_fp(idhragaa),
     &              memory_fp(idhgaagaa))
            else
               call uks_c_vwn5(idfun,npts,rho(1,ira),rho(1,irb),
     &              gamma(1,igaa),gamma(1,igbb),gamma(1,igab),
     &              memory_fp(ie),memory_fp(ivra),memory_fp(ivrb),
     &              memory_fp(idvgaa),memory_fp(idvgbb),
     &              memory_fp(idvgab),
     &              memory_fp(ihrara),memory_fp(ihrbrb),
     &              memory_fp(ihrarb),
     &              memory_fp(idhragaa),memory_fp(idhragab),
     &              memory_fp(idhragbb),memory_fp(idhrbgbb),
     &              memory_fp(idhrbgab),memory_fp(idhrbgaa),
     &              memory_fp(idhgaagaa),memory_fp(idhgaagab),
     &              memory_fp(idhgaagbb),memory_fp(idhgabgab),
     &              memory_fp(idhgabgbb),memory_fp(idhgbbgbb))
            endif
         else if (c_fun.eq.C_VWN5RPA) then
            if (rks_sw) then
               call rks_c_vwn5rpa(idfun,npts,rho(1,ira),gamma(1,igaa),
     &              memory_fp(ie),memory_fp(iv),memory_fp(idv),
     &              memory_fp(ih),memory_fp(idhragaa),
     &              memory_fp(idhgaagaa))
            else
               call uks_c_vwn5rpa(idfun,npts,rho(1,ira),rho(1,irb),
     &              gamma(1,igaa),gamma(1,igbb),gamma(1,igab),
     &              memory_fp(ie),memory_fp(ivra),memory_fp(ivrb),
     &              memory_fp(idvgaa),memory_fp(idvgbb),
     &              memory_fp(idvgab),
     &              memory_fp(ihrara),memory_fp(ihrbrb),
     &              memory_fp(ihrarb),
     &              memory_fp(idhragaa),memory_fp(idhragab),
     &              memory_fp(idhragbb),memory_fp(idhrbgbb),
     &              memory_fp(idhrbgab),memory_fp(idhrbgaa),
     &              memory_fp(idhgaagaa),memory_fp(idhgaagab),
     &              memory_fp(idhgaagbb),memory_fp(idhgabgab),
     &              memory_fp(idhgabgbb),memory_fp(idhgbbgbb))
            endif
         else
            call caserr("xcfunc: Illegal correlation functional id")
         endif
         if (c_fun.ne.C_NONE) then
            if (rks_sw) then
               if (idfun.ge.2) then
                  if (gradcorr_sw.and.kinetic_sw) then
c                   call daxpy(npts,1.0d0,memory_fp(idggaata),1,
c    &                                    xc_dgpt(1,igaata),1)
                    call free_memory(idg,'d')
                  endif
                  if (kinetic_sw) then
c                   call daxpy(npts,1.0d0,memory_fp(idfrata),1,
c    &                                    xc_dfpt(1,irata),1)
c                   call daxpy(npts,1.0d0,memory_fp(idftata),1,
c    &                                    xc_dfpt(1,itata),1)
                    call free_memory(idf,'d')
                  endif
                  if (gradcorr_sw) then
                    call daxpy(npts,1.0d0,memory_fp(idhragaa),1,
     &                                    xc_dhpt(1,iragaa),1)
                    call daxpy(npts,1.0d0,memory_fp(idhgaagaa),1,
     &                                    xc_dhpt(1,igaagaa),1)
                    call free_memory(idh,'d')
                  endif
                  call daxpy(npts,1.0d0,memory_fp(ih),1,
     &                                  xc_hpt(1,irara),1)
                  call free_memory(ih,'d')
               endif
               if (idfun.ge.1) then
                  if (kinetic_sw) then
                    call daxpy(npts,1.0d0,memory_fp(idt),1,
     &                                    xc_dtpt(1,ita),1)
                    call free_memory(idt,'d')
                  endif
                  if (gradcorr_sw) then
                    call daxpy(npts,1.0d0,memory_fp(idv),1,
     &                                    xc_dvpt(1,igaa),1)
                    call free_memory(idv,'d')
                  endif
                  call daxpy(npts,1.0d0,memory_fp(iv),1,
     &                                  xc_vpt(1,ira),1)
                  call free_memory(iv,'d')
               endif
            else
               if (idfun.ge.2) then
                  if (gradcorr_sw.and.kinetic_sw) then
c                   call daxpy(npts,1.0d0,memory_fp(idggaata),1,
c    &                                    xc_dgpt(1,igaata),1)
c                   call daxpy(npts,1.0d0,memory_fp(idggaatb),1,
c    &                                    xc_dgpt(1,igaatb),1)
c                   call daxpy(npts,1.0d0,memory_fp(idggabta),1,
c    &                                    xc_dgpt(1,igabta),1)
c                   call daxpy(npts,1.0d0,memory_fp(idggabtb),1,
c    &                                    xc_dgpt(1,igabtb),1)
c                   call daxpy(npts,1.0d0,memory_fp(idggbbta),1,
c    &                                    xc_dgpt(1,igbbta),1)
c                   call daxpy(npts,1.0d0,memory_fp(idggbbtb),1,
c    &                                    xc_dgpt(1,igbbtb),1)
                    call free_memory(idg,'d')
                  endif
                  if (kinetic_sw) then
c                   call daxpy(npts,1.0d0,memory_fp(idfrata),1,
c    &                                    xc_dfpt(1,irata),1)
c                   call daxpy(npts,1.0d0,memory_fp(idfratb),1,
c    &                                    xc_dfpt(1,iratb),1)
c                   call daxpy(npts,1.0d0,memory_fp(idfrbta),1,
c    &                                    xc_dfpt(1,irbta),1)
c                   call daxpy(npts,1.0d0,memory_fp(idfrbtb),1,
c    &                                    xc_dfpt(1,irbtb),1)
c                   call daxpy(npts,1.0d0,memory_fp(idftata),1,
c    &                                    xc_dfpt(1,itata),1)
c                   call daxpy(npts,1.0d0,memory_fp(idftatb),1,
c    &                                    xc_dfpt(1,itatb),1)
c                   call daxpy(npts,1.0d0,memory_fp(idftbtb),1,
c    &                                    xc_dfpt(1,itbtb),1)
                    call free_memory(idf,'d')
                  endif
                  if (gradcorr_sw) then
                    call daxpy(npts,1.0d0,memory_fp(idhragaa),1,
     &                                    xc_dhpt(1,iragaa),1)
                    call daxpy(npts,1.0d0,memory_fp(idhragab),1,
     &                                    xc_dhpt(1,iragab),1)
                    call daxpy(npts,1.0d0,memory_fp(idhragbb),1,
     &                                    xc_dhpt(1,iragbb),1)
                    call daxpy(npts,1.0d0,memory_fp(idhrbgaa),1,
     &                                    xc_dhpt(1,irbgaa),1)
                    call daxpy(npts,1.0d0,memory_fp(idhrbgab),1,
     &                                    xc_dhpt(1,irbgab),1)
                    call daxpy(npts,1.0d0,memory_fp(idhrbgbb),1,
     &                                    xc_dhpt(1,irbgbb),1)
                    call daxpy(npts,1.0d0,memory_fp(idhgaagaa),1,
     &                                    xc_dhpt(1,igaagaa),1)
                    call daxpy(npts,1.0d0,memory_fp(idhgaagab),1,
     &                                    xc_dhpt(1,igaagab),1)
                    call daxpy(npts,1.0d0,memory_fp(idhgaagbb),1,
     &                                    xc_dhpt(1,igaagbb),1)
                    call daxpy(npts,1.0d0,memory_fp(idhgabgab),1,
     &                                    xc_dhpt(1,igabgab),1)
                    call daxpy(npts,1.0d0,memory_fp(idhgabgbb),1,
     &                                    xc_dhpt(1,igabgbb),1)
                    call daxpy(npts,1.0d0,memory_fp(idhgbbgbb),1,
     &                                    xc_dhpt(1,igbbgbb),1)
                    call free_memory(idh,'d')
                  endif
                  call daxpy(npts,1.0d0,memory_fp(ihrara),1,
     &                                  xc_hpt(1,irara),1)
                  call daxpy(npts,1.0d0,memory_fp(ihrarb),1,
     &                                  xc_hpt(1,irarb),1)
                  call daxpy(npts,1.0d0,memory_fp(ihrbrb),1,
     &                                  xc_hpt(1,irbrb),1)
                  call free_memory(ih,'d')
               endif
               if (idfun.ge.1) then
                  if (kinetic_sw) then
                    call daxpy(npts,1.0d0,memory_fp(idta),1,
     &                                    xc_dtpt(1,ita),1)
                    call daxpy(npts,1.0d0,memory_fp(idtb),1,
     &                                    xc_dtpt(1,itb),1)
                    call free_memory(idt,'d')
                  endif
                  if (gradcorr_sw) then
                    call daxpy(npts,1.0d0,memory_fp(idvgaa),1,
     &                                    xc_dvpt(1,igaa),1)
                    call daxpy(npts,1.0d0,memory_fp(idvgab),1,
     &                                    xc_dvpt(1,igab),1)
                    call daxpy(npts,1.0d0,memory_fp(idvgbb),1,
     &                                    xc_dvpt(1,igbb),1)
                    call free_memory(idv,'d')
                  endif
                  call daxpy(npts,1.0d0,memory_fp(ivra),1,
     &                                  xc_vpt(1,ira),1)
                  call daxpy(npts,1.0d0,memory_fp(ivrb),1,
     &                                  xc_vpt(1,irb),1)
                  call free_memory(iv,'d')
               endif
            endif
            call daxpy(npts,1.0d0,memory_fp(ie),1,xc_ept,1)
            call free_memory(ie,'d')
         endif
      else if (xc_fun.eq.XC_B3LYP) then
         if (rks_sw) then
            call rks_xc_b3lyp(idfun,npts,rho(1,ira),gamma(1,igaa),
     &           xc_ept,xc_vpt(1,ira),xc_dvpt(1,igaa),
     &           xc_hpt(1,irara),xc_dhpt(1,iragaa),
     &           xc_dhpt(1,igaagaa))
         else
            call uks_xc_b3lyp(idfun,npts,rho(1,ira),rho(1,irb),
     &           gamma(1,igaa),gamma(1,igbb),gamma(1,igab),
     &           xc_ept,xc_vpt(1,ira),xc_vpt(1,irb),
     &           xc_dvpt(1,igaa),xc_dvpt(1,igbb),xc_dvpt(1,igab),
     &           xc_hpt(1,irara),xc_hpt(1,irbrb),xc_hpt(1,irarb),
     &           xc_dhpt(1,iragaa),xc_dhpt(1,iragab),
     &           xc_dhpt(1,iragbb),xc_dhpt(1,irbgbb),
     &           xc_dhpt(1,irbgab),xc_dhpt(1,irbgaa),
     &           xc_dhpt(1,igaagaa),xc_dhpt(1,igaagab),
     &           xc_dhpt(1,igaagbb),xc_dhpt(1,igabgab),
     &           xc_dhpt(1,igabgbb),xc_dhpt(1,igbbgbb))
         endif
      else if (xc_fun.eq.XC_B3LYP_VWN5) then
         if (rks_sw) then
            call rks_xc_b3lyp_vwn5(idfun,npts,rho(1,ira),gamma(1,igaa),
     &           xc_ept,xc_vpt(1,ira),xc_dvpt(1,igaa),
     &           xc_hpt(1,irara),xc_dhpt(1,iragaa),
     &           xc_dhpt(1,igaagaa))
         else
            call uks_xc_b3lyp_vwn5(idfun,npts,rho(1,ira),rho(1,irb),
     &           gamma(1,igaa),gamma(1,igbb),gamma(1,igab),
     &           xc_ept,xc_vpt(1,ira),xc_vpt(1,irb),
     &           xc_dvpt(1,igaa),xc_dvpt(1,igbb),xc_dvpt(1,igab),
     &           xc_hpt(1,irara),xc_hpt(1,irbrb),xc_hpt(1,irarb),
     &           xc_dhpt(1,iragaa),xc_dhpt(1,iragab),
     &           xc_dhpt(1,iragbb),xc_dhpt(1,irbgbb),
     &           xc_dhpt(1,irbgab),xc_dhpt(1,irbgaa),
     &           xc_dhpt(1,igaagaa),xc_dhpt(1,igaagab),
     &           xc_dhpt(1,igaagbb),xc_dhpt(1,igabgab),
     &           xc_dhpt(1,igabgbb),xc_dhpt(1,igbbgbb))
         endif
      else if (xc_fun.eq.XC_B3LYP_VWN5RPA) then
         if (rks_sw) then
            call rks_xc_b3lyp_vwn5rpa(idfun,npts,rho(1,ira),
     &           gamma(1,igaa),
     &           xc_ept,xc_vpt(1,ira),xc_dvpt(1,igaa),
     &           xc_hpt(1,irara),xc_dhpt(1,iragaa),
     &           xc_dhpt(1,igaagaa))
         else
            call uks_xc_b3lyp_vwn5rpa(idfun,npts,rho(1,ira),rho(1,irb),
     &           gamma(1,igaa),gamma(1,igbb),gamma(1,igab),
     &           xc_ept,xc_vpt(1,ira),xc_vpt(1,irb),
     &           xc_dvpt(1,igaa),xc_dvpt(1,igbb),xc_dvpt(1,igab),
     &           xc_hpt(1,irara),xc_hpt(1,irbrb),xc_hpt(1,irarb),
     &           xc_dhpt(1,iragaa),xc_dhpt(1,iragab),
     &           xc_dhpt(1,iragbb),xc_dhpt(1,irbgbb),
     &           xc_dhpt(1,irbgab),xc_dhpt(1,irbgaa),
     &           xc_dhpt(1,igaagaa),xc_dhpt(1,igaagab),
     &           xc_dhpt(1,igaagbb),xc_dhpt(1,igabgab),
     &           xc_dhpt(1,igabgbb),xc_dhpt(1,igbbgbb))
         endif
      else if (xc_fun.eq.XC_B3PW91) then
         if (rks_sw) then
            call rks_xc_b3pw91(idfun,npts,rho(1,ira),gamma(1,igaa),
     &           xc_ept,xc_vpt(1,ira),xc_dvpt(1,igaa),
     &           xc_hpt(1,irara),xc_dhpt(1,iragaa),
     &           xc_dhpt(1,igaagaa))
         else
            call uks_xc_b3pw91(idfun,npts,rho(1,ira),rho(1,irb),
     &           gamma(1,igaa),gamma(1,igbb),gamma(1,igab),
     &           xc_ept,xc_vpt(1,ira),xc_vpt(1,irb),
     &           xc_dvpt(1,igaa),xc_dvpt(1,igbb),xc_dvpt(1,igab),
     &           xc_hpt(1,irara),xc_hpt(1,irbrb),xc_hpt(1,irarb),
     &           xc_dhpt(1,iragaa),xc_dhpt(1,iragab),
     &           xc_dhpt(1,iragbb),xc_dhpt(1,irbgbb),
     &           xc_dhpt(1,irbgab),xc_dhpt(1,irbgaa),
     &           xc_dhpt(1,igaagaa),xc_dhpt(1,igaagab),
     &           xc_dhpt(1,igaagbb),xc_dhpt(1,igabgab),
     &           xc_dhpt(1,igabgbb),xc_dhpt(1,igbbgbb))
         endif
      else if (xc_fun.eq.XC_B97) then
         if (rks_sw) then
            call rks_xc_b97(idfun,npts,rho(1,ira),gamma(1,igaa),
     &           xc_ept,xc_vpt(1,ira),xc_dvpt(1,igaa),
     &           xc_hpt(1,irara),xc_dhpt(1,iragaa),
     &           xc_dhpt(1,igaagaa))
         else
            call uks_xc_b97(idfun,npts,rho(1,ira),rho(1,irb),
     &           gamma(1,igaa),gamma(1,igbb),gamma(1,igab),
     &           xc_ept,xc_vpt(1,ira),xc_vpt(1,irb),
     &           xc_dvpt(1,igaa),xc_dvpt(1,igbb),xc_dvpt(1,igab),
     &           xc_hpt(1,irara),xc_hpt(1,irbrb),xc_hpt(1,irarb),
     &           xc_dhpt(1,iragaa),xc_dhpt(1,iragab),
     &           xc_dhpt(1,iragbb),xc_dhpt(1,irbgbb),
     &           xc_dhpt(1,irbgab),xc_dhpt(1,irbgaa),
     &           xc_dhpt(1,igaagaa),xc_dhpt(1,igaagab),
     &           xc_dhpt(1,igaagbb),xc_dhpt(1,igabgab),
     &           xc_dhpt(1,igabgbb),xc_dhpt(1,igbbgbb))
         endif
      else if (xc_fun.eq.XC_B97_1) then
         if (rks_sw) then
            call rks_xc_b97_1(idfun,npts,rho(1,ira),gamma(1,igaa),
     &           xc_ept,xc_vpt(1,ira),xc_dvpt(1,igaa),
     &           xc_hpt(1,irara),xc_dhpt(1,iragaa),
     &           xc_dhpt(1,igaagaa))
         else
            call uks_xc_b97_1(idfun,npts,rho(1,ira),rho(1,irb),
     &           gamma(1,igaa),gamma(1,igbb),gamma(1,igab),
     &           xc_ept,xc_vpt(1,ira),xc_vpt(1,irb),
     &           xc_dvpt(1,igaa),xc_dvpt(1,igbb),xc_dvpt(1,igab),
     &           xc_hpt(1,irara),xc_hpt(1,irbrb),xc_hpt(1,irarb),
     &           xc_dhpt(1,iragaa),xc_dhpt(1,iragab),
     &           xc_dhpt(1,iragbb),xc_dhpt(1,irbgbb),
     &           xc_dhpt(1,irbgab),xc_dhpt(1,irbgaa),
     &           xc_dhpt(1,igaagaa),xc_dhpt(1,igaagab),
     &           xc_dhpt(1,igaagbb),xc_dhpt(1,igabgab),
     &           xc_dhpt(1,igabgbb),xc_dhpt(1,igbbgbb))
         endif
      else if (xc_fun.eq.XC_B97_2) then
         if (rks_sw) then
            call rks_xc_b97_2(idfun,npts,rho(1,ira),gamma(1,igaa),
     &           xc_ept,xc_vpt(1,ira),xc_dvpt(1,igaa),
     &           xc_hpt(1,irara),xc_dhpt(1,iragaa),
     &           xc_dhpt(1,igaagaa))
         else
            call uks_xc_b97_2(idfun,npts,rho(1,ira),rho(1,irb),
     &           gamma(1,igaa),gamma(1,igbb),gamma(1,igab),
     &           xc_ept,xc_vpt(1,ira),xc_vpt(1,irb),
     &           xc_dvpt(1,igaa),xc_dvpt(1,igbb),xc_dvpt(1,igab),
     &           xc_hpt(1,irara),xc_hpt(1,irbrb),xc_hpt(1,irarb),
     &           xc_dhpt(1,iragaa),xc_dhpt(1,iragab),
     &           xc_dhpt(1,iragbb),xc_dhpt(1,irbgbb),
     &           xc_dhpt(1,irbgab),xc_dhpt(1,irbgaa),
     &           xc_dhpt(1,igaagaa),xc_dhpt(1,igaagab),
     &           xc_dhpt(1,igaagbb),xc_dhpt(1,igabgab),
     &           xc_dhpt(1,igabgbb),xc_dhpt(1,igbbgbb))
         endif
      else if (xc_fun.eq.XC_B97_3) then
         if (rks_sw) then
            call rks_xc_b97_3(idfun,npts,rho(1,ira),gamma(1,igaa),
     &           xc_ept,xc_vpt(1,ira),xc_dvpt(1,igaa),
     &           xc_hpt(1,irara),xc_dhpt(1,iragaa),
     &           xc_dhpt(1,igaagaa))
         else
            call uks_xc_b97_3(idfun,npts,rho(1,ira),rho(1,irb),
     &           gamma(1,igaa),gamma(1,igbb),gamma(1,igab),
     &           xc_ept,xc_vpt(1,ira),xc_vpt(1,irb),
     &           xc_dvpt(1,igaa),xc_dvpt(1,igbb),xc_dvpt(1,igab),
     &           xc_hpt(1,irara),xc_hpt(1,irbrb),xc_hpt(1,irarb),
     &           xc_dhpt(1,iragaa),xc_dhpt(1,iragab),
     &           xc_dhpt(1,iragbb),xc_dhpt(1,irbgbb),
     &           xc_dhpt(1,irbgab),xc_dhpt(1,irbgaa),
     &           xc_dhpt(1,igaagaa),xc_dhpt(1,igaagab),
     &           xc_dhpt(1,igaagbb),xc_dhpt(1,igabgab),
     &           xc_dhpt(1,igabgbb),xc_dhpt(1,igbbgbb))
         endif
      else if (xc_fun.eq.XC_B97_D) then
         if (rks_sw) then
            call rks_xc_b97_d(idfun,npts,rho(1,ira),gamma(1,igaa),
     &           xc_ept,xc_vpt(1,ira),xc_dvpt(1,igaa),
     &           xc_hpt(1,irara),xc_dhpt(1,iragaa),
     &           xc_dhpt(1,igaagaa))
         else
            call uks_xc_b97_d(idfun,npts,rho(1,ira),rho(1,irb),
     &           gamma(1,igaa),gamma(1,igbb),gamma(1,igab),
     &           xc_ept,xc_vpt(1,ira),xc_vpt(1,irb),
     &           xc_dvpt(1,igaa),xc_dvpt(1,igbb),xc_dvpt(1,igab),
     &           xc_hpt(1,irara),xc_hpt(1,irbrb),xc_hpt(1,irarb),
     &           xc_dhpt(1,iragaa),xc_dhpt(1,iragab),
     &           xc_dhpt(1,iragbb),xc_dhpt(1,irbgbb),
     &           xc_dhpt(1,irbgab),xc_dhpt(1,irbgaa),
     &           xc_dhpt(1,igaagaa),xc_dhpt(1,igaagab),
     &           xc_dhpt(1,igaagbb),xc_dhpt(1,igabgab),
     &           xc_dhpt(1,igabgbb),xc_dhpt(1,igbbgbb))
         endif
      else if (xc_fun.eq.XC_BB95) then
         if (rks_sw) then
            call rks_xc_bb95(idfun,npts,rho(1,ira),gamma(1,igaa),
     &           tau(1,ita),xc_ept,xc_vpt(1,ira),xc_dvpt(1,igaa),
     &           xc_dtpt(1,ita),xc_hpt(1,irara),xc_dhpt(1,iragaa),
     &           xc_dhpt(1,igaagaa),xc_dfpt(1,irata),xc_dfpt(1,igaata),
     &           xc_dgpt(1,itata))
         else
            call uks_xc_bb95(idfun,npts,rho(1,ira),rho(1,irb),
     &           gamma(1,igaa),gamma(1,igbb),gamma(1,igab),
     &           tau(1,ita),tau(1,itb),
     &           xc_ept,xc_vpt(1,ira),xc_vpt(1,irb),
     &           xc_dvpt(1,igaa),xc_dvpt(1,igbb),xc_dvpt(1,igab),
     &           xc_dtpt(1,ita),xc_dtpt(1,itb),
     &           xc_hpt(1,irara),xc_hpt(1,irbrb),xc_hpt(1,irarb),
     &           xc_dhpt(1,iragaa),xc_dhpt(1,iragab),
     &           xc_dhpt(1,iragbb),xc_dhpt(1,irbgbb),
     &           xc_dhpt(1,irbgab),xc_dhpt(1,irbgaa),
     &           xc_dhpt(1,igaagaa),xc_dhpt(1,igaagab),
     &           xc_dhpt(1,igaagbb),xc_dhpt(1,igabgab),
     &           xc_dhpt(1,igabgbb),xc_dhpt(1,igbbgbb),
     &           xc_dfpt(1,irata),xc_dfpt(1,iratb),
     &           xc_dfpt(1,irbta),xc_dfpt(1,irbtb),
     &           xc_dgpt(1,igaata),xc_dgpt(1,igaatb),
     &           xc_dgpt(1,igabta),xc_dgpt(1,igabtb),
     &           xc_dgpt(1,igbbta),xc_dgpt(1,igbbtb),
     &           xc_dfpt(1,itata),xc_dfpt(1,itbtb),xc_dfpt(1,itatb))
         endif
      else if (xc_fun.eq.XC_B1B95) then
         if (rks_sw) then
            call rks_xc_b1b95(idfun,npts,rho(1,ira),gamma(1,igaa),
     &           tau(1,ita),xc_ept,xc_vpt(1,ira),xc_dvpt(1,igaa),
     &           xc_dtpt(1,ita),xc_hpt(1,irara),xc_dhpt(1,iragaa),
     &           xc_dhpt(1,igaagaa),xc_dfpt(1,irata),xc_dfpt(1,igaata),
     &           xc_dgpt(1,itata))
         else
            call uks_xc_b1b95(idfun,npts,rho(1,ira),rho(1,irb),
     &           gamma(1,igaa),gamma(1,igbb),gamma(1,igab),
     &           tau(1,ita),tau(1,itb),
     &           xc_ept,xc_vpt(1,ira),xc_vpt(1,irb),
     &           xc_dvpt(1,igaa),xc_dvpt(1,igbb),xc_dvpt(1,igab),
     &           xc_dtpt(1,ita),xc_dtpt(1,itb),
     &           xc_hpt(1,irara),xc_hpt(1,irbrb),xc_hpt(1,irarb),
     &           xc_dhpt(1,iragaa),xc_dhpt(1,iragab),
     &           xc_dhpt(1,iragbb),xc_dhpt(1,irbgbb),
     &           xc_dhpt(1,irbgab),xc_dhpt(1,irbgaa),
     &           xc_dhpt(1,igaagaa),xc_dhpt(1,igaagab),
     &           xc_dhpt(1,igaagbb),xc_dhpt(1,igabgab),
     &           xc_dhpt(1,igabgbb),xc_dhpt(1,igbbgbb),
     &           xc_dfpt(1,irata),xc_dfpt(1,iratb),
     &           xc_dfpt(1,irbta),xc_dfpt(1,irbtb),
     &           xc_dgpt(1,igaata),xc_dgpt(1,igaatb),
     &           xc_dgpt(1,igabta),xc_dgpt(1,igabtb),
     &           xc_dgpt(1,igbbta),xc_dgpt(1,igbbtb),
     &           xc_dfpt(1,itata),xc_dfpt(1,itbtb),xc_dfpt(1,itatb))
         endif
      else if (xc_fun.eq.XC_BB1K) then
         if (rks_sw) then
            call rks_xc_bb1k(idfun,npts,rho(1,ira),gamma(1,igaa),
     &           tau(1,ita),xc_ept,xc_vpt(1,ira),xc_dvpt(1,igaa),
     &           xc_dtpt(1,ita),xc_hpt(1,irara),xc_dhpt(1,iragaa),
     &           xc_dhpt(1,igaagaa),xc_dfpt(1,irata),xc_dfpt(1,igaata),
     &           xc_dgpt(1,itata))
         else
            call uks_xc_bb1k(idfun,npts,rho(1,ira),rho(1,irb),
     &           gamma(1,igaa),gamma(1,igbb),gamma(1,igab),
     &           tau(1,ita),tau(1,itb),
     &           xc_ept,xc_vpt(1,ira),xc_vpt(1,irb),
     &           xc_dvpt(1,igaa),xc_dvpt(1,igbb),xc_dvpt(1,igab),
     &           xc_dtpt(1,ita),xc_dtpt(1,itb),
     &           xc_hpt(1,irara),xc_hpt(1,irbrb),xc_hpt(1,irarb),
     &           xc_dhpt(1,iragaa),xc_dhpt(1,iragab),
     &           xc_dhpt(1,iragbb),xc_dhpt(1,irbgbb),
     &           xc_dhpt(1,irbgab),xc_dhpt(1,irbgaa),
     &           xc_dhpt(1,igaagaa),xc_dhpt(1,igaagab),
     &           xc_dhpt(1,igaagbb),xc_dhpt(1,igabgab),
     &           xc_dhpt(1,igabgbb),xc_dhpt(1,igbbgbb),
     &           xc_dfpt(1,irata),xc_dfpt(1,iratb),
     &           xc_dfpt(1,irbta),xc_dfpt(1,irbtb),
     &           xc_dgpt(1,igaata),xc_dgpt(1,igaatb),
     &           xc_dgpt(1,igabta),xc_dgpt(1,igabtb),
     &           xc_dgpt(1,igbbta),xc_dgpt(1,igbbtb),
     &           xc_dfpt(1,itata),xc_dfpt(1,itbtb),xc_dfpt(1,itatb))
         endif
      else if (xc_fun.eq.XC_FT97) then
         if (rks_sw) then
            call rks_xc_ft97(idfun,npts,rho(1,ira),gamma(1,igaa),
     &           xc_ept,xc_vpt(1,ira),xc_dvpt(1,igaa),
     &           xc_hpt(1,irara),xc_dhpt(1,iragaa),
     &           xc_dhpt(1,igaagaa))
         else
            call uks_xc_ft97(idfun,npts,rho(1,ira),rho(1,irb),
     &           gamma(1,igaa),gamma(1,igbb),gamma(1,igab),
     &           xc_ept,xc_vpt(1,ira),xc_vpt(1,irb),
     &           xc_dvpt(1,igaa),xc_dvpt(1,igbb),xc_dvpt(1,igab),
     &           xc_hpt(1,irara),xc_hpt(1,irbrb),xc_hpt(1,irarb),
     &           xc_dhpt(1,iragaa),xc_dhpt(1,iragab),
     &           xc_dhpt(1,iragbb),xc_dhpt(1,irbgbb),
     &           xc_dhpt(1,irbgab),xc_dhpt(1,irbgaa),
     &           xc_dhpt(1,igaagaa),xc_dhpt(1,igaagab),
     &           xc_dhpt(1,igaagbb),xc_dhpt(1,igabgab),
     &           xc_dhpt(1,igabgbb),xc_dhpt(1,igbbgbb))
         endif
      else if (xc_fun.eq.XC_EDF1) then
         if (rks_sw) then
            call rks_xc_edf1(idfun,npts,rho(1,ira),gamma(1,igaa),
     &           xc_ept,xc_vpt(1,ira),xc_dvpt(1,igaa),
     &           xc_hpt(1,irara),xc_dhpt(1,iragaa),
     &           xc_dhpt(1,igaagaa))
         else
            call uks_xc_edf1(idfun,npts,rho(1,ira),rho(1,irb),
     &           gamma(1,igaa),gamma(1,igbb),gamma(1,igab),
     &           xc_ept,xc_vpt(1,ira),xc_vpt(1,irb),
     &           xc_dvpt(1,igaa),xc_dvpt(1,igbb),xc_dvpt(1,igab),
     &           xc_hpt(1,irara),xc_hpt(1,irbrb),xc_hpt(1,irarb),
     &           xc_dhpt(1,iragaa),xc_dhpt(1,iragab),
     &           xc_dhpt(1,iragbb),xc_dhpt(1,irbgbb),
     &           xc_dhpt(1,irbgab),xc_dhpt(1,irbgaa),
     &           xc_dhpt(1,igaagaa),xc_dhpt(1,igaagab),
     &           xc_dhpt(1,igaagbb),xc_dhpt(1,igabgab),
     &           xc_dhpt(1,igabgbb),xc_dhpt(1,igbbgbb))
         endif
      else if (xc_fun.eq.XC_HCTH) then
         if (rks_sw) then
            call rks_xc_hcth(idfun,npts,rho(1,ira),gamma(1,igaa),
     &           xc_ept,xc_vpt(1,ira),xc_dvpt(1,igaa),
     &           xc_hpt(1,irara),xc_dhpt(1,iragaa),
     &           xc_dhpt(1,igaagaa))
         else
            call uks_xc_hcth(idfun,npts,rho(1,ira),rho(1,irb),
     &           gamma(1,igaa),gamma(1,igbb),gamma(1,igab),
     &           xc_ept,xc_vpt(1,ira),xc_vpt(1,irb),
     &           xc_dvpt(1,igaa),xc_dvpt(1,igbb),xc_dvpt(1,igab),
     &           xc_hpt(1,irara),xc_hpt(1,irbrb),xc_hpt(1,irarb),
     &           xc_dhpt(1,iragaa),xc_dhpt(1,iragab),
     &           xc_dhpt(1,iragbb),xc_dhpt(1,irbgbb),
     &           xc_dhpt(1,irbgab),xc_dhpt(1,irbgaa),
     &           xc_dhpt(1,igaagaa),xc_dhpt(1,igaagab),
     &           xc_dhpt(1,igaagbb),xc_dhpt(1,igabgab),
     &           xc_dhpt(1,igabgbb),xc_dhpt(1,igbbgbb))
         endif
      else if (xc_fun.eq.XC_HCTH120) then
         if (rks_sw) then
            call rks_xc_hcth120(idfun,npts,rho(1,ira),gamma(1,igaa),
     &           xc_ept,xc_vpt(1,ira),xc_dvpt(1,igaa),
     &           xc_hpt(1,irara),xc_dhpt(1,iragaa),
     &           xc_dhpt(1,igaagaa))
         else
            call uks_xc_hcth120(idfun,npts,rho(1,ira),rho(1,irb),
     &           gamma(1,igaa),gamma(1,igbb),gamma(1,igab),
     &           xc_ept,xc_vpt(1,ira),xc_vpt(1,irb),
     &           xc_dvpt(1,igaa),xc_dvpt(1,igbb),xc_dvpt(1,igab),
     &           xc_hpt(1,irara),xc_hpt(1,irbrb),xc_hpt(1,irarb),
     &           xc_dhpt(1,iragaa),xc_dhpt(1,iragab),
     &           xc_dhpt(1,iragbb),xc_dhpt(1,irbgbb),
     &           xc_dhpt(1,irbgab),xc_dhpt(1,irbgaa),
     &           xc_dhpt(1,igaagaa),xc_dhpt(1,igaagab),
     &           xc_dhpt(1,igaagbb),xc_dhpt(1,igabgab),
     &           xc_dhpt(1,igabgbb),xc_dhpt(1,igbbgbb))
         endif
      else if (xc_fun.eq.XC_HCTH147) then
         if (rks_sw) then
            call rks_xc_hcth147(idfun,npts,rho(1,ira),gamma(1,igaa),
     &           xc_ept,xc_vpt(1,ira),xc_dvpt(1,igaa),
     &           xc_hpt(1,irara),xc_dhpt(1,iragaa),
     &           xc_dhpt(1,igaagaa))
         else
            call uks_xc_hcth147(idfun,npts,rho(1,ira),rho(1,irb),
     &           gamma(1,igaa),gamma(1,igbb),gamma(1,igab),
     &           xc_ept,xc_vpt(1,ira),xc_vpt(1,irb),
     &           xc_dvpt(1,igaa),xc_dvpt(1,igbb),xc_dvpt(1,igab),
     &           xc_hpt(1,irara),xc_hpt(1,irbrb),xc_hpt(1,irarb),
     &           xc_dhpt(1,iragaa),xc_dhpt(1,iragab),
     &           xc_dhpt(1,iragbb),xc_dhpt(1,irbgbb),
     &           xc_dhpt(1,irbgab),xc_dhpt(1,irbgaa),
     &           xc_dhpt(1,igaagaa),xc_dhpt(1,igaagab),
     &           xc_dhpt(1,igaagbb),xc_dhpt(1,igabgab),
     &           xc_dhpt(1,igabgbb),xc_dhpt(1,igbbgbb))
         endif
      else if (xc_fun.eq.XC_HCTH407) then
         if (rks_sw) then
            call rks_xc_hcth407(idfun,npts,rho(1,ira),gamma(1,igaa),
     &           xc_ept,xc_vpt(1,ira),xc_dvpt(1,igaa),
     &           xc_hpt(1,irara),xc_dhpt(1,iragaa),
     &           xc_dhpt(1,igaagaa))
         else
            call uks_xc_hcth407(idfun,npts,rho(1,ira),rho(1,irb),
     &           gamma(1,igaa),gamma(1,igbb),gamma(1,igab),
     &           xc_ept,xc_vpt(1,ira),xc_vpt(1,irb),
     &           xc_dvpt(1,igaa),xc_dvpt(1,igbb),xc_dvpt(1,igab),
     &           xc_hpt(1,irara),xc_hpt(1,irbrb),xc_hpt(1,irarb),
     &           xc_dhpt(1,iragaa),xc_dhpt(1,iragab),
     &           xc_dhpt(1,iragbb),xc_dhpt(1,irbgbb),
     &           xc_dhpt(1,irbgab),xc_dhpt(1,irbgaa),
     &           xc_dhpt(1,igaagaa),xc_dhpt(1,igaagab),
     &           xc_dhpt(1,igaagbb),xc_dhpt(1,igabgab),
     &           xc_dhpt(1,igabgbb),xc_dhpt(1,igbbgbb))
         endif
      else if (xc_fun.eq.XC_KT1) then
         if (rks_sw) then
            call rks_xc_kt1(idfun,npts,rho(1,ira),gamma(1,igaa),
     &           xc_ept,xc_vpt(1,ira),xc_dvpt(1,igaa),
     &           xc_hpt(1,irara),xc_dhpt(1,iragaa),
     &           xc_dhpt(1,igaagaa))
         else
            call uks_xc_kt1(idfun,npts,rho(1,ira),rho(1,irb),
     &           gamma(1,igaa),gamma(1,igbb),gamma(1,igab),
     &           xc_ept,xc_vpt(1,ira),xc_vpt(1,irb),
     &           xc_dvpt(1,igaa),xc_dvpt(1,igbb),xc_dvpt(1,igab),
     &           xc_hpt(1,irara),xc_hpt(1,irbrb),xc_hpt(1,irarb),
     &           xc_dhpt(1,iragaa),xc_dhpt(1,iragab),
     &           xc_dhpt(1,iragbb),xc_dhpt(1,irbgbb),
     &           xc_dhpt(1,irbgab),xc_dhpt(1,irbgaa),
     &           xc_dhpt(1,igaagaa),xc_dhpt(1,igaagab),
     &           xc_dhpt(1,igaagbb),xc_dhpt(1,igabgab),
     &           xc_dhpt(1,igabgbb),xc_dhpt(1,igbbgbb))
         endif
      else if (xc_fun.eq.XC_KT2) then
         if (rks_sw) then
            call rks_xc_kt2(idfun,npts,rho(1,ira),gamma(1,igaa),
     &           xc_ept,xc_vpt(1,ira),xc_dvpt(1,igaa),
     &           xc_hpt(1,irara),xc_dhpt(1,iragaa),
     &           xc_dhpt(1,igaagaa))
         else
            call uks_xc_kt2(idfun,npts,rho(1,ira),rho(1,irb),
     &           gamma(1,igaa),gamma(1,igbb),gamma(1,igab),
     &           xc_ept,xc_vpt(1,ira),xc_vpt(1,irb),
     &           xc_dvpt(1,igaa),xc_dvpt(1,igbb),xc_dvpt(1,igab),
     &           xc_hpt(1,irara),xc_hpt(1,irbrb),xc_hpt(1,irarb),
     &           xc_dhpt(1,iragaa),xc_dhpt(1,iragab),
     &           xc_dhpt(1,iragbb),xc_dhpt(1,irbgbb),
     &           xc_dhpt(1,irbgab),xc_dhpt(1,irbgaa),
     &           xc_dhpt(1,igaagaa),xc_dhpt(1,igaagab),
     &           xc_dhpt(1,igaagbb),xc_dhpt(1,igabgab),
     &           xc_dhpt(1,igabgbb),xc_dhpt(1,igbbgbb))
         endif
      else if (xc_fun.eq.XC_MPW1K) then
         if (rks_sw) then
            call rks_xc_mpw1k(idfun,npts,rho(1,ira),gamma(1,igaa),
     &           xc_ept,xc_vpt(1,ira),xc_dvpt(1,igaa),
     &           xc_hpt(1,irara),xc_dhpt(1,iragaa),
     &           xc_dhpt(1,igaagaa))
         else
            call uks_xc_mpw1k(idfun,npts,rho(1,ira),rho(1,irb),
     &           gamma(1,igaa),gamma(1,igbb),gamma(1,igab),
     &           xc_ept,xc_vpt(1,ira),xc_vpt(1,irb),
     &           xc_dvpt(1,igaa),xc_dvpt(1,igbb),xc_dvpt(1,igab),
     &           xc_hpt(1,irara),xc_hpt(1,irbrb),xc_hpt(1,irarb),
     &           xc_dhpt(1,iragaa),xc_dhpt(1,iragab),
     &           xc_dhpt(1,iragbb),xc_dhpt(1,irbgbb),
     &           xc_dhpt(1,irbgab),xc_dhpt(1,irbgaa),
     &           xc_dhpt(1,igaagaa),xc_dhpt(1,igaagab),
     &           xc_dhpt(1,igaagbb),xc_dhpt(1,igabgab),
     &           xc_dhpt(1,igabgbb),xc_dhpt(1,igbbgbb))
         endif
      else if (xc_fun.eq.XC_MPWB1K) then
         if (rks_sw) then
            call rks_xc_mpwb1k(idfun,npts,rho(1,ira),gamma(1,igaa),
     &           tau(1,ita),xc_ept,xc_vpt(1,ira),xc_dvpt(1,igaa),
     &           xc_dtpt(1,ita),xc_hpt(1,irara),xc_dhpt(1,iragaa),
     &           xc_dhpt(1,igaagaa),xc_dfpt(1,irata),xc_dfpt(1,igaata),
     &           xc_dgpt(1,itata))
         else
            call uks_xc_mpwb1k(idfun,npts,rho(1,ira),rho(1,irb),
     &           gamma(1,igaa),gamma(1,igbb),gamma(1,igab),
     &           tau(1,ita),tau(1,itb),
     &           xc_ept,xc_vpt(1,ira),xc_vpt(1,irb),
     &           xc_dvpt(1,igaa),xc_dvpt(1,igbb),xc_dvpt(1,igab),
     &           xc_dtpt(1,ita),xc_dtpt(1,itb),
     &           xc_hpt(1,irara),xc_hpt(1,irbrb),xc_hpt(1,irarb),
     &           xc_dhpt(1,iragaa),xc_dhpt(1,iragab),
     &           xc_dhpt(1,iragbb),xc_dhpt(1,irbgbb),
     &           xc_dhpt(1,irbgab),xc_dhpt(1,irbgaa),
     &           xc_dhpt(1,igaagaa),xc_dhpt(1,igaagab),
     &           xc_dhpt(1,igaagbb),xc_dhpt(1,igabgab),
     &           xc_dhpt(1,igabgbb),xc_dhpt(1,igbbgbb),
     &           xc_dfpt(1,irata),xc_dfpt(1,iratb),
     &           xc_dfpt(1,irbta),xc_dfpt(1,irbtb),
     &           xc_dgpt(1,igaata),xc_dgpt(1,igaatb),
     &           xc_dgpt(1,igabta),xc_dgpt(1,igabtb),
     &           xc_dgpt(1,igbbta),xc_dgpt(1,igbbtb),
     &           xc_dfpt(1,itata),xc_dfpt(1,itbtb),xc_dfpt(1,itatb))
         endif
      else if (xc_fun.eq.XC_PBE) then
         if (rks_sw) then
            call rks_xc_pbe(idfun,npts,rho(1,ira),gamma(1,igaa),
     &           xc_ept,xc_vpt(1,ira),xc_dvpt(1,igaa),
     &           xc_hpt(1,irara),xc_dhpt(1,iragaa),
     &           xc_dhpt(1,igaagaa))
         else
            call uks_xc_pbe(idfun,npts,rho(1,ira),rho(1,irb),
     &           gamma(1,igaa),gamma(1,igbb),gamma(1,igab),
     &           xc_ept,xc_vpt(1,ira),xc_vpt(1,irb),
     &           xc_dvpt(1,igaa),xc_dvpt(1,igbb),xc_dvpt(1,igab),
     &           xc_hpt(1,irara),xc_hpt(1,irbrb),xc_hpt(1,irarb),
     &           xc_dhpt(1,iragaa),xc_dhpt(1,iragab),
     &           xc_dhpt(1,iragbb),xc_dhpt(1,irbgbb),
     &           xc_dhpt(1,irbgab),xc_dhpt(1,irbgaa),
     &           xc_dhpt(1,igaagaa),xc_dhpt(1,igaagab),
     &           xc_dhpt(1,igaagbb),xc_dhpt(1,igabgab),
     &           xc_dhpt(1,igabgbb),xc_dhpt(1,igbbgbb))
         endif
      else if (xc_fun.eq.XC_REVPBE) then
         if (rks_sw) then
            call rks_xc_revpbe(idfun,npts,rho(1,ira),gamma(1,igaa),
     &           xc_ept,xc_vpt(1,ira),xc_dvpt(1,igaa),
     &           xc_hpt(1,irara),xc_dhpt(1,iragaa),
     &           xc_dhpt(1,igaagaa))
         else
            call uks_xc_revpbe(idfun,npts,rho(1,ira),rho(1,irb),
     &           gamma(1,igaa),gamma(1,igbb),gamma(1,igab),
     &           xc_ept,xc_vpt(1,ira),xc_vpt(1,irb),
     &           xc_dvpt(1,igaa),xc_dvpt(1,igbb),xc_dvpt(1,igab),
     &           xc_hpt(1,irara),xc_hpt(1,irbrb),xc_hpt(1,irarb),
     &           xc_dhpt(1,iragaa),xc_dhpt(1,iragab),
     &           xc_dhpt(1,iragbb),xc_dhpt(1,irbgbb),
     &           xc_dhpt(1,irbgab),xc_dhpt(1,irbgaa),
     &           xc_dhpt(1,igaagaa),xc_dhpt(1,igaagab),
     &           xc_dhpt(1,igaagbb),xc_dhpt(1,igabgab),
     &           xc_dhpt(1,igabgbb),xc_dhpt(1,igbbgbb))
         endif
      else if (xc_fun.eq.XC_RPBE) then
         if (rks_sw) then
            call rks_xc_rpbe(idfun,npts,rho(1,ira),gamma(1,igaa),
     &           xc_ept,xc_vpt(1,ira),xc_dvpt(1,igaa),
     &           xc_hpt(1,irara),xc_dhpt(1,iragaa),
     &           xc_dhpt(1,igaagaa))
         else
            call uks_xc_rpbe(idfun,npts,rho(1,ira),rho(1,irb),
     &           gamma(1,igaa),gamma(1,igbb),gamma(1,igab),
     &           xc_ept,xc_vpt(1,ira),xc_vpt(1,irb),
     &           xc_dvpt(1,igaa),xc_dvpt(1,igbb),xc_dvpt(1,igab),
     &           xc_hpt(1,irara),xc_hpt(1,irbrb),xc_hpt(1,irarb),
     &           xc_dhpt(1,iragaa),xc_dhpt(1,iragab),
     &           xc_dhpt(1,iragbb),xc_dhpt(1,irbgbb),
     &           xc_dhpt(1,irbgab),xc_dhpt(1,irbgaa),
     &           xc_dhpt(1,igaagaa),xc_dhpt(1,igaagab),
     &           xc_dhpt(1,igaagbb),xc_dhpt(1,igabgab),
     &           xc_dhpt(1,igabgbb),xc_dhpt(1,igbbgbb))
         endif
      else if (xc_fun.eq.XC_PW91) then
         if (rks_sw) then
            call rks_xc_pw91(idfun,npts,rho(1,ira),gamma(1,igaa),
     &           xc_ept,xc_vpt(1,ira),xc_dvpt(1,igaa),
     &           xc_hpt(1,irara),xc_dhpt(1,iragaa),
     &           xc_dhpt(1,igaagaa))
         else
            call uks_xc_pw91(idfun,npts,rho(1,ira),rho(1,irb),
     &           gamma(1,igaa),gamma(1,igbb),gamma(1,igab),
     &           xc_ept,xc_vpt(1,ira),xc_vpt(1,irb),
     &           xc_dvpt(1,igaa),xc_dvpt(1,igbb),xc_dvpt(1,igab),
     &           xc_hpt(1,irara),xc_hpt(1,irbrb),xc_hpt(1,irarb),
     &           xc_dhpt(1,iragaa),xc_dhpt(1,iragab),
     &           xc_dhpt(1,iragbb),xc_dhpt(1,irbgbb),
     &           xc_dhpt(1,irbgab),xc_dhpt(1,irbgaa),
     &           xc_dhpt(1,igaagaa),xc_dhpt(1,igaagab),
     &           xc_dhpt(1,igaagbb),xc_dhpt(1,igabgab),
     &           xc_dhpt(1,igabgbb),xc_dhpt(1,igbbgbb))
         endif
c        if (rks_sw) then
c           if (idfun.le.0) then
c              call calc_b3lyp_e(npts,rho(1,ira),gamma(1,igaa),xc_ept)
c           else if (idfun.le.1) then
c              call calc_b3lyp_de(npts,rho(1,ira),gamma(1,igaa),
c    &              xc_ept,xc_vpt(1,ira),xc_dvpt(1,igaa))
c           else if (idfun.le.2) then
c              call calc_b3lyp_d2e(npts,rho(1,ira),gamma(1,igaa),
c    &              xc_ept,xc_vpt(1,ira),xc_dvpt(1,igaa),
c    &              xc_hpt(1,irara),xc_dhpt(1,iragaa),
c    &              xc_dhpt(1,igaagaa))
c           endif
c        else
c           if (idfun.le.0) then
c              call calc_ub3lyp_e(npts,rho(1,ira),rho(1,irb),
c    &              gamma(1,igaa),gamma(1,igbb),gamma(1,igab),
c    &              xc_ept)
c           else if (idfun.le.1) then
c              call calc_ub3lyp_de(npts,rho(1,ira),rho(1,irb),
c    &              gamma(1,igaa),gamma(1,igbb),gamma(1,igab),
c    &              xc_ept,xc_vpt(1,ira),xc_vpt(1,irb),
c    &              xc_dvpt(1,igaa),xc_dvpt(1,igbb),xc_dvpt(1,igab))
c           else if (idfun.le.2) then
c              call calc_ub3lyp_d2e(npts,rho(1,ira),rho(1,irb),
c    &              gamma(1,igaa),gamma(1,igbb),gamma(1,igab),
c    &              xc_ept,xc_vpt(1,ira),xc_vpt(1,irb),
c    &              xc_dvpt(1,igaa),xc_dvpt(1,igbb),xc_dvpt(1,igab),
c    &              xc_hpt(1,irara),xc_hpt(1,irbrb),xc_hpt(1,irarb),
c    &              xc_dhpt(1,iragaa),xc_dhpt(1,iragab),
c    &              xc_dhpt(1,iragbb),xc_dhpt(1,irbgbb),
c    &              xc_dhpt(1,irbgab),xc_dhpt(1,irbgaa),
c    &              xc_dhpt(1,igaagaa),xc_dhpt(1,igaagab),
c    &              xc_dhpt(1,igaagbb),xc_dhpt(1,igabgab),
c    &              xc_dhpt(1,igabgbb),xc_dhpt(1,igbbgbb))
c           endif
c        endif
c     else if (xc_fun.eq.XC_HCTH) then
      else
         call caserr(
     &        "xcfunc: Illegal exchange-correlation functional id")
      endif
c
      end
c
c-----------------------------------------------------------------------
c
      subroutine uks_zero
     & (ideriv,npt,rhoa1,rhob1,sigmaaa1,sigmabb1,sigmaab1,
     &  taua1,taub1,
     &  zk,vrhoa,vrhob,vsigmaaa,vsigmabb,vsigmaab,
     &  vtaua,vtaub,
     &  v2rhoa2,v2rhob2,v2rhoab,
     &  v2rhoasigmaaa,v2rhoasigmaab,v2rhoasigmabb,
     &  v2rhobsigmabb,v2rhobsigmaab,v2rhobsigmaaa,
     &  v2sigmaaa2,v2sigmaaaab,v2sigmaaabb,
     &  v2sigmaab2,v2sigmaabbb,v2sigmabb2)
      implicit none
      integer ideriv,npt
      REAL rhoa1(npt),rhob1(npt)
      REAL sigmaaa1(npt),sigmabb1(npt),sigmaab1(npt)
      REAL taua1(npt),taub1(npt)
      REAL zk(npt),vrhoa(npt),vrhob(npt)
      REAL vsigmaaa(npt),vsigmabb(npt),vsigmaab(npt)
      REAL vtaua(npt),vtaub(npt)
      REAL v2rhoa2(npt),v2rhob2(npt),v2rhoab(npt)
      REAL v2rhoasigmaaa(npt),v2rhoasigmaab(npt)
      REAL v2rhoasigmabb(npt),v2rhobsigmabb(npt)
      REAL v2rhobsigmaab(npt),v2rhobsigmaaa(npt)
      REAL v2sigmaaa2(npt),v2sigmaaaab(npt),v2sigmaaabb(npt)
      REAL v2sigmaab2(npt),v2sigmaabbb(npt),v2sigmabb2(npt)
INCLUDE(common/dft_xcfunc)
c
      if (ideriv.ge.0) then
         call aclear_dp(zk,npt,0.0d0)
      endif
      if (ideriv.ge.1) then
         call aclear_dp(vrhoa,npt,0.0d0)
         call aclear_dp(vrhob,npt,0.0d0)
         if (gradcorr_sw) then
            call aclear_dp(vsigmaaa,npt,0.0d0)
            call aclear_dp(vsigmaab,npt,0.0d0)
            call aclear_dp(vsigmabb,npt,0.0d0)
         endif
         if (kinetic_sw) then
            call aclear_dp(vtaua,npt,0.0d0)
            call aclear_dp(vtaub,npt,0.0d0)
         endif
      endif
      if (ideriv.ge.2) then
         call aclear_dp(v2rhoa2,npt,0.0d0)
         call aclear_dp(v2rhoab,npt,0.0d0)
         call aclear_dp(v2rhob2,npt,0.0d0)
         if (gradcorr_sw) then
            call aclear_dp(v2rhoasigmaaa,npt,0.0d0)
            call aclear_dp(v2rhoasigmaab,npt,0.0d0)
            call aclear_dp(v2rhoasigmabb,npt,0.0d0)
            call aclear_dp(v2rhobsigmaaa,npt,0.0d0)
            call aclear_dp(v2rhobsigmaab,npt,0.0d0)
            call aclear_dp(v2rhobsigmabb,npt,0.0d0)
            call aclear_dp(v2sigmaaa2,npt,0.0d0)
            call aclear_dp(v2sigmaab2,npt,0.0d0)
            call aclear_dp(v2sigmabb2,npt,0.0d0)
            call aclear_dp(v2sigmaaaab,npt,0.0d0)
            call aclear_dp(v2sigmaaabb,npt,0.0d0)
            call aclear_dp(v2sigmaabbb,npt,0.0d0)
         endif
      endif
c
      return
      end
c
c-----------------------------------------------------------------------
c
      subroutine rks_zero
     & (ideriv,npt,rhoa1,sigmaaa1,tau1,
     &  zk,vrhoa,vsigmaaa,vtaua,
     &  v2rhoa2,v2rhoasigmaaa,v2sigmaaa2)
      implicit none
      integer ideriv,npt
      REAL rhoa1(npt)
      REAL sigmaaa1(npt)
      REAL tau1(npt)
      REAL zk(npt),vrhoa(npt),vsigmaaa(npt),vtaua(npt)
      REAL v2rhoa2(npt),v2rhoasigmaaa(npt),v2sigmaaa2(npt)
INCLUDE(common/dft_xcfunc)
c
      if (ideriv.ge.0) then
         call aclear_dp(zk,npt,0.0d0)
      endif
      if (ideriv.ge.1) then
         call aclear_dp(vrhoa,npt,0.0d0)
         if (gradcorr_sw) then
            call aclear_dp(vsigmaaa,npt,0.0d0)
         endif
         if (kinetic_sw) then
            call aclear_dp(vtaua,npt,0.0d0)
         endif
      endif
      if (ideriv.ge.2) then
         call aclear_dp(v2rhoa2,npt,0.0d0)
         if (gradcorr_sw) then
            call aclear_dp(v2rhoasigmaaa,npt,0.0d0)
            call aclear_dp(v2sigmaaa2,npt,0.0d0)
         endif
      endif
c
      return
      end
_ENDIF
_IF(ccpdft,all,xc_ft97)
      subroutine uks_xc_ft97
     & (ideriv,npt,rhoa1,rhob1,sigmaaa1,sigmabb1,sigmaab1,
     &  zk,vrhoa,vrhob,vsigmaaa,vsigmabb,vsigmaab,
     &  v2rhoa2,v2rhob2,v2rhoab,
     &  v2rhoasigmaaa,v2rhoasigmaab,v2rhoasigmabb,
     &  v2rhobsigmabb,v2rhobsigmaab,v2rhobsigmaaa,
     &  v2sigmaaa2,v2sigmaaaab,v2sigmaaabb,
     &  v2sigmaab2,v2sigmaabbb,v2sigmabb2)
c
c     M. Filatov, and W. Thiel
c     A nonlocal correlation energy density functional from a Coulomb
c     hole model
c     Int. J. Quant. Chem. 62 (1997) 603-616
c
c     M. Filatov, and W. Thiel
c     A new gradient-corrected exchange-correlation density functional
c     Mol. Phys. 91 (1997) 847-859
c
INCLUDE(common/citation)
      implicit none
      integer ideriv,npt
      REAL rhoa1(npt),rhob1(npt)
      REAL sigmaaa1(npt),sigmabb1(npt),sigmaab1(npt)
      REAL zk(npt),vrhoa(npt),vrhob(npt)
      REAL vsigmaaa(npt),vsigmabb(npt),vsigmaab(npt)
      REAL v2rhoa2(npt),v2rhob2(npt),v2rhoab(npt)
      REAL v2rhoasigmaaa(npt),v2rhoasigmaab(npt)
      REAL v2rhoasigmabb(npt),v2rhobsigmabb(npt)
      REAL v2rhobsigmaab(npt),v2rhobsigmaaa(npt)
      REAL v2sigmaaa2(npt),v2sigmaaaab(npt),v2sigmaaabb(npt)
      REAL v2sigmaab2(npt),v2sigmaabbb(npt),v2sigmabb2(npt)
c
      integer mpt,i
      parameter(mpt=200)
      REAL tk(mpt),trhoa(mpt),trhob(mpt)
      REAL tsigmaaa(mpt),tsigmabb(mpt),tsigmaab(mpt)
      REAL t2rhoa2(mpt),t2rhob2(mpt),t2rhoab(mpt)
      REAL t2rhoasigmaaa(mpt),t2rhoasigmaab(mpt)
      REAL t2rhoasigmabb(mpt),t2rhobsigmabb(mpt)
      REAL t2rhobsigmaab(mpt),t2rhobsigmaaa(mpt)
      REAL t2sigmaaa2(mpt),t2sigmaaaab(mpt),t2sigmaaabb(mpt)
      REAL t2sigmaab2(mpt),t2sigmaabbb(mpt),t2sigmabb2(mpt)
c
      if (npt.gt.mpt) then
         write(*,*)'*** ERROR: npt.gt.mpt re-parametrize'
      endif
c
c     Clearly there is a problem here. The above mucking about
c     with temporary arrays is a terrible hack. Please adjust this
c     in a way suitable to your own code.
c
      call uks_x_ft97b
     & (ideriv,npt,rhoa1,rhob1,sigmaaa1,sigmabb1,sigmaab1,
     &  zk,vrhoa,vrhob,vsigmaaa,vsigmabb,vsigmaab,
     &  v2rhoa2,v2rhob2,v2rhoab,
     &  v2rhoasigmaaa,v2rhoasigmaab,v2rhoasigmabb,
     &  v2rhobsigmabb,v2rhobsigmaab,v2rhobsigmaaa,
     &  v2sigmaaa2,v2sigmaaaab,v2sigmaaabb,
     &  v2sigmaab2,v2sigmaabbb,v2sigmabb2)
      call uks_c_ft97
     & (ideriv,npt,rhoa1,rhob1,sigmaaa1,sigmabb1,sigmaab1,
     &  tk,trhoa,trhob,tsigmaaa,tsigmabb,tsigmaab,
     &  t2rhoa2,t2rhob2,t2rhoab,
     &  t2rhoasigmaaa,t2rhoasigmaab,t2rhoasigmabb,
     &  t2rhobsigmabb,t2rhobsigmaab,t2rhobsigmaaa,
     &  t2sigmaaa2,t2sigmaaaab,t2sigmaaabb,
     &  t2sigmaab2,t2sigmaabbb,t2sigmabb2)
c
      do i=1,npt
         zk(i)=zk(i)+tk(i)
         if (ideriv.ge.1) then
            vrhoa(i)=vrhoa(i)+trhoa(i)
            vrhob(i)=vrhob(i)+trhob(i)
            vsigmaaa(i)=vsigmaaa(i)+tsigmaaa(i)
            vsigmaab(i)=vsigmaab(i)+tsigmaab(i)
            vsigmabb(i)=vsigmabb(i)+tsigmabb(i)
         endif
         if (ideriv.ge.2) then
            v2rhoa2(i)=v2rhoa2(i)+t2rhoa2(i)
            v2rhob2(i)=v2rhob2(i)+t2rhob2(i)
            v2rhoab(i)=v2rhoab(i)+t2rhoab(i)
            v2rhoasigmaaa(i)=v2rhoasigmaaa(i)+t2rhoasigmaaa(i)
            v2rhoasigmaab(i)=v2rhoasigmaab(i)+t2rhoasigmaab(i)
            v2rhoasigmabb(i)=v2rhoasigmabb(i)+t2rhoasigmabb(i)
            v2rhobsigmaaa(i)=v2rhobsigmaaa(i)+t2rhobsigmaaa(i)
            v2rhobsigmaab(i)=v2rhobsigmaab(i)+t2rhobsigmaab(i)
            v2rhobsigmabb(i)=v2rhobsigmabb(i)+t2rhobsigmabb(i)
            v2sigmaaa2(i)=v2sigmaaa2(i)+t2sigmaaa2(i)
            v2sigmaab2(i)=v2sigmaab2(i)+t2sigmaab2(i)
            v2sigmabb2(i)=v2sigmabb2(i)+t2sigmabb2(i)
            v2sigmaaaab(i)=v2sigmaaaab(i)+t2sigmaaaab(i)
            v2sigmaaabb(i)=v2sigmaaabb(i)+t2sigmaaabb(i)
            v2sigmaabbb(i)=v2sigmaabbb(i)+t2sigmaabbb(i)
         endif
      enddo
c
      return
      end
c
      subroutine rks_xc_ft97
     & (ideriv,npt,rhoa1,sigmaaa1,
     &  zk,vrhoa,vsigmaaa,
     &  v2rhoa2,v2rhoasigmaaa,v2sigmaaa2)
c
c     M. Filatov, and W. Thiel
c     A nonlocal correlation energy density functional from a
c     Coulomb hole model
c     Int. J. Quant. Chem. 62 (1997) 603-616
c
c     M. Filatov, and W. Thiel
c     A new gradient-corrected exchange-correlation density functional
c     Mol. Phys. 91 (1997) 847-859
c
INCLUDE(common/citation)
      implicit none
      integer ideriv,npt
      REAL rhoa1(npt)
      REAL sigmaaa1(npt)
      REAL zk(npt),vrhoa(npt),vsigmaaa(npt)
      REAL v2rhoa2(npt),v2rhoasigmaaa(npt),v2sigmaaa2(npt)
c
      integer mpt,i
      parameter(mpt=200)
      REAL tk(mpt),trhoa(mpt),tsigmaaa(mpt)
      REAL t2rhoa2(mpt),t2rhoasigmaaa(mpt),t2sigmaaa2(mpt)
c
      if (npt.gt.mpt) then
         write(*,*)'*** ERROR: npt.gt.mpt re-parametrize'
      endif
c
c     Clearly there is a problem here. The above mucking about
c     with temporary arrays is a terrible hack. Please adjust this
c     in a way suitable to your own code.
c
      call rks_x_ft97b
     & (ideriv,npt,rhoa1,sigmaaa1,
     &  zk,vrhoa,vsigmaaa,
     &  v2rhoa2,v2rhoasigmaaa,v2sigmaaa2)
      call rks_c_ft97
     & (ideriv,npt,rhoa1,sigmaaa1,
     &  tk,trhoa,tsigmaaa,
     &  t2rhoa2,t2rhoasigmaaa,t2sigmaaa2)
c
      do i=1,npt
         zk(i)=zk(i)+tk(i)
         if (ideriv.ge.1) then
            vrhoa(i)=vrhoa(i)+trhoa(i)
            vsigmaaa(i)=vsigmaaa(i)+tsigmaaa(i)
         endif
         if (ideriv.ge.2) then
            v2rhoa2(i)=v2rhoa2(i)+t2rhoa2(i)
            v2rhoasigmaaa(i)=v2rhoasigmaaa(i)+t2rhoasigmaaa(i)
            v2sigmaaa2(i)=v2sigmaaa2(i)+t2sigmaaa2(i)
         endif
      enddo
c
      return
      end
_ENDIF
_IF(ccpdft,all,c_pbe)
c:C_PBEsubrstart

c    Generated: Wed Sep  3 12:41:37 GMT 2003

      subroutine uks_c_pbe
     & (ideriv,npt,rhoa1,rhob1,sigmaaa1,sigmabb1,sigmaab1,
     &  zk,vrhoa,vrhob,vsigmaaa,vsigmabb,vsigmaab,
     &  v2rhoa2,v2rhob2,v2rhoab,
     &  v2rhoasigmaaa,v2rhoasigmaab,v2rhoasigmabb,
     &  v2rhobsigmabb,v2rhobsigmaab,v2rhobsigmaaa,
     &  v2sigmaaa2,v2sigmaaaab,v2sigmaaabb,
     &  v2sigmaab2,v2sigmaabbb,v2sigmabb2)
c
c     J.P. Perdew, K. Burke, and M. Ernzerhof
c     Generalized gradient approximation made simple
c     Phys. Rev. Lett. 77 (1996) 3865-3868
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt),rhob1(npt)
      REAL sigmaaa1(npt),sigmabb1(npt),sigmaab1(npt)
      REAL zk(npt),vrhoa(npt),vrhob(npt)
      REAL vsigmaaa(npt),vsigmabb(npt),vsigmaab(npt)
      REAL v2rhoa2(npt),v2rhob2(npt),v2rhoab(npt)
      REAL v2rhoasigmaaa(npt),v2rhoasigmaab(npt)
      REAL v2rhoasigmabb(npt),v2rhobsigmabb(npt)
      REAL v2rhobsigmaab(npt),v2rhobsigmaaa(npt)
      REAL v2sigmaaa2(npt),v2sigmaaaab(npt),v2sigmaaabb(npt)
      REAL v2sigmaab2(npt),v2sigmaabbb(npt),v2sigmabb2(npt)
      parameter(tol=1.0d-20)
      
      if (ideriv.eq.0) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = 1/rhob
      t3 = t2**(1.D0/3.D0)
      t6 = t2**(1.D0/6.D0)
      t9 = dsqrt(t2)
      t11 = t3**2
      t17 = dlog(1.D0+0.3216395899738507D2/(0.1112037486309468D2*t6
     #+0.3844746237447211D1*t3+0.1644733775567609D1*t9
     #+0.2405871291288192D0*t11))
      t18 = (1.D0+0.1274696188700087D0*t3)*t17
      t20 = rhob**2
      t21 = rhob**(1.D0/3.D0)
      t23 = 1/t21/t20
      t26 = dexp(0.2000000587336264D1*t18)
      t27 = t26-1.D0
      t31 = 0.2162211495206379D0/t27*sigmabb*t23
      t33 = t27**2
      t35 = sigmabb**2
      t37 = t20**2
      t38 = t21**2
      t49 = dlog(1.D0+0.2162211495206379D0*sigmabb*t23*(1.D0+t31)/
     #(1.D0+t31+0.4675158550002605D-1/t33*t35/t38/t37))
      zk(i) = rhob*(-0.310907D-1*t18+0.1554534543482745D-1*t49)
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = 1/rhoa
      t3 = t2**(1.D0/3.D0)
      t6 = t2**(1.D0/6.D0)
      t9 = dsqrt(t2)
      t11 = t3**2
      t17 = dlog(1.D0+0.3216395899738507D2/(0.1112037486309468D2*t6
     #+0.3844746237447211D1*t3+0.1644733775567609D1*t9
     #+0.2405871291288192D0*t11))
      t18 = (1.D0+0.1274696188700087D0*t3)*t17
      t20 = rhoa**2
      t21 = rhoa**(1.D0/3.D0)
      t23 = 1/t21/t20
      t26 = dexp(0.2000000587336264D1*t18)
      t27 = t26-1.D0
      t31 = 0.2162211495206379D0/t27*sigmaaa*t23
      t33 = t27**2
      t35 = sigmaaa**2
      t37 = t20**2
      t38 = t21**2
      t49 = dlog(1.D0+0.2162211495206379D0*sigmaaa*t23*(1.D0+t31)/
     #(1.D0+t31+0.4675158550002605D-1/t33*t35/t38/t37))
      zk(i) = rhoa*(-0.310907D-1*t18+0.1554534543482745D-1*t49)
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = 1/rho
      t5 = t4**(1.D0/3.D0)
      t8 = t4**(1.D0/6.D0)
      t11 = dsqrt(t4)
      t13 = t5**2
      t19 = dlog(1.D0+0.1608197949869254D2/(0.598255043577108D1*t8
     #+0.2225569421150687D1*t5+0.8004286349993634D0*t11
     #+0.1897004325747559D0*t13))
      t21 = 0.621814D-1*(1.D0+0.1325688999052018D0*t5)*t19
      t32 = dlog(1.D0+0.2960874997779344D2/(0.8157414703487641D1*t8
     #+0.2247591863577616D1*t5+0.4300972471276643D0*t11
     #+0.1911512595127338D0*t13))
      t35 = rhoa-1.D0*rhob
      t36 = t35*t4
      t37 = 1.D0+t36
      t38 = t37**(1.D0/3.D0)
      t41 = 1.D0-1.D0*t36
      t42 = t41**(1.D0/3.D0)
      t44 = t38*t37+t42*t41-2.D0
      t45 = t35**2
      t46 = t45**2
      t47 = rho**2
      t48 = t47**2
      t50 = t46/t48
      t55 = 0.37995525D-1*(1.D0+0.6901399211255825D-1*t5)*t32*t44*
     #(1.D0-1.D0*t50)
      t66 = dlog(1.D0+0.3216395899738507D2/(0.1112037486309468D2*t8
     #+0.3844746237447211D1*t5+0.1644733775567609D1*t11
     #+0.2405871291288192D0*t13))
      t72 = 0.1923661050931536D1*(-0.310907D-1*(1.D0
     #+0.1274696188700087D0*t5)*t66+t21)*t44*t50
      t73 = t38**2
      t75 = t42**2
      t77 = 0.5D0*t73+0.5D0*t75
      t78 = t77**2
      t79 = t78*t77
      t80 = 1/t78
      t82 = rho**(1.D0/3.D0)
      t84 = 1/t82/t47
      t89 = dexp(-0.3216396844291482D2*(-t21+t55+t72)/t79)
      t90 = t89-1.D0
      t95 = 0.1362107888567592D0/t90*sigma*t80*t84
      t98 = t90**2
      t100 = sigma**2
      t102 = t78**2
      t104 = t82**2
      t116 = dlog(1.D0+0.1362107888567592D0*sigma*t80*t84*(1.D0+t95)/
     #(1.D0+t95+0.1855337900098064D-1/t98*t100/t102/t104/t48))
      zk(i) = rho*(-t21+t55+t72+0.310906908696549D-1*t79*t116)
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = 1/rhob
      t3 = t2**(1.D0/3.D0)
      t5 = 1.D0+0.1274696188700087D0*t3
      t6 = t2**(1.D0/6.D0)
      t9 = dsqrt(t2)
      t11 = t3**2
      t13 = 0.1112037486309468D2*t6+0.3844746237447211D1*t3
     #+0.1644733775567609D1*t9+0.2405871291288192D0*t11
      t16 = 1.D0+0.3216395899738507D2/t13
      t17 = dlog(t16)
      t18 = t5*t17
      t19 = 0.310907D-1*t18
      t20 = rhob**2
      t21 = rhob**(1.D0/3.D0)
      t23 = 1/t21/t20
      t24 = sigmabb*t23
      t26 = dexp(0.2000000587336264D1*t18)
      t27 = t26-1.D0
      t28 = 1/t27
      t29 = t28*sigmabb
      t31 = 0.2162211495206379D0*t29*t23
      t32 = 1.D0+t31
      t33 = t27**2
      t34 = 1/t33
      t35 = sigmabb**2
      t36 = t34*t35
      t37 = t20**2
      t38 = t21**2
      t40 = 1/t38/t37
      t41 = t36*t40
      t43 = 1.D0+t31+0.4675158550002605D-1*t41
      t44 = 1/t43
      t45 = t32*t44
      t48 = 1.D0+0.2162211495206379D0*t24*t45
      t49 = dlog(t48)
      t50 = 0.1554534543482745D-1*t49
      zk(i) = rhob*(-t19+t50)
      vrhoa(i) = 0.D0
      t54 = 1/t21/t20/rhob
      t60 = 1/t38/t37/rhob
      t62 = t28*t44
      t65 = t43**2
      t67 = t32/t65
      t78 = 1/t48
      t82 = 1/t20
      t83 = 1/t11*t82
      t84 = t83*t17
      t86 = t13**2
      t89 = t6**2
      t90 = t89**2
      t105 = t5/t86*(-0.1853395810515781D1/t90/t6*t82
     #-0.128158207914907D1*t83-0.8223668877838045D0/t9*t82
     #-0.1603914194192128D0/t3*t82)/t16
      t109 = -0.8497977086918237D-1*t84-0.6432793688582964D2*t105
      t114 = t34*sigmabb
      vrhob(i) = -t19+t50+0.1554534543482745D-1*rhob*(
     #-0.5045160155481551D0*sigmabb*t54*t45-0.1090870328333941D0*t35
     #*t60*t62-0.2162211495206379D0*t24*t67*(-0.5045160155481551D0*t29
     #*t54-0.2181740656667882D0*t36*t60))*t78+rhob*
     #(0.1321039893133927D-2*t84+0.1D1*t105+0.1554534543482745D-1*(
     #-0.4675158550002605D-1*t41*t109*t26*t44-0.2162211495206379D0*t24
     #*t67*(-0.2162211495206379D0*t114*t23*t109*t26
     #-0.935031710000521D-1/t33/t27*t35*t40*t109*t26))*t78)
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.1554534543482745D-1*rhob*(0.2162211495206379D0
     #*t23*t32*t44+0.4675158550002605D-1*sigmabb*t40*t62
     #-0.2162211495206379D0*t24*t67*(0.2162211495206379D0*t28*t23
     #+0.935031710000521D-1*t114*t40))*t78
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = 1/rhoa
      t3 = t2**(1.D0/3.D0)
      t5 = 1.D0+0.1274696188700087D0*t3
      t6 = t2**(1.D0/6.D0)
      t9 = dsqrt(t2)
      t11 = t3**2
      t13 = 0.1112037486309468D2*t6+0.3844746237447211D1*t3
     #+0.1644733775567609D1*t9+0.2405871291288192D0*t11
      t16 = 1.D0+0.3216395899738507D2/t13
      t17 = dlog(t16)
      t18 = t5*t17
      t19 = 0.310907D-1*t18
      t20 = rhoa**2
      t21 = rhoa**(1.D0/3.D0)
      t23 = 1/t21/t20
      t24 = sigmaaa*t23
      t26 = dexp(0.2000000587336264D1*t18)
      t27 = t26-1.D0
      t28 = 1/t27
      t29 = t28*sigmaaa
      t31 = 0.2162211495206379D0*t29*t23
      t32 = 1.D0+t31
      t33 = t27**2
      t34 = 1/t33
      t35 = sigmaaa**2
      t36 = t34*t35
      t37 = t20**2
      t38 = t21**2
      t40 = 1/t38/t37
      t41 = t36*t40
      t43 = 1.D0+t31+0.4675158550002605D-1*t41
      t44 = 1/t43
      t45 = t32*t44
      t48 = 1.D0+0.2162211495206379D0*t24*t45
      t49 = dlog(t48)
      t50 = 0.1554534543482745D-1*t49
      zk(i) = rhoa*(-t19+t50)
      t54 = 1/t21/t20/rhoa
      t60 = 1/t38/t37/rhoa
      t62 = t28*t44
      t65 = t43**2
      t67 = t32/t65
      t78 = 1/t48
      t82 = 1/t20
      t83 = 1/t11*t82
      t84 = t83*t17
      t86 = t13**2
      t89 = t6**2
      t90 = t89**2
      t105 = t5/t86*(-0.1853395810515781D1/t90/t6*t82
     #-0.128158207914907D1*t83-0.8223668877838045D0/t9*t82
     #-0.1603914194192128D0/t3*t82)/t16
      t109 = -0.8497977086918237D-1*t84-0.6432793688582964D2*t105
      t114 = t34*sigmaaa
      vrhoa(i) = -t19+t50+0.1554534543482745D-1*rhoa*(
     #-0.5045160155481551D0*sigmaaa*t54*t45-0.1090870328333941D0*t35
     #*t60*t62-0.2162211495206379D0*t24*t67*(-0.5045160155481551D0*t29
     #*t54-0.2181740656667882D0*t36*t60))*t78+rhoa*
     #(0.1321039893133927D-2*t84+0.1D1*t105+0.1554534543482745D-1*(
     #-0.4675158550002605D-1*t41*t109*t26*t44-0.2162211495206379D0*t24
     #*t67*(-0.2162211495206379D0*t114*t23*t109*t26
     #-0.935031710000521D-1/t33/t27*t35*t40*t109*t26))*t78)
      vrhob(i) = 0.D0
      vsigmaaa(i) = 0.1554534543482745D-1*rhoa*(0.2162211495206379D0
     #*t23*t32*t44+0.4675158550002605D-1*sigmaaa*t40*t62
     #-0.2162211495206379D0*t24*t67*(0.2162211495206379D0*t28*t23
     #+0.935031710000521D-1*t114*t40))*t78
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = 1/rho
      t5 = t4**(1.D0/3.D0)
      t7 = 1.D0+0.1325688999052018D0*t5
      t8 = t4**(1.D0/6.D0)
      t11 = dsqrt(t4)
      t13 = t5**2
      t15 = 0.598255043577108D1*t8+0.2225569421150687D1*t5
     #+0.8004286349993634D0*t11+0.1897004325747559D0*t13
      t18 = 1.D0+0.1608197949869254D2/t15
      t19 = dlog(t18)
      t21 = 0.621814D-1*t7*t19
      t23 = 1.D0+0.6901399211255825D-1*t5
      t28 = 0.8157414703487641D1*t8+0.2247591863577616D1*t5
     #+0.4300972471276643D0*t11+0.1911512595127338D0*t13
      t31 = 1.D0+0.2960874997779344D2/t28
      t32 = dlog(t31)
      t33 = t23*t32
      t35 = rhoa-1.D0*rhob
      t36 = t35*t4
      t37 = 1.D0+t36
      t38 = t37**(1.D0/3.D0)
      t41 = 1.D0-1.D0*t36
      t42 = t41**(1.D0/3.D0)
      t44 = t38*t37+t42*t41-2.D0
      t45 = t35**2
      t46 = t45**2
      t47 = rho**2
      t48 = t47**2
      t49 = 1/t48
      t50 = t46*t49
      t52 = 1.D0-1.D0*t50
      t55 = 0.37995525D-1*t33*t44*t52
      t57 = 1.D0+0.1274696188700087D0*t5
      t62 = 0.1112037486309468D2*t8+0.3844746237447211D1*t5
     #+0.1644733775567609D1*t11+0.2405871291288192D0*t13
      t65 = 1.D0+0.3216395899738507D2/t62
      t66 = dlog(t65)
      t69 = -0.310907D-1*t57*t66+t21
      t70 = t69*t44
      t72 = 0.1923661050931536D1*t70*t50
      t73 = t38**2
      t75 = t42**2
      t77 = 0.5D0*t73+0.5D0*t75
      t78 = t77**2
      t79 = t78*t77
      t80 = 1/t78
      t81 = sigma*t80
      t82 = rho**(1.D0/3.D0)
      t84 = 1/t82/t47
      t85 = -t21+t55+t72
      t86 = 1/t79
      t89 = dexp(-0.3216396844291482D2*t85*t86)
      t90 = t89-1.D0
      t91 = 1/t90
      t92 = t91*sigma
      t93 = t80*t84
      t95 = 0.1362107888567592D0*t92*t93
      t96 = 1.D0+t95
      t98 = t90**2
      t99 = 1/t98
      t100 = sigma**2
      t101 = t99*t100
      t102 = t78**2
      t103 = 1/t102
      t104 = t82**2
      t106 = 1/t104/t48
      t107 = t103*t106
      t110 = 1.D0+t95+0.1855337900098064D-1*t101*t107
      t111 = 1/t110
      t115 = 1.D0+0.1362107888567592D0*t81*t84*t96*t111
      t116 = dlog(t115)
      t118 = 0.310906908696549D-1*t79*t116
      zk(i) = rho*(-t21+t55+t72+t118)
      t124 = 0.1333333333333333D1*t38*t4-0.1333333333333333D1*t42*t4
      t127 = 0.37995525D-1*t33*t124*t52
      t128 = t45*t35
      t131 = t33*t44*t128*t49
      t132 = 0.1519821D0*t131
      t135 = 0.1923661050931536D1*t69*t124*t50
      t137 = t70*t128*t49
      t138 = 0.7694644203726145D1*t137
      t139 = t78*t116
      t140 = 1/t38
      t143 = 1/t42
      t146 = 0.3333333333333333D0*t140*t4-0.3333333333333333D0*t143*t4
      t150 = sigma*t86*t84
      t151 = t96*t111
      t155 = t99*sigma
      t156 = t155*t80
      t160 = t85*t103
      t163 = -0.3216396844291482D2*(t127-t132+t135+t138)*t86
     #+0.9649190532874446D2*t160*t146
      t167 = 0.1362107888567592D0*t156*t84*t163*t89
      t168 = t86*t84
      t171 = 0.2724215777135184D0*t92*t168*t146
      t177 = t81*t84
      t178 = t110**2
      t180 = t96/t178
      t184 = 1/t98/t90*t100*t103
      t191 = 1/t102/t77*t106
      t201 = 1/t115
      t207 = 1/t47
      t208 = 1/t13*t207
      t209 = t208*t19
      t210 = 0.2747773264188438D-2*t209
      t211 = t15**2
      t214 = t8**2
      t215 = t214**2
      t218 = 1/t215/t8*t207
      t222 = 1/t11*t207
      t225 = 1/t5*t207
      t230 = t7/t211*(-0.99709173929518D0*t218-0.7418564737168958D0
     #*t208-0.4002143174996817D0*t222-0.1264669550498372D0*t225)/t18
      t231 = 0.1D1*t230
      t235 = 0.87407428755417D-3*t208*t32*t44*t52
      t236 = t28**2
      t249 = 0.1125D1*t23/t236*(-0.135956911724794D1*t218
     #-0.7491972878592054D0*t208-0.2150486235638321D0*t222
     #-0.1274341730084892D0*t225)/t31*t44*t52
      t256 = -0.1333333333333333D1*t38*t35*t207+0.1333333333333333D1
     #*t42*t35*t207
      t259 = 0.37995525D-1*t33*t256*t52
      t261 = t48*rho
      t262 = 1/t261
      t265 = 0.1519821D0*t33*t44*t46*t262
      t268 = t62**2
      t285 = 0.1923661050931536D1*(0.1321039893133927D-2*t208*t66
     #+0.1D1*t57/t268*(-0.1853395810515781D1*t218-0.128158207914907D1
     #*t208-0.8223668877838045D0*t222-0.1603914194192128D0*t225)/t65
     #-0.2747773264188438D-2*t209-0.1D1*t230)*t44*t50
      t288 = 0.1923661050931536D1*t69*t256*t50
      t291 = 0.7694644203726145D1*t70*t46*t262
      t298 = -0.3333333333333333D0*t140*t35*t207+0.3333333333333333D0
     #*t143*t35*t207
      t306 = 1/t82/t47/rho
      t316 = -0.3216396844291482D2*(t210+t231-t235-t249+t259+t265+t285
     #+t288-t291)*t86+0.9649190532874446D2*t160*t298
      t320 = 0.1362107888567592D0*t156*t84*t316*t89
      t323 = 0.2724215777135184D0*t92*t168*t298
      t326 = 0.3178251739991049D0*t92*t80*t306
      t352 = t210+t231-t235-t249+t259+t265+t285+t288-t291
     #+0.9327207260896469D-1*t139*t298+0.310906908696549D-1*t79*(
     #-0.2724215777135184D0*t150*t151*t298-0.3178251739991049D0*t81
     #*t306*t96*t111+0.1362107888567592D0*t81*t84*(-t320-t323-t326)
     #*t111-0.1362107888567592D0*t177*t180*(-t320-t323-t326
     #-0.3710675800196129D-1*t184*t106*t316*t89-0.7421351600392257D-1
     #*t101*t191*t298-0.8658243533790967D-1*t101*t103/t104/t261))*t201
      t353 = rho*t352
      vrhoa(i) = rho*(t127-t132+t135+t138+0.9327207260896469D-1*t139
     #*t146+0.310906908696549D-1*t79*(-0.2724215777135184D0*t150*t151
     #*t146+0.1362107888567592D0*t81*t84*(-t167-t171)*t111
     #-0.1362107888567592D0*t177*t180*(-t167-t171
     #-0.3710675800196129D-1*t184*t106*t163*t89-0.7421351600392257D-1
     #*t101*t191*t146))*t201)-t21+t55+t72+t118+t353
      t354 = -t124
      t357 = 0.37995525D-1*t33*t354*t52
      t358 = 0.1519821D0*t131
      t361 = 0.1923661050931536D1*t69*t354*t50
      t362 = 0.7694644203726145D1*t137
      t363 = -t146
      t374 = -0.3216396844291482D2*(t357+t358+t361-t362)*t86
     #+0.9649190532874446D2*t160*t363
      t378 = 0.1362107888567592D0*t156*t84*t374*t89
      t381 = 0.2724215777135184D0*t92*t168*t363
      vrhob(i) = rho*(t357+t358+t361-t362+0.9327207260896469D-1*t139
     #*t363+0.310906908696549D-1*t79*(-0.2724215777135184D0*t150*t151
     #*t363+0.1362107888567592D0*t81*t84*(-t378-t381)*t111
     #-0.1362107888567592D0*t177*t180*(-t378-t381
     #-0.3710675800196129D-1*t184*t106*t374*t89-0.7421351600392257D-1
     #*t101*t191*t363))*t201)-t21+t55+t72+t118+t353
      t423 = rho*t79*(0.1362107888567592D0*t93*t151
     #+0.1855337900098064D-1*sigma*t103*t106*t91*t111
     #-0.1362107888567592D0*t177*t180*(0.1362107888567592D0*t91*t80
     #*t84+0.3710675800196129D-1*t155*t107))*t201
      vsigmaaa(i) = 0.310906908696549D-1*t423
      vsigmaab(i) = 0.6218138173930979D-1*t423
      vsigmabb(i) = vsigmaaa(i)
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = 1/rhob
      t3 = t2**(1.D0/3.D0)
      t5 = 1.D0+0.1274696188700087D0*t3
      t6 = t2**(1.D0/6.D0)
      t9 = dsqrt(t2)
      t11 = t3**2
      t13 = 0.1112037486309468D2*t6+0.3844746237447211D1*t3
     #+0.1644733775567609D1*t9+0.2405871291288192D0*t11
      t16 = 1.D0+0.3216395899738507D2/t13
      t17 = dlog(t16)
      t18 = t5*t17
      t19 = 0.310907D-1*t18
      t20 = rhob**2
      t21 = rhob**(1.D0/3.D0)
      t23 = 1/t21/t20
      t24 = sigmabb*t23
      t26 = dexp(0.2000000587336264D1*t18)
      t27 = t26-1.D0
      t28 = 1/t27
      t29 = t28*sigmabb
      t31 = 0.2162211495206379D0*t29*t23
      t32 = 1.D0+t31
      t33 = t27**2
      t34 = 1/t33
      t35 = sigmabb**2
      t36 = t34*t35
      t37 = t20**2
      t38 = t21**2
      t40 = 1/t38/t37
      t41 = t36*t40
      t43 = 1.D0+t31+0.4675158550002605D-1*t41
      t44 = 1/t43
      t45 = t32*t44
      t48 = 1.D0+0.2162211495206379D0*t24*t45
      t49 = dlog(t48)
      t50 = 0.1554534543482745D-1*t49
      zk(i) = rhob*(-t19+t50)
      vrhoa(i) = 0.D0
      t52 = t20*rhob
      t54 = 1/t21/t52
      t55 = sigmabb*t54
      t60 = 1/t38/t37/rhob
      t61 = t35*t60
      t62 = t28*t44
      t65 = t43**2
      t66 = 1/t65
      t67 = t32*t66
      t70 = t36*t60
      t72 = -0.5045160155481551D0*t29*t54-0.2181740656667882D0*t70
      t73 = t67*t72
      t76 = -0.5045160155481551D0*t55*t45-0.1090870328333941D0*t61*t62
     #-0.2162211495206379D0*t24*t73
      t77 = rhob*t76
      t78 = 1/t48
      t81 = 1/t11
      t82 = 1/t20
      t83 = t81*t82
      t84 = t83*t17
      t86 = t13**2
      t87 = 1/t86
      t88 = t5*t87
      t89 = t6**2
      t90 = t89**2
      t91 = t90*t6
      t92 = 1/t91
      t96 = 1/t9
      t99 = 1/t3
      t102 = -0.1853395810515781D1*t92*t82-0.128158207914907D1*t83
     #-0.8223668877838045D0*t96*t82-0.1603914194192128D0*t99*t82
      t103 = 1/t16
      t105 = t88*t102*t103
      t109 = -0.8497977086918237D-1*t84-0.6432793688582964D2*t105
      t110 = t109*t26
      t111 = t110*t44
      t114 = t34*sigmabb
      t120 = 1/t33/t27
      t121 = t120*t35
      t126 = -0.2162211495206379D0*t114*t23*t109*t26
     #-0.935031710000521D-1*t121*t40*t109*t26
      t127 = t67*t126
      t130 = -0.4675158550002605D-1*t41*t111-0.2162211495206379D0*t24
     #*t127
      t131 = t130*t78
      vrhob(i) = -t19+t50+0.1554534543482745D-1*t77*t78+rhob*
     #(0.1321039893133927D-2*t84+0.1D1*t105+0.1554534543482745D-1*t131)
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      t135 = t23*t32
      t138 = sigmabb*t40
      t145 = 0.2162211495206379D0*t28*t23+0.935031710000521D-1*t114*t40
      t149 = 0.2162211495206379D0*t135*t44+0.4675158550002605D-1*t138
     #*t62-0.2162211495206379D0*t24*t67*t145
      vsigmabb(i) = 0.1554534543482745D-1*rhob*t149*t78
      v2rhoa2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t155 = 1/t21/t37
      t161 = 1/t38/t37/t20
      t167 = t28*t66
      t172 = 1/t65/t43
      t173 = t32*t172
      t174 = t72**2
      t190 = t76**2
      t192 = t48**2
      t193 = 1/t192
      t199 = t70*t111
      t204 = 0.4675158550002605D-1*t41*t110*t66*t72
      t206 = 0.5045160155481551D0*t55*t127
      t209 = 0.1090870328333941D0*t61*t167*t126
      t214 = 0.4324422990412758D0*t24*t32*t172*t126*t72
      t226 = 0.2162211495206379D0*t24*t67*(0.5045160155481551D0*t114
     #*t54*t109*t26+0.4363481313335765D0*t121*t60*t109*t26)
      t230 = t130*t193
      t244 = 1/t37
      t245 = 1/t11/t2*t244
      t246 = t245*t17
      t248 = 1/t52
      t249 = t81*t248
      t250 = t249*t17
      t254 = t83*t87*t102*t103
      t259 = t102**2
      t261 = t5/t86/t13*t259*t103
      t285 = t88*(-0.1544496508763151D1/t91/t2*t244
     #+0.3706791621031562D1*t92*t248-0.854388052766047D0*t245
     #+0.2563164158298141D1*t249-0.4111834438919023D0/t9/t2*t244
     #+0.1644733775567609D1*t96*t248-0.5346380647307093D-1/t3/t2*t244
     #+0.3207828388384256D0*t99*t248)*t103
      t287 = t86**2
      t290 = t16**2
      t293 = t5/t287*t259/t290
      t297 = t109**2
      t298 = t26**2
      t309 = -0.5665318057945491D-1*t246+0.1699595417383647D0*t250
     #+0.546657173168712D1*t254+0.1286558737716593D3*t261
     #-0.6432793688582964D2*t285-0.2069041124382199D4*t293
      t322 = t126**2
      t327 = t23*t297
      t338 = t33**2
      t341 = t40*t297
      t359 = t130**2
      s1 = 0.310906908696549D-1*t76*t78+0.1554534543482745D-1*rhob*
     #(0.1681720051827184D1*sigmabb*t155*t45+0.8726962626671529D0*t35
     #*t161*t62+0.100903203109631D1*t55*t73+0.2181740656667882D0*t61
     #*t167*t72+0.4324422990412758D0*t24*t173*t174
     #-0.2162211495206379D0*t24*t67*(0.1681720051827184D1*t29*t155
     #+0.1236319705445133D1*t36*t161))*t78-0.1554534543482745D-1*rhob
     #*t190*t193+0.2642079786267853D-2*t84+0.2D1*t105
      s2 = s1+0.310906908696549D-1*t131+rhob*(0.1554534543482745D-1*
     #(0.2181740656667882D0*t199+t204+t206+t209+t214-t226)*t78
     #-0.1554534543482745D-1*t230*t76)
      s3 = s2+0.1554534543482745D-1*rhob*(0.2181740656667882D0*t199
     #+t206+t209+t204+t214-t226)*t78
      v2rhob2(i) = s3-0.1554534543482745D-1*t77*t230+rhob*
     #(0.8806932620892844D-3*t246-0.2642079786267853D-2*t250
     #-0.8497974591333914D-1*t254-0.2D1*t261+0.1D1*t285
     #+0.3216395899738507D2*t293+0.1554534543482745D-1*
     #(0.935031710000521D-1*t35*t40*t120*t297*t298*t44
     #-0.4675158550002605D-1*t41*t309*t26*t44-0.4675158550002605D-1
     #*t41*t297*t26*t44+0.935031710000521D-1*t41*t110*t66*t126
     #+0.4324422990412758D0*t24*t173*t322-0.2162211495206379D0*t24*t67
     #*(0.4324422990412758D0*t120*sigmabb*t327*t298
     #-0.2162211495206379D0*t114*t23*t309*t26-0.2162211495206379D0
     #*t114*t327*t26+0.2805095130001563D0/t338*t35*t341*t298
     #-0.935031710000521D-1*t121*t40*t309*t26-0.935031710000521D-1
     #*t121*t341*t26))*t78-0.1554534543482745D-1*t359*t193)
      v2sigmaaa2(i) = 0.D0
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      t373 = t145**2
      t387 = t149**2
      v2sigmabb2(i) = 0.1554534543482745D-1*rhob*(0.935031710000521D-1
     #*t40*t28*t44-0.4324422990412758D0*t135*t66*t145
     #-0.935031710000521D-1*t138*t167*t145+0.4324422990412758D0*t24
     #*t173*t373-0.2021736311745604D-1*sigmabb/t37/t52*t67*t34)*t78
     #-0.1554534543482745D-1*rhob*t387*t193
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = 1/rhoa
      t3 = t2**(1.D0/3.D0)
      t5 = 1.D0+0.1274696188700087D0*t3
      t6 = t2**(1.D0/6.D0)
      t9 = dsqrt(t2)
      t11 = t3**2
      t13 = 0.1112037486309468D2*t6+0.3844746237447211D1*t3
     #+0.1644733775567609D1*t9+0.2405871291288192D0*t11
      t16 = 1.D0+0.3216395899738507D2/t13
      t17 = dlog(t16)
      t18 = t5*t17
      t19 = 0.310907D-1*t18
      t20 = rhoa**2
      t21 = rhoa**(1.D0/3.D0)
      t23 = 1/t21/t20
      t24 = sigmaaa*t23
      t26 = dexp(0.2000000587336264D1*t18)
      t27 = t26-1.D0
      t28 = 1/t27
      t29 = t28*sigmaaa
      t31 = 0.2162211495206379D0*t29*t23
      t32 = 1.D0+t31
      t33 = t27**2
      t34 = 1/t33
      t35 = sigmaaa**2
      t36 = t34*t35
      t37 = t20**2
      t38 = t21**2
      t40 = 1/t38/t37
      t41 = t36*t40
      t43 = 1.D0+t31+0.4675158550002605D-1*t41
      t44 = 1/t43
      t45 = t32*t44
      t48 = 1.D0+0.2162211495206379D0*t24*t45
      t49 = dlog(t48)
      t50 = 0.1554534543482745D-1*t49
      zk(i) = rhoa*(-t19+t50)
      t52 = t20*rhoa
      t54 = 1/t21/t52
      t55 = sigmaaa*t54
      t60 = 1/t38/t37/rhoa
      t61 = t35*t60
      t62 = t28*t44
      t65 = t43**2
      t66 = 1/t65
      t67 = t32*t66
      t70 = t36*t60
      t72 = -0.5045160155481551D0*t29*t54-0.2181740656667882D0*t70
      t73 = t67*t72
      t76 = -0.5045160155481551D0*t55*t45-0.1090870328333941D0*t61*t62
     #-0.2162211495206379D0*t24*t73
      t77 = rhoa*t76
      t78 = 1/t48
      t81 = 1/t11
      t82 = 1/t20
      t83 = t81*t82
      t84 = t83*t17
      t86 = t13**2
      t87 = 1/t86
      t88 = t5*t87
      t89 = t6**2
      t90 = t89**2
      t91 = t90*t6
      t92 = 1/t91
      t96 = 1/t9
      t99 = 1/t3
      t102 = -0.1853395810515781D1*t92*t82-0.128158207914907D1*t83
     #-0.8223668877838045D0*t96*t82-0.1603914194192128D0*t99*t82
      t103 = 1/t16
      t105 = t88*t102*t103
      t109 = -0.8497977086918237D-1*t84-0.6432793688582964D2*t105
      t110 = t109*t26
      t111 = t110*t44
      t114 = t34*sigmaaa
      t120 = 1/t33/t27
      t121 = t120*t35
      t126 = -0.2162211495206379D0*t114*t23*t109*t26
     #-0.935031710000521D-1*t121*t40*t109*t26
      t127 = t67*t126
      t130 = -0.4675158550002605D-1*t41*t111-0.2162211495206379D0*t24
     #*t127
      t131 = t130*t78
      vrhoa(i) = -t19+t50+0.1554534543482745D-1*t77*t78+rhoa*
     #(0.1321039893133927D-2*t84+0.1D1*t105+0.1554534543482745D-1*t131)
      vrhob(i) = 0.D0
      t135 = t23*t32
      t138 = sigmaaa*t40
      t145 = 0.2162211495206379D0*t28*t23+0.935031710000521D-1*t114*t40
      t149 = 0.2162211495206379D0*t135*t44+0.4675158550002605D-1*t138
     #*t62-0.2162211495206379D0*t24*t67*t145
      vsigmaaa(i) = 0.1554534543482745D-1*rhoa*t149*t78
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      t155 = 1/t21/t37
      t161 = 1/t38/t37/t20
      t167 = t28*t66
      t172 = 1/t65/t43
      t173 = t32*t172
      t174 = t72**2
      t190 = t76**2
      t192 = t48**2
      t193 = 1/t192
      t199 = t70*t111
      t204 = 0.4675158550002605D-1*t41*t110*t66*t72
      t206 = 0.5045160155481551D0*t55*t127
      t209 = 0.1090870328333941D0*t61*t167*t126
      t214 = 0.4324422990412758D0*t24*t32*t172*t126*t72
      t226 = 0.2162211495206379D0*t24*t67*(0.5045160155481551D0*t114
     #*t54*t109*t26+0.4363481313335765D0*t121*t60*t109*t26)
      t230 = t130*t193
      t244 = 1/t37
      t245 = 1/t11/t2*t244
      t246 = t245*t17
      t248 = 1/t52
      t249 = t81*t248
      t250 = t249*t17
      t254 = t83*t87*t102*t103
      t259 = t102**2
      t261 = t5/t86/t13*t259*t103
      t285 = t88*(-0.1544496508763151D1/t91/t2*t244
     #+0.3706791621031562D1*t92*t248-0.854388052766047D0*t245
     #+0.2563164158298141D1*t249-0.4111834438919023D0/t9/t2*t244
     #+0.1644733775567609D1*t96*t248-0.5346380647307093D-1/t3/t2*t244
     #+0.3207828388384256D0*t99*t248)*t103
      t287 = t86**2
      t290 = t16**2
      t293 = t5/t287*t259/t290
      t297 = t109**2
      t298 = t26**2
      t309 = -0.5665318057945491D-1*t246+0.1699595417383647D0*t250
     #+0.546657173168712D1*t254+0.1286558737716593D3*t261
     #-0.6432793688582964D2*t285-0.2069041124382199D4*t293
      t322 = t126**2
      t327 = t23*t297
      t338 = t33**2
      t341 = t40*t297
      t359 = t130**2
      s1 = 0.310906908696549D-1*t76*t78+0.1554534543482745D-1*rhoa*
     #(0.1681720051827184D1*sigmaaa*t155*t45+0.8726962626671529D0*t35
     #*t161*t62+0.100903203109631D1*t55*t73+0.2181740656667882D0*t61
     #*t167*t72+0.4324422990412758D0*t24*t173*t174
     #-0.2162211495206379D0*t24*t67*(0.1681720051827184D1*t29*t155
     #+0.1236319705445133D1*t36*t161))*t78-0.1554534543482745D-1*rhoa
     #*t190*t193+0.2642079786267853D-2*t84+0.2D1*t105
      s2 = s1+0.310906908696549D-1*t131+rhoa*(0.1554534543482745D-1*
     #(0.2181740656667882D0*t199+t204+t206+t209+t214-t226)*t78
     #-0.1554534543482745D-1*t230*t76)
      s3 = s2+0.1554534543482745D-1*rhoa*(0.2181740656667882D0*t199
     #+t206+t209+t204+t214-t226)*t78
      v2rhoa2(i) = s3-0.1554534543482745D-1*t77*t230+rhoa*
     #(0.8806932620892844D-3*t246-0.2642079786267853D-2*t250
     #-0.8497974591333914D-1*t254-0.2D1*t261+0.1D1*t285
     #+0.3216395899738507D2*t293+0.1554534543482745D-1*
     #(0.935031710000521D-1*t35*t40*t120*t297*t298*t44
     #-0.4675158550002605D-1*t41*t309*t26*t44-0.4675158550002605D-1
     #*t41*t297*t26*t44+0.935031710000521D-1*t41*t110*t66*t126
     #+0.4324422990412758D0*t24*t173*t322-0.2162211495206379D0*t24*t67
     #*(0.4324422990412758D0*t120*sigmaaa*t327*t298
     #-0.2162211495206379D0*t114*t23*t309*t26-0.2162211495206379D0
     #*t114*t327*t26+0.2805095130001563D0/t338*t35*t341*t298
     #-0.935031710000521D-1*t121*t40*t309*t26-0.935031710000521D-1
     #*t121*t341*t26))*t78-0.1554534543482745D-1*t359*t193)
      v2rhob2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t373 = t145**2
      t387 = t149**2
      v2sigmaaa2(i) = 0.1554534543482745D-1*rhoa*(0.935031710000521D-1
     #*t40*t28*t44-0.4324422990412758D0*t135*t66*t145
     #-0.935031710000521D-1*t138*t167*t145+0.4324422990412758D0*t24
     #*t173*t373-0.2021736311745604D-1*sigmaaa/t37/t52*t67*t34)*t78
     #-0.1554534543482745D-1*rhoa*t387*t193
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      v2sigmabb2(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = 1/rho
      t5 = t4**(1.D0/3.D0)
      t7 = 1.D0+0.1325688999052018D0*t5
      t8 = t4**(1.D0/6.D0)
      t11 = dsqrt(t4)
      t13 = t5**2
      t15 = 0.598255043577108D1*t8+0.2225569421150687D1*t5
     #+0.8004286349993634D0*t11+0.1897004325747559D0*t13
      t18 = 1.D0+0.1608197949869254D2/t15
      t19 = dlog(t18)
      t21 = 0.621814D-1*t7*t19
      t23 = 1.D0+0.6901399211255825D-1*t5
      t28 = 0.8157414703487641D1*t8+0.2247591863577616D1*t5
     #+0.4300972471276643D0*t11+0.1911512595127338D0*t13
      t31 = 1.D0+0.2960874997779344D2/t28
      t32 = dlog(t31)
      t33 = t23*t32
      t35 = rhoa-1.D0*rhob
      t36 = t35*t4
      t37 = 1.D0+t36
      t38 = t37**(1.D0/3.D0)
      t39 = t38*t37
      t41 = 1.D0-1.D0*t36
      t42 = t41**(1.D0/3.D0)
      t43 = t42*t41
      t44 = t39+t43-2.D0
      t45 = t35**2
      t46 = t45**2
      t47 = rho**2
      t48 = t47**2
      t49 = 1/t48
      t50 = t46*t49
      t52 = 1.D0-1.D0*t50
      t53 = t44*t52
      t55 = 0.37995525D-1*t33*t53
      t57 = 1.D0+0.1274696188700087D0*t5
      t62 = 0.1112037486309468D2*t8+0.3844746237447211D1*t5
     #+0.1644733775567609D1*t11+0.2405871291288192D0*t13
      t65 = 1.D0+0.3216395899738507D2/t62
      t66 = dlog(t65)
      t69 = -0.310907D-1*t57*t66+t21
      t70 = t69*t44
      t72 = 0.1923661050931536D1*t70*t50
      t73 = t38**2
      t75 = t42**2
      t77 = 0.5D0*t73+0.5D0*t75
      t78 = t77**2
      t79 = t78*t77
      t80 = 1/t78
      t81 = sigma*t80
      t82 = rho**(1.D0/3.D0)
      t84 = 1/t82/t47
      t85 = -t21+t55+t72
      t86 = 1/t79
      t89 = dexp(-0.3216396844291482D2*t85*t86)
      t90 = t89-1.D0
      t91 = 1/t90
      t92 = t91*sigma
      t93 = t80*t84
      t95 = 0.1362107888567592D0*t92*t93
      t96 = 1.D0+t95
      t98 = t90**2
      t99 = 1/t98
      t100 = sigma**2
      t101 = t99*t100
      t102 = t78**2
      t103 = 1/t102
      t104 = t82**2
      t106 = 1/t104/t48
      t107 = t103*t106
      t110 = 1.D0+t95+0.1855337900098064D-1*t101*t107
      t111 = 1/t110
      t115 = 1.D0+0.1362107888567592D0*t81*t84*t96*t111
      t116 = dlog(t115)
      t118 = 0.310906908696549D-1*t79*t116
      zk(i) = rho*(-t21+t55+t72+t118)
      t124 = 0.1333333333333333D1*t38*t4-0.1333333333333333D1*t42*t4
      t126 = t33*t124*t52
      t127 = 0.37995525D-1*t126
      t128 = t45*t35
      t129 = t44*t128
      t131 = t33*t129*t49
      t132 = 0.1519821D0*t131
      t133 = t69*t124
      t134 = t133*t50
      t135 = 0.1923661050931536D1*t134
      t136 = t128*t49
      t137 = t70*t136
      t138 = 0.7694644203726145D1*t137
      t139 = t78*t116
      t140 = 1/t38
      t143 = 1/t42
      t146 = 0.3333333333333333D0*t140*t4-0.3333333333333333D0*t143*t4
      t147 = t139*t146
      t148 = 0.9327207260896469D-1*t147
      t149 = sigma*t86
      t150 = t149*t84
      t151 = t96*t111
      t152 = t151*t146
      t155 = t99*sigma
      t156 = t155*t80
      t157 = t127-t132+t135+t138
      t160 = t85*t103
      t163 = -0.3216396844291482D2*t157*t86+0.9649190532874446D2*t160
     #*t146
      t164 = t84*t163
      t165 = t164*t89
      t167 = 0.1362107888567592D0*t156*t165
      t168 = t86*t84
      t171 = 0.2724215777135184D0*t92*t168*t146
      t172 = -t167-t171
      t177 = t81*t84
      t178 = t110**2
      t179 = 1/t178
      t180 = t96*t179
      t182 = 1/t98/t90
      t183 = t182*t100
      t184 = t183*t103
      t185 = t106*t163
      t186 = t185*t89
      t190 = 1/t102/t77
      t191 = t190*t106
      t192 = t191*t146
      t195 = -t167-t171-0.3710675800196129D-1*t184*t186
     #-0.7421351600392257D-1*t101*t192
      t196 = t180*t195
      t199 = -0.2724215777135184D0*t150*t152+0.1362107888567592D0*t81
     #*t84*t172*t111-0.1362107888567592D0*t177*t196
      t200 = t79*t199
      t201 = 1/t115
      t202 = t200*t201
      t203 = 0.310906908696549D-1*t202
      t206 = 1/t13
      t207 = 1/t47
      t208 = t206*t207
      t209 = t208*t19
      t210 = 0.2747773264188438D-2*t209
      t211 = t15**2
      t212 = 1/t211
      t213 = t7*t212
      t214 = t8**2
      t215 = t214**2
      t216 = t215*t8
      t217 = 1/t216
      t218 = t217*t207
      t221 = 1/t11
      t222 = t221*t207
      t224 = 1/t5
      t225 = t224*t207
      t227 = -0.99709173929518D0*t218-0.7418564737168958D0*t208
     #-0.4002143174996817D0*t222-0.1264669550498372D0*t225
      t228 = 1/t18
      t230 = t213*t227*t228
      t231 = 0.1D1*t230
      t232 = t32*t44
      t233 = t232*t52
      t234 = t208*t233
      t235 = 0.87407428755417D-3*t234
      t236 = t28**2
      t237 = 1/t236
      t238 = t23*t237
      t243 = -0.135956911724794D1*t218-0.7491972878592054D0*t208
     #-0.2150486235638321D0*t222-0.1274341730084892D0*t225
      t244 = t238*t243
      t245 = 1/t31
      t246 = t245*t44
      t247 = t246*t52
      t248 = t244*t247
      t249 = 0.1125D1*t248
      t250 = t38*t35
      t253 = t42*t35
      t256 = -0.1333333333333333D1*t250*t207+0.1333333333333333D1*t253
     #*t207
      t258 = t33*t256*t52
      t259 = 0.37995525D-1*t258
      t260 = t44*t46
      t261 = t48*rho
      t262 = 1/t261
      t264 = t33*t260*t262
      t265 = 0.1519821D0*t264
      t268 = t62**2
      t269 = 1/t268
      t270 = t57*t269
      t275 = -0.1853395810515781D1*t218-0.128158207914907D1*t208
     #-0.8223668877838045D0*t222-0.1603914194192128D0*t225
      t276 = 1/t65
      t282 = 0.1321039893133927D-2*t208*t66+0.1D1*t270*t275*t276
     #-0.2747773264188438D-2*t209-0.1D1*t230
      t283 = t282*t44
      t284 = t283*t50
      t285 = 0.1923661050931536D1*t284
      t286 = t69*t256
      t287 = t286*t50
      t288 = 0.1923661050931536D1*t287
      t289 = t46*t262
      t290 = t70*t289
      t291 = 0.7694644203726145D1*t290
      t292 = t140*t35
      t295 = t143*t35
      t298 = -0.3333333333333333D0*t292*t207+0.3333333333333333D0*t295
     #*t207
      t299 = t139*t298
      t301 = t151*t298
      t304 = t47*rho
      t306 = 1/t82/t304
      t311 = t210+t231-t235-t249+t259+t265+t285+t288-t291
      t316 = -0.3216396844291482D2*t311*t86+0.9649190532874446D2*t160
     #*t298
      t317 = t84*t316
      t318 = t317*t89
      t320 = 0.1362107888567592D0*t156*t318
      t323 = 0.2724215777135184D0*t92*t168*t298
      t324 = t80*t306
      t326 = 0.3178251739991049D0*t92*t324
      t327 = -t320-t323-t326
      t332 = t106*t316
      t333 = t332*t89
      t336 = t191*t298
      t340 = 1/t104/t261
      t341 = t103*t340
      t344 = -t320-t323-t326-0.3710675800196129D-1*t184*t333
     #-0.7421351600392257D-1*t101*t336-0.8658243533790967D-1*t101*t341
      t345 = t180*t344
      t348 = -0.2724215777135184D0*t150*t301-0.3178251739991049D0*t81
     #*t306*t96*t111+0.1362107888567592D0*t81*t84*t327*t111
     #-0.1362107888567592D0*t177*t345
      t349 = t79*t348
      t350 = t349*t201
      t352 = t210+t231-t235-t249+t259+t265+t285+t288-t291
     #+0.9327207260896469D-1*t299+0.310906908696549D-1*t350
      t353 = rho*t352
      vrhoa(i) = rho*(t127-t132+t135+t138+t148+t203)-t21+t55+t72+t118
     #+t353
      t354 = -t124
      t356 = t33*t354*t52
      t357 = 0.37995525D-1*t356
      t358 = 0.1519821D0*t131
      t359 = t69*t354
      t360 = t359*t50
      t361 = 0.1923661050931536D1*t360
      t362 = 0.7694644203726145D1*t137
      t363 = -t146
      t364 = t139*t363
      t365 = 0.9327207260896469D-1*t364
      t366 = t151*t363
      t369 = t357+t358+t361-t362
      t374 = -0.3216396844291482D2*t369*t86+0.9649190532874446D2*t160
     #*t363
      t375 = t84*t374
      t376 = t375*t89
      t378 = 0.1362107888567592D0*t156*t376
      t381 = 0.2724215777135184D0*t92*t168*t363
      t382 = -t378-t381
      t387 = t106*t374
      t388 = t387*t89
      t391 = t191*t363
      t394 = -t378-t381-0.3710675800196129D-1*t184*t388
     #-0.7421351600392257D-1*t101*t391
      t395 = t180*t394
      t398 = -0.2724215777135184D0*t150*t366+0.1362107888567592D0*t81
     #*t84*t382*t111-0.1362107888567592D0*t177*t395
      t399 = t79*t398
      t400 = t399*t201
      t401 = 0.310906908696549D-1*t400
      vrhob(i) = rho*(t357+t358+t361-t362+t365+t401)-t21+t55+t72+t118
     #+t353
      t404 = rho*t79
      t407 = sigma*t103
      t412 = t91*t80
      t417 = 0.1362107888567592D0*t412*t84+0.3710675800196129D-1*t155
     #*t107
      t418 = t180*t417
      t421 = 0.1362107888567592D0*t93*t151+0.1855337900098064D-1*t407
     #*t106*t91*t111-0.1362107888567592D0*t177*t418
      t423 = t404*t421*t201
      vsigmaaa(i) = 0.310906908696549D-1*t423
      vsigmaab(i) = 0.6218138173930979D-1*t423
      vsigmabb(i) = vsigmaaa(i)
      t427 = 0.87407428755417D-3*t208*t32*t124*t52
      t428 = t48*t47
      t429 = 1/t428
      t432 = t206*t429*t232*t128
      t433 = 0.349629715021668D-2*t432
      t437 = 0.1125D1*t244*t245*t124*t52
      t439 = t244*t246*t136
      t440 = 0.45D1*t439
      t441 = 1/t73
      t443 = 1/t304
      t448 = 1/t75
      t454 = -0.4444444444444444D0*t441*t35*t443-0.1333333333333333D1
     #*t38*t207-0.4444444444444444D0*t448*t35*t443
     #+0.1333333333333333D1*t42*t207
      t457 = 0.37995525D-1*t33*t454*t52
      t460 = t33*t256*t128*t49
      t461 = 0.1519821D0*t460
      t465 = 0.1519821D0*t33*t124*t46*t262
      t467 = t33*t129*t262
      t468 = 0.6079284D0*t467
      t471 = 0.1923661050931536D1*t282*t124*t50
      t472 = t283*t136
      t473 = 0.7694644203726145D1*t472
      t476 = 0.1923661050931536D1*t69*t454*t50
      t477 = t286*t136
      t478 = 0.7694644203726145D1*t477
      t480 = 0.7694644203726145D1*t133*t289
      t482 = t70*t128*t262
      t483 = 0.3077857681490458D2*t482
      t484 = t77*t116
      t485 = t298*t146
      t487 = 0.1865441452179294D0*t484*t485
      t488 = t78*t199
      t489 = t201*t298
      t491 = 0.9327207260896469D-1*t488*t489
      t492 = 1/t39
      t498 = 1/t43
      t504 = 0.1111111111111111D0*t492*t35*t443-0.3333333333333333D0
     #*t140*t207+0.1111111111111111D0*t498*t35*t443
     #+0.3333333333333333D0*t143*t207
      t506 = 0.9327207260896469D-1*t139*t504
      t507 = t78*t348
      t508 = t201*t146
      t510 = 0.9327207260896469D-1*t507*t508
      t511 = t407*t84
      t514 = 0.8172647331405553D0*t511*t151*t485
      t515 = t172*t111
      t518 = 0.2724215777135184D0*t150*t515*t298
      t522 = 0.2724215777135184D0*t150*t180*t298*t195
      t525 = 0.2724215777135184D0*t150*t151*t504
      t526 = t149*t306
      t528 = 0.6356503479982097D0*t526*t152
      t532 = 0.3178251739991049D0*t81*t306*t172*t111
      t533 = t81*t306
      t535 = 0.3178251739991049D0*t533*t196
      t536 = t327*t111
      t539 = 0.2724215777135184D0*t150*t536*t146
      t540 = t182*sigma
      t541 = t540*t80
      t542 = t89**2
      t543 = t542*t163
      t546 = 0.2724215777135184D0*t541*t317*t543
      t547 = t155*t86
      t548 = t89*t146
      t551 = 0.2724215777135184D0*t547*t317*t548
      t552 = -t427+t433-t437+t440+t457-t461+t465+t468+t471+t473+t476
     #+t478-t480-t483
      t555 = t311*t103
      t557 = 0.9649190532874446D2*t555*t146
      t558 = t157*t103
      t560 = 0.9649190532874446D2*t558*t298
      t561 = t85*t190
      t563 = 0.3859676213149779D3*t561*t485
      t565 = 0.9649190532874446D2*t160*t504
      t566 = -0.3216396844291482D2*t552*t86+t557+t560-t563+t565
      t570 = 0.1362107888567592D0*t156*t84*t566*t89
      t571 = t163*t89
      t574 = 0.1362107888567592D0*t156*t317*t571
      t575 = t84*t298
      t578 = 0.2724215777135184D0*t547*t575*t571
      t579 = t92*t103
      t582 = 0.8172647331405553D0*t579*t575*t146
      t585 = 0.2724215777135184D0*t92*t168*t504
      t589 = 0.3178251739991049D0*t156*t306*t163*t89
      t590 = t86*t306
      t593 = 0.6356503479982097D0*t92*t590*t146
      t599 = t327*t179
      t602 = 0.1362107888567592D0*t177*t599*t195
      t606 = 0.2724215777135184D0*t150*t180*t344*t146
      t607 = t172*t179
      t610 = 0.1362107888567592D0*t177*t607*t344
      t613 = t96/t178/t110
      t617 = 0.2724215777135184D0*t177*t613*t344*t195
      t618 = t98**2
      t621 = 1/t618*t100*t103
      t624 = 0.1113202740058839D0*t621*t332*t543
      t625 = t183*t190
      t628 = 0.1484270320078451D0*t625*t332*t548
      t635 = 0.3710675800196129D-1*t184*t332*t571
      t636 = t106*t298
      t639 = 0.1484270320078451D0*t625*t636*t571
      t641 = 1/t102/t78
      t642 = t101*t641
      t645 = 0.3710675800196129D0*t642*t636*t146
      t648 = 0.7421351600392257D-1*t101*t191*t504
      t652 = 0.1731648706758193D0*t184*t340*t163*t89
      t653 = t190*t340
      t656 = 0.3463297413516387D0*t101*t653*t146
      t657 = t546+t551-t570-t574+t578+t582-t585+t589+t593+t624+t628
     #-0.3710675800196129D-1*t184*t106*t566*t89-t635+t639+t645-t648
     #+t652+t656
      t661 = t514-t518+t522-t525+t528-t532+t535-t539
     #+0.1362107888567592D0*t81*t84*(t546+t551-t570-t574+t578+t582
     #-t585+t589+t593)*t111-t602+t606-t610+t617-0.1362107888567592D0
     #*t177*t180*t657
      t665 = t115**2
      t666 = 1/t665
      t669 = 0.310906908696549D-1*t349*t666*t199
      t670 = -t427+t433-t437+t440+t457-t461+t465+t468+t471+t473+t476
     #+t478-t480-t483+t487+t491+t506+t510+0.310906908696549D-1*t79
     #*t661*t201-t669
      t671 = rho*t670
      t677 = 0.4444444444444444D0*t441*t207+0.4444444444444444D0*t448
     #*t207
      t680 = 0.37995525D-1*t33*t677*t52
      t683 = t33*t124*t128*t49
      t684 = 0.3039642D0*t683
      t687 = t33*t44*t45*t49
      t688 = 0.4559463D0*t687
      t691 = 0.1923661050931536D1*t69*t677*t50
      t692 = t133*t136
      t693 = 0.1538928840745229D2*t692
      t695 = t70*t45*t49
      t696 = 0.2308393261117844D2*t695
      t697 = t146**2
      t706 = -0.1111111111111111D0*t492*t207-0.1111111111111111D0*t498
     #*t207
      t708 = 0.9327207260896469D-1*t139*t706
      t721 = 0.2724215777135184D0*t150*t151*t706
      t722 = t163**2
      t723 = t84*t722
      t726 = 0.2724215777135184D0*t541*t723*t542
      t729 = 0.5448431554270369D0*t547*t164*t548
      t738 = 0.9649190532874446D2*t160*t706
      t739 = -0.3216396844291482D2*(t680-t684-t688+t691+t693+t696)*t86
     #+0.1929838106574889D3*t558*t146-0.3859676213149779D3*t561*t697
     #+t738
      t743 = 0.1362107888567592D0*t156*t84*t739*t89
      t746 = 0.1362107888567592D0*t156*t723*t89
      t747 = t103*t84
      t750 = 0.8172647331405553D0*t92*t747*t697
      t753 = 0.2724215777135184D0*t92*t168*t706
      t762 = t195**2
      t766 = t106*t722
      t780 = t641*t106
      t786 = 0.7421351600392257D-1*t101*t191*t706
      t787 = t726+t729-t743-t746+t750-t753+0.1113202740058839D0*t621
     #*t766*t542+0.2968540640156903D0*t625*t185*t548
     #-0.3710675800196129D-1*t184*t106*t739*t89-0.3710675800196129D-1
     #*t184*t766*t89+0.3710675800196129D0*t101*t780*t697-t786
      t795 = t199**2
      t799 = t680-t684-t688+t691+t693+t696+0.1865441452179294D0*t484
     #*t697+0.1865441452179294D0*t488*t508+t708+0.310906908696549D-1
     #*t79*(0.8172647331405553D0*t511*t151*t697-0.5448431554270369D0
     #*t150*t515*t146+0.5448431554270369D0*t150*t180*t146*t195-t721
     #+0.1362107888567592D0*t81*t84*(t726+t729-t743-t746+t750-t753)
     #*t111-0.2724215777135184D0*t177*t607*t195+0.2724215777135184D0
     #*t177*t613*t762-0.1362107888567592D0*t177*t180*t787)*t201
     #-0.310906908696549D-1*t79*t795*t666
      t801 = 0.45D1*t439
      t802 = -t427-t437+t457+t465+t433+t801-t461+t468+t471+t476-t480
     #+t473+t478-t483
      t805 = -0.3216396844291482D2*t802*t86+t560+t557-t563+t565
      t809 = 0.1362107888567592D0*t156*t84*t805*t89
      t819 = t546+t578+t589-t809-t574+t551+t582+t593-t585+t624+t639
     #+t652-0.3710675800196129D-1*t184*t106*t805*t89-t635+t628+t645
     #+t656-t648
      t823 = t514+t528-t539+t606-t525-t518-t532+0.1362107888567592D0
     #*t81*t84*(t546+t578+t589-t809-t574+t551+t582+t593-t585)*t111
     #-t610+t522+t535-t602+t617-0.1362107888567592D0*t177*t180*t819
      t827 = -t427-t437+t457+t465+t433+t801-t461+t468+t471+t476-t480
     #+t473+t478-t483+t487+t510+t506+t491+0.310906908696549D-1*t79
     #*t823*t201-t669
      t828 = rho*t827
      t829 = 0.5495546528376876D-2*t209
      t831 = 0.2D1*t230
      t836 = 0.1538928840745229D2*t290
      t837 = 0.1865441452179294D0*t299
      t838 = 0.3847322101863073D1*t287
      t839 = 0.7599105D-1*t258
      t840 = 0.174814857510834D-2*t234
      t841 = 0.225D1*t248
      t842 = 0.3039642D0*t264
      t843 = 0.3847322101863073D1*t284
      t844 = 0.6218138173930979D-1*t350
      t848 = 1/t13/t4*t49
      t849 = t848*t19
      t850 = 0.1831848842792292D-2*t849
      t851 = t348**2
      t858 = t227**2
      t860 = t7/t211/t15*t858*t228
      t861 = 0.2D1*t860
      t864 = 1/t216/t4*t49
      t866 = t217*t443
      t869 = t206*t443
      t873 = 1/t11/t4*t49
      t875 = t221*t443
      t879 = 1/t5/t4*t49
      t881 = t224*t443
      t885 = t213*(-0.8309097827459833D0*t864+0.199418347859036D1*t866
     #-0.4945709824779306D0*t848+0.1483712947433792D1*t869
     #-0.2001071587498409D0*t873+0.8004286349993634D0*t875
     #-0.4215565168327908D-1*t879+0.2529339100996745D0*t881)*t228
      t886 = 0.1D1*t885
      t887 = t211**2
      t890 = t18**2
      t893 = t7/t887*t858/t890
      t894 = 0.1608197949869254D2*t893
      t898 = 0.225D1*t244*t245*t256*t52
      t900 = 0.174814857510834D-2*t869*t233
      t901 = t236**2
      t904 = t243**2
      t906 = t31**2
      t911 = 0.3330984372501762D2*t23/t901*t904/t906*t44*t52
      t914 = 0.9D1*t244*t246*t289
      t917 = t208*t212*t227*t228
      t918 = 0.8837926660346786D-1*t917
      t919 = t869*t19
      t920 = 0.5495546528376876D-2*t919
      t923 = 0.7599105D0*t33*t260*t429
      t927 = 0.3039642D0*t33*t256*t46*t262
      t939 = t275**2
      t955 = t268**2
      t958 = t65**2
      t969 = 0.8806932620892844D-3*t848*t66-0.2642079786267853D-2*t869
     #*t66-0.8497974591333914D-1*t208*t269*t275*t276-0.2D1*t57/t268
     #/t62*t939*t276+0.1D1*t270*(-0.1544496508763151D1*t864
     #+0.3706791621031562D1*t866-0.854388052766047D0*t848
     #+0.2563164158298141D1*t869-0.4111834438919023D0*t873
     #+0.1644733775567609D1*t875-0.5346380647307093D-1*t879
     #+0.3207828388384256D0*t881)*t276+0.3216395899738507D2*t57/t955
     #*t939/t958-0.1831848842792292D-2*t849+0.5495546528376876D-2*t919
     #+0.8837926660346786D-1*t917+0.2D1*t860-0.1D1*t885
     #-0.1608197949869254D2*t893
      t972 = 0.1923661050931536D1*t969*t44*t50
      t983 = 0.4444444444444444D0*t441*t45*t49+0.2666666666666667D1
     #*t250*t443+0.4444444444444444D0*t448*t45*t49
     #-0.2666666666666667D1*t253*t443
      t986 = 0.37995525D-1*t33*t983*t52
      t987 = t850-0.310906908696549D-1*t79*t851*t666-t861+t886+t894
     #-t898+t900-t911-t914-t918-t920-t923+t927+t972+t986
      t989 = 0.1538928840745229D2*t286*t289
      t992 = 0.1923661050931536D1*t69*t983*t50
      t994 = 0.58271619170278D-3*t848*t233
      t1006 = 0.1125D1*t238*(-0.1132974264373283D1*t864
     #+0.271913823449588D1*t866-0.4994648585728036D0*t848
     #+0.1498394575718411D1*t869-0.1075243117819161D0*t873
     #+0.4300972471276643D0*t875-0.4247805766949639D-1*t879
     #+0.2548683460169784D0*t881)*t247
      t1008 = 1/t48/t304
      t1012 = 0.699259430043336D-2*t206*t1008*t232*t46
      t1017 = 0.5176049408441869D-1*t208*t237*t243*t245*t53
      t1023 = 0.225D1*t23/t236/t28*t904*t247
      t1024 = t298**2
      t1029 = 0.3847322101863073D1*t282*t256*t50
      t1031 = 0.1538928840745229D2*t283*t289
      t1034 = 0.3847322101863073D2*t70*t46*t429
      t1038 = 0.174814857510834D-2*t208*t32*t256*t52
      t1054 = 1/t82/t48
      t1073 = -0.1111111111111111D0*t492*t45*t49+0.6666666666666667D0
     #*t292*t443-0.1111111111111111D0*t498*t45*t49
     #-0.6666666666666667D0*t295*t443
      t1077 = t316**2
      t1078 = t84*t1077
      t1081 = 0.2724215777135184D0*t541*t1078*t542
      t1082 = t89*t298
      t1085 = 0.5448431554270369D0*t547*t317*t1082
      t1089 = 0.6356503479982097D0*t156*t306*t316*t89
      t1090 = t850-t861+t886+t894-t898+t900-t911-t914-t918-t920-t923
     #+t927
      t1091 = t972+t986-t989+t992-t994-t1006-t1012+t1017+t1023+t1029
     #-t1031+t1034-t1038
      t1101 = -0.3216396844291482D2*(t1090+t1091)*t86
     #+0.1929838106574889D3*t555*t298-0.3859676213149779D3*t561*t1024
     #+0.9649190532874446D2*t160*t1073
      t1105 = 0.1362107888567592D0*t156*t84*t1101*t89
      t1108 = 0.1362107888567592D0*t156*t1078*t89
      t1111 = 0.8172647331405553D0*t92*t747*t1024
      t1114 = 0.1271300695996419D1*t92*t590*t298
      t1117 = 0.2724215777135184D0*t92*t168*t1073
      t1120 = 0.1059417246663683D1*t92*t80*t1054
      t1129 = t344**2
      t1150 = t106*t1077
      t1165 = t1111+t1114-t1117+t1120+t1089+t1081+t1085-t1108-t1105
     #+0.3710675800196129D0*t101*t780*t1024+0.6926594827032773D0*t101
     #*t653*t298+0.3463297413516387D0*t184*t340*t316*t89
     #-0.7421351600392257D-1*t101*t191*t1073-0.3710675800196129D-1
     #*t184*t106*t1101*t89+0.1113202740058839D0*t621*t1150*t542
     #+0.4906338002481548D0*t101*t103/t104/t428+0.2968540640156903D0
     #*t625*t332*t1082-0.3710675800196129D-1*t184*t1150*t89
      t1169 = 0.8172647331405553D0*t511*t151*t1024
     #+0.1271300695996419D1*t526*t301-0.5448431554270369D0*t150*t536
     #*t298+0.5448431554270369D0*t150*t180*t298*t344
     #+0.6356503479982097D0*t533*t345+0.1059417246663683D1*t81*t1054
     #*t96*t111-0.6356503479982097D0*t81*t306*t327*t111
     #-0.2724215777135184D0*t150*t151*t1073+0.1362107888567592D0*t81
     #*t84*(t1081+t1085+t1089-t1105-t1108+t1111+t1114-t1117+t1120)
     #*t111-0.2724215777135184D0*t177*t599*t344+0.2724215777135184D0
     #*t177*t613*t1129-0.1362107888567592D0*t177*t180*t1165
      t1177 = -t989+t992-t994-t1006-t1012+t1017+t1023
     #+0.1865441452179294D0*t484*t1024+t1029-t1031+t1034-t1038
     #+0.310906908696549D-1*t79*t1169*t201+0.1865441452179294D0*t507
     #*t489+0.9327207260896469D-1*t139*t1073
      t1179 = rho*(t987+t1177)
      t1180 = -t836+t837+t838+t839-t840-t841+t842+t843+t844
     #+0.3847322101863073D1*t134+t1179
      v2rhoa2(i) = t671-0.3039642D0*t131+rho*t799+t828+t829
     #+0.6218138173930979D-1*t202+t831+0.1538928840745229D2*t137
     #+0.1865441452179294D0*t147+0.7599105D-1*t126+t1180
      t1184 = t33*t354*t128*t49
      t1185 = 0.3039642D0*t1184
      t1186 = t359*t136
      t1187 = 0.1538928840745229D2*t1186
      t1188 = t363**2
      t1191 = t78*t398
      t1192 = t201*t363
      t1198 = t382*t111
      t1206 = t374**2
      t1207 = t84*t1206
      t1210 = 0.2724215777135184D0*t541*t1207*t542
      t1211 = t89*t363
      t1214 = 0.5448431554270369D0*t547*t375*t1211
      t1218 = t369*t103
      t1223 = -0.3216396844291482D2*(t680+t1185-t688+t691-t1187+t696)
     #*t86+0.1929838106574889D3*t1218*t363-0.3859676213149779D3*t561
     #*t1188+t738
      t1227 = 0.1362107888567592D0*t156*t84*t1223*t89
      t1230 = 0.1362107888567592D0*t156*t1207*t89
      t1233 = 0.8172647331405553D0*t92*t747*t1188
      t1239 = t382*t179
      t1243 = t394**2
      t1247 = t106*t1206
      t1264 = t1210+t1214-t1227-t1230+t1233-t753+0.1113202740058839D0
     #*t621*t1247*t542+0.2968540640156903D0*t625*t387*t1211
     #-0.3710675800196129D-1*t184*t106*t1223*t89-0.3710675800196129D-1
     #*t184*t1247*t89+0.3710675800196129D0*t101*t780*t1188-t786
      t1272 = t398**2
      t1276 = t680+t1185-t688+t691-t1187+t696+0.1865441452179294D0
     #*t484*t1188+0.1865441452179294D0*t1191*t1192+t708
     #+0.310906908696549D-1*t79*(0.8172647331405553D0*t511*t151*t1188
     #-0.5448431554270369D0*t150*t1198*t363+0.5448431554270369D0*t150
     #*t180*t363*t394-t721+0.1362107888567592D0*t81*t84*(t1210+t1214
     #-t1227-t1230+t1233-t753)*t111-0.2724215777135184D0*t177*t1239
     #*t394+0.2724215777135184D0*t177*t613*t1243-0.1362107888567592D0
     #*t177*t180*t1264)*t201-0.310906908696549D-1*t79*t1272*t666
      t1285 = 0.87407428755417D-3*t208*t32*t354*t52
      t1286 = 0.349629715021668D-2*t432
      t1290 = 0.1125D1*t244*t245*t354*t52
      t1291 = 0.45D1*t439
      t1292 = -t454
      t1295 = 0.37995525D-1*t33*t1292*t52
      t1296 = 0.1519821D0*t460
      t1300 = 0.1519821D0*t33*t354*t46*t262
      t1301 = 0.6079284D0*t467
      t1304 = 0.1923661050931536D1*t282*t354*t50
      t1305 = 0.7694644203726145D1*t472
      t1308 = 0.1923661050931536D1*t69*t1292*t50
      t1309 = 0.7694644203726145D1*t477
      t1311 = 0.7694644203726145D1*t359*t289
      t1312 = 0.3077857681490458D2*t482
      t1313 = t298*t363
      t1318 = -t504
      t1347 = t542*t374
      t1350 = 0.2724215777135184D0*t541*t317*t1347
      t1353 = 0.2724215777135184D0*t547*t317*t1211
      t1354 = -t1285-t1286-t1290-t1291+t1295+t1296+t1300-t1301+t1304
     #-t1305+t1308-t1309-t1311+t1312
      t1365 = -0.3216396844291482D2*t1354*t86+0.9649190532874446D2
     #*t555*t363+0.9649190532874446D2*t1218*t298-0.3859676213149779D3
     #*t561*t1313+0.9649190532874446D2*t160*t1318
      t1369 = 0.1362107888567592D0*t156*t84*t1365*t89
      t1370 = t374*t89
      t1373 = 0.1362107888567592D0*t156*t317*t1370
      t1376 = 0.2724215777135184D0*t547*t575*t1370
      t1379 = 0.8172647331405553D0*t579*t575*t363
      t1382 = 0.2724215777135184D0*t92*t168*t1318
      t1386 = 0.3178251739991049D0*t156*t306*t374*t89
      t1389 = 0.6356503479982097D0*t92*t590*t363
      t1438 = t1350+t1353-t1369-t1373+t1376+t1379-t1382+t1386+t1389
     #+0.1113202740058839D0*t621*t332*t1347+0.1484270320078451D0*t625
     #*t332*t1211-0.3710675800196129D-1*t184*t106*t1365*t89
     #-0.3710675800196129D-1*t184*t332*t1370+0.1484270320078451D0*t625
     #*t636*t1370+0.3710675800196129D0*t642*t636*t363
     #-0.7421351600392257D-1*t101*t191*t1318+0.1731648706758193D0*t184
     #*t340*t374*t89+0.3463297413516387D0*t101*t653*t363
      t1442 = 0.8172647331405553D0*t511*t151*t1313
     #-0.2724215777135184D0*t150*t1198*t298+0.2724215777135184D0*t150
     #*t180*t298*t394-0.2724215777135184D0*t150*t151*t1318
     #+0.6356503479982097D0*t526*t366-0.3178251739991049D0*t81*t306
     #*t382*t111+0.3178251739991049D0*t533*t395-0.2724215777135184D0
     #*t150*t536*t363+0.1362107888567592D0*t81*t84*(t1350+t1353-t1369
     #-t1373+t1376+t1379-t1382+t1386+t1389)*t111-0.1362107888567592D0
     #*t177*t599*t394+0.2724215777135184D0*t150*t180*t344*t363
     #-0.1362107888567592D0*t177*t1239*t344+0.2724215777135184D0*t177
     #*t613*t344*t394-0.1362107888567592D0*t177*t180*t1438
      t1446 = t666*t398
      t1449 = -t1285-t1286-t1290-t1291+t1295+t1296+t1300-t1301+t1304
     #-t1305+t1308-t1309-t1311+t1312+0.1865441452179294D0*t484*t1313
     #+0.9327207260896469D-1*t1191*t489+0.9327207260896469D-1*t139
     #*t1318+0.9327207260896469D-1*t507*t1192+0.310906908696549D-1*t79
     #*t1442*t201-0.310906908696549D-1*t349*t1446
      t1450 = rho*t1449
      v2rhob2(i) = 0.3039642D0*t131+t829+rho*t1276+t831
     #-0.1538928840745229D2*t137-t836+t837+t838+t839-t840-t841+t842
     #+t843+t844+0.3847322101863073D1*t360+0.7599105D-1*t356+2*t1450
     #+t1179+0.6218138173930979D-1*t400+0.1865441452179294D0*t364
      t1455 = -t677
      t1458 = 0.37995525D-1*t33*t1455*t52
      t1459 = 0.1519821D0*t683
      t1460 = 0.1519821D0*t1184
      t1461 = 0.4559463D0*t687
      t1464 = 0.1923661050931536D1*t69*t1455*t50
      t1465 = 0.7694644203726145D1*t692
      t1466 = 0.7694644203726145D1*t1186
      t1467 = 0.2308393261117844D2*t695
      t1468 = t146*t363
      t1473 = -t706
      t1496 = 0.2724215777135184D0*t541*t164*t1347
      t1499 = 0.2724215777135184D0*t547*t164*t1211
      t1511 = -0.3216396844291482D2*(t1458+t1459-t1460+t1461+t1464
     #-t1465+t1466-t1467)*t86+0.9649190532874446D2*t558*t363
     #+0.9649190532874446D2*t1218*t146-0.3859676213149779D3*t561*t1468
     #+0.9649190532874446D2*t160*t1473
      t1515 = 0.1362107888567592D0*t156*t84*t1511*t89
      t1518 = 0.1362107888567592D0*t156*t164*t1370
      t1519 = t84*t146
      t1522 = 0.2724215777135184D0*t547*t1519*t1370
      t1525 = 0.8172647331405553D0*t579*t1519*t363
      t1528 = 0.2724215777135184D0*t92*t168*t1473
      t1561 = t106*t146
      t1571 = t1496+t1499-t1515-t1518+t1522+t1525-t1528
     #+0.1113202740058839D0*t621*t185*t1347+0.1484270320078451D0*t625
     #*t185*t1211-0.3710675800196129D-1*t184*t106*t1511*t89
     #-0.3710675800196129D-1*t184*t185*t1370+0.1484270320078451D0*t625
     #*t1561*t1370+0.3710675800196129D0*t642*t1561*t363
     #-0.7421351600392257D-1*t101*t191*t1473
      t1575 = 0.8172647331405553D0*t511*t151*t1468
     #-0.2724215777135184D0*t150*t1198*t146+0.2724215777135184D0*t150
     #*t180*t146*t394-0.2724215777135184D0*t150*t151*t1473
     #-0.2724215777135184D0*t150*t515*t363+0.1362107888567592D0*t81
     #*t84*(t1496+t1499-t1515-t1518+t1522+t1525-t1528)*t111
     #-0.1362107888567592D0*t177*t607*t394+0.2724215777135184D0*t150
     #*t180*t195*t363-0.1362107888567592D0*t177*t1239*t195
     #+0.2724215777135184D0*t177*t613*t195*t394-0.1362107888567592D0
     #*t177*t180*t1571
      t1581 = t1458+t1459-t1460+t1461+t1464-t1465+t1466-t1467
     #+0.1865441452179294D0*t484*t1468+0.9327207260896469D-1*t1191
     #*t508+0.9327207260896469D-1*t139*t1473+0.9327207260896469D-1
     #*t488*t1192+0.310906908696549D-1*t79*t1575*t201
     #-0.310906908696549D-1*t200*t1446
      t1584 = t829+0.5D0*t671-t840+t148-t841+rho*t1581+t842+t1179+t831
     #+t839+t843+0.5D0*t828
      t1586 = -t836+t838+t203+t844+t357+t361+t365+t401+0.1D1*t1450
     #+t127+t135+t837
      v2rhoab(i) = t1584+t1586
      t1587 = t78*t421
      t1593 = sigma*t190*t106
      t1594 = t91*t111
      t1604 = t99*t80
      t1606 = 0.1362107888567592D0*t1604*t165
      t1607 = t91*t86
      t1609 = 0.2724215777135184D0*t1607*t1519
      t1620 = t407*t106
      t1621 = t91*t179
      t1629 = t540*t103
      t1642 = t666*t421
      t1646 = rho*(0.9327207260896469D-1*t1587*t508
     #+0.310906908696549D-1*t79*(-0.2724215777135184D0*t168*t152
     #-0.3710675800196129D-1*t1593*t1594*t146+0.2724215777135184D0
     #*t150*t180*t146*t417+0.1362107888567592D0*t93*t515
     #+0.1362107888567592D0*t81*t84*(-t1606-t1609)*t111
     #-0.1362107888567592D0*t177*t607*t417-0.1362107888567592D0*t93
     #*t196-0.1855337900098064D-1*t1620*t1621*t195
     #+0.2724215777135184D0*t177*t613*t195*t417-0.1362107888567592D0
     #*t177*t180*(-t1606-t1609-0.7421351600392257D-1*t1629*t186
     #-0.1484270320078451D0*t155*t192))*t201-0.310906908696549D-1*t200
     #*t1642)
      t1648 = t79*t421*t201
      t1649 = 0.310906908696549D-1*t1648
      t1672 = 0.1362107888567592D0*t1604*t318
      t1674 = 0.2724215777135184D0*t1607*t575
      t1676 = 0.3178251739991049D0*t412*t306
      t1704 = -0.2724215777135184D0*t168*t301-0.3710675800196129D-1
     #*t1593*t1594*t298+0.2724215777135184D0*t150*t180*t298*t417
     #-0.3178251739991049D0*t324*t151-0.4329121766895483D-1*t407*t340
     #*t91*t111+0.3178251739991049D0*t533*t418+0.1362107888567592D0
     #*t93*t536+0.1362107888567592D0*t81*t84*(-t1672-t1674-t1676)*t111
     #-0.1362107888567592D0*t177*t599*t417-0.1362107888567592D0*t93
     #*t345-0.1855337900098064D-1*t1620*t1621*t344
     #+0.2724215777135184D0*t177*t613*t344*t417-0.1362107888567592D0
     #*t177*t180*(-t1672-t1674-t1676-0.7421351600392257D-1*t1629*t333
     #-0.1484270320078451D0*t155*t336-0.1731648706758193D0*t155*t341)
      t1711 = rho*(0.9327207260896469D-1*t1587*t489
     #+0.310906908696549D-1*t79*t1704*t201-0.310906908696549D-1*t349
     #*t1642)
      v2rhoasigmaaa(i) = t1646+t1649+t1711
      t1713 = 0.6218138173930979D-1*t1648
      t1714 = 2.D0*t1711
      v2rhoasigmaab(i) = 2.D0*t1646+t1713+t1714
      v2rhoasigmabb(i) = v2rhoasigmaaa(i)
      t1729 = 0.1362107888567592D0*t1604*t376
      t1732 = 0.2724215777135184D0*t1607*t84*t363
      t1765 = rho*(0.9327207260896469D-1*t1587*t1192
     #+0.310906908696549D-1*t79*(-0.2724215777135184D0*t168*t366
     #-0.3710675800196129D-1*t1593*t1594*t363+0.2724215777135184D0
     #*t150*t180*t363*t417+0.1362107888567592D0*t93*t1198
     #+0.1362107888567592D0*t81*t84*(-t1729-t1732)*t111
     #-0.1362107888567592D0*t177*t1239*t417-0.1362107888567592D0*t93
     #*t395-0.1855337900098064D-1*t1620*t1621*t394
     #+0.2724215777135184D0*t177*t613*t394*t417-0.1362107888567592D0
     #*t177*t180*(-t1729-t1732-0.7421351600392257D-1*t1629*t388
     #-0.1484270320078451D0*t155*t391))*t201-0.310906908696549D-1*t399
     #*t1642)
      v2rhobsigmaaa(i) = t1765+t1649+t1711
      v2rhobsigmaab(i) = 2.D0*t1765+t1713+t1714
      v2rhobsigmabb(i) = v2rhobsigmaaa(i)
      t1774 = t417**2
      t1785 = t404*(0.3710675800196129D-1*t107*t1594
     #-0.2724215777135184D0*t93*t418-0.3710675800196129D-1*t1620*t1621
     #*t417+0.2724215777135184D0*t177*t613*t1774-0.5054340779364009D-2
     #*sigma*t641*t1008*t180*t99)*t201
      t1787 = t421**2
      t1789 = t404*t1787*t666
      v2sigmaaa2(i) = 0.310906908696549D-1*t1785-0.310906908696549D-1
     #*t1789
      v2sigmaaaab(i) = 0.6218138173930979D-1*t1785
     #-0.6218138173930979D-1*t1789
      v2sigmaaabb(i) = v2sigmaaa2(i)
      v2sigmaab2(i) = 0.1243627634786196D0*t1785-0.1243627634786196D0
     #*t1789
      v2sigmaabbb(i) = v2sigmaaaab(i)
      v2sigmabb2(i) = v2sigmaaabb(i)
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      v2rhob2(i) = 0.0d0
      v2rhoab(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2rhoasigmaab(i) = 0.0d0
      v2rhoasigmabb(i) = 0.0d0
      v2rhobsigmaaa(i) = 0.0d0
      v2rhobsigmaab(i) = 0.0d0
      v2rhobsigmabb(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      v2sigmaab2(i) = 0.0d0
      v2sigmabb2(i) = 0.0d0
      v2sigmaaaab(i) = 0.0d0
      v2sigmaaabb(i) = 0.0d0
      v2sigmaabbb(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end
      
      
      subroutine rks_c_pbe
     & (ideriv,npt,rhoa1,sigmaaa1,
     &  zk,vrhoa,vsigmaaa,
     &  v2rhoa2,v2rhoasigmaaa,v2sigmaaa2)
c
c     J.P. Perdew, K. Burke, and M. Ernzerhof
c     Generalized gradient approximation made simple
c     Phys. Rev. Lett. 77 (1996) 3865-3868
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt)
      REAL sigmaaa1(npt)
      REAL zk(npt),vrhoa(npt),vsigmaaa(npt)
      REAL v2rhoa2(npt),v2rhoasigmaaa(npt),v2sigmaaa2(npt)
      parameter(tol=1.0d-20)
      
      if(ideriv.eq.0) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = 1/rho
      t3 = t2**(1.D0/3.D0)
      t6 = t2**(1.D0/6.D0)
      t9 = dsqrt(t2)
      t11 = t3**2
      t17 = dlog(1.D0+0.1608197949869254D2/(0.598255043577108D1*t6
     #+0.2225569421150687D1*t3+0.8004286349993634D0*t9
     #+0.1897004325747559D0*t11))
      t18 = (1.D0+0.1325688999052018D0*t3)*t17
      t20 = rho**2
      t21 = rho**(1.D0/3.D0)
      t23 = 1/t21/t20
      t26 = dexp(0.2000000587336264D1*t18)
      t27 = t26-1.D0
      t31 = 0.1362107888567592D0/t27*sigma*t23
      t33 = t27**2
      t35 = sigma**2
      t37 = t20**2
      t38 = t21**2
      t49 = dlog(1.D0+0.1362107888567592D0*sigma*t23*(1.D0+t31)/(1.D0
     #+t31+0.1855337900098064D-1/t33*t35/t38/t37))
      zk(i) = rho*(-0.621814D-1*t18+0.310906908696549D-1*t49)
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = 1/rho
      t3 = t2**(1.D0/3.D0)
      t5 = 1.D0+0.1325688999052018D0*t3
      t6 = t2**(1.D0/6.D0)
      t9 = dsqrt(t2)
      t11 = t3**2
      t13 = 0.598255043577108D1*t6+0.2225569421150687D1*t3
     #+0.8004286349993634D0*t9+0.1897004325747559D0*t11
      t16 = 1.D0+0.1608197949869254D2/t13
      t17 = dlog(t16)
      t18 = t5*t17
      t19 = 0.621814D-1*t18
      t20 = rho**2
      t21 = rho**(1.D0/3.D0)
      t23 = 1/t21/t20
      t24 = sigma*t23
      t26 = dexp(0.2000000587336264D1*t18)
      t27 = t26-1.D0
      t28 = 1/t27
      t29 = t28*sigma
      t31 = 0.1362107888567592D0*t29*t23
      t32 = 1.D0+t31
      t33 = t27**2
      t34 = 1/t33
      t35 = sigma**2
      t36 = t34*t35
      t37 = t20**2
      t38 = t21**2
      t40 = 1/t38/t37
      t43 = 1.D0+t31+0.1855337900098064D-1*t36*t40
      t44 = 1/t43
      t45 = t32*t44
      t48 = 1.D0+0.1362107888567592D0*t24*t45
      t49 = dlog(t48)
      t50 = 0.310906908696549D-1*t49
      zk(i) = rho*(-t19+t50)
      t53 = 1/t20
      t54 = 1/t11*t53
      t56 = 0.2747773264188438D-2*t54*t17
      t57 = t13**2
      t60 = t6**2
      t61 = t60**2
      t77 = 0.1D1*t5/t57*(-0.99709173929518D0/t61/t6*t53
     #-0.7418564737168958D0*t54-0.4002143174996817D0/t9*t53
     #-0.1264669550498372D0/t3*t53)/t16
      t80 = 1/t21/t20/rho
      t84 = t34*sigma
      t85 = t56+t77
      t89 = 0.4381079514373337D1*t84*t23*t85*t26
      t91 = 0.3178251739991049D0*t29*t80
      t96 = t43**2
      t98 = t32/t96
      t116 = 1/t48
      vrhoa(i) = -t19+t50+rho*(t56+t77+0.310906908696549D-1*(
     #-0.3178251739991049D0*sigma*t80*t45+0.1362107888567592D0*t24*
     #(t89-t91)*t44-0.1362107888567592D0*t24*t98*(t89-t91
     #+0.119350059339396D1/t33/t27*t35*t40*t85*t26
     #-0.8658243533790967D-1*t36/t38/t37/rho))*t116)
      vsigmaaa(i) = 0.1243627634786196D0*rho*(0.1362107888567592D0*t23
     #*t32*t44+0.1855337900098064D-1*sigma*t40*t28*t44
     #-0.1362107888567592D0*t24*t98*(0.1362107888567592D0*t28*t23
     #+0.3710675800196129D-1*t84*t40))*t116
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = 1/rho
      t3 = t2**(1.D0/3.D0)
      t5 = 1.D0+0.1325688999052018D0*t3
      t6 = t2**(1.D0/6.D0)
      t9 = dsqrt(t2)
      t11 = t3**2
      t13 = 0.598255043577108D1*t6+0.2225569421150687D1*t3
     #+0.8004286349993634D0*t9+0.1897004325747559D0*t11
      t16 = 1.D0+0.1608197949869254D2/t13
      t17 = dlog(t16)
      t18 = t5*t17
      t19 = 0.621814D-1*t18
      t20 = rho**2
      t21 = rho**(1.D0/3.D0)
      t23 = 1/t21/t20
      t24 = sigma*t23
      t26 = dexp(0.2000000587336264D1*t18)
      t27 = t26-1.D0
      t28 = 1/t27
      t29 = t28*sigma
      t31 = 0.1362107888567592D0*t29*t23
      t32 = 1.D0+t31
      t33 = t27**2
      t34 = 1/t33
      t35 = sigma**2
      t36 = t34*t35
      t37 = t20**2
      t38 = t21**2
      t40 = 1/t38/t37
      t43 = 1.D0+t31+0.1855337900098064D-1*t36*t40
      t44 = 1/t43
      t45 = t32*t44
      t48 = 1.D0+0.1362107888567592D0*t24*t45
      t49 = dlog(t48)
      t50 = 0.310906908696549D-1*t49
      zk(i) = rho*(-t19+t50)
      t52 = 1/t11
      t53 = 1/t20
      t54 = t52*t53
      t55 = t54*t17
      t56 = 0.2747773264188438D-2*t55
      t57 = t13**2
      t58 = 1/t57
      t59 = t5*t58
      t60 = t6**2
      t61 = t60**2
      t62 = t61*t6
      t63 = 1/t62
      t67 = 1/t9
      t70 = 1/t3
      t73 = -0.99709173929518D0*t63*t53-0.7418564737168958D0*t54
     #-0.4002143174996817D0*t67*t53-0.1264669550498372D0*t70*t53
      t74 = 1/t16
      t76 = t59*t73*t74
      t77 = 0.1D1*t76
      t78 = t20*rho
      t80 = 1/t21/t78
      t81 = sigma*t80
      t84 = t34*sigma
      t85 = t56+t77
      t89 = 0.4381079514373337D1*t84*t23*t85*t26
      t91 = 0.3178251739991049D0*t29*t80
      t92 = t89-t91
      t93 = t92*t44
      t96 = t43**2
      t97 = 1/t96
      t98 = t32*t97
      t100 = 1/t33/t27
      t101 = t100*t35
      t103 = t40*t85*t26
      t108 = 1/t38/t37/rho
      t111 = t89-t91+0.119350059339396D1*t101*t103
     #-0.8658243533790967D-1*t36*t108
      t112 = t98*t111
      t115 = -0.3178251739991049D0*t81*t45+0.1362107888567592D0*t24
     #*t93-0.1362107888567592D0*t24*t112
      t116 = 1/t48
      t117 = t115*t116
      vrhoa(i) = -t19+t50+rho*(t56+t77+0.310906908696549D-1*t117)
      t121 = t23*t32
      t124 = sigma*t40
      t125 = t28*t44
      t132 = 0.1362107888567592D0*t28*t23+0.3710675800196129D-1*t84*t40
      t133 = t98*t132
      t136 = 0.1362107888567592D0*t121*t44+0.1855337900098064D-1*t124
     #*t125-0.1362107888567592D0*t24*t133
      vsigmaaa(i) = 0.1243627634786196D0*rho*t136*t116
      t151 = dlog(1.D0+0.2960874997779344D2/(0.8157414703487641D1*t6
     #+0.2247591863577616D1*t3+0.4300972471276643D0*t9
     #+0.1911512595127338D0*t11))
      t153 = (1.D0+0.6901399211255825D-1*t3)*t151*t53
      t155 = t49*t53
      t158 = 1/t21/t37
      t160 = sigma*t158*t45
      t165 = -0.1086299437397317D1*t153+0.1333333724890842D1*t18*t53
      t169 = 0.1362107888567592D0*t84*t23*t165*t26
      t170 = t29*t158
      t171 = 0.6053812838078188D-1*t170
      t183 = t36/t38/t37/t20
      t197 = -t165
      t201 = 0.1362107888567592D0*t84*t23*t197*t26
      t202 = 0.6053812838078188D-1*t170
      t223 = 1/t37
      t226 = 1/t78
      t231 = 1/t11/t2*t223
      t233 = t52*t226
      t250 = 0.1D1*t59*(-0.8309097827459833D0/t62/t2*t223
     #+0.199418347859036D1*t63*t226-0.4945709824779306D0*t231
     #+0.1483712947433792D1*t233-0.2001071587498409D0/t9/t2*t223
     #+0.8004286349993634D0*t67*t226-0.4215565168327908D-1/t3/t2*t223
     #+0.2529339100996745D0*t70*t226)*t74
      t251 = t57**2
      t254 = t73**2
      t255 = t16**2
      t259 = 0.1608197949869254D2*t5/t251*t254/t255
      t261 = 0.1831848842792292D-2*t231*t17
      t265 = 0.8837926660346786D-1*t54*t58*t73*t74
      t271 = 0.2D1*t5/t57/t13*t254*t74
      t273 = 0.5495546528376876D-2*t233*t17
      t274 = t115**2
      t275 = t48**2
      t276 = 1/t275
      t282 = t92*t97
      t287 = 1/t96/t43
      t288 = t32*t287
      t289 = t111**2
      t293 = t250+t259+t261-t265-t271-t273
      t297 = 0.4381079514373337D1*t84*t23*t293*t26
      t298 = t85**2
      t299 = t23*t298
      t302 = 0.1409129032462046D3*t84*t299*t26
      t311 = t33**2
      t314 = t40*t298
      t315 = t26**2
      t325 = 0.2044503773374224D2*t84*t80*t85*t26
      t326 = t100*sigma
      t329 = 0.2818258064924092D3*t326*t299*t315
      t330 = 0.1059417246663683D1*t170
      s1 = 0.1099109305675375D-1*t55+0.4D1*t76+rho*(0.337738D-1*t153
     #-0.207271272464366D-1*t155+0.310906908696549D-1*
     #(0.6053812838078188D-1*t160+0.1362107888567592D0*t24*(-t169+t171
     #)*t44-0.1362107888567592D0*t24*t98*(-t169+t171
     #-0.3710675800196129D-1*t101*t40*t165*t26+0.1649189244531613D-1
     #*t183))*t116)
      s2 = s1+rho*(-0.337738D-1*t153+0.207271272464366D-1*t155
     #+0.310906908696549D-1*(-0.6053812838078188D-1*t160
     #+0.1362107888567592D0*t24*(-t201-t202)*t44-0.1362107888567592D0
     #*t24*t98*(-t201-t202-0.3710675800196129D-1*t101*t40*t197*t26
     #-0.1649189244531613D-1*t183))*t116)
      v2rhoa2(i) = s2+2.D0*rho*(t250+t259+t261-t265-t271-t273
     #-0.310906908696549D-1*t274*t276+0.310906908696549D-1*
     #(0.1059417246663683D1*t160-0.6356503479982097D0*t81*t93
     #-0.2724215777135184D0*t24*t282*t111+0.2724215777135184D0*t24
     #*t288*t289-0.1362107888567592D0*t24*t98*(t297-t302
     #-0.1113933887167696D2*t101*t108*t85*t26+0.119350059339396D1*t101
     #*t40*t293*t26+0.1151631462675703D3/t311*t35*t314*t315
     #-0.3838771542252344D2*t101*t314*t26-t325+t329+t330
     #+0.4906338002481548D0*t183)+0.6356503479982097D0*t81*t112
     #+0.1362107888567592D0*t24*(t329-t325+t297-t302+t330)*t44)*t116)
     #+0.1243627634786196D0*t117
      t365 = 0.4381079514373337D1*t34*t23*t85*t26
      t367 = 0.3178251739991049D0*t28*t80
      t378 = t28*t97
      v2rhoasigmaaa(i) = 0.1243627634786196D0*t136*t116+4.D0*rho*
     #(0.310906908696549D-1*(-0.3178251739991049D0*t80*t32*t44
     #-0.4329121766895483D-1*sigma*t108*t125+0.3178251739991049D0*t81
     #*t133+0.1362107888567592D0*t23*t92*t44+0.1362107888567592D0*t24*
     #(t365-t367)*t44-0.1362107888567592D0*t24*t282*t132
     #-0.1362107888567592D0*t121*t97*t111-0.1855337900098064D-1*t124
     #*t378*t111+0.2724215777135184D0*t24*t32*t287*t111*t132
     #-0.1362107888567592D0*t24*t98*(t365-t367+0.238700118678792D1
     #*t326*t103-0.1731648706758193D0*t84*t108))*t116
     #-0.310906908696549D-1*t115*t276*t136)
      t413 = t132**2
      t427 = t136**2
      v2sigmaaa2(i) = 0.4974510539144783D0*rho*(0.3710675800196129D-1
     #*t40*t28*t44-0.2724215777135184D0*t121*t97*t132
     #-0.3710675800196129D-1*t124*t378*t132+0.2724215777135184D0*t24
     #*t288*t413-0.5054340779364009D-2*sigma/t37/t78*t98*t34)*t116
     #-0.4974510539144783D0*rho*t427*t276
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end

c:C_PBEsubrend
_ENDIF
_IF(ccpdft,all,c_p86,c_pz81)
c
c-----------------------------------------------------------------------
c
      REAL function piecewise(o,a,b)
c
c     Fix for a Maple problem. The Maple Fortran generator is not
c     able to transform its piecewise command to Fortran. Therefore
c     this function was written to take care of this.
c
      implicit none
      logical o
      REAL a, b
      if (o) then
         piecewise = a
      else
         piecewise = b
      endif
      return
      end
_ENDIF
_IF(ccpdft,all,c_ft97,xc_ft97)
c
c----------------------------------------------------------------------
c
      SUBROUTINE CALCEI(ARG,RESULT,INT)
C----------------------------------------------------------------------
C
C This Fortran 77 packet computes the exponential integrals Ei(x),
C  E1(x), and  exp(-x)*Ei(x)  for real arguments  x  where
C
C           integral (from t=-infinity to t=x) (exp(t)/t),  x > 0,
C  Ei(x) =
C          -integral (from t=-x to t=infinity) (exp(t)/t),  x < 0,
C
C  and where the first integral is a principal value integral.
C  The packet contains three function type subprograms: EI, EONE,
C  and EXPEI;  and one subroutine type subprogram: CALCEI.  The
C  calling statements for the primary entries are
C
C                 Y = EI(X),            where  X .NE. 0,
C
C                 Y = EONE(X),          where  X .GT. 0,
C  and
C                 Y = EXPEI(X),         where  X .NE. 0,
C
C  and where the entry points correspond to the functions Ei(x),
C  E1(x), and exp(-x)*Ei(x), respectively.  The routine CALCEI
C  is intended for internal packet use only, all computations within
C  the packet being concentrated in this routine.  The function
C  subprograms invoke CALCEI with the Fortran statement
C         CALL CALCEI(ARG,RESULT,INT)
C  where the parameter usage is as follows
C
C     Function                  Parameters for CALCEI
C       Call                 ARG             RESULT         INT
C
C      EI(X)              X .NE. 0          Ei(X)            1
C      EONE(X)            X .GT. 0         -Ei(-X)           2
C      EXPEI(X)           X .NE. 0          exp(-X)*Ei(X)    3
C
C  The main computation involves evaluation of rational Chebyshev
C  approximations published in Math. Comp. 22, 641-649 (1968), and
C  Math. Comp. 23, 289-303 (1969) by Cody and Thacher.  This
C  transportable program is patterned after the machine-dependent
C  FUNPACK packet  NATSEI,  but cannot match that version for
C  efficiency or accuracy.  This version uses rational functions
C  that theoretically approximate the exponential integrals to
C  at least 18 significant decimal digits.  The accuracy achieved
C  depends on the arithmetic system, the compiler, the intrinsic
C  functions, and proper selection of the machine-dependent
C  constants.
C
C
C*******************************************************************
C*******************************************************************
C
C Explanation of machine-dependent constants
C
C   beta = radix for the floating-point system.
C   minexp = smallest representable power of beta.
C   maxexp = smallest power of beta that overflows.
C   XBIG = largest argument acceptable to EONE; solution to
C          equation:
C                     exp(-x)/x * (1 + 1/x) = beta ** minexp.
C   XINF = largest positive machine number; approximately
C                     beta ** maxexp
C   XMAX = largest argument acceptable to EI; solution to
C          equation:  exp(x)/x * (1 + 1/x) = beta ** maxexp.
C
C     Approximate values for some important machines are:
C
C                           beta      minexp      maxexp
C
C  CRAY-1        (S.P.)       2       -8193        8191
C  Cyber 180/185 
C    under NOS   (S.P.)       2        -975        1070
C  IEEE (IBM/XT,
C    SUN, etc.)  (S.P.)       2        -126         128
C  IEEE (IBM/XT,
C    SUN, etc.)  (D.P.)       2       -1022        1024
C  IBM 3033      (D.P.)      16         -65          63
C  VAX D-Format  (D.P.)       2        -128         127
C  VAX G-Format  (D.P.)       2       -1024        1023
C
C                           XBIG       XINF       XMAX
C
C  CRAY-1        (S.P.)    5670.31  5.45E+2465   5686.21
C  Cyber 180/185 
C    under NOS   (S.P.)     669.31  1.26E+322     748.28
C  IEEE (IBM/XT,
C    SUN, etc.)  (S.P.)      82.93  3.40E+38       93.24
C  IEEE (IBM/XT,
C    SUN, etc.)  (D.P.)     701.84  1.79D+308     716.35
C  IBM 3033      (D.P.)     175.05  7.23D+75      179.85
C  VAX D-Format  (D.P.)      84.30  1.70D+38       92.54
C  VAX G-Format  (D.P.)     703.22  8.98D+307     715.66
C
C*******************************************************************
C*******************************************************************
C
C error returns
C
C  The following table shows the types of error that may be
C  encountered in this routine and the function value supplied
C  in each case.
C
C       error       Argument         Function values for
C                    Range         EI      EXPEI     EONE
C
C     UNDERFLOW  (-)X .GT. XBIG     0        -         0
C     OVERFLOW      X .GE. XMAX    XINF      -         -
C     ILLEGAL X       X = 0       -XINF    -XINF     XINF
C     ILLEGAL X      X .LT. 0       -        -     USE ABS(X)
C
C Intrinsic functions required are:
C
C     ABS, SQRT, EXP
C
C
C  Author: W. J. Cody
C          Mathematics abd Computer Science Division
C          Argonne National Laboratory
C          Argonne, IL 60439
C
C  Latest modification: September 9, 1988
C
C----------------------------------------------------------------------
      INTEGER I,INT
CS    REAL
CD    DOUBLE PRECISION 
      REAL
     1       A,ARG,B,C,D,EXP40,E,EI,F,FOUR,FOURTY,FRAC,HALF,ONE,P,
     2       PLG,PX,P037,P1,P2,q,QLG,QX,Q1,Q2,R,RESULT,S,SIX,SUMP,
     3       SUMQ,T,THREE,TWELVE,TWO,TWO4,W,X,XBIG,XINF,XMAX,XMX0,
     4       X0,X01,X02,X11,Y,YSQ,ZERO
      DIMENSION  A(7),B(6),C(9),D(9),E(10),F(10),P(10),q(10),R(10),
     1   S(9),P1(10),Q1(9),P2(10),Q2(9),PLG(4),QLG(4),PX(10),QX(10)
C----------------------------------------------------------------------
C  Mathematical constants
C   EXP40 = exp(40)
C   X0 = zero of Ei
C   X01/X11 + X02 = zero of Ei to extra precision
C----------------------------------------------------------------------
CS    DATA ZERO,P037,HALF,ONE,TWO/0.0E0,0.037E0,0.5E0,1.0E0,2.0E0/,
CS   1     THREE,FOUR,SIX,TWELVE,TWO4/3.0E0,4.0E0,6.0E0,12.E0,24.0E0/,
CS   2     FOURTY,EXP40/40.0E0,2.3538526683701998541E17/,
CS   3     X01,X11,X02/381.5E0,1024.0E0,-5.1182968633365538008E-5/,
CS   4     X0/3.7250741078136663466E-1/
      DATA ZERO,P037,HALF,ONE,TWO/0.0D0,0.037D0,0.5D0,1.0D0,2.0D0/,
     1     THREE,FOUR,SIX,TWELVE,TWO4/3.0D0,4.0D0,6.0D0,12.D0,24.0D0/,
     2     FOURTY,EXP40/40.0D0,2.3538526683701998541D17/,
     3     X01,X11,X02/381.5D0,1024.0D0,-5.1182968633365538008D-5/,
     4     X0/3.7250741078136663466D-1/
C----------------------------------------------------------------------
C Machine-dependent constants
C----------------------------------------------------------------------
CS    DATA XINF/3.40E+38/,XMAX/93.246E0/,XBIG/82.93E0/
      DATA XINF/1.79D+308/,XMAX/716.351D0/,XBIG/701.84D0/
C----------------------------------------------------------------------
C Coefficients  for -1.0 <= X < 0.0
C----------------------------------------------------------------------
CS    DATA A/1.1669552669734461083368E2, 2.1500672908092918123209E3,
CS   1       1.5924175980637303639884E4, 8.9904972007457256553251E4,
CS   2       1.5026059476436982420737E5,-1.4815102102575750838086E5,
CS   3       5.0196785185439843791020E0/
CS    DATA B/4.0205465640027706061433E1, 7.5043163907103936624165E2,
CS   1       8.1258035174768735759855E3, 5.2440529172056355429883E4,
CS   2       1.8434070063353677359298E5, 2.5666493484897117319268E5/
      DATA A/1.1669552669734461083368D2, 2.1500672908092918123209D3,
     1       1.5924175980637303639884D4, 8.9904972007457256553251D4,
     2       1.5026059476436982420737D5,-1.4815102102575750838086D5,
     3       5.0196785185439843791020D0/
      DATA B/4.0205465640027706061433D1, 7.5043163907103936624165D2,
     1       8.1258035174768735759855D3, 5.2440529172056355429883D4,
     2       1.8434070063353677359298D5, 2.5666493484897117319268D5/
C----------------------------------------------------------------------
C Coefficients for -4.0 <= X < -1.0
C----------------------------------------------------------------------
CS    DATA C/3.828573121022477169108E-1, 1.107326627786831743809E+1,
CS   1       7.246689782858597021199E+1, 1.700632978311516129328E+2,
CS   2       1.698106763764238382705E+2, 7.633628843705946890896E+1,
CS   3       1.487967702840464066613E+1, 9.999989642347613068437E-1,
CS   4       1.737331760720576030932E-8/
CS    DATA D/8.258160008564488034698E-2, 4.344836335509282083360E+0,
CS   1       4.662179610356861756812E+1, 1.775728186717289799677E+2,
CS   2       2.953136335677908517423E+2, 2.342573504717625153053E+2,
CS   3       9.021658450529372642314E+1, 1.587964570758947927903E+1,
CS   4       1.000000000000000000000E+0/
      DATA C/3.828573121022477169108D-1, 1.107326627786831743809D+1,
     1       7.246689782858597021199D+1, 1.700632978311516129328D+2,
     2       1.698106763764238382705D+2, 7.633628843705946890896D+1,
     3       1.487967702840464066613D+1, 9.999989642347613068437D-1,
     4       1.737331760720576030932D-8/
      DATA D/8.258160008564488034698D-2, 4.344836335509282083360D+0,
     1       4.662179610356861756812D+1, 1.775728186717289799677D+2,
     2       2.953136335677908517423D+2, 2.342573504717625153053D+2,
     3       9.021658450529372642314D+1, 1.587964570758947927903D+1,
     4       1.000000000000000000000D+0/
C----------------------------------------------------------------------
C Coefficients for X < -4.0
C----------------------------------------------------------------------
CS    DATA E/1.3276881505637444622987E+2,3.5846198743996904308695E+4,
CS   1       1.7283375773777593926828E+5,2.6181454937205639647381E+5,
CS   2       1.7503273087497081314708E+5,5.9346841538837119172356E+4,
CS   3       1.0816852399095915622498E+4,1.0611777263550331766871E03,
CS   4       5.2199632588522572481039E+1,9.9999999999999999087819E-1/
CS    DATA F/3.9147856245556345627078E+4,2.5989762083608489777411E+5,
CS   1       5.5903756210022864003380E+5,5.4616842050691155735758E+5,
CS   2       2.7858134710520842139357E+5,7.9231787945279043698718E+4,
CS   3       1.2842808586627297365998E+4,1.1635769915320848035459E+3,
CS   4       5.4199632588522559414924E+1,1.0E0/
      DATA E/1.3276881505637444622987D+2,3.5846198743996904308695D+4,
     1       1.7283375773777593926828D+5,2.6181454937205639647381D+5,
     2       1.7503273087497081314708D+5,5.9346841538837119172356D+4,
     3       1.0816852399095915622498D+4,1.0611777263550331766871D03,
     4       5.2199632588522572481039D+1,9.9999999999999999087819D-1/
      DATA F/3.9147856245556345627078D+4,2.5989762083608489777411D+5,
     1       5.5903756210022864003380D+5,5.4616842050691155735758D+5,
     2       2.7858134710520842139357D+5,7.9231787945279043698718D+4,
     3       1.2842808586627297365998D+4,1.1635769915320848035459D+3,
     4       5.4199632588522559414924D+1,1.0D0/
C----------------------------------------------------------------------
C  Coefficients for rational approximation to ln(x/a), |1-x/a| < .1
C----------------------------------------------------------------------
CS    DATA PLG/-2.4562334077563243311E+01,2.3642701335621505212E+02,
CS   1         -5.4989956895857911039E+02,3.5687548468071500413E+02/
CS    DATA QLG/-3.5553900764052419184E+01,1.9400230218539473193E+02,
CS   1         -3.3442903192607538956E+02,1.7843774234035750207E+02/
      DATA PLG/-2.4562334077563243311D+01,2.3642701335621505212D+02,
     1         -5.4989956895857911039D+02,3.5687548468071500413D+02/
      DATA QLG/-3.5553900764052419184D+01,1.9400230218539473193D+02,
     1         -3.3442903192607538956D+02,1.7843774234035750207D+02/
C----------------------------------------------------------------------
C Coefficients for  0.0 < X < 6.0,
C  ratio of Chebyshev polynomials
C----------------------------------------------------------------------
CS    DATA P/-1.2963702602474830028590E01,-1.2831220659262000678155E03,
CS   1       -1.4287072500197005777376E04,-1.4299841572091610380064E06,
CS   2       -3.1398660864247265862050E05,-3.5377809694431133484800E08,
CS   3        3.1984354235237738511048E08,-2.5301823984599019348858E10,
CS   4        1.2177698136199594677580E10,-2.0829040666802497120940E11/
CS    DATA Q/ 7.6886718750000000000000E01,-5.5648470543369082846819E03,
CS   1        1.9418469440759880361415E05,-4.2648434812177161405483E06,
CS   2        6.4698830956576428587653E07,-7.0108568774215954065376E08,
CS   3        5.4229617984472955011862E09,-2.8986272696554495342658E10,
CS   4        9.8900934262481749439886E10,-8.9673749185755048616855E10/
      DATA P/-1.2963702602474830028590D01,-1.2831220659262000678155D03,
     1       -1.4287072500197005777376D04,-1.4299841572091610380064D06,
     2       -3.1398660864247265862050D05,-3.5377809694431133484800D08,
     3        3.1984354235237738511048D08,-2.5301823984599019348858D10,
     4        1.2177698136199594677580D10,-2.0829040666802497120940D11/
      DATA q/ 7.6886718750000000000000D01,-5.5648470543369082846819D03,
     1        1.9418469440759880361415D05,-4.2648434812177161405483D06,
     2        6.4698830956576428587653D07,-7.0108568774215954065376D08,
     3        5.4229617984472955011862D09,-2.8986272696554495342658D10,
     4        9.8900934262481749439886D10,-8.9673749185755048616855D10/
C----------------------------------------------------------------------
C J-fraction coefficients for 6.0 <= X < 12.0
C----------------------------------------------------------------------
CS    DATA R/-2.645677793077147237806E00,-2.378372882815725244124E00,
CS   1       -2.421106956980653511550E01, 1.052976392459015155422E01,
CS   2        1.945603779539281810439E01,-3.015761863840593359165E01,
CS   3        1.120011024227297451523E01,-3.988850730390541057912E00,
CS   4        9.565134591978630774217E00, 9.981193787537396413219E-1/
CS    DATA S/ 1.598517957704779356479E-4, 4.644185932583286942650E00,
CS   1        3.697412299772985940785E02,-8.791401054875438925029E00,
CS   2        7.608194509086645763123E02, 2.852397548119248700147E01,
CS   3        4.731097187816050252967E02,-2.369210235636181001661E02,
CS   4        1.249884822712447891440E00/
      DATA R/-2.645677793077147237806D00,-2.378372882815725244124D00,
     1       -2.421106956980653511550D01, 1.052976392459015155422D01,
     2        1.945603779539281810439D01,-3.015761863840593359165D01,
     3        1.120011024227297451523D01,-3.988850730390541057912D00,
     4        9.565134591978630774217D00, 9.981193787537396413219D-1/
      DATA S/ 1.598517957704779356479D-4, 4.644185932583286942650D00,
     1        3.697412299772985940785D02,-8.791401054875438925029D00,
     2        7.608194509086645763123D02, 2.852397548119248700147D01,
     3        4.731097187816050252967D02,-2.369210235636181001661D02,
     4        1.249884822712447891440D00/
C----------------------------------------------------------------------
C J-fraction coefficients for 12.0 <= X < 24.0
C----------------------------------------------------------------------
CS    DATA P1/-1.647721172463463140042E00,-1.860092121726437582253E01,
CS   1        -1.000641913989284829961E01,-2.105740799548040450394E01,
CS   2        -9.134835699998742552432E-1,-3.323612579343962284333E01,
CS   3         2.495487730402059440626E01, 2.652575818452799819855E01,
CS   4        -1.845086232391278674524E00, 9.999933106160568739091E-1/
CS    DATA Q1/ 9.792403599217290296840E01, 6.403800405352415551324E01,
CS   1         5.994932325667407355255E01, 2.538819315630708031713E02,
CS   2         4.429413178337928401161E01, 1.192832423968601006985E03,
CS   3         1.991004470817742470726E02,-1.093556195391091143924E01,
CS   4         1.001533852045342697818E00/
      DATA P1/-1.647721172463463140042D00,-1.860092121726437582253D01,
     1        -1.000641913989284829961D01,-2.105740799548040450394D01,
     2        -9.134835699998742552432D-1,-3.323612579343962284333D01,
     3         2.495487730402059440626D01, 2.652575818452799819855D01,
     4        -1.845086232391278674524D00, 9.999933106160568739091D-1/
      DATA Q1/ 9.792403599217290296840D01, 6.403800405352415551324D01,
     1         5.994932325667407355255D01, 2.538819315630708031713D02,
     2         4.429413178337928401161D01, 1.192832423968601006985D03,
     3         1.991004470817742470726D02,-1.093556195391091143924D01,
     4         1.001533852045342697818D00/
C----------------------------------------------------------------------
C J-fraction coefficients for  X .GE. 24.0
C----------------------------------------------------------------------
CS    DATA P2/ 1.75338801265465972390E02,-2.23127670777632409550E02,
CS   1        -1.81949664929868906455E01,-2.79798528624305389340E01,
CS   2        -7.63147701620253630855E00,-1.52856623636929636839E01,
CS   3        -7.06810977895029358836E00,-5.00006640413131002475E00,
CS   4        -3.00000000320981265753E00, 1.00000000000000485503E00/
CS    DATA Q2/ 3.97845977167414720840E04, 3.97277109100414518365E00,
CS   1         1.37790390235747998793E02, 1.17179220502086455287E02,
CS   2         7.04831847180424675988E01,-1.20187763547154743238E01,
CS   3        -7.99243595776339741065E00,-2.99999894040324959612E00,
CS   4         1.99999999999048104167E00/
      DATA P2/ 1.75338801265465972390D02,-2.23127670777632409550D02,
     1        -1.81949664929868906455D01,-2.79798528624305389340D01,
     2        -7.63147701620253630855D00,-1.52856623636929636839D01,
     3        -7.06810977895029358836D00,-5.00006640413131002475D00,
     4        -3.00000000320981265753D00, 1.00000000000000485503D00/
      DATA Q2/ 3.97845977167414720840D04, 3.97277109100414518365D00,
     1         1.37790390235747998793D02, 1.17179220502086455287D02,
     2         7.04831847180424675988D01,-1.20187763547154743238D01,
     3        -7.99243595776339741065D00,-2.99999894040324959612D00,
     4         1.99999999999048104167D00/
C----------------------------------------------------------------------
      X = ARG
      IF (X .EQ. ZERO) THEN
            EI = -XINF
            IF (INT .EQ. 2) EI = -EI
         ELSE IF ((X .LT. ZERO) .OR. (INT .EQ. 2)) THEN 
C----------------------------------------------------------------------
C Calculate EI for negative argument or for E1.
C----------------------------------------------------------------------
            Y = ABS(X)
            IF (Y .LE. ONE) THEN
                  SUMP = A(7) * Y + A(1)
                  SUMQ = Y + B(1)
                  DO 110 I = 2, 6
                     SUMP = SUMP * Y + A(I)
                     SUMQ = SUMQ * Y + B(I)
  110             CONTINUE
                  EI = LOG(Y) - SUMP / SUMQ
                  IF (INT .EQ. 3) EI = EI * EXP(Y)
               ELSE IF (Y .LE. FOUR) THEN
                  W = ONE / Y
                  SUMP = C(1)
                  SUMQ = D(1)
                  DO 130 I = 2, 9
                     SUMP = SUMP * W + C(I)
                     SUMQ = SUMQ * W + D(I)
  130             CONTINUE
                  EI = - SUMP / SUMQ
                  IF (INT .NE. 3) EI = EI * EXP(-Y)
               ELSE
                  IF ((Y .GT. XBIG) .AND. (INT .LT. 3)) THEN
                        EI = ZERO
                     ELSE
                        W = ONE / Y
                        SUMP = E(1) 
                        SUMQ = F(1)
                        DO 150 I = 2, 10
                           SUMP = SUMP * W + E(I)
                           SUMQ = SUMQ * W + F(I)
  150                   CONTINUE
                        EI = -W * (ONE - W * SUMP / SUMQ )
                        IF (INT .NE. 3) EI = EI * EXP(-Y)
                  END IF
            END IF
            IF (INT .EQ. 2) EI = -EI
         ELSE IF (X .LT. SIX) THEN
C----------------------------------------------------------------------
C  To improve conditioning, rational approximations are expressed
C    in terms of Chebyshev polynomials for 0 <= X < 6, and in
C    continued fraction form for larger X.
C----------------------------------------------------------------------
            T = X + X
            T = T / THREE - TWO
            PX(1) = ZERO
            QX(1) = ZERO
            PX(2) = P(1)
            QX(2) = q(1)
            DO 210 I = 2, 9
               PX(I+1) = T * PX(I) - PX(I-1) + P(I)
               QX(I+1) = T * QX(I) - QX(I-1) + q(I)
  210       CONTINUE
            SUMP = HALF * T * PX(10) - PX(9) + P(10)
            SUMQ = HALF * T * QX(10) - QX(9) + q(10)
            FRAC = SUMP / SUMQ
            XMX0 = (X - X01/X11) - X02
            IF (ABS(XMX0) .GE. P037) THEN
                  EI = LOG(X/X0) + XMX0 * FRAC
                  IF (INT .EQ. 3) EI = EXP(-X) * EI
               ELSE
C----------------------------------------------------------------------
C Special approximation to  ln(X/X0)  for X close to X0
C----------------------------------------------------------------------
                  Y = XMX0 / (X + X0)
                  YSQ = Y*Y
                  SUMP = PLG(1)
                  SUMQ = YSQ + QLG(1)
                  DO 220 I = 2, 4
                     SUMP = SUMP*YSQ + PLG(I)
                     SUMQ = SUMQ*YSQ + QLG(I)
  220             CONTINUE
                  EI = (SUMP / (SUMQ*(X+X0)) + FRAC) * XMX0
                  IF (INT .EQ. 3) EI = EXP(-X) * EI
            END IF
         ELSE IF (X .LT. TWELVE) THEN
            FRAC = ZERO
            DO 230 I = 1, 9
               FRAC = S(I) / (R(I) + X + FRAC)
  230       CONTINUE
            EI = (R(10) + FRAC) / X
            IF (INT .NE. 3) EI = EI * EXP(X)
         ELSE IF (X .LE. TWO4) THEN
            FRAC = ZERO
            DO 240 I = 1, 9
               FRAC = Q1(I) / (P1(I) + X + FRAC)
  240       CONTINUE
            EI = (P1(10) + FRAC) / X
            IF (INT .NE. 3) EI = EI * EXP(X)
         ELSE
            IF ((X .GE. XMAX) .AND. (INT .LT. 3)) THEN
                  EI = XINF
               ELSE
                  Y = ONE / X
                  FRAC = ZERO
                  DO 250 I = 1, 9
                     FRAC = Q2(I) / (P2(I) + X + FRAC)
  250             CONTINUE
                  FRAC = P2(10) + FRAC
                  EI = Y + Y * Y * FRAC
                  IF (INT .NE. 3) THEN
                        IF (X .LE. XMAX-TWO4) THEN
                              EI = EI * EXP(X)
                           ELSE
C----------------------------------------------------------------------
C Calculation reformulated to avoid premature overflow
C----------------------------------------------------------------------
                              EI = (EI * EXP(X-FOURTY)) * EXP40
                        END IF
                  END IF
            END IF
      END IF
      RESULT = EI
      RETURN
C---------- Last line of CALCEI ----------
      END
      FUNCTION EI(X)
C--------------------------------------------------------------------
C
C This function program computes approximate values for the
C   exponential integral  Ei(x), where  x  is real.
C
C  Author: W. J. Cody
C
C  Latest modification: January 12, 1988
C
C--------------------------------------------------------------------
      INTEGER INT
CS    REAL  EI, X, RESULT
CD    DOUBLE PRECISION  EI, X, RESULT
      REAL  EI, X, RESULT
C--------------------------------------------------------------------
      INT = 1
      CALL CALCEI(X,RESULT,INT)
      EI = RESULT
      RETURN
C---------- Last line of EI ----------
      END
      FUNCTION EXPEI(X)
C--------------------------------------------------------------------
C
C This function program computes approximate values for the
C   function  exp(-x) * Ei(x), where  Ei(x)  is the exponential
C   integral, and  x  is real.
C
C  Author: W. J. Cody
C
C  Latest modification: January 12, 1988
C
C--------------------------------------------------------------------
      INTEGER INT
CS    REAL  EXPEI, X, RESULT
      REAL  EXPEI, X, RESULT
CD    DOUBLE PRECISION  EXPEI, X, RESULT
C--------------------------------------------------------------------
      INT = 3
      CALL CALCEI(X,RESULT,INT)
      EXPEI = RESULT
      RETURN
C---------- Last line of EXPEI ----------
      END
      FUNCTION E1(X)
C--------------------------------------------------------------------
C
C This function program computes approximate values for the
C   exponential integral E1(x), where  x  is real.
C
C  Author: W. J. Cody
C
C  Latest modification: January 12, 1988
C
C--------------------------------------------------------------------
      INTEGER INT
CS    REAL  EONE, X, RESULT
CD    DOUBLE PRECISION  EONE, X, RESULT
      REAL  E1, X, RESULT
C--------------------------------------------------------------------
      INT = 2
      CALL CALCEI(X,RESULT,INT)
      E1 = RESULT
      RETURN
C---------- Last line of E1 ----------
      END
_ENDIF
_IF(ccpdft,all,x_b3)
c:X_B3subrstart

c    Generated: Wed Jan 29 09:08:33 GMT 2003

      subroutine uks_x_b3
     & (ideriv,npt,rhoa1,rhob1,sigmaaa1,sigmabb1,sigmaab1,
     &  zk,vrhoa,vrhob,vsigmaaa,vsigmabb,vsigmaab,
     &  v2rhoa2,v2rhob2,v2rhoab,
     &  v2rhoasigmaaa,v2rhoasigmaab,v2rhoasigmabb,
     &  v2rhobsigmabb,v2rhobsigmaab,v2rhobsigmaaa,
     &  v2sigmaaa2,v2sigmaaaab,v2sigmaaabb,
     &  v2sigmaab2,v2sigmaabbb,v2sigmabb2)
c
c     A.D. Becke
c     Density-functional thermochemistry. III. The role of
c     exact exchange
c     J. Chem. Phys. 98 (1993) 5648-5652
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt),rhob1(npt)
      REAL sigmaaa1(npt),sigmabb1(npt),sigmaab1(npt)
      REAL zk(npt),vrhoa(npt),vrhob(npt)
      REAL vsigmaaa(npt),vsigmabb(npt),vsigmaab(npt)
      REAL v2rhoa2(npt),v2rhob2(npt),v2rhoab(npt)
      REAL v2rhoasigmaaa(npt),v2rhoasigmaab(npt)
      REAL v2rhoasigmabb(npt),v2rhobsigmabb(npt)
      REAL v2rhobsigmaab(npt),v2rhobsigmaaa(npt)
      REAL v2sigmaaa2(npt),v2sigmaaaab(npt),v2sigmaaabb(npt)
      REAL v2sigmaab2(npt),v2sigmaabbb(npt),v2sigmabb2(npt)
      parameter(tol=1.0d-20)
      
      if (ideriv.eq.0) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t3 = t2*rhob
      t5 = 1/t3
      t7 = dsqrt(sigmabb)
      t8 = t7*t5
      t9 = dlog(t8+dsqrt(1+t8**2))
      zk(i) = -0.74442058907928D0*t3-0.3024D-2*t5*sigmabb/(1.D0
     #+0.252D-1*t8*t9)
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t3 = t2*rhoa
      t5 = 1/t3
      t7 = dsqrt(sigmaaa)
      t8 = t7*t5
      t9 = dlog(t8+dsqrt(1+t8**2))
      zk(i) = -0.74442058907928D0*t3-0.3024D-2*t5*sigmaaa/(1.D0
     #+0.252D-1*t8*t9)
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t5 = t4*rhoa
      t7 = 1/t5
      t9 = dsqrt(sigmaaa)
      t10 = t9*t7
      t11 = dlog(t10+dsqrt(1+t10**2))
      t18 = rhob**(1.D0/3.D0)
      t19 = t18*rhob
      t21 = 1/t19
      t23 = dsqrt(sigmabb)
      t24 = t23*t21
      t25 = dlog(t24+dsqrt(1+t24**2))
      zk(i) = -0.74442058907928D0*t5-0.3024D-2*t7*sigmaaa/(1.D0
     #+0.252D-1*t10*t11)-0.74442058907928D0*t19-0.3024D-2*t21*sigmabb/
     #(1.D0+0.252D-1*t24*t25)
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t3 = t2*rhob
      t5 = 1/t3
      t6 = t5*sigmabb
      t7 = dsqrt(sigmabb)
      t8 = t7*t5
      t9 = dlog(t8+dsqrt(1+t8**2))
      t12 = 1.D0+0.252D-1*t8*t9
      t13 = 1/t12
      zk(i) = -0.74442058907928D0*t3-0.3024D-2*t6*t13
      vrhoa(i) = 0.D0
      t17 = rhob**2
      t19 = 1/t2/t17
      t23 = t12**2
      t24 = 1/t23
      t29 = t2**2
      t34 = 1/t29/t17
      t37 = dsqrt(1.D0+sigmabb*t34)
      t38 = 1/t37
      vrhob(i) = -0.99256078543904D0*t2+0.4032D-2*t19*sigmabb*t13
     #+0.3024D-2*t6*t24*(-0.336D-1*t7*t19*t9-0.336D-1*sigmabb/t29/t17
     #/rhob*t38)
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      vsigmabb(i) = -0.3024D-2*t5*t13+0.3024D-2*t6*t24*(0.126D-1/t7*t5
     #*t9+0.126D-1*t34*t38)
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t3 = t2*rhoa
      t5 = 1/t3
      t6 = t5*sigmaaa
      t7 = dsqrt(sigmaaa)
      t8 = t7*t5
      t9 = dlog(t8+dsqrt(1+t8**2))
      t12 = 1.D0+0.252D-1*t8*t9
      t13 = 1/t12
      zk(i) = -0.74442058907928D0*t3-0.3024D-2*t6*t13
      t17 = rhoa**2
      t19 = 1/t2/t17
      t23 = t12**2
      t24 = 1/t23
      t29 = t2**2
      t34 = 1/t29/t17
      t37 = dsqrt(1.D0+sigmaaa*t34)
      t38 = 1/t37
      vrhoa(i) = -0.99256078543904D0*t2+0.4032D-2*t19*sigmaaa*t13
     #+0.3024D-2*t6*t24*(-0.336D-1*t7*t19*t9-0.336D-1*sigmaaa/t29/t17
     #/rhoa*t38)
      vrhob(i) = 0.D0
      vsigmaaa(i) = -0.3024D-2*t5*t13+0.3024D-2*t6*t24*(0.126D-1/t7*t5
     #*t9+0.126D-1*t34*t38)
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t5 = t4*rhoa
      t7 = 1/t5
      t8 = t7*sigmaaa
      t9 = dsqrt(sigmaaa)
      t10 = t9*t7
      t11 = dlog(t10+dsqrt(1+t10**2))
      t14 = 1.D0+0.252D-1*t10*t11
      t15 = 1/t14
      t18 = rhob**(1.D0/3.D0)
      t19 = t18*rhob
      t21 = 1/t19
      t22 = t21*sigmabb
      t23 = dsqrt(sigmabb)
      t24 = t23*t21
      t25 = dlog(t24+dsqrt(1+t24**2))
      t28 = 1.D0+0.252D-1*t24*t25
      t29 = 1/t28
      zk(i) = -0.74442058907928D0*t5-0.3024D-2*t8*t15
     #-0.74442058907928D0*t19-0.3024D-2*t22*t29
      t33 = rhoa**2
      t35 = 1/t4/t33
      t39 = t14**2
      t40 = 1/t39
      t45 = t4**2
      t50 = 1/t45/t33
      t53 = dsqrt(1.D0+sigmaaa*t50)
      t54 = 1/t53
      vrhoa(i) = -0.99256078543904D0*t4+0.4032D-2*t35*sigmaaa*t15
     #+0.3024D-2*t8*t40*(-0.336D-1*t9*t35*t11-0.336D-1*sigmaaa/t45/t33
     #/rhoa*t54)
      t62 = rhob**2
      t64 = 1/t18/t62
      t68 = t28**2
      t69 = 1/t68
      t74 = t18**2
      t79 = 1/t74/t62
      t82 = dsqrt(1.D0+sigmabb*t79)
      t83 = 1/t82
      vrhob(i) = -0.99256078543904D0*t18+0.4032D-2*t64*sigmabb*t29
     #+0.3024D-2*t22*t69*(-0.336D-1*t23*t64*t25-0.336D-1*sigmabb/t74
     #/t62/rhob*t83)
      vsigmaaa(i) = -0.3024D-2*t7*t15+0.3024D-2*t8*t40*(0.126D-1/t9*t7
     #*t11+0.126D-1*t50*t54)
      vsigmaab(i) = 0.D0
      vsigmabb(i) = -0.3024D-2*t21*t29+0.3024D-2*t22*t69*(0.126D-1/t23
     #*t21*t25+0.126D-1*t79*t83)
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t3 = t2*rhob
      t5 = 1/t3
      t6 = t5*sigmabb
      t7 = dsqrt(sigmabb)
      t8 = t7*t5
      t9 = dlog(t8+dsqrt(1+t8**2))
      t12 = 1.D0+0.252D-1*t8*t9
      t13 = 1/t12
      zk(i) = -0.74442058907928D0*t3-0.3024D-2*t6*t13
      vrhoa(i) = 0.D0
      t17 = rhob**2
      t19 = 1/t2/t17
      t20 = t19*sigmabb
      t23 = t12**2
      t24 = 1/t23
      t28 = t17*rhob
      t29 = t2**2
      t34 = 1/t29/t17
      t36 = 1.D0+sigmabb*t34
      t37 = dsqrt(t36)
      t38 = 1/t37
      t41 = -0.336D-1*t7*t19*t9-0.336D-1*sigmabb/t29/t28*t38
      t42 = t24*t41
      vrhob(i) = -0.99256078543904D0*t2+0.4032D-2*t20*t13+0.3024D-2*t6
     #*t42
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      t53 = 0.126D-1/t7*t5*t9+0.126D-1*t34*t38
      vsigmabb(i) = -0.3024D-2*t5*t13+0.3024D-2*t6*t24*t53
      v2rhoa2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t60 = 1/t2/t28
      t67 = 1/t23/t12
      t68 = t41**2
      t75 = t17**2
      t81 = sigmabb**2
      t87 = 1/t37/t36
      v2rhob2(i) = -0.3308535951463467D0/t29-0.9408D-2*t60*sigmabb*t13
     #-0.8064D-2*t20*t42-0.6048D-2*t6*t67*t68+0.3024D-2*t6*t24*
     #(0.784D-1*t7*t60*t9+0.168D0*sigmabb/t29/t75*t38-0.448D-1*t81/t2
     #/t75/t28*t87)
      v2sigmaaa2(i) = 0.D0
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      t97 = t53**2
      v2sigmabb2(i) = 0.6048D-2*t5*t24*t53-0.6048D-2*t6*t67*t97
     #+0.3024D-2*t6*t24*(-0.63D-2/t7/sigmabb*t5*t9+0.63D-2/sigmabb*t34
     #*t38-0.63D-2/t2/t75/rhob*t87)
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t3 = t2*rhoa
      t5 = 1/t3
      t6 = t5*sigmaaa
      t7 = dsqrt(sigmaaa)
      t8 = t7*t5
      t9 = dlog(t8+dsqrt(1+t8**2))
      t12 = 1.D0+0.252D-1*t8*t9
      t13 = 1/t12
      zk(i) = -0.74442058907928D0*t3-0.3024D-2*t6*t13
      t17 = rhoa**2
      t19 = 1/t2/t17
      t20 = t19*sigmaaa
      t23 = t12**2
      t24 = 1/t23
      t28 = t17*rhoa
      t29 = t2**2
      t34 = 1/t29/t17
      t36 = 1.D0+sigmaaa*t34
      t37 = dsqrt(t36)
      t38 = 1/t37
      t41 = -0.336D-1*t7*t19*t9-0.336D-1*sigmaaa/t29/t28*t38
      t42 = t24*t41
      vrhoa(i) = -0.99256078543904D0*t2+0.4032D-2*t20*t13+0.3024D-2*t6
     #*t42
      vrhob(i) = 0.D0
      t53 = 0.126D-1/t7*t5*t9+0.126D-1*t34*t38
      vsigmaaa(i) = -0.3024D-2*t5*t13+0.3024D-2*t6*t24*t53
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      t60 = 1/t2/t28
      t67 = 1/t23/t12
      t68 = t41**2
      t75 = t17**2
      t81 = sigmaaa**2
      t87 = 1/t37/t36
      v2rhoa2(i) = -0.3308535951463467D0/t29-0.9408D-2*t60*sigmaaa*t13
     #-0.8064D-2*t20*t42-0.6048D-2*t6*t67*t68+0.3024D-2*t6*t24*
     #(0.784D-1*t7*t60*t9+0.168D0*sigmaaa/t29/t75*t38-0.448D-1*t81/t2
     #/t75/t28*t87)
      v2rhob2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t97 = t53**2
      v2sigmaaa2(i) = 0.6048D-2*t5*t24*t53-0.6048D-2*t6*t67*t97
     #+0.3024D-2*t6*t24*(-0.63D-2/t7/sigmaaa*t5*t9+0.63D-2/sigmaaa*t34
     #*t38-0.63D-2/t2/t75/rhoa*t87)
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      v2sigmabb2(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t5 = t4*rhoa
      t7 = 1/t5
      t8 = t7*sigmaaa
      t9 = dsqrt(sigmaaa)
      t10 = t9*t7
      t11 = dlog(t10+dsqrt(1+t10**2))
      t14 = 1.D0+0.252D-1*t10*t11
      t15 = 1/t14
      t18 = rhob**(1.D0/3.D0)
      t19 = t18*rhob
      t21 = 1/t19
      t22 = t21*sigmabb
      t23 = dsqrt(sigmabb)
      t24 = t23*t21
      t25 = dlog(t24+dsqrt(1+t24**2))
      t28 = 1.D0+0.252D-1*t24*t25
      t29 = 1/t28
      zk(i) = -0.74442058907928D0*t5-0.3024D-2*t8*t15
     #-0.74442058907928D0*t19-0.3024D-2*t22*t29
      t33 = rhoa**2
      t35 = 1/t4/t33
      t36 = t35*sigmaaa
      t39 = t14**2
      t40 = 1/t39
      t44 = t33*rhoa
      t45 = t4**2
      t47 = 1/t45/t44
      t50 = 1/t45/t33
      t52 = 1.D0+sigmaaa*t50
      t53 = dsqrt(t52)
      t54 = 1/t53
      t57 = -0.336D-1*t9*t35*t11-0.336D-1*sigmaaa*t47*t54
      t58 = t40*t57
      vrhoa(i) = -0.99256078543904D0*t4+0.4032D-2*t36*t15+0.3024D-2*t8
     #*t58
      t62 = rhob**2
      t64 = 1/t18/t62
      t65 = t64*sigmabb
      t68 = t28**2
      t69 = 1/t68
      t73 = t62*rhob
      t74 = t18**2
      t76 = 1/t74/t73
      t79 = 1/t74/t62
      t81 = 1.D0+sigmabb*t79
      t82 = dsqrt(t81)
      t83 = 1/t82
      t86 = -0.336D-1*t23*t64*t25-0.336D-1*sigmabb*t76*t83
      t87 = t69*t86
      vrhob(i) = -0.99256078543904D0*t18+0.4032D-2*t65*t29+0.3024D-2
     #*t22*t87
      t92 = 1/t9
      t98 = 0.126D-1*t92*t7*t11+0.126D-1*t50*t54
      t99 = t40*t98
      vsigmaaa(i) = -0.3024D-2*t7*t15+0.3024D-2*t8*t99
      vsigmaab(i) = 0.D0
      t104 = 1/t23
      t110 = 0.126D-1*t104*t21*t25+0.126D-1*t79*t83
      t111 = t69*t110
      vsigmabb(i) = -0.3024D-2*t21*t29+0.3024D-2*t22*t111
      t117 = 1/t4/t44
      t124 = 1/t39/t14
      t125 = t57**2
      t132 = t33**2
      t138 = sigmaaa**2
      t144 = 1/t53/t52
      v2rhoa2(i) = -0.3308535951463467D0/t45-0.9408D-2*t117*sigmaaa
     #*t15-0.8064D-2*t36*t58-0.6048D-2*t8*t124*t125+0.3024D-2*t8*t40*
     #(0.784D-1*t9*t117*t11+0.168D0*sigmaaa/t45/t132*t54-0.448D-1*t138
     #/t4/t132/t44*t144)
      t154 = 1/t18/t73
      t161 = 1/t68/t28
      t162 = t86**2
      t169 = t62**2
      t175 = sigmabb**2
      t181 = 1/t82/t81
      v2rhob2(i) = -0.3308535951463467D0/t74-0.9408D-2*t154*sigmabb
     #*t29-0.8064D-2*t65*t87-0.6048D-2*t22*t161*t162+0.3024D-2*t22*t69
     #*(0.784D-1*t23*t154*t25+0.168D0*sigmabb/t74/t169*t83-0.448D-1
     #*t175/t18/t169/t73*t181)
      v2rhoab(i) = 0.D0
      t192 = t7*t40
      v2rhoasigmaaa(i) = 0.4032D-2*t35*t15-0.4032D-2*t36*t99+0.3024D-2
     #*t192*t57-0.6048D-2*t8*t124*t57*t98+0.3024D-2*t8*t40*(-0.168D-1
     #*t92*t35*t11-0.504D-1*t47*t54+0.168D-1*sigmaaa/t4/t132/t33*t144)
      v2rhoasigmaab(i) = 0.D0
      v2rhoasigmabb(i) = 0.D0
      v2rhobsigmaaa(i) = 0.D0
      v2rhobsigmaab(i) = 0.D0
      t218 = t21*t69
      v2rhobsigmabb(i) = 0.4032D-2*t64*t29-0.4032D-2*t65*t111
     #+0.3024D-2*t218*t86-0.6048D-2*t22*t161*t86*t110+0.3024D-2*t22
     #*t69*(-0.168D-1*t104*t64*t25-0.504D-1*t76*t83+0.168D-1*sigmabb
     #/t18/t169/t62*t181)
      t242 = t98**2
      v2sigmaaa2(i) = 0.6048D-2*t192*t98-0.6048D-2*t8*t124*t242
     #+0.3024D-2*t8*t40*(-0.63D-2/t9/sigmaaa*t7*t11+0.63D-2/sigmaaa
     #*t50*t54-0.63D-2/t4/t132/rhoa*t144)
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      t266 = t110**2
      v2sigmabb2(i) = 0.6048D-2*t218*t110-0.6048D-2*t22*t161*t266
     #+0.3024D-2*t22*t69*(-0.63D-2/t23/sigmabb*t21*t25+0.63D-2/sigmabb
     #*t79*t83-0.63D-2/t18/t169/rhob*t181)
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      v2rhob2(i) = 0.0d0
      v2rhoab(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2rhoasigmaab(i) = 0.0d0
      v2rhoasigmabb(i) = 0.0d0
      v2rhobsigmaaa(i) = 0.0d0
      v2rhobsigmaab(i) = 0.0d0
      v2rhobsigmabb(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      v2sigmaab2(i) = 0.0d0
      v2sigmabb2(i) = 0.0d0
      v2sigmaaaab(i) = 0.0d0
      v2sigmaaabb(i) = 0.0d0
      v2sigmaabbb(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end
      
      
      subroutine rks_x_b3
     & (ideriv,npt,rhoa1,sigmaaa1,
     &  zk,vrhoa,vsigmaaa,
     &  v2rhoa2,v2rhoasigmaaa,v2sigmaaa2)
c
c     A.D. Becke
c     Density-functional thermochemistry. III. The role of
c     exact exchange
c     J. Chem. Phys. 98 (1993) 5648-5652
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt)
      REAL sigmaaa1(npt)
      REAL zk(npt),vrhoa(npt),vsigmaaa(npt)
      REAL v2rhoa2(npt),v2rhoasigmaaa(npt),v2sigmaaa2(npt)
      parameter(tol=1.0d-20)
      
      if(ideriv.eq.0) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t3 = t2*rho
      t5 = 1/t3
      t7 = dsqrt(sigma)
      t8 = t7*t5
      t10 = dlog(0.1259921049894873D1*t8+dsqrt(1+0.1587401051968199D1
     #*t8**2))
      zk(i) = -0.5908470131056179D0*t3-0.3810001254882096D-2*t5*sigma/
     #(1.D0+0.317500104573508D-1*t8*t10)
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t3 = t2*rho
      t5 = 1/t3
      t6 = t5*sigma
      t7 = dsqrt(sigma)
      t8 = t7*t5
      t10 = dlog(0.1259921049894873D1*t8+dsqrt(1+0.1587401051968199D1
     #*t8**2))
      t13 = 1.D0+0.317500104573508D-1*t8*t10
      t14 = 1/t13
      zk(i) = -0.5908470131056179D0*t3-0.3810001254882096D-2*t6*t14
      t18 = rho**2
      t20 = 1/t2/t18
      t24 = t13**2
      t25 = 1/t24
      t30 = t2**2
      t35 = 1/t30/t18
      t39 = dsqrt(1.D0+0.1587401051968199D1*sigma*t35)
      t40 = 1/t39
      vrhoa(i) = -0.7877960174741572D0*t2+0.5080001673176129D-2*t20
     #*sigma*t14+0.1905000627441048D-2*t6*t25*(-0.8466669455293548D-1
     #*t7*t20*t10-0.106673350692263D0*sigma/t30/t18/rho*t40)
      vsigmaaa(i) = -0.1524000501952839D-1*t5*t14
     #+0.3810001254882096D-2*t6*t25*(0.6350002091470161D-1/t7*t5*t10
     #+0.8000501301919725D-1*t35*t40)
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t3 = t2*rho
      t5 = 1/t3
      t6 = t5*sigma
      t7 = dsqrt(sigma)
      t8 = t7*t5
      t10 = dlog(0.1259921049894873D1*t8+dsqrt(1+0.1587401051968199D1
     #*t8**2))
      t13 = 1.D0+0.317500104573508D-1*t8*t10
      t14 = 1/t13
      zk(i) = -0.5908470131056179D0*t3-0.3810001254882096D-2*t6*t14
      t18 = rho**2
      t20 = 1/t2/t18
      t21 = t20*sigma
      t24 = t13**2
      t25 = 1/t24
      t29 = t18*rho
      t30 = t2**2
      t32 = 1/t30/t29
      t35 = 1/t30/t18
      t38 = 1.D0+0.1587401051968199D1*sigma*t35
      t39 = dsqrt(t38)
      t40 = 1/t39
      t43 = -0.8466669455293548D-1*t7*t20*t10-0.106673350692263D0
     #*sigma*t32*t40
      t44 = t25*t43
      vrhoa(i) = -0.7877960174741572D0*t2+0.5080001673176129D-2*t21
     #*t14+0.1905000627441048D-2*t6*t44
      t49 = 1/t7
      t55 = 0.6350002091470161D-1*t49*t5*t10+0.8000501301919725D-1*t35
     #*t40
      t56 = t25*t55
      vsigmaaa(i) = -0.1524000501952839D-1*t5*t14
     #+0.3810001254882096D-2*t6*t56
      t62 = 1/t2/t29
      t69 = 1/t24/t13
      t70 = t43**2
      t77 = t18**2
      t83 = sigma**2
      t89 = 1/t39/t38
      v2rhoa2(i) = -0.5251973449827715D0/t30-0.2370667447482193D-1*t62
     #*sigma*t14-0.1016000334635226D-1*t21*t44-0.3810001254882096D-2
     #*t6*t69*t70+0.1905000627441048D-2*t6*t25*(0.3951112412470322D0
     #*t7*t62*t10+0.106673350692263D1*sigma/t30/t77*t40
     #-0.4515557042823225D0*t83/t2/t77/t29*t89)
      t100 = t5*t25
      v2rhoasigmaaa(i) = 0.2032000669270451D-1*t20*t14
     #-0.5080001673176129D-2*t21*t56+0.7620002509764193D-2*t100*t43
     #-0.3810001254882096D-2*t6*t69*t43*t55+0.1905000627441048D-2*t6
     #*t25*(-0.169333389105871D0*t49*t20*t10-0.640040104153578D0*t32
     #*t40+0.3386667782117419D0*sigma/t2/t77/t18*t89)
      t124 = t55**2
      v2sigmaaa2(i) = 0.3048001003905677D-1*t100*t55
     #-0.7620002509764193D-2*t6*t69*t124+0.3810001254882096D-2*t6*t25*
     #(-0.1270000418294032D0/t7/sigma*t5*t10+0.1600100260383945D0
     #/sigma*t35*t40-0.2540000836588064D0/t2/t77/rho*t89)
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end

c:X_B3subrend
_ENDIF
_IF(ccpdft,all,x_b88)
c:X_B88subrstart

c    Generated: Wed Jan 29 09:08:35 GMT 2003

      subroutine uks_x_b88
     & (ideriv,npt,rhoa1,rhob1,sigmaaa1,sigmabb1,sigmaab1,
     &  zk,vrhoa,vrhob,vsigmaaa,vsigmabb,vsigmaab,
     &  v2rhoa2,v2rhob2,v2rhoab,
     &  v2rhoasigmaaa,v2rhoasigmaab,v2rhoasigmabb,
     &  v2rhobsigmabb,v2rhobsigmaab,v2rhobsigmaaa,
     &  v2sigmaaa2,v2sigmaaaab,v2sigmaaabb,
     &  v2sigmaab2,v2sigmaabbb,v2sigmabb2)
c
c     A.D. Becke
c     Density-functional exchange-energy approximation with correct 
c     asymptotic behaviour
c     Phys. Rev. A38 (1988) 3098-3100
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt),rhob1(npt)
      REAL sigmaaa1(npt),sigmabb1(npt),sigmaab1(npt)
      REAL zk(npt),vrhoa(npt),vrhob(npt)
      REAL vsigmaaa(npt),vsigmabb(npt),vsigmaab(npt)
      REAL v2rhoa2(npt),v2rhob2(npt),v2rhoab(npt)
      REAL v2rhoasigmaaa(npt),v2rhoasigmaab(npt)
      REAL v2rhoasigmabb(npt),v2rhobsigmabb(npt)
      REAL v2rhobsigmaab(npt),v2rhobsigmaaa(npt)
      REAL v2sigmaaa2(npt),v2sigmaaaab(npt),v2sigmaaabb(npt)
      REAL v2sigmaab2(npt),v2sigmaabbb(npt),v2sigmabb2(npt)
      parameter(tol=1.0d-20)
      
      if (ideriv.eq.0) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t3 = t2*rhob
      t5 = 1/t3
      t7 = dsqrt(sigmabb)
      t8 = t7*t5
      t9 = dlog(t8+dsqrt(1+t8**2))
      zk(i) = -0.9305257363491D0*t3-0.42D-2*t5*sigmabb/(1.D0+0.252D-1
     #*t8*t9)
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t3 = t2*rhoa
      t5 = 1/t3
      t7 = dsqrt(sigmaaa)
      t8 = t7*t5
      t9 = dlog(t8+dsqrt(1+t8**2))
      zk(i) = -0.9305257363491D0*t3-0.42D-2*t5*sigmaaa/(1.D0+0.252D-1
     #*t8*t9)
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t5 = t4*rhoa
      t7 = 1/t5
      t9 = dsqrt(sigmaaa)
      t10 = t9*t7
      t11 = dlog(t10+dsqrt(1+t10**2))
      t18 = rhob**(1.D0/3.D0)
      t19 = t18*rhob
      t21 = 1/t19
      t23 = dsqrt(sigmabb)
      t24 = t23*t21
      t25 = dlog(t24+dsqrt(1+t24**2))
      zk(i) = -0.9305257363491D0*t5-0.42D-2*t7*sigmaaa/(1.D0+0.252D-1
     #*t10*t11)-0.9305257363491D0*t19-0.42D-2*t21*sigmabb/(1.D0
     #+0.252D-1*t24*t25)
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t3 = t2*rhob
      t5 = 1/t3
      t6 = t5*sigmabb
      t7 = dsqrt(sigmabb)
      t8 = t7*t5
      t9 = dlog(t8+dsqrt(1+t8**2))
      t12 = 1.D0+0.252D-1*t8*t9
      t13 = 1/t12
      zk(i) = -0.9305257363491D0*t3-0.42D-2*t6*t13
      vrhoa(i) = 0.D0
      t17 = rhob**2
      t19 = 1/t2/t17
      t23 = t12**2
      t24 = 1/t23
      t29 = t2**2
      t34 = 1/t29/t17
      t37 = dsqrt(1.D0+sigmabb*t34)
      t38 = 1/t37
      vrhob(i) = -0.12407009817988D1*t2+0.56D-2*t19*sigmabb*t13
     #+0.42D-2*t6*t24*(-0.336D-1*t7*t19*t9-0.336D-1*sigmabb/t29/t17
     #/rhob*t38)
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      vsigmabb(i) = -0.42D-2*t5*t13+0.42D-2*t6*t24*(0.126D-1/t7*t5*t9
     #+0.126D-1*t34*t38)
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t3 = t2*rhoa
      t5 = 1/t3
      t6 = t5*sigmaaa
      t7 = dsqrt(sigmaaa)
      t8 = t7*t5
      t9 = dlog(t8+dsqrt(1+t8**2))
      t12 = 1.D0+0.252D-1*t8*t9
      t13 = 1/t12
      zk(i) = -0.9305257363491D0*t3-0.42D-2*t6*t13
      t17 = rhoa**2
      t19 = 1/t2/t17
      t23 = t12**2
      t24 = 1/t23
      t29 = t2**2
      t34 = 1/t29/t17
      t37 = dsqrt(1.D0+sigmaaa*t34)
      t38 = 1/t37
      vrhoa(i) = -0.12407009817988D1*t2+0.56D-2*t19*sigmaaa*t13
     #+0.42D-2*t6*t24*(-0.336D-1*t7*t19*t9-0.336D-1*sigmaaa/t29/t17
     #/rhoa*t38)
      vrhob(i) = 0.D0
      vsigmaaa(i) = -0.42D-2*t5*t13+0.42D-2*t6*t24*(0.126D-1/t7*t5*t9
     #+0.126D-1*t34*t38)
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t5 = t4*rhoa
      t7 = 1/t5
      t8 = t7*sigmaaa
      t9 = dsqrt(sigmaaa)
      t10 = t9*t7
      t11 = dlog(t10+dsqrt(1+t10**2))
      t14 = 1.D0+0.252D-1*t10*t11
      t15 = 1/t14
      t18 = rhob**(1.D0/3.D0)
      t19 = t18*rhob
      t21 = 1/t19
      t22 = t21*sigmabb
      t23 = dsqrt(sigmabb)
      t24 = t23*t21
      t25 = dlog(t24+dsqrt(1+t24**2))
      t28 = 1.D0+0.252D-1*t24*t25
      t29 = 1/t28
      zk(i) = -0.9305257363491D0*t5-0.42D-2*t8*t15-0.9305257363491D0
     #*t19-0.42D-2*t22*t29
      t33 = rhoa**2
      t35 = 1/t4/t33
      t39 = t14**2
      t40 = 1/t39
      t45 = t4**2
      t50 = 1/t45/t33
      t53 = dsqrt(1.D0+sigmaaa*t50)
      t54 = 1/t53
      vrhoa(i) = -0.12407009817988D1*t4+0.56D-2*t35*sigmaaa*t15
     #+0.42D-2*t8*t40*(-0.336D-1*t9*t35*t11-0.336D-1*sigmaaa/t45/t33
     #/rhoa*t54)
      t62 = rhob**2
      t64 = 1/t18/t62
      t68 = t28**2
      t69 = 1/t68
      t74 = t18**2
      t79 = 1/t74/t62
      t82 = dsqrt(1.D0+sigmabb*t79)
      t83 = 1/t82
      vrhob(i) = -0.12407009817988D1*t18+0.56D-2*t64*sigmabb*t29
     #+0.42D-2*t22*t69*(-0.336D-1*t23*t64*t25-0.336D-1*sigmabb/t74/t62
     #/rhob*t83)
      vsigmaaa(i) = -0.42D-2*t7*t15+0.42D-2*t8*t40*(0.126D-1/t9*t7*t11
     #+0.126D-1*t50*t54)
      vsigmaab(i) = 0.D0
      vsigmabb(i) = -0.42D-2*t21*t29+0.42D-2*t22*t69*(0.126D-1/t23*t21
     #*t25+0.126D-1*t79*t83)
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t3 = t2*rhob
      t5 = 1/t3
      t6 = t5*sigmabb
      t7 = dsqrt(sigmabb)
      t8 = t7*t5
      t9 = dlog(t8+dsqrt(1+t8**2))
      t12 = 1.D0+0.252D-1*t8*t9
      t13 = 1/t12
      zk(i) = -0.9305257363491D0*t3-0.42D-2*t6*t13
      vrhoa(i) = 0.D0
      t17 = rhob**2
      t19 = 1/t2/t17
      t20 = t19*sigmabb
      t23 = t12**2
      t24 = 1/t23
      t28 = t17*rhob
      t29 = t2**2
      t34 = 1/t29/t17
      t36 = 1.D0+sigmabb*t34
      t37 = dsqrt(t36)
      t38 = 1/t37
      t41 = -0.336D-1*t7*t19*t9-0.336D-1*sigmabb/t29/t28*t38
      t42 = t24*t41
      vrhob(i) = -0.12407009817988D1*t2+0.56D-2*t20*t13+0.42D-2*t6*t42
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      t53 = 0.126D-1/t7*t5*t9+0.126D-1*t34*t38
      vsigmabb(i) = -0.42D-2*t5*t13+0.42D-2*t6*t24*t53
      v2rhoa2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t60 = 1/t2/t28
      t67 = 1/t23/t12
      t68 = t41**2
      t75 = t17**2
      t81 = sigmabb**2
      t87 = 1/t37/t36
      v2rhob2(i) = -0.4135669939329333D0/t29-0.1306666666666667D-1*t60
     #*sigmabb*t13-0.112D-1*t20*t42-0.84D-2*t6*t67*t68+0.42D-2*t6*t24*
     #(0.784D-1*t7*t60*t9+0.168D0*sigmabb/t29/t75*t38-0.448D-1*t81/t2
     #/t75/t28*t87)
      v2sigmaaa2(i) = 0.D0
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      t97 = t53**2
      v2sigmabb2(i) = 0.84D-2*t5*t24*t53-0.84D-2*t6*t67*t97+0.42D-2*t6
     #*t24*(-0.63D-2/t7/sigmabb*t5*t9+0.63D-2/sigmabb*t34*t38-0.63D-2
     #/t2/t75/rhob*t87)
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t3 = t2*rhoa
      t5 = 1/t3
      t6 = t5*sigmaaa
      t7 = dsqrt(sigmaaa)
      t8 = t7*t5
      t9 = dlog(t8+dsqrt(1+t8**2))
      t12 = 1.D0+0.252D-1*t8*t9
      t13 = 1/t12
      zk(i) = -0.9305257363491D0*t3-0.42D-2*t6*t13
      t17 = rhoa**2
      t19 = 1/t2/t17
      t20 = t19*sigmaaa
      t23 = t12**2
      t24 = 1/t23
      t28 = t17*rhoa
      t29 = t2**2
      t34 = 1/t29/t17
      t36 = 1.D0+sigmaaa*t34
      t37 = dsqrt(t36)
      t38 = 1/t37
      t41 = -0.336D-1*t7*t19*t9-0.336D-1*sigmaaa/t29/t28*t38
      t42 = t24*t41
      vrhoa(i) = -0.12407009817988D1*t2+0.56D-2*t20*t13+0.42D-2*t6*t42
      vrhob(i) = 0.D0
      t53 = 0.126D-1/t7*t5*t9+0.126D-1*t34*t38
      vsigmaaa(i) = -0.42D-2*t5*t13+0.42D-2*t6*t24*t53
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      t60 = 1/t2/t28
      t67 = 1/t23/t12
      t68 = t41**2
      t75 = t17**2
      t81 = sigmaaa**2
      t87 = 1/t37/t36
      v2rhoa2(i) = -0.4135669939329333D0/t29-0.1306666666666667D-1*t60
     #*sigmaaa*t13-0.112D-1*t20*t42-0.84D-2*t6*t67*t68+0.42D-2*t6*t24*
     #(0.784D-1*t7*t60*t9+0.168D0*sigmaaa/t29/t75*t38-0.448D-1*t81/t2
     #/t75/t28*t87)
      v2rhob2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t97 = t53**2
      v2sigmaaa2(i) = 0.84D-2*t5*t24*t53-0.84D-2*t6*t67*t97+0.42D-2*t6
     #*t24*(-0.63D-2/t7/sigmaaa*t5*t9+0.63D-2/sigmaaa*t34*t38-0.63D-2
     #/t2/t75/rhoa*t87)
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      v2sigmabb2(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t5 = t4*rhoa
      t7 = 1/t5
      t8 = t7*sigmaaa
      t9 = dsqrt(sigmaaa)
      t10 = t9*t7
      t11 = dlog(t10+dsqrt(1+t10**2))
      t14 = 1.D0+0.252D-1*t10*t11
      t15 = 1/t14
      t18 = rhob**(1.D0/3.D0)
      t19 = t18*rhob
      t21 = 1/t19
      t22 = t21*sigmabb
      t23 = dsqrt(sigmabb)
      t24 = t23*t21
      t25 = dlog(t24+dsqrt(1+t24**2))
      t28 = 1.D0+0.252D-1*t24*t25
      t29 = 1/t28
      zk(i) = -0.9305257363491D0*t5-0.42D-2*t8*t15-0.9305257363491D0
     #*t19-0.42D-2*t22*t29
      t33 = rhoa**2
      t35 = 1/t4/t33
      t36 = t35*sigmaaa
      t39 = t14**2
      t40 = 1/t39
      t44 = t33*rhoa
      t45 = t4**2
      t47 = 1/t45/t44
      t50 = 1/t45/t33
      t52 = 1.D0+sigmaaa*t50
      t53 = dsqrt(t52)
      t54 = 1/t53
      t57 = -0.336D-1*t9*t35*t11-0.336D-1*sigmaaa*t47*t54
      t58 = t40*t57
      vrhoa(i) = -0.12407009817988D1*t4+0.56D-2*t36*t15+0.42D-2*t8*t58
      t62 = rhob**2
      t64 = 1/t18/t62
      t65 = t64*sigmabb
      t68 = t28**2
      t69 = 1/t68
      t73 = t62*rhob
      t74 = t18**2
      t76 = 1/t74/t73
      t79 = 1/t74/t62
      t81 = 1.D0+sigmabb*t79
      t82 = dsqrt(t81)
      t83 = 1/t82
      t86 = -0.336D-1*t23*t64*t25-0.336D-1*sigmabb*t76*t83
      t87 = t69*t86
      vrhob(i) = -0.12407009817988D1*t18+0.56D-2*t65*t29+0.42D-2*t22*t87
      t92 = 1/t9
      t98 = 0.126D-1*t92*t7*t11+0.126D-1*t50*t54
      t99 = t40*t98
      vsigmaaa(i) = -0.42D-2*t7*t15+0.42D-2*t8*t99
      vsigmaab(i) = 0.D0
      t104 = 1/t23
      t110 = 0.126D-1*t104*t21*t25+0.126D-1*t79*t83
      t111 = t69*t110
      vsigmabb(i) = -0.42D-2*t21*t29+0.42D-2*t22*t111
      t117 = 1/t4/t44
      t124 = 1/t39/t14
      t125 = t57**2
      t132 = t33**2
      t138 = sigmaaa**2
      t144 = 1/t53/t52
      v2rhoa2(i) = -0.4135669939329333D0/t45-0.1306666666666667D-1
     #*t117*sigmaaa*t15-0.112D-1*t36*t58-0.84D-2*t8*t124*t125+0.42D-2
     #*t8*t40*(0.784D-1*t9*t117*t11+0.168D0*sigmaaa/t45/t132*t54
     #-0.448D-1*t138/t4/t132/t44*t144)
      t154 = 1/t18/t73
      t161 = 1/t68/t28
      t162 = t86**2
      t169 = t62**2
      t175 = sigmabb**2
      t181 = 1/t82/t81
      v2rhob2(i) = -0.4135669939329333D0/t74-0.1306666666666667D-1
     #*t154*sigmabb*t29-0.112D-1*t65*t87-0.84D-2*t22*t161*t162+0.42D-2
     #*t22*t69*(0.784D-1*t23*t154*t25+0.168D0*sigmabb/t74/t169*t83
     #-0.448D-1*t175/t18/t169/t73*t181)
      v2rhoab(i) = 0.D0
      t192 = t7*t40
      v2rhoasigmaaa(i) = 0.56D-2*t35*t15-0.56D-2*t36*t99+0.42D-2*t192
     #*t57-0.84D-2*t8*t124*t57*t98+0.42D-2*t8*t40*(-0.168D-1*t92*t35
     #*t11-0.504D-1*t47*t54+0.168D-1*sigmaaa/t4/t132/t33*t144)
      v2rhoasigmaab(i) = 0.D0
      v2rhoasigmabb(i) = 0.D0
      v2rhobsigmaaa(i) = 0.D0
      v2rhobsigmaab(i) = 0.D0
      t218 = t21*t69
      v2rhobsigmabb(i) = 0.56D-2*t64*t29-0.56D-2*t65*t111+0.42D-2*t218
     #*t86-0.84D-2*t22*t161*t86*t110+0.42D-2*t22*t69*(-0.168D-1*t104
     #*t64*t25-0.504D-1*t76*t83+0.168D-1*sigmabb/t18/t169/t62*t181)
      t242 = t98**2
      v2sigmaaa2(i) = 0.84D-2*t192*t98-0.84D-2*t8*t124*t242+0.42D-2*t8
     #*t40*(-0.63D-2/t9/sigmaaa*t7*t11+0.63D-2/sigmaaa*t50*t54-0.63D-2
     #/t4/t132/rhoa*t144)
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      t266 = t110**2
      v2sigmabb2(i) = 0.84D-2*t218*t110-0.84D-2*t22*t161*t266+0.42D-2
     #*t22*t69*(-0.63D-2/t23/sigmabb*t21*t25+0.63D-2/sigmabb*t79*t83
     #-0.63D-2/t18/t169/rhob*t181)
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      v2rhob2(i) = 0.0d0
      v2rhoab(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2rhoasigmaab(i) = 0.0d0
      v2rhoasigmabb(i) = 0.0d0
      v2rhobsigmaaa(i) = 0.0d0
      v2rhobsigmaab(i) = 0.0d0
      v2rhobsigmabb(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      v2sigmaab2(i) = 0.0d0
      v2sigmabb2(i) = 0.0d0
      v2sigmaaaab(i) = 0.0d0
      v2sigmaaabb(i) = 0.0d0
      v2sigmaabbb(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end
      
      
      subroutine rks_x_b88
     & (ideriv,npt,rhoa1,sigmaaa1,
     &  zk,vrhoa,vsigmaaa,
     &  v2rhoa2,v2rhoasigmaaa,v2sigmaaa2)
c
c     A.D. Becke
c     Density-functional exchange-energy approximation with correct 
c     asymptotic behaviour
c     Phys. Rev. A38 (1988) 3098-3100
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt)
      REAL sigmaaa1(npt)
      REAL zk(npt),vrhoa(npt),vsigmaaa(npt)
      REAL v2rhoa2(npt),v2rhoasigmaaa(npt),v2sigmaaa2(npt)
      parameter(tol=1.0d-20)
      
      if(ideriv.eq.0) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t3 = t2*rho
      t5 = 1/t3
      t7 = dsqrt(sigma)
      t8 = t7*t5
      t10 = dlog(0.1259921049894873D1*t8+dsqrt(1+0.1587401051968199D1
     #*t8**2))
      zk(i) = -0.7385587663820224D0*t3-0.5291668409558467D-2*t5*sigma/
     #(1.D0+0.317500104573508D-1*t8*t10)
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t3 = t2*rho
      t5 = 1/t3
      t6 = t5*sigma
      t7 = dsqrt(sigma)
      t8 = t7*t5
      t10 = dlog(0.1259921049894873D1*t8+dsqrt(1+0.1587401051968199D1
     #*t8**2))
      t13 = 1.D0+0.317500104573508D-1*t8*t10
      t14 = 1/t13
      zk(i) = -0.7385587663820224D0*t3-0.5291668409558467D-2*t6*t14
      t18 = rho**2
      t20 = 1/t2/t18
      t24 = t13**2
      t25 = 1/t24
      t30 = t2**2
      t35 = 1/t30/t18
      t39 = dsqrt(1.D0+0.1587401051968199D1*sigma*t35)
      t40 = 1/t39
      vrhoa(i) = -0.9847450218426965D0*t2+0.705555787941129D-2*t20
     #*sigma*t14+0.2645834204779234D-2*t6*t25*(-0.8466669455293548D-1
     #*t7*t20*t10-0.106673350692263D0*sigma/t30/t18/rho*t40)
      vsigmaaa(i) = -0.2116667363823387D-1*t5*t14
     #+0.5291668409558467D-2*t6*t25*(0.6350002091470161D-1/t7*t5*t10
     #+0.8000501301919725D-1*t35*t40)
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t3 = t2*rho
      t5 = 1/t3
      t6 = t5*sigma
      t7 = dsqrt(sigma)
      t8 = t7*t5
      t10 = dlog(0.1259921049894873D1*t8+dsqrt(1+0.1587401051968199D1
     #*t8**2))
      t13 = 1.D0+0.317500104573508D-1*t8*t10
      t14 = 1/t13
      zk(i) = -0.7385587663820224D0*t3-0.5291668409558467D-2*t6*t14
      t18 = rho**2
      t20 = 1/t2/t18
      t21 = t20*sigma
      t24 = t13**2
      t25 = 1/t24
      t29 = t18*rho
      t30 = t2**2
      t32 = 1/t30/t29
      t35 = 1/t30/t18
      t38 = 1.D0+0.1587401051968199D1*sigma*t35
      t39 = dsqrt(t38)
      t40 = 1/t39
      t43 = -0.8466669455293548D-1*t7*t20*t10-0.106673350692263D0
     #*sigma*t32*t40
      t44 = t25*t43
      vrhoa(i) = -0.9847450218426965D0*t2+0.705555787941129D-2*t21*t14
     #+0.2645834204779234D-2*t6*t44
      t49 = 1/t7
      t55 = 0.6350002091470161D-1*t49*t5*t10+0.8000501301919725D-1*t35
     #*t40
      t56 = t25*t55
      vsigmaaa(i) = -0.2116667363823387D-1*t5*t14
     #+0.5291668409558467D-2*t6*t56
      t62 = 1/t2/t29
      t69 = 1/t24/t13
      t70 = t43**2
      t77 = t18**2
      t83 = sigma**2
      t89 = 1/t39/t38
      v2rhoa2(i) = -0.6564966812284644D0/t30-0.3292593677058602D-1*t62
     #*sigma*t14-0.1411111575882258D-1*t21*t44-0.5291668409558467D-2
     #*t6*t69*t70+0.2645834204779234D-2*t6*t25*(0.3951112412470322D0
     #*t7*t62*t10+0.106673350692263D1*sigma/t30/t77*t40
     #-0.4515557042823225D0*t83/t2/t77/t29*t89)
      t100 = t5*t25
      v2rhoasigmaaa(i) = 0.2822223151764516D-1*t20*t14
     #-0.705555787941129D-2*t21*t56+0.1058333681911693D-1*t100*t43
     #-0.5291668409558467D-2*t6*t69*t43*t55+0.2645834204779234D-2*t6
     #*t25*(-0.169333389105871D0*t49*t20*t10-0.640040104153578D0*t32
     #*t40+0.3386667782117419D0*sigma/t2/t77/t18*t89)
      t124 = t55**2
      v2sigmaaa2(i) = 0.4233334727646774D-1*t100*t55
     #-0.1058333681911693D-1*t6*t69*t124+0.5291668409558467D-2*t6*t25*
     #(-0.1270000418294032D0/t7/sigma*t5*t10+0.1600100260383945D0
     #/sigma*t35*t40-0.2540000836588064D0/t2/t77/rho*t89)
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end

c:X_B88subrend
_ENDIF
_IF(ccpdft,all,x_edf1)
c:X_EDF1subrstart

c    Generated: Wed Jul 23 16:33:42 GMT 2003

      subroutine uks_x_edf1
     & (ideriv,npt,rhoa1,rhob1,sigmaaa1,sigmabb1,sigmaab1,
     &  zk,vrhoa,vrhob,vsigmaaa,vsigmabb,vsigmaab,
     &  v2rhoa2,v2rhob2,v2rhoab,
     &  v2rhoasigmaaa,v2rhoasigmaab,v2rhoasigmabb,
     &  v2rhobsigmabb,v2rhobsigmaab,v2rhobsigmaaa,
     &  v2sigmaaa2,v2sigmaaaab,v2sigmaaabb,
     &  v2sigmaab2,v2sigmaabbb,v2sigmabb2)
c
c     R.D. Adamson, P.M.W. Gill, and J.A. Pople
c     Empirical density functionals
c     Chem. Phys. Lett. 284 (1998) 6-11
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt),rhob1(npt)
      REAL sigmaaa1(npt),sigmabb1(npt),sigmaab1(npt)
      REAL zk(npt),vrhoa(npt),vrhob(npt)
      REAL vsigmaaa(npt),vsigmabb(npt),vsigmaab(npt)
      REAL v2rhoa2(npt),v2rhob2(npt),v2rhoab(npt)
      REAL v2rhoasigmaaa(npt),v2rhoasigmaab(npt)
      REAL v2rhoasigmabb(npt),v2rhobsigmabb(npt)
      REAL v2rhobsigmaab(npt),v2rhobsigmaaa(npt)
      REAL v2sigmaaa2(npt),v2sigmaaaab(npt),v2sigmaaabb(npt)
      REAL v2sigmaab2(npt),v2sigmaabbb(npt),v2sigmabb2(npt)
      parameter(tol=1.0d-20)
      
      if (ideriv.eq.0) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**2
      t3 = rhob**(1.D0/3.D0)
      t4 = t3**2
      t7 = sigmabb/t4/t2
      t8 = dsqrt(sigmabb)
      t9 = t3*rhob
      t11 = t8/t9
      t12 = dlog(t11+dsqrt(1+t11**2))
      t13 = t11*t12
      zk(i) = (-0.9593273689405774D0-0.3640595D-1*t7/(1.D0+0.21D-1*t13
     #)+0.35481306D-1*t7/(1.D0+0.252D-1*t13))*t9
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**2
      t3 = rhoa**(1.D0/3.D0)
      t4 = t3**2
      t7 = sigmaaa/t4/t2
      t8 = dsqrt(sigmaaa)
      t9 = t3*rhoa
      t11 = t8/t9
      t12 = dlog(t11+dsqrt(1+t11**2))
      t13 = t11*t12
      zk(i) = (-0.9593273689405774D0-0.3640595D-1*t7/(1.D0+0.21D-1*t13
     #)+0.35481306D-1*t7/(1.D0+0.252D-1*t13))*t9
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**2
      t5 = rhoa**(1.D0/3.D0)
      t6 = t5**2
      t9 = sigmaaa/t6/t4
      t10 = dsqrt(sigmaaa)
      t11 = t5*rhoa
      t13 = t10/t11
      t14 = dlog(t13+dsqrt(1+t13**2))
      t15 = t13*t14
      t28 = rhob**2
      t29 = rhob**(1.D0/3.D0)
      t30 = t29**2
      t33 = sigmabb/t30/t28
      t34 = dsqrt(sigmabb)
      t35 = t29*rhob
      t37 = t34/t35
      t38 = dlog(t37+dsqrt(1+t37**2))
      t39 = t37*t38
      zk(i) = (-0.9593273689405774D0-0.3640595D-1*t9/(1.D0+0.21D-1*t15
     #)+0.35481306D-1*t9/(1.D0+0.252D-1*t15))*t11+(
     #-0.9593273689405774D0-0.3640595D-1*t33/(1.D0+0.21D-1*t39)
     #+0.35481306D-1*t33/(1.D0+0.252D-1*t39))*t35
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**2
      t3 = rhob**(1.D0/3.D0)
      t4 = t3**2
      t6 = 1/t4/t2
      t7 = sigmabb*t6
      t8 = dsqrt(sigmabb)
      t9 = t3*rhob
      t10 = 1/t9
      t11 = t8*t10
      t12 = dlog(t11+dsqrt(1+t11**2))
      t13 = t11*t12
      t15 = 1.D0+0.21D-1*t13
      t16 = 1/t15
      t20 = 1.D0+0.252D-1*t13
      t21 = 1/t20
      t24 = -0.9593273689405774D0-0.3640595D-1*t7*t16+0.35481306D-1*t7
     #*t21
      zk(i) = t24*t9
      vrhoa(i) = 0.D0
      t28 = sigmabb/t4/t2/rhob
      t31 = t15**2
      t32 = 1/t31
      t36 = t8/t3/t2*t12
      t39 = dsqrt(1.D0+t7)
      t40 = 1/t39
      t41 = t28*t40
      t49 = t20**2
      t50 = 1/t49
      vrhob(i) = (0.9708253333333333D-1*t28*t16+0.3640595D-1*t7*t32*(
     #-0.28D-1*t36-0.28D-1*t41)-0.94616816D-1*t28*t21-0.35481306D-1*t7
     #*t50*(-0.336D-1*t36-0.336D-1*t41))*t9+0.1333333333333333D1*t24*t3
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      t65 = 1/t8*t10*t12
      t67 = t6*t40
      vsigmabb(i) = (-0.3640595D-1*t6*t16+0.3640595D-1*t7*t32*
     #(0.105D-1*t65+0.105D-1*t67)+0.35481306D-1*t6*t21-0.35481306D-1
     #*t7*t50*(0.126D-1*t65+0.126D-1*t67))*t9
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**2
      t3 = rhoa**(1.D0/3.D0)
      t4 = t3**2
      t6 = 1/t4/t2
      t7 = sigmaaa*t6
      t8 = dsqrt(sigmaaa)
      t9 = t3*rhoa
      t10 = 1/t9
      t11 = t8*t10
      t12 = dlog(t11+dsqrt(1+t11**2))
      t13 = t11*t12
      t15 = 1.D0+0.21D-1*t13
      t16 = 1/t15
      t20 = 1.D0+0.252D-1*t13
      t21 = 1/t20
      t24 = -0.9593273689405774D0-0.3640595D-1*t7*t16+0.35481306D-1*t7
     #*t21
      zk(i) = t24*t9
      t28 = sigmaaa/t4/t2/rhoa
      t31 = t15**2
      t32 = 1/t31
      t36 = t8/t3/t2*t12
      t39 = dsqrt(1.D0+t7)
      t40 = 1/t39
      t41 = t28*t40
      t49 = t20**2
      t50 = 1/t49
      vrhoa(i) = (0.9708253333333333D-1*t28*t16+0.3640595D-1*t7*t32*(
     #-0.28D-1*t36-0.28D-1*t41)-0.94616816D-1*t28*t21-0.35481306D-1*t7
     #*t50*(-0.336D-1*t36-0.336D-1*t41))*t9+0.1333333333333333D1*t24*t3
      vrhob(i) = 0.D0
      t65 = 1/t8*t10*t12
      t67 = t6*t40
      vsigmaaa(i) = (-0.3640595D-1*t6*t16+0.3640595D-1*t7*t32*
     #(0.105D-1*t65+0.105D-1*t67)+0.35481306D-1*t6*t21-0.35481306D-1
     #*t7*t50*(0.126D-1*t65+0.126D-1*t67))*t9
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**2
      t5 = rhoa**(1.D0/3.D0)
      t6 = t5**2
      t8 = 1/t6/t4
      t9 = sigmaaa*t8
      t10 = dsqrt(sigmaaa)
      t11 = t5*rhoa
      t12 = 1/t11
      t13 = t10*t12
      t14 = dlog(t13+dsqrt(1+t13**2))
      t15 = t13*t14
      t17 = 1.D0+0.21D-1*t15
      t18 = 1/t17
      t22 = 1.D0+0.252D-1*t15
      t23 = 1/t22
      t26 = -0.9593273689405774D0-0.3640595D-1*t9*t18+0.35481306D-1*t9
     #*t23
      t28 = rhob**2
      t29 = rhob**(1.D0/3.D0)
      t30 = t29**2
      t32 = 1/t30/t28
      t33 = sigmabb*t32
      t34 = dsqrt(sigmabb)
      t35 = t29*rhob
      t36 = 1/t35
      t37 = t34*t36
      t38 = dlog(t37+dsqrt(1+t37**2))
      t39 = t37*t38
      t41 = 1.D0+0.21D-1*t39
      t42 = 1/t41
      t46 = 1.D0+0.252D-1*t39
      t47 = 1/t46
      t50 = -0.9593273689405774D0-0.3640595D-1*t33*t42+0.35481306D-1
     #*t33*t47
      zk(i) = t26*t11+t50*t35
      t55 = sigmaaa/t6/t4/rhoa
      t58 = t17**2
      t59 = 1/t58
      t63 = t10/t5/t4*t14
      t66 = dsqrt(1.D0+t9)
      t67 = 1/t66
      t68 = t55*t67
      t76 = t22**2
      t77 = 1/t76
      vrhoa(i) = (0.9708253333333333D-1*t55*t18+0.3640595D-1*t9*t59*(
     #-0.28D-1*t63-0.28D-1*t68)-0.94616816D-1*t55*t23-0.35481306D-1*t9
     #*t77*(-0.336D-1*t63-0.336D-1*t68))*t11+0.1333333333333333D1*t26*t5
      t91 = sigmabb/t30/t28/rhob
      t94 = t41**2
      t95 = 1/t94
      t99 = t34/t29/t28*t38
      t102 = dsqrt(1.D0+t33)
      t103 = 1/t102
      t104 = t91*t103
      t112 = t46**2
      t113 = 1/t112
      vrhob(i) = (0.9708253333333333D-1*t91*t42+0.3640595D-1*t33*t95*(
     #-0.28D-1*t99-0.28D-1*t104)-0.94616816D-1*t91*t47-0.35481306D-1
     #*t33*t113*(-0.336D-1*t99-0.336D-1*t104))*t35
     #+0.1333333333333333D1*t50*t29
      t128 = 1/t10*t12*t14
      t130 = t8*t67
      vsigmaaa(i) = (-0.3640595D-1*t8*t18+0.3640595D-1*t9*t59*
     #(0.105D-1*t128+0.105D-1*t130)+0.35481306D-1*t8*t23-0.35481306D-1
     #*t9*t77*(0.126D-1*t128+0.126D-1*t130))*t11
      vsigmaab(i) = 0.D0
      t149 = 1/t34*t36*t38
      t151 = t32*t103
      vsigmabb(i) = (-0.3640595D-1*t32*t42+0.3640595D-1*t33*t95*
     #(0.105D-1*t149+0.105D-1*t151)+0.35481306D-1*t32*t47
     #-0.35481306D-1*t33*t113*(0.126D-1*t149+0.126D-1*t151))*t35
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**2
      t3 = rhob**(1.D0/3.D0)
      t4 = t3**2
      t6 = 1/t4/t2
      t7 = sigmabb*t6
      t8 = dsqrt(sigmabb)
      t9 = t3*rhob
      t10 = 1/t9
      t11 = t8*t10
      t12 = dlog(t11+dsqrt(1+t11**2))
      t13 = t11*t12
      t15 = 1.D0+0.21D-1*t13
      t16 = 1/t15
      t20 = 1.D0+0.252D-1*t13
      t21 = 1/t20
      t24 = -0.9593273689405774D0-0.3640595D-1*t7*t16+0.35481306D-1*t7
     #*t21
      zk(i) = t24*t9
      vrhoa(i) = 0.D0
      t25 = t2*rhob
      t28 = sigmabb/t4/t25
      t31 = t15**2
      t32 = 1/t31
      t36 = t8/t3/t2*t12
      t38 = 1.D0+t7
      t39 = dsqrt(t38)
      t40 = 1/t39
      t41 = t28*t40
      t43 = -0.28D-1*t36-0.28D-1*t41
      t44 = t32*t43
      t49 = t20**2
      t50 = 1/t49
      t53 = -0.336D-1*t36-0.336D-1*t41
      t54 = t50*t53
      t57 = 0.9708253333333333D-1*t28*t16+0.3640595D-1*t7*t44
     #-0.94616816D-1*t28*t21-0.35481306D-1*t7*t54
      vrhob(i) = t57*t9+0.1333333333333333D1*t24*t3
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      t65 = 1/t8*t10*t12
      t67 = t6*t40
      t69 = 0.105D-1*t65+0.105D-1*t67
      t77 = 0.126D-1*t65+0.126D-1*t67
      vsigmabb(i) = (-0.3640595D-1*t6*t16+0.3640595D-1*t7*t32*t69
     #+0.35481306D-1*t6*t21-0.35481306D-1*t7*t50*t77)*t9
      v2rhoa2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t82 = t2**2
      t85 = sigmabb/t4/t82
      t91 = 1/t31/t15
      t92 = t43**2
      t99 = t8/t3/t25*t12
      t101 = t85*t40
      t103 = sigmabb**2
      t109 = 1/t39/t38
      t110 = t103/t3/t82/t25*t109
      t121 = 1/t49/t20
      t122 = t53**2
      v2rhob2(i) = (-0.3559692888888889D0*t85*t16-0.1941650666666667D0
     #*t28*t44-0.728119D-1*t7*t91*t92+0.3640595D-1*t7*t32*
     #(0.6533333333333333D-1*t99+0.14D0*t101-0.3733333333333333D-1
     #*t110)+0.3469283253333333D0*t85*t21+0.189233632D0*t28*t54
     #+0.70962612D-1*t7*t121*t122-0.35481306D-1*t7*t50*(0.784D-1*t99
     #+0.168D0*t101-0.448D-1*t110))*t9+0.2666666666666667D1*t57*t3
     #+0.4444444444444444D0*t24/t4
      v2sigmaaa2(i) = 0.D0
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      t143 = t69**2
      t150 = 1/t8/sigmabb*t10*t12
      t154 = 1/sigmabb*t6*t40
      t159 = 1/t3/t82/rhob*t109
      t168 = t77**2
      v2sigmabb2(i) = (0.728119D-1*t6*t32*t69-0.728119D-1*t7*t91*t143
     #+0.3640595D-1*t7*t32*(-0.525D-2*t150+0.525D-2*t154-0.525D-2*t159
     #)-0.70962612D-1*t6*t50*t77+0.70962612D-1*t7*t121*t168
     #-0.35481306D-1*t7*t50*(-0.63D-2*t150+0.63D-2*t154-0.63D-2*t159))
     #*t9
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**2
      t3 = rhoa**(1.D0/3.D0)
      t4 = t3**2
      t6 = 1/t4/t2
      t7 = sigmaaa*t6
      t8 = dsqrt(sigmaaa)
      t9 = t3*rhoa
      t10 = 1/t9
      t11 = t8*t10
      t12 = dlog(t11+dsqrt(1+t11**2))
      t13 = t11*t12
      t15 = 1.D0+0.21D-1*t13
      t16 = 1/t15
      t20 = 1.D0+0.252D-1*t13
      t21 = 1/t20
      t24 = -0.9593273689405774D0-0.3640595D-1*t7*t16+0.35481306D-1*t7
     #*t21
      zk(i) = t24*t9
      t25 = t2*rhoa
      t28 = sigmaaa/t4/t25
      t31 = t15**2
      t32 = 1/t31
      t36 = t8/t3/t2*t12
      t38 = 1.D0+t7
      t39 = dsqrt(t38)
      t40 = 1/t39
      t41 = t28*t40
      t43 = -0.28D-1*t36-0.28D-1*t41
      t44 = t32*t43
      t49 = t20**2
      t50 = 1/t49
      t53 = -0.336D-1*t36-0.336D-1*t41
      t54 = t50*t53
      t57 = 0.9708253333333333D-1*t28*t16+0.3640595D-1*t7*t44
     #-0.94616816D-1*t28*t21-0.35481306D-1*t7*t54
      vrhoa(i) = t57*t9+0.1333333333333333D1*t24*t3
      vrhob(i) = 0.D0
      t65 = 1/t8*t10*t12
      t67 = t6*t40
      t69 = 0.105D-1*t65+0.105D-1*t67
      t77 = 0.126D-1*t65+0.126D-1*t67
      vsigmaaa(i) = (-0.3640595D-1*t6*t16+0.3640595D-1*t7*t32*t69
     #+0.35481306D-1*t6*t21-0.35481306D-1*t7*t50*t77)*t9
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      t82 = t2**2
      t85 = sigmaaa/t4/t82
      t91 = 1/t31/t15
      t92 = t43**2
      t99 = t8/t3/t25*t12
      t101 = t85*t40
      t103 = sigmaaa**2
      t109 = 1/t39/t38
      t110 = t103/t3/t82/t25*t109
      t121 = 1/t49/t20
      t122 = t53**2
      v2rhoa2(i) = (-0.3559692888888889D0*t85*t16-0.1941650666666667D0
     #*t28*t44-0.728119D-1*t7*t91*t92+0.3640595D-1*t7*t32*
     #(0.6533333333333333D-1*t99+0.14D0*t101-0.3733333333333333D-1
     #*t110)+0.3469283253333333D0*t85*t21+0.189233632D0*t28*t54
     #+0.70962612D-1*t7*t121*t122-0.35481306D-1*t7*t50*(0.784D-1*t99
     #+0.168D0*t101-0.448D-1*t110))*t9+0.2666666666666667D1*t57*t3
     #+0.4444444444444444D0*t24/t4
      v2rhob2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t143 = t69**2
      t150 = 1/t8/sigmaaa*t10*t12
      t154 = 1/sigmaaa*t6*t40
      t159 = 1/t3/t82/rhoa*t109
      t168 = t77**2
      v2sigmaaa2(i) = (0.728119D-1*t6*t32*t69-0.728119D-1*t7*t91*t143
     #+0.3640595D-1*t7*t32*(-0.525D-2*t150+0.525D-2*t154-0.525D-2*t159
     #)-0.70962612D-1*t6*t50*t77+0.70962612D-1*t7*t121*t168
     #-0.35481306D-1*t7*t50*(-0.63D-2*t150+0.63D-2*t154-0.63D-2*t159))
     #*t9
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      v2sigmabb2(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**2
      t5 = rhoa**(1.D0/3.D0)
      t6 = t5**2
      t8 = 1/t6/t4
      t9 = sigmaaa*t8
      t10 = dsqrt(sigmaaa)
      t11 = t5*rhoa
      t12 = 1/t11
      t13 = t10*t12
      t14 = dlog(t13+dsqrt(1+t13**2))
      t15 = t13*t14
      t17 = 1.D0+0.21D-1*t15
      t18 = 1/t17
      t22 = 1.D0+0.252D-1*t15
      t23 = 1/t22
      t26 = -0.9593273689405774D0-0.3640595D-1*t9*t18+0.35481306D-1*t9
     #*t23
      t28 = rhob**2
      t29 = rhob**(1.D0/3.D0)
      t30 = t29**2
      t32 = 1/t30/t28
      t33 = sigmabb*t32
      t34 = dsqrt(sigmabb)
      t35 = t29*rhob
      t36 = 1/t35
      t37 = t34*t36
      t38 = dlog(t37+dsqrt(1+t37**2))
      t39 = t37*t38
      t41 = 1.D0+0.21D-1*t39
      t42 = 1/t41
      t46 = 1.D0+0.252D-1*t39
      t47 = 1/t46
      t50 = -0.9593273689405774D0-0.3640595D-1*t33*t42+0.35481306D-1
     #*t33*t47
      zk(i) = t26*t11+t50*t35
      t52 = t4*rhoa
      t54 = 1/t6/t52
      t55 = sigmaaa*t54
      t58 = t17**2
      t59 = 1/t58
      t61 = 1/t5/t4
      t63 = t10*t61*t14
      t65 = 1.D0+t9
      t66 = dsqrt(t65)
      t67 = 1/t66
      t68 = t55*t67
      t70 = -0.28D-1*t63-0.28D-1*t68
      t71 = t59*t70
      t76 = t22**2
      t77 = 1/t76
      t80 = -0.336D-1*t63-0.336D-1*t68
      t81 = t77*t80
      t84 = 0.9708253333333333D-1*t55*t18+0.3640595D-1*t9*t71
     #-0.94616816D-1*t55*t23-0.35481306D-1*t9*t81
      vrhoa(i) = t84*t11+0.1333333333333333D1*t26*t5
      t88 = t28*rhob
      t90 = 1/t30/t88
      t91 = sigmabb*t90
      t94 = t41**2
      t95 = 1/t94
      t97 = 1/t29/t28
      t99 = t34*t97*t38
      t101 = 1.D0+t33
      t102 = dsqrt(t101)
      t103 = 1/t102
      t104 = t91*t103
      t106 = -0.28D-1*t99-0.28D-1*t104
      t107 = t95*t106
      t112 = t46**2
      t113 = 1/t112
      t116 = -0.336D-1*t99-0.336D-1*t104
      t117 = t113*t116
      t120 = 0.9708253333333333D-1*t91*t42+0.3640595D-1*t33*t107
     #-0.94616816D-1*t91*t47-0.35481306D-1*t33*t117
      vrhob(i) = t120*t35+0.1333333333333333D1*t50*t29
      t126 = 1/t10
      t128 = t126*t12*t14
      t130 = t8*t67
      t132 = 0.105D-1*t128+0.105D-1*t130
      t133 = t59*t132
      t140 = 0.126D-1*t128+0.126D-1*t130
      t141 = t77*t140
      t144 = -0.3640595D-1*t8*t18+0.3640595D-1*t9*t133+0.35481306D-1
     #*t8*t23-0.35481306D-1*t9*t141
      vsigmaaa(i) = t144*t11
      vsigmaab(i) = 0.D0
      t147 = 1/t34
      t149 = t147*t36*t38
      t151 = t32*t103
      t153 = 0.105D-1*t149+0.105D-1*t151
      t154 = t95*t153
      t161 = 0.126D-1*t149+0.126D-1*t151
      t162 = t113*t161
      t165 = -0.3640595D-1*t32*t42+0.3640595D-1*t33*t154+0.35481306D-1
     #*t32*t47-0.35481306D-1*t33*t162
      vsigmabb(i) = t165*t35
      t166 = t4**2
      t169 = sigmaaa/t6/t166
      t175 = 1/t58/t17
      t176 = t70**2
      t183 = t10/t5/t52*t14
      t185 = t169*t67
      t187 = sigmaaa**2
      t193 = 1/t66/t65
      t194 = t187/t5/t166/t52*t193
      t205 = 1/t76/t22
      t206 = t80**2
      v2rhoa2(i) = (-0.3559692888888889D0*t169*t18
     #-0.1941650666666667D0*t55*t71-0.728119D-1*t9*t175*t176
     #+0.3640595D-1*t9*t59*(0.6533333333333333D-1*t183+0.14D0*t185
     #-0.3733333333333333D-1*t194)+0.3469283253333333D0*t169*t23
     #+0.189233632D0*t55*t81+0.70962612D-1*t9*t205*t206-0.35481306D-1
     #*t9*t77*(0.784D-1*t183+0.168D0*t185-0.448D-1*t194))*t11
     #+0.2666666666666667D1*t84*t5+0.4444444444444444D0*t26/t6
      t224 = t28**2
      t227 = sigmabb/t30/t224
      t233 = 1/t94/t41
      t234 = t106**2
      t241 = t34/t29/t88*t38
      t243 = t227*t103
      t245 = sigmabb**2
      t251 = 1/t102/t101
      t252 = t245/t29/t224/t88*t251
      t263 = 1/t112/t46
      t264 = t116**2
      v2rhob2(i) = (-0.3559692888888889D0*t227*t42
     #-0.1941650666666667D0*t91*t107-0.728119D-1*t33*t233*t234
     #+0.3640595D-1*t33*t95*(0.6533333333333333D-1*t241+0.14D0*t243
     #-0.3733333333333333D-1*t252)+0.3469283253333333D0*t227*t47
     #+0.189233632D0*t91*t117+0.70962612D-1*t33*t263*t264
     #-0.35481306D-1*t33*t113*(0.784D-1*t241+0.168D0*t243-0.448D-1
     #*t252))*t35+0.2666666666666667D1*t120*t29+0.4444444444444444D0
     #*t50/t30
      v2rhoab(i) = 0.D0
      t286 = t8*t59
      t294 = t126*t61*t14
      t296 = t54*t67
      t302 = sigmaaa/t5/t166/t4*t193
      t312 = t8*t77
      v2rhoasigmaaa(i) = (0.9708253333333333D-1*t54*t18
     #-0.9708253333333333D-1*t55*t133+0.3640595D-1*t286*t70
     #-0.728119D-1*t9*t175*t70*t132+0.3640595D-1*t9*t59*(-0.14D-1*t294
     #-0.42D-1*t296+0.14D-1*t302)-0.94616816D-1*t54*t23+0.94616816D-1
     #*t55*t141-0.35481306D-1*t312*t80+0.70962612D-1*t9*t205*t80*t140
     #-0.35481306D-1*t9*t77*(-0.168D-1*t294-0.504D-1*t296+0.168D-1
     #*t302))*t11+0.1333333333333333D1*t144*t5
      v2rhoasigmaab(i) = 0.D0
      v2rhoasigmabb(i) = 0.D0
      v2rhobsigmaaa(i) = 0.D0
      v2rhobsigmaab(i) = 0.D0
      t334 = t32*t95
      t342 = t147*t97*t38
      t344 = t90*t103
      t350 = sigmabb/t29/t224/t28*t251
      t360 = t32*t113
      v2rhobsigmabb(i) = (0.9708253333333333D-1*t90*t42
     #-0.9708253333333333D-1*t91*t154+0.3640595D-1*t334*t106
     #-0.728119D-1*t33*t233*t106*t153+0.3640595D-1*t33*t95*(-0.14D-1
     #*t342-0.42D-1*t344+0.14D-1*t350)-0.94616816D-1*t90*t47
     #+0.94616816D-1*t91*t162-0.35481306D-1*t360*t116+0.70962612D-1
     #*t33*t263*t116*t161-0.35481306D-1*t33*t113*(-0.168D-1*t342
     #-0.504D-1*t344+0.168D-1*t350))*t35+0.1333333333333333D1*t165*t29
      t380 = t132**2
      t387 = 1/t10/sigmaaa*t12*t14
      t391 = 1/sigmaaa*t8*t67
      t396 = 1/t5/t166/rhoa*t193
      t404 = t140**2
      v2sigmaaa2(i) = (0.728119D-1*t286*t132-0.728119D-1*t9*t175*t380
     #+0.3640595D-1*t9*t59*(-0.525D-2*t387+0.525D-2*t391-0.525D-2*t396
     #)-0.70962612D-1*t312*t140+0.70962612D-1*t9*t205*t404
     #-0.35481306D-1*t9*t77*(-0.63D-2*t387+0.63D-2*t391-0.63D-2*t396))
     #*t11
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      t418 = t153**2
      t425 = 1/t34/sigmabb*t36*t38
      t429 = 1/sigmabb*t32*t103
      t434 = 1/t29/t224/rhob*t251
      t442 = t161**2
      v2sigmabb2(i) = (0.728119D-1*t334*t153-0.728119D-1*t33*t233*t418
     #+0.3640595D-1*t33*t95*(-0.525D-2*t425+0.525D-2*t429-0.525D-2
     #*t434)-0.70962612D-1*t360*t161+0.70962612D-1*t33*t263*t442
     #-0.35481306D-1*t33*t113*(-0.63D-2*t425+0.63D-2*t429-0.63D-2*t434
     #))*t35
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      v2rhob2(i) = 0.0d0
      v2rhoab(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2rhoasigmaab(i) = 0.0d0
      v2rhoasigmabb(i) = 0.0d0
      v2rhobsigmaaa(i) = 0.0d0
      v2rhobsigmaab(i) = 0.0d0
      v2rhobsigmabb(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      v2sigmaab2(i) = 0.0d0
      v2sigmabb2(i) = 0.0d0
      v2sigmaaaab(i) = 0.0d0
      v2sigmaaabb(i) = 0.0d0
      v2sigmaabbb(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end
      
      
      subroutine rks_x_edf1
     & (ideriv,npt,rhoa1,sigmaaa1,
     &  zk,vrhoa,vsigmaaa,
     &  v2rhoa2,v2rhoasigmaaa,v2sigmaaa2)
c
c     R.D. Adamson, P.M.W. Gill, and J.A. Pople
c     Empirical density functionals
c     Chem. Phys. Lett. 284 (1998) 6-11
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt)
      REAL sigmaaa1(npt)
      REAL zk(npt),vrhoa(npt),vsigmaaa(npt)
      REAL v2rhoa2(npt),v2rhoasigmaaa(npt),v2sigmaaa2(npt)
      parameter(tol=1.0d-20)
      
      if(ideriv.eq.0) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**2
      t3 = rho**(1.D0/3.D0)
      t4 = t3**2
      t7 = sigma/t4/t2
      t8 = dsqrt(sigma)
      t9 = t3*rho
      t11 = t8/t9
      t13 = dlog(0.1259921049894873D1*t11+dsqrt(1+0.1587401051968199D1
     #*t11**2))
      t14 = t11*t13
      zk(i) = 0.7937005259840997D0*(-0.9593273689405774D0
     #-0.5779084332790167D-1*t7/(1.D0+0.2645834204779234D-1*t14)
     #+0.5632306246960559D-1*t7/(1.D0+0.317500104573508D-1*t14))*t9
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**2
      t3 = rho**(1.D0/3.D0)
      t4 = t3**2
      t6 = 1/t4/t2
      t7 = sigma*t6
      t8 = dsqrt(sigma)
      t9 = t3*rho
      t10 = 1/t9
      t11 = t8*t10
      t13 = dlog(0.1259921049894873D1*t11+dsqrt(1+0.1587401051968199D1
     #*t11**2))
      t14 = t11*t13
      t16 = 1.D0+0.2645834204779234D-1*t14
      t17 = 1/t16
      t21 = 1.D0+0.317500104573508D-1*t14
      t22 = 1/t21
      t25 = -0.9593273689405774D0-0.5779084332790167D-1*t7*t17
     #+0.5632306246960559D-1*t7*t22
      zk(i) = 0.7937005259840997D0*t25*t9
      t30 = sigma/t4/t2/rho
      t33 = t16**2
      t34 = 1/t33
      t38 = t8/t3/t2*t13
      t42 = dsqrt(1.D0+0.1587401051968199D1*t7)
      t43 = 1/t42
      t44 = t30*t43
      t52 = t21**2
      t53 = 1/t52
      vrhoa(i) = 0.3968502629920499D0*(0.3082178310821422D0*t30*t17
     #+0.5779084332790167D-1*t7*t34*(-0.705555787941129D-1*t38
     #-0.8889445891021917D-1*t44)-0.3003896665045631D0*t30*t22
     #-0.5632306246960559D-1*t7*t53*(-0.8466669455293548D-1*t38
     #-0.106673350692263D0*t44))*t9+0.10582673679788D1*t25*t3
      t69 = 1/t8*t10*t13
      t71 = t6*t43
      vsigmaaa(i) = 0.7937005259840997D0*(-0.2311633733116067D0*t6*t17
     #+0.5779084332790167D-1*t7*t34*(0.5291668409558467D-1*t69
     #+0.6667084418266438D-1*t71)+0.2252922498784224D0*t6*t22
     #-0.5632306246960559D-1*t7*t53*(0.6350002091470161D-1*t69
     #+0.8000501301919725D-1*t71))*t9
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**2
      t3 = rho**(1.D0/3.D0)
      t4 = t3**2
      t6 = 1/t4/t2
      t7 = sigma*t6
      t8 = dsqrt(sigma)
      t9 = t3*rho
      t10 = 1/t9
      t11 = t8*t10
      t13 = dlog(0.1259921049894873D1*t11+dsqrt(1+0.1587401051968199D1
     #*t11**2))
      t14 = t11*t13
      t16 = 1.D0+0.2645834204779234D-1*t14
      t17 = 1/t16
      t21 = 1.D0+0.317500104573508D-1*t14
      t22 = 1/t21
      t25 = -0.9593273689405774D0-0.5779084332790167D-1*t7*t17
     #+0.5632306246960559D-1*t7*t22
      zk(i) = 0.7937005259840997D0*t25*t9
      t27 = t2*rho
      t29 = 1/t4/t27
      t30 = sigma*t29
      t33 = t16**2
      t34 = 1/t33
      t36 = 1/t3/t2
      t38 = t8*t36*t13
      t41 = 1.D0+0.1587401051968199D1*t7
      t42 = dsqrt(t41)
      t43 = 1/t42
      t44 = t30*t43
      t46 = -0.705555787941129D-1*t38-0.8889445891021917D-1*t44
      t47 = t34*t46
      t52 = t21**2
      t53 = 1/t52
      t56 = -0.8466669455293548D-1*t38-0.106673350692263D0*t44
      t57 = t53*t56
      t60 = 0.3082178310821422D0*t30*t17+0.5779084332790167D-1*t7*t47
     #-0.3003896665045631D0*t30*t22-0.5632306246960559D-1*t7*t57
      vrhoa(i) = 0.3968502629920499D0*t60*t9+0.10582673679788D1*t25*t3
      t67 = 1/t8
      t69 = t67*t10*t13
      t71 = t6*t43
      t73 = 0.5291668409558467D-1*t69+0.6667084418266438D-1*t71
      t74 = t34*t73
      t81 = 0.6350002091470161D-1*t69+0.8000501301919725D-1*t71
      t82 = t53*t81
      t85 = -0.2311633733116067D0*t6*t17+0.5779084332790167D-1*t7*t74
     #+0.2252922498784224D0*t6*t22-0.5632306246960559D-1*t7*t82
      vsigmaaa(i) = 0.7937005259840997D0*t85*t9
      t87 = t2**2
      t90 = sigma/t4/t87
      t96 = 1/t33/t16
      t97 = t46**2
      t104 = t8/t3/t27*t13
      t106 = t90*t43
      t108 = sigma**2
      t114 = 1/t42/t41
      t115 = t108/t3/t87/t27*t114
      t126 = 1/t52/t21
      t127 = t56**2
      v2rhoa2(i) = 0.3968502629920499D0*(-0.2260264094602376D1*t90*t17
     #-0.6164356621642845D0*t30*t47-0.1155816866558033D0*t7*t96*t97
     #+0.5779084332790167D-1*t7*t34*(0.3292593677058602D0*t104
     #+0.8889445891021917D0*t106-0.3762964202352688D0*t115)
     #+0.2202857554366796D1*t90*t22+0.6007793330091263D0*t30*t57
     #+0.1126461249392112D0*t7*t126*t127-0.5632306246960559D-1*t7*t53*
     #(0.3951112412470322D0*t104+0.106673350692263D1*t106
     #-0.4515557042823225D0*t115))*t9+0.2116534735957599D1*t60*t3
     #+0.7055115786525331D0*t25/t4
      t150 = t6*t34
      t158 = t67*t36*t13
      t160 = t29*t43
      t166 = sigma/t3/t87/t2*t114
      t176 = t6*t53
      v2rhoasigmaaa(i) = 0.3968502629920499D0*(0.1232871324328569D1
     #*t29*t17-0.3082178310821422D0*t30*t74+0.2311633733116067D0*t150
     #*t46-0.1155816866558033D0*t7*t96*t46*t73+0.5779084332790167D-1
     #*t7*t34*(-0.1411111575882258D0*t158-0.533366753461315D0*t160
     #+0.2822223151764516D0*t166)-0.1201558666018253D1*t29*t22
     #+0.3003896665045631D0*t30*t82-0.2252922498784224D0*t176*t56
     #+0.1126461249392112D0*t7*t126*t56*t81-0.5632306246960559D-1*t7
     #*t53*(-0.169333389105871D0*t158-0.640040104153578D0*t160
     #+0.3386667782117419D0*t166))*t9+0.10582673679788D1*t85*t3
      t197 = t73**2
      t204 = 1/t8/sigma*t10*t13
      t208 = 1/sigma*t6*t43
      t213 = 1/t3/t87/rho*t114
      t221 = t81**2
      v2sigmaaa2(i) = 0.7937005259840997D0*(0.4623267466232134D0*t150
     #*t73-0.1155816866558033D0*t7*t96*t197+0.5779084332790167D-1*t7
     #*t34*(-0.1058333681911693D0*t204+0.1333416883653288D0*t208
     #-0.2116667363823387D0*t213)-0.4505844997568447D0*t176*t81
     #+0.1126461249392112D0*t7*t126*t221-0.5632306246960559D-1*t7*t53*
     #(-0.1270000418294032D0*t204+0.1600100260383945D0*t208
     #-0.2540000836588064D0*t213))*t9
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end

c:X_EDF1subrend
_ENDIF
_IF(ccpdft,all,x_lda)
c:X_LDAsubrstart

c    Generated: Wed Jan 29 09:08:46 GMT 2003

      subroutine uks_x_lda
     & (ideriv,npt,rhoa1,rhob1,sigmaaa1,sigmabb1,sigmaab1,
     &  zk,vrhoa,vrhob,vsigmaaa,vsigmabb,vsigmaab,
     &  v2rhoa2,v2rhob2,v2rhoab,
     &  v2rhoasigmaaa,v2rhoasigmaab,v2rhoasigmabb,
     &  v2rhobsigmabb,v2rhobsigmaab,v2rhobsigmaaa,
     &  v2sigmaaa2,v2sigmaaaab,v2sigmaaabb,
     &  v2sigmaab2,v2sigmaabbb,v2sigmabb2)
c
c     P.A.M. Dirac
c     Proceedings of the Cambridge Philosophical Society, 26 (1930) 376
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt),rhob1(npt)
      REAL sigmaaa1(npt),sigmabb1(npt),sigmaab1(npt)
      REAL zk(npt),vrhoa(npt),vrhob(npt)
      REAL vsigmaaa(npt),vsigmabb(npt),vsigmaab(npt)
      REAL v2rhoa2(npt),v2rhob2(npt),v2rhoab(npt)
      REAL v2rhoasigmaaa(npt),v2rhoasigmaab(npt)
      REAL v2rhoasigmabb(npt),v2rhobsigmabb(npt)
      REAL v2rhobsigmaab(npt),v2rhobsigmaaa(npt)
      REAL v2sigmaaa2(npt),v2sigmaaaab(npt),v2sigmaaabb(npt)
      REAL v2sigmaab2(npt),v2sigmaabbb(npt),v2sigmabb2(npt)
      parameter(tol=1.0d-20)
      
      if (ideriv.eq.0) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      t1 = rhob**(1.D0/3.D0)
      zk(i) = -0.9305257363491D0*t1*rhob
      elseif(rhob.lt.tol) then
      rho = rhoa
      t1 = rhoa**(1.D0/3.D0)
      zk(i) = -0.9305257363491D0*t1*rhoa
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      t1 = rhoa**(1.D0/3.D0)
      t4 = rhob**(1.D0/3.D0)
      zk(i) = -0.9305257363491D0*t1*rhoa-0.9305257363491D0*t4*rhob
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      t1 = rhob**(1.D0/3.D0)
      zk(i) = -0.9305257363491D0*t1*rhob
      vrhoa(i) = 0.D0
      vrhob(i) = -0.12407009817988D1*t1
      elseif(rhob.lt.tol) then
      rho = rhoa
      t1 = rhoa**(1.D0/3.D0)
      zk(i) = -0.9305257363491D0*t1*rhoa
      vrhoa(i) = -0.12407009817988D1*t1
      vrhob(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      t1 = rhoa**(1.D0/3.D0)
      t4 = rhob**(1.D0/3.D0)
      zk(i) = -0.9305257363491D0*t1*rhoa-0.9305257363491D0*t4*rhob
      vrhoa(i) = -0.12407009817988D1*t1
      vrhob(i) = -0.12407009817988D1*t4
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      t1 = rhob**(1.D0/3.D0)
      zk(i) = -0.9305257363491D0*t1*rhob
      vrhoa(i) = 0.D0
      vrhob(i) = -0.12407009817988D1*t1
      v2rhoa2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t5 = t1**2
      v2rhob2(i) = -0.4135669939329333D0/t5
      elseif(rhob.lt.tol) then
      rho = rhoa
      t1 = rhoa**(1.D0/3.D0)
      zk(i) = -0.9305257363491D0*t1*rhoa
      vrhoa(i) = -0.12407009817988D1*t1
      vrhob(i) = 0.D0
      t5 = t1**2
      v2rhoa2(i) = -0.4135669939329333D0/t5
      v2rhob2(i) = 0.D0
      v2rhoab(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      t1 = rhoa**(1.D0/3.D0)
      t4 = rhob**(1.D0/3.D0)
      zk(i) = -0.9305257363491D0*t1*rhoa-0.9305257363491D0*t4*rhob
      vrhoa(i) = -0.12407009817988D1*t1
      vrhob(i) = -0.12407009817988D1*t4
      t9 = t1**2
      v2rhoa2(i) = -0.4135669939329333D0/t9
      t12 = t4**2
      v2rhob2(i) = -0.4135669939329333D0/t12
      v2rhoab(i) = 0.D0
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      v2rhob2(i) = 0.0d0
      v2rhoab(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end
      
      
      subroutine rks_x_lda
     & (ideriv,npt,rhoa1,sigmaaa1,
     &  zk,vrhoa,vsigmaaa,
     &  v2rhoa2,v2rhoasigmaaa,v2sigmaaa2)
c
c     P.A.M. Dirac
c     Proceedings of the Cambridge Philosophical Society, 26 (1930) 376
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt)
      REAL sigmaaa1(npt)
      REAL zk(npt),vrhoa(npt),vsigmaaa(npt)
      REAL v2rhoa2(npt),v2rhoasigmaaa(npt),v2sigmaaa2(npt)
      parameter(tol=1.0d-20)
      
      if(ideriv.eq.0) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      t1 = rho**(1.D0/3.D0)
      zk(i) = -0.7385587663820224D0*t1*rho
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      t1 = rho**(1.D0/3.D0)
      zk(i) = -0.7385587663820224D0*t1*rho
      vrhoa(i) = -0.9847450218426965D0*t1
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      t1 = rho**(1.D0/3.D0)
      zk(i) = -0.7385587663820224D0*t1*rho
      vrhoa(i) = -0.9847450218426965D0*t1
      t5 = t1**2
      v2rhoa2(i) = -0.6564966812284644D0/t5
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end

      subroutine rks_x_handh
     & (ideriv,npt,rhoa1,sigmaaa1,
     &  zk,vrhoa,vsigmaaa,
     &  v2rhoa2,v2rhoasigmaaa,v2sigmaaa2)
c
c     P.A.M. Dirac
c     Proceedings of the Cambridge Philosophical Society, 26 (1930) 376
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt)
      REAL sigmaaa1(npt)
      REAL zk(npt),vrhoa(npt),vsigmaaa(npt)
      REAL v2rhoa2(npt),v2rhoasigmaaa(npt),v2sigmaaa2(npt)
      parameter(tol=1.0d-20)

      if(ideriv.eq.0) then

      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      t1 = rho**(1.D0/3.D0)
      zk(i) = -0.7385587663820224D0*t1*rho*0.50d0
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo

      else if(ideriv.eq.1) then
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      t1 = rho**(1.D0/3.D0)
      zk(i) = -0.7385587663820224D0*t1*rho*0.50d0
      vrhoa(i) = -0.9847450218426965D0*t1*0.50d0
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      endif ! rho
      enddo

      else if(ideriv.eq.2) then

      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      t1 = rho**(1.D0/3.D0)
      zk(i) = -0.7385587663820224D0*t1*rho*0.5d0
      vrhoa(i) = -0.9847450218426965D0*t1*0.5d0
      t5 = t1**2
      v2rhoa2(i) = 0.5d0*-0.6564966812284644D0/t5
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      endif ! rho
      enddo

      endif ! ideriv
      return
      end

      subroutine uks_x_handh
     & (ideriv,npt,rhoa1,rhob1,sigmaaa1,sigmabb1,sigmaab1,
     &  zk,vrhoa,vrhob,vsigmaaa,vsigmabb,vsigmaab,
     &  v2rhoa2,v2rhob2,v2rhoab,
     &  v2rhoasigmaaa,v2rhoasigmaab,v2rhoasigmabb,
     &  v2rhobsigmabb,v2rhobsigmaab,v2rhobsigmaaa,
     &  v2sigmaaa2,v2sigmaaaab,v2sigmaaabb,
     &  v2sigmaab2,v2sigmaabbb,v2sigmabb2)
c
c     P.A.M. Dirac
c     Proceedings of the Cambridge Philosophical Society, 26 (1930) 376
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt),rhob1(npt)
      REAL sigmaaa1(npt),sigmabb1(npt),sigmaab1(npt)
      REAL zk(npt),vrhoa(npt),vrhob(npt)
      REAL vsigmaaa(npt),vsigmabb(npt),vsigmaab(npt)
      REAL v2rhoa2(npt),v2rhob2(npt),v2rhoab(npt)
      REAL v2rhoasigmaaa(npt),v2rhoasigmaab(npt)
      REAL v2rhoasigmabb(npt),v2rhobsigmabb(npt)
      REAL v2rhobsigmaab(npt),v2rhobsigmaaa(npt)
      REAL v2sigmaaa2(npt),v2sigmaaaab(npt),v2sigmaaabb(npt)
      REAL v2sigmaab2(npt),v2sigmaabbb(npt),v2sigmabb2(npt)
      parameter(tol=1.0d-20)

      if (ideriv.eq.0) then

      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      t1 = rhob**(1.D0/3.D0)
      zk(i) = -0.9305257363491D0*t1*rhob*0.50d0
      elseif(rhob.lt.tol) then
      rho = rhoa
      t1 = rhoa**(1.D0/3.D0)
      zk(i) = -0.9305257363491D0*t1*rhoa*0.50d0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      t1 = rhoa**(1.D0/3.D0)
      t4 = rhob**(1.D0/3.D0)
      zk(i) = (-0.9305257363491D0*t1*rhoa-0.9305257363491D0*t4*rhobA)
     1 *0.50d0
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo

      else if(ideriv.eq.1) then

      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      t1 = rhob**(1.D0/3.D0)
      zk(i) = -0.9305257363491D0*t1*rhob*0.5d0
      vrhoa(i) = 0.D0
      vrhob(i) = -0.12407009817988D1*t1*0.5d0
      elseif(rhob.lt.tol) then
      rho = rhoa
      t1 = rhoa**(1.D0/3.D0)
      zk(i) = -0.9305257363491D0*t1*rhoa*0.5d0
      vrhoa(i) = -0.12407009817988D1*t1*0.5d0
      vrhob(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      t1 = rhoa**(1.D0/3.D0)
      t4 = rhob**(1.D0/3.D0)
      zk(i) = (-0.9305257363491D0*t1*rhoa-0.9305257363491D0*t4*rhob)
     1 *0.5d0
      vrhoa(i) = -0.12407009817988D1*t1*0.5d0
      vrhob(i) = -0.12407009817988D1*t4*0.5d0
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      endif ! rho
      enddo

      else if(ideriv.eq.2) then

      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      t1 = rhob**(1.D0/3.D0)
      zk(i) = -0.9305257363491D0*t1*rhob*0.5d0
      vrhoa(i) = 0.D0
      vrhob(i) = -0.12407009817988D1*t1*0.5d0
      v2rhoa2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t5 = t1**2
      v2rhob2(i) = 0.5d0*-0.4135669939329333D0/t5
      elseif(rhob.lt.tol) then
      rho = rhoa
      t1 = rhoa**(1.D0/3.D0)
      zk(i) = 0.5d0*-0.9305257363491D0*t1*rhoa
      vrhoa(i) = 0.5d0*-0.12407009817988D1*t1
      vrhob(i) = 0.D0
      t5 = t1**2
      v2rhoa2(i) = 0.5d0*-0.4135669939329333D0/t5
      v2rhob2(i) = 0.D0
      v2rhoab(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      t1 = rhoa**(1.D0/3.D0)
      t4 = rhob**(1.D0/3.D0)
      zk(i) = (-0.9305257363491D0*t1*rhoa-0.9305257363491D0*t4*rhob)
     1 *0.5d0
      vrhoa(i) = -0.12407009817988D1*t1*0.5d0
      vrhob(i) = -0.12407009817988D1*t4*0.5d0
      t9 = t1**2
      v2rhoa2(i) = 0.5d0*-0.4135669939329333D0/t9
      t12 = t4**2
      v2rhob2(i) = 0.5d0*-0.4135669939329333D0/t12
      v2rhoab(i) = 0.D0
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      v2rhob2(i) = 0.0d0
      v2rhoab(i) = 0.0d0
      endif ! rho
      enddo

      endif ! ideriv
      return
      end

c:X_LDAsubrend
_ENDIF
_IF(ccpdft,all,x_vwn)
c:X_VWNsubrstart

c    Generated: Wed Jan 29 09:08:52 GMT 2003

      subroutine uks_x_vwn
     & (ideriv,npt,rhoa1,rhob1,sigmaaa1,sigmabb1,sigmaab1,
     &  zk,vrhoa,vrhob,vsigmaaa,vsigmabb,vsigmaab,
     &  v2rhoa2,v2rhob2,v2rhoab,
     &  v2rhoasigmaaa,v2rhoasigmaab,v2rhoasigmabb,
     &  v2rhobsigmabb,v2rhobsigmaab,v2rhobsigmaaa,
     &  v2sigmaaa2,v2sigmaaaab,v2sigmaaabb,
     &  v2sigmaab2,v2sigmaabbb,v2sigmabb2)
c
c     S.H. Vosko, L. Wilk, and M. Nusair
c     Accurate spin-dependent electron liquid correlation energies for 
c     local spin density calculations: a critical analysis
c     Can. J. Phys. 58 (1980) 1200-1211
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt),rhob1(npt)
      REAL sigmaaa1(npt),sigmabb1(npt),sigmaab1(npt)
      REAL zk(npt),vrhoa(npt),vrhob(npt)
      REAL vsigmaaa(npt),vsigmabb(npt),vsigmaab(npt)
      REAL v2rhoa2(npt),v2rhob2(npt),v2rhoab(npt)
      REAL v2rhoasigmaaa(npt),v2rhoasigmaab(npt)
      REAL v2rhoasigmabb(npt),v2rhobsigmabb(npt)
      REAL v2rhobsigmaab(npt),v2rhobsigmaaa(npt)
      REAL v2sigmaaa2(npt),v2sigmaaaab(npt),v2sigmaaabb(npt)
      REAL v2sigmaab2(npt),v2sigmaabbb(npt),v2sigmabb2(npt)
      parameter(tol=1.0d-20)
      
      if (ideriv.eq.0) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      t1 = 1/rho
      t2 = t1**(1.D0/3.D0)
      t3 = 1/t2
      t7 = (rhoa-1.D0*rhob)*t1
      t8 = 1.D0+t7
      t9 = t8**(1.D0/3.D0)
      t12 = 1.D0-1.D0*t7
      t13 = t12**(1.D0/3.D0)
      zk(i) = rho*(-0.1477117532764045D1*t3-0.7385587663820224D0*t3*
     #(t9*t8+t13*t12-2.D0))
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      t1 = 1/rho
      t2 = t1**(1.D0/3.D0)
      t3 = 1/t2
      t4 = 0.1477117532764045D1*t3
      t6 = rhoa-1.D0*rhob
      t7 = t6*t1
      t8 = 1.D0+t7
      t9 = t8**(1.D0/3.D0)
      t12 = 1.D0-1.D0*t7
      t13 = t12**(1.D0/3.D0)
      t15 = t9*t8+t13*t12-2.D0
      t17 = 0.7385587663820224D0*t3*t15
      zk(i) = rho*(-t4-t17)
      t19 = rho*t3
      t24 = 0.1333333333333333D1*t9*t1-0.1333333333333333D1*t13*t1
      t29 = rho**2
      t30 = 1/t29
      t31 = 1/t2/t1*t30
      t45 = rho*(-0.4923725109213483D0*t31-0.2461862554606741D0*t31
     #*t15-0.7385587663820224D0*t3*(-0.1333333333333333D1*t9*t6*t30
     #+0.1333333333333333D1*t13*t6*t30))
      vrhoa(i) = -0.7385587663820224D0*t19*t24-t4-t17+t45
      vrhob(i) = 0.7385587663820224D0*t19*t24-t4-t17+t45
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      zk(i) = 0.D0
      vrhoa(i) = 0.D0
      vrhob(i) = 0.D0
      v2rhoa2(i) = 0.D0
      v2rhoab(i) = 0.D0
      v2rhob2(i) = 0.D0
      elseif(rhob.lt.tol) then
      rho = rhoa
      zk(i) = 0.D0
      vrhoa(i) = 0.D0
      vrhob(i) = 0.D0
      v2rhoa2(i) = 0.D0
      v2rhob2(i) = 0.D0
      v2rhoab(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      t1 = 1/rho
      t2 = t1**(1.D0/3.D0)
      t3 = 1/t2
      t4 = 0.1477117532764045D1*t3
      t6 = rhoa-1.D0*rhob
      t7 = t6*t1
      t8 = 1.D0+t7
      t9 = t8**(1.D0/3.D0)
      t12 = 1.D0-1.D0*t7
      t13 = t12**(1.D0/3.D0)
      t15 = t9*t8+t13*t12-2.D0
      t17 = 0.7385587663820224D0*t3*t15
      zk(i) = rho*(-t4-t17)
      t19 = rho*t3
      t24 = 0.1333333333333333D1*t9*t1-0.1333333333333333D1*t13*t1
      t28 = 1/t2/t1
      t29 = rho**2
      t30 = 1/t29
      t31 = t28*t30
      t33 = t31*t15
      t35 = t9*t6
      t38 = t13*t6
      t41 = -0.1333333333333333D1*t35*t30+0.1333333333333333D1*t38*t30
      t42 = t3*t41
      t45 = rho*(-0.4923725109213483D0*t31-0.2461862554606741D0*t33
     #-0.7385587663820224D0*t42)
      vrhoa(i) = -0.7385587663820224D0*t19*t24-t4-t17+t45
      t46 = -t24
      vrhob(i) = -0.7385587663820224D0*t19*t46-t4-t17+t45
      t49 = t9**2
      t50 = 1/t49
      t53 = t13**2
      t54 = 1/t53
      t57 = 0.4444444444444444D0*t50*t30+0.4444444444444444D0*t54*t30
      t59 = 0.7385587663820224D0*t19*t57
      t60 = t3*t24
      t66 = 1/t29/rho
      t76 = -0.4444444444444444D0*t50*t6*t66-0.1333333333333333D1*t9
     #*t30-0.4444444444444444D0*t54*t6*t66+0.1333333333333333D1*t13*t30
      t80 = rho*(-0.2461862554606741D0*t31*t24-0.7385587663820224D0*t3
     #*t76)
      t81 = t1*t28
      t82 = t81*t24
      t84 = t19*t76
      t86 = 0.9847450218426965D0*t31
      t87 = 0.4923725109213483D0*t33
      t88 = 0.1477117532764045D1*t42
      t91 = t29**2
      t92 = 1/t91
      t93 = 1/t2/t30*t92
      t95 = t28*t66
      t104 = t6**2
      t119 = rho*(-0.6564966812284644D0*t93+0.9847450218426965D0*t95
     #+0.1923661050931536D1*(-0.1706373066374023D0*t93
     #+0.2559559599561035D0*t95)*t15-0.4923725109213483D0*t31*t41
     #-0.7385587663820224D0*t3*(0.4444444444444444D0*t50*t104*t92
     #+0.2666666666666667D1*t35*t66+0.4444444444444444D0*t54*t104*t92
     #-0.2666666666666667D1*t38*t66))
      v2rhoa2(i) = -t59-0.1477117532764045D1*t60+t80
     #-0.2461862554606741D0*t82-0.7385587663820224D0*t84-t86-t87-t88
     #+t119
      t120 = t3*t46
      t124 = -t76
      t128 = rho*(-0.2461862554606741D0*t31*t46-0.7385587663820224D0
     #*t3*t124)
      t129 = t81*t46
      t131 = t19*t124
      v2rhob2(i) = -t59-0.1477117532764045D1*t120+t128
     #-0.2461862554606741D0*t129-0.7385587663820224D0*t131-t86-t87-t88
     #+t119
      v2rhoab(i) = 0.7385587663820224D0*t19*t57-0.7385587663820224D0
     #*t120+0.5D0*t128-0.7385587663820224D0*t60-0.1230931277303371D0
     #*t82-0.3692793831910112D0*t84-t86-t87-t88+0.1D1*t119+0.5D0*t80
     #-0.1230931277303371D0*t129-0.3692793831910112D0*t131
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      v2rhob2(i) = 0.0d0
      v2rhoab(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end
      
      
      subroutine rks_x_vwn
     & (ideriv,npt,rhoa1,sigmaaa1,
     &  zk,vrhoa,vsigmaaa,
     &  v2rhoa2,v2rhoasigmaaa,v2sigmaaa2)
c
c     S.H. Vosko, L. Wilk, and M. Nusair
c     Accurate spin-dependent electron liquid correlation energies for 
c     local spin density calculations: a critical analysis
c     Can. J. Phys. 58 (1980) 1200-1211
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt)
      REAL sigmaaa1(npt)
      REAL zk(npt),vrhoa(npt),vsigmaaa(npt)
      REAL v2rhoa2(npt),v2rhoasigmaaa(npt),v2sigmaaa2(npt)
      parameter(tol=1.0d-20)
      
      if(ideriv.eq.0) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      t2 = (1/rho)**(1.D0/3.D0)
      zk(i) = -0.1477117532764045D1*rho/t2
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      t1 = 1/rho
      t2 = t1**(1.D0/3.D0)
      t3 = 1/t2
      zk(i) = -0.1477117532764045D1*rho*t3
      vrhoa(i) = -0.1477117532764045D1*t3-0.4923725109213483D0/t2
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      t1 = 1/rho
      t2 = t1**(1.D0/3.D0)
      t3 = 1/t2
      zk(i) = -0.1477117532764045D1*rho*t3
      t8 = 1/t2/t1
      vrhoa(i) = -0.1477117532764045D1*t3-0.4923725109213483D0*t1*t8
      t11 = rho**2
      t12 = 1/t11
      t17 = t11**2
      v2rhoa2(i) = -0.1969490043685393D1*t8*t12+2.D0*rho*(
     #-0.6564966812284644D0/t2/t12/t17+0.9847450218426965D0*t8/t11/rho)
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end

c:X_VWNsubrend
_ENDIF
_IF(ccpdft,all,x_pbe)
c:X_PBEsubrstart

c    Generated: Wed Sep  3 12:48:32 GMT 2003

      subroutine uks_x_pbe
     & (ideriv,npt,rhoa1,rhob1,sigmaaa1,sigmabb1,sigmaab1,
     &  zk,vrhoa,vrhob,vsigmaaa,vsigmabb,vsigmaab,
     &  v2rhoa2,v2rhob2,v2rhoab,
     &  v2rhoasigmaaa,v2rhoasigmaab,v2rhoasigmabb,
     &  v2rhobsigmabb,v2rhobsigmaab,v2rhobsigmaaa,
     &  v2sigmaaa2,v2sigmaaaab,v2sigmaaabb,
     &  v2sigmaab2,v2sigmaabbb,v2sigmabb2)
c
c     J.P. Perdew, K. Burke, and M. Ernzerhof
c     Generalized gradient approximation made simple
c     Phys. Rev. Lett. 77 (1996) 3865-3868
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt),rhob1(npt)
      REAL sigmaaa1(npt),sigmabb1(npt),sigmaab1(npt)
      REAL zk(npt),vrhoa(npt),vrhob(npt)
      REAL vsigmaaa(npt),vsigmabb(npt),vsigmaab(npt)
      REAL v2rhoa2(npt),v2rhob2(npt),v2rhoab(npt)
      REAL v2rhoasigmaaa(npt),v2rhoasigmaab(npt)
      REAL v2rhoasigmabb(npt),v2rhobsigmabb(npt)
      REAL v2rhobsigmaab(npt),v2rhobsigmaaa(npt)
      REAL v2sigmaaa2(npt),v2sigmaaaab(npt),v2sigmaaabb(npt)
      REAL v2sigmaab2(npt),v2sigmaabbb(npt),v2sigmabb2(npt)
      parameter(tol=1.0d-20)
      
      if (ideriv.eq.0) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t4 = rhob**2
      t5 = t2**2
      zk(i) = -0.9305257363491D0*t2*rhob*(0.1804D1-0.804D0/(1.D0
     #+0.449276922095889D-2*sigmabb/t5/t4))
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t4 = rhoa**2
      t5 = t2**2
      zk(i) = -0.9305257363491D0*t2*rhoa*(0.1804D1-0.804D0/(1.D0
     #+0.449276922095889D-2*sigmaaa/t5/t4))
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t6 = rhoa**2
      t7 = t4**2
      t18 = rhob**(1.D0/3.D0)
      t20 = rhob**2
      t21 = t18**2
      zk(i) = -0.9305257363491D0*t4*rhoa*(0.1804D1-0.804D0/(1.D0
     #+0.449276922095889D-2*sigmaaa/t7/t6))-0.9305257363491D0*t18*rhob
     #*(0.1804D1-0.804D0/(1.D0+0.449276922095889D-2*sigmabb/t21/t20))
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t3 = t2*rhob
      t4 = rhob**2
      t5 = t2**2
      t10 = 1.D0+0.449276922095889D-2*sigmabb/t5/t4
      t13 = 0.1804D1-0.804D0/t10
      zk(i) = -0.9305257363491D0*t3*t13
      vrhoa(i) = 0.D0
      t20 = t10**2
      t21 = 1/t20
      vrhob(i) = -0.12407009817988D1*t2*t13+0.8963286558970112D-2/t2
     #/t4*t21*sigmabb
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      vsigmabb(i) = -0.3361232459613792D-2/t3*t21
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t3 = t2*rhoa
      t4 = rhoa**2
      t5 = t2**2
      t10 = 1.D0+0.449276922095889D-2*sigmaaa/t5/t4
      t13 = 0.1804D1-0.804D0/t10
      zk(i) = -0.9305257363491D0*t3*t13
      t20 = t10**2
      t21 = 1/t20
      vrhoa(i) = -0.12407009817988D1*t2*t13+0.8963286558970112D-2/t2
     #/t4*t21*sigmaaa
      vrhob(i) = 0.D0
      vsigmaaa(i) = -0.3361232459613792D-2/t3*t21
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t5 = t4*rhoa
      t6 = rhoa**2
      t7 = t4**2
      t12 = 1.D0+0.449276922095889D-2*sigmaaa/t7/t6
      t15 = 0.1804D1-0.804D0/t12
      t18 = rhob**(1.D0/3.D0)
      t19 = t18*rhob
      t20 = rhob**2
      t21 = t18**2
      t26 = 1.D0+0.449276922095889D-2*sigmabb/t21/t20
      t29 = 0.1804D1-0.804D0/t26
      zk(i) = -0.9305257363491D0*t5*t15-0.9305257363491D0*t19*t29
      t36 = t12**2
      t37 = 1/t36
      vrhoa(i) = -0.12407009817988D1*t4*t15+0.8963286558970112D-2/t4
     #/t6*t37*sigmaaa
      t45 = t26**2
      t46 = 1/t45
      vrhob(i) = -0.12407009817988D1*t18*t29+0.8963286558970112D-2/t18
     #/t20*t46*sigmabb
      vsigmaaa(i) = -0.3361232459613792D-2/t5*t37
      vsigmaab(i) = 0.D0
      vsigmabb(i) = -0.3361232459613792D-2/t19*t46
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t3 = t2*rhob
      t4 = rhob**2
      t5 = t2**2
      t10 = 1.D0+0.449276922095889D-2*sigmabb/t5/t4
      t13 = 0.1804D1-0.804D0/t10
      zk(i) = -0.9305257363491D0*t3*t13
      vrhoa(i) = 0.D0
      t20 = t10**2
      t21 = 1/t20
      vrhob(i) = -0.12407009817988D1*t2*t13+0.8963286558970112D-2/t2
     #/t4*t21*sigmabb
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      vsigmabb(i) = -0.3361232459613792D-2/t3*t21
      v2rhoa2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t37 = t4**2
      t41 = 1/t20/t10
      t43 = sigmabb**2
      v2rhob2(i) = -0.4135669939329333D0/t5*t13-0.8963286558970112D-2
     #/t2/t4/rhob*t21*sigmabb+0.2147732158441357D-3/t37/t4*t41*t43
      v2sigmaaa2(i) = 0.D0
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      v2sigmabb2(i) = 0.3020248347808158D-4/t37*t41
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t3 = t2*rhoa
      t4 = rhoa**2
      t5 = t2**2
      t10 = 1.D0+0.449276922095889D-2*sigmaaa/t5/t4
      t13 = 0.1804D1-0.804D0/t10
      zk(i) = -0.9305257363491D0*t3*t13
      t20 = t10**2
      t21 = 1/t20
      vrhoa(i) = -0.12407009817988D1*t2*t13+0.8963286558970112D-2/t2
     #/t4*t21*sigmaaa
      vrhob(i) = 0.D0
      vsigmaaa(i) = -0.3361232459613792D-2/t3*t21
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      t37 = t4**2
      t41 = 1/t20/t10
      t43 = sigmaaa**2
      v2rhoa2(i) = -0.4135669939329333D0/t5*t13-0.8963286558970112D-2
     #/t2/t4/rhoa*t21*sigmaaa+0.2147732158441357D-3/t37/t4*t41*t43
      v2rhob2(i) = 0.D0
      v2rhoab(i) = 0.D0
      v2sigmaaa2(i) = 0.3020248347808158D-4/t37*t41
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      v2sigmabb2(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t5 = t4*rhoa
      t6 = rhoa**2
      t7 = t4**2
      t12 = 1.D0+0.449276922095889D-2*sigmaaa/t7/t6
      t15 = 0.1804D1-0.804D0/t12
      t18 = rhob**(1.D0/3.D0)
      t19 = t18*rhob
      t20 = rhob**2
      t21 = t18**2
      t26 = 1.D0+0.449276922095889D-2*sigmabb/t21/t20
      t29 = 0.1804D1-0.804D0/t26
      zk(i) = -0.9305257363491D0*t5*t15-0.9305257363491D0*t19*t29
      t36 = t12**2
      t37 = 1/t36
      t38 = 1/t4/t6*t37
      vrhoa(i) = -0.12407009817988D1*t4*t15+0.8963286558970112D-2*t38
     #*sigmaaa
      t45 = t26**2
      t46 = 1/t45
      t47 = 1/t18/t20*t46
      vrhob(i) = -0.12407009817988D1*t18*t29+0.8963286558970112D-2*t47
     #*sigmabb
      vsigmaaa(i) = -0.3361232459613792D-2/t5*t37
      vsigmaab(i) = 0.D0
      vsigmabb(i) = -0.3361232459613792D-2/t19*t46
      t65 = t6**2
      t69 = 1/t36/t12
      t71 = sigmaaa**2
      v2rhoa2(i) = -0.4135669939329333D0/t7*t15-0.8963286558970112D-2
     #/t4/t6/rhoa*t37*sigmaaa+0.2147732158441357D-3/t65/t6*t69*t71
      t83 = t20**2
      t87 = 1/t45/t26
      t89 = sigmabb**2
      v2rhob2(i) = -0.4135669939329333D0/t21*t29-0.8963286558970112D-2
     #/t18/t20/rhob*t46*sigmabb+0.2147732158441357D-3/t83/t20*t87*t89
      v2rhoab(i) = 0.D0
      v2rhoasigmaaa(i) = 0.4481643279485056D-2*t38
     #-0.8053995594155087D-4/t65/rhoa*t69*sigmaaa
      v2rhoasigmaab(i) = 0.D0
      v2rhoasigmabb(i) = 0.D0
      v2rhobsigmaaa(i) = 0.D0
      v2rhobsigmaab(i) = 0.D0
      v2rhobsigmabb(i) = 0.4481643279485056D-2*t47
     #-0.8053995594155087D-4/t83/rhob*t87*sigmabb
      v2sigmaaa2(i) = 0.3020248347808158D-4/t65*t69
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      v2sigmabb2(i) = 0.3020248347808158D-4/t83*t87
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      v2rhob2(i) = 0.0d0
      v2rhoab(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2rhoasigmaab(i) = 0.0d0
      v2rhoasigmabb(i) = 0.0d0
      v2rhobsigmaaa(i) = 0.0d0
      v2rhobsigmaab(i) = 0.0d0
      v2rhobsigmabb(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      v2sigmaab2(i) = 0.0d0
      v2sigmabb2(i) = 0.0d0
      v2sigmaaaab(i) = 0.0d0
      v2sigmaaabb(i) = 0.0d0
      v2sigmaabbb(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end
      
      
      subroutine rks_x_pbe
     & (ideriv,npt,rhoa1,sigmaaa1,
     &  zk,vrhoa,vsigmaaa,
     &  v2rhoa2,v2rhoasigmaaa,v2sigmaaa2)
c
c     J.P. Perdew, K. Burke, and M. Ernzerhof
c     Generalized gradient approximation made simple
c     Phys. Rev. Lett. 77 (1996) 3865-3868
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt)
      REAL sigmaaa1(npt)
      REAL zk(npt),vrhoa(npt),vsigmaaa(npt)
      REAL v2rhoa2(npt),v2rhoasigmaaa(npt),v2sigmaaa2(npt)
      parameter(tol=1.0d-20)
      
      if(ideriv.eq.0) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t4 = rho**2
      t5 = t2**2
      zk(i) = -0.7385587663820224D0*t2*rho*(0.1804D1-0.804D0/(1.D0
     #+0.7131826587600489D-2*sigma/t5/t4))
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t3 = t2*rho
      t4 = rho**2
      t5 = t2**2
      t10 = 1.D0+0.7131826587600489D-2*sigma/t5/t4
      t13 = 0.1804D1-0.804D0/t10
      zk(i) = -0.7385587663820224D0*t3*t13
      t20 = t10**2
      t21 = 1/t20
      vrhoa(i) = -0.9847450218426965D0*t2*t13+0.1129303341188623D-1/t2
     #/t4*t21*sigma
      vsigmaaa(i) = -0.1693955011782934D-1/t3*t21
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t3 = t2*rho
      t4 = rho**2
      t5 = t2**2
      t10 = 1.D0+0.7131826587600489D-2*sigma/t5/t4
      t13 = 0.1804D1-0.804D0/t10
      zk(i) = -0.7385587663820224D0*t3*t13
      t20 = t10**2
      t21 = 1/t20
      t22 = 1/t2/t4*t21
      vrhoa(i) = -0.9847450218426965D0*t2*t13+0.1129303341188623D-1
     #*t22*sigma
      vsigmaaa(i) = -0.1693955011782934D-1/t3*t21
      t37 = t4**2
      t41 = 1/t20/t10
      t43 = sigma**2
      v2rhoa2(i) = -0.6564966812284644D0/t5*t13-0.2258606682377246D-1
     #/t2/t4/rho*t21*sigma+0.8590928633765426D-3/t37/t4*t41*t43
      v2rhoasigmaaa(i) = 0.2258606682377246D-1*t22
     #-0.644319647532407D-3/t37/rho*t41*sigma
      v2sigmaaa2(i) = 0.9664794712986105D-3/t37*t41
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end

      subroutine uks_x_pbe0
     & (ideriv,npt,rhoa1,rhob1,sigmaaa1,sigmabb1,sigmaab1,
     &  zk,vrhoa,vrhob,vsigmaaa,vsigmabb,vsigmaab,
     &  v2rhoa2,v2rhob2,v2rhoab,
     &  v2rhoasigmaaa,v2rhoasigmaab,v2rhoasigmabb,
     &  v2rhobsigmabb,v2rhobsigmaab,v2rhobsigmaaa,
     &  v2sigmaaa2,v2sigmaaaab,v2sigmaaabb,
     &  v2sigmaab2,v2sigmaabbb,v2sigmabb2)
c
c     J.P. Perdew, K. Burke, and M. Ernzerhof
c     Generalized gradient approximation made simple
c     Phys. Rev. Lett. 77 (1996) 3865-3868
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt),rhob1(npt)
      REAL sigmaaa1(npt),sigmabb1(npt),sigmaab1(npt)
      REAL zk(npt),vrhoa(npt),vrhob(npt)
      REAL vsigmaaa(npt),vsigmabb(npt),vsigmaab(npt)
      REAL v2rhoa2(npt),v2rhob2(npt),v2rhoab(npt)
      REAL v2rhoasigmaaa(npt),v2rhoasigmaab(npt)
      REAL v2rhoasigmabb(npt),v2rhobsigmabb(npt)
      REAL v2rhobsigmaab(npt),v2rhobsigmaaa(npt)
      REAL v2sigmaaa2(npt),v2sigmaaaab(npt),v2sigmaaabb(npt)
      REAL v2sigmaab2(npt),v2sigmaabbb(npt),v2sigmabb2(npt)
      parameter(tol=1.0d-20)
      
      if (ideriv.eq.0) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t4 = rhob**2
      t5 = t2**2
      zk(i) = -0.9305257363491D0*t2*rhob*(0.1804D1-0.804D0/(1.D0
     #+0.449276922095889D-2*sigmabb/t5/t4))
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t4 = rhoa**2
      t5 = t2**2
      zk(i) = -0.9305257363491D0*t2*rhoa*(0.1804D1-0.804D0/(1.D0
     #+0.449276922095889D-2*sigmaaa/t5/t4))
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t6 = rhoa**2
      t7 = t4**2
      t18 = rhob**(1.D0/3.D0)
      t20 = rhob**2
      t21 = t18**2
      zk(i) = -0.9305257363491D0*t4*rhoa*(0.1804D1-0.804D0/(1.D0
     #+0.449276922095889D-2*sigmaaa/t7/t6))-0.9305257363491D0*t18*rhob
     #*(0.1804D1-0.804D0/(1.D0+0.449276922095889D-2*sigmabb/t21/t20))
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      zk(i)=0.75d0*zk(i)
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t3 = t2*rhob
      t4 = rhob**2
      t5 = t2**2
      t10 = 1.D0+0.449276922095889D-2*sigmabb/t5/t4
      t13 = 0.1804D1-0.804D0/t10
      zk(i) = -0.9305257363491D0*t3*t13
      vrhoa(i) = 0.D0
      t20 = t10**2
      t21 = 1/t20
      vrhob(i) = -0.12407009817988D1*t2*t13+0.8963286558970112D-2/t2
     #/t4*t21*sigmabb
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      vsigmabb(i) = -0.3361232459613792D-2/t3*t21
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t3 = t2*rhoa
      t4 = rhoa**2
      t5 = t2**2
      t10 = 1.D0+0.449276922095889D-2*sigmaaa/t5/t4
      t13 = 0.1804D1-0.804D0/t10
      zk(i) = -0.9305257363491D0*t3*t13
      t20 = t10**2
      t21 = 1/t20
      vrhoa(i) = -0.12407009817988D1*t2*t13+0.8963286558970112D-2/t2
     #/t4*t21*sigmaaa
      vrhob(i) = 0.D0
      vsigmaaa(i) = -0.3361232459613792D-2/t3*t21
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t5 = t4*rhoa
      t6 = rhoa**2
      t7 = t4**2
      t12 = 1.D0+0.449276922095889D-2*sigmaaa/t7/t6
      t15 = 0.1804D1-0.804D0/t12
      t18 = rhob**(1.D0/3.D0)
      t19 = t18*rhob
      t20 = rhob**2
      t21 = t18**2
      t26 = 1.D0+0.449276922095889D-2*sigmabb/t21/t20
      t29 = 0.1804D1-0.804D0/t26
      zk(i) = -0.9305257363491D0*t5*t15-0.9305257363491D0*t19*t29
      t36 = t12**2
      t37 = 1/t36
      vrhoa(i) = -0.12407009817988D1*t4*t15+0.8963286558970112D-2/t4
     #/t6*t37*sigmaaa
      t45 = t26**2
      t46 = 1/t45
      vrhob(i) = -0.12407009817988D1*t18*t29+0.8963286558970112D-2/t18
     #/t20*t46*sigmabb
      vsigmaaa(i) = -0.3361232459613792D-2/t5*t37
      vsigmaab(i) = 0.D0
      vsigmabb(i) = -0.3361232459613792D-2/t19*t46
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      endif ! rho
      zk(i) = 0.75d0*zk(i)
      vrhoa(i) = 0.75d0*vrhoa(i)
      vrhob(i) = 0.75d0*vrhob(i)
      vsigmaaa(i) = 0.75d0*vsigmaaa(i)
      vsigmaab(i) = 0.75d0*vsigmaab(i)
      vsigmabb(i) =0.75d0*vsigmabb(i)
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t3 = t2*rhob
      t4 = rhob**2
      t5 = t2**2
      t10 = 1.D0+0.449276922095889D-2*sigmabb/t5/t4
      t13 = 0.1804D1-0.804D0/t10
      zk(i) = -0.9305257363491D0*t3*t13
      vrhoa(i) = 0.D0
      t20 = t10**2
      t21 = 1/t20
      vrhob(i) = -0.12407009817988D1*t2*t13+0.8963286558970112D-2/t2
     #/t4*t21*sigmabb
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      vsigmabb(i) = -0.3361232459613792D-2/t3*t21
      v2rhoa2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t37 = t4**2
      t41 = 1/t20/t10
      t43 = sigmabb**2
      v2rhob2(i) = -0.4135669939329333D0/t5*t13-0.8963286558970112D-2
     #/t2/t4/rhob*t21*sigmabb+0.2147732158441357D-3/t37/t4*t41*t43
      v2sigmaaa2(i) = 0.D0
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      v2sigmabb2(i) = 0.3020248347808158D-4/t37*t41
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t3 = t2*rhoa
      t4 = rhoa**2
      t5 = t2**2
      t10 = 1.D0+0.449276922095889D-2*sigmaaa/t5/t4
      t13 = 0.1804D1-0.804D0/t10
      zk(i) = -0.9305257363491D0*t3*t13
      t20 = t10**2
      t21 = 1/t20
      vrhoa(i) = -0.12407009817988D1*t2*t13+0.8963286558970112D-2/t2
     #/t4*t21*sigmaaa
      vrhob(i) = 0.D0
      vsigmaaa(i) = -0.3361232459613792D-2/t3*t21
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      t37 = t4**2
      t41 = 1/t20/t10
      t43 = sigmaaa**2
      v2rhoa2(i) = -0.4135669939329333D0/t5*t13-0.8963286558970112D-2
     #/t2/t4/rhoa*t21*sigmaaa+0.2147732158441357D-3/t37/t4*t41*t43
      v2rhob2(i) = 0.D0
      v2rhoab(i) = 0.D0
      v2sigmaaa2(i) = 0.3020248347808158D-4/t37*t41
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      v2sigmabb2(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t5 = t4*rhoa
      t6 = rhoa**2
      t7 = t4**2
      t12 = 1.D0+0.449276922095889D-2*sigmaaa/t7/t6
      t15 = 0.1804D1-0.804D0/t12
      t18 = rhob**(1.D0/3.D0)
      t19 = t18*rhob
      t20 = rhob**2
      t21 = t18**2
      t26 = 1.D0+0.449276922095889D-2*sigmabb/t21/t20
      t29 = 0.1804D1-0.804D0/t26
      zk(i) = -0.9305257363491D0*t5*t15-0.9305257363491D0*t19*t29
      t36 = t12**2
      t37 = 1/t36
      t38 = 1/t4/t6*t37
      vrhoa(i) = -0.12407009817988D1*t4*t15+0.8963286558970112D-2*t38
     #*sigmaaa
      t45 = t26**2
      t46 = 1/t45
      t47 = 1/t18/t20*t46
      vrhob(i) = -0.12407009817988D1*t18*t29+0.8963286558970112D-2*t47
     #*sigmabb
      vsigmaaa(i) = -0.3361232459613792D-2/t5*t37
      vsigmaab(i) = 0.D0
      vsigmabb(i) = -0.3361232459613792D-2/t19*t46
      t65 = t6**2
      t69 = 1/t36/t12
      t71 = sigmaaa**2
      v2rhoa2(i) = -0.4135669939329333D0/t7*t15-0.8963286558970112D-2
     #/t4/t6/rhoa*t37*sigmaaa+0.2147732158441357D-3/t65/t6*t69*t71
      t83 = t20**2
      t87 = 1/t45/t26
      t89 = sigmabb**2
      v2rhob2(i) = -0.4135669939329333D0/t21*t29-0.8963286558970112D-2
     #/t18/t20/rhob*t46*sigmabb+0.2147732158441357D-3/t83/t20*t87*t89
      v2rhoab(i) = 0.D0
      v2rhoasigmaaa(i) = 0.4481643279485056D-2*t38
     #-0.8053995594155087D-4/t65/rhoa*t69*sigmaaa
      v2rhoasigmaab(i) = 0.D0
      v2rhoasigmabb(i) = 0.D0
      v2rhobsigmaaa(i) = 0.D0
      v2rhobsigmaab(i) = 0.D0
      v2rhobsigmabb(i) = 0.4481643279485056D-2*t47
     #-0.8053995594155087D-4/t83/rhob*t87*sigmabb
      v2sigmaaa2(i) = 0.3020248347808158D-4/t65*t69
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      v2sigmabb2(i) = 0.3020248347808158D-4/t83*t87
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      v2rhob2(i) = 0.0d0
      v2rhoab(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2rhoasigmaab(i) = 0.0d0
      v2rhoasigmabb(i) = 0.0d0
      v2rhobsigmaaa(i) = 0.0d0
      v2rhobsigmaab(i) = 0.0d0
      v2rhobsigmabb(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      v2sigmaab2(i) = 0.0d0
      v2sigmabb2(i) = 0.0d0
      v2sigmaaaab(i) = 0.0d0
      v2sigmaaabb(i) = 0.0d0
      v2sigmaabbb(i) = 0.0d0
      endif ! rho
      zk(i) = 0.75d0*zk(i)
      vrhoa(i) =  0.75d0* vrhoa(i)
      vrhob(i) =  0.75d0* vrhob(i)
      v2rhoa2(i) = 0.75d0* v2rhoa2(i)
      v2rhob2(i) =  0.75d0*v2rhob2(i) 
      v2rhoab(i) =  0.75d0*v2rhoab(i)
      vsigmaaa(i) = 0.75d0*vsigmaaa(i)
      vsigmaab(i) = 0.75d0*vsigmaab(i)
      vsigmabb(i) = 0.75d0*vsigmabb(i)
      v2rhoasigmaaa(i) = 0.75d0*v2rhoasigmaaa(i)
      v2rhoasigmaab(i) = 0.75d0*v2rhoasigmaab(i)
      v2rhoasigmabb(i) = 0.75d0*v2rhoasigmabb(i)
      v2rhobsigmaaa(i) = 0.75d0*v2rhobsigmaaa(i)
      v2rhobsigmaab(i) = 0.75d0*v2rhobsigmaab(i)
      v2rhobsigmabb(i) = 0.75d0*v2rhobsigmabb(i)
      v2sigmaaa2(i) = 0.75d0*v2sigmaaa2(i)
      v2sigmaab2(i) = 0.75d0*v2sigmaab2(i)
      v2sigmabb2(i) = 0.75d0*v2sigmabb2(i)
      v2sigmaaaab(i) = 0.75d0*v2sigmaaaab(i)
      v2sigmaaabb(i) =  0.75d0*v2sigmaaabb(i)
      v2sigmaabbb(i) = 0.75d0*v2sigmaabbb(i)
      enddo
      
      endif ! ideriv
      return
      end
      
      
      subroutine rks_x_pbe0
     & (ideriv,npt,rhoa1,sigmaaa1,
     &  zk,vrhoa,vsigmaaa,
     &  v2rhoa2,v2rhoasigmaaa,v2sigmaaa2)
c
c     J.P. Perdew, K. Burke, and M. Ernzerhof
c     Generalized gradient approximation made simple
c     Phys. Rev. Lett. 77 (1996) 3865-3868
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt)
      REAL sigmaaa1(npt)
      REAL zk(npt),vrhoa(npt),vsigmaaa(npt)
      REAL v2rhoa2(npt),v2rhoasigmaaa(npt),v2sigmaaa2(npt)
      parameter(tol=1.0d-20)
      
      if(ideriv.eq.0) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t4 = rho**2
      t5 = t2**2
      zk(i) = -0.7385587663820224D0*t2*rho*(0.1804D1-0.804D0/(1.D0
     #+0.7131826587600489D-2*sigma/t5/t4))
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      zk(i)=0.75d0*zk(i)
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t3 = t2*rho
      t4 = rho**2
      t5 = t2**2
      t10 = 1.D0+0.7131826587600489D-2*sigma/t5/t4
      t13 = 0.1804D1-0.804D0/t10
      zk(i) = -0.7385587663820224D0*t3*t13
      t20 = t10**2
      t21 = 1/t20
      vrhoa(i) = -0.9847450218426965D0*t2*t13+0.1129303341188623D-1/t2
     #/t4*t21*sigma
      vsigmaaa(i) = -0.1693955011782934D-1/t3*t21
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      endif ! rho
      zk(i) = 0.75d0*zk(i)
      vrhoa(i) = 0.75d0*vrhoa(i)
      vsigmaaa(i) = 0.75d0*vsigmaaa(i)
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t3 = t2*rho
      t4 = rho**2
      t5 = t2**2
      t10 = 1.D0+0.7131826587600489D-2*sigma/t5/t4
      t13 = 0.1804D1-0.804D0/t10
      zk(i) = -0.7385587663820224D0*t3*t13
      t20 = t10**2
      t21 = 1/t20
      t22 = 1/t2/t4*t21
      vrhoa(i) = -0.9847450218426965D0*t2*t13+0.1129303341188623D-1
     #*t22*sigma
      vsigmaaa(i) = -0.1693955011782934D-1/t3*t21
      t37 = t4**2
      t41 = 1/t20/t10
      t43 = sigma**2
      v2rhoa2(i) = -0.6564966812284644D0/t5*t13-0.2258606682377246D-1
     #/t2/t4/rho*t21*sigma+0.8590928633765426D-3/t37/t4*t41*t43
      v2rhoasigmaaa(i) = 0.2258606682377246D-1*t22
     #-0.644319647532407D-3/t37/rho*t41*sigma
      v2sigmaaa2(i) = 0.9664794712986105D-3/t37*t41
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      endif ! rho
      zk(i) =  0.75d0*zk(i)
      vrhoa(i) =  0.75d0*vrhoa(i)
      v2rhoa2(i) =  0.75d0*v2rhoa2(i)
      vsigmaaa(i) =  0.75d0*vsigmaaa(i)
      v2rhoasigmaaa(i) = 0.75d0*v2rhoasigmaaa(i)
      v2sigmaaa2(i) = 0.75d0*v2sigmaaa2(i)
      enddo
      
      endif ! ideriv
      return
      end

c:X_PBEsubrend
_ENDIF
_IF(ccpdft,all,x_pw91)
c:X_PW91subrstart

c    Generated: Sun Oct 24 15:07:52 BST 2004

      subroutine uks_x_pw91
     & (ideriv,npt,rhoa1,rhob1,sigmaaa1,sigmabb1,sigmaab1,
     &  zk,vrhoa,vrhob,vsigmaaa,vsigmabb,vsigmaab,
     &  v2rhoa2,v2rhob2,v2rhoab,
     &  v2rhoasigmaaa,v2rhoasigmaab,v2rhoasigmabb,
     &  v2rhobsigmabb,v2rhobsigmaab,v2rhobsigmaaa,
     &  v2sigmaaa2,v2sigmaaaab,v2sigmaaabb,
     &  v2sigmaab2,v2sigmaabbb,v2sigmabb2)
c
c     J.P. Perdew, J.A. Chevary, S.H. Vosko, K.A. Jackson,
c     M.R. Pederson, D.J. Singh, C. Fiolhais
c     Atoms, molecules, solids and surfaces:
c     Applications of the generalized gradient approximation
c     for exchange and correlation
c     Phys. Rev. B 46 (1992) 6671--6687
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt),rhob1(npt)
      REAL sigmaaa1(npt),sigmabb1(npt),sigmaab1(npt)
      REAL zk(npt),vrhoa(npt),vrhob(npt)
      REAL vsigmaaa(npt),vsigmabb(npt),vsigmaab(npt)
      REAL v2rhoa2(npt),v2rhob2(npt),v2rhoab(npt)
      REAL v2rhoasigmaaa(npt),v2rhoasigmaab(npt)
      REAL v2rhoasigmabb(npt),v2rhobsigmabb(npt)
      REAL v2rhobsigmaab(npt),v2rhobsigmaaa(npt)
      REAL v2sigmaaa2(npt),v2sigmaaaab(npt),v2sigmaaabb(npt)
      REAL v2sigmaab2(npt),v2sigmaabbb(npt),v2sigmabb2(npt)
      parameter(tol=1.0d-20)
      
      if (ideriv.eq.0) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t3 = t2*rhob
      t4 = dsqrt(sigmabb)
      t6 = t4/t3
      t8 = dlog(0.1000005877780776D1*t6+dsqrt(1+0.10000117555961D1*t6*
     #*2))
      t10 = 0.2520026100493014D-1*t6*t8
      t11 = rhob**2
      t12 = t2**2
      t14 = 1/t12/t11
      t17 = dexp(-0.1645530784602056D1*sigmabb*t14)
      t25 = sigmabb**2
      t26 = t11**2
      zk(i) = -0.9305257363491D0*t3*(1.D0+t10+0.1645530784602056D-1*
     #(0.2743D0-0.1508D0*t17)*sigmabb*t14)/(1.D0+t10
     #+0.1083108625229223D-5*t25/t2/t26/rhob)
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t3 = t2*rhoa
      t4 = dsqrt(sigmaaa)
      t6 = t4/t3
      t8 = dlog(0.1000005877780776D1*t6+dsqrt(1+0.10000117555961D1*t6*
     #*2))
      t10 = 0.2520026100493014D-1*t6*t8
      t11 = rhoa**2
      t12 = t2**2
      t14 = 1/t12/t11
      t17 = dexp(-0.1645530784602056D1*sigmaaa*t14)
      t25 = sigmaaa**2
      t26 = t11**2
      zk(i) = -0.9305257363491D0*t3*(1.D0+t10+0.1645530784602056D-1*
     #(0.2743D0-0.1508D0*t17)*sigmaaa*t14)/(1.D0+t10
     #+0.1083108625229223D-5*t25/t2/t26/rhoa)
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t5 = t4*rhoa
      t6 = dsqrt(sigmaaa)
      t8 = t6/t5
      t10 = dlog(0.1000005877780776D1*t8+dsqrt(1+0.10000117555961D1*t8
     #**2))
      t12 = 0.2520026100493014D-1*t8*t10
      t13 = rhoa**2
      t14 = t4**2
      t16 = 1/t14/t13
      t19 = dexp(-0.1645530784602056D1*sigmaaa*t16)
      t27 = sigmaaa**2
      t28 = t13**2
      t38 = rhob**(1.D0/3.D0)
      t39 = t38*rhob
      t40 = dsqrt(sigmabb)
      t42 = t40/t39
      t44 = dlog(0.1000005877780776D1*t42+dsqrt(1+0.10000117555961D1
     #*t42**2))
      t46 = 0.2520026100493014D-1*t42*t44
      t47 = rhob**2
      t48 = t38**2
      t50 = 1/t48/t47
      t53 = dexp(-0.1645530784602056D1*sigmabb*t50)
      t61 = sigmabb**2
      t62 = t47**2
      zk(i) = -0.9305257363491D0*t5*(1.D0+t12+0.1645530784602056D-1*
     #(0.2743D0-0.1508D0*t19)*sigmaaa*t16)/(1.D0+t12
     #+0.1083108625229223D-5*t27/t4/t28/rhoa)-0.9305257363491D0*t39*
     #(1.D0+t46+0.1645530784602056D-1*(0.2743D0-0.1508D0*t53)*sigmabb
     #*t50)/(1.D0+t46+0.1083108625229223D-5*t61/t38/t62/rhob)
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t3 = t2*rhob
      t4 = dsqrt(sigmabb)
      t5 = 1/t3
      t6 = t4*t5
      t8 = dlog(0.1000005877780776D1*t6+dsqrt(1+0.10000117555961D1*t6*
     #*2))
      t10 = 0.2520026100493014D-1*t6*t8
      t11 = rhob**2
      t12 = t2**2
      t14 = 1/t12/t11
      t15 = sigmabb*t14
      t17 = dexp(-0.1645530784602056D1*t15)
      t19 = 0.2743D0-0.1508D0*t17
      t20 = t19*sigmabb
      t23 = 1.D0+t10+0.1645530784602056D-1*t20*t14
      t24 = t3*t23
      t25 = sigmabb**2
      t26 = t11**2
      t29 = 1/t2/t26/rhob
      t32 = 1.D0+t10+0.1083108625229223D-5*t25*t29
      t33 = 1/t32
      zk(i) = -0.9305257363491D0*t24*t33
      vrhoa(i) = 0.D0
      t43 = 0.3360034800657352D-1*t4/t2/t11*t8
      t46 = 1/t12/t11/rhob
      t50 = dsqrt(1.D0+0.10000117555961D1*t15)
      t51 = 1/t50
      t53 = 0.3360054550205309D-1*sigmabb*t46*t51
      t57 = t25/t2/t26/t11
      t66 = t32**2
      t67 = 1/t66
      vrhob(i) = -0.12407009817988D1*t2*t23*t33-0.9305257363491D0*t3*(
     #-t43-t53-0.1088885204563779D-1*t57*t17-0.4388082092272149D-1*t20
     #*t46)*t33+0.9305257363491D0*t24*t67*(-t43-t53
     #-0.5776579334555855D-5*t57)
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      t76 = 0.1260013050246507D-1/t4*t5*t8
      t78 = 0.1260020456326991D-1*t14*t51
      vsigmabb(i) = -0.9305257363491D0*t3*(t76+t78
     #+0.408331951711417D-2*t29*t17*sigmabb+0.1645530784602056D-1*t19
     #*t14)*t33+0.9305257363491D0*t24*t67*(t76+t78
     #+0.2166217250458446D-5*sigmabb*t29)
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t3 = t2*rhoa
      t4 = dsqrt(sigmaaa)
      t5 = 1/t3
      t6 = t4*t5
      t8 = dlog(0.1000005877780776D1*t6+dsqrt(1+0.10000117555961D1*t6*
     #*2))
      t10 = 0.2520026100493014D-1*t6*t8
      t11 = rhoa**2
      t12 = t2**2
      t14 = 1/t12/t11
      t15 = sigmaaa*t14
      t17 = dexp(-0.1645530784602056D1*t15)
      t19 = 0.2743D0-0.1508D0*t17
      t20 = t19*sigmaaa
      t23 = 1.D0+t10+0.1645530784602056D-1*t20*t14
      t24 = t3*t23
      t25 = sigmaaa**2
      t26 = t11**2
      t29 = 1/t2/t26/rhoa
      t32 = 1.D0+t10+0.1083108625229223D-5*t25*t29
      t33 = 1/t32
      zk(i) = -0.9305257363491D0*t24*t33
      t43 = 0.3360034800657352D-1*t4/t2/t11*t8
      t46 = 1/t12/t11/rhoa
      t50 = dsqrt(1.D0+0.10000117555961D1*t15)
      t51 = 1/t50
      t53 = 0.3360054550205309D-1*sigmaaa*t46*t51
      t57 = t25/t2/t26/t11
      t66 = t32**2
      t67 = 1/t66
      vrhoa(i) = -0.12407009817988D1*t2*t23*t33-0.9305257363491D0*t3*(
     #-t43-t53-0.1088885204563779D-1*t57*t17-0.4388082092272149D-1*t20
     #*t46)*t33+0.9305257363491D0*t24*t67*(-t43-t53
     #-0.5776579334555855D-5*t57)
      vrhob(i) = 0.D0
      t76 = 0.1260013050246507D-1/t4*t5*t8
      t78 = 0.1260020456326991D-1*t14*t51
      vsigmaaa(i) = -0.9305257363491D0*t3*(t76+t78
     #+0.408331951711417D-2*t29*t17*sigmaaa+0.1645530784602056D-1*t19
     #*t14)*t33+0.9305257363491D0*t24*t67*(t76+t78
     #+0.2166217250458446D-5*sigmaaa*t29)
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t5 = t4*rhoa
      t6 = dsqrt(sigmaaa)
      t7 = 1/t5
      t8 = t6*t7
      t10 = dlog(0.1000005877780776D1*t8+dsqrt(1+0.10000117555961D1*t8
     #**2))
      t12 = 0.2520026100493014D-1*t8*t10
      t13 = rhoa**2
      t14 = t4**2
      t16 = 1/t14/t13
      t17 = sigmaaa*t16
      t19 = dexp(-0.1645530784602056D1*t17)
      t21 = 0.2743D0-0.1508D0*t19
      t22 = t21*sigmaaa
      t25 = 1.D0+t12+0.1645530784602056D-1*t22*t16
      t26 = t5*t25
      t27 = sigmaaa**2
      t28 = t13**2
      t31 = 1/t4/t28/rhoa
      t34 = 1.D0+t12+0.1083108625229223D-5*t27*t31
      t35 = 1/t34
      t38 = rhob**(1.D0/3.D0)
      t39 = t38*rhob
      t40 = dsqrt(sigmabb)
      t41 = 1/t39
      t42 = t40*t41
      t44 = dlog(0.1000005877780776D1*t42+dsqrt(1+0.10000117555961D1
     #*t42**2))
      t46 = 0.2520026100493014D-1*t42*t44
      t47 = rhob**2
      t48 = t38**2
      t50 = 1/t48/t47
      t51 = sigmabb*t50
      t53 = dexp(-0.1645530784602056D1*t51)
      t55 = 0.2743D0-0.1508D0*t53
      t56 = t55*sigmabb
      t59 = 1.D0+t46+0.1645530784602056D-1*t56*t50
      t60 = t39*t59
      t61 = sigmabb**2
      t62 = t47**2
      t65 = 1/t38/t62/rhob
      t68 = 1.D0+t46+0.1083108625229223D-5*t61*t65
      t69 = 1/t68
      zk(i) = -0.9305257363491D0*t26*t35-0.9305257363491D0*t60*t69
      t79 = 0.3360034800657352D-1*t6/t4/t13*t10
      t82 = 1/t14/t13/rhoa
      t86 = dsqrt(1.D0+0.10000117555961D1*t17)
      t87 = 1/t86
      t89 = 0.3360054550205309D-1*sigmaaa*t82*t87
      t93 = t27/t4/t28/t13
      t102 = t34**2
      t103 = 1/t102
      vrhoa(i) = -0.12407009817988D1*t4*t25*t35-0.9305257363491D0*t5*(
     #-t79-t89-0.1088885204563779D-1*t93*t19-0.4388082092272149D-1*t22
     #*t82)*t35+0.9305257363491D0*t26*t103*(-t79-t89
     #-0.5776579334555855D-5*t93)
      t116 = 0.3360034800657352D-1*t40/t38/t47*t44
      t119 = 1/t48/t47/rhob
      t123 = dsqrt(1.D0+0.10000117555961D1*t51)
      t124 = 1/t123
      t126 = 0.3360054550205309D-1*sigmabb*t119*t124
      t130 = t61/t38/t62/t47
      t139 = t68**2
      t140 = 1/t139
      vrhob(i) = -0.12407009817988D1*t38*t59*t69-0.9305257363491D0*t39
     #*(-t116-t126-0.1088885204563779D-1*t130*t53
     #-0.4388082092272149D-1*t56*t119)*t69+0.9305257363491D0*t60*t140*
     #(-t116-t126-0.5776579334555855D-5*t130)
      t149 = 0.1260013050246507D-1/t6*t7*t10
      t151 = 0.1260020456326991D-1*t16*t87
      vsigmaaa(i) = -0.9305257363491D0*t5*(t149+t151
     #+0.408331951711417D-2*t31*t19*sigmaaa+0.1645530784602056D-1*t21
     #*t16)*t35+0.9305257363491D0*t26*t103*(t149+t151
     #+0.2166217250458446D-5*sigmaaa*t31)
      vsigmaab(i) = 0.D0
      t170 = 0.1260013050246507D-1/t40*t41*t44
      t172 = 0.1260020456326991D-1*t50*t124
      vsigmabb(i) = -0.9305257363491D0*t39*(t170+t172
     #+0.408331951711417D-2*t65*t53*sigmabb+0.1645530784602056D-1*t55
     #*t50)*t69+0.9305257363491D0*t60*t140*(t170+t172
     #+0.2166217250458446D-5*sigmabb*t65)
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t3 = t2*rhob
      t4 = dsqrt(sigmabb)
      t5 = 1/t3
      t6 = t4*t5
      t8 = dlog(0.1000005877780776D1*t6+dsqrt(1+0.10000117555961D1*t6*
     #*2))
      t10 = 0.2520026100493014D-1*t6*t8
      t11 = rhob**2
      t12 = t2**2
      t14 = 1/t12/t11
      t15 = sigmabb*t14
      t17 = dexp(-0.1645530784602056D1*t15)
      t19 = 0.2743D0-0.1508D0*t17
      t20 = t19*sigmabb
      t23 = 1.D0+t10+0.1645530784602056D-1*t20*t14
      t24 = t3*t23
      t25 = sigmabb**2
      t26 = t11**2
      t29 = 1/t2/t26/rhob
      t32 = 1.D0+t10+0.1083108625229223D-5*t25*t29
      t33 = 1/t32
      zk(i) = -0.9305257363491D0*t24*t33
      vrhoa(i) = 0.D0
      t36 = t2*t23
      t43 = 0.3360034800657352D-1*t4/t2/t11*t8
      t44 = t11*rhob
      t46 = 1/t12/t44
      t49 = 1.D0+0.10000117555961D1*t15
      t50 = dsqrt(t49)
      t51 = 1/t50
      t53 = 0.3360054550205309D-1*sigmabb*t46*t51
      t57 = t25/t2/t26/t11
      t62 = -t43-t53-0.1088885204563779D-1*t57*t17
     #-0.4388082092272149D-1*t20*t46
      t63 = t3*t62
      t66 = t32**2
      t67 = 1/t66
      t69 = -t43-t53-0.5776579334555855D-5*t57
      t70 = t67*t69
      vrhob(i) = -0.12407009817988D1*t36*t33-0.9305257363491D0*t63*t33
     #+0.9305257363491D0*t24*t70
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      t76 = 0.1260013050246507D-1/t4*t5*t8
      t78 = 0.1260020456326991D-1*t14*t51
      t79 = t29*t17
      t85 = t3*(t76+t78+0.408331951711417D-2*t79*sigmabb
     #+0.1645530784602056D-1*t19*t14)
      t90 = t76+t78+0.2166217250458446D-5*sigmabb*t29
      t91 = t67*t90
      vsigmabb(i) = -0.9305257363491D0*t85*t33+0.9305257363491D0*t24*t91
      v2rhoa2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t107 = 0.7840081201533821D-1*t4/t2/t44*t8
      t109 = 1/t12/t26
      t112 = 0.1680027275102654D0*sigmabb*t109*t51
      t116 = t25/t2/t26/t44
      t118 = 1/t50/t49
      t120 = 0.4480125399532632D-1*t116*t118
      t124 = t26**2
      t139 = 1/t66/t32
      t140 = t69**2
      v2rhob2(i) = -0.4135669939329333D0/t12*t23*t33
     #-0.24814019635976D1*t2*t62*t33+0.24814019635976D1*t36*t70
     #-0.9305257363491D0*t3*(t107+t112-t120+0.9799966841074009D-1*t116
     #*t17-0.4778117666686413D-1*t25*sigmabb/t124/t11*t17
     #+0.1608963433833121D0*t20*t109)*t33+0.18610514726982D1*t63*t70
     #-0.18610514726982D1*t24*t139*t140+0.9305257363491D0*t24*t67*
     #(t107+t112-t120+0.3658500245218708D-4*t116)
      v2sigmaaa2(i) = 0.D0
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      t153 = 0.6300065251232535D-2/t4/sigmabb*t5*t8
      t157 = 0.6300102281634954D-2/sigmabb*t14*t51
      t159 = 0.6300176343092764D-2*t29*t118
      t171 = t90**2
      v2sigmabb2(i) = -0.9305257363491D0*t3*(-t153+t157-t159
     #-0.6719227968777768D-2/t124*t17*sigmabb+0.8166639034228341D-2
     #*t79)*t33+0.18610514726982D1*t85*t91-0.18610514726982D1*t24*t139
     #*t171+0.9305257363491D0*t24*t67*(-t153+t157-t159
     #+0.2166217250458446D-5*t29)
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t3 = t2*rhoa
      t4 = dsqrt(sigmaaa)
      t5 = 1/t3
      t6 = t4*t5
      t8 = dlog(0.1000005877780776D1*t6+dsqrt(1+0.10000117555961D1*t6*
     #*2))
      t10 = 0.2520026100493014D-1*t6*t8
      t11 = rhoa**2
      t12 = t2**2
      t14 = 1/t12/t11
      t15 = sigmaaa*t14
      t17 = dexp(-0.1645530784602056D1*t15)
      t19 = 0.2743D0-0.1508D0*t17
      t20 = t19*sigmaaa
      t23 = 1.D0+t10+0.1645530784602056D-1*t20*t14
      t24 = t3*t23
      t25 = sigmaaa**2
      t26 = t11**2
      t29 = 1/t2/t26/rhoa
      t32 = 1.D0+t10+0.1083108625229223D-5*t25*t29
      t33 = 1/t32
      zk(i) = -0.9305257363491D0*t24*t33
      t36 = t2*t23
      t43 = 0.3360034800657352D-1*t4/t2/t11*t8
      t44 = t11*rhoa
      t46 = 1/t12/t44
      t49 = 1.D0+0.10000117555961D1*t15
      t50 = dsqrt(t49)
      t51 = 1/t50
      t53 = 0.3360054550205309D-1*sigmaaa*t46*t51
      t57 = t25/t2/t26/t11
      t62 = -t43-t53-0.1088885204563779D-1*t57*t17
     #-0.4388082092272149D-1*t20*t46
      t63 = t3*t62
      t66 = t32**2
      t67 = 1/t66
      t69 = -t43-t53-0.5776579334555855D-5*t57
      t70 = t67*t69
      vrhoa(i) = -0.12407009817988D1*t36*t33-0.9305257363491D0*t63*t33
     #+0.9305257363491D0*t24*t70
      vrhob(i) = 0.D0
      t76 = 0.1260013050246507D-1/t4*t5*t8
      t78 = 0.1260020456326991D-1*t14*t51
      t79 = t29*t17
      t85 = t3*(t76+t78+0.408331951711417D-2*t79*sigmaaa
     #+0.1645530784602056D-1*t19*t14)
      t90 = t76+t78+0.2166217250458446D-5*sigmaaa*t29
      t91 = t67*t90
      vsigmaaa(i) = -0.9305257363491D0*t85*t33+0.9305257363491D0*t24*t91
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      t107 = 0.7840081201533821D-1*t4/t2/t44*t8
      t109 = 1/t12/t26
      t112 = 0.1680027275102654D0*sigmaaa*t109*t51
      t116 = t25/t2/t26/t44
      t118 = 1/t50/t49
      t120 = 0.4480125399532632D-1*t116*t118
      t124 = t26**2
      t139 = 1/t66/t32
      t140 = t69**2
      v2rhoa2(i) = -0.4135669939329333D0/t12*t23*t33
     #-0.24814019635976D1*t2*t62*t33+0.24814019635976D1*t36*t70
     #-0.9305257363491D0*t3*(t107+t112-t120+0.9799966841074009D-1*t116
     #*t17-0.4778117666686413D-1*t25*sigmaaa/t124/t11*t17
     #+0.1608963433833121D0*t20*t109)*t33+0.18610514726982D1*t63*t70
     #-0.18610514726982D1*t24*t139*t140+0.9305257363491D0*t24*t67*
     #(t107+t112-t120+0.3658500245218708D-4*t116)
      v2rhob2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t153 = 0.6300065251232535D-2/t4/sigmaaa*t5*t8
      t157 = 0.6300102281634954D-2/sigmaaa*t14*t51
      t159 = 0.6300176343092764D-2*t29*t118
      t171 = t90**2
      v2sigmaaa2(i) = -0.9305257363491D0*t3*(-t153+t157-t159
     #-0.6719227968777768D-2/t124*t17*sigmaaa+0.8166639034228341D-2
     #*t79)*t33+0.18610514726982D1*t85*t91-0.18610514726982D1*t24*t139
     #*t171+0.9305257363491D0*t24*t67*(-t153+t157-t159
     #+0.2166217250458446D-5*t29)
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      v2sigmabb2(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t5 = t4*rhoa
      t6 = dsqrt(sigmaaa)
      t7 = 1/t5
      t8 = t6*t7
      t10 = dlog(0.1000005877780776D1*t8+dsqrt(1+0.10000117555961D1*t8
     #**2))
      t12 = 0.2520026100493014D-1*t8*t10
      t13 = rhoa**2
      t14 = t4**2
      t16 = 1/t14/t13
      t17 = sigmaaa*t16
      t19 = dexp(-0.1645530784602056D1*t17)
      t21 = 0.2743D0-0.1508D0*t19
      t22 = t21*sigmaaa
      t25 = 1.D0+t12+0.1645530784602056D-1*t22*t16
      t26 = t5*t25
      t27 = sigmaaa**2
      t28 = t13**2
      t31 = 1/t4/t28/rhoa
      t34 = 1.D0+t12+0.1083108625229223D-5*t27*t31
      t35 = 1/t34
      t38 = rhob**(1.D0/3.D0)
      t39 = t38*rhob
      t40 = dsqrt(sigmabb)
      t41 = 1/t39
      t42 = t40*t41
      t44 = dlog(0.1000005877780776D1*t42+dsqrt(1+0.10000117555961D1
     #*t42**2))
      t46 = 0.2520026100493014D-1*t42*t44
      t47 = rhob**2
      t48 = t38**2
      t50 = 1/t48/t47
      t51 = sigmabb*t50
      t53 = dexp(-0.1645530784602056D1*t51)
      t55 = 0.2743D0-0.1508D0*t53
      t56 = t55*sigmabb
      t59 = 1.D0+t46+0.1645530784602056D-1*t56*t50
      t60 = t39*t59
      t61 = sigmabb**2
      t62 = t47**2
      t65 = 1/t38/t62/rhob
      t68 = 1.D0+t46+0.1083108625229223D-5*t61*t65
      t69 = 1/t68
      zk(i) = -0.9305257363491D0*t26*t35-0.9305257363491D0*t60*t69
      t72 = t4*t25
      t76 = 1/t4/t13
      t79 = 0.3360034800657352D-1*t6*t76*t10
      t80 = t13*rhoa
      t82 = 1/t14/t80
      t85 = 1.D0+0.10000117555961D1*t17
      t86 = dsqrt(t85)
      t87 = 1/t86
      t89 = 0.3360054550205309D-1*sigmaaa*t82*t87
      t92 = 1/t4/t28/t13
      t93 = t27*t92
      t98 = -t79-t89-0.1088885204563779D-1*t93*t19
     #-0.4388082092272149D-1*t22*t82
      t99 = t5*t98
      t102 = t34**2
      t103 = 1/t102
      t105 = -t79-t89-0.5776579334555855D-5*t93
      t106 = t103*t105
      vrhoa(i) = -0.12407009817988D1*t72*t35-0.9305257363491D0*t99*t35
     #+0.9305257363491D0*t26*t106
      t109 = t38*t59
      t113 = 1/t38/t47
      t116 = 0.3360034800657352D-1*t40*t113*t44
      t117 = t47*rhob
      t119 = 1/t48/t117
      t122 = 1.D0+0.10000117555961D1*t51
      t123 = dsqrt(t122)
      t124 = 1/t123
      t126 = 0.3360054550205309D-1*sigmabb*t119*t124
      t129 = 1/t38/t62/t47
      t130 = t61*t129
      t135 = -t116-t126-0.1088885204563779D-1*t130*t53
     #-0.4388082092272149D-1*t56*t119
      t136 = t39*t135
      t139 = t68**2
      t140 = 1/t139
      t142 = -t116-t126-0.5776579334555855D-5*t130
      t143 = t140*t142
      vrhob(i) = -0.12407009817988D1*t109*t69-0.9305257363491D0*t136
     #*t69+0.9305257363491D0*t60*t143
      t146 = 1/t6
      t149 = 0.1260013050246507D-1*t146*t7*t10
      t151 = 0.1260020456326991D-1*t16*t87
      t152 = t31*t19
      t157 = t149+t151+0.408331951711417D-2*t152*sigmaaa
     #+0.1645530784602056D-1*t21*t16
      t158 = t5*t157
      t163 = t149+t151+0.2166217250458446D-5*sigmaaa*t31
      t164 = t103*t163
      vsigmaaa(i) = -0.9305257363491D0*t158*t35+0.9305257363491D0*t26
     #*t164
      vsigmaab(i) = 0.D0
      t167 = 1/t40
      t170 = 0.1260013050246507D-1*t167*t41*t44
      t172 = 0.1260020456326991D-1*t50*t124
      t173 = t65*t53
      t178 = t170+t172+0.408331951711417D-2*t173*sigmabb
     #+0.1645530784602056D-1*t55*t50
      t179 = t39*t178
      t184 = t170+t172+0.2166217250458446D-5*sigmabb*t65
      t185 = t140*t184
      vsigmabb(i) = -0.9305257363491D0*t179*t69+0.9305257363491D0*t60
     #*t185
      t201 = 0.7840081201533821D-1*t6/t4/t80*t10
      t203 = 1/t14/t28
      t206 = 0.1680027275102654D0*sigmaaa*t203*t87
      t210 = t27/t4/t28/t80
      t212 = 1/t86/t85
      t214 = 0.4480125399532632D-1*t210*t212
      t218 = t28**2
      t233 = 1/t102/t34
      t234 = t105**2
      v2rhoa2(i) = -0.4135669939329333D0/t14*t25*t35
     #-0.24814019635976D1*t4*t98*t35+0.24814019635976D1*t72*t106
     #-0.9305257363491D0*t5*(t201+t206-t214+0.9799966841074009D-1*t210
     #*t19-0.4778117666686413D-1*t27*sigmaaa/t218/t13*t19
     #+0.1608963433833121D0*t22*t203)*t35+0.18610514726982D1*t99*t106
     #-0.18610514726982D1*t26*t233*t234+0.9305257363491D0*t26*t103*
     #(t201+t206-t214+0.3658500245218708D-4*t210)
      t256 = 0.7840081201533821D-1*t40/t38/t117*t44
      t258 = 1/t48/t62
      t261 = 0.1680027275102654D0*sigmabb*t258*t124
      t265 = t61/t38/t62/t117
      t267 = 1/t123/t122
      t269 = 0.4480125399532632D-1*t265*t267
      t273 = t62**2
      t288 = 1/t139/t68
      t289 = t142**2
      v2rhob2(i) = -0.4135669939329333D0/t48*t59*t69
     #-0.24814019635976D1*t38*t135*t69+0.24814019635976D1*t109*t143
     #-0.9305257363491D0*t39*(t256+t261-t269+0.9799966841074009D-1
     #*t265*t53-0.4778117666686413D-1*t61*sigmabb/t273/t47*t53
     #+0.1608963433833121D0*t56*t258)*t69+0.18610514726982D1*t136*t143
     #-0.18610514726982D1*t60*t288*t289+0.9305257363491D0*t60*t140*
     #(t256+t261-t269+0.3658500245218708D-4*t265)
      v2rhoab(i) = 0.D0
      t305 = 0.1680017400328676D-1*t146*t76*t10
      t307 = 0.5040081825307963D-1*t82*t87
      t308 = sigmaaa*t92
      t310 = 0.1680047024824737D-1*t308*t212
      v2rhoasigmaaa(i) = -0.12407009817988D1*t4*t157*t35
     #+0.12407009817988D1*t72*t164-0.9305257363491D0*t5*(-t305-t307
     #+t310-0.3266655613691336D-1*t92*t19*sigmaaa
     #+0.1791794125007405D-1*t27/t218/rhoa*t19-0.4388082092272149D-1
     #*t21*t82)*t35+0.9305257363491D0*t99*t164+0.9305257363491D0*t158
     #*t106-0.18610514726982D1*t26*t233*t105*t163+0.9305257363491D0
     #*t26*t103*(-t305-t307+t310-0.1155315866911171D-4*t308)
      v2rhoasigmaab(i) = 0.D0
      v2rhoasigmabb(i) = 0.D0
      v2rhobsigmaaa(i) = 0.D0
      v2rhobsigmaab(i) = 0.D0
      t345 = 0.1680017400328676D-1*t167*t113*t44
      t347 = 0.5040081825307963D-1*t119*t124
      t348 = sigmabb*t129
      t350 = 0.1680047024824737D-1*t348*t267
      v2rhobsigmabb(i) = -0.12407009817988D1*t38*t178*t69
     #+0.12407009817988D1*t109*t185-0.9305257363491D0*t39*(-t345-t347
     #+t350-0.3266655613691336D-1*t129*t53*sigmabb
     #+0.1791794125007405D-1*t61/t273/rhob*t53-0.4388082092272149D-1
     #*t55*t119)*t69+0.9305257363491D0*t136*t185+0.9305257363491D0
     #*t179*t143-0.18610514726982D1*t60*t288*t142*t184
     #+0.9305257363491D0*t60*t140*(-t345-t347+t350
     #-0.1155315866911171D-4*t348)
      t382 = 0.6300065251232535D-2/t6/sigmaaa*t7*t10
      t386 = 0.6300102281634954D-2/sigmaaa*t16*t87
      t388 = 0.6300176343092764D-2*t31*t212
      t400 = t163**2
      v2sigmaaa2(i) = -0.9305257363491D0*t5*(-t382+t386-t388
     #-0.6719227968777768D-2/t218*t19*sigmaaa+0.8166639034228341D-2
     #*t152)*t35+0.18610514726982D1*t158*t164-0.18610514726982D1*t26
     #*t233*t400+0.9305257363491D0*t26*t103*(-t382+t386-t388
     #+0.2166217250458446D-5*t31)
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      t413 = 0.6300065251232535D-2/t40/sigmabb*t41*t44
      t417 = 0.6300102281634954D-2/sigmabb*t50*t124
      t419 = 0.6300176343092764D-2*t65*t267
      t431 = t184**2
      v2sigmabb2(i) = -0.9305257363491D0*t39*(-t413+t417-t419
     #-0.6719227968777768D-2/t273*t53*sigmabb+0.8166639034228341D-2
     #*t173)*t69+0.18610514726982D1*t179*t185-0.18610514726982D1*t60
     #*t288*t431+0.9305257363491D0*t60*t140*(-t413+t417-t419
     #+0.2166217250458446D-5*t65)
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      v2rhob2(i) = 0.0d0
      v2rhoab(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2rhoasigmaab(i) = 0.0d0
      v2rhoasigmabb(i) = 0.0d0
      v2rhobsigmaaa(i) = 0.0d0
      v2rhobsigmaab(i) = 0.0d0
      v2rhobsigmabb(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      v2sigmaab2(i) = 0.0d0
      v2sigmabb2(i) = 0.0d0
      v2sigmaaaab(i) = 0.0d0
      v2sigmaaabb(i) = 0.0d0
      v2sigmaabbb(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end
      
      
      subroutine rks_x_pw91
     & (ideriv,npt,rhoa1,sigmaaa1,
     &  zk,vrhoa,vsigmaaa,
     &  v2rhoa2,v2rhoasigmaaa,v2sigmaaa2)
c
c     J.P. Perdew, J.A. Chevary, S.H. Vosko, K.A. Jackson,
c     M.R. Pederson, D.J. Singh, C. Fiolhais
c     Atoms, molecules, solids and surfaces:
c     Applications of the generalized gradient approximation
c     for exchange and correlation
c     Phys. Rev. B 46 (1992) 6671--6687
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt)
      REAL sigmaaa1(npt)
      REAL zk(npt),vrhoa(npt),vsigmaaa(npt)
      REAL v2rhoa2(npt),v2rhoasigmaaa(npt),v2sigmaaa2(npt)
      parameter(tol=1.0d-20)
      
      if(ideriv.eq.0) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t3 = t2*rho
      t4 = dsqrt(sigma)
      t6 = t4/t3
      t8 = dlog(0.1259928455434599D1*t6+dsqrt(1+0.1587419712813814D1
     #*t6**2))
      t10 = 0.3175033930295641D-1*t6*t8
      t11 = rho**2
      t12 = t2**2
      t14 = 1/t12/t11
      t17 = dexp(-0.261211729852336D1*sigma*t14)
      t25 = sigma**2
      t26 = t11**2
      zk(i) = -0.7385587663820224D0*t3*(1.D0+t10+0.261211729852336D-1*
     #(0.2743D0-0.1508D0*t17)*sigma*t14)/(1.D0+t10
     #+0.272926271249799D-5*t25/t2/t26/rho)
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t3 = t2*rho
      t4 = dsqrt(sigma)
      t5 = 1/t3
      t6 = t4*t5
      t8 = dlog(0.1259928455434599D1*t6+dsqrt(1+0.1587419712813814D1
     #*t6**2))
      t10 = 0.3175033930295641D-1*t6*t8
      t11 = rho**2
      t12 = t2**2
      t14 = 1/t12/t11
      t15 = sigma*t14
      t17 = dexp(-0.261211729852336D1*t15)
      t19 = 0.2743D0-0.1508D0*t17
      t20 = t19*sigma
      t23 = 1.D0+t10+0.261211729852336D-1*t20*t14
      t24 = t3*t23
      t25 = sigma**2
      t26 = t11**2
      t29 = 1/t2/t26/rho
      t32 = 1.D0+t10+0.272926271249799D-5*t25*t29
      t33 = 1/t32
      zk(i) = -0.7385587663820224D0*t24*t33
      t43 = 0.8466757147455043D-1*t4/t2/t11*t8
      t46 = 1/t12/t11/rho
      t50 = dsqrt(1.D0+0.1587419712813815D1*t15)
      t51 = 1/t50
      t53 = 0.1066750825533289D0*sigma*t46*t51
      t57 = t25/t2/t26/t11
      t66 = t32**2
      t67 = 1/t66
      vrhoa(i) = -0.9847450218426965D0*t2*t23*t33-0.3692793831910112D0
     #*t3*(-t43-t53-0.5487637560595959D-1*t57*t17-0.1393129225879125D0
     #*t20*t46)*t33+0.3692793831910112D0*t24*t67*(-t43-t53
     #-0.2911213559997856D-4*t57)
      t76 = 0.6350067860591282D-1/t4*t5*t8
      t78 = 0.8000631191499664D-1*t14*t51
      vsigmaaa(i) = -0.7385587663820224D0*t3*(t76+t78
     #+0.411572817044697D-1*t29*t17*sigma+0.1044846919409344D0*t19*t14
     #)*t33+0.7385587663820224D0*t24*t67*(t76+t78
     #+0.2183410169998392D-4*sigma*t29)
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t3 = t2*rho
      t4 = dsqrt(sigma)
      t5 = 1/t3
      t6 = t4*t5
      t8 = dlog(0.1259928455434599D1*t6+dsqrt(1+0.1587419712813814D1
     #*t6**2))
      t10 = 0.3175033930295641D-1*t6*t8
      t11 = rho**2
      t12 = t2**2
      t14 = 1/t12/t11
      t15 = sigma*t14
      t17 = dexp(-0.261211729852336D1*t15)
      t19 = 0.2743D0-0.1508D0*t17
      t20 = t19*sigma
      t23 = 1.D0+t10+0.261211729852336D-1*t20*t14
      t24 = t3*t23
      t25 = sigma**2
      t26 = t11**2
      t29 = 1/t2/t26/rho
      t32 = 1.D0+t10+0.272926271249799D-5*t25*t29
      t33 = 1/t32
      zk(i) = -0.7385587663820224D0*t24*t33
      t36 = t2*t23
      t40 = 1/t2/t11
      t43 = 0.8466757147455043D-1*t4*t40*t8
      t44 = t11*rho
      t46 = 1/t12/t44
      t49 = 1.D0+0.1587419712813815D1*t15
      t50 = dsqrt(t49)
      t51 = 1/t50
      t53 = 0.1066750825533289D0*sigma*t46*t51
      t56 = 1/t2/t26/t11
      t57 = t25*t56
      t62 = -t43-t53-0.5487637560595959D-1*t57*t17
     #-0.1393129225879125D0*t20*t46
      t63 = t3*t62
      t66 = t32**2
      t67 = 1/t66
      t69 = -t43-t53-0.2911213559997856D-4*t57
      t70 = t67*t69
      vrhoa(i) = -0.9847450218426965D0*t36*t33-0.3692793831910112D0
     #*t63*t33+0.3692793831910112D0*t24*t70
      t73 = 1/t4
      t76 = 0.6350067860591282D-1*t73*t5*t8
      t78 = 0.8000631191499664D-1*t14*t51
      t79 = t29*t17
      t84 = t76+t78+0.411572817044697D-1*t79*sigma
     #+0.1044846919409344D0*t19*t14
      t85 = t3*t84
      t90 = t76+t78+0.2183410169998392D-4*sigma*t29
      t91 = t67*t90
      vsigmaaa(i) = -0.7385587663820224D0*t85*t33+0.7385587663820224D0
     #*t24*t91
      t107 = 0.395115333547902D0*t4/t2/t44*t8
      t109 = 1/t12/t26
      t112 = 0.1066750825533289D1*sigma*t109*t51
      t116 = t25/t2/t26/t44
      t118 = 1/t50/t49
      t120 = 0.4515683437631874D0*t116*t118
      t124 = t26**2
      t139 = 1/t66/t32
      t140 = t69**2
      v2rhoa2(i) = -0.6564966812284644D0/t12*t23*t33
     #-0.1969490043685393D1*t2*t62*t33+0.1969490043685393D1*t36*t70
     #-0.3692793831910112D0*t3*(t107+t112-t120+0.9877747609072727D0
     #*t116*t17-0.764498826669826D0*t25*sigma/t124/t11*t17
     #+0.1021628098978025D1*t20*t109)*t33+0.7385587663820224D0*t63*t70
     #-0.7385587663820224D0*t24*t139*t140+0.3692793831910112D0*t24*t67
     #*(t107+t112-t120+0.3687537175997285D-3*t116)
      t156 = 0.1693351429491009D0*t73*t40*t8
      t158 = 0.6400504953199731D0*t46*t51
      t159 = sigma*t56
      t161 = 0.3386762578223905D0*t159*t118
      v2rhoasigmaaa(i) = -0.9847450218426965D0*t2*t84*t33
     #+0.9847450218426965D0*t36*t91-0.3692793831910112D0*t3*(-t156
     #-t158+t161-0.6585165072715151D0*t56*t17*sigma
     #+0.5733741200023695D0*t25/t124/rho*t17-0.5572516903516501D0*t19
     #*t46)*t33+0.3692793831910112D0*t63*t91+0.3692793831910112D0*t85
     #*t70-0.7385587663820224D0*t24*t139*t69*t90+0.3692793831910112D0
     #*t24*t67*(-t156-t158+t161-0.2328970847998285D-3*t159)
      t193 = 0.1270013572118256D0/t4/sigma*t5*t8
      t197 = 0.1600126238299933D0/sigma*t14*t51
      t199 = 0.2540071933667929D0*t29*t118
      t211 = t90**2
      v2sigmaaa2(i) = -0.7385587663820224D0*t3*(-t193+t197-t199
     #-0.4300305900017772D0/t124*t17*sigma+0.3292582536357576D0*t79)
     #*t33+0.1477117532764045D1*t85*t91-0.1477117532764045D1*t24*t139
     #*t211+0.7385587663820224D0*t24*t67*(-t193+t197-t199
     #+0.8733640679993569D-4*t29)
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end

c:X_PW91subrend
_ENDIF
_IF(ccpdft,all,x_mpw)
c:X_MPWsubrstart

c    Generated: Tue Jul 17 16:33:17 BST 2007

      subroutine uks_x_mpw
     & (ideriv,npt,rhoa1,rhob1,sigmaaa1,sigmabb1,sigmaab1,
     &  zk,vrhoa,vrhob,vsigmaaa,vsigmabb,vsigmaab,
     &  v2rhoa2,v2rhob2,v2rhoab,
     &  v2rhoasigmaaa,v2rhoasigmaab,v2rhoasigmabb,
     &  v2rhobsigmabb,v2rhobsigmaab,v2rhobsigmaaa,
     &  v2sigmaaa2,v2sigmaaaab,v2sigmaaabb,
     &  v2sigmaab2,v2sigmaabbb,v2sigmabb2)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt),rhob1(npt)
      REAL sigmaaa1(npt),sigmabb1(npt),sigmaab1(npt)
      REAL zk(npt),vrhoa(npt),vrhob(npt)
      REAL vsigmaaa(npt),vsigmabb(npt),vsigmaab(npt)
      REAL v2rhoa2(npt),v2rhob2(npt),v2rhoab(npt)
      REAL v2rhoasigmaaa(npt),v2rhoasigmaab(npt)
      REAL v2rhoasigmabb(npt),v2rhobsigmabb(npt)
      REAL v2rhobsigmaab(npt),v2rhobsigmaaa(npt)
      REAL v2sigmaaa2(npt),v2sigmaaaab(npt),v2sigmaaabb(npt)
      REAL v2sigmaab2(npt),v2sigmaabbb(npt),v2sigmabb2(npt)
      parameter(tol=1.0d-20)
      
      if (ideriv.eq.0) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t3 = t2*rhob
      t4 = rhob**2
      t5 = t2**2
      t8 = sigmabb/t5/t4
      t11 = dexp(-0.16455D1*t8)
      t14 = dsqrt(sigmabb)
      t16 = t14/t3
      t17 = t16**0.372D1
      t20 = dlog(t16+dsqrt(1+t16**2))
      zk(i) = t3*(-0.9305257363491D0-1.D0*(0.426D-2*t8
     #-0.2369618833300074D-2*t8*t11-0.1D-5*t17)/(1.D0+0.2556D-1*t16
     #*t20+0.1074661302677646D-5*t17))
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t3 = t2*rhoa
      t4 = rhoa**2
      t5 = t2**2
      t8 = sigmaaa/t5/t4
      t11 = dexp(-0.16455D1*t8)
      t14 = dsqrt(sigmaaa)
      t16 = t14/t3
      t17 = t16**0.372D1
      t20 = dlog(t16+dsqrt(1+t16**2))
      zk(i) = t3*(-0.9305257363491D0-1.D0*(0.426D-2*t8
     #-0.2369618833300074D-2*t8*t11-0.1D-5*t17)/(1.D0+0.2556D-1*t16
     #*t20+0.1074661302677646D-5*t17))
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t5 = t4*rhoa
      t6 = rhoa**2
      t7 = t4**2
      t10 = sigmaaa/t7/t6
      t13 = dexp(-0.16455D1*t10)
      t16 = dsqrt(sigmaaa)
      t18 = t16/t5
      t19 = t18**0.372D1
      t22 = dlog(t18+dsqrt(1+t18**2))
      t32 = rhob**(1.D0/3.D0)
      t33 = t32*rhob
      t34 = rhob**2
      t35 = t32**2
      t38 = sigmabb/t35/t34
      t41 = dexp(-0.16455D1*t38)
      t44 = dsqrt(sigmabb)
      t46 = t44/t33
      t47 = t46**0.372D1
      t50 = dlog(t46+dsqrt(1+t46**2))
      zk(i) = t5*(-0.9305257363491D0-1.D0*(0.426D-2*t10
     #-0.2369618833300074D-2*t10*t13-0.1D-5*t19)/(1.D0+0.2556D-1*t18
     #*t22+0.1074661302677646D-5*t19))+t33*(-0.9305257363491D0-1.D0*
     #(0.426D-2*t38-0.2369618833300074D-2*t38*t41-0.1D-5*t47)/(1.D0
     #+0.2556D-1*t46*t50+0.1074661302677646D-5*t47))
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t3 = t2*rhob
      t4 = rhob**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigmabb*t7
      t11 = dexp(-0.16455D1*t8)
      t14 = dsqrt(sigmabb)
      t15 = 1/t3
      t16 = t14*t15
      t17 = t16**0.372D1
      t19 = 0.426D-2*t8-0.2369618833300074D-2*t8*t11-0.1D-5*t17
      t20 = dlog(t16+dsqrt(1+t16**2))
      t24 = 1.D0+0.2556D-1*t16*t20+0.1074661302677646D-5*t17
      t25 = 1/t24
      t28 = -0.9305257363491D0-1.D0*t19*t25
      zk(i) = t3*t28
      vrhoa(i) = 0.D0
      t34 = sigmabb/t5/t4/rhob
      t38 = sigmabb**2
      t39 = t4**2
      t46 = t16**0.272D1
      t49 = 1/t2/t4
      t50 = t46*t14*t49
      t55 = t24**2
      t57 = t19/t55
      t62 = dsqrt(1.D0+t8)
      t63 = 1/t62
      vrhob(i) = 0.1333333333333333D1*t2*t28+t3*(-1.D0*(-0.1136D-1*t34
     #+0.6318983555466863D-2*t34*t11-0.1039788744052072D-1*t38/t2/t39
     #/t4*t11+0.496D-5*t50)*t25+t57*(-0.3408D-1*t14*t49*t20-0.3408D-1
     #*t34*t63-0.5330320061281126D-5*t50))
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      t80 = 1/t14
      t82 = t46*t80*t15
      vsigmabb(i) = t3*(-1.D0*(0.426D-2*t7-0.2369618833300074D-2*t7
     #*t11+0.3899207790195271D-2*sigmabb/t2/t39/rhob*t11-0.186D-5*t82)
     #*t25+t57*(0.1278D-1*t80*t15*t20+0.1278D-1*t7*t63
     #+0.1998870022980422D-5*t82))
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t3 = t2*rhoa
      t4 = rhoa**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigmaaa*t7
      t11 = dexp(-0.16455D1*t8)
      t14 = dsqrt(sigmaaa)
      t15 = 1/t3
      t16 = t14*t15
      t17 = t16**0.372D1
      t19 = 0.426D-2*t8-0.2369618833300074D-2*t8*t11-0.1D-5*t17
      t20 = dlog(t16+dsqrt(1+t16**2))
      t24 = 1.D0+0.2556D-1*t16*t20+0.1074661302677646D-5*t17
      t25 = 1/t24
      t28 = -0.9305257363491D0-1.D0*t19*t25
      zk(i) = t3*t28
      t34 = sigmaaa/t5/t4/rhoa
      t38 = sigmaaa**2
      t39 = t4**2
      t46 = t16**0.272D1
      t49 = 1/t2/t4
      t50 = t46*t14*t49
      t55 = t24**2
      t57 = t19/t55
      t62 = dsqrt(1.D0+t8)
      t63 = 1/t62
      vrhoa(i) = 0.1333333333333333D1*t2*t28+t3*(-1.D0*(-0.1136D-1*t34
     #+0.6318983555466863D-2*t34*t11-0.1039788744052072D-1*t38/t2/t39
     #/t4*t11+0.496D-5*t50)*t25+t57*(-0.3408D-1*t14*t49*t20-0.3408D-1
     #*t34*t63-0.5330320061281126D-5*t50))
      vrhob(i) = 0.D0
      t80 = 1/t14
      t82 = t46*t80*t15
      vsigmaaa(i) = t3*(-1.D0*(0.426D-2*t7-0.2369618833300074D-2*t7
     #*t11+0.3899207790195271D-2*sigmaaa/t2/t39/rhoa*t11-0.186D-5*t82)
     #*t25+t57*(0.1278D-1*t80*t15*t20+0.1278D-1*t7*t63
     #+0.1998870022980422D-5*t82))
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t5 = t4*rhoa
      t6 = rhoa**2
      t7 = t4**2
      t9 = 1/t7/t6
      t10 = sigmaaa*t9
      t13 = dexp(-0.16455D1*t10)
      t16 = dsqrt(sigmaaa)
      t17 = 1/t5
      t18 = t16*t17
      t19 = t18**0.372D1
      t21 = 0.426D-2*t10-0.2369618833300074D-2*t10*t13-0.1D-5*t19
      t22 = dlog(t18+dsqrt(1+t18**2))
      t26 = 1.D0+0.2556D-1*t18*t22+0.1074661302677646D-5*t19
      t27 = 1/t26
      t30 = -0.9305257363491D0-1.D0*t21*t27
      t32 = rhob**(1.D0/3.D0)
      t33 = t32*rhob
      t34 = rhob**2
      t35 = t32**2
      t37 = 1/t35/t34
      t38 = sigmabb*t37
      t41 = dexp(-0.16455D1*t38)
      t44 = dsqrt(sigmabb)
      t45 = 1/t33
      t46 = t44*t45
      t47 = t46**0.372D1
      t49 = 0.426D-2*t38-0.2369618833300074D-2*t38*t41-0.1D-5*t47
      t50 = dlog(t46+dsqrt(1+t46**2))
      t54 = 1.D0+0.2556D-1*t46*t50+0.1074661302677646D-5*t47
      t55 = 1/t54
      t58 = -0.9305257363491D0-1.D0*t49*t55
      zk(i) = t5*t30+t33*t58
      t65 = sigmaaa/t7/t6/rhoa
      t69 = sigmaaa**2
      t70 = t6**2
      t77 = t18**0.272D1
      t80 = 1/t4/t6
      t81 = t77*t16*t80
      t86 = t26**2
      t88 = t21/t86
      t93 = dsqrt(1.D0+t10)
      t94 = 1/t93
      vrhoa(i) = 0.1333333333333333D1*t4*t30+t5*(-1.D0*(-0.1136D-1*t65
     #+0.6318983555466863D-2*t65*t13-0.1039788744052072D-1*t69/t4/t70
     #/t6*t13+0.496D-5*t81)*t27+t88*(-0.3408D-1*t16*t80*t22-0.3408D-1
     #*t65*t94-0.5330320061281126D-5*t81))
      t107 = sigmabb/t35/t34/rhob
      t111 = sigmabb**2
      t112 = t34**2
      t119 = t46**0.272D1
      t122 = 1/t32/t34
      t123 = t119*t44*t122
      t128 = t54**2
      t130 = t49/t128
      t135 = dsqrt(1.D0+t38)
      t136 = 1/t135
      vrhob(i) = 0.1333333333333333D1*t32*t58+t33*(-1.D0*(-0.1136D-1
     #*t107+0.6318983555466863D-2*t107*t41-0.1039788744052072D-1*t111
     #/t32/t112/t34*t41+0.496D-5*t123)*t55+t130*(-0.3408D-1*t44*t122
     #*t50-0.3408D-1*t107*t136-0.5330320061281126D-5*t123))
      t153 = 1/t16
      t155 = t77*t153*t17
      vsigmaaa(i) = t5*(-1.D0*(0.426D-2*t9-0.2369618833300074D-2*t9
     #*t13+0.3899207790195271D-2*sigmaaa/t4/t70/rhoa*t13-0.186D-5*t155
     #)*t27+t88*(0.1278D-1*t153*t17*t22+0.1278D-1*t9*t94
     #+0.1998870022980422D-5*t155))
      vsigmaab(i) = 0.D0
      t178 = 1/t44
      t180 = t119*t178*t45
      vsigmabb(i) = t33*(-1.D0*(0.426D-2*t37-0.2369618833300074D-2*t37
     #*t41+0.3899207790195271D-2*sigmabb/t32/t112/rhob*t41-0.186D-5
     #*t180)*t55+t130*(0.1278D-1*t178*t45*t50+0.1278D-1*t37*t136
     #+0.1998870022980422D-5*t180))
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t3 = t2*rhob
      t4 = rhob**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigmabb*t7
      t11 = dexp(-0.16455D1*t8)
      t14 = dsqrt(sigmabb)
      t15 = 1/t3
      t16 = t14*t15
      t17 = t16**0.372D1
      t19 = 0.426D-2*t8-0.2369618833300074D-2*t8*t11-0.1D-5*t17
      t20 = dlog(t16+dsqrt(1+t16**2))
      t24 = 1.D0+0.2556D-1*t16*t20+0.1074661302677646D-5*t17
      t25 = 1/t24
      t28 = -0.9305257363491D0-1.D0*t19*t25
      zk(i) = t3*t28
      vrhoa(i) = 0.D0
      t31 = t4*rhob
      t34 = sigmabb/t5/t31
      t38 = sigmabb**2
      t39 = t4**2
      t46 = t16**0.272D1
      t47 = t46*t14
      t49 = 1/t2/t4
      t50 = t47*t49
      t52 = -0.1136D-1*t34+0.6318983555466863D-2*t34*t11
     #-0.1039788744052072D-1*t38/t2/t39/t4*t11+0.496D-5*t50
      t55 = t24**2
      t56 = 1/t55
      t57 = t19*t56
      t61 = 1.D0+t8
      t62 = dsqrt(t61)
      t63 = 1/t62
      t67 = -0.3408D-1*t14*t49*t20-0.3408D-1*t34*t63
     #-0.5330320061281126D-5*t50
      t69 = -1.D0*t52*t25+t57*t67
      vrhob(i) = 0.1333333333333333D1*t2*t28+t3*t69
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      t76 = 1/t2/t39/rhob
      t80 = 1/t14
      t82 = t46*t80*t15
      t84 = 0.426D-2*t7-0.2369618833300074D-2*t7*t11
     #+0.3899207790195271D-2*sigmabb*t76*t11-0.186D-5*t82
      t93 = 0.1278D-1*t80*t15*t20+0.1278D-1*t7*t63
     #+0.1998870022980422D-5*t82
      vsigmabb(i) = t3*(-1.D0*t84*t25+t57*t93)
      v2rhoa2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t102 = 1/t5/t39
      t103 = sigmabb*t102
      t110 = t38/t2/t39/t31
      t114 = t39**2
      t120 = t16**0.172D1
      t122 = t120*sigmabb*t102
      t125 = 1/t2/t31
      t126 = t47*t125
      t136 = t19/t55/t24
      t137 = t67**2
      t146 = 1/t62/t61
      v2rhob2(i) = 0.4444444444444444D0/t5*t28+0.2666666666666667D1*t2
     #*t69+t3*(-1.D0*(0.4165333333333333D-1*t103-0.2316960637004517D-1
     #*t103*t11+0.9358098696468651D-1*t110*t11-0.4562593008900494D-1
     #*t38*sigmabb/t114/t4*t11-0.1798826666666667D-4*t122
     #-0.1157333333333333D-4*t126)*t25+2.D0*t52*t56*t67-2.D0*t136*t137
     #+t57*(0.7952D-1*t14*t125*t20+0.1704D0*t103*t63-0.4544D-1*t110
     #*t146+0.1933129408891288D-4*t122+0.1243741347632263D-4*t126))
      v2sigmaaa2(i) = 0.D0
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      t161 = 1/sigmabb
      t163 = t120*t161*t7
      t166 = 1/t14/sigmabb
      t168 = t46*t166*t15
      t176 = t93**2
      v2sigmabb2(i) = t3*(-1.D0*(0.7798415580390543D-2*t76*t11
     #-0.6416146418766319D-2*sigmabb/t114*t11-0.25296D-5*t163+0.93D-6
     #*t168)*t25+2.D0*t84*t56*t93-2.D0*t136*t176+t57*(-0.639D-2*t166
     #*t15*t20+0.639D-2*t161*t7*t63-0.639D-2*t76*t146
     #+0.2718463231253374D-5*t163-0.9994350114902112D-6*t168))
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t3 = t2*rhoa
      t4 = rhoa**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigmaaa*t7
      t11 = dexp(-0.16455D1*t8)
      t14 = dsqrt(sigmaaa)
      t15 = 1/t3
      t16 = t14*t15
      t17 = t16**0.372D1
      t19 = 0.426D-2*t8-0.2369618833300074D-2*t8*t11-0.1D-5*t17
      t20 = dlog(t16+dsqrt(1+t16**2))
      t24 = 1.D0+0.2556D-1*t16*t20+0.1074661302677646D-5*t17
      t25 = 1/t24
      t28 = -0.9305257363491D0-1.D0*t19*t25
      zk(i) = t3*t28
      t31 = t4*rhoa
      t34 = sigmaaa/t5/t31
      t38 = sigmaaa**2
      t39 = t4**2
      t46 = t16**0.272D1
      t47 = t46*t14
      t49 = 1/t2/t4
      t50 = t47*t49
      t52 = -0.1136D-1*t34+0.6318983555466863D-2*t34*t11
     #-0.1039788744052072D-1*t38/t2/t39/t4*t11+0.496D-5*t50
      t55 = t24**2
      t56 = 1/t55
      t57 = t19*t56
      t61 = 1.D0+t8
      t62 = dsqrt(t61)
      t63 = 1/t62
      t67 = -0.3408D-1*t14*t49*t20-0.3408D-1*t34*t63
     #-0.5330320061281126D-5*t50
      t69 = -1.D0*t52*t25+t57*t67
      vrhoa(i) = 0.1333333333333333D1*t2*t28+t3*t69
      vrhob(i) = 0.D0
      t76 = 1/t2/t39/rhoa
      t80 = 1/t14
      t82 = t46*t80*t15
      t84 = 0.426D-2*t7-0.2369618833300074D-2*t7*t11
     #+0.3899207790195271D-2*sigmaaa*t76*t11-0.186D-5*t82
      t93 = 0.1278D-1*t80*t15*t20+0.1278D-1*t7*t63
     #+0.1998870022980422D-5*t82
      vsigmaaa(i) = t3*(-1.D0*t84*t25+t57*t93)
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      t102 = 1/t5/t39
      t103 = sigmaaa*t102
      t110 = t38/t2/t39/t31
      t114 = t39**2
      t120 = t16**0.172D1
      t122 = t120*sigmaaa*t102
      t125 = 1/t2/t31
      t126 = t47*t125
      t136 = t19/t55/t24
      t137 = t67**2
      t146 = 1/t62/t61
      v2rhoa2(i) = 0.4444444444444444D0/t5*t28+0.2666666666666667D1*t2
     #*t69+t3*(-1.D0*(0.4165333333333333D-1*t103-0.2316960637004517D-1
     #*t103*t11+0.9358098696468651D-1*t110*t11-0.4562593008900494D-1
     #*t38*sigmaaa/t114/t4*t11-0.1798826666666667D-4*t122
     #-0.1157333333333333D-4*t126)*t25+2.D0*t52*t56*t67-2.D0*t136*t137
     #+t57*(0.7952D-1*t14*t125*t20+0.1704D0*t103*t63-0.4544D-1*t110
     #*t146+0.1933129408891288D-4*t122+0.1243741347632263D-4*t126))
      v2rhob2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t161 = 1/sigmaaa
      t163 = t120*t161*t7
      t166 = 1/t14/sigmaaa
      t168 = t46*t166*t15
      t176 = t93**2
      v2sigmaaa2(i) = t3*(-1.D0*(0.7798415580390543D-2*t76*t11
     #-0.6416146418766319D-2*sigmaaa/t114*t11-0.25296D-5*t163+0.93D-6
     #*t168)*t25+2.D0*t84*t56*t93-2.D0*t136*t176+t57*(-0.639D-2*t166
     #*t15*t20+0.639D-2*t161*t7*t63-0.639D-2*t76*t146
     #+0.2718463231253374D-5*t163-0.9994350114902112D-6*t168))
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      v2sigmabb2(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t5 = t4*rhoa
      t6 = rhoa**2
      t7 = t4**2
      t9 = 1/t7/t6
      t10 = sigmaaa*t9
      t13 = dexp(-0.16455D1*t10)
      t16 = dsqrt(sigmaaa)
      t17 = 1/t5
      t18 = t16*t17
      t19 = t18**0.372D1
      t21 = 0.426D-2*t10-0.2369618833300074D-2*t10*t13-0.1D-5*t19
      t22 = dlog(t18+dsqrt(1+t18**2))
      t26 = 1.D0+0.2556D-1*t18*t22+0.1074661302677646D-5*t19
      t27 = 1/t26
      t30 = -0.9305257363491D0-1.D0*t21*t27
      t32 = rhob**(1.D0/3.D0)
      t33 = t32*rhob
      t34 = rhob**2
      t35 = t32**2
      t37 = 1/t35/t34
      t38 = sigmabb*t37
      t41 = dexp(-0.16455D1*t38)
      t44 = dsqrt(sigmabb)
      t45 = 1/t33
      t46 = t44*t45
      t47 = t46**0.372D1
      t49 = 0.426D-2*t38-0.2369618833300074D-2*t38*t41-0.1D-5*t47
      t50 = dlog(t46+dsqrt(1+t46**2))
      t54 = 1.D0+0.2556D-1*t46*t50+0.1074661302677646D-5*t47
      t55 = 1/t54
      t58 = -0.9305257363491D0-1.D0*t49*t55
      zk(i) = t5*t30+t33*t58
      t62 = t6*rhoa
      t64 = 1/t7/t62
      t65 = sigmaaa*t64
      t69 = sigmaaa**2
      t70 = t6**2
      t73 = 1/t4/t70/t6
      t77 = t18**0.272D1
      t78 = t77*t16
      t80 = 1/t4/t6
      t81 = t78*t80
      t83 = -0.1136D-1*t65+0.6318983555466863D-2*t65*t13
     #-0.1039788744052072D-1*t69*t73*t13+0.496D-5*t81
      t86 = t26**2
      t87 = 1/t86
      t88 = t21*t87
      t92 = 1.D0+t10
      t93 = dsqrt(t92)
      t94 = 1/t93
      t98 = -0.3408D-1*t16*t80*t22-0.3408D-1*t65*t94
     #-0.5330320061281126D-5*t81
      t100 = -1.D0*t83*t27+t88*t98
      vrhoa(i) = 0.1333333333333333D1*t4*t30+t5*t100
      t104 = t34*rhob
      t106 = 1/t35/t104
      t107 = sigmabb*t106
      t111 = sigmabb**2
      t112 = t34**2
      t115 = 1/t32/t112/t34
      t119 = t46**0.272D1
      t120 = t119*t44
      t122 = 1/t32/t34
      t123 = t120*t122
      t125 = -0.1136D-1*t107+0.6318983555466863D-2*t107*t41
     #-0.1039788744052072D-1*t111*t115*t41+0.496D-5*t123
      t128 = t54**2
      t129 = 1/t128
      t130 = t49*t129
      t134 = 1.D0+t38
      t135 = dsqrt(t134)
      t136 = 1/t135
      t140 = -0.3408D-1*t44*t122*t50-0.3408D-1*t107*t136
     #-0.5330320061281126D-5*t123
      t142 = -1.D0*t125*t55+t130*t140
      vrhob(i) = 0.1333333333333333D1*t32*t58+t33*t142
      t149 = 1/t4/t70/rhoa
      t153 = 1/t16
      t154 = t77*t153
      t155 = t154*t17
      t157 = 0.426D-2*t9-0.2369618833300074D-2*t9*t13
     #+0.3899207790195271D-2*sigmaaa*t149*t13-0.186D-5*t155
      t166 = 0.1278D-1*t153*t17*t22+0.1278D-1*t9*t94
     #+0.1998870022980422D-5*t155
      t168 = -1.D0*t157*t27+t88*t166
      vsigmaaa(i) = t5*t168
      vsigmaab(i) = 0.D0
      t174 = 1/t32/t112/rhob
      t178 = 1/t44
      t179 = t119*t178
      t180 = t179*t45
      t182 = 0.426D-2*t37-0.2369618833300074D-2*t37*t41
     #+0.3899207790195271D-2*sigmabb*t174*t41-0.186D-5*t180
      t191 = 0.1278D-1*t178*t45*t50+0.1278D-1*t37*t136
     #+0.1998870022980422D-5*t180
      t193 = -1.D0*t182*t55+t130*t191
      vsigmabb(i) = t33*t193
      t200 = 1/t7/t70
      t201 = sigmaaa*t200
      t208 = t69/t4/t70/t62
      t212 = t70**2
      t218 = t18**0.172D1
      t220 = t218*sigmaaa*t200
      t223 = 1/t4/t62
      t224 = t78*t223
      t229 = t83*t87
      t234 = t21/t86/t26
      t235 = t98**2
      t244 = 1/t93/t92
      v2rhoa2(i) = 0.4444444444444444D0/t7*t30+0.2666666666666667D1*t4
     #*t100+t5*(-1.D0*(0.4165333333333333D-1*t201
     #-0.2316960637004517D-1*t201*t13+0.9358098696468651D-1*t208*t13
     #-0.4562593008900494D-1*t69*sigmaaa/t212/t6*t13
     #-0.1798826666666667D-4*t220-0.1157333333333333D-4*t224)*t27+2.D0
     #*t229*t98-2.D0*t234*t235+t88*(0.7952D-1*t16*t223*t22+0.1704D0
     #*t201*t94-0.4544D-1*t208*t244+0.1933129408891288D-4*t220
     #+0.1243741347632263D-4*t224))
      t259 = 1/t35/t112
      t260 = sigmabb*t259
      t267 = t111/t32/t112/t104
      t271 = t112**2
      t277 = t46**0.172D1
      t279 = t277*sigmabb*t259
      t282 = 1/t32/t104
      t283 = t120*t282
      t288 = t125*t129
      t293 = t49/t128/t54
      t294 = t140**2
      t303 = 1/t135/t134
      v2rhob2(i) = 0.4444444444444444D0/t35*t58+0.2666666666666667D1
     #*t32*t142+t33*(-1.D0*(0.4165333333333333D-1*t260
     #-0.2316960637004517D-1*t260*t41+0.9358098696468651D-1*t267*t41
     #-0.4562593008900494D-1*t111*sigmabb/t271/t34*t41
     #-0.1798826666666667D-4*t279-0.1157333333333333D-4*t283)*t55+2.D0
     #*t288*t140-2.D0*t293*t294+t130*(0.7952D-1*t44*t282*t50+0.1704D0
     #*t260*t136-0.4544D-1*t267*t303+0.1933129408891288D-4*t279
     #+0.1243741347632263D-4*t283))
      v2rhoab(i) = 0.D0
      t317 = sigmaaa*t73
      t325 = t218*t64
      t327 = t154*t80
      t333 = t157*t87
      v2rhoasigmaaa(i) = 0.1333333333333333D1*t4*t168+t5*(-1.D0*(
     #-0.1136D-1*t64+0.6318983555466863D-2*t64*t13
     #-0.3119366232156217D-1*t317*t13+0.1710972378337685D-1*t69/t212
     #/rhoa*t13+0.67456D-5*t325+0.248D-5*t327)*t27+t229*t166+t333*t98
     #-2.D0*t234*t98*t166+t88*(-0.1704D-1*t153*t80*t22-0.5112D-1*t64
     #*t94+0.1704D-1*t317*t244-0.7249235283342332D-5*t325
     #-0.2665160030640563D-5*t327))
      v2rhoasigmaab(i) = 0.D0
      v2rhoasigmabb(i) = 0.D0
      v2rhobsigmaaa(i) = 0.D0
      v2rhobsigmaab(i) = 0.D0
      t356 = sigmabb*t115
      t364 = t277*t106
      t366 = t179*t122
      t372 = t182*t129
      v2rhobsigmabb(i) = 0.1333333333333333D1*t32*t193+t33*(-1.D0*(
     #-0.1136D-1*t106+0.6318983555466863D-2*t106*t41
     #-0.3119366232156217D-1*t356*t41+0.1710972378337685D-1*t111/t271
     #/rhob*t41+0.67456D-5*t364+0.248D-5*t366)*t55+t288*t191+t372*t140
     #-2.D0*t293*t140*t191+t130*(-0.1704D-1*t178*t122*t50-0.5112D-1
     #*t106*t136+0.1704D-1*t356*t303-0.7249235283342332D-5*t364
     #-0.2665160030640563D-5*t366))
      t396 = 1/sigmaaa
      t398 = t218*t396*t9
      t401 = 1/t16/sigmaaa
      t403 = t77*t401*t17
      t410 = t166**2
      v2sigmaaa2(i) = t5*(-1.D0*(0.7798415580390543D-2*t149*t13
     #-0.6416146418766319D-2*sigmaaa/t212*t13-0.25296D-5*t398+0.93D-6
     #*t403)*t27+2.D0*t333*t166-2.D0*t234*t410+t88*(-0.639D-2*t401*t17
     #*t22+0.639D-2*t396*t9*t94-0.639D-2*t149*t244
     #+0.2718463231253374D-5*t398-0.9994350114902112D-6*t403))
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      t432 = 1/sigmabb
      t434 = t277*t432*t37
      t437 = 1/t44/sigmabb
      t439 = t119*t437*t45
      t446 = t191**2
      v2sigmabb2(i) = t33*(-1.D0*(0.7798415580390543D-2*t174*t41
     #-0.6416146418766319D-2*sigmabb/t271*t41-0.25296D-5*t434+0.93D-6
     #*t439)*t55+2.D0*t372*t191-2.D0*t293*t446+t130*(-0.639D-2*t437
     #*t45*t50+0.639D-2*t432*t37*t136-0.639D-2*t174*t303
     #+0.2718463231253374D-5*t434-0.9994350114902112D-6*t439))
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      v2rhob2(i) = 0.0d0
      v2rhoab(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2rhoasigmaab(i) = 0.0d0
      v2rhoasigmabb(i) = 0.0d0
      v2rhobsigmaaa(i) = 0.0d0
      v2rhobsigmaab(i) = 0.0d0
      v2rhobsigmabb(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      v2sigmaab2(i) = 0.0d0
      v2sigmabb2(i) = 0.0d0
      v2sigmaaaab(i) = 0.0d0
      v2sigmaaabb(i) = 0.0d0
      v2sigmaabbb(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end
      
      
      subroutine rks_x_mpw
     & (ideriv,npt,rhoa1,sigmaaa1,
     &  zk,vrhoa,vsigmaaa,
     &  v2rhoa2,v2rhoasigmaaa,v2sigmaaa2)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt)
      REAL sigmaaa1(npt)
      REAL zk(npt),vrhoa(npt),vsigmaaa(npt)
      REAL v2rhoa2(npt),v2rhoasigmaaa(npt),v2sigmaaa2(npt)
      parameter(tol=1.0d-20)
      
      if(ideriv.eq.0) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t3 = t2*rho
      t4 = rho**2
      t5 = t2**2
      t8 = sigma/t5/t4
      t11 = dexp(-0.2612068431013672D1*t8)
      t14 = dsqrt(sigma)
      t16 = t14/t3
      t17 = t16**0.372D1
      t21 = dlog(0.1259921049894873D1*t16+dsqrt(1+0.1587401051968199D1
     #*t16**2))
      zk(i) = 0.7937005259840997D0*t3*(-0.9305257363491D0-1.D0*
     #(0.676232848138453D-2*t8-0.3761535428744195D-2*t8*t11
     #-0.2361985322859061D-5*t17)/(1.D0+0.3220358203531296D-1*t16*t21
     #+0.25383342239692D-5*t17))
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t3 = t2*rho
      t4 = rho**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigma*t7
      t11 = dexp(-0.2612068431013672D1*t8)
      t14 = dsqrt(sigma)
      t15 = 1/t3
      t16 = t14*t15
      t17 = t16**0.372D1
      t19 = 0.676232848138453D-2*t8-0.3761535428744195D-2*t8*t11
     #-0.2361985322859061D-5*t17
      t21 = dlog(0.1259921049894873D1*t16+dsqrt(1+0.1587401051968199D1
     #*t16**2))
      t25 = 1.D0+0.3220358203531296D-1*t16*t21+0.25383342239692D-5*t17
      t26 = 1/t25
      t29 = -0.9305257363491D0-1.D0*t19*t26
      zk(i) = 0.7937005259840997D0*t3*t29
      t36 = sigma/t5/t4/rho
      t40 = sigma**2
      t41 = t4**2
      t48 = t16**0.272D1
      t51 = 1/t2/t4
      t52 = t48*t14*t51
      t57 = t25**2
      t59 = t19/t57
      t65 = dsqrt(1.D0+0.1587401051968199D1*t8)
      t66 = 1/t65
      vrhoa(i) = 0.10582673679788D1*t2*t29+0.3968502629920499D0*t3*(
     #-1.D0*(-0.3606575190071749D-1*t36+0.200615222866357D-1*t36*t11
     #-0.5240206904299834D-1*t40/t2/t41/t4*t11+0.2343089440276188D-4
     #*t52)*t26+t59*(-0.8587621876083455D-1*t14*t51*t21
     #-0.1081972557021525D0*t36*t66-0.2518027550177446D-4*t52))
      t84 = 1/t14
      t86 = t48*t84*t15
      vsigmaaa(i) = 0.7937005259840997D0*t3*(-1.D0*
     #(0.2704931392553812D-1*t7-0.1504614171497678D-1*t7*t11
     #+0.3930155178224876D-1*sigma/t2/t41/rho*t11
     #-0.1757317080207141D-4*t86)*t26+t59*(0.6440716407062592D-1*t84
     #*t15*t21+0.8114794177661436D-1*t7*t66+0.1888520662633084D-4*t86))
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t3 = t2*rho
      t4 = rho**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigma*t7
      t11 = dexp(-0.2612068431013672D1*t8)
      t14 = dsqrt(sigma)
      t15 = 1/t3
      t16 = t14*t15
      t17 = t16**0.372D1
      t19 = 0.676232848138453D-2*t8-0.3761535428744195D-2*t8*t11
     #-0.2361985322859061D-5*t17
      t21 = dlog(0.1259921049894873D1*t16+dsqrt(1+0.1587401051968199D1
     #*t16**2))
      t25 = 1.D0+0.3220358203531296D-1*t16*t21+0.25383342239692D-5*t17
      t26 = 1/t25
      t29 = -0.9305257363491D0-1.D0*t19*t26
      zk(i) = 0.7937005259840997D0*t3*t29
      t33 = t4*rho
      t35 = 1/t5/t33
      t36 = sigma*t35
      t40 = sigma**2
      t41 = t4**2
      t44 = 1/t2/t41/t4
      t48 = t16**0.272D1
      t49 = t48*t14
      t51 = 1/t2/t4
      t52 = t49*t51
      t54 = -0.3606575190071749D-1*t36+0.200615222866357D-1*t36*t11
     #-0.5240206904299834D-1*t40*t44*t11+0.2343089440276188D-4*t52
      t57 = t25**2
      t58 = 1/t57
      t59 = t19*t58
      t64 = 1.D0+0.1587401051968199D1*t8
      t65 = dsqrt(t64)
      t66 = 1/t65
      t70 = -0.8587621876083455D-1*t14*t51*t21-0.1081972557021525D0
     #*t36*t66-0.2518027550177446D-4*t52
      t72 = -1.D0*t54*t26+t59*t70
      vrhoa(i) = 0.10582673679788D1*t2*t29+0.3968502629920499D0*t3*t72
      t80 = 1/t2/t41/rho
      t84 = 1/t14
      t85 = t48*t84
      t86 = t85*t15
      t88 = 0.2704931392553812D-1*t7-0.1504614171497678D-1*t7*t11
     #+0.3930155178224876D-1*sigma*t80*t11-0.1757317080207141D-4*t86
      t97 = 0.6440716407062592D-1*t84*t15*t21+0.8114794177661436D-1*t7
     #*t66+0.1888520662633084D-4*t86
      t99 = -1.D0*t88*t26+t59*t97
      vsigmaaa(i) = 0.7937005259840997D0*t3*t99
      t107 = 1/t5/t41
      t108 = sigma*t107
      t115 = t40/t2/t41/t33
      t119 = t41**2
      t125 = t16**0.172D1
      t127 = t125*sigma*t107
      t130 = 1/t2/t33
      t131 = t49*t130
      t136 = t54*t58
      t141 = t19/t57/t25
      t142 = t70**2
      t151 = 1/t65/t64
      v2rhoa2(i) = 0.7055115786525331D0/t5*t29+0.2116534735957599D1*t2
     #*t72+0.3968502629920499D0*t3*(-1.D0*(0.2644821806052616D0*t108
     #-0.1471178301019952D0*t108*t11+0.9432372427739702D0*t115*t11
     #-0.730014881424079D0*t40*sigma/t119/t4*t11-0.1699520874013662D-3
     #*t127-0.1093441738795555D-3*t131)*t26+2.D0*t136*t70-2.D0*t141
     #*t142+t59*(0.4007556875505613D0*t14*t130*t21
     #+0.1081972557021525D1*t108*t66-0.4580065000577843D0*t115*t151
     #+0.1826409316395374D-3*t127+0.1175079523416141D-3*t131))
      t166 = sigma*t44
      t174 = t125*t35
      t176 = t85*t51
      t182 = t88*t58
      v2rhoasigmaaa(i) = 0.10582673679788D1*t2*t99
     #+0.3968502629920499D0*t3*(-1.D0*(-0.14426300760287D0*t35
     #+0.8024608914654282D-1*t35*t11-0.6288248285159801D0*t166*t11
     #+0.5475111610680592D0*t40/t119/rho*t11+0.1274640655510246D-3
     #*t174+0.4686178880552377D-4*t176)*t26+t136*t97+t182*t70-2.D0
     #*t141*t70*t97+t59*(-0.1717524375216691D0*t84*t51*t21
     #-0.6491835342129149D0*t35*t66+0.3435048750433382D0*t166*t151
     #-0.1369806987296531D-3*t174-0.5036055100354892D-4*t176))
      t207 = 1/sigma
      t209 = t125*t207*t7
      t212 = 1/t14/sigma
      t214 = t48*t212*t15
      t221 = t97**2
      v2sigmaaa2(i) = 0.7937005259840997D0*t3*(-1.D0*
     #(0.3144124142579901D0*t80*t11-0.4106333708010444D0*sigma/t119
     #*t11-0.9559804916326848D-4*t209+0.3514634160414282D-4*t214)*t26
     #+2.D0*t182*t97-2.D0*t141*t221+t59*(-0.1288143281412518D0*t212
     #*t15*t21+0.1622958835532287D0*t207*t7*t66-0.2576286562825037D0
     #*t80*t151+0.1027355240472398D-3*t209-0.3777041325266169D-4*t214))
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end

c:X_MPWsubrend
_ENDIF
_IF(ccpdft,all,x_ft97b,xc_ft97)
c:X_FT97Bsubrstart

c    Generated: Thu Jan 30 10:36:52 GMT 2003

      subroutine uks_x_ft97b
     & (ideriv,npt,rhoa1,rhob1,sigmaaa1,sigmabb1,sigmaab1,
     &  zk,vrhoa,vrhob,vsigmaaa,vsigmabb,vsigmaab,
     &  v2rhoa2,v2rhob2,v2rhoab,
     &  v2rhoasigmaaa,v2rhoasigmaab,v2rhoasigmabb,
     &  v2rhobsigmabb,v2rhobsigmaab,v2rhobsigmaaa,
     &  v2sigmaaa2,v2sigmaaaab,v2sigmaaabb,
     &  v2sigmaab2,v2sigmaabbb,v2sigmabb2)
c
c     M. Filatov, and W. Thiel
c     A new gradient-corrected exchange-correlation density functional
c     Mol. Phys. 91 (1997) 847-859
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt),rhob1(npt)
      REAL sigmaaa1(npt),sigmabb1(npt),sigmaab1(npt)
      REAL zk(npt),vrhoa(npt),vrhob(npt)
      REAL vsigmaaa(npt),vsigmabb(npt),vsigmaab(npt)
      REAL v2rhoa2(npt),v2rhob2(npt),v2rhoab(npt)
      REAL v2rhoasigmaaa(npt),v2rhoasigmaab(npt)
      REAL v2rhoasigmabb(npt),v2rhobsigmabb(npt)
      REAL v2rhobsigmaab(npt),v2rhobsigmaaa(npt)
      REAL v2sigmaaa2(npt),v2sigmaaaab(npt),v2sigmaaabb(npt)
      REAL v2sigmaab2(npt),v2sigmaabbb(npt),v2sigmabb2(npt)
      parameter(tol=1.0d-20)
      
      if (ideriv.eq.0) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t8 = 0.2913644D-2+0.9474169D-3*sigmabb/(0.6255746320201D7+sigmabb)
      t10 = rhob**2
      t11 = t2**2
      t13 = 1/t11/t10
      t14 = t8**2
      t17 = dlog(sigmabb*t13+dsqrt(1+sigmabb**2*t13**2))
      t18 = t17**2
      t23 = dsqrt(1.D0+9.D0*t14*sigmabb*t13*t18)
      zk(i) = -0.9305257363491D0*t2*rhob*(1.D0+0.1074661302677646D1*t8
     #*sigmabb*t13/t23)
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t8 = 0.2913644D-2+0.9474169D-3*sigmaaa/(0.6255746320201D7+sigmaaa)
      t10 = rhoa**2
      t11 = t2**2
      t13 = 1/t11/t10
      t14 = t8**2
      t17 = dlog(sigmaaa*t13+dsqrt(1+sigmaaa**2*t13**2))
      t18 = t17**2
      t23 = dsqrt(1.D0+9.D0*t14*sigmaaa*t13*t18)
      zk(i) = -0.9305257363491D0*t2*rhoa*(1.D0+0.1074661302677646D1*t8
     #*sigmaaa*t13/t23)
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t10 = 0.2913644D-2+0.9474169D-3*sigmaaa/(0.6255746320201D7
     #+sigmaaa)
      t12 = rhoa**2
      t13 = t4**2
      t15 = 1/t13/t12
      t16 = t10**2
      t19 = dlog(sigmaaa*t15+dsqrt(1+sigmaaa**2*t15**2))
      t20 = t19**2
      t25 = dsqrt(1.D0+9.D0*t16*sigmaaa*t15*t20)
      t33 = rhob**(1.D0/3.D0)
      t39 = 0.2913644D-2+0.9474169D-3*sigmabb/(0.6255746320201D7
     #+sigmabb)
      t41 = rhob**2
      t42 = t33**2
      t44 = 1/t42/t41
      t45 = t39**2
      t48 = dlog(sigmabb*t44+dsqrt(1+sigmabb**2*t44**2))
      t49 = t48**2
      t54 = dsqrt(1.D0+9.D0*t45*sigmabb*t44*t49)
      zk(i) = -0.9305257363491D0*t4*rhoa*(1.D0+0.1074661302677646D1
     #*t10*sigmaaa*t15/t25)-0.9305257363491D0*t33*rhob*(1.D0
     #+0.1074661302677646D1*t39*sigmabb*t44/t54)
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t3 = t2*rhob
      t4 = 0.6255746320201D7+sigmabb
      t5 = 1/t4
      t8 = 0.2913644D-2+0.9474169D-3*sigmabb*t5
      t9 = t8*sigmabb
      t10 = rhob**2
      t11 = t2**2
      t13 = 1/t11/t10
      t14 = t8**2
      t15 = t14*sigmabb
      t17 = dlog(sigmabb*t13+dsqrt(1+sigmabb**2*t13**2))
      t18 = t17**2
      t19 = t13*t18
      t22 = 1.D0+9.D0*t15*t19
      t23 = dsqrt(t22)
      t24 = 1/t23
      t25 = t13*t24
      t28 = 1.D0+0.1074661302677646D1*t9*t25
      zk(i) = -0.9305257363491D0*t3*t28
      vrhoa(i) = 0.D0
      t35 = 1/t11/t10/rhob
      t41 = t13/t23/t22
      t45 = sigmabb**2
      t47 = t10**2
      t54 = 1/t2/t47/rhob
      t57 = dsqrt(1.D0+t45*t54)
      t58 = 1/t57
      vrhob(i) = -0.12407009817988D1*t2*t28-0.9305257363491D0*t3*(
     #-0.2865763473807057D1*t9*t35*t24-0.5373306513388232D0*t9*t41*(
     #-24.D0*t15*t35*t18-48.D0*t14*t45/t2/t47/t10*t17*t58))
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      t70 = t4**2
      t74 = 0.9474169D-3*t5-0.9474169D-3*sigmabb/t70
      vsigmabb(i) = -0.9305257363491D0*t3*(0.1074661302677646D1*t74
     #*sigmabb*t25+0.1074661302677646D1*t8*t13*t24
     #-0.5373306513388232D0*t9*t41*(18.D0*t9*t19*t74+9.D0*t14*t13*t18
     #+18.D0*t15*t54*t17*t58))
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t3 = t2*rhoa
      t4 = 0.6255746320201D7+sigmaaa
      t5 = 1/t4
      t8 = 0.2913644D-2+0.9474169D-3*sigmaaa*t5
      t9 = t8*sigmaaa
      t10 = rhoa**2
      t11 = t2**2
      t13 = 1/t11/t10
      t14 = t8**2
      t15 = t14*sigmaaa
      t17 = dlog(sigmaaa*t13+dsqrt(1+sigmaaa**2*t13**2))
      t18 = t17**2
      t19 = t13*t18
      t22 = 1.D0+9.D0*t15*t19
      t23 = dsqrt(t22)
      t24 = 1/t23
      t25 = t13*t24
      t28 = 1.D0+0.1074661302677646D1*t9*t25
      zk(i) = -0.9305257363491D0*t3*t28
      t35 = 1/t11/t10/rhoa
      t41 = t13/t23/t22
      t45 = sigmaaa**2
      t47 = t10**2
      t54 = 1/t2/t47/rhoa
      t57 = dsqrt(1.D0+t45*t54)
      t58 = 1/t57
      vrhoa(i) = -0.12407009817988D1*t2*t28-0.9305257363491D0*t3*(
     #-0.2865763473807057D1*t9*t35*t24-0.5373306513388232D0*t9*t41*(
     #-24.D0*t15*t35*t18-48.D0*t14*t45/t2/t47/t10*t17*t58))
      vrhob(i) = 0.D0
      t70 = t4**2
      t74 = 0.9474169D-3*t5-0.9474169D-3*sigmaaa/t70
      vsigmaaa(i) = -0.9305257363491D0*t3*(0.1074661302677646D1*t74
     #*sigmaaa*t25+0.1074661302677646D1*t8*t13*t24
     #-0.5373306513388232D0*t9*t41*(18.D0*t9*t19*t74+9.D0*t14*t13*t18
     #+18.D0*t15*t54*t17*t58))
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t5 = t4*rhoa
      t6 = 0.6255746320201D7+sigmaaa
      t7 = 1/t6
      t10 = 0.2913644D-2+0.9474169D-3*sigmaaa*t7
      t11 = t10*sigmaaa
      t12 = rhoa**2
      t13 = t4**2
      t15 = 1/t13/t12
      t16 = t10**2
      t17 = t16*sigmaaa
      t19 = dlog(sigmaaa*t15+dsqrt(1+sigmaaa**2*t15**2))
      t20 = t19**2
      t21 = t15*t20
      t24 = 1.D0+9.D0*t17*t21
      t25 = dsqrt(t24)
      t26 = 1/t25
      t27 = t15*t26
      t30 = 1.D0+0.1074661302677646D1*t11*t27
      t33 = rhob**(1.D0/3.D0)
      t34 = t33*rhob
      t35 = 0.6255746320201D7+sigmabb
      t36 = 1/t35
      t39 = 0.2913644D-2+0.9474169D-3*sigmabb*t36
      t40 = t39*sigmabb
      t41 = rhob**2
      t42 = t33**2
      t44 = 1/t42/t41
      t45 = t39**2
      t46 = t45*sigmabb
      t48 = dlog(sigmabb*t44+dsqrt(1+sigmabb**2*t44**2))
      t49 = t48**2
      t50 = t44*t49
      t53 = 1.D0+9.D0*t46*t50
      t54 = dsqrt(t53)
      t55 = 1/t54
      t56 = t44*t55
      t59 = 1.D0+0.1074661302677646D1*t40*t56
      zk(i) = -0.9305257363491D0*t5*t30-0.9305257363491D0*t34*t59
      t66 = 1/t13/t12/rhoa
      t72 = t15/t25/t24
      t76 = sigmaaa**2
      t78 = t12**2
      t85 = 1/t4/t78/rhoa
      t88 = dsqrt(1.D0+t76*t85)
      t89 = 1/t88
      vrhoa(i) = -0.12407009817988D1*t4*t30-0.9305257363491D0*t5*(
     #-0.2865763473807057D1*t11*t66*t26-0.5373306513388232D0*t11*t72*(
     #-24.D0*t17*t66*t20-48.D0*t16*t76/t4/t78/t12*t19*t89))
      t104 = 1/t42/t41/rhob
      t110 = t44/t54/t53
      t114 = sigmabb**2
      t116 = t41**2
      t123 = 1/t33/t116/rhob
      t126 = dsqrt(1.D0+t114*t123)
      t127 = 1/t126
      vrhob(i) = -0.12407009817988D1*t33*t59-0.9305257363491D0*t34*(
     #-0.2865763473807057D1*t40*t104*t55-0.5373306513388232D0*t40*t110
     #*(-24.D0*t46*t104*t49-48.D0*t45*t114/t33/t116/t41*t48*t127))
      t139 = t6**2
      t143 = 0.9474169D-3*t7-0.9474169D-3*sigmaaa/t139
      vsigmaaa(i) = -0.9305257363491D0*t5*(0.1074661302677646D1*t143
     #*sigmaaa*t27+0.1074661302677646D1*t10*t15*t26
     #-0.5373306513388232D0*t11*t72*(18.D0*t11*t21*t143+9.D0*t16*t15
     #*t20+18.D0*t17*t85*t19*t89))
      vsigmaab(i) = 0.D0
      t168 = t35**2
      t172 = 0.9474169D-3*t36-0.9474169D-3*sigmabb/t168
      vsigmabb(i) = -0.9305257363491D0*t34*(0.1074661302677646D1*t172
     #*sigmabb*t56+0.1074661302677646D1*t39*t44*t55
     #-0.5373306513388232D0*t40*t110*(18.D0*t40*t50*t172+9.D0*t45*t44
     #*t49+18.D0*t46*t123*t48*t127))
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t3 = t2*rhob
      t4 = 0.6255746320201D7+sigmabb
      t5 = 1/t4
      t8 = 0.2913644D-2+0.9474169D-3*sigmabb*t5
      t9 = t8*sigmabb
      t10 = rhob**2
      t11 = t2**2
      t13 = 1/t11/t10
      t14 = t8**2
      t15 = t14*sigmabb
      t17 = dlog(sigmabb*t13+dsqrt(1+sigmabb**2*t13**2))
      t18 = t17**2
      t19 = t13*t18
      t22 = 1.D0+9.D0*t15*t19
      t23 = dsqrt(t22)
      t24 = 1/t23
      t25 = t13*t24
      t28 = 1.D0+0.1074661302677646D1*t9*t25
      zk(i) = -0.9305257363491D0*t3*t28
      vrhoa(i) = 0.D0
      t33 = t10*rhob
      t35 = 1/t11/t33
      t40 = 1/t23/t22
      t41 = t13*t40
      t45 = sigmabb**2
      t46 = t14*t45
      t47 = t10**2
      t54 = 1/t2/t47/rhob
      t56 = 1.D0+t45*t54
      t57 = dsqrt(t56)
      t58 = 1/t57
      t62 = -24.D0*t15*t35*t18-48.D0*t46/t2/t47/t10*t17*t58
      t66 = -0.2865763473807057D1*t9*t35*t24-0.5373306513388232D0*t9
     #*t41*t62
      vrhob(i) = -0.12407009817988D1*t2*t28-0.9305257363491D0*t3*t66
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      t70 = t4**2
      t71 = 1/t70
      t74 = 0.9474169D-3*t5-0.9474169D-3*sigmabb*t71
      t75 = t74*sigmabb
      t78 = t8*t13
      t91 = 18.D0*t9*t19*t74+9.D0*t14*t13*t18+18.D0*t15*t54*t17*t58
      t92 = t41*t91
      vsigmabb(i) = -0.9305257363491D0*t3*(0.1074661302677646D1*t75
     #*t25+0.1074661302677646D1*t78*t24-0.5373306513388232D0*t9*t92)
      v2rhoa2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t104 = 1/t11/t47
      t112 = t22**2
      t115 = t13/t23/t112
      t116 = t62**2
      t132 = t47**2
      t133 = t132*t10
      t135 = 1/t56
      t139 = t45**2
      t146 = 1/t57/t56
      v2rhob2(i) = -0.4135669939329333D0/t11*t28-0.24814019635976D1*t2
     #*t66-0.9305257363491D0*t3*(0.1050779940395921D2*t9*t104*t24
     #+0.2865763473807057D1*t9*t35*t40*t62+0.8059959770082348D0*t9
     #*t115*t116-0.5373306513388232D0*t9*t41*(88.D0*t15*t104*t18
     #+432.D0*t46/t2/t47/t33*t17*t58+128.D0*t14*t45*sigmabb/t133*t135
     #-128.D0*t14*t139/t11/t132/t47*t17*t146))
      v2sigmaaa2(i) = 0.D0
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      t162 = -0.18948338D-2*t71+0.18948338D-2*sigmabb/t70/t4
      t174 = t91**2
      t178 = t74**2
      v2sigmabb2(i) = -0.9305257363491D0*t3*(0.1074661302677646D1*t162
     #*sigmabb*t25+0.2149322605355293D1*t74*t13*t24
     #-0.1074661302677646D1*t75*t92-0.1074661302677646D1*t78*t40*t91
     #+0.8059959770082348D0*t9*t115*t174-0.5373306513388232D0*t9*t41*
     #(18.D0*t178*sigmabb*t19+36.D0*t78*t18*t74+72.D0*t9*t54*t17*t74
     #*t58+18.D0*t9*t19*t162+36.D0*t14*t54*t17*t58+18.D0*t15/t132*t135
     #-18.D0*t46/t11/t133*t17*t146))
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t3 = t2*rhoa
      t4 = 0.6255746320201D7+sigmaaa
      t5 = 1/t4
      t8 = 0.2913644D-2+0.9474169D-3*sigmaaa*t5
      t9 = t8*sigmaaa
      t10 = rhoa**2
      t11 = t2**2
      t13 = 1/t11/t10
      t14 = t8**2
      t15 = t14*sigmaaa
      t17 = dlog(sigmaaa*t13+dsqrt(1+sigmaaa**2*t13**2))
      t18 = t17**2
      t19 = t13*t18
      t22 = 1.D0+9.D0*t15*t19
      t23 = dsqrt(t22)
      t24 = 1/t23
      t25 = t13*t24
      t28 = 1.D0+0.1074661302677646D1*t9*t25
      zk(i) = -0.9305257363491D0*t3*t28
      t33 = t10*rhoa
      t35 = 1/t11/t33
      t40 = 1/t23/t22
      t41 = t13*t40
      t45 = sigmaaa**2
      t46 = t14*t45
      t47 = t10**2
      t54 = 1/t2/t47/rhoa
      t56 = 1.D0+t45*t54
      t57 = dsqrt(t56)
      t58 = 1/t57
      t62 = -24.D0*t15*t35*t18-48.D0*t46/t2/t47/t10*t17*t58
      t66 = -0.2865763473807057D1*t9*t35*t24-0.5373306513388232D0*t9
     #*t41*t62
      vrhoa(i) = -0.12407009817988D1*t2*t28-0.9305257363491D0*t3*t66
      vrhob(i) = 0.D0
      t70 = t4**2
      t71 = 1/t70
      t74 = 0.9474169D-3*t5-0.9474169D-3*sigmaaa*t71
      t75 = t74*sigmaaa
      t78 = t8*t13
      t91 = 18.D0*t9*t19*t74+9.D0*t14*t13*t18+18.D0*t15*t54*t17*t58
      t92 = t41*t91
      vsigmaaa(i) = -0.9305257363491D0*t3*(0.1074661302677646D1*t75
     #*t25+0.1074661302677646D1*t78*t24-0.5373306513388232D0*t9*t92)
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      t104 = 1/t11/t47
      t112 = t22**2
      t115 = t13/t23/t112
      t116 = t62**2
      t132 = t47**2
      t133 = t132*t10
      t135 = 1/t56
      t139 = t45**2
      t146 = 1/t57/t56
      v2rhoa2(i) = -0.4135669939329333D0/t11*t28-0.24814019635976D1*t2
     #*t66-0.9305257363491D0*t3*(0.1050779940395921D2*t9*t104*t24
     #+0.2865763473807057D1*t9*t35*t40*t62+0.8059959770082348D0*t9
     #*t115*t116-0.5373306513388232D0*t9*t41*(88.D0*t15*t104*t18
     #+432.D0*t46/t2/t47/t33*t17*t58+128.D0*t14*t45*sigmaaa/t133*t135
     #-128.D0*t14*t139/t11/t132/t47*t17*t146))
      v2rhob2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t162 = -0.18948338D-2*t71+0.18948338D-2*sigmaaa/t70/t4
      t174 = t91**2
      t178 = t74**2
      v2sigmaaa2(i) = -0.9305257363491D0*t3*(0.1074661302677646D1*t162
     #*sigmaaa*t25+0.2149322605355293D1*t74*t13*t24
     #-0.1074661302677646D1*t75*t92-0.1074661302677646D1*t78*t40*t91
     #+0.8059959770082348D0*t9*t115*t174-0.5373306513388232D0*t9*t41*
     #(18.D0*t178*sigmaaa*t19+36.D0*t78*t18*t74+72.D0*t9*t54*t17*t74
     #*t58+18.D0*t9*t19*t162+36.D0*t14*t54*t17*t58+18.D0*t15/t132*t135
     #-18.D0*t46/t11/t133*t17*t146))
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      v2sigmabb2(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t5 = t4*rhoa
      t6 = 0.6255746320201D7+sigmaaa
      t7 = 1/t6
      t10 = 0.2913644D-2+0.9474169D-3*sigmaaa*t7
      t11 = t10*sigmaaa
      t12 = rhoa**2
      t13 = t4**2
      t15 = 1/t13/t12
      t16 = t10**2
      t17 = t16*sigmaaa
      t19 = dlog(sigmaaa*t15+dsqrt(1+sigmaaa**2*t15**2))
      t20 = t19**2
      t21 = t15*t20
      t24 = 1.D0+9.D0*t17*t21
      t25 = dsqrt(t24)
      t26 = 1/t25
      t27 = t15*t26
      t30 = 1.D0+0.1074661302677646D1*t11*t27
      t33 = rhob**(1.D0/3.D0)
      t34 = t33*rhob
      t35 = 0.6255746320201D7+sigmabb
      t36 = 1/t35
      t39 = 0.2913644D-2+0.9474169D-3*sigmabb*t36
      t40 = t39*sigmabb
      t41 = rhob**2
      t42 = t33**2
      t44 = 1/t42/t41
      t45 = t39**2
      t46 = t45*sigmabb
      t48 = dlog(sigmabb*t44+dsqrt(1+sigmabb**2*t44**2))
      t49 = t48**2
      t50 = t44*t49
      t53 = 1.D0+9.D0*t46*t50
      t54 = dsqrt(t53)
      t55 = 1/t54
      t56 = t44*t55
      t59 = 1.D0+0.1074661302677646D1*t40*t56
      zk(i) = -0.9305257363491D0*t5*t30-0.9305257363491D0*t34*t59
      t64 = t12*rhoa
      t66 = 1/t13/t64
      t67 = t66*t26
      t71 = 1/t25/t24
      t72 = t15*t71
      t73 = t66*t20
      t76 = sigmaaa**2
      t77 = t16*t76
      t78 = t12**2
      t81 = 1/t4/t78/t12
      t85 = 1/t4/t78/rhoa
      t87 = 1.D0+t76*t85
      t88 = dsqrt(t87)
      t89 = 1/t88
      t90 = t81*t19*t89
      t93 = -24.D0*t17*t73-48.D0*t77*t90
      t94 = t72*t93
      t97 = -0.2865763473807057D1*t11*t67-0.5373306513388232D0*t11*t94
      vrhoa(i) = -0.12407009817988D1*t4*t30-0.9305257363491D0*t5*t97
      t102 = t41*rhob
      t104 = 1/t42/t102
      t105 = t104*t55
      t109 = 1/t54/t53
      t110 = t44*t109
      t111 = t104*t49
      t114 = sigmabb**2
      t115 = t45*t114
      t116 = t41**2
      t119 = 1/t33/t116/t41
      t123 = 1/t33/t116/rhob
      t125 = 1.D0+t114*t123
      t126 = dsqrt(t125)
      t127 = 1/t126
      t128 = t119*t48*t127
      t131 = -24.D0*t46*t111-48.D0*t115*t128
      t132 = t110*t131
      t135 = -0.2865763473807057D1*t40*t105-0.5373306513388232D0*t40
     #*t132
      vrhob(i) = -0.12407009817988D1*t33*t59-0.9305257363491D0*t34*t135
      t139 = t6**2
      t140 = 1/t139
      t143 = 0.9474169D-3*t7-0.9474169D-3*sigmaaa*t140
      t144 = t143*sigmaaa
      t147 = t10*t15
      t160 = 18.D0*t11*t21*t143+9.D0*t16*t15*t20+18.D0*t17*t85*t19*t89
      t161 = t72*t160
      t164 = 0.1074661302677646D1*t144*t27+0.1074661302677646D1*t147
     #*t26-0.5373306513388232D0*t11*t161
      vsigmaaa(i) = -0.9305257363491D0*t5*t164
      vsigmaab(i) = 0.D0
      t168 = t35**2
      t169 = 1/t168
      t172 = 0.9474169D-3*t36-0.9474169D-3*sigmabb*t169
      t173 = t172*sigmabb
      t176 = t39*t44
      t189 = 18.D0*t40*t50*t172+9.D0*t45*t44*t49+18.D0*t46*t123*t48*t127
      t190 = t110*t189
      t193 = 0.1074661302677646D1*t173*t56+0.1074661302677646D1*t176
     #*t55-0.5373306513388232D0*t40*t190
      vsigmabb(i) = -0.9305257363491D0*t34*t193
      t202 = 1/t13/t78
      t206 = t66*t71
      t210 = t24**2
      t212 = 1/t25/t210
      t213 = t15*t212
      t214 = t93**2
      t229 = t16*t76*sigmaaa
      t230 = t78**2
      t231 = t230*t12
      t233 = 1/t87
      t237 = t76**2
      t244 = 1/t88/t87
      v2rhoa2(i) = -0.4135669939329333D0/t13*t30-0.24814019635976D1*t4
     #*t97-0.9305257363491D0*t5*(0.1050779940395921D2*t11*t202*t26
     #+0.2865763473807057D1*t11*t206*t93+0.8059959770082348D0*t11*t213
     #*t214-0.5373306513388232D0*t11*t72*(88.D0*t17*t202*t20+432.D0
     #*t77/t4/t78/t64*t19*t89+128.D0*t229/t231*t233-128.D0*t16*t237
     #/t13/t230/t78*t19*t244))
      t261 = 1/t42/t116
      t265 = t104*t109
      t269 = t53**2
      t271 = 1/t54/t269
      t272 = t44*t271
      t273 = t131**2
      t288 = t45*t114*sigmabb
      t289 = t116**2
      t290 = t289*t41
      t292 = 1/t125
      t296 = t114**2
      t303 = 1/t126/t125
      v2rhob2(i) = -0.4135669939329333D0/t42*t59-0.24814019635976D1
     #*t33*t135-0.9305257363491D0*t34*(0.1050779940395921D2*t40*t261
     #*t55+0.2865763473807057D1*t40*t265*t131+0.8059959770082348D0*t40
     #*t272*t273-0.5373306513388232D0*t40*t110*(88.D0*t46*t261*t49
     #+432.D0*t115/t33/t116/t102*t48*t127+128.D0*t288/t290*t292-128.D0
     #*t45*t296/t42/t289/t116*t48*t303))
      v2rhoab(i) = 0.D0
      t344 = t19*t89
      t345 = t344*t143
      v2rhoasigmaaa(i) = -0.12407009817988D1*t4*t164-0.9305257363491D0
     #*t5*(-0.2865763473807057D1*t144*t67-0.2865763473807057D1*t10*t66
     #*t26+0.1432881736903529D1*t11*t206*t160-0.5373306513388232D0
     #*t144*t94-0.5373306513388232D0*t147*t71*t93+0.8059959770082348D0
     #*t11*t15*t212*t93*t160-0.5373306513388232D0*t11*t72*(-48.D0*t11
     #*t73*t143-24.D0*t16*t66*t20-144.D0*t17*t90-96.D0*t10*t76*t81
     #*t345-48.D0*t77/t230/rhoa*t233+48.D0*t229/t13/t230/t64*t19*t244))
      v2rhoasigmaab(i) = 0.D0
      v2rhoasigmabb(i) = 0.D0
      v2rhobsigmaaa(i) = 0.D0
      v2rhobsigmaab(i) = 0.D0
      t397 = t48*t127
      t398 = t397*t172
      v2rhobsigmabb(i) = -0.12407009817988D1*t33*t193
     #-0.9305257363491D0*t34*(-0.2865763473807057D1*t173*t105
     #-0.2865763473807057D1*t39*t104*t55+0.1432881736903529D1*t40*t265
     #*t189-0.5373306513388232D0*t173*t132-0.5373306513388232D0*t176
     #*t109*t131+0.8059959770082348D0*t40*t44*t271*t131*t189
     #-0.5373306513388232D0*t40*t110*(-48.D0*t40*t111*t172-24.D0*t45
     #*t104*t49-144.D0*t46*t128-96.D0*t39*t114*t119*t398-48.D0*t115
     #/t289/rhob*t292+48.D0*t288/t42/t289/t102*t48*t303))
      t425 = -0.18948338D-2*t140+0.18948338D-2*sigmaaa/t139/t6
      t437 = t160**2
      t441 = t143**2
      v2sigmaaa2(i) = -0.9305257363491D0*t5*(0.1074661302677646D1*t425
     #*sigmaaa*t27+0.2149322605355293D1*t143*t15*t26
     #-0.1074661302677646D1*t144*t161-0.1074661302677646D1*t147*t71
     #*t160+0.8059959770082348D0*t11*t213*t437-0.5373306513388232D0
     #*t11*t72*(18.D0*t441*sigmaaa*t21+36.D0*t147*t20*t143+72.D0*t11
     #*t85*t345+18.D0*t11*t21*t425+36.D0*t16*t85*t344+18.D0*t17/t230
     #*t233-18.D0*t77/t13/t231*t19*t244))
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      t479 = -0.18948338D-2*t169+0.18948338D-2*sigmabb/t168/t35
      t491 = t189**2
      t495 = t172**2
      v2sigmabb2(i) = -0.9305257363491D0*t34*(0.1074661302677646D1
     #*t479*sigmabb*t56+0.2149322605355293D1*t172*t44*t55
     #-0.1074661302677646D1*t173*t190-0.1074661302677646D1*t176*t109
     #*t189+0.8059959770082348D0*t40*t272*t491-0.5373306513388232D0
     #*t40*t110*(18.D0*t495*sigmabb*t50+36.D0*t176*t49*t172+72.D0*t40
     #*t123*t398+18.D0*t40*t50*t479+36.D0*t45*t123*t397+18.D0*t46/t289
     #*t292-18.D0*t115/t42/t290*t48*t303))
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      v2rhob2(i) = 0.0d0
      v2rhoab(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2rhoasigmaab(i) = 0.0d0
      v2rhoasigmabb(i) = 0.0d0
      v2rhobsigmaaa(i) = 0.0d0
      v2rhobsigmaab(i) = 0.0d0
      v2rhobsigmabb(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      v2sigmaab2(i) = 0.0d0
      v2sigmabb2(i) = 0.0d0
      v2sigmaaaab(i) = 0.0d0
      v2sigmaaabb(i) = 0.0d0
      v2sigmaabbb(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end
      
      
      subroutine rks_x_ft97b
     & (ideriv,npt,rhoa1,sigmaaa1,
     &  zk,vrhoa,vsigmaaa,
     &  v2rhoa2,v2rhoasigmaaa,v2sigmaaa2)
c
c     M. Filatov, and W. Thiel
c     A new gradient-corrected exchange-correlation density functional
c     Mol. Phys. 91 (1997) 847-859
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt)
      REAL sigmaaa1(npt)
      REAL zk(npt),vrhoa(npt),vsigmaaa(npt)
      REAL v2rhoa2(npt),v2rhoasigmaaa(npt),v2sigmaaa2(npt)
      parameter(tol=1.0d-20)
      
      if(ideriv.eq.0) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t9 = 0.2913644D-2+0.236854225D-3*sigma/(0.6255746320201D7+0.25D0
     #*sigma)
      t11 = rho**2
      t12 = t2**2
      t14 = 1/t12/t11
      t15 = t9**2
      t19 = dlog(0.1587401051968199D1*sigma*t14+dsqrt(1
     #+0.2519842099789745D1*sigma**2*t14**2))
      t20 = t19**2
      t25 = dsqrt(1.D0+0.142866094677138D2*t15*sigma*t14*t20)
      zk(i) = -0.7385587663820224D0*t2*rho*(1.D0+0.1705918482380012D1
     #*t9*sigma*t14/t25)
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t3 = t2*rho
      t5 = 0.6255746320201D7+0.25D0*sigma
      t6 = 1/t5
      t9 = 0.2913644D-2+0.236854225D-3*sigma*t6
      t10 = t9*sigma
      t11 = rho**2
      t12 = t2**2
      t14 = 1/t12/t11
      t15 = t9**2
      t16 = t15*sigma
      t19 = dlog(0.1587401051968199D1*sigma*t14+dsqrt(1
     #+0.2519842099789745D1*sigma**2*t14**2))
      t20 = t19**2
      t21 = t14*t20
      t24 = 1.D0+0.142866094677138D2*t16*t21
      t25 = dsqrt(t24)
      t26 = 1/t25
      t27 = t14*t26
      t30 = 1.D0+0.1705918482380012D1*t10*t27
      zk(i) = -0.7385587663820224D0*t3*t30
      t37 = 1/t12/t11/rho
      t43 = t14/t25/t24
      t47 = sigma**2
      t49 = t11**2
      t56 = 1/t2/t49/rho
      t60 = dsqrt(1.D0+0.2519842099789746D1*t47*t56)
      t61 = 1/t60
      vrhoa(i) = -0.9847450218426965D0*t2*t30-0.3692793831910112D0*t3*
     #(-0.9098231906026728D1*t10*t37*t26-0.8529592411900058D0*t10*t43*
     #(-0.7619525049447357D2*t16*t37*t20-0.2419048415798156D3*t15*t47
     #/t2/t49/t11*t19*t61))
      t73 = t5**2
      t77 = 0.9474169D-3*t6-0.236854225D-3*sigma/t73
      vsigmaaa(i) = -0.7385587663820224D0*t3*(0.1705918482380012D1*t77
     #*sigma*t27+0.6823673929520046D1*t9*t14*t26-0.8529592411900058D0
     #*t10*t43*(0.2857321893542759D2*t10*t21*t77+0.5714643787085518D2
     #*t15*t14*t20+0.1814286311848617D3*t16*t56*t19*t61))
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t3 = t2*rho
      t5 = 0.6255746320201D7+0.25D0*sigma
      t6 = 1/t5
      t9 = 0.2913644D-2+0.236854225D-3*sigma*t6
      t10 = t9*sigma
      t11 = rho**2
      t12 = t2**2
      t14 = 1/t12/t11
      t15 = t9**2
      t16 = t15*sigma
      t19 = dlog(0.1587401051968199D1*sigma*t14+dsqrt(1
     #+0.2519842099789745D1*sigma**2*t14**2))
      t20 = t19**2
      t21 = t14*t20
      t24 = 1.D0+0.142866094677138D2*t16*t21
      t25 = dsqrt(t24)
      t26 = 1/t25
      t27 = t14*t26
      t30 = 1.D0+0.1705918482380012D1*t10*t27
      zk(i) = -0.7385587663820224D0*t3*t30
      t35 = t11*rho
      t37 = 1/t12/t35
      t38 = t37*t26
      t42 = 1/t25/t24
      t43 = t14*t42
      t44 = t37*t20
      t47 = sigma**2
      t48 = t15*t47
      t49 = t11**2
      t52 = 1/t2/t49/t11
      t56 = 1/t2/t49/rho
      t59 = 1.D0+0.2519842099789746D1*t47*t56
      t60 = dsqrt(t59)
      t61 = 1/t60
      t62 = t52*t19*t61
      t65 = -0.7619525049447357D2*t16*t44-0.2419048415798156D3*t48*t62
      t66 = t43*t65
      t69 = -0.9098231906026728D1*t10*t38-0.8529592411900058D0*t10*t66
      vrhoa(i) = -0.9847450218426965D0*t2*t30-0.3692793831910112D0*t3
     #*t69
      t73 = t5**2
      t74 = 1/t73
      t77 = 0.9474169D-3*t6-0.236854225D-3*sigma*t74
      t78 = t77*sigma
      t81 = t9*t14
      t94 = 0.2857321893542759D2*t10*t21*t77+0.5714643787085518D2*t15
     #*t14*t20+0.1814286311848617D3*t16*t56*t19*t61
      t95 = t43*t94
      t98 = 0.1705918482380012D1*t78*t27+0.6823673929520046D1*t81*t26
     #-0.8529592411900058D0*t10*t95
      vsigmaaa(i) = -0.7385587663820224D0*t3*t98
      t107 = 1/t12/t49
      t111 = t37*t42
      t115 = t24**2
      t117 = 1/t25/t115
      t118 = t14*t117
      t119 = t65**2
      t134 = t15*t47*sigma
      t135 = t49**2
      t136 = t135*t11
      t138 = 1/t59
      t142 = t47**2
      t149 = 1/t60/t59
      v2rhoa2(i) = -0.6564966812284644D0/t12*t30-0.1969490043685393D1
     #*t2*t69-0.3692793831910112D0*t3*(0.6672036731086267D2*t10*t107
     #*t26+0.9098231906026728D1*t10*t111*t65+0.1279438861785009D1*t10
     #*t118*t119-0.8529592411900058D0*t10*t43*(0.5587651702928062D3
     #*t16*t107*t20+0.4354287148436682D4*t48/t2/t49/t35*t19*t61
     #+2048.D0*t134/t136*t138-0.3250997354430873D4*t15*t142/t12/t135
     #/t49*t19*t149))
      t190 = t19*t61
      t191 = t190*t77
      v2rhoasigmaaa(i) = -0.9847450218426965D0*t2*t98
     #-0.3692793831910112D0*t3*(-0.9098231906026728D1*t78*t38
     #-0.3639292762410691D2*t9*t37*t26+0.4549115953013364D1*t10*t111
     #*t94-0.8529592411900058D0*t78*t66-0.3411836964760023D1*t81*t42
     #*t65+0.1279438861785009D1*t10*t14*t117*t65*t94
     #-0.8529592411900058D0*t10*t43*(-0.1523905009889471D3*t10*t44*t77
     #-0.3047810019778943D3*t15*t37*t20-0.2902858098957788D4*t16*t62
     #-0.4838096831596313D3*t9*t47*t52*t191-1536.D0*t48/t135/rho*t138
     #+0.2438248015823154D4*t134/t12/t135/t35*t19*t149))
      t218 = -0.18948338D-2*t74+0.47370845D-3*sigma/t73/t5
      t230 = t94**2
      t234 = t77**2
      v2sigmaaa2(i) = -0.7385587663820224D0*t3*(0.1705918482380012D1
     #*t218*sigma*t27+0.1364734785904009D2*t77*t14*t26
     #-0.1705918482380012D1*t78*t95-0.6823673929520046D1*t81*t42*t94
     #+0.1279438861785009D1*t10*t118*t230-0.8529592411900058D0*t10*t43
     #*(0.2857321893542759D2*t234*sigma*t21+0.2285857514834207D3*t81
     #*t20*t77+0.7257145247394469D3*t10*t56*t191+0.2857321893542759D2
     #*t10*t21*t218+0.1451429049478894D4*t15*t56*t190+1152.D0*t16/t135
     #*t138-0.1828686011867366D4*t48/t12/t136*t19*t149))
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end

c:X_FT97Bsubrend
_ENDIF
_IF(ccpdft,all,x_ft97a)
c:X_FT97Asubrstart

c    Generated: Thu Jan 30 10:42:41 GMT 2003

      subroutine uks_x_ft97a
     & (ideriv,npt,rhoa1,rhob1,sigmaaa1,sigmabb1,sigmaab1,
     &  zk,vrhoa,vrhob,vsigmaaa,vsigmabb,vsigmaab,
     &  v2rhoa2,v2rhob2,v2rhoab,
     &  v2rhoasigmaaa,v2rhoasigmaab,v2rhoasigmabb,
     &  v2rhobsigmabb,v2rhobsigmaab,v2rhobsigmaaa,
     &  v2sigmaaa2,v2sigmaaaab,v2sigmaaabb,
     &  v2sigmaab2,v2sigmaabbb,v2sigmabb2)
c
c     M. Filatov, and W. Thiel
c     A new gradient-corrected exchange-correlation density functional
c     Mol. Phys. 91 (1997) 847-859
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt),rhob1(npt)
      REAL sigmaaa1(npt),sigmabb1(npt),sigmaab1(npt)
      REAL zk(npt),vrhoa(npt),vrhob(npt)
      REAL vsigmaaa(npt),vsigmabb(npt),vsigmaab(npt)
      REAL v2rhoa2(npt),v2rhob2(npt),v2rhoab(npt)
      REAL v2rhoasigmaaa(npt),v2rhoasigmaab(npt)
      REAL v2rhoasigmabb(npt),v2rhobsigmabb(npt)
      REAL v2rhobsigmaab(npt),v2rhobsigmaaa(npt)
      REAL v2sigmaaa2(npt),v2sigmaaaab(npt),v2sigmaaabb(npt)
      REAL v2sigmaab2(npt),v2sigmaabbb(npt),v2sigmabb2(npt)
      parameter(tol=1.0d-20)
      
      if (ideriv.eq.0) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t4 = rhob**2
      t5 = t2**2
      t8 = sigmabb/t5/t4
      t9 = dlog(t8+dsqrt(1+t8**2))
      t10 = t9**2
      t14 = dsqrt(1.D0+0.772641D-4*t8*t10)
      zk(i) = -0.9305257363491D0*t2*rhob*(1.D0+0.3148757616845504D-2
     #*t8/t14)
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t4 = rhoa**2
      t5 = t2**2
      t8 = sigmaaa/t5/t4
      t9 = dlog(t8+dsqrt(1+t8**2))
      t10 = t9**2
      t14 = dsqrt(1.D0+0.772641D-4*t8*t10)
      zk(i) = -0.9305257363491D0*t2*rhoa*(1.D0+0.3148757616845504D-2
     #*t8/t14)
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t6 = rhoa**2
      t7 = t4**2
      t10 = sigmaaa/t7/t6
      t11 = dlog(t10+dsqrt(1+t10**2))
      t12 = t11**2
      t16 = dsqrt(1.D0+0.772641D-4*t10*t12)
      t23 = rhob**(1.D0/3.D0)
      t25 = rhob**2
      t26 = t23**2
      t29 = sigmabb/t26/t25
      t30 = dlog(t29+dsqrt(1+t29**2))
      t31 = t30**2
      t35 = dsqrt(1.D0+0.772641D-4*t29*t31)
      zk(i) = -0.9305257363491D0*t4*rhoa*(1.D0+0.3148757616845504D-2
     #*t10/t16)-0.9305257363491D0*t23*rhob*(1.D0+0.3148757616845504D-2
     #*t29/t35)
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t3 = t2*rhob
      t4 = rhob**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigmabb*t7
      t9 = dlog(t8+dsqrt(1+t8**2))
      t10 = t9**2
      t13 = 1.D0+0.772641D-4*t8*t10
      t14 = dsqrt(t13)
      t15 = 1/t14
      t18 = 1.D0+0.3148757616845504D-2*t8*t15
      zk(i) = -0.9305257363491D0*t3*t18
      vrhoa(i) = 0.D0
      t26 = sigmabb/t5/t4/rhob
      t30 = 1/t14/t13
      t33 = sigmabb**2
      t34 = t4**2
      t41 = 1/t2/t34/rhob
      t44 = dsqrt(1.D0+t33*t41)
      t46 = t9/t44
      vrhob(i) = -0.12407009817988D1*t2*t18-0.9305257363491D0*t3*(
     #-0.8396686978254677D-2*t26*t15-0.1574378808422752D-2*t8*t30*(
     #-0.2060376D-3*t26*t10-0.4120752D-3*t33/t2/t34/t4*t46))
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      vsigmabb(i) = -0.9305257363491D0*t3*(0.3148757616845504D-2*t7
     #*t15-0.1574378808422752D-2*t8*t30*(0.772641D-4*t7*t10
     #+0.1545282D-3*sigmabb*t41*t46))
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t3 = t2*rhoa
      t4 = rhoa**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigmaaa*t7
      t9 = dlog(t8+dsqrt(1+t8**2))
      t10 = t9**2
      t13 = 1.D0+0.772641D-4*t8*t10
      t14 = dsqrt(t13)
      t15 = 1/t14
      t18 = 1.D0+0.3148757616845504D-2*t8*t15
      zk(i) = -0.9305257363491D0*t3*t18
      t26 = sigmaaa/t5/t4/rhoa
      t30 = 1/t14/t13
      t33 = sigmaaa**2
      t34 = t4**2
      t41 = 1/t2/t34/rhoa
      t44 = dsqrt(1.D0+t33*t41)
      t46 = t9/t44
      vrhoa(i) = -0.12407009817988D1*t2*t18-0.9305257363491D0*t3*(
     #-0.8396686978254677D-2*t26*t15-0.1574378808422752D-2*t8*t30*(
     #-0.2060376D-3*t26*t10-0.4120752D-3*t33/t2/t34/t4*t46))
      vrhob(i) = 0.D0
      vsigmaaa(i) = -0.9305257363491D0*t3*(0.3148757616845504D-2*t7
     #*t15-0.1574378808422752D-2*t8*t30*(0.772641D-4*t7*t10
     #+0.1545282D-3*sigmaaa*t41*t46))
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t5 = t4*rhoa
      t6 = rhoa**2
      t7 = t4**2
      t9 = 1/t7/t6
      t10 = sigmaaa*t9
      t11 = dlog(t10+dsqrt(1+t10**2))
      t12 = t11**2
      t15 = 1.D0+0.772641D-4*t10*t12
      t16 = dsqrt(t15)
      t17 = 1/t16
      t20 = 1.D0+0.3148757616845504D-2*t10*t17
      t23 = rhob**(1.D0/3.D0)
      t24 = t23*rhob
      t25 = rhob**2
      t26 = t23**2
      t28 = 1/t26/t25
      t29 = sigmabb*t28
      t30 = dlog(t29+dsqrt(1+t29**2))
      t31 = t30**2
      t34 = 1.D0+0.772641D-4*t29*t31
      t35 = dsqrt(t34)
      t36 = 1/t35
      t39 = 1.D0+0.3148757616845504D-2*t29*t36
      zk(i) = -0.9305257363491D0*t5*t20-0.9305257363491D0*t24*t39
      t47 = sigmaaa/t7/t6/rhoa
      t51 = 1/t16/t15
      t54 = sigmaaa**2
      t55 = t6**2
      t62 = 1/t4/t55/rhoa
      t65 = dsqrt(1.D0+t54*t62)
      t67 = t11/t65
      vrhoa(i) = -0.12407009817988D1*t4*t20-0.9305257363491D0*t5*(
     #-0.8396686978254677D-2*t47*t17-0.1574378808422752D-2*t10*t51*(
     #-0.2060376D-3*t47*t12-0.4120752D-3*t54/t4/t55/t6*t67))
      t82 = sigmabb/t26/t25/rhob
      t86 = 1/t35/t34
      t89 = sigmabb**2
      t90 = t25**2
      t97 = 1/t23/t90/rhob
      t100 = dsqrt(1.D0+t89*t97)
      t102 = t30/t100
      vrhob(i) = -0.12407009817988D1*t23*t39-0.9305257363491D0*t24*(
     #-0.8396686978254677D-2*t82*t36-0.1574378808422752D-2*t29*t86*(
     #-0.2060376D-3*t82*t31-0.4120752D-3*t89/t23/t90/t25*t102))
      vsigmaaa(i) = -0.9305257363491D0*t5*(0.3148757616845504D-2*t9
     #*t17-0.1574378808422752D-2*t10*t51*(0.772641D-4*t9*t12
     #+0.1545282D-3*sigmaaa*t62*t67))
      vsigmaab(i) = 0.D0
      vsigmabb(i) = -0.9305257363491D0*t24*(0.3148757616845504D-2*t28
     #*t36-0.1574378808422752D-2*t29*t86*(0.772641D-4*t28*t31
     #+0.1545282D-3*sigmabb*t97*t102))
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t3 = t2*rhob
      t4 = rhob**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigmabb*t7
      t9 = dlog(t8+dsqrt(1+t8**2))
      t10 = t9**2
      t13 = 1.D0+0.772641D-4*t8*t10
      t14 = dsqrt(t13)
      t15 = 1/t14
      t18 = 1.D0+0.3148757616845504D-2*t8*t15
      zk(i) = -0.9305257363491D0*t3*t18
      vrhoa(i) = 0.D0
      t23 = t4*rhob
      t26 = sigmabb/t5/t23
      t30 = 1/t14/t13
      t33 = sigmabb**2
      t34 = t4**2
      t41 = 1/t2/t34/rhob
      t43 = 1.D0+t33*t41
      t44 = dsqrt(t43)
      t45 = 1/t44
      t46 = t9*t45
      t49 = -0.2060376D-3*t26*t10-0.4120752D-3*t33/t2/t34/t4*t46
      t50 = t30*t49
      t53 = -0.8396686978254677D-2*t26*t15-0.1574378808422752D-2*t8*t50
      vrhob(i) = -0.12407009817988D1*t2*t18-0.9305257363491D0*t3*t53
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      t63 = 0.772641D-4*t7*t10+0.1545282D-3*sigmabb*t41*t46
      vsigmabb(i) = -0.9305257363491D0*t3*(0.3148757616845504D-2*t7
     #*t15-0.1574378808422752D-2*t8*t30*t63)
      v2rhoa2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t77 = sigmabb/t5/t34
      t82 = t13**2
      t84 = 1/t14/t82
      t85 = t49**2
      t98 = t34**2
      t99 = t98*t4
      t102 = 1/t43
      t105 = t33**2
      t112 = t9/t44/t43
      v2rhob2(i) = -0.4135669939329333D0/t5*t18-0.24814019635976D1*t2
     #*t53-0.9305257363491D0*t3*(0.3078785225360048D-1*t77*t15
     #+0.8396686978254677D-2*t26*t50+0.2361568212634128D-2*t8*t84*t85
     #-0.1574378808422752D-2*t8*t30*(0.7554712D-3*t77*t10
     #+0.37086768D-2*t33/t2/t34/t23*t46+0.10988672D-2*t33*sigmabb/t99
     #*t102-0.10988672D-2*t105/t5/t98/t34*t112))
      v2sigmaaa2(i) = 0.D0
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      t125 = t63**2
      v2sigmabb2(i) = -0.9305257363491D0*t3*(-0.3148757616845504D-2*t7
     #*t30*t63+0.2361568212634128D-2*t8*t84*t125-0.1574378808422752D-2
     #*t8*t30*(0.3090564D-3*t41*t9*t45+0.1545282D-3*sigmabb/t98*t102
     #-0.1545282D-3*t33/t5/t99*t112))
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t3 = t2*rhoa
      t4 = rhoa**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigmaaa*t7
      t9 = dlog(t8+dsqrt(1+t8**2))
      t10 = t9**2
      t13 = 1.D0+0.772641D-4*t8*t10
      t14 = dsqrt(t13)
      t15 = 1/t14
      t18 = 1.D0+0.3148757616845504D-2*t8*t15
      zk(i) = -0.9305257363491D0*t3*t18
      t23 = t4*rhoa
      t26 = sigmaaa/t5/t23
      t30 = 1/t14/t13
      t33 = sigmaaa**2
      t34 = t4**2
      t41 = 1/t2/t34/rhoa
      t43 = 1.D0+t33*t41
      t44 = dsqrt(t43)
      t45 = 1/t44
      t46 = t9*t45
      t49 = -0.2060376D-3*t26*t10-0.4120752D-3*t33/t2/t34/t4*t46
      t50 = t30*t49
      t53 = -0.8396686978254677D-2*t26*t15-0.1574378808422752D-2*t8*t50
      vrhoa(i) = -0.12407009817988D1*t2*t18-0.9305257363491D0*t3*t53
      vrhob(i) = 0.D0
      t63 = 0.772641D-4*t7*t10+0.1545282D-3*sigmaaa*t41*t46
      vsigmaaa(i) = -0.9305257363491D0*t3*(0.3148757616845504D-2*t7
     #*t15-0.1574378808422752D-2*t8*t30*t63)
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      t77 = sigmaaa/t5/t34
      t82 = t13**2
      t84 = 1/t14/t82
      t85 = t49**2
      t98 = t34**2
      t99 = t98*t4
      t102 = 1/t43
      t105 = t33**2
      t112 = t9/t44/t43
      v2rhoa2(i) = -0.4135669939329333D0/t5*t18-0.24814019635976D1*t2
     #*t53-0.9305257363491D0*t3*(0.3078785225360048D-1*t77*t15
     #+0.8396686978254677D-2*t26*t50+0.2361568212634128D-2*t8*t84*t85
     #-0.1574378808422752D-2*t8*t30*(0.7554712D-3*t77*t10
     #+0.37086768D-2*t33/t2/t34/t23*t46+0.10988672D-2*t33*sigmaaa/t99
     #*t102-0.10988672D-2*t105/t5/t98/t34*t112))
      v2rhob2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t125 = t63**2
      v2sigmaaa2(i) = -0.9305257363491D0*t3*(-0.3148757616845504D-2*t7
     #*t30*t63+0.2361568212634128D-2*t8*t84*t125-0.1574378808422752D-2
     #*t8*t30*(0.3090564D-3*t41*t9*t45+0.1545282D-3*sigmaaa/t98*t102
     #-0.1545282D-3*t33/t5/t99*t112))
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      v2sigmabb2(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t5 = t4*rhoa
      t6 = rhoa**2
      t7 = t4**2
      t9 = 1/t7/t6
      t10 = sigmaaa*t9
      t11 = dlog(t10+dsqrt(1+t10**2))
      t12 = t11**2
      t15 = 1.D0+0.772641D-4*t10*t12
      t16 = dsqrt(t15)
      t17 = 1/t16
      t20 = 1.D0+0.3148757616845504D-2*t10*t17
      t23 = rhob**(1.D0/3.D0)
      t24 = t23*rhob
      t25 = rhob**2
      t26 = t23**2
      t28 = 1/t26/t25
      t29 = sigmabb*t28
      t30 = dlog(t29+dsqrt(1+t29**2))
      t31 = t30**2
      t34 = 1.D0+0.772641D-4*t29*t31
      t35 = dsqrt(t34)
      t36 = 1/t35
      t39 = 1.D0+0.3148757616845504D-2*t29*t36
      zk(i) = -0.9305257363491D0*t5*t20-0.9305257363491D0*t24*t39
      t44 = t6*rhoa
      t46 = 1/t7/t44
      t47 = sigmaaa*t46
      t51 = 1/t16/t15
      t54 = sigmaaa**2
      t55 = t6**2
      t58 = 1/t4/t55/t6
      t62 = 1/t4/t55/rhoa
      t64 = 1.D0+t54*t62
      t65 = dsqrt(t64)
      t66 = 1/t65
      t67 = t11*t66
      t70 = -0.2060376D-3*t47*t12-0.4120752D-3*t54*t58*t67
      t71 = t51*t70
      t74 = -0.8396686978254677D-2*t47*t17-0.1574378808422752D-2*t10*t71
      vrhoa(i) = -0.12407009817988D1*t4*t20-0.9305257363491D0*t5*t74
      t79 = t25*rhob
      t81 = 1/t26/t79
      t82 = sigmabb*t81
      t86 = 1/t35/t34
      t89 = sigmabb**2
      t90 = t25**2
      t93 = 1/t23/t90/t25
      t97 = 1/t23/t90/rhob
      t99 = 1.D0+t89*t97
      t100 = dsqrt(t99)
      t101 = 1/t100
      t102 = t30*t101
      t105 = -0.2060376D-3*t82*t31-0.4120752D-3*t89*t93*t102
      t106 = t86*t105
      t109 = -0.8396686978254677D-2*t82*t36-0.1574378808422752D-2*t29
     #*t106
      vrhob(i) = -0.12407009817988D1*t23*t39-0.9305257363491D0*t24*t109
      t119 = 0.772641D-4*t9*t12+0.1545282D-3*sigmaaa*t62*t67
      t120 = t51*t119
      t123 = 0.3148757616845504D-2*t9*t17-0.1574378808422752D-2*t10*t120
      vsigmaaa(i) = -0.9305257363491D0*t5*t123
      vsigmaab(i) = 0.D0
      t133 = 0.772641D-4*t28*t31+0.1545282D-3*sigmabb*t97*t102
      t134 = t86*t133
      t137 = 0.3148757616845504D-2*t28*t36-0.1574378808422752D-2*t29
     #*t134
      vsigmabb(i) = -0.9305257363491D0*t24*t137
      t147 = sigmaaa/t7/t55
      t152 = t15**2
      t154 = 1/t16/t152
      t155 = t70**2
      t167 = t54*sigmaaa
      t168 = t55**2
      t169 = t168*t6
      t172 = 1/t64
      t175 = t54**2
      t182 = t11/t65/t64
      v2rhoa2(i) = -0.4135669939329333D0/t7*t20-0.24814019635976D1*t4
     #*t74-0.9305257363491D0*t5*(0.3078785225360048D-1*t147*t17
     #+0.8396686978254677D-2*t47*t71+0.2361568212634128D-2*t10*t154
     #*t155-0.1574378808422752D-2*t10*t51*(0.7554712D-3*t147*t12
     #+0.37086768D-2*t54/t4/t55/t44*t67+0.10988672D-2*t167/t169*t172
     #-0.10988672D-2*t175/t7/t168/t55*t182))
      t199 = sigmabb/t26/t90
      t204 = t34**2
      t206 = 1/t35/t204
      t207 = t105**2
      t219 = t89*sigmabb
      t220 = t90**2
      t221 = t220*t25
      t224 = 1/t99
      t227 = t89**2
      t234 = t30/t100/t99
      v2rhob2(i) = -0.4135669939329333D0/t26*t39-0.24814019635976D1
     #*t23*t109-0.9305257363491D0*t24*(0.3078785225360048D-1*t199*t36
     #+0.8396686978254677D-2*t82*t106+0.2361568212634128D-2*t29*t206
     #*t207-0.1574378808422752D-2*t29*t86*(0.7554712D-3*t199*t31
     #+0.37086768D-2*t89/t23/t90/t79*t102+0.10988672D-2*t219/t221*t224
     #-0.10988672D-2*t227/t26/t220/t90*t234))
      v2rhoab(i) = 0.D0
      t250 = t9*t51
      v2rhoasigmaaa(i) = -0.12407009817988D1*t4*t123-0.9305257363491D0
     #*t5*(-0.8396686978254677D-2*t46*t17+0.4198343489127339D-2*t47
     #*t120-0.1574378808422752D-2*t250*t70+0.2361568212634128D-2*t10
     #*t154*t70*t119-0.1574378808422752D-2*t10*t51*(-0.2060376D-3*t46
     #*t12-0.12362256D-2*sigmaaa*t58*t67-0.4120752D-3*t54/t168/rhoa
     #*t172+0.4120752D-3*t167/t7/t168/t44*t182))
      v2rhoasigmaab(i) = 0.D0
      v2rhoasigmabb(i) = 0.D0
      v2rhobsigmaaa(i) = 0.D0
      v2rhobsigmaab(i) = 0.D0
      t286 = t28*t86
      v2rhobsigmabb(i) = -0.12407009817988D1*t23*t137
     #-0.9305257363491D0*t24*(-0.8396686978254677D-2*t81*t36
     #+0.4198343489127339D-2*t82*t134-0.1574378808422752D-2*t286*t105
     #+0.2361568212634128D-2*t29*t206*t105*t133-0.1574378808422752D-2
     #*t29*t86*(-0.2060376D-3*t81*t31-0.12362256D-2*sigmabb*t93*t102
     #-0.4120752D-3*t89/t220/rhob*t224+0.4120752D-3*t219/t26/t220/t79
     #*t234))
      t318 = t119**2
      v2sigmaaa2(i) = -0.9305257363491D0*t5*(-0.3148757616845504D-2
     #*t250*t119+0.2361568212634128D-2*t10*t154*t318
     #-0.1574378808422752D-2*t10*t51*(0.3090564D-3*t62*t11*t66
     #+0.1545282D-3*sigmaaa/t168*t172-0.1545282D-3*t54/t7/t169*t182))
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      t343 = t133**2
      v2sigmabb2(i) = -0.9305257363491D0*t24*(-0.3148757616845504D-2
     #*t286*t133+0.2361568212634128D-2*t29*t206*t343
     #-0.1574378808422752D-2*t29*t86*(0.3090564D-3*t97*t30*t101
     #+0.1545282D-3*sigmabb/t220*t224-0.1545282D-3*t89/t26/t221*t234))
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      v2rhob2(i) = 0.0d0
      v2rhoab(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2rhoasigmaab(i) = 0.0d0
      v2rhoasigmabb(i) = 0.0d0
      v2rhobsigmaaa(i) = 0.0d0
      v2rhobsigmaab(i) = 0.0d0
      v2rhobsigmabb(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      v2sigmaab2(i) = 0.0d0
      v2sigmabb2(i) = 0.0d0
      v2sigmaaaab(i) = 0.0d0
      v2sigmaaabb(i) = 0.0d0
      v2sigmaabbb(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end
      
      
      subroutine rks_x_ft97a
     & (ideriv,npt,rhoa1,sigmaaa1,
     &  zk,vrhoa,vsigmaaa,
     &  v2rhoa2,v2rhoasigmaaa,v2sigmaaa2)
c
c     M. Filatov, and W. Thiel
c     A new gradient-corrected exchange-correlation density functional
c     Mol. Phys. 91 (1997) 847-859
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt)
      REAL sigmaaa1(npt)
      REAL zk(npt),vrhoa(npt),vsigmaaa(npt)
      REAL v2rhoa2(npt),v2rhoasigmaaa(npt),v2sigmaaa2(npt)
      parameter(tol=1.0d-20)
      
      if(ideriv.eq.0) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t4 = rho**2
      t5 = t2**2
      t8 = sigma/t5/t4
      t10 = dlog(0.1587401051968199D1*t8+dsqrt(1+0.2519842099789745D1
     #*t8**2))
      t11 = t10**2
      t15 = dsqrt(1.D0+0.1226491136193762D-3*t8*t11)
      zk(i) = -0.7385587663820224D0*t2*rho*(1.D0+0.4998341153373434D-2
     #*t8/t15)
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t3 = t2*rho
      t4 = rho**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigma*t7
      t10 = dlog(0.1587401051968199D1*t8+dsqrt(1+0.2519842099789745D1
     #*t8**2))
      t11 = t10**2
      t14 = 1.D0+0.1226491136193762D-3*t8*t11
      t15 = dsqrt(t14)
      t16 = 1/t15
      t19 = 1.D0+0.4998341153373434D-2*t8*t16
      zk(i) = -0.7385587663820224D0*t3*t19
      t27 = sigma/t5/t4/rho
      t31 = 1/t15/t14
      t34 = sigma**2
      t35 = t4**2
      t42 = 1/t2/t35/rho
      t46 = dsqrt(1.D0+0.2519842099789746D1*t34*t42)
      t48 = t10/t46
      vrhoa(i) = -0.9847450218426965D0*t2*t19-0.3692793831910112D0*t3*
     #(-0.2665781948465831D-1*t27*t16-0.2499170576686717D-2*t8*t31*(
     #-0.6541286059700062D-3*t27*t11-0.2076728874478559D-2*t34/t2/t35
     #/t4*t48))
      vsigmaaa(i) = -0.7385587663820224D0*t3*(0.1999336461349374D-1*t7
     #*t16-0.2499170576686717D-2*t8*t31*(0.4905964544775046D-3*t7*t11
     #+0.155754665585892D-2*sigma*t42*t48))
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t3 = t2*rho
      t4 = rho**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigma*t7
      t10 = dlog(0.1587401051968199D1*t8+dsqrt(1+0.2519842099789745D1
     #*t8**2))
      t11 = t10**2
      t14 = 1.D0+0.1226491136193762D-3*t8*t11
      t15 = dsqrt(t14)
      t16 = 1/t15
      t19 = 1.D0+0.4998341153373434D-2*t8*t16
      zk(i) = -0.7385587663820224D0*t3*t19
      t24 = t4*rho
      t26 = 1/t5/t24
      t27 = sigma*t26
      t31 = 1/t15/t14
      t34 = sigma**2
      t35 = t4**2
      t38 = 1/t2/t35/t4
      t42 = 1/t2/t35/rho
      t45 = 1.D0+0.2519842099789746D1*t34*t42
      t46 = dsqrt(t45)
      t47 = 1/t46
      t48 = t10*t47
      t51 = -0.6541286059700062D-3*t27*t11-0.2076728874478559D-2*t34
     #*t38*t48
      t52 = t31*t51
      t55 = -0.2665781948465831D-1*t27*t16-0.2499170576686717D-2*t8*t52
      vrhoa(i) = -0.9847450218426965D0*t2*t19-0.3692793831910112D0*t3
     #*t55
      t65 = 0.4905964544775046D-3*t7*t11+0.155754665585892D-2*sigma
     #*t42*t48
      t66 = t31*t65
      t69 = 0.1999336461349374D-1*t7*t16-0.2499170576686717D-2*t8*t66
      vsigmaaa(i) = -0.7385587663820224D0*t3*t69
      t79 = sigma/t5/t35
      t84 = t14**2
      t86 = 1/t15/t84
      t87 = t51**2
      t99 = t34*sigma
      t100 = t35**2
      t101 = t100*t4
      t104 = 1/t45
      t107 = t34**2
      t114 = t10/t46/t45
      v2rhoa2(i) = -0.6564966812284644D0/t5*t19-0.1969490043685393D1
     #*t2*t55-0.3692793831910112D0*t3*(0.1954906762208276D0*t79*t16
     #+0.2665781948465831D-1*t27*t52+0.3748755865030075D-2*t8*t86*t87
     #-0.2499170576686717D-2*t8*t31*(0.4796943110446712D-2*t79*t11
     #+0.3738111974061407D-1*t34/t2/t35/t24*t48+0.175818752D-1*t99
     #/t101*t104-0.279094871880536D-1*t107/t5/t100/t35*t114))
      t130 = t7*t31
      v2rhoasigmaaa(i) = -0.9847450218426965D0*t2*t69
     #-0.3692793831910112D0*t3*(-0.1066312779386333D0*t26*t16
     #+0.1332890974232916D-1*t27*t66-0.9996682306746868D-2*t130*t51
     #+0.3748755865030075D-2*t8*t86*t51*t65-0.2499170576686717D-2*t8
     #*t31*(-0.2616514423880025D-2*t26*t11-0.2492074649374271D-1*sigma
     #*t38*t48-0.131864064D-1*t34/t100/rho*t104+0.209321153910402D-1
     #*t99/t5/t100/t24*t114))
      t162 = t65**2
      v2sigmaaa2(i) = -0.7385587663820224D0*t3*(-0.1999336461349374D-1
     #*t130*t65+0.3748755865030075D-2*t8*t86*t162
     #-0.2499170576686717D-2*t8*t31*(0.1246037324687136D-1*t42*t10*t47
     #+0.98898048D-2*sigma/t100*t104-0.1569908654328015D-1*t34/t5/t101
     #*t114))
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end

c:X_FT97Asubrend
_ENDIF
_IF(ccpdft,all,c_pw92)
c:C_PW92subrstart

c    Generated: Mon Oct 18 16:28:06 BST 2004

      subroutine uks_c_pw92
     & (ideriv,npt,rhoa1,rhob1,sigmaaa1,sigmabb1,sigmaab1,
     &  zk,vrhoa,vrhob,vsigmaaa,vsigmabb,vsigmaab,
     &  v2rhoa2,v2rhob2,v2rhoab,
     &  v2rhoasigmaaa,v2rhoasigmaab,v2rhoasigmabb,
     &  v2rhobsigmabb,v2rhobsigmaab,v2rhobsigmaaa,
     &  v2sigmaaa2,v2sigmaaaab,v2sigmaaabb,
     &  v2sigmaab2,v2sigmaabbb,v2sigmabb2)
c
c     J.P. Perdew, Y. Wang
c     Accurate and simple analytic representation of 
c     the electron-gas correlation energy
c     Phys. Rev. B 45 (1992) 13244-13249
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt),rhob1(npt)
      REAL sigmaaa1(npt),sigmabb1(npt),sigmaab1(npt)
      REAL zk(npt),vrhoa(npt),vrhob(npt)
      REAL vsigmaaa(npt),vsigmabb(npt),vsigmaab(npt)
      REAL v2rhoa2(npt),v2rhob2(npt),v2rhoab(npt)
      REAL v2rhoasigmaaa(npt),v2rhoasigmaab(npt)
      REAL v2rhoasigmabb(npt),v2rhobsigmabb(npt)
      REAL v2rhobsigmaab(npt),v2rhobsigmaaa(npt)
      REAL v2sigmaaa2(npt),v2sigmaaaab(npt),v2sigmaaabb(npt)
      REAL v2sigmaab2(npt),v2sigmaabbb(npt),v2sigmabb2(npt)
      parameter(tol=1.0d-20)
      
      if (ideriv.eq.0) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      t1 = 1/rhob
      t2 = t1**(1.D0/3.D0)
      t6 = t1**(1.D0/6.D0)
      t9 = dsqrt(t1)
      t11 = t2**2
      t17 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t6
     #+0.3844746237447211D1*t2+0.1644733775567609D1*t9
     #+0.2405871291288192D0*t11))
      zk(i) = -0.3109D-1*rhob*(1.D0+0.1274696188700087D0*t2)*t17
      elseif(rhob.lt.tol) then
      rho = rhoa
      t1 = 1/rhoa
      t2 = t1**(1.D0/3.D0)
      t6 = t1**(1.D0/6.D0)
      t9 = dsqrt(t1)
      t11 = t2**2
      t17 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t6
     #+0.3844746237447211D1*t2+0.1644733775567609D1*t9
     #+0.2405871291288192D0*t11))
      zk(i) = -0.3109D-1*rhoa*(1.D0+0.1274696188700087D0*t2)*t17
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      t1 = rhoa+rhob
      t2 = 1/t1
      t3 = t2**(1.D0/3.D0)
      t6 = t2**(1.D0/6.D0)
      t9 = dsqrt(t2)
      t11 = t3**2
      t17 = dlog(1.D0+0.160818243221511D2/(0.598255043577108D1*t6
     #+0.2225569421150687D1*t3+0.8004286349993634D0*t9
     #+0.1897004325747559D0*t11))
      t19 = 0.62182D-1*(1.D0+0.1325688999052018D0*t3)*t17
      t30 = dlog(1.D0+0.2960857464321668D2/(0.8157414703487641D1*t6
     #+0.2247591863577616D1*t3+0.4300972471276643D0*t9
     #+0.1911512595127338D0*t11))
      t33 = rhoa-1.D0*rhob
      t34 = t33*t2
      t35 = 1.D0+t34
      t36 = t35**(1.D0/3.D0)
      t39 = 1.D0-1.D0*t34
      t40 = t39**(1.D0/3.D0)
      t42 = t36*t35+t40*t39-2.D0
      t43 = t33**2
      t44 = t43**2
      t45 = t1**2
      t46 = t45**2
      t48 = t44/t46
      t64 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t6
     #+0.3844746237447211D1*t3+0.1644733775567609D1*t9
     #+0.2405871291288192D0*t11))
      zk(i) = t1*(-t19+0.3799574853701528D-1*(1.D0
     #+0.6901399211255825D-1*t3)*t30*t42*(1.D0-1.D0*t48)
     #+0.1923661050931536D1*(-0.3109D-1*(1.D0+0.1274696188700087D0*t3)
     #*t64+t19)*t42*t48)
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      t1 = 1/rhob
      t2 = t1**(1.D0/3.D0)
      t4 = 1.D0+0.1274696188700087D0*t2
      t5 = rhob*t4
      t6 = t1**(1.D0/6.D0)
      t9 = dsqrt(t1)
      t11 = t2**2
      t13 = 0.1112037486309468D2*t6+0.3844746237447211D1*t2
     #+0.1644733775567609D1*t9+0.2405871291288192D0*t11
      t16 = 1.D0+0.321646831778707D2/t13
      t17 = dlog(t16)
      zk(i) = -0.3109D-1*t5*t17
      vrhoa(i) = 0.D0
      t22 = 1/t11
      t26 = t13**2
      t28 = t6**2
      t29 = t28**2
      t32 = rhob**2
      t33 = 1/t32
      vrhob(i) = -0.3109D-1*t4*t17+0.1321010150222857D-2*t1*t22*t17
     #+0.1D1*t5/t26*(-0.1853395810515781D1/t29/t6*t33
     #-0.128158207914907D1*t22*t33-0.8223668877838045D0/t9*t33
     #-0.1603914194192128D0/t2*t33)/t16
      elseif(rhob.lt.tol) then
      rho = rhoa
      t1 = 1/rhoa
      t2 = t1**(1.D0/3.D0)
      t4 = 1.D0+0.1274696188700087D0*t2
      t5 = rhoa*t4
      t6 = t1**(1.D0/6.D0)
      t9 = dsqrt(t1)
      t11 = t2**2
      t13 = 0.1112037486309468D2*t6+0.3844746237447211D1*t2
     #+0.1644733775567609D1*t9+0.2405871291288192D0*t11
      t16 = 1.D0+0.321646831778707D2/t13
      t17 = dlog(t16)
      zk(i) = -0.3109D-1*t5*t17
      t22 = 1/t11
      t26 = t13**2
      t28 = t6**2
      t29 = t28**2
      t32 = rhoa**2
      t33 = 1/t32
      vrhoa(i) = -0.3109D-1*t4*t17+0.1321010150222857D-2*t1*t22*t17
     #+0.1D1*t5/t26*(-0.1853395810515781D1/t29/t6*t33
     #-0.128158207914907D1*t22*t33-0.8223668877838045D0/t9*t33
     #-0.1603914194192128D0/t2*t33)/t16
      vrhob(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      t1 = rhoa+rhob
      t2 = 1/t1
      t3 = t2**(1.D0/3.D0)
      t5 = 1.D0+0.1325688999052018D0*t3
      t6 = t2**(1.D0/6.D0)
      t9 = dsqrt(t2)
      t11 = t3**2
      t13 = 0.598255043577108D1*t6+0.2225569421150687D1*t3
     #+0.8004286349993634D0*t9+0.1897004325747559D0*t11
      t16 = 1.D0+0.160818243221511D2/t13
      t17 = dlog(t16)
      t19 = 0.62182D-1*t5*t17
      t21 = 1.D0+0.6901399211255825D-1*t3
      t26 = 0.8157414703487641D1*t6+0.2247591863577616D1*t3
     #+0.4300972471276643D0*t9+0.1911512595127338D0*t11
      t29 = 1.D0+0.2960857464321668D2/t26
      t30 = dlog(t29)
      t31 = t21*t30
      t33 = rhoa-1.D0*rhob
      t34 = t33*t2
      t35 = 1.D0+t34
      t36 = t35**(1.D0/3.D0)
      t39 = 1.D0-1.D0*t34
      t40 = t39**(1.D0/3.D0)
      t42 = t36*t35+t40*t39-2.D0
      t43 = t33**2
      t44 = t43**2
      t45 = t1**2
      t46 = t45**2
      t47 = 1/t46
      t48 = t44*t47
      t50 = 1.D0-1.D0*t48
      t53 = 0.3799574853701528D-1*t31*t42*t50
      t55 = 1.D0+0.1274696188700087D0*t3
      t60 = 0.1112037486309468D2*t6+0.3844746237447211D1*t3
     #+0.1644733775567609D1*t9+0.2405871291288192D0*t11
      t63 = 1.D0+0.321646831778707D2/t60
      t64 = dlog(t63)
      t67 = -0.3109D-1*t55*t64+t19
      t68 = t67*t42
      t70 = 0.1923661050931536D1*t68*t48
      zk(i) = t1*(-t19+t53+t70)
      t73 = 1/t45
      t74 = 1/t11*t73
      t75 = t74*t17
      t76 = 0.2747799777968419D-2*t75
      t77 = t13**2
      t80 = t6**2
      t81 = t80**2
      t84 = 1/t81/t6*t73
      t88 = 1/t9*t73
      t91 = 1/t3*t73
      t96 = t5/t77*(-0.99709173929518D0*t84-0.7418564737168958D0*t74
     #-0.4002143174996817D0*t88-0.1264669550498372D0*t91)/t16
      t97 = 0.1D1*t96
      t101 = 0.8740794299481065D-3*t74*t30*t42*t50
      t102 = t26**2
      t115 = 0.1124999956683108D1*t21/t102*(-0.135956911724794D1*t84
     #-0.7491972878592054D0*t74-0.2150486235638321D0*t88
     #-0.1274341730084892D0*t91)/t29*t42*t50
      t116 = t33*t73
      t117 = 1.D0*t116
      t121 = 1.D0*t2
      t125 = 0.1333333333333333D1*t36*(t2-t117)+0.1333333333333333D1
     #*t40*(-t121+t116)
      t130 = t43*t33*t47
      t131 = 4.D0*t130
      t134 = t44/t46/t1
      t135 = 4.D0*t134
      t142 = t60**2
      t159 = 0.1923661050931536D1*(0.1321010150222857D-2*t74*t64+0.1D1
     #*t55/t142*(-0.1853395810515781D1*t84-0.128158207914907D1*t74
     #-0.8223668877838045D0*t88-0.1603914194192128D0*t91)/t63
     #-0.2747799777968419D-2*t75-0.1D1*t96)*t42*t48
      t163 = t68*t130
      t166 = 0.7694644203726145D1*t68*t134
      vrhoa(i) = -t19+t53+t70+t1*(t76+t97-t101-t115
     #+0.3799574853701528D-1*t31*t125*t50+0.3799574853701528D-1*t31
     #*t42*(-t131+t135)+t159+0.1923661050931536D1*t67*t125*t48
     #+0.7694644203726145D1*t163-t166)
      t175 = 0.1333333333333333D1*t36*(-t121-t117)
     #+0.1333333333333333D1*t40*(t2+t116)
      vrhob(i) = -t19+t53+t70+t1*(t76+t97-t101-t115
     #+0.3799574853701528D-1*t31*t175*t50+0.3799574853701528D-1*t31
     #*t42*(t131+t135)+t159+0.1923661050931536D1*t67*t175*t48
     #-0.7694644203726145D1*t163-t166)
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      t1 = 1/rhob
      t2 = t1**(1.D0/3.D0)
      t4 = 1.D0+0.1274696188700087D0*t2
      t5 = rhob*t4
      t6 = t1**(1.D0/6.D0)
      t9 = dsqrt(t1)
      t11 = t2**2
      t13 = 0.1112037486309468D2*t6+0.3844746237447211D1*t2
     #+0.1644733775567609D1*t9+0.2405871291288192D0*t11
      t16 = 1.D0+0.321646831778707D2/t13
      t17 = dlog(t16)
      zk(i) = -0.3109D-1*t5*t17
      vrhoa(i) = 0.D0
      t22 = 1/t11
      t23 = t1*t22
      t26 = t13**2
      t27 = 1/t26
      t28 = t6**2
      t29 = t28**2
      t30 = t29*t6
      t31 = 1/t30
      t32 = rhob**2
      t33 = 1/t32
      t38 = 1/t9
      t41 = 1/t2
      t44 = -0.1853395810515781D1*t31*t33-0.128158207914907D1*t22*t33
     #-0.8223668877838045D0*t38*t33-0.1603914194192128D0*t41*t33
      t46 = 1/t16
      t47 = t27*t44*t46
      vrhob(i) = -0.3109D-1*t4*t17+0.1321010150222857D-2*t23*t17+0.1D1
     #*t5*t47
      v2rhoa2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t55 = 1/t32/rhob
      t57 = 1/t11/t1
      t65 = t44**2
      t72 = t32**2
      t73 = 1/t72
      t99 = t26**2
      t102 = t16**2
      v2rhob2(i) = 0.2D1*t4*t27*t44*t46+0.8806734334819047D-3*t55*t57
     #*t17-0.8497974591333914D-1*t23*t47-0.2D1*t5/t26/t13*t65*t46
     #+0.1D1*t5*t27*(-0.1544496508763151D1/t30/t1*t73
     #+0.3706791621031562D1*t31*t55-0.854388052766047D0*t57*t73
     #+0.2563164158298141D1*t22*t55-0.4111834438919023D0/t9/t1*t73
     #+0.1644733775567609D1*t38*t55-0.5346380647307093D-1/t2/t1*t73
     #+0.3207828388384256D0*t41*t55)*t46+0.321646831778707D2*t5/t99
     #*t65/t102
      elseif(rhob.lt.tol) then
      rho = rhoa
      t1 = 1/rhoa
      t2 = t1**(1.D0/3.D0)
      t4 = 1.D0+0.1274696188700087D0*t2
      t5 = rhoa*t4
      t6 = t1**(1.D0/6.D0)
      t9 = dsqrt(t1)
      t11 = t2**2
      t13 = 0.1112037486309468D2*t6+0.3844746237447211D1*t2
     #+0.1644733775567609D1*t9+0.2405871291288192D0*t11
      t16 = 1.D0+0.321646831778707D2/t13
      t17 = dlog(t16)
      zk(i) = -0.3109D-1*t5*t17
      t22 = 1/t11
      t23 = t1*t22
      t26 = t13**2
      t27 = 1/t26
      t28 = t6**2
      t29 = t28**2
      t30 = t29*t6
      t31 = 1/t30
      t32 = rhoa**2
      t33 = 1/t32
      t38 = 1/t9
      t41 = 1/t2
      t44 = -0.1853395810515781D1*t31*t33-0.128158207914907D1*t22*t33
     #-0.8223668877838045D0*t38*t33-0.1603914194192128D0*t41*t33
      t46 = 1/t16
      t47 = t27*t44*t46
      vrhoa(i) = -0.3109D-1*t4*t17+0.1321010150222857D-2*t23*t17+0.1D1
     #*t5*t47
      vrhob(i) = 0.D0
      t55 = 1/t32/rhoa
      t57 = 1/t11/t1
      t65 = t44**2
      t72 = t32**2
      t73 = 1/t72
      t99 = t26**2
      t102 = t16**2
      v2rhoa2(i) = 0.2D1*t4*t27*t44*t46+0.8806734334819047D-3*t55*t57
     #*t17-0.8497974591333914D-1*t23*t47-0.2D1*t5/t26/t13*t65*t46
     #+0.1D1*t5*t27*(-0.1544496508763151D1/t30/t1*t73
     #+0.3706791621031562D1*t31*t55-0.854388052766047D0*t57*t73
     #+0.2563164158298141D1*t22*t55-0.4111834438919023D0/t9/t1*t73
     #+0.1644733775567609D1*t38*t55-0.5346380647307093D-1/t2/t1*t73
     #+0.3207828388384256D0*t41*t55)*t46+0.321646831778707D2*t5/t99
     #*t65/t102
      v2rhob2(i) = 0.D0
      v2rhoab(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      t1 = rhoa+rhob
      t2 = 1/t1
      t3 = t2**(1.D0/3.D0)
      t5 = 1.D0+0.1325688999052018D0*t3
      t6 = t2**(1.D0/6.D0)
      t9 = dsqrt(t2)
      t11 = t3**2
      t13 = 0.598255043577108D1*t6+0.2225569421150687D1*t3
     #+0.8004286349993634D0*t9+0.1897004325747559D0*t11
      t16 = 1.D0+0.160818243221511D2/t13
      t17 = dlog(t16)
      t19 = 0.62182D-1*t5*t17
      t21 = 1.D0+0.6901399211255825D-1*t3
      t26 = 0.8157414703487641D1*t6+0.2247591863577616D1*t3
     #+0.4300972471276643D0*t9+0.1911512595127338D0*t11
      t29 = 1.D0+0.2960857464321668D2/t26
      t30 = dlog(t29)
      t31 = t21*t30
      t33 = rhoa-1.D0*rhob
      t34 = t33*t2
      t35 = 1.D0+t34
      t36 = t35**(1.D0/3.D0)
      t39 = 1.D0-1.D0*t34
      t40 = t39**(1.D0/3.D0)
      t42 = t36*t35+t40*t39-2.D0
      t43 = t33**2
      t44 = t43**2
      t45 = t1**2
      t46 = t45**2
      t47 = 1/t46
      t48 = t44*t47
      t50 = 1.D0-1.D0*t48
      t51 = t42*t50
      t53 = 0.3799574853701528D-1*t31*t51
      t55 = 1.D0+0.1274696188700087D0*t3
      t60 = 0.1112037486309468D2*t6+0.3844746237447211D1*t3
     #+0.1644733775567609D1*t9+0.2405871291288192D0*t11
      t63 = 1.D0+0.321646831778707D2/t60
      t64 = dlog(t63)
      t67 = -0.3109D-1*t55*t64+t19
      t68 = t67*t42
      t70 = 0.1923661050931536D1*t68*t48
      zk(i) = t1*(-t19+t53+t70)
      t72 = 1/t11
      t73 = 1/t45
      t74 = t72*t73
      t75 = t74*t17
      t76 = 0.2747799777968419D-2*t75
      t77 = t13**2
      t78 = 1/t77
      t79 = t5*t78
      t80 = t6**2
      t81 = t80**2
      t82 = t81*t6
      t83 = 1/t82
      t84 = t83*t73
      t87 = 1/t9
      t88 = t87*t73
      t90 = 1/t3
      t91 = t90*t73
      t93 = -0.99709173929518D0*t84-0.7418564737168958D0*t74
     #-0.4002143174996817D0*t88-0.1264669550498372D0*t91
      t94 = 1/t16
      t96 = t79*t93*t94
      t97 = 0.1D1*t96
      t98 = t30*t42
      t99 = t98*t50
      t100 = t74*t99
      t101 = 0.8740794299481065D-3*t100
      t102 = t26**2
      t103 = 1/t102
      t104 = t21*t103
      t109 = -0.135956911724794D1*t84-0.7491972878592054D0*t74
     #-0.2150486235638321D0*t88-0.1274341730084892D0*t91
      t110 = t104*t109
      t111 = 1/t29
      t112 = t111*t42
      t113 = t112*t50
      t114 = t110*t113
      t115 = 0.1124999956683108D1*t114
      t116 = t33*t73
      t117 = 1.D0*t116
      t118 = t2-t117
      t121 = 1.D0*t2
      t122 = -t121+t116
      t125 = 0.1333333333333333D1*t36*t118+0.1333333333333333D1*t40*t122
      t127 = t31*t125*t50
      t128 = 0.3799574853701528D-1*t127
      t129 = t43*t33
      t130 = t129*t47
      t131 = 4.D0*t130
      t133 = 1/t46/t1
      t134 = t44*t133
      t135 = 4.D0*t134
      t136 = -t131+t135
      t138 = t31*t42*t136
      t139 = 0.3799574853701528D-1*t138
      t142 = t60**2
      t143 = 1/t142
      t144 = t55*t143
      t149 = -0.1853395810515781D1*t84-0.128158207914907D1*t74
     #-0.8223668877838045D0*t88-0.1603914194192128D0*t91
      t150 = 1/t63
      t156 = 0.1321010150222857D-2*t74*t64+0.1D1*t144*t149*t150
     #-0.2747799777968419D-2*t75-0.1D1*t96
      t157 = t156*t42
      t158 = t157*t48
      t159 = 0.1923661050931536D1*t158
      t160 = t67*t125
      t161 = t160*t48
      t162 = 0.1923661050931536D1*t161
      t163 = t68*t130
      t165 = t68*t134
      t166 = 0.7694644203726145D1*t165
      vrhoa(i) = -t19+t53+t70+t1*(t76+t97-t101-t115+t128+t139+t159
     #+t162+0.7694644203726145D1*t163-t166)
      t169 = -t121-t117
      t172 = t2+t116
      t175 = 0.1333333333333333D1*t36*t169+0.1333333333333333D1*t40*t172
      t177 = t31*t175*t50
      t178 = 0.3799574853701528D-1*t177
      t179 = t131+t135
      t181 = t31*t42*t179
      t182 = 0.3799574853701528D-1*t181
      t183 = t67*t175
      t184 = t183*t48
      t185 = 0.1923661050931536D1*t184
      vrhob(i) = -t19+t53+t70+t1*(t76+t97-t101-t115+t178+t182+t159
     #+t185-0.7694644203726145D1*t163-t166)
      t189 = 0.5495599555936838D-2*t75
      t190 = 0.2D1*t96
      t191 = 0.1748158859896213D-2*t100
      t192 = 0.2249999913366216D1*t114
      t195 = 0.3847322101863073D1*t158
      t198 = 0.1538928840745229D2*t165
      t199 = t36**2
      t200 = 1/t199
      t201 = t118**2
      t204 = 2.D0*t73
      t206 = 1/t45/t1
      t208 = 2.D0*t33*t206
      t209 = -t204+t208
      t212 = t40**2
      t213 = 1/t212
      t214 = t122**2
      t220 = 0.4444444444444444D0*t200*t201+0.1333333333333333D1*t36
     #*t209+0.4444444444444444D0*t213*t214-0.1333333333333333D1*t40*t209
      t226 = 1/t11/t2*t47
      t228 = 0.5827196199654043D-3*t226*t99
      t229 = t43*t47
      t230 = t68*t229
      t231 = 0.2308393261117844D2*t230
      t234 = t44/t46/t45
      t236 = 0.3847322101863073D2*t68*t234
      t238 = 0.1538928840745229D2*t157*t134
      t239 = t129*t133
      t240 = t68*t239
      t242 = t77**2
      t245 = t93**2
      t246 = t16**2
      t249 = t5/t242*t245/t246
      t250 = 0.160818243221511D2*t249
      t255 = t5/t77/t13*t245*t94
      t256 = 0.2D1*t255
      t259 = 1/t82/t2*t47
      t261 = t83*t206
      t264 = t72*t206
      t268 = 1/t9/t2*t47
      t270 = t87*t206
      t274 = 1/t3/t2*t47
      t276 = t90*t206
      t280 = t79*(-0.8309097827459833D0*t259+0.199418347859036D1*t261
     #-0.4945709824779306D0*t226+0.1483712947433792D1*t264
     #-0.2001071587498409D0*t268+0.8004286349993634D0*t270
     #-0.4215565168327908D-1*t274+0.2529339100996745D0*t276)*t94
      t281 = 0.1D1*t280
      t282 = 12.D0*t229
      t283 = 32.D0*t239
      t284 = 20.D0*t234
      t300 = t149**2
      t316 = t142**2
      t319 = t63**2
      t324 = t226*t17
      t326 = t264*t17
      t330 = t74*t78*t93*t94
      t335 = 0.8806734334819047D-3*t226*t64-0.2642020300445714D-2*t264
     #*t64-0.8497974591333914D-1*t74*t143*t149*t150-0.2D1*t55/t142/t60
     #*t300*t150+0.1D1*t144*(-0.1544496508763151D1*t259
     #+0.3706791621031562D1*t261-0.854388052766047D0*t226
     #+0.2563164158298141D1*t264-0.4111834438919023D0*t268
     #+0.1644733775567609D1*t270-0.5346380647307093D-1*t274
     #+0.3207828388384256D0*t276)*t150+0.321646831778707D2*t55/t316
     #*t300/t319-0.1831866518645613D-2*t324+0.5495599555936838D-2*t326
     #+0.8837926660346786D-1*t330+0.2D1*t255-0.1D1*t280
     #-0.160818243221511D2*t249
      t338 = 0.1923661050931536D1*t335*t42*t48
      t345 = t157*t130
      t347 = 0.3799574853701528D-1*t31*t220*t50-t228+t231+t236-t238
     #-0.6155715362980916D2*t240+t250-t256+t281+0.3799574853701528D-1
     #*t31*t42*(-t282+t283-t284)+t338+0.7599149707403056D-1*t31*t125
     #*t136+0.1923661050931536D1*t67*t220*t48+0.1538928840745229D2*t345
      t348 = t160*t130
      t350 = 0.1831866518645613D-2*t324
      t351 = 0.5495599555936838D-2*t326
      t353 = 0.1748158859896213D-2*t264*t99
      t354 = t160*t134
      t357 = t74*t98*t136
      t361 = t74*t30*t125*t50
      t366 = t109**2
      t369 = 0.2249999913366216D1*t21/t102/t26*t366*t113
      t374 = 0.5176049209143758D-1*t74*t103*t109*t111*t51
      t375 = 0.8837926660346786D-1*t330
      t376 = t102**2
      t380 = t29**2
      t385 = 0.3330964519106732D2*t21/t376*t366/t380*t42*t50
      t388 = t110*t111*t125*t50
      t391 = t110*t112*t136
      t404 = 0.1124999956683108D1*t104*(-0.1132974264373283D1*t259
     #+0.271913823449588D1*t261-0.4994648585728036D0*t226
     #+0.1498394575718411D1*t264-0.1075243117819161D0*t268
     #+0.4300972471276643D0*t270-0.4247805766949639D-1*t274
     #+0.2548683460169784D0*t276)*t113
      t406 = t156*t125*t48
      t408 = 0.1538928840745229D2*t348+t350-t351+t353
     #-0.1538928840745229D2*t354-0.1748158859896213D-2*t357
     #-0.1748158859896213D-2*t361+t369+t374-t375-t385
     #-0.2249999913366216D1*t388-0.2249999913366216D1*t391-t404
     #+0.3847322101863073D1*t406
      v2rhoa2(i) = t189+t190-t191-t192+0.7599149707403056D-1*t127
     #+0.7599149707403056D-1*t138+t195+0.3847322101863073D1*t161
     #+0.1538928840745229D2*t163-t198+t1*(t347+t408)
      t415 = t169**2
      t418 = t204+t208
      t421 = t172**2
      t427 = 0.4444444444444444D0*t200*t415+0.1333333333333333D1*t36
     #*t418+0.4444444444444444D0*t213*t421-0.1333333333333333D1*t40*t418
      t439 = t156*t175*t48
      t441 = t183*t134
      t443 = t183*t130
      t450 = t110*t111*t175*t50
      t453 = 0.3799574853701528D-1*t31*t427*t50+0.7599149707403056D-1
     #*t31*t175*t179+0.3799574853701528D-1*t31*t42*(-t282-t283-t284)
     #+0.3847322101863073D1*t439-0.1538928840745229D2*t441
     #-0.1538928840745229D2*t443+0.1923661050931536D1*t67*t427*t48
     #-0.2249999913366216D1*t450-t228+t231+t236-t238
     #+0.6155715362980916D2*t240+t250
      t456 = t74*t98*t179
      t460 = t74*t30*t175*t50
      t463 = t110*t112*t179
      t465 = -t256+t281+t338-0.1538928840745229D2*t345+t350-t351+t353
     #+t369+t374-t375-t385-t404-0.1748158859896213D-2*t456
     #-0.1748158859896213D-2*t460-0.2249999913366216D1*t463
      v2rhob2(i) = t189+t190-t191-t192+0.7599149707403056D-1*t177
     #+0.7599149707403056D-1*t181+t195+0.3847322101863073D1*t184
     #-0.1538928840745229D2*t163-t198+t1*(t453+t465)
      t484 = 0.4444444444444444D0*t200*t118*t169+0.2666666666666667D1
     #*t36*t33*t206+0.4444444444444444D0*t213*t122*t172
     #-0.2666666666666667D1*t40*t33*t206
      t502 = 0.1923661050931536D1*t439-0.7694644203726145D1*t441
     #+0.7694644203726145D1*t443-0.1124999956683108D1*t450
     #+0.3799574853701528D-1*t31*t484*t50+0.3799574853701528D-1*t31
     #*t125*t179+0.3799574853701528D-1*t31*t175*t136
     #+0.3799574853701528D-1*t31*t42*(t282-t284)+0.1923661050931536D1
     #*t67*t484*t48-t228-0.2308393261117844D2*t230+t236-t238+t250-t256
     #+t281+t338
      t513 = -0.7694644203726145D1*t348+t350-t351+t353
     #-0.7694644203726145D1*t354-0.8740794299481065D-3*t357
     #-0.8740794299481065D-3*t361+t369+t374-t375-t385
     #-0.1124999956683108D1*t388-0.1124999956683108D1*t391-t404
     #+0.1923661050931536D1*t406-0.8740794299481065D-3*t456
     #-0.8740794299481065D-3*t460-0.1124999956683108D1*t463
      v2rhoab(i) = t189+t190-t191-t192+t178+t182+t195+t185-t198+t128
     #+t139+t162+t1*(t502+t513)
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      v2rhob2(i) = 0.0d0
      v2rhoab(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end
      
      
      subroutine rks_c_pw92
     & (ideriv,npt,rhoa1,sigmaaa1,
     &  zk,vrhoa,vsigmaaa,
     &  v2rhoa2,v2rhoasigmaaa,v2sigmaaa2)
c
c     J.P. Perdew, Y. Wang
c     Accurate and simple analytic representation of 
c     the electron-gas correlation energy
c     Phys. Rev. B 45 (1992) 13244-13249
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt)
      REAL sigmaaa1(npt)
      REAL zk(npt),vrhoa(npt),vsigmaaa(npt)
      REAL v2rhoa2(npt),v2rhoasigmaaa(npt),v2sigmaaa2(npt)
      parameter(tol=1.0d-20)
      
      if(ideriv.eq.0) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      t1 = 1/rho
      t2 = t1**(1.D0/3.D0)
      t6 = t1**(1.D0/6.D0)
      t9 = dsqrt(t1)
      t11 = t2**2
      t17 = dlog(1.D0+0.160818243221511D2/(0.598255043577108D1*t6
     #+0.2225569421150687D1*t2+0.8004286349993634D0*t9
     #+0.1897004325747559D0*t11))
      zk(i) = -0.62182D-1*rho*(1.D0+0.1325688999052018D0*t2)*t17
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      t1 = 1/rho
      t2 = t1**(1.D0/3.D0)
      t4 = 1.D0+0.1325688999052018D0*t2
      t6 = t1**(1.D0/6.D0)
      t9 = dsqrt(t1)
      t11 = t2**2
      t13 = 0.598255043577108D1*t6+0.2225569421150687D1*t2
     #+0.8004286349993634D0*t9+0.1897004325747559D0*t11
      t16 = 1.D0+0.160818243221511D2/t13
      t17 = dlog(t16)
      zk(i) = -0.62182D-1*rho*t4*t17
      t23 = rho**2
      t24 = 1/t23
      t25 = 1/t11*t24
      t28 = t13**2
      t31 = t6**2
      t32 = t31**2
      vrhoa(i) = -0.62182D-1*t4*t17+rho*(0.2747799777968419D-2*t25*t17
     #+0.1D1*t4/t28*(-0.99709173929518D0/t32/t6*t24
     #-0.7418564737168958D0*t25-0.4002143174996817D0/t9*t24
     #-0.1264669550498372D0/t2*t24)/t16)
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      t1 = 1/rho
      t2 = t1**(1.D0/3.D0)
      t4 = 1.D0+0.1325688999052018D0*t2
      t6 = t1**(1.D0/6.D0)
      t9 = dsqrt(t1)
      t11 = t2**2
      t13 = 0.598255043577108D1*t6+0.2225569421150687D1*t2
     #+0.8004286349993634D0*t9+0.1897004325747559D0*t11
      t16 = 1.D0+0.160818243221511D2/t13
      t17 = dlog(t16)
      zk(i) = -0.62182D-1*rho*t4*t17
      t22 = 1/t11
      t23 = rho**2
      t24 = 1/t23
      t25 = t22*t24
      t26 = t25*t17
      t28 = t13**2
      t29 = 1/t28
      t30 = t4*t29
      t31 = t6**2
      t32 = t31**2
      t33 = t32*t6
      t34 = 1/t33
      t38 = 1/t9
      t41 = 1/t2
      t44 = -0.99709173929518D0*t34*t24-0.7418564737168958D0*t25
     #-0.4002143174996817D0*t38*t24-0.1264669550498372D0*t41*t24
      t45 = 1/t16
      t47 = t30*t44*t45
      vrhoa(i) = -0.62182D-1*t4*t17+rho*(0.2747799777968419D-2*t26
     #+0.1D1*t47)
      t55 = t23**2
      t56 = 1/t55
      t57 = 1/t11/t1*t56
      t59 = 0.1831866518645613D-2*t57*t17
      t61 = 1/t23/rho
      t62 = t22*t61
      t64 = 0.5495599555936838D-2*t62*t17
      t75 = dlog(1.D0+0.2960857464321668D2/(0.8157414703487641D1*t6
     #+0.2247591863577616D1*t2+0.4300972471276643D0*t9
     #+0.1911512595127338D0*t11))
      t77 = (1.D0+0.6901399211255825D-1*t2)*t75*t24
      t82 = 0.8837926660346786D-1*t25*t29*t44*t45
      t83 = t28**2
      t86 = t44**2
      t87 = t16**2
      t91 = 0.160818243221511D2*t4/t83*t86/t87
      t115 = 0.1D1*t30*(-0.8309097827459833D0/t33/t1*t56
     #+0.199418347859036D1*t34*t61-0.4945709824779306D0*t57
     #+0.1483712947433792D1*t62-0.2001071587498409D0/t9/t1*t56
     #+0.8004286349993634D0*t38*t61-0.4215565168327908D-1/t2/t1*t56
     #+0.2529339100996745D0*t41*t61)*t45
      t121 = 0.2D1*t4/t28/t13*t86*t45
      v2rhoa2(i) = 0.4D1*t47+0.1099119911187368D-1*t26+rho*(t59-t64
     #+0.3377399869956914D-1*t77-t82+t91+t115-t121)+rho*(t59-t64
     #-0.3377399869956914D-1*t77-t82+t91+t115-t121)
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end

c:C_PW92subrend
_ENDIF
_IF(ccpdft,all,c_vwn5)
c:C_VWN5subrstart

c    Generated: Tue Mar  9 15:23:35 GMT 2004

      subroutine uks_c_vwn5
     & (ideriv,npt,rhoa1,rhob1,sigmaaa1,sigmabb1,sigmaab1,
     &  zk,vrhoa,vrhob,vsigmaaa,vsigmabb,vsigmaab,
     &  v2rhoa2,v2rhob2,v2rhoab,
     &  v2rhoasigmaaa,v2rhoasigmaab,v2rhoasigmabb,
     &  v2rhobsigmabb,v2rhobsigmaab,v2rhobsigmaaa,
     &  v2sigmaaa2,v2sigmaaaab,v2sigmaaabb,
     &  v2sigmaab2,v2sigmaabbb,v2sigmabb2)
c
c     S.H. Vosko, L. Wilk, and M. Nusair
c     Accurate spin-dependent electron liquid correlation energies for
c     local spin density calculations: a critical analysis
c     Can. J. Phys. 58 (1980) 1200-1211
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt),rhob1(npt)
      REAL sigmaaa1(npt),sigmabb1(npt),sigmaab1(npt)
      REAL zk(npt),vrhoa(npt),vrhob(npt)
      REAL vsigmaaa(npt),vsigmabb(npt),vsigmaab(npt)
      REAL v2rhoa2(npt),v2rhob2(npt),v2rhoab(npt)
      REAL v2rhoasigmaaa(npt),v2rhoasigmaab(npt)
      REAL v2rhoasigmabb(npt),v2rhobsigmabb(npt)
      REAL v2rhobsigmaab(npt),v2rhobsigmaaa(npt)
      REAL v2sigmaaa2(npt),v2sigmaaaab(npt),v2sigmaaabb(npt)
      REAL v2sigmaab2(npt),v2sigmaabbb(npt),v2sigmabb2(npt)
      parameter(tol=1.0d-20)
      
      if (ideriv.eq.0) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      t1 = 1/rhob
      t2 = t1**(1.D0/6.D0)
      t3 = 0.7876233178997433D0*t2
      t5 = (t3+0.10498D0)**2
      t6 = t1**(1.D0/3.D0)
      t7 = 0.6203504908994D0*t6
      t12 = dlog(t5/(t7+0.2935818660072219D1*t2+0.129352D2))
      t16 = 1/(t7+0.5560951426165705D1*t2+0.180578D2)
      t19 = dlog(0.6203504908994D0*t6*t16)
      t25 = datan(0.4730926909560113D1/(0.1575246635799487D1*t2
     #+0.706042D1))
      t28 = (t3+0.325D0)**2
      t30 = dlog(t28*t16)
      zk(i) = rhob*(0.1D-23*t12+0.1554535D-1*t19+0.5249139316978094D-1
     #*t25+0.2247867095542612D-2*t30)
      elseif(rhob.lt.tol) then
      rho = rhoa
      t1 = 1/rhoa
      t2 = t1**(1.D0/6.D0)
      t3 = 0.7876233178997433D0*t2
      t5 = (t3+0.10498D0)**2
      t6 = t1**(1.D0/3.D0)
      t7 = 0.6203504908994D0*t6
      t12 = dlog(t5/(t7+0.2935818660072219D1*t2+0.129352D2))
      t16 = 1/(t7+0.5560951426165705D1*t2+0.180578D2)
      t19 = dlog(0.6203504908994D0*t6*t16)
      t25 = datan(0.4730926909560113D1/(0.1575246635799487D1*t2
     #+0.706042D1))
      t28 = (t3+0.325D0)**2
      t30 = dlog(t28*t16)
      zk(i) = rhoa*(0.1D-23*t12+0.1554535D-1*t19+0.5249139316978094D-1
     #*t25+0.2247867095542612D-2*t30)
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      t1 = 1/rho
      t2 = t1**(1.D0/3.D0)
      t3 = 0.6203504908994D0*t2
      t4 = t1**(1.D0/6.D0)
      t7 = 1/(t3+0.2935818660072219D1*t4+0.129352D2)
      t10 = dlog(0.6203504908994D0*t2*t7)
      t12 = 0.1575246635799487D1*t4
      t16 = datan(0.615199081975908D1/(t12+0.372744D1))
      t18 = 0.7876233178997433D0*t4
      t20 = (t18+0.10498D0)**2
      t22 = dlog(t20*t7)
      t26 = 1/(t3+0.8908571061768626D0*t4+0.130045D2)
      t29 = dlog(0.6203504908994D0*t2*t26)
      t33 = datan(0.7123108917818118D1/(t12+0.113107D1))
      t36 = (t18+0.47584D-2)**2
      t38 = dlog(t36*t26)
      t40 = t29+0.3177080047439415D0*t33+0.4140337942820627D-3*t38
      t42 = rhoa-1.D0*rhob
      t43 = t42*t1
      t44 = 1.D0+t43
      t45 = t44**(1.D0/3.D0)
      t48 = 1.D0-1.D0*t43
      t49 = t48**(1.D0/3.D0)
      t55 = 1/(t3+0.5560951426165705D1*t4+0.180578D2)
      t58 = dlog(0.6203504908994D0*t2*t55)
      t63 = datan(0.4730926909560113D1/(t12+0.706042D1))
      t66 = (t18+0.325D0)**2
      t68 = dlog(t66*t55)
      t78 = t42**2
      t79 = t78**2
      t81 = rho**2
      t82 = t81**2
      zk(i) = rho*(0.310907D-1*t10+0.3878329487811301D-1*t16
     #+0.9690227711544374D-3*t22-0.1899772193293833D-1*t40*(t45*t44
     #+t49*t48-2.D0)*(1.D0+(-0.101257459063883D3*(0.1554535D-1*t58
     #+0.5249139316978094D-1*t63+0.2247867095542612D-2*t68-0.310907D-1
     #*t10-0.3878329487811301D-1*t16-0.9690227711544374D-3*t22)/t40
     #-1.D0)*t79/t82))
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      t1 = 1/rhob
      t2 = t1**(1.D0/6.D0)
      t3 = 0.7876233178997433D0*t2
      t4 = t3+0.10498D0
      t5 = t4**2
      t6 = t1**(1.D0/3.D0)
      t7 = 0.6203504908994D0*t6
      t9 = t7+0.2935818660072219D1*t2+0.129352D2
      t10 = 1/t9
      t12 = dlog(t5*t10)
      t13 = 0.1D-23*t12
      t15 = t7+0.5560951426165705D1*t2+0.180578D2
      t16 = 1/t15
      t19 = dlog(0.6203504908994D0*t6*t16)
      t20 = 0.1554535D-1*t19
      t21 = 0.1575246635799487D1*t2
      t22 = t21+0.706042D1
      t25 = datan(0.4730926909560113D1/t22)
      t26 = 0.5249139316978094D-1*t25
      t27 = t3+0.325D0
      t28 = t27**2
      t30 = dlog(t28*t16)
      t31 = 0.2247867095542612D-2*t30
      zk(i) = rhob*(t13+t20+t26+t31)
      vrhoa(i) = 0.D0
      t33 = t6**2
      t34 = 1/t33
      t36 = rhob**2
      t37 = 1/t36
      t40 = t9**2
      t41 = 1/t40
      t44 = 0.2067834969664667D0*t34*t37
      t45 = t2**2
      t46 = t45**2
      t48 = 1/t46/t2
      t49 = t48*t37
      t51 = -t44-0.4893031100120365D0*t49
      t55 = 1/t6
      t60 = (t21+0.372744D1)**2
      t61 = 1/t60
      t83 = t15**2
      t84 = 1/t83
      t87 = -t44-0.9268252376942842D0*t49
      t94 = t22**2
      t95 = 1/t94
      vrhob(i) = t13+t20+t26+t31+rhob*(0.2D-21*(-0.2067834969664667D0
     #*t34*t10*t37-0.6203504908994D0*t6*t41*t51)*t55*t9-0.1D-21*t61
     #*t48*t37/(1.D0+0.378469910464D2*t61)+0.1D-23*(
     #-0.2625411059665811D0*t4*t10*t49-1.D0*t5*t41*t51)/t5*t9
     #+0.2505897912236993D-1*(-0.2067834969664667D0*t34*t16*t37
     #-0.6203504908994D0*t6*t84*t87)*t55*t15+0.6519760588836059D-1*t95
     #*t48*t37/(1.D0+0.223816694236D2*t95)+0.2247867095542612D-2*(
     #-0.2625411059665811D0*t27*t16*t49-1.D0*t28*t84*t87)/t28*t15)
      elseif(rhob.lt.tol) then
      rho = rhoa
      t1 = 1/rhoa
      t2 = t1**(1.D0/6.D0)
      t3 = 0.7876233178997433D0*t2
      t4 = t3+0.10498D0
      t5 = t4**2
      t6 = t1**(1.D0/3.D0)
      t7 = 0.6203504908994D0*t6
      t9 = t7+0.2935818660072219D1*t2+0.129352D2
      t10 = 1/t9
      t12 = dlog(t5*t10)
      t13 = 0.1D-23*t12
      t15 = t7+0.5560951426165705D1*t2+0.180578D2
      t16 = 1/t15
      t19 = dlog(0.6203504908994D0*t6*t16)
      t20 = 0.1554535D-1*t19
      t21 = 0.1575246635799487D1*t2
      t22 = t21+0.706042D1
      t25 = datan(0.4730926909560113D1/t22)
      t26 = 0.5249139316978094D-1*t25
      t27 = t3+0.325D0
      t28 = t27**2
      t30 = dlog(t28*t16)
      t31 = 0.2247867095542612D-2*t30
      zk(i) = rhoa*(t13+t20+t26+t31)
      t33 = t6**2
      t34 = 1/t33
      t36 = rhoa**2
      t37 = 1/t36
      t40 = t9**2
      t41 = 1/t40
      t44 = 0.2067834969664667D0*t34*t37
      t45 = t2**2
      t46 = t45**2
      t48 = 1/t46/t2
      t49 = t48*t37
      t51 = -t44-0.4893031100120365D0*t49
      t55 = 1/t6
      t60 = (t21+0.372744D1)**2
      t61 = 1/t60
      t83 = t15**2
      t84 = 1/t83
      t87 = -t44-0.9268252376942842D0*t49
      t94 = t22**2
      t95 = 1/t94
      vrhoa(i) = t13+t20+t26+t31+rhoa*(0.2D-21*(-0.2067834969664667D0
     #*t34*t10*t37-0.6203504908994D0*t6*t41*t51)*t55*t9-0.1D-21*t61
     #*t48*t37/(1.D0+0.378469910464D2*t61)+0.1D-23*(
     #-0.2625411059665811D0*t4*t10*t49-1.D0*t5*t41*t51)/t5*t9
     #+0.2505897912236993D-1*(-0.2067834969664667D0*t34*t16*t37
     #-0.6203504908994D0*t6*t84*t87)*t55*t15+0.6519760588836059D-1*t95
     #*t48*t37/(1.D0+0.223816694236D2*t95)+0.2247867095542612D-2*(
     #-0.2625411059665811D0*t27*t16*t49-1.D0*t28*t84*t87)/t28*t15)
      vrhob(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      t1 = 1/rho
      t2 = t1**(1.D0/3.D0)
      t3 = 0.6203504908994D0*t2
      t4 = t1**(1.D0/6.D0)
      t6 = t3+0.2935818660072219D1*t4+0.129352D2
      t7 = 1/t6
      t10 = dlog(0.6203504908994D0*t2*t7)
      t11 = 0.310907D-1*t10
      t12 = 0.1575246635799487D1*t4
      t13 = t12+0.372744D1
      t16 = datan(0.615199081975908D1/t13)
      t17 = 0.3878329487811301D-1*t16
      t18 = 0.7876233178997433D0*t4
      t19 = t18+0.10498D0
      t20 = t19**2
      t22 = dlog(t20*t7)
      t23 = 0.9690227711544374D-3*t22
      t25 = t3+0.8908571061768626D0*t4+0.130045D2
      t26 = 1/t25
      t29 = dlog(0.6203504908994D0*t2*t26)
      t30 = t12+0.113107D1
      t33 = datan(0.7123108917818118D1/t30)
      t35 = t18+0.47584D-2
      t36 = t35**2
      t38 = dlog(t36*t26)
      t40 = t29+0.3177080047439415D0*t33+0.4140337942820627D-3*t38
      t42 = rhoa-1.D0*rhob
      t43 = t42*t1
      t44 = 1.D0+t43
      t45 = t44**(1.D0/3.D0)
      t48 = 1.D0-1.D0*t43
      t49 = t48**(1.D0/3.D0)
      t51 = t45*t44+t49*t48-2.D0
      t52 = t40*t51
      t54 = t3+0.5560951426165705D1*t4+0.180578D2
      t55 = 1/t54
      t58 = dlog(0.6203504908994D0*t2*t55)
      t60 = t12+0.706042D1
      t63 = datan(0.4730926909560113D1/t60)
      t65 = t18+0.325D0
      t66 = t65**2
      t68 = dlog(t66*t55)
      t73 = 0.1554535D-1*t58+0.5249139316978094D-1*t63
     #+0.2247867095542612D-2*t68-0.310907D-1*t10-0.3878329487811301D-1
     #*t16-0.9690227711544374D-3*t22
      t74 = 1/t40
      t77 = -0.101257459063883D3*t73*t74-1.D0
      t78 = t42**2
      t79 = t78**2
      t80 = t77*t79
      t81 = rho**2
      t82 = t81**2
      t83 = 1/t82
      t85 = 1.D0+t80*t83
      t87 = 0.1899772193293833D-1*t52*t85
      zk(i) = rho*(t11+t17+t23-t87)
      t93 = 0.1333333333333333D1*t45*t1-0.1333333333333333D1*t49*t1
      t100 = t52*t77*t78*t42*t83
      t104 = t2**2
      t105 = 1/t104
      t107 = 1/t81
      t110 = t6**2
      t111 = 1/t110
      t114 = 0.2067834969664667D0*t105*t107
      t115 = t4**2
      t116 = t115**2
      t118 = 1/t116/t4
      t119 = t118*t107
      t121 = -t114-0.4893031100120365D0*t119
      t125 = 1/t2
      t127 = (-0.2067834969664667D0*t105*t7*t107-0.6203504908994D0*t2
     #*t111*t121)*t125*t6
      t129 = t13**2
      t130 = 1/t129
      t136 = t130*t118*t107/(1.D0+0.378469910464D2*t130)
      t147 = (-0.2625411059665811D0*t19*t7*t119-1.D0*t20*t111*t121)
     #/t20*t6
      t152 = t25**2
      t153 = 1/t152
      t156 = -t114-0.1484761843628104D0*t119
      t163 = t30**2
      t164 = 1/t163
      t183 = 0.161199195401647D1*(-0.2067834969664667D0*t105*t26*t107
     #-0.6203504908994D0*t2*t153*t156)*t125*t25+0.5941485651138659D0
     #*t164*t118*t107/(1.D0+0.507386806551D2*t164)
     #+0.4140337942820627D-3*(-0.2625411059665811D0*t35*t26*t119-1.D0
     #*t36*t153*t156)/t36*t25
      t200 = t54**2
      t201 = 1/t200
      t204 = -t114-0.9268252376942842D0*t119
      t211 = t60**2
      t212 = 1/t211
      t237 = t40**2
      t253 = rho*(0.5011795824473985D-1*t127+0.626408570946439D-1*t136
     #+0.9690227711544374D-3*t147-0.1899772193293833D-1*t183*t51*t85
     #-0.1899772193293833D-1*t40*(-0.1333333333333333D1*t45*t42*t107
     #+0.1333333333333333D1*t49*t42*t107)*t85-0.1899772193293833D-1
     #*t52*((-0.101257459063883D3*(0.2505897912236993D-1*(
     #-0.2067834969664667D0*t105*t55*t107-0.6203504908994D0*t2*t201
     #*t204)*t125*t54+0.6519760588836059D-1*t212*t118*t107/(1.D0
     #+0.223816694236D2*t212)+0.2247867095542612D-2*(
     #-0.2625411059665811D0*t65*t55*t119-1.D0*t66*t201*t204)/t66*t54
     #-0.5011795824473985D-1*t127-0.626408570946439D-1*t136
     #-0.9690227711544374D-3*t147)*t74+0.101257459063883D3*t73/t237
     #*t183)*t79*t83-4.D0*t80/t82/rho))
      vrhoa(i) = rho*(-0.1899772193293833D-1*t40*t93*t85
     #-0.7599088773175333D-1*t100)+t11+t17+t23-t87+t253
      vrhob(i) = rho*(0.1899772193293833D-1*t40*t93*t85
     #+0.7599088773175333D-1*t100)+t11+t17+t23-t87+t253
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      t1 = 1/rhob
      t2 = t1**(1.D0/6.D0)
      t3 = 0.7876233178997433D0*t2
      t4 = t3+0.10498D0
      t5 = t4**2
      t6 = t1**(1.D0/3.D0)
      t7 = 0.6203504908994D0*t6
      t9 = t7+0.2935818660072219D1*t2+0.129352D2
      t10 = 1/t9
      t12 = dlog(t5*t10)
      t13 = 0.1D-23*t12
      t15 = t7+0.5560951426165705D1*t2+0.180578D2
      t16 = 1/t15
      t19 = dlog(0.6203504908994D0*t6*t16)
      t20 = 0.1554535D-1*t19
      t21 = 0.1575246635799487D1*t2
      t22 = t21+0.706042D1
      t25 = datan(0.4730926909560113D1/t22)
      t26 = 0.5249139316978094D-1*t25
      t27 = t3+0.325D0
      t28 = t27**2
      t30 = dlog(t28*t16)
      t31 = 0.2247867095542612D-2*t30
      zk(i) = rhob*(t13+t20+t26+t31)
      vrhoa(i) = 0.D0
      t33 = t6**2
      t34 = 1/t33
      t35 = t34*t10
      t36 = rhob**2
      t37 = 1/t36
      t40 = t9**2
      t41 = 1/t40
      t42 = t6*t41
      t44 = 0.2067834969664667D0*t34*t37
      t45 = t2**2
      t46 = t45**2
      t47 = t46*t2
      t48 = 1/t47
      t49 = t48*t37
      t51 = -t44-0.4893031100120365D0*t49
      t55 = 1/t6
      t56 = (-0.2067834969664667D0*t35*t37-0.6203504908994D0*t42*t51)
     #*t55
      t60 = (t21+0.372744D1)**2
      t61 = 1/t60
      t65 = 1/(1.D0+0.378469910464D2*t61)
      t69 = t4*t10
      t72 = t5*t41
      t76 = 1/t5
      t77 = (-0.2625411059665811D0*t69*t49-1.D0*t72*t51)*t76
      t80 = t34*t16
      t83 = t15**2
      t84 = 1/t83
      t85 = t6*t84
      t87 = -t44-0.9268252376942842D0*t49
      t90 = -0.2067834969664667D0*t80*t37-0.6203504908994D0*t85*t87
      t91 = t90*t55
      t92 = t91*t15
      t94 = t22**2
      t95 = 1/t94
      t96 = t95*t48
      t98 = 1.D0+0.223816694236D2*t95
      t99 = 1/t98
      t101 = t96*t37*t99
      t103 = t27*t16
      t106 = t28*t84
      t109 = -0.2625411059665811D0*t103*t49-1.D0*t106*t87
      t110 = 1/t28
      t111 = t109*t110
      t112 = t111*t15
      vrhob(i) = t13+t20+t26+t31+rhob*(0.2D-21*t56*t9-0.1D-21*t61*t48
     #*t37*t65+0.1D-23*t77*t9+0.2505897912236993D-1*t92
     #+0.6519760588836059D-1*t101+0.2247867095542612D-2*t112)
      v2rhoa2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t120 = 1/t47/t1
      t122 = t36**2
      t123 = 1/t122
      t128 = 1/t33/t1
      t130 = t128*t10*t123
      t137 = 1/t36/rhob
      t141 = 1/t40/t9
      t143 = t51**2
      t147 = 0.1378556646443111D0*t128*t123
      t149 = 0.4135669939329333D0*t34*t137
      t150 = t120*t123
      t152 = t48*t137
      t154 = -t147+t149-0.4077525916766971D0*t150+0.978606220024073D0
     #*t152
      t192 = t123*t99
      t201 = t94**2
      t205 = t98**2
      t211 = t128*t16*t123
      t220 = 1/t83/t15
      t222 = t87**2
      t227 = -t147+t149-0.7723543647452368D0*t150+0.1853650475388568D1
     #*t152
      s1 = 0.1D-21*t61*t120*t123*t65+0.2D-21*(-0.1378556646443111D0
     #*t130+0.4135669939329333D0*t34*t41*t37*t51+0.4135669939329333D0
     #*t35*t137+0.12407009817988D1*t6*t141*t143-0.6203504908994D0*t42
     #*t154)*t55*t9+0.2D-21*t56*t51+0.1D-23*(0.3446391616107778D-1
     #*t130+0.5250822119331622D0*t4*t41*t49*t51-0.2187842549721509D0
     #*t69*t150+0.5250822119331622D0*t69*t152+2.D0*t5*t141*t143-1.D0
     #*t72*t154)*t76*t9+0.1D-23*t77*t51+0.8352993040789975D-2*t90/t6
     #/t1*t15*t37+0.3423410311260694D-1/t94/t22*t128*t192
      t263 = s1+0.5433133824030049D-1*t95*t120*t192
     #-0.1303952117767212D0*t96*t137*t99-0.7662163788798043D0/t201/t22
     #*t128*t123/t205+0.2505897912236993D-1*(-0.1378556646443111D0
     #*t211+0.4135669939329333D0*t34*t84*t37*t87+0.4135669939329333D0
     #*t80*t137+0.12407009817988D1*t6*t220*t222-0.6203504908994D0*t85
     #*t227)*t55*t15+0.2505897912236993D-1*t91*t87
     #+0.2247867095542612D-2*(0.3446391616107778D-1*t211
     #+0.5250822119331622D0*t27*t84*t49*t87-0.2187842549721509D0*t103
     #*t150+0.5250822119331622D0*t103*t152+2.D0*t28*t220*t222-1.D0
     #*t106*t227)*t110*t15+0.5901575133296437D-3*t109/t28/t27*t15*t48
     #*t37+0.2247867095542612D-2*t111*t87
      v2rhob2(i) = 0.5011795824473985D-1*t92+0.1303952117767212D0*t101
     #+0.4495734191085224D-2*t112+rhob*t263
      elseif(rhob.lt.tol) then
      rho = rhoa
      t1 = 1/rhoa
      t2 = t1**(1.D0/6.D0)
      t3 = 0.7876233178997433D0*t2
      t4 = t3+0.10498D0
      t5 = t4**2
      t6 = t1**(1.D0/3.D0)
      t7 = 0.6203504908994D0*t6
      t9 = t7+0.2935818660072219D1*t2+0.129352D2
      t10 = 1/t9
      t12 = dlog(t5*t10)
      t13 = 0.1D-23*t12
      t15 = t7+0.5560951426165705D1*t2+0.180578D2
      t16 = 1/t15
      t19 = dlog(0.6203504908994D0*t6*t16)
      t20 = 0.1554535D-1*t19
      t21 = 0.1575246635799487D1*t2
      t22 = t21+0.706042D1
      t25 = datan(0.4730926909560113D1/t22)
      t26 = 0.5249139316978094D-1*t25
      t27 = t3+0.325D0
      t28 = t27**2
      t30 = dlog(t28*t16)
      t31 = 0.2247867095542612D-2*t30
      zk(i) = rhoa*(t13+t20+t26+t31)
      t33 = t6**2
      t34 = 1/t33
      t35 = t34*t10
      t36 = rhoa**2
      t37 = 1/t36
      t40 = t9**2
      t41 = 1/t40
      t42 = t6*t41
      t44 = 0.2067834969664667D0*t34*t37
      t45 = t2**2
      t46 = t45**2
      t47 = t46*t2
      t48 = 1/t47
      t49 = t48*t37
      t51 = -t44-0.4893031100120365D0*t49
      t55 = 1/t6
      t56 = (-0.2067834969664667D0*t35*t37-0.6203504908994D0*t42*t51)
     #*t55
      t60 = (t21+0.372744D1)**2
      t61 = 1/t60
      t65 = 1/(1.D0+0.378469910464D2*t61)
      t69 = t4*t10
      t72 = t5*t41
      t76 = 1/t5
      t77 = (-0.2625411059665811D0*t69*t49-1.D0*t72*t51)*t76
      t80 = t34*t16
      t83 = t15**2
      t84 = 1/t83
      t85 = t6*t84
      t87 = -t44-0.9268252376942842D0*t49
      t90 = -0.2067834969664667D0*t80*t37-0.6203504908994D0*t85*t87
      t91 = t90*t55
      t92 = t91*t15
      t94 = t22**2
      t95 = 1/t94
      t96 = t95*t48
      t98 = 1.D0+0.223816694236D2*t95
      t99 = 1/t98
      t101 = t96*t37*t99
      t103 = t27*t16
      t106 = t28*t84
      t109 = -0.2625411059665811D0*t103*t49-1.D0*t106*t87
      t110 = 1/t28
      t111 = t109*t110
      t112 = t111*t15
      vrhoa(i) = t13+t20+t26+t31+rhoa*(0.2D-21*t56*t9-0.1D-21*t61*t48
     #*t37*t65+0.1D-23*t77*t9+0.2505897912236993D-1*t92
     #+0.6519760588836059D-1*t101+0.2247867095542612D-2*t112)
      vrhob(i) = 0.D0
      t120 = 1/t47/t1
      t122 = t36**2
      t123 = 1/t122
      t128 = 1/t33/t1
      t130 = t128*t10*t123
      t137 = 1/t36/rhoa
      t141 = 1/t40/t9
      t143 = t51**2
      t147 = 0.1378556646443111D0*t128*t123
      t149 = 0.4135669939329333D0*t34*t137
      t150 = t120*t123
      t152 = t48*t137
      t154 = -t147+t149-0.4077525916766971D0*t150+0.978606220024073D0
     #*t152
      t192 = t123*t99
      t201 = t94**2
      t205 = t98**2
      t211 = t128*t16*t123
      t220 = 1/t83/t15
      t222 = t87**2
      t227 = -t147+t149-0.7723543647452368D0*t150+0.1853650475388568D1
     #*t152
      s1 = 0.1D-21*t61*t120*t123*t65+0.2D-21*(-0.1378556646443111D0
     #*t130+0.4135669939329333D0*t34*t41*t37*t51+0.4135669939329333D0
     #*t35*t137+0.12407009817988D1*t6*t141*t143-0.6203504908994D0*t42
     #*t154)*t55*t9+0.2D-21*t56*t51+0.1D-23*(0.3446391616107778D-1
     #*t130+0.5250822119331622D0*t4*t41*t49*t51-0.2187842549721509D0
     #*t69*t150+0.5250822119331622D0*t69*t152+2.D0*t5*t141*t143-1.D0
     #*t72*t154)*t76*t9+0.1D-23*t77*t51+0.8352993040789975D-2*t90/t6
     #/t1*t15*t37+0.3423410311260694D-1/t94/t22*t128*t192
      t263 = s1+0.5433133824030049D-1*t95*t120*t192
     #-0.1303952117767212D0*t96*t137*t99-0.7662163788798043D0/t201/t22
     #*t128*t123/t205+0.2505897912236993D-1*(-0.1378556646443111D0
     #*t211+0.4135669939329333D0*t34*t84*t37*t87+0.4135669939329333D0
     #*t80*t137+0.12407009817988D1*t6*t220*t222-0.6203504908994D0*t85
     #*t227)*t55*t15+0.2505897912236993D-1*t91*t87
     #+0.2247867095542612D-2*(0.3446391616107778D-1*t211
     #+0.5250822119331622D0*t27*t84*t49*t87-0.2187842549721509D0*t103
     #*t150+0.5250822119331622D0*t103*t152+2.D0*t28*t220*t222-1.D0
     #*t106*t227)*t110*t15+0.5901575133296437D-3*t109/t28/t27*t15*t48
     #*t37+0.2247867095542612D-2*t111*t87
      v2rhoa2(i) = 0.5011795824473985D-1*t92+0.1303952117767212D0*t101
     #+0.4495734191085224D-2*t112+rhoa*t263
      v2rhob2(i) = 0.D0
      v2rhoab(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      t1 = 1/rho
      t2 = t1**(1.D0/3.D0)
      t3 = 0.6203504908994D0*t2
      t4 = t1**(1.D0/6.D0)
      t6 = t3+0.2935818660072219D1*t4+0.129352D2
      t7 = 1/t6
      t10 = dlog(0.6203504908994D0*t2*t7)
      t11 = 0.310907D-1*t10
      t12 = 0.1575246635799487D1*t4
      t13 = t12+0.372744D1
      t16 = datan(0.615199081975908D1/t13)
      t17 = 0.3878329487811301D-1*t16
      t18 = 0.7876233178997433D0*t4
      t19 = t18+0.10498D0
      t20 = t19**2
      t22 = dlog(t20*t7)
      t23 = 0.9690227711544374D-3*t22
      t25 = t3+0.8908571061768626D0*t4+0.130045D2
      t26 = 1/t25
      t29 = dlog(0.6203504908994D0*t2*t26)
      t30 = t12+0.113107D1
      t33 = datan(0.7123108917818118D1/t30)
      t35 = t18+0.47584D-2
      t36 = t35**2
      t38 = dlog(t36*t26)
      t40 = t29+0.3177080047439415D0*t33+0.4140337942820627D-3*t38
      t42 = rhoa-1.D0*rhob
      t43 = t42*t1
      t44 = 1.D0+t43
      t45 = t44**(1.D0/3.D0)
      t48 = 1.D0-1.D0*t43
      t49 = t48**(1.D0/3.D0)
      t51 = t45*t44+t49*t48-2.D0
      t52 = t40*t51
      t54 = t3+0.5560951426165705D1*t4+0.180578D2
      t55 = 1/t54
      t58 = dlog(0.6203504908994D0*t2*t55)
      t60 = t12+0.706042D1
      t63 = datan(0.4730926909560113D1/t60)
      t65 = t18+0.325D0
      t66 = t65**2
      t68 = dlog(t66*t55)
      t73 = 0.1554535D-1*t58+0.5249139316978094D-1*t63
     #+0.2247867095542612D-2*t68-0.310907D-1*t10-0.3878329487811301D-1
     #*t16-0.9690227711544374D-3*t22
      t74 = 1/t40
      t77 = -0.101257459063883D3*t73*t74-1.D0
      t78 = t42**2
      t79 = t78**2
      t80 = t77*t79
      t81 = rho**2
      t82 = t81**2
      t83 = 1/t82
      t85 = 1.D0+t80*t83
      t87 = 0.1899772193293833D-1*t52*t85
      zk(i) = rho*(t11+t17+t23-t87)
      t93 = 0.1333333333333333D1*t45*t1-0.1333333333333333D1*t49*t1
      t94 = t40*t93
      t95 = t94*t85
      t96 = 0.1899772193293833D-1*t95
      t97 = t78*t42
      t98 = t77*t97
      t99 = t98*t83
      t100 = t52*t99
      t104 = t2**2
      t105 = 1/t104
      t106 = t105*t7
      t107 = 1/t81
      t110 = t6**2
      t111 = 1/t110
      t112 = t2*t111
      t114 = 0.2067834969664667D0*t105*t107
      t115 = t4**2
      t116 = t115**2
      t117 = t116*t4
      t118 = 1/t117
      t119 = t118*t107
      t121 = -t114-0.4893031100120365D0*t119
      t124 = -0.2067834969664667D0*t106*t107-0.6203504908994D0*t112*t121
      t125 = 1/t2
      t126 = t124*t125
      t127 = t126*t6
      t129 = t13**2
      t130 = 1/t129
      t131 = t130*t118
      t133 = 1.D0+0.378469910464D2*t130
      t134 = 1/t133
      t136 = t131*t107*t134
      t138 = t19*t7
      t141 = t20*t111
      t144 = -0.2625411059665811D0*t138*t119-1.D0*t141*t121
      t145 = 1/t20
      t146 = t144*t145
      t147 = t146*t6
      t149 = t105*t26
      t152 = t25**2
      t153 = 1/t152
      t154 = t2*t153
      t156 = -t114-0.1484761843628104D0*t119
      t159 = -0.2067834969664667D0*t149*t107-0.6203504908994D0*t154*t156
      t160 = t159*t125
      t163 = t30**2
      t164 = 1/t163
      t165 = t164*t118
      t167 = 1.D0+0.507386806551D2*t164
      t168 = 1/t167
      t172 = t35*t26
      t175 = t36*t153
      t178 = -0.2625411059665811D0*t172*t119-1.D0*t175*t156
      t179 = 1/t36
      t180 = t178*t179
      t183 = 0.161199195401647D1*t160*t25+0.5941485651138659D0*t165
     #*t107*t168+0.4140337942820627D-3*t180*t25
      t184 = t183*t51
      t185 = t184*t85
      t187 = t45*t42
      t190 = t49*t42
      t193 = -0.1333333333333333D1*t187*t107+0.1333333333333333D1*t190
     #*t107
      t194 = t40*t193
      t195 = t194*t85
      t197 = t105*t55
      t200 = t54**2
      t201 = 1/t200
      t202 = t2*t201
      t204 = -t114-0.9268252376942842D0*t119
      t207 = -0.2067834969664667D0*t197*t107-0.6203504908994D0*t202*t204
      t208 = t207*t125
      t211 = t60**2
      t212 = 1/t211
      t213 = t212*t118
      t215 = 1.D0+0.223816694236D2*t212
      t216 = 1/t215
      t220 = t65*t55
      t223 = t66*t201
      t226 = -0.2625411059665811D0*t220*t119-1.D0*t223*t204
      t227 = 1/t66
      t228 = t226*t227
      t234 = 0.2505897912236993D-1*t208*t54+0.6519760588836059D-1*t213
     #*t107*t216+0.2247867095542612D-2*t228*t54-0.5011795824473985D-1
     #*t127-0.626408570946439D-1*t136-0.9690227711544374D-3*t147
      t237 = t40**2
      t238 = 1/t237
      t239 = t73*t238
      t242 = -0.101257459063883D3*t234*t74+0.101257459063883D3*t239*t183
      t243 = t242*t79
      t246 = 1/t82/rho
      t249 = t243*t83-4.D0*t80*t246
      t250 = t52*t249
      t253 = rho*(0.5011795824473985D-1*t127+0.626408570946439D-1*t136
     #+0.9690227711544374D-3*t147-0.1899772193293833D-1*t185
     #-0.1899772193293833D-1*t195-0.1899772193293833D-1*t250)
      vrhoa(i) = rho*(-t96-0.7599088773175333D-1*t100)+t11+t17+t23-t87
     #+t253
      t254 = -t93
      t255 = t40*t254
      t256 = t255*t85
      t257 = 0.1899772193293833D-1*t256
      vrhob(i) = rho*(-t257+0.7599088773175333D-1*t100)+t11+t17+t23
     #-t87+t253
      t261 = t45**2
      t262 = 1/t261
      t265 = t49**2
      t266 = 1/t265
      t269 = 0.4444444444444444D0*t262*t107+0.4444444444444444D0*t266
     #*t107
      t272 = 0.1899772193293833D-1*t40*t269*t85
      t273 = t94*t99
      t277 = t52*t77*t78*t83
      t278 = 0.22797266319526D0*t277
      t285 = 0.1899772193293833D-1*t183*t93*t85
      t286 = t184*t99
      t287 = 0.7599088773175333D-1*t286
      t290 = 1/t81/rho
      t300 = -0.4444444444444444D0*t262*t42*t290-0.1333333333333333D1
     #*t45*t107-0.4444444444444444D0*t266*t42*t290
     #+0.1333333333333333D1*t49*t107
      t303 = 0.1899772193293833D-1*t40*t300*t85
      t304 = t194*t99
      t305 = 0.7599088773175333D-1*t304
      t307 = 0.1899772193293833D-1*t94*t249
      t309 = t242*t97*t83
      t311 = t98*t246
      t313 = 4.D0*t309-16.D0*t311
      t317 = rho*(-t285-t287-t303-t305-t307-0.1899772193293833D-1*t52
     #*t313)
      t318 = t52*t309
      t320 = t52*t311
      t323 = rho*(-t285-t303-t307-t287-t305-0.7599088773175333D-1*t318
     #+0.3039635509270133D0*t320)
      t324 = 0.1002359164894797D0*t127
      t325 = 0.1252817141892878D0*t136
      t326 = 0.1938045542308875D-2*t147
      t327 = 0.3799544386587666D-1*t185
      t328 = 0.3799544386587666D-1*t195
      t329 = 0.3799544386587666D-1*t250
      t331 = 1/t104/t1
      t333 = t331*t7*t83
      t342 = 1/t110/t6
      t344 = t121**2
      t348 = 0.1378556646443111D0*t331*t83
      t350 = 0.4135669939329333D0*t105*t290
      t352 = 1/t117/t1
      t353 = t352*t83
      t355 = t118*t290
      t357 = -t348+t350-0.4077525916766971D0*t353+0.978606220024073D0
     #*t355
      t362 = (-0.1378556646443111D0*t333+0.4135669939329333D0*t105
     #*t111*t107*t121+0.4135669939329333D0*t106*t290
     #+0.12407009817988D1*t2*t342*t344-0.6203504908994D0*t112*t357)
     #*t125*t6
      t365 = 1/t2/t1
      t368 = t124*t365*t6*t107
      t370 = t126*t121
      t375 = t83*t134
      t376 = 1/t129/t13*t331*t375
      t379 = t130*t352*t375
      t382 = t131*t290*t134
      t384 = t129**2
      t388 = t133**2
      t391 = 1/t384/t13*t331*t83/t388
      t409 = (0.3446391616107778D-1*t333+0.5250822119331622D0*t19*t111
     #*t119*t121-0.2187842549721509D0*t138*t353+0.5250822119331622D0
     #*t138*t355+2.D0*t20*t342*t344-1.D0*t141*t357)*t145*t6
      t416 = t144/t20/t19*t6*t118*t107
      t418 = t146*t121
      t421 = t331*t26*t83
      t430 = 1/t152/t25
      t432 = t156**2
      t437 = -t348+t350-0.1237301536356754D0*t353+0.2969523687256209D0
     #*t355
      t453 = t83*t168
      t462 = t163**2
      t466 = t167**2
      t498 = 0.161199195401647D1*(-0.1378556646443111D0*t421
     #+0.4135669939329333D0*t105*t153*t107*t156+0.4135669939329333D0
     #*t149*t290+0.12407009817988D1*t2*t430*t432-0.6203504908994D0
     #*t154*t437)*t125*t25+0.5373306513388232D0*t159*t365*t25*t107
     #+0.161199195401647D1*t160*t156+0.3119768427869032D0/t163/t30
     #*t331*t453+0.495123804261555D0*t164*t352*t453
     #-0.1188297130227732D1*t165*t290*t168-0.1582929339795102D2/t462
     #/t30*t331*t83/t466+0.4140337942820627D-3*(0.3446391616107778D-1
     #*t421+0.5250822119331622D0*t35*t153*t119*t156
     #-0.2187842549721509D0*t172*t353+0.5250822119331622D0*t172*t355
     #+2.D0*t36*t430*t432-1.D0*t175*t437)*t179*t25
     #+0.1087008902583527D-3*t178/t36/t35*t25*t118*t107
     #+0.4140337942820627D-3*t180*t156
      t524 = t331*t55*t83
      t533 = 1/t200/t54
      t535 = t204**2
      t540 = -t348+t350-0.7723543647452368D0*t353+0.1853650475388568D1
     #*t355
      t556 = t83*t216
      t565 = t211**2
      t569 = t215**2
      s1 = 0.2505897912236993D-1*(-0.1378556646443111D0*t524
     #+0.4135669939329333D0*t105*t201*t107*t204+0.4135669939329333D0
     #*t197*t290+0.12407009817988D1*t2*t533*t535-0.6203504908994D0
     #*t202*t540)*t125*t54+0.8352993040789975D-2*t207*t365*t54*t107
     #+0.2505897912236993D-1*t208*t204+0.3423410311260694D-1/t211/t60
     #*t331*t556+0.5433133824030049D-1*t212*t352*t556
     #-0.1303952117767212D0*t213*t290*t216-0.7662163788798043D0/t565
     #/t60*t331*t83/t569+0.2247867095542612D-2*(0.3446391616107778D-1
     #*t524+0.5250822119331622D0*t65*t201*t119*t204
     #-0.2187842549721509D0*t220*t353+0.5250822119331622D0*t220*t355
     #+2.D0*t66*t533*t535-1.D0*t223*t540)*t227*t54
     #+0.5901575133296437D-3*t226/t66/t65*t54*t118*t107
     #+0.2247867095542612D-2*t228*t204
      t611 = s1-0.5011795824473985D-1*t362-0.1670598608157995D-1*t368
     #-0.5011795824473985D-1*t370-0.3289159980064473D-1*t376
     #-0.5220071424553658D-1*t379+0.1252817141892878D0*t382
     #+0.1244848083156773D1*t391-0.9690227711544374D-3*t409
     #-0.2544083100456872D-3*t416-0.9690227711544374D-3*t418
      t620 = t183**2
      t637 = 0.5011795824473985D-1*t362+0.1670598608157995D-1*t368
     #+0.5011795824473985D-1*t370+0.3289159980064473D-1*t376
     #+0.5220071424553658D-1*t379-0.1252817141892878D0*t382
     #-0.1244848083156773D1*t391+0.9690227711544374D-3*t409
     #+0.2544083100456872D-3*t416+0.9690227711544374D-3*t418
     #-0.1899772193293833D-1*t498*t51*t85-0.3799544386587666D-1*t183
     #*t193*t85-0.3799544386587666D-1*t184*t249-0.1899772193293833D-1
     #*t40*(0.4444444444444444D0*t262*t78*t83+0.2666666666666667D1
     #*t187*t290+0.4444444444444444D0*t266*t78*t83
     #-0.2666666666666667D1*t190*t290)*t85-0.3799544386587666D-1*t194
     #*t249-0.1899772193293833D-1*t52*((-0.101257459063883D3*t611*t74
     #+0.2025149181277661D3*t234*t238*t183-0.2025149181277661D3*t73
     #/t237/t40*t620+0.101257459063883D3*t239*t498)*t79*t83-8.D0*t243
     #*t246+20.D0*t80/t82/t81)
      t638 = rho*t637
      v2rhoa2(i) = rho*(-t272-0.1519817754635067D0*t273-t278)
     #-0.3799544386587666D-1*t95-0.1519817754635067D0*t100+t317+t323
     #+t324+t325+t326-t327-t328-t329+t638
      t639 = t255*t99
      t647 = 0.1899772193293833D-1*t183*t254*t85
      t648 = 0.7599088773175333D-1*t286
      t652 = -0.1899772193293833D-1*t40*t300*t85
      t653 = 0.7599088773175333D-1*t304
      t655 = 0.1899772193293833D-1*t255*t249
      t660 = rho*(-t647+t648-t652+t653-t655+0.1899772193293833D-1*t52
     #*t313)
      t664 = rho*(-t647-t652-t655+t648+t653+0.7599088773175333D-1*t318
     #-0.3039635509270133D0*t320)
      v2rhob2(i) = rho*(-t272+0.1519817754635067D0*t639-t278)
     #-0.3799544386587666D-1*t256+0.1519817754635067D0*t100+t660+t664
     #+t324+t325+t326-t327-t328-t329+t638
      v2rhoab(i) = rho*(0.1899772193293833D-1*t40*t269*t85
     #+0.7599088773175333D-1*t273-0.7599088773175333D-1*t639
     #+0.22797266319526D0*t277)-t257+0.5D0*t660-t96+0.5D0*t323+t324
     #+t325+t326-t327-t328-t329+t638+0.5D0*t317+0.5D0*t664
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      v2rhob2(i) = 0.0d0
      v2rhoab(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end
      
      
      subroutine rks_c_vwn5
     & (ideriv,npt,rhoa1,sigmaaa1,
     &  zk,vrhoa,vsigmaaa,
     &  v2rhoa2,v2rhoasigmaaa,v2sigmaaa2)
c
c     S.H. Vosko, L. Wilk, and M. Nusair
c     Accurate spin-dependent electron liquid correlation energies for
c     local spin density calculations: a critical analysis
c     Can. J. Phys. 58 (1980) 1200-1211
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt)
      REAL sigmaaa1(npt)
      REAL zk(npt),vrhoa(npt),vsigmaaa(npt)
      REAL v2rhoa2(npt),v2rhoasigmaaa(npt),v2sigmaaa2(npt)
      parameter(tol=1.0d-20)
      
      if(ideriv.eq.0) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      t1 = 1/rho
      t2 = t1**(1.D0/3.D0)
      t4 = t1**(1.D0/6.D0)
      t7 = 1/(0.6203504908994D0*t2+0.2935818660072219D1*t4+0.129352D2)
      t10 = dlog(0.6203504908994D0*t2*t7)
      t16 = datan(0.615199081975908D1/(0.1575246635799487D1*t4
     #+0.372744D1))
      t20 = (0.7876233178997433D0*t4+0.10498D0)**2
      t22 = dlog(t20*t7)
      zk(i) = rho*(0.310907D-1*t10+0.3878329487811301D-1*t16
     #+0.9690227711544374D-3*t22)
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      t1 = 1/rho
      t2 = t1**(1.D0/3.D0)
      t4 = t1**(1.D0/6.D0)
      t6 = 0.6203504908994D0*t2+0.2935818660072219D1*t4+0.129352D2
      t7 = 1/t6
      t10 = dlog(0.6203504908994D0*t2*t7)
      t11 = 0.310907D-1*t10
      t13 = 0.1575246635799487D1*t4+0.372744D1
      t16 = datan(0.615199081975908D1/t13)
      t17 = 0.3878329487811301D-1*t16
      t19 = 0.7876233178997433D0*t4+0.10498D0
      t20 = t19**2
      t22 = dlog(t20*t7)
      t23 = 0.9690227711544374D-3*t22
      zk(i) = rho*(t11+t17+t23)
      t25 = t2**2
      t26 = 1/t25
      t28 = rho**2
      t29 = 1/t28
      t32 = t6**2
      t33 = 1/t32
      t37 = t4**2
      t38 = t37**2
      t40 = 1/t38/t4
      t41 = t40*t29
      t43 = -0.2067834969664667D0*t26*t29-0.4893031100120365D0*t41
      t51 = t13**2
      t52 = 1/t51
      vrhoa(i) = t11+t17+t23+rho*(0.5011795824473985D-1*(
     #-0.2067834969664667D0*t26*t7*t29-0.6203504908994D0*t2*t33*t43)
     #/t2*t6+0.626408570946439D-1*t52*t40*t29/(1.D0+0.378469910464D2
     #*t52)+0.9690227711544374D-3*(-0.2625411059665811D0*t19*t7*t41
     #-1.D0*t20*t33*t43)/t20*t6)
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      t1 = 1/rho
      t2 = t1**(1.D0/3.D0)
      t4 = t1**(1.D0/6.D0)
      t6 = 0.6203504908994D0*t2+0.2935818660072219D1*t4+0.129352D2
      t7 = 1/t6
      t10 = dlog(0.6203504908994D0*t2*t7)
      t11 = 0.310907D-1*t10
      t13 = 0.1575246635799487D1*t4+0.372744D1
      t16 = datan(0.615199081975908D1/t13)
      t17 = 0.3878329487811301D-1*t16
      t19 = 0.7876233178997433D0*t4+0.10498D0
      t20 = t19**2
      t22 = dlog(t20*t7)
      t23 = 0.9690227711544374D-3*t22
      zk(i) = rho*(t11+t17+t23)
      t25 = t2**2
      t26 = 1/t25
      t27 = t26*t7
      t28 = rho**2
      t29 = 1/t28
      t32 = t6**2
      t33 = 1/t32
      t34 = t2*t33
      t37 = t4**2
      t38 = t37**2
      t39 = t38*t4
      t40 = 1/t39
      t41 = t40*t29
      t43 = -0.2067834969664667D0*t26*t29-0.4893031100120365D0*t41
      t46 = -0.2067834969664667D0*t27*t29-0.6203504908994D0*t34*t43
      t47 = 1/t2
      t48 = t46*t47
      t49 = t48*t6
      t51 = t13**2
      t52 = 1/t51
      t53 = t52*t40
      t55 = 1.D0+0.378469910464D2*t52
      t56 = 1/t55
      t58 = t53*t29*t56
      t60 = t19*t7
      t63 = t20*t33
      t66 = -0.2625411059665811D0*t60*t41-1.D0*t63*t43
      t67 = 1/t20
      t68 = t66*t67
      t69 = t68*t6
      vrhoa(i) = t11+t17+t23+rho*(0.5011795824473985D-1*t49
     #+0.626408570946439D-1*t58+0.9690227711544374D-3*t69)
      t77 = 1/t25/t1
      t79 = t28**2
      t80 = 1/t79
      t81 = t77*t7*t80
      t88 = 1/t28/rho
      t92 = 1/t32/t6
      t94 = t43**2
      t102 = 1/t39/t1
      t103 = t102*t80
      t105 = t40*t88
      t107 = -0.1378556646443111D0*t77*t80+0.4135669939329333D0*t26
     #*t88-0.4077525916766971D0*t103+0.978606220024073D0*t105
      t125 = t80*t56
      t134 = t51**2
      t138 = t55**2
      s1 = 0.2004718329789594D0*t49+0.2505634283785756D0*t58
      v2rhoa2(i) = s1+0.387609108461775D-2*t69+2.D0*rho*
     #(0.5011795824473985D-1*(-0.1378556646443111D0*t81
     #+0.4135669939329333D0*t26*t33*t29*t43+0.4135669939329333D0*t27
     #*t88+0.12407009817988D1*t2*t92*t94-0.6203504908994D0*t34*t107)
     #*t47*t6+0.1670598608157995D-1*t46/t2/t1*t6*t29
     #+0.5011795824473985D-1*t48*t43+0.3289159980064473D-1/t51/t13*t77
     #*t125+0.5220071424553658D-1*t52*t102*t125-0.1252817141892878D0
     #*t53*t88*t56-0.1244848083156773D1/t134/t13*t77*t80/t138
     #+0.9690227711544374D-3*(0.3446391616107778D-1*t81
     #+0.5250822119331622D0*t19*t33*t41*t43-0.2187842549721509D0*t60
     #*t103+0.5250822119331622D0*t60*t105+2.D0*t20*t92*t94-1.D0*t63
     #*t107)*t67*t6+0.2544083100456872D-3*t66/t20/t19*t6*t40*t29
     #+0.9690227711544374D-3*t68*t43)
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end

c:C_VWN5subrend
_ENDIF
_IF(ccpdft,all,c_vwn5rpa)
c:C_VWN5RPAsubrstart

c    Generated: Tue Mar  9 16:27:09 GMT 2004

      subroutine uks_c_vwn5rpa
     & (ideriv,npt,rhoa1,rhob1,sigmaaa1,sigmabb1,sigmaab1,
     &  zk,vrhoa,vrhob,vsigmaaa,vsigmabb,vsigmaab,
     &  v2rhoa2,v2rhob2,v2rhoab,
     &  v2rhoasigmaaa,v2rhoasigmaab,v2rhoasigmabb,
     &  v2rhobsigmabb,v2rhobsigmaab,v2rhobsigmaaa,
     &  v2sigmaaa2,v2sigmaaaab,v2sigmaaabb,
     &  v2sigmaab2,v2sigmaabbb,v2sigmabb2)
c
c     S.H. Vosko, L. Wilk, and M. Nusair
c     Accurate spin-dependent electron liquid correlation energies for
c     local spin density calculations: a critical analysis
c     Can. J. Phys. 58 (1980) 1200-1211
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt),rhob1(npt)
      REAL sigmaaa1(npt),sigmabb1(npt),sigmaab1(npt)
      REAL zk(npt),vrhoa(npt),vrhob(npt)
      REAL vsigmaaa(npt),vsigmabb(npt),vsigmaab(npt)
      REAL v2rhoa2(npt),v2rhob2(npt),v2rhoab(npt)
      REAL v2rhoasigmaaa(npt),v2rhoasigmaab(npt)
      REAL v2rhoasigmabb(npt),v2rhobsigmabb(npt)
      REAL v2rhobsigmaab(npt),v2rhobsigmaaa(npt)
      REAL v2sigmaaa2(npt),v2sigmaaaab(npt),v2sigmaaabb(npt)
      REAL v2sigmaab2(npt),v2sigmaabbb(npt),v2sigmabb2(npt)
      parameter(tol=1.0d-20)
      
      if (ideriv.eq.0) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      t1 = 1/rhob
      t2 = t1**(1.D0/3.D0)
      t4 = t1**(1.D0/6.D0)
      t7 = 1/(0.6203504908994D0*t2+0.1584942278842832D2*t4+0.101578D3)
      t10 = dlog(0.6203504908994D0*t2*t7)
      t16 = datan(0.1171685277708993D1/(0.1575246635799487D1*t4
     #+0.201231D2))
      t20 = (0.7876233178997433D0*t4+0.743294D0)**2
      t22 = dlog(t20*t7)
      zk(i) = rhob*(0.1554535D-1*t10+0.6188180297906063D0*t16
     #+0.2667310007273315D-2*t22)
      elseif(rhob.lt.tol) then
      rho = rhoa
      t1 = 1/rhoa
      t2 = t1**(1.D0/3.D0)
      t4 = t1**(1.D0/6.D0)
      t7 = 1/(0.6203504908994D0*t2+0.1584942278842832D2*t4+0.101578D3)
      t10 = dlog(0.6203504908994D0*t2*t7)
      t16 = datan(0.1171685277708993D1/(0.1575246635799487D1*t4
     #+0.201231D2))
      t20 = (0.7876233178997433D0*t4+0.743294D0)**2
      t22 = dlog(t20*t7)
      zk(i) = rhoa*(0.1554535D-1*t10+0.6188180297906063D0*t16
     #+0.2667310007273315D-2*t22)
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      t1 = 1/rho
      t2 = t1**(1.D0/3.D0)
      t3 = 0.6203504908994D0*t2
      t4 = t1**(1.D0/6.D0)
      t7 = 1/(t3+0.1029581201158544D2*t4+0.427198D2)
      t10 = dlog(0.6203504908994D0*t2*t7)
      t12 = 0.1575246635799487D1*t4
      t16 = datan(0.448998886412873D-1/(t12+0.13072D2))
      t18 = 0.7876233178997433D0*t4
      t20 = (t18+0.409286D0)**2
      t22 = dlog(t20*t7)
      t26 = 1/(t3+0.8414573716781907D0*t4+0.114813D2)
      t29 = dlog(0.6203504908994D0*t2*t26)
      t33 = datan(0.6692072046645941D1/(t12+0.106835D1))
      t36 = (t18+0.228344D0)**2
      t38 = dlog(t36*t26)
      t40 = t29+0.3232383690605507D0*t33+0.2160871036089827D-1*t38
      t42 = rhoa-1.D0*rhob
      t43 = t42*t1
      t44 = 1.D0+t43
      t45 = t44**(1.D0/3.D0)
      t48 = 1.D0-1.D0*t43
      t49 = t48**(1.D0/3.D0)
      t55 = 1/(t3+0.1584942278842832D2*t4+0.101578D3)
      t58 = dlog(0.6203504908994D0*t2*t55)
      t63 = datan(0.1171685277708993D1/(t12+0.201231D2))
      t66 = (t18+0.743294D0)**2
      t68 = dlog(t66*t55)
      t78 = t42**2
      t79 = t78**2
      t81 = rho**2
      t82 = t81**2
      zk(i) = rho*(0.310907D-1*t10+0.205219729378375D2*t16
     #+0.4431373767749538D-2*t22-0.1899772193293833D-1*t40*(t45*t44
     #+t49*t48-2.D0)*(1.D0+(-0.101257459063883D3*(0.1554535D-1*t58
     #+0.6188180297906063D0*t63+0.2667310007273315D-2*t68-0.310907D-1
     #*t10-0.205219729378375D2*t16-0.4431373767749538D-2*t22)/t40-1.D0
     #)*t79/t82))
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      t1 = 1/rhob
      t2 = t1**(1.D0/3.D0)
      t3 = 0.6203504908994D0*t2
      t4 = t1**(1.D0/6.D0)
      t6 = t3+0.1584942278842832D2*t4+0.101578D3
      t7 = 1/t6
      t10 = dlog(0.6203504908994D0*t2*t7)
      t11 = 0.1554535D-1*t10
      t13 = 0.1575246635799487D1*t4+0.201231D2
      t16 = datan(0.1171685277708993D1/t13)
      t17 = 0.6188180297906063D0*t16
      t19 = 0.7876233178997433D0*t4+0.743294D0
      t20 = t19**2
      t22 = dlog(t20*t7)
      t23 = 0.2667310007273315D-2*t22
      zk(i) = rhob*(t11+t17+t23)
      vrhoa(i) = 0.D0
      t25 = t2**2
      t26 = 1/t25
      t28 = t3+0.1029581201158544D2*t4+0.427198D2
      t31 = rhob**2
      t32 = 1/t31
      t35 = t28**2
      t39 = 0.2067834969664667D0*t26*t32
      t40 = t4**2
      t41 = t40**2
      t43 = 1/t41/t4
      t44 = t43*t32
      t50 = 1/t2
      t57 = t6**2
      t58 = 1/t57
      t61 = -t39-0.2641570464738054D1*t44
      t68 = t13**2
      t69 = 1/t68
      vrhob(i) = t11+t17+t23+rhob*(0.2D-21*(-0.2067834969664667D0*t26
     #/t28*t32-0.6203504908994D0*t2/t35*(-t39-0.1715968668597574D1*t44
     #))*t50*t28+0.2505897912236993D-1*(-0.2067834969664667D0*t26*t7
     #*t32-0.6203504908994D0*t2*t58*t61)*t50*t6+0.1903580477513215D0
     #*t69*t43*t32/(1.D0+0.137284639D1*t69)+0.2667310007273315D-2*(
     #-0.2625411059665811D0*t19*t7*t44-1.D0*t20*t58*t61)/t20*t6)
      elseif(rhob.lt.tol) then
      rho = rhoa
      t1 = 1/rhoa
      t2 = t1**(1.D0/3.D0)
      t3 = 0.6203504908994D0*t2
      t4 = t1**(1.D0/6.D0)
      t6 = t3+0.1584942278842832D2*t4+0.101578D3
      t7 = 1/t6
      t10 = dlog(0.6203504908994D0*t2*t7)
      t11 = 0.1554535D-1*t10
      t13 = 0.1575246635799487D1*t4+0.201231D2
      t16 = datan(0.1171685277708993D1/t13)
      t17 = 0.6188180297906063D0*t16
      t19 = 0.7876233178997433D0*t4+0.743294D0
      t20 = t19**2
      t22 = dlog(t20*t7)
      t23 = 0.2667310007273315D-2*t22
      zk(i) = rhoa*(t11+t17+t23)
      t25 = t2**2
      t26 = 1/t25
      t28 = t3+0.1029581201158544D2*t4+0.427198D2
      t31 = rhoa**2
      t32 = 1/t31
      t35 = t28**2
      t39 = 0.2067834969664667D0*t26*t32
      t40 = t4**2
      t41 = t40**2
      t43 = 1/t41/t4
      t44 = t43*t32
      t50 = 1/t2
      t57 = t6**2
      t58 = 1/t57
      t61 = -t39-0.2641570464738054D1*t44
      t68 = t13**2
      t69 = 1/t68
      vrhoa(i) = t11+t17+t23+rhoa*(0.2D-21*(-0.2067834969664667D0*t26
     #/t28*t32-0.6203504908994D0*t2/t35*(-t39-0.1715968668597574D1*t44
     #))*t50*t28+0.2505897912236993D-1*(-0.2067834969664667D0*t26*t7
     #*t32-0.6203504908994D0*t2*t58*t61)*t50*t6+0.1903580477513215D0
     #*t69*t43*t32/(1.D0+0.137284639D1*t69)+0.2667310007273315D-2*(
     #-0.2625411059665811D0*t19*t7*t44-1.D0*t20*t58*t61)/t20*t6)
      vrhob(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      t1 = 1/rho
      t2 = t1**(1.D0/3.D0)
      t3 = 0.6203504908994D0*t2
      t4 = t1**(1.D0/6.D0)
      t6 = t3+0.1029581201158544D2*t4+0.427198D2
      t7 = 1/t6
      t10 = dlog(0.6203504908994D0*t2*t7)
      t11 = 0.310907D-1*t10
      t12 = 0.1575246635799487D1*t4
      t13 = t12+0.13072D2
      t16 = datan(0.448998886412873D-1/t13)
      t17 = 0.205219729378375D2*t16
      t18 = 0.7876233178997433D0*t4
      t19 = t18+0.409286D0
      t20 = t19**2
      t22 = dlog(t20*t7)
      t23 = 0.4431373767749538D-2*t22
      t25 = t3+0.8414573716781907D0*t4+0.114813D2
      t26 = 1/t25
      t29 = dlog(0.6203504908994D0*t2*t26)
      t30 = t12+0.106835D1
      t33 = datan(0.6692072046645941D1/t30)
      t35 = t18+0.228344D0
      t36 = t35**2
      t38 = dlog(t36*t26)
      t40 = t29+0.3232383690605507D0*t33+0.2160871036089827D-1*t38
      t42 = rhoa-1.D0*rhob
      t43 = t42*t1
      t44 = 1.D0+t43
      t45 = t44**(1.D0/3.D0)
      t48 = 1.D0-1.D0*t43
      t49 = t48**(1.D0/3.D0)
      t51 = t45*t44+t49*t48-2.D0
      t52 = t40*t51
      t54 = t3+0.1584942278842832D2*t4+0.101578D3
      t55 = 1/t54
      t58 = dlog(0.6203504908994D0*t2*t55)
      t60 = t12+0.201231D2
      t63 = datan(0.1171685277708993D1/t60)
      t65 = t18+0.743294D0
      t66 = t65**2
      t68 = dlog(t66*t55)
      t73 = 0.1554535D-1*t58+0.6188180297906063D0*t63
     #+0.2667310007273315D-2*t68-0.310907D-1*t10-0.205219729378375D2
     #*t16-0.4431373767749538D-2*t22
      t74 = 1/t40
      t77 = -0.101257459063883D3*t73*t74-1.D0
      t78 = t42**2
      t79 = t78**2
      t80 = t77*t79
      t81 = rho**2
      t82 = t81**2
      t83 = 1/t82
      t85 = 1.D0+t80*t83
      t87 = 0.1899772193293833D-1*t52*t85
      zk(i) = rho*(t11+t17+t23-t87)
      t93 = 0.1333333333333333D1*t45*t1-0.1333333333333333D1*t49*t1
      t100 = t52*t77*t78*t42*t83
      t104 = t2**2
      t105 = 1/t104
      t107 = 1/t81
      t110 = t6**2
      t111 = 1/t110
      t114 = 0.2067834969664667D0*t105*t107
      t115 = t4**2
      t116 = t115**2
      t118 = 1/t116/t4
      t119 = t118*t107
      t121 = -t114-0.1715968668597574D1*t119
      t125 = 1/t2
      t127 = (-0.2067834969664667D0*t105*t7*t107-0.6203504908994D0*t2
     #*t111*t121)*t125*t6
      t129 = t13**2
      t130 = 1/t129
      t136 = t130*t118*t107/(1.D0+0.2016D-2*t130)
      t147 = (-0.2625411059665811D0*t19*t7*t119-1.D0*t20*t111*t121)
     #/t20*t6
      t152 = t25**2
      t153 = 1/t152
      t156 = -t114-0.1402428952796985D0*t119
      t163 = t30**2
      t164 = 1/t163
      t183 = 0.161199195401647D1*(-0.2067834969664667D0*t105*t26*t107
     #-0.6203504908994D0*t2*t153*t156)*t125*t25+0.5679117119058793D0
     #*t164*t118*t107/(1.D0+0.447838282775D2*t164)
     #+0.2160871036089827D-1*(-0.2625411059665811D0*t35*t26*t119-1.D0
     #*t36*t153*t156)/t36*t25
      t200 = t54**2
      t201 = 1/t200
      t204 = -t114-0.2641570464738054D1*t119
      t211 = t60**2
      t212 = 1/t211
      t237 = t40**2
      t253 = rho*(0.5011795824473985D-1*t127+0.2419143800947354D0*t136
     #+0.4431373767749538D-2*t147-0.1899772193293833D-1*t183*t51*t85
     #-0.1899772193293833D-1*t40*(-0.1333333333333333D1*t45*t42*t107
     #+0.1333333333333333D1*t49*t42*t107)*t85-0.1899772193293833D-1
     #*t52*((-0.101257459063883D3*(0.2505897912236993D-1*(
     #-0.2067834969664667D0*t105*t55*t107-0.6203504908994D0*t2*t201
     #*t204)*t125*t54+0.1903580477513215D0*t212*t118*t107/(1.D0
     #+0.137284639D1*t212)+0.2667310007273315D-2*(
     #-0.2625411059665811D0*t65*t55*t119-1.D0*t66*t201*t204)/t66*t54
     #-0.5011795824473985D-1*t127-0.2419143800947354D0*t136
     #-0.4431373767749538D-2*t147)*t74+0.101257459063883D3*t73/t237
     #*t183)*t79*t83-4.D0*t80/t82/rho))
      vrhoa(i) = rho*(-0.1899772193293833D-1*t40*t93*t85
     #-0.7599088773175333D-1*t100)+t11+t17+t23-t87+t253
      vrhob(i) = rho*(0.1899772193293833D-1*t40*t93*t85
     #+0.7599088773175333D-1*t100)+t11+t17+t23-t87+t253
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      t1 = 1/rhob
      t2 = t1**(1.D0/3.D0)
      t3 = 0.6203504908994D0*t2
      t4 = t1**(1.D0/6.D0)
      t6 = t3+0.1584942278842832D2*t4+0.101578D3
      t7 = 1/t6
      t10 = dlog(0.6203504908994D0*t2*t7)
      t11 = 0.1554535D-1*t10
      t12 = 0.1575246635799487D1*t4
      t13 = t12+0.201231D2
      t16 = datan(0.1171685277708993D1/t13)
      t17 = 0.6188180297906063D0*t16
      t19 = 0.7876233178997433D0*t4+0.743294D0
      t20 = t19**2
      t22 = dlog(t20*t7)
      t23 = 0.2667310007273315D-2*t22
      zk(i) = rhob*(t11+t17+t23)
      vrhoa(i) = 0.D0
      t25 = t2**2
      t26 = 1/t25
      t28 = t3+0.1029581201158544D2*t4+0.427198D2
      t29 = 1/t28
      t30 = t26*t29
      t31 = rhob**2
      t32 = 1/t31
      t35 = t28**2
      t36 = 1/t35
      t37 = t2*t36
      t39 = 0.2067834969664667D0*t26*t32
      t40 = t4**2
      t41 = t40**2
      t42 = t41*t4
      t43 = 1/t42
      t44 = t43*t32
      t46 = -t39-0.1715968668597574D1*t44
      t50 = 1/t2
      t51 = (-0.2067834969664667D0*t30*t32-0.6203504908994D0*t37*t46)
     #*t50
      t54 = t26*t7
      t57 = t6**2
      t58 = 1/t57
      t59 = t2*t58
      t61 = -t39-0.2641570464738054D1*t44
      t64 = -0.2067834969664667D0*t54*t32-0.6203504908994D0*t59*t61
      t65 = t64*t50
      t66 = t65*t6
      t68 = t13**2
      t69 = 1/t68
      t70 = t69*t43
      t72 = 1.D0+0.137284639D1*t69
      t73 = 1/t72
      t75 = t70*t32*t73
      t77 = t19*t7
      t80 = t20*t58
      t83 = -0.2625411059665811D0*t77*t44-1.D0*t80*t61
      t84 = 1/t20
      t85 = t83*t84
      t86 = t85*t6
      vrhob(i) = t11+t17+t23+rhob*(0.2D-21*t51*t28
     #+0.2505897912236993D-1*t66+0.1903580477513215D0*t75
     #+0.2667310007273315D-2*t86)
      v2rhoa2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t91 = (t12+0.13072D2)**2
      t92 = 1/t91
      t104 = 1/t25/t1
      t106 = t31**2
      t107 = 1/t106
      t115 = 1/t31/rhob
      t121 = t46**2
      t125 = 0.1378556646443111D0*t104*t107
      t127 = 0.4135669939329333D0*t26*t115
      t129 = 1/t42/t1
      t130 = t129*t107
      t132 = t43*t115
      t152 = t107*t73
      t161 = t68**2
      t165 = t72**2
      t171 = t104*t7*t107
      t180 = 1/t57/t6
      t182 = t61**2
      t187 = -t125+t127-0.2201308720615045D1*t130+0.5283140929476108D1
     #*t132
      s1 = 0.2D-21*(-0.1378556646443111D0*t104*t29*t107
     #+0.4135669939329333D0*t26*t36*t32*t46+0.4135669939329333D0*t30
     #*t115+0.12407009817988D1*t2/t35/t28*t121-0.6203504908994D0*t37*(
     #-t125+t127-0.1429973890497978D1*t130+0.3431937337195148D1*t132))
     #*t50*t28+0.2D-21*t51*t46+0.8352993040789975D-2*t64/t2/t1*t6*t32
     #+0.9995362477254242D-1/t68/t13*t104*t152+0.1586317064594346D0
     #*t69*t129*t152-0.3807160955026431D0*t70*t115*t73
      t223 = s1-0.1372209729363994D0/t161/t13*t104*t107/t165
     #+0.2505897912236993D-1*(-0.1378556646443111D0*t171
     #+0.4135669939329333D0*t26*t58*t32*t61+0.4135669939329333D0*t54
     #*t115+0.12407009817988D1*t2*t180*t182-0.6203504908994D0*t59*t187
     #)*t50*t6+0.2505897912236993D-1*t65*t61+0.2667310007273315D-2*
     #(0.3446391616107778D-1*t171+0.5250822119331622D0*t19*t58*t44*t61
     #-0.2187842549721509D0*t77*t130+0.5250822119331622D0*t77*t132
     #+2.D0*t20*t180*t182-1.D0*t80*t187)*t84*t6+0.7002785192652656D-3
     #*t83/t20/t19*t6*t43*t32+0.2667310007273315D-2*t85*t61
      v2rhob2(i) = 0.1D-20*t92*t43*t32/(1.D0+0.2016D-2*t92)
     #+0.5011795824473985D-1*t66+0.3807160955026431D0*t75
     #+0.533462001454663D-2*t86+rhob*t223
      elseif(rhob.lt.tol) then
      rho = rhoa
      t1 = 1/rhoa
      t2 = t1**(1.D0/3.D0)
      t3 = 0.6203504908994D0*t2
      t4 = t1**(1.D0/6.D0)
      t6 = t3+0.1584942278842832D2*t4+0.101578D3
      t7 = 1/t6
      t10 = dlog(0.6203504908994D0*t2*t7)
      t11 = 0.1554535D-1*t10
      t12 = 0.1575246635799487D1*t4
      t13 = t12+0.201231D2
      t16 = datan(0.1171685277708993D1/t13)
      t17 = 0.6188180297906063D0*t16
      t19 = 0.7876233178997433D0*t4+0.743294D0
      t20 = t19**2
      t22 = dlog(t20*t7)
      t23 = 0.2667310007273315D-2*t22
      zk(i) = rhoa*(t11+t17+t23)
      t25 = t2**2
      t26 = 1/t25
      t28 = t3+0.1029581201158544D2*t4+0.427198D2
      t29 = 1/t28
      t30 = t26*t29
      t31 = rhoa**2
      t32 = 1/t31
      t35 = t28**2
      t36 = 1/t35
      t37 = t2*t36
      t39 = 0.2067834969664667D0*t26*t32
      t40 = t4**2
      t41 = t40**2
      t42 = t41*t4
      t43 = 1/t42
      t44 = t43*t32
      t46 = -t39-0.1715968668597574D1*t44
      t50 = 1/t2
      t51 = (-0.2067834969664667D0*t30*t32-0.6203504908994D0*t37*t46)
     #*t50
      t54 = t26*t7
      t57 = t6**2
      t58 = 1/t57
      t59 = t2*t58
      t61 = -t39-0.2641570464738054D1*t44
      t64 = -0.2067834969664667D0*t54*t32-0.6203504908994D0*t59*t61
      t65 = t64*t50
      t66 = t65*t6
      t68 = t13**2
      t69 = 1/t68
      t70 = t69*t43
      t72 = 1.D0+0.137284639D1*t69
      t73 = 1/t72
      t75 = t70*t32*t73
      t77 = t19*t7
      t80 = t20*t58
      t83 = -0.2625411059665811D0*t77*t44-1.D0*t80*t61
      t84 = 1/t20
      t85 = t83*t84
      t86 = t85*t6
      vrhoa(i) = t11+t17+t23+rhoa*(0.2D-21*t51*t28
     #+0.2505897912236993D-1*t66+0.1903580477513215D0*t75
     #+0.2667310007273315D-2*t86)
      vrhob(i) = 0.D0
      t91 = (t12+0.13072D2)**2
      t92 = 1/t91
      t104 = 1/t25/t1
      t106 = t31**2
      t107 = 1/t106
      t115 = 1/t31/rhoa
      t121 = t46**2
      t125 = 0.1378556646443111D0*t104*t107
      t127 = 0.4135669939329333D0*t26*t115
      t129 = 1/t42/t1
      t130 = t129*t107
      t132 = t43*t115
      t152 = t107*t73
      t161 = t68**2
      t165 = t72**2
      t171 = t104*t7*t107
      t180 = 1/t57/t6
      t182 = t61**2
      t187 = -t125+t127-0.2201308720615045D1*t130+0.5283140929476108D1
     #*t132
      s1 = 0.2D-21*(-0.1378556646443111D0*t104*t29*t107
     #+0.4135669939329333D0*t26*t36*t32*t46+0.4135669939329333D0*t30
     #*t115+0.12407009817988D1*t2/t35/t28*t121-0.6203504908994D0*t37*(
     #-t125+t127-0.1429973890497978D1*t130+0.3431937337195148D1*t132))
     #*t50*t28+0.2D-21*t51*t46+0.8352993040789975D-2*t64/t2/t1*t6*t32
     #+0.9995362477254242D-1/t68/t13*t104*t152+0.1586317064594346D0
     #*t69*t129*t152-0.3807160955026431D0*t70*t115*t73
      t223 = s1-0.1372209729363994D0/t161/t13*t104*t107/t165
     #+0.2505897912236993D-1*(-0.1378556646443111D0*t171
     #+0.4135669939329333D0*t26*t58*t32*t61+0.4135669939329333D0*t54
     #*t115+0.12407009817988D1*t2*t180*t182-0.6203504908994D0*t59*t187
     #)*t50*t6+0.2505897912236993D-1*t65*t61+0.2667310007273315D-2*
     #(0.3446391616107778D-1*t171+0.5250822119331622D0*t19*t58*t44*t61
     #-0.2187842549721509D0*t77*t130+0.5250822119331622D0*t77*t132
     #+2.D0*t20*t180*t182-1.D0*t80*t187)*t84*t6+0.7002785192652656D-3
     #*t83/t20/t19*t6*t43*t32+0.2667310007273315D-2*t85*t61
      v2rhoa2(i) = 0.1D-20*t92*t43*t32/(1.D0+0.2016D-2*t92)
     #+0.5011795824473985D-1*t66+0.3807160955026431D0*t75
     #+0.533462001454663D-2*t86+rhoa*t223
      v2rhob2(i) = 0.D0
      v2rhoab(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      t1 = 1/rho
      t2 = t1**(1.D0/3.D0)
      t3 = 0.6203504908994D0*t2
      t4 = t1**(1.D0/6.D0)
      t6 = t3+0.1029581201158544D2*t4+0.427198D2
      t7 = 1/t6
      t10 = dlog(0.6203504908994D0*t2*t7)
      t11 = 0.310907D-1*t10
      t12 = 0.1575246635799487D1*t4
      t13 = t12+0.13072D2
      t16 = datan(0.448998886412873D-1/t13)
      t17 = 0.205219729378375D2*t16
      t18 = 0.7876233178997433D0*t4
      t19 = t18+0.409286D0
      t20 = t19**2
      t22 = dlog(t20*t7)
      t23 = 0.4431373767749538D-2*t22
      t25 = t3+0.8414573716781907D0*t4+0.114813D2
      t26 = 1/t25
      t29 = dlog(0.6203504908994D0*t2*t26)
      t30 = t12+0.106835D1
      t33 = datan(0.6692072046645941D1/t30)
      t35 = t18+0.228344D0
      t36 = t35**2
      t38 = dlog(t36*t26)
      t40 = t29+0.3232383690605507D0*t33+0.2160871036089827D-1*t38
      t42 = rhoa-1.D0*rhob
      t43 = t42*t1
      t44 = 1.D0+t43
      t45 = t44**(1.D0/3.D0)
      t48 = 1.D0-1.D0*t43
      t49 = t48**(1.D0/3.D0)
      t51 = t45*t44+t49*t48-2.D0
      t52 = t40*t51
      t54 = t3+0.1584942278842832D2*t4+0.101578D3
      t55 = 1/t54
      t58 = dlog(0.6203504908994D0*t2*t55)
      t60 = t12+0.201231D2
      t63 = datan(0.1171685277708993D1/t60)
      t65 = t18+0.743294D0
      t66 = t65**2
      t68 = dlog(t66*t55)
      t73 = 0.1554535D-1*t58+0.6188180297906063D0*t63
     #+0.2667310007273315D-2*t68-0.310907D-1*t10-0.205219729378375D2
     #*t16-0.4431373767749538D-2*t22
      t74 = 1/t40
      t77 = -0.101257459063883D3*t73*t74-1.D0
      t78 = t42**2
      t79 = t78**2
      t80 = t77*t79
      t81 = rho**2
      t82 = t81**2
      t83 = 1/t82
      t85 = 1.D0+t80*t83
      t87 = 0.1899772193293833D-1*t52*t85
      zk(i) = rho*(t11+t17+t23-t87)
      t93 = 0.1333333333333333D1*t45*t1-0.1333333333333333D1*t49*t1
      t94 = t40*t93
      t95 = t94*t85
      t96 = 0.1899772193293833D-1*t95
      t97 = t78*t42
      t98 = t77*t97
      t99 = t98*t83
      t100 = t52*t99
      t104 = t2**2
      t105 = 1/t104
      t106 = t105*t7
      t107 = 1/t81
      t110 = t6**2
      t111 = 1/t110
      t112 = t2*t111
      t114 = 0.2067834969664667D0*t105*t107
      t115 = t4**2
      t116 = t115**2
      t117 = t116*t4
      t118 = 1/t117
      t119 = t118*t107
      t121 = -t114-0.1715968668597574D1*t119
      t124 = -0.2067834969664667D0*t106*t107-0.6203504908994D0*t112*t121
      t125 = 1/t2
      t126 = t124*t125
      t127 = t126*t6
      t129 = t13**2
      t130 = 1/t129
      t131 = t130*t118
      t133 = 1.D0+0.2016D-2*t130
      t134 = 1/t133
      t136 = t131*t107*t134
      t138 = t19*t7
      t141 = t20*t111
      t144 = -0.2625411059665811D0*t138*t119-1.D0*t141*t121
      t145 = 1/t20
      t146 = t144*t145
      t147 = t146*t6
      t149 = t105*t26
      t152 = t25**2
      t153 = 1/t152
      t154 = t2*t153
      t156 = -t114-0.1402428952796985D0*t119
      t159 = -0.2067834969664667D0*t149*t107-0.6203504908994D0*t154*t156
      t160 = t159*t125
      t163 = t30**2
      t164 = 1/t163
      t165 = t164*t118
      t167 = 1.D0+0.447838282775D2*t164
      t168 = 1/t167
      t172 = t35*t26
      t175 = t36*t153
      t178 = -0.2625411059665811D0*t172*t119-1.D0*t175*t156
      t179 = 1/t36
      t180 = t178*t179
      t183 = 0.161199195401647D1*t160*t25+0.5679117119058793D0*t165
     #*t107*t168+0.2160871036089827D-1*t180*t25
      t184 = t183*t51
      t185 = t184*t85
      t187 = t45*t42
      t190 = t49*t42
      t193 = -0.1333333333333333D1*t187*t107+0.1333333333333333D1*t190
     #*t107
      t194 = t40*t193
      t195 = t194*t85
      t197 = t105*t55
      t200 = t54**2
      t201 = 1/t200
      t202 = t2*t201
      t204 = -t114-0.2641570464738054D1*t119
      t207 = -0.2067834969664667D0*t197*t107-0.6203504908994D0*t202*t204
      t208 = t207*t125
      t211 = t60**2
      t212 = 1/t211
      t213 = t212*t118
      t215 = 1.D0+0.137284639D1*t212
      t216 = 1/t215
      t220 = t65*t55
      t223 = t66*t201
      t226 = -0.2625411059665811D0*t220*t119-1.D0*t223*t204
      t227 = 1/t66
      t228 = t226*t227
      t234 = 0.2505897912236993D-1*t208*t54+0.1903580477513215D0*t213
     #*t107*t216+0.2667310007273315D-2*t228*t54-0.5011795824473985D-1
     #*t127-0.2419143800947354D0*t136-0.4431373767749538D-2*t147
      t237 = t40**2
      t238 = 1/t237
      t239 = t73*t238
      t242 = -0.101257459063883D3*t234*t74+0.101257459063883D3*t239*t183
      t243 = t242*t79
      t246 = 1/t82/rho
      t249 = t243*t83-4.D0*t80*t246
      t250 = t52*t249
      t253 = rho*(0.5011795824473985D-1*t127+0.2419143800947354D0*t136
     #+0.4431373767749538D-2*t147-0.1899772193293833D-1*t185
     #-0.1899772193293833D-1*t195-0.1899772193293833D-1*t250)
      vrhoa(i) = rho*(-t96-0.7599088773175333D-1*t100)+t11+t17+t23-t87
     #+t253
      t254 = -t93
      t255 = t40*t254
      t256 = t255*t85
      t257 = 0.1899772193293833D-1*t256
      vrhob(i) = rho*(-t257+0.7599088773175333D-1*t100)+t11+t17+t23
     #-t87+t253
      t261 = t45**2
      t262 = 1/t261
      t265 = t49**2
      t266 = 1/t265
      t269 = 0.4444444444444444D0*t262*t107+0.4444444444444444D0*t266
     #*t107
      t272 = 0.1899772193293833D-1*t40*t269*t85
      t273 = t94*t99
      t277 = t52*t77*t78*t83
      t278 = 0.22797266319526D0*t277
      t285 = 0.1899772193293833D-1*t183*t93*t85
      t286 = t184*t99
      t287 = 0.7599088773175333D-1*t286
      t290 = 1/t81/rho
      t300 = -0.4444444444444444D0*t262*t42*t290-0.1333333333333333D1
     #*t45*t107-0.4444444444444444D0*t266*t42*t290
     #+0.1333333333333333D1*t49*t107
      t303 = 0.1899772193293833D-1*t40*t300*t85
      t304 = t194*t99
      t305 = 0.7599088773175333D-1*t304
      t307 = 0.1899772193293833D-1*t94*t249
      t309 = t242*t97*t83
      t311 = t98*t246
      t313 = 4.D0*t309-16.D0*t311
      t317 = rho*(-t285-t287-t303-t305-t307-0.1899772193293833D-1*t52
     #*t313)
      t318 = t52*t309
      t320 = t52*t311
      t323 = rho*(-t285-t303-t307-t287-t305-0.7599088773175333D-1*t318
     #+0.3039635509270133D0*t320)
      t324 = 0.1002359164894797D0*t127
      t325 = 0.4838287601894708D0*t136
      t326 = 0.8862747535499077D-2*t147
      t327 = 0.3799544386587666D-1*t185
      t328 = 0.3799544386587666D-1*t195
      t329 = 0.3799544386587666D-1*t250
      t331 = 1/t104/t1
      t333 = t331*t7*t83
      t342 = 1/t110/t6
      t344 = t121**2
      t348 = 0.1378556646443111D0*t331*t83
      t350 = 0.4135669939329333D0*t105*t290
      t352 = 1/t117/t1
      t353 = t352*t83
      t355 = t118*t290
      t357 = -t348+t350-0.1429973890497978D1*t353+0.3431937337195148D1
     #*t355
      t362 = (-0.1378556646443111D0*t333+0.4135669939329333D0*t105
     #*t111*t107*t121+0.4135669939329333D0*t106*t290
     #+0.12407009817988D1*t2*t342*t344-0.6203504908994D0*t112*t357)
     #*t125*t6
      t365 = 1/t2/t1
      t368 = t124*t365*t6*t107
      t370 = t126*t121
      t375 = t83*t134
      t376 = 1/t129/t13*t331*t375
      t379 = t130*t352*t375
      t382 = t131*t290*t134
      t384 = t129**2
      t388 = t133**2
      t391 = 1/t384/t13*t331*t83/t388
      t409 = (0.3446391616107778D-1*t333+0.5250822119331622D0*t19*t111
     #*t119*t121-0.2187842549721509D0*t138*t353+0.5250822119331622D0
     #*t138*t355+2.D0*t20*t342*t344-1.D0*t141*t357)*t145*t6
      t416 = t144/t20/t19*t6*t118*t107
      t418 = t146*t121
      t421 = t331*t26*t83
      t430 = 1/t152/t25
      t432 = t156**2
      t437 = -t348+t350-0.1168690793997487D0*t353+0.2804857905593969D0
     #*t355
      t453 = t83*t168
      t462 = t163**2
      t466 = t167**2
      t498 = 0.161199195401647D1*(-0.1378556646443111D0*t421
     #+0.4135669939329333D0*t105*t153*t107*t156+0.4135669939329333D0
     #*t149*t290+0.12407009817988D1*t2*t430*t432-0.6203504908994D0
     #*t154*t437)*t125*t25+0.5373306513388232D0*t159*t365*t25*t107
     #+0.161199195401647D1*t160*t156+0.2982003378702879D0/t163/t30
     #*t331*t453+0.4732597599215661D0*t164*t352*t453
     #-0.1135823423811759D1*t165*t290*t168-0.1335455272347545D2/t462
     #/t30*t331*t83/t466+0.2160871036089827D-1*(0.3446391616107778D-1
     #*t421+0.5250822119331622D0*t35*t153*t119*t156
     #-0.2187842549721509D0*t172*t353+0.5250822119331622D0*t172*t355
     #+2.D0*t36*t430*t432-1.D0*t175*t437)*t179*t25
     #+0.567317471666175D-2*t178/t36/t35*t25*t118*t107
     #+0.2160871036089827D-1*t180*t156
      t524 = t331*t55*t83
      t533 = 1/t200/t54
      t535 = t204**2
      t540 = -t348+t350-0.2201308720615045D1*t353+0.5283140929476108D1
     #*t355
      t556 = t83*t216
      t565 = t211**2
      t569 = t215**2
      s1 = 0.2505897912236993D-1*(-0.1378556646443111D0*t524
     #+0.4135669939329333D0*t105*t201*t107*t204+0.4135669939329333D0
     #*t197*t290+0.12407009817988D1*t2*t533*t535-0.6203504908994D0
     #*t202*t540)*t125*t54+0.8352993040789975D-2*t207*t365*t54*t107
     #+0.2505897912236993D-1*t208*t204+0.9995362477254242D-1/t211/t60
     #*t331*t556+0.1586317064594346D0*t212*t352*t556
     #-0.3807160955026431D0*t213*t290*t216-0.1372209729363994D0/t565
     #/t60*t331*t83/t569+0.2667310007273315D-2*(0.3446391616107778D-1
     #*t524+0.5250822119331622D0*t65*t201*t119*t204
     #-0.2187842549721509D0*t220*t353+0.5250822119331622D0*t220*t355
     #+2.D0*t66*t533*t535-1.D0*t223*t540)*t227*t54
     #+0.7002785192652656D-3*t226/t66/t65*t54*t118*t107
     #+0.2667310007273315D-2*t228*t204
      t611 = s1-0.5011795824473985D-1*t362-0.1670598608157995D-1*t368
     #-0.5011795824473985D-1*t370-0.1270249377985834D0*t376
     #-0.2015953167456128D0*t379+0.4838287601894708D0*t382
     #+0.2560822746019441D-3*t391-0.4431373767749538D-2*t409
     #-0.1163417769936259D-2*t416-0.4431373767749538D-2*t418
      t620 = t183**2
      t637 = 0.5011795824473985D-1*t362+0.1670598608157995D-1*t368
     #+0.5011795824473985D-1*t370+0.1270249377985834D0*t376
     #+0.2015953167456128D0*t379-0.4838287601894708D0*t382
     #-0.2560822746019441D-3*t391+0.4431373767749538D-2*t409
     #+0.1163417769936259D-2*t416+0.4431373767749538D-2*t418
     #-0.1899772193293833D-1*t498*t51*t85-0.3799544386587666D-1*t183
     #*t193*t85-0.3799544386587666D-1*t184*t249-0.1899772193293833D-1
     #*t40*(0.4444444444444444D0*t262*t78*t83+0.2666666666666667D1
     #*t187*t290+0.4444444444444444D0*t266*t78*t83
     #-0.2666666666666667D1*t190*t290)*t85-0.3799544386587666D-1*t194
     #*t249-0.1899772193293833D-1*t52*((-0.101257459063883D3*t611*t74
     #+0.2025149181277661D3*t234*t238*t183-0.2025149181277661D3*t73
     #/t237/t40*t620+0.101257459063883D3*t239*t498)*t79*t83-8.D0*t243
     #*t246+20.D0*t80/t82/t81)
      t638 = rho*t637
      v2rhoa2(i) = rho*(-t272-0.1519817754635067D0*t273-t278)
     #-0.3799544386587666D-1*t95-0.1519817754635067D0*t100+t317+t323
     #+t324+t325+t326-t327-t328-t329+t638
      t639 = t255*t99
      t647 = 0.1899772193293833D-1*t183*t254*t85
      t648 = 0.7599088773175333D-1*t286
      t652 = -0.1899772193293833D-1*t40*t300*t85
      t653 = 0.7599088773175333D-1*t304
      t655 = 0.1899772193293833D-1*t255*t249
      t660 = rho*(-t647+t648-t652+t653-t655+0.1899772193293833D-1*t52
     #*t313)
      t664 = rho*(-t647-t652-t655+t648+t653+0.7599088773175333D-1*t318
     #-0.3039635509270133D0*t320)
      v2rhob2(i) = rho*(-t272+0.1519817754635067D0*t639-t278)
     #-0.3799544386587666D-1*t256+0.1519817754635067D0*t100+t660+t664
     #+t324+t325+t326-t327-t328-t329+t638
      v2rhoab(i) = rho*(0.1899772193293833D-1*t40*t269*t85
     #+0.7599088773175333D-1*t273-0.7599088773175333D-1*t639
     #+0.22797266319526D0*t277)-t257+0.5D0*t660-t96+0.5D0*t323+t324
     #+t325+t326-t327-t328-t329+t638+0.5D0*t317+0.5D0*t664
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      v2rhob2(i) = 0.0d0
      v2rhoab(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end
      
      
      subroutine rks_c_vwn5rpa
     & (ideriv,npt,rhoa1,sigmaaa1,
     &  zk,vrhoa,vsigmaaa,
     &  v2rhoa2,v2rhoasigmaaa,v2sigmaaa2)
c
c     S.H. Vosko, L. Wilk, and M. Nusair
c     Accurate spin-dependent electron liquid correlation energies for
c     local spin density calculations: a critical analysis
c     Can. J. Phys. 58 (1980) 1200-1211
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt)
      REAL sigmaaa1(npt)
      REAL zk(npt),vrhoa(npt),vsigmaaa(npt)
      REAL v2rhoa2(npt),v2rhoasigmaaa(npt),v2sigmaaa2(npt)
      parameter(tol=1.0d-20)
      
      if(ideriv.eq.0) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      t1 = 1/rho
      t2 = t1**(1.D0/3.D0)
      t4 = t1**(1.D0/6.D0)
      t7 = 1/(0.6203504908994D0*t2+0.1029581201158544D2*t4+0.427198D2)
      t10 = dlog(0.6203504908994D0*t2*t7)
      t16 = datan(0.448998886412873D-1/(0.1575246635799487D1*t4
     #+0.13072D2))
      t20 = (0.7876233178997433D0*t4+0.409286D0)**2
      t22 = dlog(t20*t7)
      zk(i) = rho*(0.310907D-1*t10+0.205219729378375D2*t16
     #+0.4431373767749538D-2*t22)
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      t1 = 1/rho
      t2 = t1**(1.D0/3.D0)
      t4 = t1**(1.D0/6.D0)
      t6 = 0.6203504908994D0*t2+0.1029581201158544D2*t4+0.427198D2
      t7 = 1/t6
      t10 = dlog(0.6203504908994D0*t2*t7)
      t11 = 0.310907D-1*t10
      t13 = 0.1575246635799487D1*t4+0.13072D2
      t16 = datan(0.448998886412873D-1/t13)
      t17 = 0.205219729378375D2*t16
      t19 = 0.7876233178997433D0*t4+0.409286D0
      t20 = t19**2
      t22 = dlog(t20*t7)
      t23 = 0.4431373767749538D-2*t22
      zk(i) = rho*(t11+t17+t23)
      t25 = t2**2
      t26 = 1/t25
      t28 = rho**2
      t29 = 1/t28
      t32 = t6**2
      t33 = 1/t32
      t37 = t4**2
      t38 = t37**2
      t40 = 1/t38/t4
      t41 = t40*t29
      t43 = -0.2067834969664667D0*t26*t29-0.1715968668597574D1*t41
      t51 = t13**2
      t52 = 1/t51
      vrhoa(i) = t11+t17+t23+rho*(0.5011795824473985D-1*(
     #-0.2067834969664667D0*t26*t7*t29-0.6203504908994D0*t2*t33*t43)
     #/t2*t6+0.2419143800947354D0*t52*t40*t29/(1.D0+0.2016D-2*t52)
     #+0.4431373767749538D-2*(-0.2625411059665811D0*t19*t7*t41-1.D0
     #*t20*t33*t43)/t20*t6)
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      t1 = 1/rho
      t2 = t1**(1.D0/3.D0)
      t4 = t1**(1.D0/6.D0)
      t6 = 0.6203504908994D0*t2+0.1029581201158544D2*t4+0.427198D2
      t7 = 1/t6
      t10 = dlog(0.6203504908994D0*t2*t7)
      t11 = 0.310907D-1*t10
      t13 = 0.1575246635799487D1*t4+0.13072D2
      t16 = datan(0.448998886412873D-1/t13)
      t17 = 0.205219729378375D2*t16
      t19 = 0.7876233178997433D0*t4+0.409286D0
      t20 = t19**2
      t22 = dlog(t20*t7)
      t23 = 0.4431373767749538D-2*t22
      zk(i) = rho*(t11+t17+t23)
      t25 = t2**2
      t26 = 1/t25
      t27 = t26*t7
      t28 = rho**2
      t29 = 1/t28
      t32 = t6**2
      t33 = 1/t32
      t34 = t2*t33
      t37 = t4**2
      t38 = t37**2
      t39 = t38*t4
      t40 = 1/t39
      t41 = t40*t29
      t43 = -0.2067834969664667D0*t26*t29-0.1715968668597574D1*t41
      t46 = -0.2067834969664667D0*t27*t29-0.6203504908994D0*t34*t43
      t47 = 1/t2
      t48 = t46*t47
      t49 = t48*t6
      t51 = t13**2
      t52 = 1/t51
      t53 = t52*t40
      t55 = 1.D0+0.2016D-2*t52
      t56 = 1/t55
      t58 = t53*t29*t56
      t60 = t19*t7
      t63 = t20*t33
      t66 = -0.2625411059665811D0*t60*t41-1.D0*t63*t43
      t67 = 1/t20
      t68 = t66*t67
      t69 = t68*t6
      vrhoa(i) = t11+t17+t23+rho*(0.5011795824473985D-1*t49
     #+0.2419143800947354D0*t58+0.4431373767749538D-2*t69)
      t77 = 1/t25/t1
      t79 = t28**2
      t80 = 1/t79
      t81 = t77*t7*t80
      t88 = 1/t28/rho
      t92 = 1/t32/t6
      t94 = t43**2
      t102 = 1/t39/t1
      t103 = t102*t80
      t105 = t40*t88
      t107 = -0.1378556646443111D0*t77*t80+0.4135669939329333D0*t26
     #*t88-0.1429973890497978D1*t103+0.3431937337195148D1*t105
      t125 = t80*t56
      t134 = t51**2
      t138 = t55**2
      s1 = 0.2004718329789594D0*t49+0.9676575203789416D0*t58
      v2rhoa2(i) = s1+0.1772549507099815D-1*t69+2.D0*rho*
     #(0.5011795824473985D-1*(-0.1378556646443111D0*t81
     #+0.4135669939329333D0*t26*t33*t29*t43+0.4135669939329333D0*t27
     #*t88+0.12407009817988D1*t2*t92*t94-0.6203504908994D0*t34*t107)
     #*t47*t6+0.1670598608157995D-1*t46/t2/t1*t6*t29
     #+0.5011795824473985D-1*t48*t43+0.1270249377985834D0/t51/t13*t77
     #*t125+0.2015953167456128D0*t52*t102*t125-0.4838287601894708D0
     #*t53*t88*t56-0.2560822746019441D-3/t134/t13*t77*t80/t138
     #+0.4431373767749538D-2*(0.3446391616107778D-1*t81
     #+0.5250822119331622D0*t19*t33*t41*t43-0.2187842549721509D0*t60
     #*t103+0.5250822119331622D0*t60*t105+2.D0*t20*t92*t94-1.D0*t63
     #*t107)*t67*t6+0.1163417769936259D-2*t66/t20/t19*t6*t40*t29
     #+0.4431373767749538D-2*t68*t43)
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end

c:C_VWN5RPAsubrend
_ENDIF
_IF(ccpdft,all,c_lyp)
c:C_LYPsubrstart

c    Generated: Wed Mar 10 10:16:01 GMT 2004

      subroutine uks_c_lyp
     & (ideriv,npt,rhoa1,rhob1,sigmaaa1,sigmabb1,sigmaab1,
     &  zk,vrhoa,vrhob,vsigmaaa,vsigmabb,vsigmaab,
     &  v2rhoa2,v2rhob2,v2rhoab,
     &  v2rhoasigmaaa,v2rhoasigmaab,v2rhoasigmabb,
     &  v2rhobsigmabb,v2rhobsigmaab,v2rhobsigmaaa,
     &  v2sigmaaa2,v2sigmaaaab,v2sigmaaabb,
     &  v2sigmaab2,v2sigmaabbb,v2sigmabb2)
c
c     C. Lee, W. Yang, and R.G. Parr
c     Development of the Colle-Salvetti correlation-energy formula into
c     a functional of the electron density
c     Phys. Rev. B37 (1988) 785-789
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt),rhob1(npt)
      REAL sigmaaa1(npt),sigmabb1(npt),sigmaab1(npt)
      REAL zk(npt),vrhoa(npt),vrhob(npt)
      REAL vsigmaaa(npt),vsigmabb(npt),vsigmaab(npt)
      REAL v2rhoa2(npt),v2rhob2(npt),v2rhoab(npt)
      REAL v2rhoasigmaaa(npt),v2rhoasigmaab(npt)
      REAL v2rhoasigmabb(npt),v2rhobsigmabb(npt)
      REAL v2rhobsigmaab(npt),v2rhobsigmaaa(npt)
      REAL v2sigmaaa2(npt),v2sigmaaaab(npt),v2sigmaaabb(npt)
      REAL v2sigmaab2(npt),v2sigmaabbb(npt),v2sigmabb2(npt)
      parameter(tol=1.0d-20)
      
      if (ideriv.eq.0) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      zk(i) = 0.D0
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      zk(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rho**(1.D0/3.D0)
      t5 = 1/t4
      t8 = 1/(1.D0+0.349D0*t5)
      t10 = 1/rho
      t11 = rhob*t10
      t14 = 0.2533D0*t5
      t15 = dexp(-t14)
      t17 = rho**2
      t19 = t4**2
      t23 = rhoa**2
      t24 = rhoa**(1.D0/3.D0)
      t25 = t24**2
      t28 = rhob**2
      t29 = rhob**(1.D0/3.D0)
      t30 = t29**2
      t34 = t5*t8
      t56 = 0.6666666666666667D0*t17
      zk(i) = -0.19672D0*t8*rhoa*t11-0.649176D-2*t15*t8/t19/t17/rho*
     #(rhoa*rhob*(0.3646239897876478D2*t25*t23+0.3646239897876478D2
     #*t30*t28+(0.2611111111111111D1-0.9850555555555556D-1*t5
     #-0.1357222222222222D0*t34)*sigma-1.D0*(0.25D1
     #-0.1407222222222222D-1*t5-0.1938888888888889D-1*t34)*(sigmaaa
     #+sigmabb)-0.1111111111111111D0*(t14+0.349D0*t34-11.D0)*(rhoa*t10
     #*sigmaaa+t11*sigmabb))-0.6666666666666667D0*t17*sigma+(t56-1.D0
     #*t23)*sigmabb+(t56-1.D0*t28)*sigmaaa)
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      zk(i) = 0.D0
      vrhoa(i) = 0.D0
      vrhob(i) = 0.D0
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      zk(i) = 0.D0
      vrhoa(i) = 0.D0
      vrhob(i) = 0.D0
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rho**(1.D0/3.D0)
      t5 = 1/t4
      t7 = 1.D0+0.349D0*t5
      t8 = 1/t7
      t9 = t8*rhoa
      t10 = 1/rho
      t11 = rhob*t10
      t14 = 0.2533D0*t5
      t15 = dexp(-t14)
      t16 = t15*t8
      t17 = rho**2
      t19 = t4**2
      t21 = 1/t19/t17/rho
      t22 = rhoa*rhob
      t23 = rhoa**2
      t24 = rhoa**(1.D0/3.D0)
      t25 = t24**2
      t28 = rhob**2
      t29 = rhob**(1.D0/3.D0)
      t30 = t29**2
      t34 = t5*t8
      t36 = 0.2611111111111111D1-0.9850555555555556D-1*t5
     #-0.1357222222222222D0*t34
      t41 = sigmaaa+sigmabb
      t45 = t14+0.349D0*t34-11.D0
      t49 = rhoa*t10*sigmaaa+t11*sigmabb
      t52 = 0.3646239897876478D2*t25*t23+0.3646239897876478D2*t30*t28
     #+t36*sigma-1.D0*(0.25D1-0.1407222222222222D-1*t5
     #-0.1938888888888889D-1*t34)*t41-0.1111111111111111D0*t45*t49
      t56 = 0.6666666666666667D0*t17
      t57 = 1.D0*t23
      t60 = 1.D0*t28
      t63 = t22*t52-0.6666666666666667D0*t17*sigma+(t56-t57)*sigmabb+
     #(t56-t60)*sigmaaa
      zk(i) = -0.19672D0*t9*t11-0.649176D-2*t16*t21*t63
      t73 = t45*t10
      t84 = t7**2
      t85 = 1/t84
      t91 = 0.2288509333333333D-1*t85*rhoa*rhob/t4/t17
      t92 = 1/t17
      t93 = rhob*t92
      t95 = 0.19672D0*t9*t93
      t96 = t17**2
      t98 = 1/t96/rho
      t102 = 0.548120936D-3*t98*t15*t8*t63
      t106 = 0.75520808D-3*t15*t85*t98*t63
      t111 = 0.2380312D-1*t16/t19/t96*t63
      t113 = 1/t4/rho
      t115 = t113*t8
      t119 = 1/t19/rho*t85
      t154 = 0.649176D-2*t16*t21*(t22*((0.3283518518518519D-1*t113
     #+0.4524074074074074D-1*t115-0.1578901851851852D-1*t119)*sigma
     #-1.D0*(0.4690740740740741D-2*t113+0.6462962962962963D-2*t115
     #-0.2255574074074074D-2*t119)*t41-0.1111111111111111D0*(
     #-0.8443333333333333D-1*t113-0.1163333333333333D0*t115
     #+0.4060033333333333D-1*t119)*t49-0.1111111111111111D0*t45*(-1.D0
     #*rhoa*t92*sigmaaa-1.D0*t93*sigmabb))-0.1333333333333333D1*rho
     #*sigma+0.1333333333333333D1*rho*sigmabb+0.1333333333333333D1*rho
     #*sigmaaa)
      vrhoa(i) = -0.19672D0*t8*rhob*t10-0.649176D-2*t16*t21*(rhob*t52
     #+t22*(0.9723306394337274D2*t25*rhoa-0.1111111111111111D0*t73
     #*sigmaaa)-2.D0*rhoa*sigmabb)-t91+t95-t102-t106+t111-t154
      vrhob(i) = -0.19672D0*t9*t10-0.649176D-2*t16*t21*(rhoa*t52+t22*
     #(0.9723306394337274D2*t30*rhob-0.1111111111111111D0*t73*sigmabb)
     #-2.D0*rhob*sigmaaa)-t91+t95-t102-t106+t111-t154
      t170 = 0.1407222222222222D-1*t5
      t171 = 0.1938888888888889D-1*t34
      t185 = t16*t21*(t22*t36-0.6666666666666667D0*t17)
      t186 = 0.649176D-2*t185
      vsigmaaa(i) = -0.649176D-2*t16*t21*(t22*(-0.25D1+t170+t171
     #-0.1111111111111111D0*t45*rhoa*t10)+t56-t60)-t186
      vsigmaab(i) = -0.1298352D-1*t185
      vsigmabb(i) = -0.649176D-2*t16*t21*(t22*(-0.25D1+t170+t171
     #-0.1111111111111111D0*t45*rhob*t10)+t56-t57)-t186
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      zk(i) = 0.D0
      vrhoa(i) = 0.D0
      vrhob(i) = 0.D0
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      v2rhoa2(i) = 0.D0
      v2rhoab(i) = 0.D0
      v2rhob2(i) = 0.D0
      v2sigmaaa2(i) = 0.D0
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      v2sigmabb2(i) = 0.D0
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      zk(i) = 0.D0
      vrhoa(i) = 0.D0
      vrhob(i) = 0.D0
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      v2rhoa2(i) = 0.D0
      v2rhob2(i) = 0.D0
      v2rhoab(i) = 0.D0
      v2sigmaaa2(i) = 0.D0
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      v2sigmabb2(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rho**(1.D0/3.D0)
      t5 = 1/t4
      t7 = 1.D0+0.349D0*t5
      t8 = 1/t7
      t9 = t8*rhoa
      t10 = 1/rho
      t11 = rhob*t10
      t14 = 0.2533D0*t5
      t15 = dexp(-t14)
      t16 = t15*t8
      t17 = rho**2
      t18 = t17*rho
      t19 = t4**2
      t21 = 1/t19/t18
      t22 = rhoa*rhob
      t23 = rhoa**2
      t24 = rhoa**(1.D0/3.D0)
      t25 = t24**2
      t27 = 0.3646239897876478D2*t25*t23
      t28 = rhob**2
      t29 = rhob**(1.D0/3.D0)
      t30 = t29**2
      t32 = 0.3646239897876478D2*t30*t28
      t34 = t5*t8
      t36 = 0.2611111111111111D1-0.9850555555555556D-1*t5
     #-0.1357222222222222D0*t34
      t37 = t36*sigma
      t41 = sigmaaa+sigmabb
      t43 = 1.D0*(0.25D1-0.1407222222222222D-1*t5
     #-0.1938888888888889D-1*t34)*t41
      t45 = t14+0.349D0*t34-11.D0
      t49 = rhoa*t10*sigmaaa+t11*sigmabb
      t51 = 0.1111111111111111D0*t45*t49
      t52 = t27+t32+t37-t43-t51
      t56 = 0.6666666666666667D0*t17
      t57 = 1.D0*t23
      t60 = 1.D0*t28
      t63 = t22*t52-0.6666666666666667D0*t17*sigma+(t56-t57)*sigmabb+
     #(t56-t60)*sigmaaa
      zk(i) = -0.19672D0*t9*t11-0.649176D-2*t16*t21*t63
      t67 = t8*rhob
      t71 = t25*rhoa
      t73 = t45*t10
      t76 = 0.9723306394337274D2*t71-0.1111111111111111D0*t73*sigmaaa
      t80 = rhob*t52+t22*t76-2.D0*rhoa*sigmabb
      t84 = t7**2
      t85 = 1/t84
      t86 = t85*rhoa
      t88 = 1/t4/t17
      t91 = 0.2288509333333333D-1*t86*rhob*t88
      t92 = 1/t17
      t93 = rhob*t92
      t95 = 0.19672D0*t9*t93
      t96 = t17**2
      t97 = t96*rho
      t98 = 1/t97
      t99 = t98*t15
      t100 = t8*t63
      t102 = 0.548120936D-3*t99*t100
      t103 = t15*t85
      t106 = 0.75520808D-3*t103*t98*t63
      t108 = 1/t19/t96
      t111 = 0.2380312D-1*t16*t108*t63
      t113 = 1/t4/rho
      t115 = t113*t8
      t119 = 1/t19/rho*t85
      t121 = 0.3283518518518519D-1*t113+0.4524074074074074D-1*t115
     #-0.1578901851851852D-1*t119
      t132 = -0.8443333333333333D-1*t113-0.1163333333333333D0*t115
     #+0.4060033333333333D-1*t119
      t140 = -1.D0*rhoa*t92*sigmaaa-1.D0*t93*sigmabb
      t143 = t121*sigma-1.D0*(0.4690740740740741D-2*t113
     #+0.6462962962962963D-2*t115-0.2255574074074074D-2*t119)*t41
     #-0.1111111111111111D0*t132*t49-0.1111111111111111D0*t45*t140
      t151 = t22*t143-0.1333333333333333D1*rho*sigma
     #+0.1333333333333333D1*rho*sigmabb+0.1333333333333333D1*rho*sigmaaa
      t154 = 0.649176D-2*t16*t21*t151
      vrhoa(i) = -0.19672D0*t67*t10-0.649176D-2*t16*t21*t80-t91+t95
     #-t102-t106+t111-t154
      t158 = t30*rhob
      t162 = 0.9723306394337274D2*t158-0.1111111111111111D0*t73*sigmabb
      t166 = rhoa*t52+t22*t162-2.D0*rhob*sigmaaa
      vrhob(i) = -0.19672D0*t9*t10-0.649176D-2*t16*t21*t166-t91+t95
     #-t102-t106+t111-t154
      t170 = 0.1407222222222222D-1*t5
      t171 = 0.1938888888888889D-1*t34
      t172 = t45*rhoa
      t175 = -0.25D1+t170+t171-0.1111111111111111D0*t172*t10
      t177 = t22*t175+t56-t60
      t183 = t22*t36-0.6666666666666667D0*t17
      t185 = t16*t21*t183
      t186 = 0.649176D-2*t185
      vsigmaaa(i) = -0.649176D-2*t16*t21*t177-t186
      vsigmaab(i) = -0.1298352D-1*t185
      t188 = t45*rhob
      t191 = -0.25D1+t170+t171-0.1111111111111111D0*t188*t10
      t193 = t22*t191+t56-t57
      vsigmabb(i) = -0.649176D-2*t16*t21*t193-t186
      t198 = t85*rhob*t88
      t200 = t67*t92
      t203 = t99*t8*t80
      t206 = t103*t98*t80
      t209 = t16*t108*t80
      t212 = t132*t10
      t215 = t45*t92
      t222 = t16*t21*(rhob*t143+t22*(-0.1111111111111111D0*t212
     #*sigmaaa+0.1111111111111111D0*t215*sigmaaa))
      t237 = 0.1110812266666667D0*t16/t19/t97*t63
      t239 = t88*t8
      t243 = 1/t19/t17*t85
      t245 = 1/t18
      t247 = 1/t84/t7
      t248 = t245*t247
      t271 = rhob*t245
      t285 = 0.649176D-2*t16*t21*(t22*((-0.4378024691358025D-1*t88
     #-0.6032098765432099D-1*t239+0.3157803703703704D-1*t243
     #-0.3673578308641975D-2*t248)*sigma-1.D0*(-0.6254320987654321D-2
     #*t88-0.8617283950617284D-2*t239+0.4511148148148148D-2*t243
     #-0.5247969012345679D-3*t248)*t41-0.1111111111111111D0*
     #(0.1125777777777778D0*t88+0.1551111111111111D0*t239
     #-0.8120066666666667D-1*t243+0.9446344222222222D-2*t248)*t49
     #-0.2222222222222222D0*t132*t140-0.1111111111111111D0*t45*(2.D0
     #*rhoa*t245*sigmaaa+2.D0*t271*sigmabb))-0.1333333333333333D1
     #*sigma+0.1333333333333333D1*sigmabb+0.1333333333333333D1*sigmaaa)
      t286 = t96*t17
      t287 = 1/t286
      t290 = 0.6545136693333333D-2*t103*t287*t63
      t293 = 0.4750381445333333D-2*t287*t15*t100
      t298 = 0.7628364444444444D-1*t86*rhob/t4/t18
      t300 = rhob*t21
      t302 = 0.5324598382222222D-2*t247*rhoa*t300
      t305 = 0.1096241872D-2*t99*t8*t151
      t307 = 1/t4/t286
      t308 = t307*t15
      t310 = 0.4627967769626667D-4*t308*t100
      t313 = 0.1275294711093333D-3*t308*t85*t63
      t316 = 0.151041616D-2*t103*t98*t151
      t320 = 0.1757117466133333D-3*t15*t247*t307*t63
      t323 = 0.4760624D-1*t16*t108*t151
      t325 = 0.39344D0*t9*t271
      v2rhoa2(i) = -0.4577018666666667D-1*t198+0.39344D0*t200
     #-0.1096241872D-2*t203-0.151041616D-2*t206+0.4760624D-1*t209
     #-0.1298352D-1*t222-0.649176D-2*t16*t21*(2.D0*rhob*t76
     #+0.1620551065722879D3*t71*rhob-2.D0*sigmabb)-t237-t285+t290+t293
     #+t298-t302-t305-t310-t313-t316-t320+t323-t325
      t335 = t86*t88
      t337 = t9*t92
      t340 = t99*t8*t166
      t343 = t103*t98*t166
      t346 = t16*t108*t166
      t357 = t16*t21*(rhoa*t143+t22*(-0.1111111111111111D0*t212
     #*sigmabb+0.1111111111111111D0*t215*sigmabb))
      v2rhob2(i) = -t237-t285+t290+t293+t298-t302-t305-t310-t313-t316
     #-t320+t323-0.649176D-2*t16*t21*(2.D0*rhoa*t162
     #+0.1620551065722879D3*rhoa*t158-2.D0*sigmaaa)
     #-0.4577018666666667D-1*t335+0.39344D0*t337-0.1096241872D-2*t340
     #-0.151041616D-2*t343+0.4760624D-1*t346-0.1298352D-1*t357-t325
      t377 = 0.19672D0*t337-0.2288509333333333D-1*t335-0.548120936D-3
     #*t340-0.75520808D-3*t343+0.2380312D-1*t346-0.19672D0*t8*t10
     #-0.649176D-2*t16*t21*(t27+t32+t37-t43-t51+rhob*t162+rhoa*t76)
     #-0.649176D-2*t357-0.548120936D-3*t203-0.75520808D-3*t206
     #+0.2380312D-1*t209-0.649176D-2*t222-t237
      t380 = -t285+t290+t293+t298-t302-t305-t310-t313-t316-t320+t323
     #-t325-0.2288509333333333D-1*t198+0.19672D0*t200
      v2rhoab(i) = t377+t380
      t383 = 0.1111111111111111D0*t22*t73
      t390 = 0.548120936D-3*t99*t8*t177
      t393 = 0.75520808D-3*t103*t98*t177
      t396 = 0.2380312D-1*t16*t108*t177
      t397 = 0.4690740740740741D-2*t113
      t398 = 0.6462962962962963D-2*t115
      t399 = 0.2255574074074074D-2*t119
      t407 = 0.1333333333333333D1*rho
      t411 = 0.649176D-2*t16*t21*(t22*(-t397-t398+t399
     #-0.1111111111111111D0*t132*rhoa*t10+0.1111111111111111D0*t172
     #*t92)+t407)
      t413 = t16*t300*t36
      t414 = 0.649176D-2*t413
      t416 = t99*t8*t183
      t417 = 0.548120936D-3*t416
      t419 = t103*t98*t183
      t420 = 0.75520808D-3*t419
      t422 = t16*t108*t183
      t423 = 0.2380312D-1*t422
      t428 = t16*t21*(t22*t121-0.1333333333333333D1*rho)
      t429 = 0.649176D-2*t428
      v2rhoasigmaaa(i) = -0.649176D-2*t16*t21*(rhob*t175-t383)-t390
     #-t393+t396-t411-t414-t417-t420+t423-t429
      t431 = 0.1096241872D-2*t416
      t432 = 0.151041616D-2*t419
      t433 = 0.4760624D-1*t422
      t434 = 0.1298352D-1*t428
      v2rhoasigmaab(i) = -0.1298352D-1*t413-t431-t432+t433-t434
      t443 = 0.548120936D-3*t99*t8*t193
      t446 = 0.75520808D-3*t103*t98*t193
      t449 = 0.2380312D-1*t16*t108*t193
      t460 = 0.649176D-2*t16*t21*(t22*(-t397-t398+t399
     #-0.1111111111111111D0*t132*rhob*t10+0.1111111111111111D0*t188
     #*t92)+t407)
      v2rhoasigmabb(i) = -0.649176D-2*t16*t21*(rhob*t191-2.D0*rhoa)
     #-t443-t446+t449-t460-t414-t417-t420+t423-t429
      t469 = t16*t21*rhoa*t36
      t470 = 0.649176D-2*t469
      v2rhobsigmaaa(i) = -0.649176D-2*t16*t21*(rhoa*t175-2.D0*rhob)
     #-t390-t393+t396-t411-t470-t417-t420+t423-t429
      v2rhobsigmaab(i) = -0.1298352D-1*t469-t431-t432+t433-t434
      v2rhobsigmabb(i) = -0.649176D-2*t16*t21*(rhoa*t191-t383)-t443
     #-t446+t449-t460-t470-t417-t420+t423-t429
      v2sigmaaa2(i) = 0.D0
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      v2sigmabb2(i) = 0.D0
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      v2rhob2(i) = 0.0d0
      v2rhoab(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2rhoasigmaab(i) = 0.0d0
      v2rhoasigmabb(i) = 0.0d0
      v2rhobsigmaaa(i) = 0.0d0
      v2rhobsigmaab(i) = 0.0d0
      v2rhobsigmabb(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      v2sigmaab2(i) = 0.0d0
      v2sigmabb2(i) = 0.0d0
      v2sigmaaaab(i) = 0.0d0
      v2sigmaaabb(i) = 0.0d0
      v2sigmaabbb(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end
      
      
      subroutine rks_c_lyp
     & (ideriv,npt,rhoa1,sigmaaa1,
     &  zk,vrhoa,vsigmaaa,
     &  v2rhoa2,v2rhoasigmaaa,v2sigmaaa2)
c
c     C. Lee, W. Yang, and R.G. Parr
c     Development of the Colle-Salvetti correlation-energy formula into
c     a functional of the electron density
c     Phys. Rev. B37 (1988) 785-789
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt)
      REAL sigmaaa1(npt)
      REAL zk(npt),vrhoa(npt),vsigmaaa(npt)
      REAL v2rhoa2(npt),v2rhoasigmaaa(npt),v2sigmaaa2(npt)
      parameter(tol=1.0d-20)
      
      if(ideriv.eq.0) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t3 = 1/t2
      t6 = 1/(1.D0+0.349D0*t3)
      t9 = 0.2533D0*t3
      t10 = dexp(-t9)
      t12 = rho**2
      t14 = t2**2
      t20 = t3*t6
      zk(i) = -0.4918D-1*t6*rho-0.649176D-2*t10*t6/t14/t12/rho*(0.25D0
     #*t12*(0.1148493600075277D2*t14*t12+(0.2611111111111111D1
     #-0.9850555555555556D-1*t3-0.1357222222222222D0*t20)*sigma-0.5D0*
     #(0.25D1-0.1407222222222222D-1*t3-0.1938888888888889D-1*t20)
     #*sigma-0.2777777777777778D-1*(t9+0.349D0*t20-11.D0)*sigma)
     #-0.4583333333333333D0*t12*sigma)
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t3 = 1/t2
      t5 = 1.D0+0.349D0*t3
      t6 = 1/t5
      t9 = 0.2533D0*t3
      t10 = dexp(-t9)
      t11 = t10*t6
      t12 = rho**2
      t14 = t2**2
      t16 = 1/t14/t12/rho
      t20 = t3*t6
      t22 = 0.2611111111111111D1-0.9850555555555556D-1*t3
     #-0.1357222222222222D0*t20
      t30 = t9+0.349D0*t20-11.D0
      t33 = 0.1148493600075277D2*t14*t12+t22*sigma-0.5D0*(0.25D1
     #-0.1407222222222222D-1*t3-0.1938888888888889D-1*t20)*sigma
     #-0.2777777777777778D-1*t30*sigma
      t38 = 0.25D0*t12*t33-0.4583333333333333D0*t12*sigma
      zk(i) = -0.4918D-1*t6*rho-0.649176D-2*t11*t16*t38
      t45 = t14*rho
      t49 = t30/rho*sigma
      t54 = rho*sigma
      t60 = t5**2
      t61 = 1/t60
      t64 = t12**2
      t66 = 1/t64/rho
      t81 = 1/t2/rho
      t83 = t81*t6
      t85 = 1/t45
      t86 = t85*t61
      vrhoa(i) = -0.4918D-1*t6-0.649176D-2*t11*t16*(0.5D0*rho*t33
     #+0.25D0*t12*(0.3062649600200738D2*t45-0.2777777777777778D-1*t49)
     #-0.25D0*t54)-0.5721273333333333D-2*t61*t3-0.548120936D-3*t66*t10
     #*t6*t38-0.75520808D-3*t10*t61*t66*t38+0.2380312D-1*t11/t14/t64
     #*t38-0.649176D-2*t11*t16*(0.25D0*t12*((0.3283518518518519D-1*t81
     #+0.4524074074074074D-1*t83-0.1578901851851852D-1*t86)*sigma
     #-0.5D0*(0.4690740740740741D-2*t81+0.6462962962962963D-2*t83
     #-0.2255574074074074D-2*t86)*sigma-0.2777777777777778D-1*(
     #-0.8443333333333333D-1*t81-0.1163333333333333D0*t83
     #+0.4060033333333333D-1*t86)*sigma+0.2777777777777778D-1*t49)
     #-0.6666666666666667D0*t54)
      vsigmaaa(i) = 0.7213066666666667D-3*t11*t85-0.2596704D-1*t11*t16
     #*(0.25D0*t12*t22-0.6666666666666667D0*t12)
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t3 = 1/t2
      t5 = 1.D0+0.349D0*t3
      t6 = 1/t5
      t9 = 0.2533D0*t3
      t10 = dexp(-t9)
      t11 = t10*t6
      t12 = rho**2
      t13 = t12*rho
      t14 = t2**2
      t16 = 1/t14/t13
      t17 = t14*t12
      t18 = 0.1148493600075277D2*t17
      t20 = t3*t6
      t22 = 0.2611111111111111D1-0.9850555555555556D-1*t3
     #-0.1357222222222222D0*t20
      t23 = t22*sigma
      t28 = 0.5D0*(0.25D1-0.1407222222222222D-1*t3
     #-0.1938888888888889D-1*t20)*sigma
      t30 = t9+0.349D0*t20-11.D0
      t32 = 0.2777777777777778D-1*t30*sigma
      t33 = t18+t23-t28-t32
      t38 = 0.25D0*t12*t33-0.4583333333333333D0*t12*sigma
      zk(i) = -0.4918D-1*t6*rho-0.649176D-2*t11*t16*t38
      t45 = t14*rho
      t47 = 1/rho
      t48 = t30*t47
      t49 = t48*sigma
      t51 = 0.3062649600200738D2*t45-0.2777777777777778D-1*t49
      t54 = rho*sigma
      t56 = 0.5D0*rho*t33+0.25D0*t12*t51-0.25D0*t54
      t60 = t5**2
      t61 = 1/t60
      t64 = t12**2
      t65 = t64*rho
      t66 = 1/t65
      t67 = t66*t10
      t68 = t6*t38
      t71 = t10*t61
      t76 = 1/t14/t64
      t81 = 1/t2/rho
      t83 = t81*t6
      t85 = 1/t45
      t86 = t85*t61
      t88 = 0.3283518518518519D-1*t81+0.4524074074074074D-1*t83
     #-0.1578901851851852D-1*t86
      t99 = -0.8443333333333333D-1*t81-0.1163333333333333D0*t83
     #+0.4060033333333333D-1*t86
      t103 = t88*sigma-0.5D0*(0.4690740740740741D-2*t81
     #+0.6462962962962963D-2*t83-0.2255574074074074D-2*t86)*sigma
     #-0.2777777777777778D-1*t99*sigma+0.2777777777777778D-1*t49
      t107 = 0.25D0*t12*t103-0.6666666666666667D0*t54
      vrhoa(i) = -0.4918D-1*t6-0.649176D-2*t11*t16*t56
     #-0.5721273333333333D-2*t61*t3-0.548120936D-3*t67*t68
     #-0.75520808D-3*t71*t66*t38+0.2380312D-1*t11*t76*t38-0.649176D-2
     #*t11*t16*t107
      t116 = 0.25D0*t12*t22-0.6666666666666667D0*t12
      vsigmaaa(i) = 0.7213066666666667D-3*t11*t85-0.2596704D-1*t11*t16
     #*t116
      t121 = 1/t60/t5
      t126 = t64*t12
      t127 = 1/t126
      t137 = t99*t47*sigma
      t141 = t30/t12*sigma
      t150 = rho*t51
      t165 = 1/t2/t126
      t166 = t165*t10
      t188 = 1/t2/t12
      t190 = t188*t6
      t192 = 1/t17
      t193 = t192*t61
      t195 = 1/t13
      t196 = t195*t121
      s1 = -0.2662299191111111D-2*t121*t85-0.7628364444444444D-2*t61
     #*t81+0.9500762890666667D-2*t127*t10*t68+0.9521248D-1*t11*t76*t56
     #-0.2596704D-1*t11*t16*(0.5D0*rho*t103+0.25D0*t12*(
     #-0.2777777777777778D-1*t137+0.2777777777777778D-1*t141))
     #-0.649176D-2*t11*t16*(t18+t23-t28-t32+t150)+0.9521248D-1*t11*t76
     #*t107-0.2192483744D-2*t67*t6*t56-0.302083232D-2*t71*t66*t56
      s2 = s1-0.2550589422186667D-3*t166*t61*t38-0.302083232D-2*t71
     #*t66*t107-0.3514234932266667D-3*t10*t121*t165*t38
     #-0.2192483744D-2*t67*t6*t107
      v2rhoa2(i) = s2-0.9255935539253333D-4*t166*t68
     #-0.2221624533333333D0*t11/t14/t65*t38-0.1298352D-1*t11*t16*
     #(0.25D0*t12*((-0.4378024691358025D-1*t188-0.6032098765432099D-1
     #*t190+0.3157803703703704D-1*t193-0.3673578308641975D-2*t196)
     #*sigma-0.5D0*(-0.6254320987654321D-2*t188-0.8617283950617284D-2
     #*t190+0.4511148148148148D-2*t193-0.5247969012345679D-3*t196)
     #*sigma-0.2777777777777778D-1*(0.1125777777777778D0*t188
     #+0.1551111111111111D0*t190-0.8120066666666667D-1*t193
     #+0.9446344222222222D-2*t196)*sigma+0.5555555555555556D-1*t137
     #-0.5555555555555556D-1*t141)-0.6666666666666667D0*sigma)
     #-0.649176D-2*t11*t16*(0.1D1*t150+0.2552208000167282D2*t17-0.5D0
     #*sigma)+0.1309027338666667D-1*t71*t127*t38
      v2rhoasigmaaa(i) = -0.649176D-2*t11*t16*(-0.9444444444444444D0
     #*rho-0.2777777777777778D-1*rho*t30)+0.6090232622222222D-4*t195
     #*t10*t6+0.8391200888888889D-4*t71*t195+0.9978075555555556D-2*t11
     #*t192-0.1298352D-1*t11*t16*(0.25D0*t12*(-0.3D-22*t83+0.1D-22*t86
     #+0.5555555555555556D-1*t48)+0.1333333333333333D1*rho)
     #-0.1298352D-1*t11*t192*t22-0.2192483744D-2*t67*t6*t116
     #-0.302083232D-2*t71*t66*t116+0.9521248D-1*t11*t76*t116
     #-0.2596704D-1*t11*t16*(0.25D0*t12*t88-0.1333333333333333D1*rho)
      v2sigmaaa2(i) = 0.D0
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end

c:C_LYPsubrend
_ENDIF
_IF(ccpdft,all,c_pz81)
c:C_PZ81subrstart

c    Generated: Tue Mar  9 13:25:27 GMT 2004

      subroutine uks_c_pz81
     & (ideriv,npt,rhoa1,rhob1,sigmaaa1,sigmabb1,sigmaab1,
     &  zk,vrhoa,vrhob,vsigmaaa,vsigmabb,vsigmaab,
     &  v2rhoa2,v2rhob2,v2rhoab,
     &  v2rhoasigmaaa,v2rhoasigmaab,v2rhoasigmabb,
     &  v2rhobsigmabb,v2rhobsigmaab,v2rhobsigmaaa,
     &  v2sigmaaa2,v2sigmaaaab,v2sigmaaabb,
     &  v2sigmaab2,v2sigmaabbb,v2sigmabb2)
c
c     J.P. Perdew, and A. Zunger
c     Self-interaction correction to density-functional approximations 
c     for many-electron systems
c     Phys. Rev. B23 (1981) 5048-5079
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt),rhob1(npt)
      REAL sigmaaa1(npt),sigmabb1(npt),sigmaab1(npt)
      REAL zk(npt),vrhoa(npt),vrhob(npt)
      REAL vsigmaaa(npt),vsigmabb(npt),vsigmaab(npt)
      REAL v2rhoa2(npt),v2rhob2(npt),v2rhoab(npt)
      REAL v2rhoasigmaaa(npt),v2rhoasigmaab(npt)
      REAL v2rhoasigmabb(npt),v2rhobsigmabb(npt)
      REAL v2rhobsigmaab(npt),v2rhobsigmaaa(npt)
      REAL v2sigmaaa2(npt),v2sigmaaaab(npt),v2sigmaaabb(npt)
      REAL v2sigmaab2(npt),v2sigmaabbb(npt),v2sigmabb2(npt)
      parameter(tol=1.0d-20)
      logical t4
      
      if (ideriv.eq.0) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      t1 = 1/rhob
      t2 = t1**(1.D0/3.D0)
      t3 = 0.6203504908994D0*t2
      t5 = t1**(1.D0/6.D0)
      t11 = dlog(t3)
      t17 = piecewise(1.D0 .le. t3,-0.843D-1/(1.D0
     #+0.1101176160755631D1*t5+0.1619735131738333D0*t2),0.1555D-1*t11
     #-0.269D-1+0.43424534362958D-3*t2*t11-0.297768235631712D-2*t2)
      zk(i) = rhob*t17
      elseif(rhob.lt.tol) then
      rho = rhoa
      t1 = 1/rhoa
      t2 = t1**(1.D0/3.D0)
      t3 = 0.6203504908994D0*t2
      t5 = t1**(1.D0/6.D0)
      t11 = dlog(t3)
      t17 = piecewise(1.D0 .le. t3,-0.843D-1/(1.D0
     #+0.1101176160755631D1*t5+0.1619735131738333D0*t2),0.1555D-1*t11
     #-0.269D-1+0.43424534362958D-3*t2*t11-0.297768235631712D-2*t2)
      zk(i) = rhoa*t17
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      t1 = 1/rho
      t2 = t1**(1.D0/3.D0)
      t3 = 0.6203504908994D0*t2
      t5 = t1**(1.D0/6.D0)
      t10 = 0.1423D0/(1.D0+0.8292885914166397D0*t5+0.20682485366586D0
     #*t2)
      t19 = (rhoa-1.D0*rhob)*t1
      t20 = 1.D0+t19
      t21 = t20**(1.D0/3.D0)
      t24 = 1.D0-1.D0*t19
      t25 = t24**(1.D0/3.D0)
      t27 = t21*t20+t25*t24-2.D0
      t31 = dlog(t3)
      t33 = t2*t31
      t43 = piecewise(1.D0 .le. t3,-t10+0.1923661050931536D1*(
     #-0.843D-1/(1.D0+0.1101176160755631D1*t5+0.1619735131738333D0*t2)
     #+t10)*t27,0.311D-1*t31-0.48D-1+0.12407009817988D-2*t33
     #-0.719606569443304D-2*t2+0.1923661050931536D1*(-0.1555D-1*t31
     #+0.211D-1-0.80645563816922D-3*t33+0.421838333811592D-2*t2)*t27)
      zk(i) = rho*t43
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      t1 = 1/rhob
      t2 = t1**(1.D0/3.D0)
      t3 = 0.6203504908994D0*t2
      t4 = 1.D0 .le. t3
      t5 = t1**(1.D0/6.D0)
      t8 = 1.D0+0.1101176160755631D1*t5+0.1619735131738333D0*t2
      t11 = dlog(t3)
      t17 = piecewise(t4,-0.843D-1/t8,0.1555D-1*t11-0.269D-1
     #+0.43424534362958D-3*t2*t11-0.297768235631712D-2*t2)
      zk(i) = rhob*t17
      vrhoa(i) = 0.D0
      t18 = t8**2
      t20 = t5**2
      t21 = t20**2
      t24 = rhob**2
      t25 = 1/t24
      t28 = t2**2
      t29 = 1/t28
      t30 = t29*t25
      t43 = piecewise(t4,0.843D-1/t18*(-0.1835293601259385D0/t21/t5
     #*t25-0.5399117105794445D-1*t30),-0.5183333333333333D-2*t1
     #-0.1447484478765267D-3*t29*t11*t25-0.1447484478765267D-3*t2*t1
     #+0.99256078543904D-3*t30)
      vrhob(i) = t17+rhob*t43
      elseif(rhob.lt.tol) then
      rho = rhoa
      t1 = 1/rhoa
      t2 = t1**(1.D0/3.D0)
      t3 = 0.6203504908994D0*t2
      t4 = 1.D0 .le. t3
      t5 = t1**(1.D0/6.D0)
      t8 = 1.D0+0.1101176160755631D1*t5+0.1619735131738333D0*t2
      t11 = dlog(t3)
      t17 = piecewise(t4,-0.843D-1/t8,0.1555D-1*t11-0.269D-1
     #+0.43424534362958D-3*t2*t11-0.297768235631712D-2*t2)
      zk(i) = rhoa*t17
      t18 = t8**2
      t20 = t5**2
      t21 = t20**2
      t24 = rhoa**2
      t25 = 1/t24
      t28 = t2**2
      t29 = 1/t28
      t30 = t29*t25
      t43 = piecewise(t4,0.843D-1/t18*(-0.1835293601259385D0/t21/t5
     #*t25-0.5399117105794445D-1*t30),-0.5183333333333333D-2*t1
     #-0.1447484478765267D-3*t29*t11*t25-0.1447484478765267D-3*t2*t1
     #+0.99256078543904D-3*t30)
      vrhoa(i) = t17+rhoa*t43
      vrhob(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      t1 = 1/rho
      t2 = t1**(1.D0/3.D0)
      t3 = 0.6203504908994D0*t2
      t4 = 1.D0 .le. t3
      t5 = t1**(1.D0/6.D0)
      t8 = 1.D0+0.8292885914166397D0*t5+0.20682485366586D0*t2
      t10 = 0.1423D0/t8
      t13 = 1.D0+0.1101176160755631D1*t5+0.1619735131738333D0*t2
      t16 = -0.843D-1/t13+t10
      t18 = rhoa-1.D0*rhob
      t19 = t18*t1
      t20 = 1.D0+t19
      t21 = t20**(1.D0/3.D0)
      t24 = 1.D0-1.D0*t19
      t25 = t24**(1.D0/3.D0)
      t27 = t21*t20+t25*t24-2.D0
      t31 = dlog(t3)
      t33 = t2*t31
      t39 = -0.1555D-1*t31+0.211D-1-0.80645563816922D-3*t33
     #+0.421838333811592D-2*t2
      t43 = piecewise(t4,-t10+0.1923661050931536D1*t16*t27,0.311D-1
     #*t31-0.48D-1+0.12407009817988D-2*t33-0.719606569443304D-2*t2
     #+0.1923661050931536D1*t39*t27)
      zk(i) = rho*t43
      t48 = 0.1333333333333333D1*t21*t1-0.1333333333333333D1*t25*t1
      t53 = piecewise(t4,0.1923661050931536D1*t16
     #*t48,0.1923661050931536D1*t39*t48)
      t55 = t8**2
      t57 = t5**2
      t58 = t57**2
      t61 = rho**2
      t62 = 1/t61
      t63 = 1/t58/t5*t62
      t65 = t2**2
      t66 = 1/t65
      t67 = t66*t62
      t71 = 0.1423D0/t55*(-0.1382147652361066D0*t63
     #-0.6894161788861999D-1*t67)
      t72 = t13**2
      t88 = -0.1333333333333333D1*t21*t18*t62+0.1333333333333333D1*t25
     #*t18*t62
      t94 = t66*t31*t62
      t96 = t2*t1
      t109 = piecewise(t4,t71+0.1923661050931536D1*(0.843D-1/t72*(
     #-0.1835293601259385D0*t63-0.5399117105794445D-1*t67)-t71)*t27
     #+0.1923661050931536D1*t16*t88,-0.1036666666666667D-1*t1
     #-0.4135669939329333D-3*t94-0.4135669939329333D-3*t96
     #+0.2398688564811013D-2*t67+0.1923661050931536D1*
     #(0.5183333333333333D-2*t1+0.2688185460564067D-3*t94
     #+0.2688185460564067D-3*t96-0.1406127779371973D-2*t67)*t27
     #+0.1923661050931536D1*t39*t88)
      t110 = rho*t109
      vrhoa(i) = rho*t53+t43+t110
      t111 = -t48
      t116 = piecewise(t4,0.1923661050931536D1*t16
     #*t111,0.1923661050931536D1*t39*t111)
      vrhob(i) = rho*t116+t43+t110
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      t1 = 1/rhob
      t2 = t1**(1.D0/3.D0)
      t3 = 0.6203504908994D0*t2
      t4 = 1.D0 .le. t3
      t5 = t1**(1.D0/6.D0)
      t8 = 1.D0+0.1101176160755631D1*t5+0.1619735131738333D0*t2
      t11 = dlog(t3)
      t17 = piecewise(t4,-0.843D-1/t8,0.1555D-1*t11-0.269D-1
     #+0.43424534362958D-3*t2*t11-0.297768235631712D-2*t2)
      zk(i) = rhob*t17
      vrhoa(i) = 0.D0
      t18 = t8**2
      t19 = 1/t18
      t20 = t5**2
      t21 = t20**2
      t22 = t21*t5
      t23 = 1/t22
      t24 = rhob**2
      t25 = 1/t24
      t28 = t2**2
      t29 = 1/t28
      t30 = t29*t25
      t32 = -0.1835293601259385D0*t23*t25-0.5399117105794445D-1*t30
      t36 = t29*t11
      t43 = piecewise(t4,0.843D-1*t19*t32,-0.5183333333333333D-2*t1
     #-0.1447484478765267D-3*t36*t25-0.1447484478765267D-3*t2*t1
     #+0.99256078543904D-3*t30)
      vrhob(i) = t17+rhob*t43
      v2rhoa2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t48 = t32**2
      t53 = t24**2
      t54 = 1/t53
      t58 = 1/t24/rhob
      t62 = 1/t28/t1
      t63 = t62*t54
      t65 = t29*t58
      t82 = piecewise(t4,-0.1686D0/t18/t8*t48+0.843D-1*t19*(
     #-0.1529411334382821D0/t22/t1*t54+0.367058720251877D0*t23*t58
     #-0.3599411403862963D-1*t63+0.1079823421158889D0*t65
     #),0.5183333333333333D-2*t25-0.9649896525101778D-4*t62*t11*t54
     #-0.1888622605627062D-2*t65+0.2894968957530533D-3*t36*t58
     #+0.1447484478765267D-3*t2*t25+0.6617071902926934D-3*t63)
      v2rhob2(i) = 2.D0*t43+rhob*t82
      elseif(rhob.lt.tol) then
      rho = rhoa
      t1 = 1/rhoa
      t2 = t1**(1.D0/3.D0)
      t3 = 0.6203504908994D0*t2
      t4 = 1.D0 .le. t3
      t5 = t1**(1.D0/6.D0)
      t8 = 1.D0+0.1101176160755631D1*t5+0.1619735131738333D0*t2
      t11 = dlog(t3)
      t17 = piecewise(t4,-0.843D-1/t8,0.1555D-1*t11-0.269D-1
     #+0.43424534362958D-3*t2*t11-0.297768235631712D-2*t2)
      zk(i) = rhoa*t17
      t18 = t8**2
      t19 = 1/t18
      t20 = t5**2
      t21 = t20**2
      t22 = t21*t5
      t23 = 1/t22
      t24 = rhoa**2
      t25 = 1/t24
      t28 = t2**2
      t29 = 1/t28
      t30 = t29*t25
      t32 = -0.1835293601259385D0*t23*t25-0.5399117105794445D-1*t30
      t36 = t29*t11
      t43 = piecewise(t4,0.843D-1*t19*t32,-0.5183333333333333D-2*t1
     #-0.1447484478765267D-3*t36*t25-0.1447484478765267D-3*t2*t1
     #+0.99256078543904D-3*t30)
      vrhoa(i) = t17+rhoa*t43
      vrhob(i) = 0.D0
      t48 = t32**2
      t53 = t24**2
      t54 = 1/t53
      t58 = 1/t24/rhoa
      t62 = 1/t28/t1
      t63 = t62*t54
      t65 = t29*t58
      t82 = piecewise(t4,-0.1686D0/t18/t8*t48+0.843D-1*t19*(
     #-0.1529411334382821D0/t22/t1*t54+0.367058720251877D0*t23*t58
     #-0.3599411403862963D-1*t63+0.1079823421158889D0*t65
     #),0.5183333333333333D-2*t25-0.9649896525101778D-4*t62*t11*t54
     #-0.1888622605627062D-2*t65+0.2894968957530533D-3*t36*t58
     #+0.1447484478765267D-3*t2*t25+0.6617071902926934D-3*t63)
      v2rhoa2(i) = 2.D0*t43+rhoa*t82
      v2rhob2(i) = 0.D0
      v2rhoab(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      t1 = 1/rho
      t2 = t1**(1.D0/3.D0)
      t3 = 0.6203504908994D0*t2
      t4 = 1.D0 .le. t3
      t5 = t1**(1.D0/6.D0)
      t8 = 1.D0+0.8292885914166397D0*t5+0.20682485366586D0*t2
      t10 = 0.1423D0/t8
      t13 = 1.D0+0.1101176160755631D1*t5+0.1619735131738333D0*t2
      t16 = -0.843D-1/t13+t10
      t18 = rhoa-1.D0*rhob
      t19 = t18*t1
      t20 = 1.D0+t19
      t21 = t20**(1.D0/3.D0)
      t24 = 1.D0-1.D0*t19
      t25 = t24**(1.D0/3.D0)
      t27 = t21*t20+t25*t24-2.D0
      t31 = dlog(t3)
      t33 = t2*t31
      t39 = -0.1555D-1*t31+0.211D-1-0.80645563816922D-3*t33
     #+0.421838333811592D-2*t2
      t43 = piecewise(t4,-t10+0.1923661050931536D1*t16*t27,0.311D-1
     #*t31-0.48D-1+0.12407009817988D-2*t33-0.719606569443304D-2*t2
     #+0.1923661050931536D1*t39*t27)
      zk(i) = rho*t43
      t48 = 0.1333333333333333D1*t21*t1-0.1333333333333333D1*t25*t1
      t53 = piecewise(t4,0.1923661050931536D1*t16
     #*t48,0.1923661050931536D1*t39*t48)
      t55 = t8**2
      t56 = 1/t55
      t57 = t5**2
      t58 = t57**2
      t59 = t58*t5
      t60 = 1/t59
      t61 = rho**2
      t62 = 1/t61
      t63 = t60*t62
      t65 = t2**2
      t66 = 1/t65
      t67 = t66*t62
      t69 = -0.1382147652361066D0*t63-0.6894161788861999D-1*t67
      t71 = 0.1423D0*t56*t69
      t72 = t13**2
      t73 = 1/t72
      t76 = -0.1835293601259385D0*t63-0.5399117105794445D-1*t67
      t79 = 0.843D-1*t73*t76-t71
      t82 = t21*t18
      t85 = t25*t18
      t88 = -0.1333333333333333D1*t82*t62+0.1333333333333333D1*t85*t62
      t93 = t66*t31
      t94 = t93*t62
      t96 = t2*t1
      t103 = 0.5183333333333333D-2*t1+0.2688185460564067D-3*t94
     #+0.2688185460564067D-3*t96-0.1406127779371973D-2*t67
      t109 = piecewise(t4,t71+0.1923661050931536D1*t79*t27
     #+0.1923661050931536D1*t16*t88,-0.1036666666666667D-1*t1
     #-0.4135669939329333D-3*t94-0.4135669939329333D-3*t96
     #+0.2398688564811013D-2*t67+0.1923661050931536D1*t103*t27
     #+0.1923661050931536D1*t39*t88)
      t110 = rho*t109
      vrhoa(i) = rho*t53+t43+t110
      t111 = -t48
      t116 = piecewise(t4,0.1923661050931536D1*t16
     #*t111,0.1923661050931536D1*t39*t111)
      vrhob(i) = rho*t116+t43+t110
      t118 = t21**2
      t119 = 1/t118
      t122 = t25**2
      t123 = 1/t122
      t126 = 0.4444444444444444D0*t119*t62+0.4444444444444444D0*t123*t62
      t131 = piecewise(t4,0.1923661050931536D1*t16
     #*t126,0.1923661050931536D1*t39*t126)
      t132 = rho*t131
      t138 = 1/t61/rho
      t148 = -0.4444444444444444D0*t119*t18*t138-0.1333333333333333D1
     #*t21*t62-0.4444444444444444D0*t123*t18*t138+0.1333333333333333D1
     #*t25*t62
      t157 = piecewise(t4,0.1923661050931536D1*t79*t48
     #+0.1923661050931536D1*t16*t148,0.1923661050931536D1*t103*t48
     #+0.1923661050931536D1*t39*t148)
      t158 = rho*t157
      t160 = 2.D0*t109
      t163 = t69**2
      t165 = 0.2846D0/t55/t8*t163
      t168 = t61**2
      t169 = 1/t168
      t170 = 1/t59/t1*t169
      t172 = t60*t138
      t175 = 1/t65/t1
      t176 = t175*t169
      t178 = t66*t138
      t182 = 0.1423D0*t56*(-0.1151789710300888D0*t170
     #+0.2764295304722132D0*t172-0.4596107859241333D-1*t176
     #+0.13788323577724D0*t178)
      t185 = t76**2
      t200 = t18**2
      t211 = 0.4444444444444444D0*t119*t200*t169+0.2666666666666667D1
     #*t82*t138+0.4444444444444444D0*t123*t200*t169
     #-0.2666666666666667D1*t85*t138
      t217 = t175*t31*t169
      t220 = t93*t138
      t222 = t2*t62
      t239 = piecewise(t4,-t165+t182+0.1923661050931536D1*(-0.1686D0
     #/t72/t13*t185+0.843D-1*t73*(-0.1529411334382821D0*t170
     #+0.367058720251877D0*t172-0.3599411403862963D-1*t176
     #+0.1079823421158889D0*t178)+t165-t182)*t27+0.3847322101863073D1
     #*t79*t88+0.1923661050931536D1*t16*t211,0.1036666666666667D-1*t62
     #-0.2757113292886222D-3*t217-0.4521665800333405D-2*t178
     #+0.8271339878658667D-3*t220+0.4135669939329333D-3*t222
     #+0.1599125709874009D-2*t176+0.1923661050931536D1*(
     #-0.5183333333333333D-2*t62+0.1792123640376044D-3*t217
     #+0.2633043194706342D-2*t178-0.5376370921128133D-3*t220
     #-0.2688185460564067D-3*t222-0.9374185195813156D-3*t176)*t27
     #+0.3847322101863073D1*t103*t88+0.1923661050931536D1*t39*t211)
      t240 = rho*t239
      v2rhoa2(i) = t132+2.D0*t53+2.D0*t158+t160+t240
      t244 = -t148
      t253 = piecewise(t4,0.1923661050931536D1*t79*t111
     #+0.1923661050931536D1*t16*t244,0.1923661050931536D1*t103*t111
     #+0.1923661050931536D1*t39*t244)
      t254 = rho*t253
      v2rhob2(i) = t132+2.D0*t116+2.D0*t254+t160+t240
      t256 = -t126
      t261 = piecewise(t4,0.1923661050931536D1*t16
     #*t256,0.1923661050931536D1*t39*t256)
      v2rhoab(i) = rho*t261+t116+t254+t53+t158+t160+t240
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      v2rhob2(i) = 0.0d0
      v2rhoab(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end
      
      
      subroutine rks_c_pz81
     & (ideriv,npt,rhoa1,sigmaaa1,
     &  zk,vrhoa,vsigmaaa,
     &  v2rhoa2,v2rhoasigmaaa,v2sigmaaa2)
c
c     J.P. Perdew, and A. Zunger
c     Self-interaction correction to density-functional approximations 
c     for many-electron systems
c     Phys. Rev. B23 (1981) 5048-5079
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt)
      REAL sigmaaa1(npt)
      REAL zk(npt),vrhoa(npt),vsigmaaa(npt)
      REAL v2rhoa2(npt),v2rhoasigmaaa(npt),v2sigmaaa2(npt)
      parameter(tol=1.0d-20)
      logical t4
      
      if(ideriv.eq.0) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      t1 = 1/rho
      t2 = t1**(1.D0/3.D0)
      t3 = 0.6203504908994D0*t2
      t5 = t1**(1.D0/6.D0)
      t11 = dlog(t3)
      t17 = piecewise(1.D0 .le. t3,-0.1423D0/(1.D0
     #+0.8292885914166397D0*t5+0.20682485366586D0*t2),0.311D-1*t11
     #-0.48D-1+0.12407009817988D-2*t2*t11-0.719606569443304D-2*t2)
      zk(i) = rho*t17
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      t1 = 1/rho
      t2 = t1**(1.D0/3.D0)
      t3 = 0.6203504908994D0*t2
      t4 = 1.D0 .le. t3
      t5 = t1**(1.D0/6.D0)
      t8 = 1.D0+0.8292885914166397D0*t5+0.20682485366586D0*t2
      t11 = dlog(t3)
      t17 = piecewise(t4,-0.1423D0/t8,0.311D-1*t11-0.48D-1
     #+0.12407009817988D-2*t2*t11-0.719606569443304D-2*t2)
      zk(i) = rho*t17
      t18 = piecewise(t4,0.D0,0.D0)
      t20 = t8**2
      t22 = t5**2
      t23 = t22**2
      t26 = rho**2
      t27 = 1/t26
      t30 = t2**2
      t31 = 1/t30
      t32 = t31*t27
      t45 = piecewise(t4,0.1423D0/t20*(-0.1382147652361066D0/t23/t5
     #*t27-0.6894161788861999D-1*t32),-0.1036666666666667D-1*t1
     #-0.4135669939329333D-3*t31*t11*t27-0.4135669939329333D-3*t2*t1
     #+0.2398688564811013D-2*t32)
      vrhoa(i) = rho*t18+t17+rho*t45
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      t1 = 1/rho
      t2 = t1**(1.D0/3.D0)
      t3 = 0.6203504908994D0*t2
      t4 = 1.D0 .le. t3
      t5 = t1**(1.D0/6.D0)
      t8 = 1.D0+0.8292885914166397D0*t5+0.20682485366586D0*t2
      t10 = 0.1423D0/t8
      t11 = dlog(t3)
      t13 = t2*t11
      t17 = piecewise(t4,-t10,0.311D-1*t11-0.48D-1+0.12407009817988D-2
     #*t13-0.719606569443304D-2*t2)
      zk(i) = rho*t17
      t18 = piecewise(t4,0.D0,0.D0)
      t19 = rho*t18
      t20 = t8**2
      t21 = 1/t20
      t22 = t5**2
      t23 = t22**2
      t24 = t23*t5
      t25 = 1/t24
      t26 = rho**2
      t27 = 1/t26
      t30 = t2**2
      t31 = 1/t30
      t32 = t31*t27
      t34 = -0.1382147652361066D0*t25*t27-0.6894161788861999D-1*t32
      t38 = t31*t11
      t45 = piecewise(t4,0.1423D0*t21*t34,-0.1036666666666667D-1*t1
     #-0.4135669939329333D-3*t38*t27-0.4135669939329333D-3*t2*t1
     #+0.2398688564811013D-2*t32)
      vrhoa(i) = t19+t17+rho*t45
      t53 = (-0.843D-1/(1.D0+0.1101176160755631D1*t5
     #+0.1619735131738333D0*t2)+t10)*t27
      t59 = (-0.1555D-1*t11+0.211D-1-0.80645563816922D-3*t13
     #+0.421838333811592D-2*t2)*t27
      t61 = piecewise(t4,0.1709920934161366D1*t53,0.1709920934161366D1
     #*t59)
      t68 = t34**2
      t73 = t26**2
      t74 = 1/t73
      t78 = 1/t26/rho
      t82 = 1/t30/t1
      t83 = t82*t74
      t85 = t31*t78
      t102 = piecewise(t4,-0.2846D0/t20/t8*t68+0.1423D0*t21*(
     #-0.1151789710300888D0/t24/t1*t74+0.2764295304722132D0*t25*t78
     #-0.4596107859241333D-1*t83+0.13788323577724D0*t85
     #),0.1036666666666667D-1*t27-0.2757113292886222D-3*t82*t11*t74
     #-0.4521665800333405D-2*t85+0.8271339878658667D-3*t38*t78
     #+0.4135669939329333D-3*t2*t27+0.1599125709874009D-2*t83)
      t107 = piecewise(t4,-0.1709920934161366D1*t53,
     #-0.1709920934161366D1*t59)
      v2rhoa2(i) = rho*t61+4.D0*t18+4.D0*t19+4.D0*t45+2.D0*rho*t102
     #+rho*t107
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end

c:C_PZ81subrend
_ENDIF
_IF(ccpdft,all,c_p86)
c:C_P86subrstart

c    Generated: Tue Mar  9 13:39:23 GMT 2004

      subroutine uks_c_p86
     & (ideriv,npt,rhoa1,rhob1,sigmaaa1,sigmabb1,sigmaab1,
     &  zk,vrhoa,vrhob,vsigmaaa,vsigmabb,vsigmaab,
     &  v2rhoa2,v2rhob2,v2rhoab,
     &  v2rhoasigmaaa,v2rhoasigmaab,v2rhoasigmabb,
     &  v2rhobsigmabb,v2rhobsigmaab,v2rhobsigmaaa,
     &  v2sigmaaa2,v2sigmaaaab,v2sigmaaabb,
     &  v2sigmaab2,v2sigmaabbb,v2sigmabb2)
c
c     J.P. Perdew
c     Density-functional approximation for the correlation energy of
c     the inhomogeneous electron gas
c     Phys. Rev. B33 (1986) 8822-8824
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt),rhob1(npt)
      REAL sigmaaa1(npt),sigmabb1(npt),sigmaab1(npt)
      REAL zk(npt),vrhoa(npt),vrhob(npt)
      REAL vsigmaaa(npt),vsigmabb(npt),vsigmaab(npt)
      REAL v2rhoa2(npt),v2rhob2(npt),v2rhoab(npt)
      REAL v2rhoasigmaaa(npt),v2rhoasigmaab(npt)
      REAL v2rhoasigmabb(npt),v2rhobsigmabb(npt)
      REAL v2rhobsigmaab(npt),v2rhobsigmaaa(npt)
      REAL v2sigmaaa2(npt),v2sigmaaaab(npt),v2sigmaaabb(npt)
      REAL v2sigmaab2(npt),v2sigmaabbb(npt),v2sigmabb2(npt)
      parameter(tol=1.0d-20)
      logical t7
      
      if (ideriv.eq.0) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = 1/rhob
      t3 = t2**(1.D0/3.D0)
      t4 = 0.6203504908994D0*t3
      t6 = t2**(1.D0/6.D0)
      t12 = dlog(t4)
      t18 = piecewise(1.D0 .le. t4,-0.843D-1/(1.D0
     #+0.1101176160755631D1*t6+0.1619735131738333D0*t3),0.1555D-1*t12
     #-0.269D-1+0.43424534362958D-3*t3*t12-0.297768235631712D-2*t3)
      t20 = dsqrt(sigmabb)
      t22 = t3**2
      t31 = 0.1667D-2+(0.2568D-2+0.1443307452126544D-1*t3
     #+0.2843543831490386D-5*t22)/(1.D0+0.5411317332115466D1*t3
     #+0.1816419932959077D0*t22+0.1763993811759022D-1*t2)
      t34 = rhob**(1.D0/6.D0)
      t39 = dexp(-0.81290825D-3*t20/t31/t34/rhob)
      t41 = rhob**(1.D0/3.D0)
      zk(i) = rhob*t18+0.7937005259840997D0*t39*t31*sigmabb/t41/rhob
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = 1/rhoa
      t3 = t2**(1.D0/3.D0)
      t4 = 0.6203504908994D0*t3
      t6 = t2**(1.D0/6.D0)
      t12 = dlog(t4)
      t18 = piecewise(1.D0 .le. t4,-0.843D-1/(1.D0
     #+0.1101176160755631D1*t6+0.1619735131738333D0*t3),0.1555D-1*t12
     #-0.269D-1+0.43424534362958D-3*t3*t12-0.297768235631712D-2*t3)
      t20 = dsqrt(sigmaaa)
      t22 = t3**2
      t31 = 0.1667D-2+(0.2568D-2+0.1443307452126544D-1*t3
     #+0.2843543831490386D-5*t22)/(1.D0+0.5411317332115466D1*t3
     #+0.1816419932959077D0*t22+0.1763993811759022D-1*t2)
      t34 = rhoa**(1.D0/6.D0)
      t39 = dexp(-0.81290825D-3*t20/t31/t34/rhoa)
      t41 = rhoa**(1.D0/3.D0)
      zk(i) = rhoa*t18+0.7937005259840997D0*t39*t31*sigmaaa/t41/rhoa
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = 1/rho
      t5 = t4**(1.D0/3.D0)
      t6 = 0.6203504908994D0*t5
      t8 = t4**(1.D0/6.D0)
      t13 = 0.1423D0/(1.D0+0.8292885914166397D0*t8+0.20682485366586D0
     #*t5)
      t22 = (rhoa-1.D0*rhob)*t4
      t23 = 1.D0+t22
      t24 = t23**(1.D0/3.D0)
      t27 = 1.D0-1.D0*t22
      t28 = t27**(1.D0/3.D0)
      t30 = t24*t23+t28*t27-2.D0
      t34 = dlog(t6)
      t36 = t5*t34
      t46 = piecewise(1.D0 .le. t6,-t13+0.1923661050931536D1*(
     #-0.843D-1/(1.D0+0.1101176160755631D1*t8+0.1619735131738333D0*t5)
     #+t13)*t30,0.311D-1*t34-0.48D-1+0.12407009817988D-2*t36
     #-0.719606569443304D-2*t5+0.1923661050931536D1*(-0.1555D-1*t34
     #+0.211D-1-0.80645563816922D-3*t36+0.421838333811592D-2*t5)*t30)
      t48 = dsqrt(sigma)
      t50 = t5**2
      t59 = 0.1667D-2+(0.2568D-2+0.1443307452126544D-1*t5
     #+0.2843543831490386D-5*t50)/(1.D0+0.5411317332115466D1*t5
     #+0.1816419932959077D0*t50+0.1763993811759022D-1*t4)
      t62 = rho**(1.D0/6.D0)
      t67 = dexp(-0.81290825D-3*t48/t59/t62/rho)
      t69 = rho**(1.D0/3.D0)
      t74 = 0.5D0+0.5D0*t22
      t75 = t74**(1.D0/3.D0)
      t76 = t75**2
      t79 = 0.5D0-0.5D0*t22
      t80 = t79**(1.D0/3.D0)
      t81 = t80**2
      t84 = dsqrt(t76*t74+t81*t79)
      zk(i) = rho*t46+0.7937005259840997D0*t67*t59*sigma/t69/rho/t84
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = 1/rhob
      t3 = t2**(1.D0/3.D0)
      t4 = 0.6203504908994D0*t3
      t7 = 1.D0 .le. t4
      t6 = t2**(1.D0/6.D0)
      t9 = 1.D0+0.1101176160755631D1*t6+0.1619735131738333D0*t3
      t12 = dlog(t4)
      t18 = piecewise(t7,-0.843D-1/t9,0.1555D-1*t12-0.269D-1
     #+0.43424534362958D-3*t3*t12-0.297768235631712D-2*t3)
      t20 = dsqrt(sigmabb)
      t22 = t3**2
      t24 = 0.2568D-2+0.1443307452126544D-1*t3+0.2843543831490386D-5*t22
      t28 = 1.D0+0.5411317332115466D1*t3+0.1816419932959077D0*t22
     #+0.1763993811759022D-1*t2
      t29 = 1/t28
      t31 = 0.1667D-2+t24*t29
      t33 = t20/t31
      t34 = rhob**(1.D0/6.D0)
      t36 = 1/t34/rhob
      t39 = dexp(-0.81290825D-3*t33*t36)
      t40 = t39*t31
      t41 = rhob**(1.D0/3.D0)
      t43 = 1/t41/rhob
      t44 = sigmabb*t43
      zk(i) = rhob*t18+0.7937005259840997D0*t40*t44
      vrhoa(i) = 0.D0
      t47 = t9**2
      t49 = t6**2
      t50 = t49**2
      t53 = rhob**2
      t54 = 1/t53
      t57 = 1/t22
      t58 = t57*t54
      t71 = piecewise(t7,0.843D-1/t47*(-0.1835293601259385D0/t50/t6
     #*t54-0.5399117105794445D-1*t58),-0.5183333333333333D-2*t2
     #-0.1447484478765267D-3*t57*t12*t54-0.1447484478765267D-3*t3*t2
     #+0.99256078543904D-3*t58)
      t73 = t31**2
      t78 = 1/t3*t54
      t82 = t28**2
      t91 = (-0.4811024840421814D-2*t58-0.1895695887660258D-5*t78)*t29
     #-1.D0*t24/t82*(-0.1803772444038489D1*t58-0.1210946621972718D0
     #*t78-0.1763993811759022D-1*t54)
      vrhob(i) = t18+rhob*t71+0.7937005259840997D0*(0.81290825D-3*t20
     #/t73*t36*t91+0.9483929583333333D-3*t33/t34/t53)*t39*t31*sigmabb
     #*t43+0.7937005259840997D0*t39*t91*t44-0.10582673679788D1*t40
     #*sigmabb/t41/t53
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      t113 = dsqrt(rhob)
      vsigmabb(i) = -0.322602852800907D-3*t20/t113/t53*t39
     #+0.7937005259840997D0*t40*t43
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = 1/rhoa
      t3 = t2**(1.D0/3.D0)
      t4 = 0.6203504908994D0*t3
      t7 = 1.D0 .le. t4
      t6 = t2**(1.D0/6.D0)
      t9 = 1.D0+0.1101176160755631D1*t6+0.1619735131738333D0*t3
      t12 = dlog(t4)
      t18 = piecewise(t7,-0.843D-1/t9,0.1555D-1*t12-0.269D-1
     #+0.43424534362958D-3*t3*t12-0.297768235631712D-2*t3)
      t20 = dsqrt(sigmaaa)
      t22 = t3**2
      t24 = 0.2568D-2+0.1443307452126544D-1*t3+0.2843543831490386D-5*t22
      t28 = 1.D0+0.5411317332115466D1*t3+0.1816419932959077D0*t22
     #+0.1763993811759022D-1*t2
      t29 = 1/t28
      t31 = 0.1667D-2+t24*t29
      t33 = t20/t31
      t34 = rhoa**(1.D0/6.D0)
      t36 = 1/t34/rhoa
      t39 = dexp(-0.81290825D-3*t33*t36)
      t40 = t39*t31
      t41 = rhoa**(1.D0/3.D0)
      t43 = 1/t41/rhoa
      t44 = sigmaaa*t43
      zk(i) = rhoa*t18+0.7937005259840997D0*t40*t44
      t47 = t9**2
      t49 = t6**2
      t50 = t49**2
      t53 = rhoa**2
      t54 = 1/t53
      t57 = 1/t22
      t58 = t57*t54
      t71 = piecewise(t7,0.843D-1/t47*(-0.1835293601259385D0/t50/t6
     #*t54-0.5399117105794445D-1*t58),-0.5183333333333333D-2*t2
     #-0.1447484478765267D-3*t57*t12*t54-0.1447484478765267D-3*t3*t2
     #+0.99256078543904D-3*t58)
      t73 = t31**2
      t78 = 1/t3*t54
      t82 = t28**2
      t91 = (-0.4811024840421814D-2*t58-0.1895695887660258D-5*t78)*t29
     #-1.D0*t24/t82*(-0.1803772444038489D1*t58-0.1210946621972718D0
     #*t78-0.1763993811759022D-1*t54)
      vrhoa(i) = t18+rhoa*t71+0.7937005259840997D0*(0.81290825D-3*t20
     #/t73*t36*t91+0.9483929583333333D-3*t33/t34/t53)*t39*t31*sigmaaa
     #*t43+0.7937005259840997D0*t39*t91*t44-0.10582673679788D1*t40
     #*sigmaaa/t41/t53
      vrhob(i) = 0.D0
      t113 = dsqrt(rhoa)
      vsigmaaa(i) = -0.322602852800907D-3*t20/t113/t53*t39
     #+0.7937005259840997D0*t40*t43
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = 1/rho
      t5 = t4**(1.D0/3.D0)
      t6 = 0.6203504908994D0*t5
      t7 = 1.D0 .le. t6
      t8 = t4**(1.D0/6.D0)
      t11 = 1.D0+0.8292885914166397D0*t8+0.20682485366586D0*t5
      t13 = 0.1423D0/t11
      t16 = 1.D0+0.1101176160755631D1*t8+0.1619735131738333D0*t5
      t19 = -0.843D-1/t16+t13
      t21 = rhoa-1.D0*rhob
      t22 = t21*t4
      t23 = 1.D0+t22
      t24 = t23**(1.D0/3.D0)
      t27 = 1.D0-1.D0*t22
      t28 = t27**(1.D0/3.D0)
      t30 = t24*t23+t28*t27-2.D0
      t34 = dlog(t6)
      t36 = t5*t34
      t42 = -0.1555D-1*t34+0.211D-1-0.80645563816922D-3*t36
     #+0.421838333811592D-2*t5
      t46 = piecewise(t7,-t13+0.1923661050931536D1*t19*t30,0.311D-1
     #*t34-0.48D-1+0.12407009817988D-2*t36-0.719606569443304D-2*t5
     #+0.1923661050931536D1*t42*t30)
      t48 = dsqrt(sigma)
      t50 = t5**2
      t52 = 0.2568D-2+0.1443307452126544D-1*t5+0.2843543831490386D-5*t50
      t56 = 1.D0+0.5411317332115466D1*t5+0.1816419932959077D0*t50
     #+0.1763993811759022D-1*t4
      t57 = 1/t56
      t59 = 0.1667D-2+t52*t57
      t61 = t48/t59
      t62 = rho**(1.D0/6.D0)
      t64 = 1/t62/rho
      t67 = dexp(-0.81290825D-3*t61*t64)
      t68 = t67*t59
      t69 = rho**(1.D0/3.D0)
      t71 = 1/t69/rho
      t74 = 0.5D0+0.5D0*t22
      t75 = t74**(1.D0/3.D0)
      t76 = t75**2
      t79 = 0.5D0-0.5D0*t22
      t80 = t79**(1.D0/3.D0)
      t81 = t80**2
      t83 = t76*t74+t81*t79
      t84 = dsqrt(t83)
      t85 = 1/t84
      t86 = sigma*t71*t85
      zk(i) = rho*t46+0.7937005259840997D0*t68*t86
      t93 = 0.1333333333333333D1*t24*t4-0.1333333333333333D1*t28*t4
      t98 = piecewise(t7,0.1923661050931536D1*t19
     #*t93,0.1923661050931536D1*t42*t93)
      t100 = t68*sigma
      t103 = t71/t84/t83
      t108 = 0.8333333333333333D0*t76*t4-0.8333333333333333D0*t81*t4
      t112 = t11**2
      t114 = t8**2
      t115 = t114**2
      t118 = rho**2
      t119 = 1/t118
      t120 = 1/t115/t8*t119
      t122 = 1/t50
      t123 = t122*t119
      t127 = 0.1423D0/t112*(-0.1382147652361066D0*t120
     #-0.6894161788861999D-1*t123)
      t128 = t16**2
      t144 = -0.1333333333333333D1*t24*t21*t119+0.1333333333333333D1
     #*t28*t21*t119
      t150 = t122*t34*t119
      t152 = t5*t4
      t165 = piecewise(t7,t127+0.1923661050931536D1*(0.843D-1/t128*(
     #-0.1835293601259385D0*t120-0.5399117105794445D-1*t123)-t127)*t30
     #+0.1923661050931536D1*t19*t144,-0.1036666666666667D-1*t4
     #-0.4135669939329333D-3*t150-0.4135669939329333D-3*t152
     #+0.2398688564811013D-2*t123+0.1923661050931536D1*
     #(0.5183333333333333D-2*t4+0.2688185460564067D-3*t150
     #+0.2688185460564067D-3*t152-0.1406127779371973D-2*t123)*t30
     #+0.1923661050931536D1*t42*t144)
      t166 = rho*t165
      t167 = t59**2
      t172 = 1/t5*t119
      t176 = t56**2
      t185 = (-0.4811024840421814D-2*t123-0.1895695887660258D-5*t172)
     #*t57-1.D0*t52/t176*(-0.1803772444038489D1*t123
     #-0.1210946621972718D0*t172-0.1763993811759022D-1*t119)
      t197 = 0.7937005259840997D0*(0.81290825D-3*t48/t167*t64*t185
     #+0.9483929583333333D-3*t61/t62/t118)*t67*t59*t86
      t200 = 0.7937005259840997D0*t67*t185*t86
      t206 = 0.10582673679788D1*t68*sigma/t69/t118*t85
      t216 = 0.3968502629920499D0*t100*t103*(-0.8333333333333333D0*t76
     #*t21*t119+0.8333333333333333D0*t81*t21*t119)
      vrhoa(i) = rho*t98-0.3968502629920499D0*t100*t103*t108+t46+t166
     #+t197+t200-t206-t216
      t217 = -t93
      t222 = piecewise(t7,0.1923661050931536D1*t19
     #*t217,0.1923661050931536D1*t42*t217)
      vrhob(i) = rho*t222+0.3968502629920499D0*t100*t103*t108+t46+t166
     #+t197+t200-t206-t216
      t228 = dsqrt(rho)
      t233 = t48/t228/t118*t67*t85
      t236 = t68*t71*t85
      vsigmaaa(i) = -0.322602852800907D-3*t233+0.7937005259840997D0*t236
      vsigmaab(i) = -0.645205705601814D-3*t233+0.1587401051968199D1*t236
      vsigmabb(i) = vsigmaaa(i)
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = 1/rhob
      t3 = t2**(1.D0/3.D0)
      t4 = 0.6203504908994D0*t3
      t7 = 1.D0 .le. t4
      t6 = t2**(1.D0/6.D0)
      t9 = 1.D0+0.1101176160755631D1*t6+0.1619735131738333D0*t3
      t12 = dlog(t4)
      t18 = piecewise(t7,-0.843D-1/t9,0.1555D-1*t12-0.269D-1
     #+0.43424534362958D-3*t3*t12-0.297768235631712D-2*t3)
      t20 = dsqrt(sigmabb)
      t22 = t3**2
      t24 = 0.2568D-2+0.1443307452126544D-1*t3+0.2843543831490386D-5*t22
      t28 = 1.D0+0.5411317332115466D1*t3+0.1816419932959077D0*t22
     #+0.1763993811759022D-1*t2
      t29 = 1/t28
      t31 = 0.1667D-2+t24*t29
      t32 = 1/t31
      t33 = t20*t32
      t34 = rhob**(1.D0/6.D0)
      t36 = 1/t34/rhob
      t39 = dexp(-0.81290825D-3*t33*t36)
      t40 = t39*t31
      t41 = rhob**(1.D0/3.D0)
      t43 = 1/t41/rhob
      t44 = sigmabb*t43
      zk(i) = rhob*t18+0.7937005259840997D0*t40*t44
      vrhoa(i) = 0.D0
      t47 = t9**2
      t48 = 1/t47
      t49 = t6**2
      t50 = t49**2
      t51 = t50*t6
      t52 = 1/t51
      t53 = rhob**2
      t54 = 1/t53
      t57 = 1/t22
      t58 = t57*t54
      t60 = -0.1835293601259385D0*t52*t54-0.5399117105794445D-1*t58
      t64 = t57*t12
      t67 = t3*t2
      t71 = piecewise(t7,0.843D-1*t48*t60,-0.5183333333333333D-2*t2
     #-0.1447484478765267D-3*t64*t54-0.1447484478765267D-3*t67
     #+0.99256078543904D-3*t58)
      t73 = t31**2
      t75 = t20/t73
      t77 = 1/t3
      t78 = t77*t54
      t80 = -0.4811024840421814D-2*t58-0.1895695887660258D-5*t78
      t82 = t28**2
      t83 = 1/t82
      t84 = t24*t83
      t88 = -0.1803772444038489D1*t58-0.1210946621972718D0*t78
     #-0.1763993811759022D-1*t54
      t91 = t80*t29-1.D0*t84*t88
      t96 = 1/t34/t53
      t99 = 0.81290825D-3*t75*t36*t91+0.9483929583333333D-3*t33*t96
      t100 = t99*t39
      t101 = t31*sigmabb
      t102 = t101*t43
      t105 = t39*t91
      t109 = 1/t41/t53
      t110 = sigmabb*t109
      vrhob(i) = t18+rhob*t71+0.7937005259840997D0*t100*t102
     #+0.7937005259840997D0*t105*t44-0.10582673679788D1*t40*t110
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      t113 = dsqrt(rhob)
      t115 = 1/t113/t53
      vsigmabb(i) = -0.322602852800907D-3*t20*t115*t39
     #+0.7937005259840997D0*t40*t43
      v2rhoa2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t124 = t60**2
      t129 = t53**2
      t130 = 1/t129
      t133 = t53*rhob
      t134 = 1/t133
      t138 = 1/t22/t2
      t139 = t138*t130
      t141 = t57*t134
      t158 = piecewise(t7,-0.1686D0/t47/t9*t124+0.843D-1*t48*(
     #-0.1529411334382821D0/t51/t2*t130+0.367058720251877D0*t52*t134
     #-0.3599411403862963D-1*t139+0.1079823421158889D0*t141
     #),0.5183333333333333D-2*t54-0.9649896525101778D-4*t138*t12*t130
     #-0.1888622605627062D-2*t141+0.2894968957530533D-3*t64*t134
     #+0.1447484478765267D-3*t3*t54+0.6617071902926934D-3*t139)
      t163 = t91**2
      t173 = 1/t67*t130
      t175 = t77*t134
      t185 = t88**2
      t196 = (-0.3207349893614542D-2*t139+0.9622049680843627D-2*t141
     #-0.6318986292200858D-6*t173+0.3791391775320515D-5*t175)*t29-2.D0
     #*t80*t83*t88+2.D0*t24/t82/t28*t185-1.D0*t84*(
     #-0.1202514962692326D1*t139+0.3607544888076978D1*t141
     #-0.4036488739909061D-1*t173+0.2421893243945437D0*t175
     #+0.3527987623518044D-1*t134)
      t208 = t99**2
      v2rhob2(i) = 2.D0*t71+rhob*t158+0.7937005259840997D0*(
     #-0.16258165D-2*t20/t73/t31*t36*t163-0.1896785916666667D-2*t75
     #*t96*t91+0.81290825D-3*t75*t36*t196-0.2054851409722222D-2*t33
     #/t34/t133)*t39*t102+0.7937005259840997D0*t208*t39*t102
     #+0.1587401051968199D1*t100*t91*sigmabb*t43-0.2116534735957599D1
     #*t100*t101*t109+0.7937005259840997D0*t39*t196*t44
     #-0.2116534735957599D1*t105*t110+0.2469290525283866D1*t40*sigmabb
     #/t41/t133
      v2sigmaaa2(i) = 0.D0
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      t233 = t41**2
      v2sigmabb2(i) = -0.4839042792013605D-3/t20*t115*t39
     #+0.1311232602576965D-6/t233/t133*t32*t39
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = 1/rhoa
      t3 = t2**(1.D0/3.D0)
      t4 = 0.6203504908994D0*t3
      t7 = 1.D0 .le. t4
      t6 = t2**(1.D0/6.D0)
      t9 = 1.D0+0.1101176160755631D1*t6+0.1619735131738333D0*t3
      t12 = dlog(t4)
      t18 = piecewise(t7,-0.843D-1/t9,0.1555D-1*t12-0.269D-1
     #+0.43424534362958D-3*t3*t12-0.297768235631712D-2*t3)
      t20 = dsqrt(sigmaaa)
      t22 = t3**2
      t24 = 0.2568D-2+0.1443307452126544D-1*t3+0.2843543831490386D-5*t22
      t28 = 1.D0+0.5411317332115466D1*t3+0.1816419932959077D0*t22
     #+0.1763993811759022D-1*t2
      t29 = 1/t28
      t31 = 0.1667D-2+t24*t29
      t32 = 1/t31
      t33 = t20*t32
      t34 = rhoa**(1.D0/6.D0)
      t36 = 1/t34/rhoa
      t39 = dexp(-0.81290825D-3*t33*t36)
      t40 = t39*t31
      t41 = rhoa**(1.D0/3.D0)
      t43 = 1/t41/rhoa
      t44 = sigmaaa*t43
      zk(i) = rhoa*t18+0.7937005259840997D0*t40*t44
      t47 = t9**2
      t48 = 1/t47
      t49 = t6**2
      t50 = t49**2
      t51 = t50*t6
      t52 = 1/t51
      t53 = rhoa**2
      t54 = 1/t53
      t57 = 1/t22
      t58 = t57*t54
      t60 = -0.1835293601259385D0*t52*t54-0.5399117105794445D-1*t58
      t64 = t57*t12
      t67 = t3*t2
      t71 = piecewise(t7,0.843D-1*t48*t60,-0.5183333333333333D-2*t2
     #-0.1447484478765267D-3*t64*t54-0.1447484478765267D-3*t67
     #+0.99256078543904D-3*t58)
      t73 = t31**2
      t75 = t20/t73
      t77 = 1/t3
      t78 = t77*t54
      t80 = -0.4811024840421814D-2*t58-0.1895695887660258D-5*t78
      t82 = t28**2
      t83 = 1/t82
      t84 = t24*t83
      t88 = -0.1803772444038489D1*t58-0.1210946621972718D0*t78
     #-0.1763993811759022D-1*t54
      t91 = t80*t29-1.D0*t84*t88
      t96 = 1/t34/t53
      t99 = 0.81290825D-3*t75*t36*t91+0.9483929583333333D-3*t33*t96
      t100 = t99*t39
      t101 = t31*sigmaaa
      t102 = t101*t43
      t105 = t39*t91
      t109 = 1/t41/t53
      t110 = sigmaaa*t109
      vrhoa(i) = t18+rhoa*t71+0.7937005259840997D0*t100*t102
     #+0.7937005259840997D0*t105*t44-0.10582673679788D1*t40*t110
      vrhob(i) = 0.D0
      t113 = dsqrt(rhoa)
      t115 = 1/t113/t53
      vsigmaaa(i) = -0.322602852800907D-3*t20*t115*t39
     #+0.7937005259840997D0*t40*t43
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      t124 = t60**2
      t129 = t53**2
      t130 = 1/t129
      t133 = t53*rhoa
      t134 = 1/t133
      t138 = 1/t22/t2
      t139 = t138*t130
      t141 = t57*t134
      t158 = piecewise(t7,-0.1686D0/t47/t9*t124+0.843D-1*t48*(
     #-0.1529411334382821D0/t51/t2*t130+0.367058720251877D0*t52*t134
     #-0.3599411403862963D-1*t139+0.1079823421158889D0*t141
     #),0.5183333333333333D-2*t54-0.9649896525101778D-4*t138*t12*t130
     #-0.1888622605627062D-2*t141+0.2894968957530533D-3*t64*t134
     #+0.1447484478765267D-3*t3*t54+0.6617071902926934D-3*t139)
      t163 = t91**2
      t173 = 1/t67*t130
      t175 = t77*t134
      t185 = t88**2
      t196 = (-0.3207349893614542D-2*t139+0.9622049680843627D-2*t141
     #-0.6318986292200858D-6*t173+0.3791391775320515D-5*t175)*t29-2.D0
     #*t80*t83*t88+2.D0*t24/t82/t28*t185-1.D0*t84*(
     #-0.1202514962692326D1*t139+0.3607544888076978D1*t141
     #-0.4036488739909061D-1*t173+0.2421893243945437D0*t175
     #+0.3527987623518044D-1*t134)
      t208 = t99**2
      v2rhoa2(i) = 2.D0*t71+rhoa*t158+0.7937005259840997D0*(
     #-0.16258165D-2*t20/t73/t31*t36*t163-0.1896785916666667D-2*t75
     #*t96*t91+0.81290825D-3*t75*t36*t196-0.2054851409722222D-2*t33
     #/t34/t133)*t39*t102+0.7937005259840997D0*t208*t39*t102
     #+0.1587401051968199D1*t100*t91*sigmaaa*t43-0.2116534735957599D1
     #*t100*t101*t109+0.7937005259840997D0*t39*t196*t44
     #-0.2116534735957599D1*t105*t110+0.2469290525283866D1*t40*sigmaaa
     #/t41/t133
      v2rhob2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t233 = t41**2
      v2sigmaaa2(i) = -0.4839042792013605D-3/t20*t115*t39
     #+0.1311232602576965D-6/t233/t133*t32*t39
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      v2sigmabb2(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = 1/rho
      t5 = t4**(1.D0/3.D0)
      t6 = 0.6203504908994D0*t5
      t7 = 1.D0 .le. t6
      t8 = t4**(1.D0/6.D0)
      t11 = 1.D0+0.8292885914166397D0*t8+0.20682485366586D0*t5
      t13 = 0.1423D0/t11
      t16 = 1.D0+0.1101176160755631D1*t8+0.1619735131738333D0*t5
      t19 = -0.843D-1/t16+t13
      t21 = rhoa-1.D0*rhob
      t22 = t21*t4
      t23 = 1.D0+t22
      t24 = t23**(1.D0/3.D0)
      t27 = 1.D0-1.D0*t22
      t28 = t27**(1.D0/3.D0)
      t30 = t24*t23+t28*t27-2.D0
      t34 = dlog(t6)
      t36 = t5*t34
      t42 = -0.1555D-1*t34+0.211D-1-0.80645563816922D-3*t36
     #+0.421838333811592D-2*t5
      t46 = piecewise(t7,-t13+0.1923661050931536D1*t19*t30,0.311D-1
     #*t34-0.48D-1+0.12407009817988D-2*t36-0.719606569443304D-2*t5
     #+0.1923661050931536D1*t42*t30)
      t48 = dsqrt(sigma)
      t50 = t5**2
      t52 = 0.2568D-2+0.1443307452126544D-1*t5+0.2843543831490386D-5*t50
      t56 = 1.D0+0.5411317332115466D1*t5+0.1816419932959077D0*t50
     #+0.1763993811759022D-1*t4
      t57 = 1/t56
      t59 = 0.1667D-2+t52*t57
      t60 = 1/t59
      t61 = t48*t60
      t62 = rho**(1.D0/6.D0)
      t64 = 1/t62/rho
      t67 = dexp(-0.81290825D-3*t61*t64)
      t68 = t67*t59
      t69 = rho**(1.D0/3.D0)
      t71 = 1/t69/rho
      t72 = sigma*t71
      t74 = 0.5D0+0.5D0*t22
      t75 = t74**(1.D0/3.D0)
      t76 = t75**2
      t79 = 0.5D0-0.5D0*t22
      t80 = t79**(1.D0/3.D0)
      t81 = t80**2
      t83 = t76*t74+t81*t79
      t84 = dsqrt(t83)
      t85 = 1/t84
      t86 = t72*t85
      zk(i) = rho*t46+0.7937005259840997D0*t68*t86
      t93 = 0.1333333333333333D1*t24*t4-0.1333333333333333D1*t28*t4
      t98 = piecewise(t7,0.1923661050931536D1*t19
     #*t93,0.1923661050931536D1*t42*t93)
      t100 = t68*sigma
      t102 = 1/t84/t83
      t103 = t71*t102
      t108 = 0.8333333333333333D0*t76*t4-0.8333333333333333D0*t81*t4
      t109 = t103*t108
      t112 = t11**2
      t113 = 1/t112
      t114 = t8**2
      t115 = t114**2
      t116 = t115*t8
      t117 = 1/t116
      t118 = rho**2
      t119 = 1/t118
      t120 = t117*t119
      t122 = 1/t50
      t123 = t122*t119
      t125 = -0.1382147652361066D0*t120-0.6894161788861999D-1*t123
      t127 = 0.1423D0*t113*t125
      t128 = t16**2
      t129 = 1/t128
      t132 = -0.1835293601259385D0*t120-0.5399117105794445D-1*t123
      t135 = 0.843D-1*t129*t132-t127
      t138 = t24*t21
      t141 = t28*t21
      t144 = -0.1333333333333333D1*t138*t119+0.1333333333333333D1*t141
     #*t119
      t149 = t122*t34
      t150 = t149*t119
      t152 = t5*t4
      t159 = 0.5183333333333333D-2*t4+0.2688185460564067D-3*t150
     #+0.2688185460564067D-3*t152-0.1406127779371973D-2*t123
      t165 = piecewise(t7,t127+0.1923661050931536D1*t135*t30
     #+0.1923661050931536D1*t19*t144,-0.1036666666666667D-1*t4
     #-0.4135669939329333D-3*t150-0.4135669939329333D-3*t152
     #+0.2398688564811013D-2*t123+0.1923661050931536D1*t159*t30
     #+0.1923661050931536D1*t42*t144)
      t166 = rho*t165
      t167 = t59**2
      t168 = 1/t167
      t169 = t48*t168
      t171 = 1/t5
      t172 = t171*t119
      t174 = -0.4811024840421814D-2*t123-0.1895695887660258D-5*t172
      t176 = t56**2
      t177 = 1/t176
      t178 = t52*t177
      t182 = -0.1803772444038489D1*t123-0.1210946621972718D0*t172
     #-0.1763993811759022D-1*t119
      t185 = t174*t57-1.D0*t178*t182
      t186 = t64*t185
      t190 = 1/t62/t118
      t193 = 0.81290825D-3*t169*t186+0.9483929583333333D-3*t61*t190
      t194 = t193*t67
      t195 = t194*t59
      t197 = 0.7937005259840997D0*t195*t86
      t198 = t67*t185
      t200 = 0.7937005259840997D0*t198*t86
      t202 = 1/t69/t118
      t204 = sigma*t202*t85
      t206 = 0.10582673679788D1*t68*t204
      t207 = t76*t21
      t210 = t81*t21
      t213 = -0.8333333333333333D0*t207*t119+0.8333333333333333D0*t210
     #*t119
      t214 = t103*t213
      t216 = 0.3968502629920499D0*t100*t214
      vrhoa(i) = rho*t98-0.3968502629920499D0*t100*t109+t46+t166+t197
     #+t200-t206-t216
      t217 = -t93
      t222 = piecewise(t7,0.1923661050931536D1*t19
     #*t217,0.1923661050931536D1*t42*t217)
      t224 = -t108
      t225 = t103*t224
      vrhob(i) = rho*t222-0.3968502629920499D0*t100*t225+t46+t166+t197
     #+t200-t206-t216
      t228 = dsqrt(rho)
      t230 = 1/t228/t118
      t231 = t48*t230
      t232 = t67*t85
      t233 = t231*t232
      t235 = t71*t85
      t236 = t68*t235
      vsigmaaa(i) = -0.322602852800907D-3*t233+0.7937005259840997D0*t236
      vsigmaab(i) = -0.645205705601814D-3*t233+0.1587401051968199D1*t236
      vsigmabb(i) = vsigmaaa(i)
      t240 = 2.D0*t165
      t244 = t185**2
      t252 = 1/t50/t4
      t253 = t118**2
      t254 = 1/t253
      t255 = t252*t254
      t257 = t118*rho
      t258 = 1/t257
      t259 = t122*t258
      t262 = 1/t152*t254
      t264 = t171*t258
      t274 = t182**2
      t285 = (-0.3207349893614542D-2*t255+0.9622049680843627D-2*t259
     #-0.6318986292200858D-6*t262+0.3791391775320515D-5*t264)*t57-2.D0
     #*t174*t177*t182+2.D0*t52/t176/t56*t274-1.D0*t178*(
     #-0.1202514962692326D1*t255+0.3607544888076978D1*t259
     #-0.4036488739909061D-1*t262+0.2421893243945437D0*t264
     #+0.3527987623518044D-1*t258)
      t297 = 0.7937005259840997D0*(-0.16258165D-2*t48/t167/t59*t64
     #*t244-0.1896785916666667D-2*t169*t190*t185+0.81290825D-3*t169
     #*t64*t285-0.2054851409722222D-2*t61/t62/t257)*t67*t59*t86
      t298 = t193**2
      t302 = 0.7937005259840997D0*t298*t67*t59*t86
      t306 = 0.7937005259840997D0*t195*t72*t102*t213
      t308 = 0.2116534735957599D1*t195*t204
      t311 = 0.1587401051968199D1*t194*t185*t86
      t314 = 0.7937005259840997D0*t67*t285*t86
      t315 = t198*sigma
      t317 = 0.7937005259840997D0*t315*t214
      t319 = 0.2116534735957599D1*t198*t204
      t320 = t24**2
      t321 = 1/t320
      t324 = t28**2
      t325 = 1/t324
      t328 = 0.4444444444444444D0*t321*t119+0.4444444444444444D0*t325
     #*t119
      t333 = piecewise(t7,0.1923661050931536D1*t19
     #*t328,0.1923661050931536D1*t42*t328)
      t334 = rho*t333
      t335 = t83**2
      t338 = t71/t84/t335
      t339 = t108**2
      t343 = 1/t75
      t346 = 1/t80
      t349 = 0.2777777777777778D0*t343*t119+0.2777777777777778D0*t346
     #*t119
      t352 = 0.3968502629920499D0*t100*t103*t349
      t353 = t240+t297+t302-t306-t308+t311+t314-t317-t319+t334
     #+0.5952753944880748D0*t100*t338*t339-t352
      t355 = t202*t102
      t358 = 0.10582673679788D1*t100*t355*t213
      t364 = 0.2469290525283866D1*t68*sigma/t69/t257*t85
      t375 = -0.2777777777777778D0*t343*t21*t258-0.8333333333333333D0
     #*t76*t119-0.2777777777777778D0*t346*t21*t258
     #+0.8333333333333333D0*t81*t119
      t377 = t100*t103*t375
      t379 = t315*t109
      t383 = t195*t72*t102*t108
      t397 = -0.4444444444444444D0*t321*t21*t258-0.1333333333333333D1
     #*t24*t119-0.4444444444444444D0*t325*t21*t258
     #+0.1333333333333333D1*t28*t119
      t406 = piecewise(t7,0.1923661050931536D1*t135*t93
     #+0.1923661050931536D1*t19*t397,0.1923661050931536D1*t159*t93
     #+0.1923661050931536D1*t42*t397)
      t407 = rho*t406
      t411 = t100*t338*t213*t108
      t414 = t100*t355*t108
      t416 = t213**2
      t419 = 0.5952753944880748D0*t100*t338*t416
      t420 = t21**2
      t434 = 0.3968502629920499D0*t100*t103*(0.2777777777777778D0*t343
     #*t420*t254+0.1666666666666667D1*t207*t258+0.2777777777777778D0
     #*t346*t420*t254-0.1666666666666667D1*t210*t258)
      t437 = t125**2
      t439 = 0.2846D0/t112/t11*t437
      t442 = 1/t116/t4*t254
      t444 = t117*t258
      t450 = 0.1423D0*t113*(-0.1151789710300888D0*t442
     #+0.2764295304722132D0*t444-0.4596107859241333D-1*t255
     #+0.13788323577724D0*t259)
      t453 = t132**2
      t478 = 0.4444444444444444D0*t321*t420*t254+0.2666666666666667D1
     #*t138*t258+0.4444444444444444D0*t325*t420*t254
     #-0.2666666666666667D1*t141*t258
      t484 = t252*t34*t254
      t487 = t149*t258
      t489 = t5*t119
      t506 = piecewise(t7,-t439+t450+0.1923661050931536D1*(-0.1686D0
     #/t128/t16*t453+0.843D-1*t129*(-0.1529411334382821D0*t442
     #+0.367058720251877D0*t444-0.3599411403862963D-1*t255
     #+0.1079823421158889D0*t259)+t439-t450)*t30+0.3847322101863073D1
     #*t135*t144+0.1923661050931536D1*t19*t478,0.1036666666666667D-1
     #*t119-0.2757113292886222D-3*t484-0.4521665800333405D-2*t259
     #+0.8271339878658667D-3*t487+0.4135669939329333D-3*t489
     #+0.1599125709874009D-2*t255+0.1923661050931536D1*(
     #-0.5183333333333333D-2*t119+0.1792123640376044D-3*t484
     #+0.2633043194706342D-2*t259-0.5376370921128133D-3*t487
     #-0.2688185460564067D-3*t489-0.9374185195813156D-3*t255)*t30
     #+0.3847322101863073D1*t159*t144+0.1923661050931536D1*t42*t478)
      t507 = rho*t506
      t508 = 2.D0*t98+t358+t364-0.7937005259840997D0*t377
     #-0.7937005259840997D0*t379-0.7937005259840997D0*t383+2.D0*t407
     #+0.119055078897615D1*t411+0.10582673679788D1*t414+t419-t434+t507
      v2rhoa2(i) = t353+t508
      t510 = t224**2
      t516 = -t397
      t525 = piecewise(t7,0.1923661050931536D1*t135*t217
     #+0.1923661050931536D1*t19*t516,0.1923661050931536D1*t159*t217
     #+0.1923661050931536D1*t42*t516)
      t526 = rho*t525
      t530 = -t100*t103*t375
      t532 = t315*t225
      t534 = t240+t297+2.D0*t222+0.5952753944880748D0*t100*t338*t510
     #+t302-t306-t308+t311+t314+2.D0*t526-0.7937005259840997D0*t530
     #-0.7937005259840997D0*t532
      t536 = t100*t355*t224
      t540 = t100*t338*t213*t224
      t544 = t195*t72*t102*t224
      t546 = 0.10582673679788D1*t536+0.119055078897615D1*t540
     #-0.7937005259840997D0*t544-t317-t319+t334-t352+t358+t364+t419
     #-t434+t507
      v2rhob2(i) = t534+t546
      t560 = -t328
      t565 = piecewise(t7,0.1923661050931536D1*t19
     #*t560,0.1923661050931536D1*t42*t560)
      t567 = t526-0.3968502629920499D0*t530-0.3968502629920499D0*t532
     #+0.5291336839893998D0*t536+0.5952753944880748D0*t540
     #-0.3968502629920499D0*t544+0.3968502629920499D0*t100*t103*t349
     #+0.5952753944880748D0*t100*t338*t108*t224+t98+rho*t565+t240+t222
     #+t297+t302-t306
      t573 = -t308+t311+t314-t319-t317+t358+t364-0.3968502629920499D0
     #*t377-0.3968502629920499D0*t379-0.3968502629920499D0*t383+t407
     #+0.5952753944880748D0*t411+t507+0.5291336839893998D0*t414-t434
     #+t419
      v2rhoab(i) = t567+t573
      t574 = t67*t102
      t576 = t231*t574*t108
      t578 = t68*t109
      t580 = 1/t48
      t590 = (0.406454125D-3*t580*t168*t186+0.4741964791666667D-3*t580
     #*t60*t190)*t67*t59*t86
      t591 = 0.7937005259840997D0*t590
      t595 = t193*t48*t230*t67*t85
      t596 = 0.322602852800907D-3*t595
      t599 = t194*t59*t71*t85
      t600 = 0.7937005259840997D0*t599
      t603 = t61*t230*t198*t85
      t604 = 0.322602852800907D-3*t603
      t605 = t198*t235
      t606 = 0.7937005259840997D0*t605
      t610 = t48/t228/t257*t232
      t611 = 0.430137137067876D-3*t610
      t613 = t68*t202*t85
      t614 = 0.10582673679788D1*t613
      t616 = t231*t574*t213
      t617 = 0.1613014264004535D-3*t616
      t618 = t68*t214
      t619 = 0.3968502629920499D0*t618
      v2rhoasigmaaa(i) = 0.1613014264004535D-3*t576
     #-0.3968502629920499D0*t578+t591-t596+t600-t604+t606+t611-t614
     #+t617-t619
      t622 = 0.1587401051968199D1*t590
      t623 = 0.645205705601814D-3*t595
      t624 = 0.1587401051968199D1*t599
      t625 = 0.645205705601814D-3*t603
      t626 = 0.1587401051968199D1*t605
      t627 = 0.8602742741357521D-3*t610
      t628 = 0.2116534735957599D1*t613
      t629 = 0.322602852800907D-3*t616
      t630 = 0.7937005259840997D0*t618
      v2rhoasigmaab(i) = 0.322602852800907D-3*t576
     #-0.7937005259840997D0*t578+t622-t623+t624-t625+t626+t627-t628
     #+t629-t630
      v2rhoasigmabb(i) = v2rhoasigmaaa(i)
      t632 = t231*t574*t224
      t634 = t68*t225
      v2rhobsigmaaa(i) = 0.1613014264004535D-3*t632
     #-0.3968502629920499D0*t634+t591-t596+t600-t604+t606+t611-t614
     #+t617-t619
      v2rhobsigmaab(i) = 0.322602852800907D-3*t632
     #-0.7937005259840997D0*t634+t622-t623+t624-t625+t626+t627-t628
     #+t629-t630
      v2rhobsigmabb(i) = v2rhobsigmaaa(i)
      t639 = t580*t230*t232
      t641 = t69**2
      t645 = 1/t641/t257*t60*t232
      v2sigmaaa2(i) = -0.4839042792013605D-3*t639
     #+0.1311232602576965D-6*t645
      v2sigmaaaab(i) = -0.9678085584027211D-3*t639
     #+0.2622465205153929D-6*t645
      v2sigmaaabb(i) = v2sigmaaa2(i)
      v2sigmaab2(i) = -0.1935617116805442D-2*t639
     #+0.5244930410307859D-6*t645
      v2sigmaabbb(i) = v2sigmaaaab(i)
      v2sigmabb2(i) = v2sigmaaabb(i)
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      v2rhob2(i) = 0.0d0
      v2rhoab(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2rhoasigmaab(i) = 0.0d0
      v2rhoasigmabb(i) = 0.0d0
      v2rhobsigmaaa(i) = 0.0d0
      v2rhobsigmaab(i) = 0.0d0
      v2rhobsigmabb(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      v2sigmaab2(i) = 0.0d0
      v2sigmabb2(i) = 0.0d0
      v2sigmaaaab(i) = 0.0d0
      v2sigmaaabb(i) = 0.0d0
      v2sigmaabbb(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end
      
      
      subroutine rks_c_p86
     & (ideriv,npt,rhoa1,sigmaaa1,
     &  zk,vrhoa,vsigmaaa,
     &  v2rhoa2,v2rhoasigmaaa,v2sigmaaa2)
c
c     J.P. Perdew
c     Density-functional approximation for the correlation energy of
c     the inhomogeneous electron gas
c     Phys. Rev. B33 (1986) 8822-8824
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt)
      REAL sigmaaa1(npt)
      REAL zk(npt),vrhoa(npt),vsigmaaa(npt)
      REAL v2rhoa2(npt),v2rhoasigmaaa(npt),v2sigmaaa2(npt)
      parameter(tol=1.0d-20)
      logical t5
      
      if(ideriv.eq.0) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = 1/rho
      t3 = t2**(1.D0/3.D0)
      t4 = 0.6203504908994D0*t3
      t6 = t2**(1.D0/6.D0)
      t12 = dlog(t4)
      t18 = piecewise(1.D0 .le. t4,-0.1423D0/(1.D0
     #+0.8292885914166397D0*t6+0.20682485366586D0*t3),0.311D-1*t12
     #-0.48D-1+0.12407009817988D-2*t3*t12-0.719606569443304D-2*t3)
      t20 = dsqrt(sigma)
      t22 = t3**2
      t31 = 0.1667D-2+(0.2568D-2+0.1443307452126544D-1*t3
     #+0.2843543831490386D-5*t22)/(1.D0+0.5411317332115466D1*t3
     #+0.1816419932959077D0*t22+0.1763993811759022D-1*t2)
      t34 = rho**(1.D0/6.D0)
      t39 = dexp(-0.81290825D-3*t20/t31/t34/rho)
      t41 = rho**(1.D0/3.D0)
      zk(i) = rho*t18+0.1D1*t39*t31*sigma/t41/rho
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = 1/rho
      t3 = t2**(1.D0/3.D0)
      t4 = 0.6203504908994D0*t3
      t5 = 1.D0 .le. t4
      t6 = t2**(1.D0/6.D0)
      t9 = 1.D0+0.8292885914166397D0*t6+0.20682485366586D0*t3
      t12 = dlog(t4)
      t18 = piecewise(t5,-0.1423D0/t9,0.311D-1*t12-0.48D-1
     #+0.12407009817988D-2*t3*t12-0.719606569443304D-2*t3)
      t20 = dsqrt(sigma)
      t22 = t3**2
      t24 = 0.2568D-2+0.1443307452126544D-1*t3+0.2843543831490386D-5*t22
      t28 = 1.D0+0.5411317332115466D1*t3+0.1816419932959077D0*t22
     #+0.1763993811759022D-1*t2
      t29 = 1/t28
      t31 = 0.1667D-2+t24*t29
      t33 = t20/t31
      t34 = rho**(1.D0/6.D0)
      t36 = 1/t34/rho
      t39 = dexp(-0.81290825D-3*t33*t36)
      t40 = t39*t31
      t41 = rho**(1.D0/3.D0)
      t43 = 1/t41/rho
      t44 = sigma*t43
      zk(i) = rho*t18+0.1D1*t40*t44
      t47 = piecewise(t5,0.D0,0.D0)
      t49 = t9**2
      t51 = t6**2
      t52 = t51**2
      t55 = rho**2
      t56 = 1/t55
      t59 = 1/t22
      t60 = t59*t56
      t73 = piecewise(t5,0.1423D0/t49*(-0.1382147652361066D0/t52/t6
     #*t56-0.6894161788861999D-1*t60),-0.1036666666666667D-1*t2
     #-0.4135669939329333D-3*t59*t12*t56-0.4135669939329333D-3*t3*t2
     #+0.2398688564811013D-2*t60)
      t75 = t31**2
      t80 = 1/t3*t56
      t84 = t28**2
      t93 = (-0.4811024840421814D-2*t60-0.1895695887660258D-5*t80)*t29
     #-1.D0*t24/t84*(-0.1803772444038489D1*t60-0.1210946621972718D0
     #*t80-0.1763993811759022D-1*t56)
      vrhoa(i) = rho*t47+t18+rho*t73+0.1D1*(0.81290825D-3*t20/t75*t36
     #*t93+0.9483929583333333D-3*t33/t34/t55)*t39*t31*sigma*t43+0.1D1
     #*t39*t93*t44-0.1333333333333333D1*t40*sigma/t41/t55
      t115 = dsqrt(rho)
      vsigmaaa(i) = -0.16258165D-2*t20/t115/t55*t39+0.4D1*t40*t43
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = 1/rho
      t3 = t2**(1.D0/3.D0)
      t4 = 0.6203504908994D0*t3
      t5 = 1.D0 .le. t4
      t6 = t2**(1.D0/6.D0)
      t9 = 1.D0+0.8292885914166397D0*t6+0.20682485366586D0*t3
      t11 = 0.1423D0/t9
      t12 = dlog(t4)
      t14 = t3*t12
      t18 = piecewise(t5,-t11,0.311D-1*t12-0.48D-1+0.12407009817988D-2
     #*t14-0.719606569443304D-2*t3)
      t20 = dsqrt(sigma)
      t22 = t3**2
      t24 = 0.2568D-2+0.1443307452126544D-1*t3+0.2843543831490386D-5*t22
      t28 = 1.D0+0.5411317332115466D1*t3+0.1816419932959077D0*t22
     #+0.1763993811759022D-1*t2
      t29 = 1/t28
      t31 = 0.1667D-2+t24*t29
      t32 = 1/t31
      t33 = t20*t32
      t34 = rho**(1.D0/6.D0)
      t36 = 1/t34/rho
      t39 = dexp(-0.81290825D-3*t33*t36)
      t40 = t39*t31
      t41 = rho**(1.D0/3.D0)
      t43 = 1/t41/rho
      t44 = sigma*t43
      zk(i) = rho*t18+0.1D1*t40*t44
      t47 = piecewise(t5,0.D0,0.D0)
      t48 = rho*t47
      t49 = t9**2
      t50 = 1/t49
      t51 = t6**2
      t52 = t51**2
      t53 = t52*t6
      t54 = 1/t53
      t55 = rho**2
      t56 = 1/t55
      t59 = 1/t22
      t60 = t59*t56
      t62 = -0.1382147652361066D0*t54*t56-0.6894161788861999D-1*t60
      t66 = t59*t12
      t69 = t3*t2
      t73 = piecewise(t5,0.1423D0*t50*t62,-0.1036666666666667D-1*t2
     #-0.4135669939329333D-3*t66*t56-0.4135669939329333D-3*t69
     #+0.2398688564811013D-2*t60)
      t75 = t31**2
      t76 = 1/t75
      t77 = t20*t76
      t79 = 1/t3
      t80 = t79*t56
      t82 = -0.4811024840421814D-2*t60-0.1895695887660258D-5*t80
      t84 = t28**2
      t85 = 1/t84
      t86 = t24*t85
      t90 = -0.1803772444038489D1*t60-0.1210946621972718D0*t80
     #-0.1763993811759022D-1*t56
      t93 = t82*t29-1.D0*t86*t90
      t94 = t36*t93
      t98 = 1/t34/t55
      t101 = 0.81290825D-3*t77*t94+0.9483929583333333D-3*t33*t98
      t102 = t101*t39
      t103 = t31*sigma
      t104 = t103*t43
      t107 = t39*t93
      t111 = 1/t41/t55
      t112 = sigma*t111
      vrhoa(i) = t48+t18+rho*t73+0.1D1*t102*t104+0.1D1*t107*t44
     #-0.1333333333333333D1*t40*t112
      t115 = dsqrt(rho)
      t117 = 1/t115/t55
      vsigmaaa(i) = -0.16258165D-2*t20*t117*t39+0.4D1*t40*t43
      t129 = (-0.843D-1/(1.D0+0.1101176160755631D1*t6
     #+0.1619735131738333D0*t3)+t11)*t56
      t135 = (-0.1555D-1*t12+0.211D-1-0.80645563816922D-3*t14
     #+0.421838333811592D-2*t3)*t56
      t137 = piecewise(t5,0.1709920934161366D1
     #*t129,0.1709920934161366D1*t135)
      t139 = t55*rho
      t147 = t62**2
      t152 = t55**2
      t153 = 1/t152
      t156 = 1/t139
      t160 = 1/t22/t2
      t161 = t160*t153
      t163 = t59*t156
      t180 = piecewise(t5,-0.2846D0/t49/t9*t147+0.1423D0*t50*(
     #-0.1151789710300888D0/t53/t2*t153+0.2764295304722132D0*t54*t156
     #-0.4596107859241333D-1*t161+0.13788323577724D0*t163
     #),0.1036666666666667D-1*t56-0.2757113292886222D-3*t160*t12*t153
     #-0.4521665800333405D-2*t163+0.8271339878658667D-3*t66*t156
     #+0.4135669939329333D-3*t3*t56+0.1599125709874009D-2*t161)
      t185 = piecewise(t5,-0.1709920934161366D1*t129,
     #-0.1709920934161366D1*t135)
      t193 = t93**2
      t203 = 1/t69*t153
      t205 = t79*t156
      t215 = t90**2
      t226 = (-0.3207349893614542D-2*t161+0.9622049680843627D-2*t163
     #-0.6318986292200858D-6*t203+0.3791391775320515D-5*t205)*t29-2.D0
     #*t82*t85*t90+2.D0*t24/t84/t28*t215-1.D0*t86*(
     #-0.1202514962692326D1*t161+0.3607544888076978D1*t163
     #-0.4036488739909061D-1*t203+0.2421893243945437D0*t205
     #+0.3527987623518044D-1*t156)
      t247 = t101**2
      v2rhoa2(i) = rho*t137+0.6222222222222222D1*t40*sigma/t41/t139
     #+2.D0*rho*t180+rho*t185-0.5333333333333333D1*t102*t103*t111
     #+0.2D1*(-0.16258165D-2*t20/t75/t31*t36*t193
     #-0.1896785916666667D-2*t77*t98*t93+0.81290825D-3*t77*t36*t226
     #-0.2054851409722222D-2*t33/t34/t139)*t39*t104+0.4D1*t102*t93
     #*sigma*t43+0.2D1*t39*t226*t44-0.5333333333333333D1*t107*t112
     #+0.2D1*t247*t39*t104+4.D0*t48+4.D0*t47+4.D0*t73
      t254 = 1/t20
      t266 = t117*t39
      v2rhoasigmaaa(i) = 0.4D1*(0.406454125D-3*t254*t76*t94
     #+0.4741964791666667D-3*t254*t32*t98)*t39*t104-0.16258165D-2*t101
     #*t20*t266+0.4D1*t102*t31*t43-0.16258165D-2*t33*t266*t93+0.4D1
     #*t107*t43+0.2167755333333333D-2*t20/t115/t139*t39
     #-0.5333333333333333D1*t40*t111
      t287 = t41**2
      v2sigmaaa2(i) = -0.9754899D-2*t254*t117*t39+0.264327929167225D-5
     #/t287/t139*t32*t39
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end

c:C_P86subrend
_ENDIF
_IF(ccpdft,all,c_pw91)
c:C_PW91subrstart

c    Generated: Mon Nov 19 16:05:15 GMT 2007

      subroutine uks_c_pw91
     & (ideriv,npt,rhoa1,rhob1,sigmaaa1,sigmabb1,sigmaab1,
     &  zk,vrhoa,vrhob,vsigmaaa,vsigmabb,vsigmaab,
     &  v2rhoa2,v2rhob2,v2rhoab,
     &  v2rhoasigmaaa,v2rhoasigmaab,v2rhoasigmabb,
     &  v2rhobsigmabb,v2rhobsigmaab,v2rhobsigmaaa,
     &  v2sigmaaa2,v2sigmaaaab,v2sigmaaabb,
     &  v2sigmaab2,v2sigmaabbb,v2sigmabb2)
c
c     J.P. Perdew, J.A. Chevary, S.H. Vosko, K.A. Jackson, 
c     M.R. Pederson, D.J. Singh, C. Fiolhais
c     Atoms, molecules, solids and surfaces: 
c     Applications of the generalized gradient approximation 
c     for exchange and correlation
c     Phys. Rev. B 46 (1992) 6671--6687
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt),rhob1(npt)
      REAL sigmaaa1(npt),sigmabb1(npt),sigmaab1(npt)
      REAL zk(npt),vrhoa(npt),vrhob(npt)
      REAL vsigmaaa(npt),vsigmabb(npt),vsigmaab(npt)
      REAL v2rhoa2(npt),v2rhob2(npt),v2rhoab(npt)
      REAL v2rhoasigmaaa(npt),v2rhoasigmaab(npt)
      REAL v2rhoasigmabb(npt),v2rhobsigmabb(npt)
      REAL v2rhobsigmaab(npt),v2rhobsigmaaa(npt)
      REAL v2sigmaaa2(npt),v2sigmaaaab(npt),v2sigmaaabb(npt)
      REAL v2sigmaab2(npt),v2sigmaabbb(npt),v2sigmabb2(npt)
      parameter(tol=1.0d-20)
      
      if (ideriv.eq.0) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = 1/rhob
      t3 = t2**(1.D0/3.D0)
      t6 = t2**(1.D0/6.D0)
      t9 = dsqrt(t2)
      t11 = t3**2
      t17 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t6
     #+0.3844746237447211D1*t3+0.1644733775567609D1*t9
     #+0.2405871291288192D0*t11))
      t18 = (1.D0+0.1274696188700087D0*t3)*t17
      t20 = rhob**2
      t21 = rhob**(1.D0/3.D0)
      t23 = 1/t21/t20
      t27 = dexp(0.2513789108010112D1*t18)
      t28 = t27-1.D0
      t29 = 1/t28
      t30 = sigmabb**2
      t32 = t20**2
      t33 = t21**2
      t35 = 1/t33/t32
      t42 = t28**2
      t52 = dlog(1.D0+0.2697586091519874D1*(0.1007494971260294D0
     #*sigmabb*t23+0.2738174287780083D-1*t29*t30*t35)/(1.D0
     #+0.2717804421747983D0*t29*sigmabb*t23+0.7386460874872889D-1/t42
     #*t30*t35))
      t70 = dexp(-0.1645530784602056D1/t33/t20*sigmabb)
      zk(i) = rhob*(-0.3109D-1*t18+0.1236778371778789D-1*t52
     #+0.7937005259840997D0*(0.1D-2*(0.2568D1+0.1443307452126544D2*t3
     #+0.2843543831490386D-2*t11)/(1.D0+0.5411317332115466D1*t3
     #+0.1816419932959077D0*t11+0.1763993811759022D-1*t2)
     #-0.1853571428571429D-2)*sigmabb*t23*t70)
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = 1/rhoa
      t3 = t2**(1.D0/3.D0)
      t6 = t2**(1.D0/6.D0)
      t9 = dsqrt(t2)
      t11 = t3**2
      t17 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t6
     #+0.3844746237447211D1*t3+0.1644733775567609D1*t9
     #+0.2405871291288192D0*t11))
      t18 = (1.D0+0.1274696188700087D0*t3)*t17
      t20 = rhoa**2
      t21 = rhoa**(1.D0/3.D0)
      t23 = 1/t21/t20
      t27 = dexp(0.2513789108010112D1*t18)
      t28 = t27-1.D0
      t29 = 1/t28
      t30 = sigmaaa**2
      t32 = t20**2
      t33 = t21**2
      t35 = 1/t33/t32
      t42 = t28**2
      t52 = dlog(1.D0+0.2697586091519874D1*(0.1007494971260294D0
     #*sigmaaa*t23+0.2738174287780083D-1*t29*t30*t35)/(1.D0
     #+0.2717804421747983D0*t29*sigmaaa*t23+0.7386460874872889D-1/t42
     #*t30*t35))
      t70 = dexp(-0.1645530784602056D1/t33/t20*sigmaaa)
      zk(i) = rhoa*(-0.3109D-1*t18+0.1236778371778789D-1*t52
     #+0.7937005259840997D0*(0.1D-2*(0.2568D1+0.1443307452126544D2*t3
     #+0.2843543831490386D-2*t11)/(1.D0+0.5411317332115466D1*t3
     #+0.1816419932959077D0*t11+0.1763993811759022D-1*t2)
     #-0.1853571428571429D-2)*sigmaaa*t23*t70)
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = 1/rho
      t5 = t4**(1.D0/3.D0)
      t8 = t4**(1.D0/6.D0)
      t11 = dsqrt(t4)
      t13 = t5**2
      t19 = dlog(1.D0+0.160818243221511D2/(0.598255043577108D1*t8
     #+0.2225569421150687D1*t5+0.8004286349993634D0*t11
     #+0.1897004325747559D0*t13))
      t21 = 0.62182D-1*(1.D0+0.1325688999052018D0*t5)*t19
      t32 = dlog(1.D0+0.2960857464321668D2/(0.8157414703487641D1*t8
     #+0.2247591863577616D1*t5+0.4300972471276643D0*t11
     #+0.1911512595127338D0*t13))
      t35 = rhoa-1.D0*rhob
      t36 = t35*t4
      t37 = 1.D0+t36
      t38 = t37**(1.D0/3.D0)
      t41 = 1.D0-1.D0*t36
      t42 = t41**(1.D0/3.D0)
      t44 = t38*t37+t42*t41-2.D0
      t45 = t35**2
      t46 = t45**2
      t47 = rho**2
      t48 = t47**2
      t50 = t46/t48
      t55 = 0.3799574853701528D-1*(1.D0+0.6901399211255825D-1*t5)*t32
     #*t44*(1.D0-1.D0*t50)
      t66 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t8
     #+0.3844746237447211D1*t5+0.1644733775567609D1*t11
     #+0.2405871291288192D0*t13))
      t72 = 0.1923661050931536D1*(-0.3109D-1*(1.D0
     #+0.1274696188700087D0*t5)*t66+t21)*t44*t50
      t73 = t38**2
      t75 = t42**2
      t77 = 0.5D0*t73+0.5D0*t75
      t78 = t77**2
      t79 = t78*t77
      t80 = 1/t78
      t82 = rho**(1.D0/3.D0)
      t84 = 1/t82/t47
      t91 = dexp(-0.4042761511756372D2*(-t21+t55+t72)/t79)
      t92 = t91-1.D0
      t93 = 1/t92
      t94 = sigma**2
      t96 = t78**2
      t98 = t82**2
      t101 = 1/t96/t98/t48
      t109 = t92**2
      t119 = dlog(1.D0+0.2697586091519874D1*(0.634682060977037D-1
     #*sigma*t80*t84+0.1086645186223595D-1*t93*t94*t101)/(1.D0
     #+0.1712109500228824D0*t93*sigma*t80*t84+0.2931318940773793D-1
     #/t109*t94*t101))
      t140 = dexp(-0.261211729852336D1*t78/t98/t47*sigma)
      zk(i) = rho*(-t21+t55+t72+0.2473556743557577D-1*t79*t119+0.1D1*
     #(0.1D-2*(0.2568D1+0.1443307452126544D2*t5+0.2843543831490386D-2
     #*t13)/(1.D0+0.5411317332115466D1*t5+0.1816419932959077D0*t13
     #+0.1763993811759022D-1*t4)-0.1853571428571429D-2)*t77*sigma*t84
     #*t140)
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = 1/rhob
      t3 = t2**(1.D0/3.D0)
      t5 = 1.D0+0.1274696188700087D0*t3
      t6 = t2**(1.D0/6.D0)
      t9 = dsqrt(t2)
      t11 = t3**2
      t13 = 0.1112037486309468D2*t6+0.3844746237447211D1*t3
     #+0.1644733775567609D1*t9+0.2405871291288192D0*t11
      t16 = 1.D0+0.321646831778707D2/t13
      t17 = dlog(t16)
      t18 = t5*t17
      t19 = 0.3109D-1*t18
      t20 = rhob**2
      t21 = rhob**(1.D0/3.D0)
      t23 = 1/t21/t20
      t27 = dexp(0.2513789108010112D1*t18)
      t28 = t27-1.D0
      t29 = 1/t28
      t30 = sigmabb**2
      t31 = t29*t30
      t32 = t20**2
      t33 = t21**2
      t35 = 1/t33/t32
      t38 = 0.1007494971260294D0*sigmabb*t23+0.2738174287780083D-1*t31
     #*t35
      t39 = t29*sigmabb
      t42 = t28**2
      t43 = 1/t42
      t44 = t43*t30
      t47 = 1.D0+0.2717804421747983D0*t39*t23+0.7386460874872889D-1
     #*t44*t35
      t48 = 1/t47
      t51 = 1.D0+0.2697586091519874D1*t38*t48
      t52 = dlog(t51)
      t53 = 0.1236778371778789D-1*t52
      t56 = 0.2568D1+0.1443307452126544D2*t3+0.2843543831490386D-2*t11
      t60 = 1.D0+0.5411317332115466D1*t3+0.1816419932959077D0*t11
     #+0.1763993811759022D-1*t2
      t61 = 1/t60
      t64 = 0.1D-2*t56*t61-0.1853571428571429D-2
      t65 = t64*sigmabb
      t70 = dexp(-0.1645530784602056D1/t33/t20*sigmabb)
      t71 = t23*t70
      t73 = 0.7937005259840997D0*t65*t71
      zk(i) = rhob*(-t19+t53+t73)
      vrhoa(i) = 0.D0
      t76 = 1/t20
      t77 = 1/t11*t76
      t79 = 0.1321010150222857D-2*t77*t17
      t80 = t13**2
      t83 = t6**2
      t84 = t83**2
      t94 = 1/t3*t76
      t100 = 0.1D1*t5/t80*(-0.1853395810515781D1/t84/t6*t76
     #-0.128158207914907D1*t77-0.8223668877838045D0/t9*t76
     #-0.1603914194192128D0*t94)/t16
      t103 = 1/t21/t20/rhob
      t106 = t79+t100
      t108 = t35*t106*t27
      t111 = t32*rhob
      t113 = 1/t33/t111
      t119 = t47**2
      t121 = t38/t119
      t122 = t43*sigmabb
      t140 = 1/t51
      t148 = t60**2
      vrhob(i) = -t19+t53+t73+rhob*(t79+t100+0.1236778371778789D-1*
     #(0.2697586091519874D1*(-0.2350821599607352D0*sigmabb*t103
     #+0.2213957124623647D1*t44*t108-0.1277814667630705D0*t31*t113)
     #*t48-0.2697586091519874D1*t121*(0.2197487022544806D2*t122*t23
     #*t106*t27-0.6341543650745294D0*t39*t103+0.1194467989321217D2/t42
     #/t28*t30*t108-0.3447015074940681D0*t44*t113))*t140
     #+0.7937005259840997D0*(0.1D-2*(-0.4811024840421814D1*t77
     #-0.1895695887660258D-2*t94)*t61-0.1D-2*t56/t148*(
     #-0.1803772444038489D1*t77-0.1210946621972718D0*t94
     #-0.1763993811759022D-1*t76))*sigmabb*t71-0.1851967893962899D1
     #*t65*t103*t70+0.3482823064697813D1*t64*t30/t32/t20*t70)
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      vsigmabb(i) = rhob*(0.1236778371778789D-1*(0.2697586091519874D1*
     #(0.1007494971260294D0*t23+0.5476348575560166D-1*t39*t35)*t48
     #-0.2697586091519874D1*t121*(0.2717804421747983D0*t29*t23
     #+0.1477292174974578D0*t122*t35))*t140+0.7937005259840997D0*t64
     #*t23*t70-0.130605864926168D1*t65/t111*t70)
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = 1/rhoa
      t3 = t2**(1.D0/3.D0)
      t5 = 1.D0+0.1274696188700087D0*t3
      t6 = t2**(1.D0/6.D0)
      t9 = dsqrt(t2)
      t11 = t3**2
      t13 = 0.1112037486309468D2*t6+0.3844746237447211D1*t3
     #+0.1644733775567609D1*t9+0.2405871291288192D0*t11
      t16 = 1.D0+0.321646831778707D2/t13
      t17 = dlog(t16)
      t18 = t5*t17
      t19 = 0.3109D-1*t18
      t20 = rhoa**2
      t21 = rhoa**(1.D0/3.D0)
      t23 = 1/t21/t20
      t27 = dexp(0.2513789108010112D1*t18)
      t28 = t27-1.D0
      t29 = 1/t28
      t30 = sigmaaa**2
      t31 = t29*t30
      t32 = t20**2
      t33 = t21**2
      t35 = 1/t33/t32
      t38 = 0.1007494971260294D0*sigmaaa*t23+0.2738174287780083D-1*t31
     #*t35
      t39 = t29*sigmaaa
      t42 = t28**2
      t43 = 1/t42
      t44 = t43*t30
      t47 = 1.D0+0.2717804421747983D0*t39*t23+0.7386460874872889D-1
     #*t44*t35
      t48 = 1/t47
      t51 = 1.D0+0.2697586091519874D1*t38*t48
      t52 = dlog(t51)
      t53 = 0.1236778371778789D-1*t52
      t56 = 0.2568D1+0.1443307452126544D2*t3+0.2843543831490386D-2*t11
      t60 = 1.D0+0.5411317332115466D1*t3+0.1816419932959077D0*t11
     #+0.1763993811759022D-1*t2
      t61 = 1/t60
      t64 = 0.1D-2*t56*t61-0.1853571428571429D-2
      t65 = t64*sigmaaa
      t70 = dexp(-0.1645530784602056D1/t33/t20*sigmaaa)
      t71 = t23*t70
      t73 = 0.7937005259840997D0*t65*t71
      zk(i) = rhoa*(-t19+t53+t73)
      t76 = 1/t20
      t77 = 1/t11*t76
      t79 = 0.1321010150222857D-2*t77*t17
      t80 = t13**2
      t83 = t6**2
      t84 = t83**2
      t94 = 1/t3*t76
      t100 = 0.1D1*t5/t80*(-0.1853395810515781D1/t84/t6*t76
     #-0.128158207914907D1*t77-0.8223668877838045D0/t9*t76
     #-0.1603914194192128D0*t94)/t16
      t103 = 1/t21/t20/rhoa
      t106 = t79+t100
      t108 = t35*t106*t27
      t111 = t32*rhoa
      t113 = 1/t33/t111
      t119 = t47**2
      t121 = t38/t119
      t122 = t43*sigmaaa
      t140 = 1/t51
      t148 = t60**2
      vrhoa(i) = -t19+t53+t73+rhoa*(t79+t100+0.1236778371778789D-1*
     #(0.2697586091519874D1*(-0.2350821599607352D0*sigmaaa*t103
     #+0.2213957124623647D1*t44*t108-0.1277814667630705D0*t31*t113)
     #*t48-0.2697586091519874D1*t121*(0.2197487022544806D2*t122*t23
     #*t106*t27-0.6341543650745294D0*t39*t103+0.1194467989321217D2/t42
     #/t28*t30*t108-0.3447015074940681D0*t44*t113))*t140
     #+0.7937005259840997D0*(0.1D-2*(-0.4811024840421814D1*t77
     #-0.1895695887660258D-2*t94)*t61-0.1D-2*t56/t148*(
     #-0.1803772444038489D1*t77-0.1210946621972718D0*t94
     #-0.1763993811759022D-1*t76))*sigmaaa*t71-0.1851967893962899D1
     #*t65*t103*t70+0.3482823064697813D1*t64*t30/t32/t20*t70)
      vrhob(i) = 0.D0
      vsigmaaa(i) = rhoa*(0.1236778371778789D-1*(0.2697586091519874D1*
     #(0.1007494971260294D0*t23+0.5476348575560166D-1*t39*t35)*t48
     #-0.2697586091519874D1*t121*(0.2717804421747983D0*t29*t23
     #+0.1477292174974578D0*t122*t35))*t140+0.7937005259840997D0*t64
     #*t23*t70-0.130605864926168D1*t65/t111*t70)
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = 1/rho
      t5 = t4**(1.D0/3.D0)
      t7 = 1.D0+0.1325688999052018D0*t5
      t8 = t4**(1.D0/6.D0)
      t11 = dsqrt(t4)
      t13 = t5**2
      t15 = 0.598255043577108D1*t8+0.2225569421150687D1*t5
     #+0.8004286349993634D0*t11+0.1897004325747559D0*t13
      t18 = 1.D0+0.160818243221511D2/t15
      t19 = dlog(t18)
      t21 = 0.62182D-1*t7*t19
      t23 = 1.D0+0.6901399211255825D-1*t5
      t28 = 0.8157414703487641D1*t8+0.2247591863577616D1*t5
     #+0.4300972471276643D0*t11+0.1911512595127338D0*t13
      t31 = 1.D0+0.2960857464321668D2/t28
      t32 = dlog(t31)
      t33 = t23*t32
      t35 = rhoa-1.D0*rhob
      t36 = t35*t4
      t37 = 1.D0+t36
      t38 = t37**(1.D0/3.D0)
      t41 = 1.D0-1.D0*t36
      t42 = t41**(1.D0/3.D0)
      t44 = t38*t37+t42*t41-2.D0
      t45 = t35**2
      t46 = t45**2
      t47 = rho**2
      t48 = t47**2
      t49 = 1/t48
      t50 = t46*t49
      t52 = 1.D0-1.D0*t50
      t55 = 0.3799574853701528D-1*t33*t44*t52
      t57 = 1.D0+0.1274696188700087D0*t5
      t62 = 0.1112037486309468D2*t8+0.3844746237447211D1*t5
     #+0.1644733775567609D1*t11+0.2405871291288192D0*t13
      t65 = 1.D0+0.321646831778707D2/t62
      t66 = dlog(t65)
      t69 = -0.3109D-1*t57*t66+t21
      t70 = t69*t44
      t72 = 0.1923661050931536D1*t70*t50
      t73 = t38**2
      t75 = t42**2
      t77 = 0.5D0*t73+0.5D0*t75
      t78 = t77**2
      t79 = t78*t77
      t80 = 1/t78
      t81 = sigma*t80
      t82 = rho**(1.D0/3.D0)
      t84 = 1/t82/t47
      t87 = -t21+t55+t72
      t88 = 1/t79
      t91 = dexp(-0.4042761511756372D2*t87*t88)
      t92 = t91-1.D0
      t93 = 1/t92
      t94 = sigma**2
      t95 = t93*t94
      t96 = t78**2
      t97 = 1/t96
      t98 = t82**2
      t100 = 1/t98/t48
      t101 = t97*t100
      t104 = 0.634682060977037D-1*t81*t84+0.1086645186223595D-1*t95*t101
      t105 = t93*sigma
      t106 = t80*t84
      t109 = t92**2
      t110 = 1/t109
      t111 = t110*t94
      t114 = 1.D0+0.1712109500228824D0*t105*t106+0.2931318940773793D-1
     #*t111*t101
      t115 = 1/t114
      t118 = 1.D0+0.2697586091519874D1*t104*t115
      t119 = dlog(t118)
      t121 = 0.2473556743557577D-1*t79*t119
      t124 = 0.2568D1+0.1443307452126544D2*t5+0.2843543831490386D-2*t13
      t128 = 1.D0+0.5411317332115466D1*t5+0.1816419932959077D0*t13
     #+0.1763993811759022D-1*t4
      t129 = 1/t128
      t132 = 0.1D-2*t124*t129-0.1853571428571429D-2
      t133 = t132*t77
      t136 = 1/t98/t47
      t140 = dexp(-0.261211729852336D1*t78*t136*sigma)
      t141 = sigma*t84*t140
      t143 = 0.1D1*t133*t141
      zk(i) = rho*(-t21+t55+t72+t121+t143)
      t149 = 0.1333333333333333D1*t38*t4-0.1333333333333333D1*t42*t4
      t152 = 0.3799574853701528D-1*t33*t149*t52
      t153 = t45*t35
      t156 = t33*t44*t153*t49
      t157 = 0.1519829941480611D0*t156
      t160 = 0.1923661050931536D1*t69*t149*t50
      t162 = t70*t153*t49
      t163 = 0.7694644203726145D1*t162
      t164 = t78*t119
      t165 = 1/t38
      t168 = 1/t42
      t171 = 0.3333333333333333D0*t165*t4-0.3333333333333333D0*t168*t4
      t174 = sigma*t88
      t178 = t111*t97
      t182 = t87*t97
      t185 = -0.4042761511756372D2*(t152-t157+t160+t163)*t88
     #+0.1212828453526912D3*t182*t171
      t187 = t100*t185*t91
      t192 = 1/t96/t77*t100
      t193 = t192*t171
      t199 = t114**2
      t201 = t104/t199
      t202 = t110*sigma
      t203 = t202*t80
      t208 = t88*t84
      t215 = 1/t109/t92*t94*t97
      t225 = 1/t118
      t232 = t132*t78*t94
      t233 = t48*rho
      t234 = 1/t233
      t242 = 1/t47
      t243 = 1/t13*t242
      t244 = t243*t19
      t245 = 0.2747799777968419D-2*t244
      t246 = t15**2
      t249 = t8**2
      t250 = t249**2
      t253 = 1/t250/t8*t242
      t257 = 1/t11*t242
      t260 = 1/t5*t242
      t265 = t7/t246*(-0.99709173929518D0*t253-0.7418564737168958D0
     #*t243-0.4002143174996817D0*t257-0.1264669550498372D0*t260)/t18
      t266 = 0.1D1*t265
      t270 = 0.8740794299481065D-3*t243*t32*t44*t52
      t271 = t28**2
      t284 = 0.1124999956683108D1*t23/t271*(-0.135956911724794D1*t253
     #-0.7491972878592054D0*t243-0.2150486235638321D0*t257
     #-0.1274341730084892D0*t260)/t31*t44*t52
      t291 = -0.1333333333333333D1*t38*t35*t242+0.1333333333333333D1
     #*t42*t35*t242
      t294 = 0.3799574853701528D-1*t33*t291*t52
      t298 = 0.1519829941480611D0*t33*t44*t46*t234
      t301 = t62**2
      t318 = 0.1923661050931536D1*(0.1321010150222857D-2*t243*t66
     #+0.1D1*t57/t301*(-0.1853395810515781D1*t253-0.128158207914907D1
     #*t243-0.8223668877838045D0*t257-0.1603914194192128D0*t260)/t65
     #-0.2747799777968419D-2*t244-0.1D1*t265)*t44*t50
      t321 = 0.1923661050931536D1*t69*t291*t50
      t324 = 0.7694644203726145D1*t70*t46*t234
      t331 = -0.3333333333333333D0*t165*t35*t242+0.3333333333333333D0
     #*t168*t35*t242
      t337 = t47*rho
      t339 = 1/t82/t337
      t347 = -0.4042761511756372D2*(t245+t266-t270-t284+t294+t298+t318
     #+t321-t324)*t88+0.1212828453526912D3*t182*t331
      t349 = t100*t347*t91
      t352 = t192*t331
      t357 = t97/t98/t233
      t391 = t128**2
      s1 = t245+t266-t270-t284+t294+t298+t318
      s2 = s1+t321-t324+0.7420670230672731D-1*t164*t331
      s3 = s2+0.2473556743557577D-1*t79*(0.2697586091519874D1*(
     #-0.1269364121954074D0*t174*t84*t331-0.148092480894642D0*t81*t339
     #-0.1086645186223595D-1*t178*t349-0.4346580744894379D-1*t95*t352
     #-0.5071010869043442D-1*t95*t357)*t115-0.2697586091519874D1*t201*
     #(-0.1712109500228824D0*t203*t84*t347*t91-0.3424219000457648D0
     #*t105*t208*t331-0.3994922167200589D0*t105*t80*t339
     #-0.5862637881547585D-1*t215*t349-0.1172527576309517D0*t111*t352
     #-0.136794883902777D0*t111*t357))*t225+0.1D1*(0.1D-2*(
     #-0.4811024840421814D1*t243-0.1895695887660258D-2*t260)*t129
     #-0.1D-2*t124/t391*(-0.1803772444038489D1*t243
     #-0.1210946621972718D0*t260-0.1763993811759022D-1*t242))*t77*t141
      t426 = s3+0.1D1*t132*t331*t141-0.2333333333333333D1*t133*sigma
     #*t339*t140+0.1D1*t133*sigma*t84*(-0.522423459704672D1*t77*t136
     #*sigma*t331+0.6965646129395627D1*t78/t98/t337*sigma)*t140
      t427 = rho*t426
      vrhoa(i) = rho*(t152-t157+t160+t163+0.7420670230672731D-1*t164
     #*t171+0.2473556743557577D-1*t79*(0.2697586091519874D1*(
     #-0.1269364121954074D0*t174*t84*t171-0.1086645186223595D-1*t178
     #*t187-0.4346580744894379D-1*t95*t193)*t115-0.2697586091519874D1
     #*t201*(-0.1712109500228824D0*t203*t84*t185*t91
     #-0.3424219000457648D0*t105*t208*t171-0.5862637881547585D-1*t215
     #*t187-0.1172527576309517D0*t111*t193))*t225+0.1D1*t132*t171*t141
     #-0.522423459704672D1*t232*t234*t171*t140)-t21+t55+t72+t121+t143
     #+t427
      t428 = -t149
      t431 = 0.3799574853701528D-1*t33*t428*t52
      t432 = 0.1519829941480611D0*t156
      t435 = 0.1923661050931536D1*t69*t428*t50
      t436 = 0.7694644203726145D1*t162
      t437 = -t171
      t448 = -0.4042761511756372D2*(t431+t432+t435-t436)*t88
     #+0.1212828453526912D3*t182*t437
      t450 = t100*t448*t91
      t453 = t192*t437
      vrhob(i) = rho*(t431+t432+t435-t436+0.7420670230672731D-1*t164
     #*t437+0.2473556743557577D-1*t79*(0.2697586091519874D1*(
     #-0.1269364121954074D0*t174*t84*t437-0.1086645186223595D-1*t178
     #*t450-0.4346580744894379D-1*t95*t453)*t115-0.2697586091519874D1
     #*t201*(-0.1712109500228824D0*t203*t84*t448*t91
     #-0.3424219000457648D0*t105*t208*t437-0.5862637881547585D-1*t215
     #*t450-0.1172527576309517D0*t111*t453))*t225+0.1D1*t132*t437*t141
     #-0.522423459704672D1*t232*t234*t437*t140)-t21+t55+t72+t121+t143
     #+t427
      vsigmaaa(i) = rho*(0.2473556743557577D-1*t79*
     #(0.2697586091519874D1*(0.634682060977037D-1*t106
     #+0.2173290372447189D-1*t105*t101)*t115-0.2697586091519874D1*t201
     #*(0.1712109500228824D0*t93*t80*t84+0.5862637881547585D-1*t202
     #*t101))*t225+0.1D1*t133*t84*t140-0.261211729852336D1*t132*t79
     #*sigma*t234*t140)
      vsigmaab(i) = 2.D0*vsigmaaa(i)
      vsigmabb(i) = vsigmaaa(i)
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = 1/rhob
      t3 = t2**(1.D0/3.D0)
      t5 = 1.D0+0.1274696188700087D0*t3
      t6 = t2**(1.D0/6.D0)
      t9 = dsqrt(t2)
      t11 = t3**2
      t13 = 0.1112037486309468D2*t6+0.3844746237447211D1*t3
     #+0.1644733775567609D1*t9+0.2405871291288192D0*t11
      t16 = 1.D0+0.321646831778707D2/t13
      t17 = dlog(t16)
      t18 = t5*t17
      t19 = 0.3109D-1*t18
      t20 = rhob**2
      t21 = rhob**(1.D0/3.D0)
      t23 = 1/t21/t20
      t27 = dexp(0.2513789108010112D1*t18)
      t28 = t27-1.D0
      t29 = 1/t28
      t30 = sigmabb**2
      t31 = t29*t30
      t32 = t20**2
      t33 = t21**2
      t35 = 1/t33/t32
      t38 = 0.1007494971260294D0*sigmabb*t23+0.2738174287780083D-1*t31
     #*t35
      t39 = t29*sigmabb
      t42 = t28**2
      t43 = 1/t42
      t44 = t43*t30
      t47 = 1.D0+0.2717804421747983D0*t39*t23+0.7386460874872889D-1
     #*t44*t35
      t48 = 1/t47
      t51 = 1.D0+0.2697586091519874D1*t38*t48
      t52 = dlog(t51)
      t53 = 0.1236778371778789D-1*t52
      t56 = 0.2568D1+0.1443307452126544D2*t3+0.2843543831490386D-2*t11
      t60 = 1.D0+0.5411317332115466D1*t3+0.1816419932959077D0*t11
     #+0.1763993811759022D-1*t2
      t61 = 1/t60
      t64 = 0.1D-2*t56*t61-0.1853571428571429D-2
      t65 = t64*sigmabb
      t70 = dexp(-0.1645530784602056D1/t33/t20*sigmabb)
      t71 = t23*t70
      t73 = 0.7937005259840997D0*t65*t71
      zk(i) = rhob*(-t19+t53+t73)
      vrhoa(i) = 0.D0
      t75 = 1/t11
      t76 = 1/t20
      t77 = t75*t76
      t78 = t77*t17
      t79 = 0.1321010150222857D-2*t78
      t80 = t13**2
      t81 = 1/t80
      t82 = t5*t81
      t83 = t6**2
      t84 = t83**2
      t85 = t84*t6
      t86 = 1/t85
      t90 = 1/t9
      t93 = 1/t3
      t94 = t93*t76
      t96 = -0.1853395810515781D1*t86*t76-0.128158207914907D1*t77
     #-0.8223668877838045D0*t90*t76-0.1603914194192128D0*t94
      t97 = 1/t16
      t99 = t82*t96*t97
      t100 = 0.1D1*t99
      t101 = t20*rhob
      t103 = 1/t21/t101
      t106 = t79+t100
      t108 = t35*t106*t27
      t111 = t32*rhob
      t113 = 1/t33/t111
      t116 = -0.2350821599607352D0*sigmabb*t103+0.2213957124623647D1
     #*t44*t108-0.1277814667630705D0*t31*t113
      t119 = t47**2
      t120 = 1/t119
      t121 = t38*t120
      t122 = t43*sigmabb
      t130 = 1/t42/t28
      t131 = t130*t30
      t136 = 0.2197487022544806D2*t122*t23*t106*t27
     #-0.6341543650745294D0*t39*t103+0.1194467989321217D2*t131*t108
     #-0.3447015074940681D0*t44*t113
      t139 = 0.2697586091519874D1*t116*t48-0.2697586091519874D1*t121
     #*t136
      t140 = 1/t51
      t141 = t139*t140
      t145 = -0.4811024840421814D1*t77-0.1895695887660258D-2*t94
      t148 = t60**2
      t149 = 1/t148
      t150 = t56*t149
      t154 = -0.1803772444038489D1*t77-0.1210946621972718D0*t94
     #-0.1763993811759022D-1*t76
      t157 = 0.1D-2*t145*t61-0.1D-2*t150*t154
      t158 = t157*sigmabb
      t159 = t158*t71
      t161 = t103*t70
      t162 = t65*t161
      t164 = t64*t30
      t165 = t32*t20
      t167 = 1/t165*t70
      t168 = t164*t167
      vrhob(i) = -t19+t53+t73+rhob*(t79+t100+0.1236778371778789D-1
     #*t141+0.7937005259840997D0*t159-0.1851967893962899D1*t162
     #+0.3482823064697813D1*t168)
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      t175 = 0.1007494971260294D0*t23+0.5476348575560166D-1*t39*t35
      t182 = 0.2717804421747983D0*t29*t23+0.1477292174974578D0*t122*t35
      t185 = 0.2697586091519874D1*t175*t48-0.2697586091519874D1*t121
     #*t182
      t191 = 1/t111
      vsigmabb(i) = rhob*(0.1236778371778789D-1*t185*t140
     #+0.7937005259840997D0*t64*t23*t70-0.130605864926168D1*t65*t191
     #*t70)
      v2rhoa2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t204 = dlog(1.D0+0.160818243221511D2/(0.598255043577108D1*t6
     #+0.2225569421150687D1*t3+0.8004286349993634D0*t9
     #+0.1897004325747559D0*t11))
      t215 = 1/t32
      t216 = 1/t11/t2*t215
      t218 = 1/t101
      t219 = t75*t218
      t223 = 1/t3/t2*t215
      t225 = t93*t218
      t236 = t154**2
      t253 = t32**2
      t260 = t32*t101
      t266 = 1/t21/t32
      t275 = t139**2
      t276 = t51**2
      t277 = 1/t276
      t282 = t106**2
      t283 = t35*t282
      t285 = dexp(0.5027578216020225D1*t18)
      t286 = t283*t285
      t290 = t113*t106*t27
      t294 = 0.1D-22*t219*t204
      t296 = 0.8806734334819047D-3*t216*t17
      t298 = 0.2642020300445714D-2*t219*t17
      t302 = 0.8497974591333914D-1*t77*t81*t96*t97
      t306 = t96**2
      t309 = 0.2D1*t5/t80/t13*t306*t97
      t329 = 0.1D1*t82*(-0.1544496508763151D1/t85/t2*t215
     #+0.3706791621031562D1*t86*t218-0.854388052766047D0*t216
     #+0.2563164158298141D1*t219-0.4111834438919023D0/t9/t2*t215
     #+0.1644733775567609D1*t90*t218-0.5346380647307093D-1*t223
     #+0.3207828388384256D0*t225)*t97
      t330 = t80**2
      t333 = t16**2
      t337 = 0.321646831778707D2*t5/t330*t306/t333
      t338 = -t294+t296-t298-t302-t309+t329+t337
      t340 = t35*t338*t27
      t343 = t283*t27
      t347 = 1/t33/t165
      t358 = t38/t119/t47
      t359 = t136**2
      t363 = t23*t282
      t380 = t42**2
      s1 = 0.7937005259840997D0*(0.1D-2*(-0.3207349893614542D1*t216
     #+0.9622049680843627D1*t219-0.6318986292200858D-3*t223
     #+0.3791391775320515D-2*t225)*t61-0.2D-2*t145*t149*t154+0.2D-2
     #*t56/t148/t60*t236-0.1D-2*t150*(-0.1202514962692326D1*t216
     #+0.3607544888076978D1*t219-0.4036488739909061D-1*t223
     #+0.2421893243945437D0*t225+0.3527987623518044D-1*t218))*sigmabb
     #*t71+0.1528291352075288D2*t64*t30*sigmabb/t33/t253/rhob*t70
     #-0.2902352553914844D2*t164/t260*t70+0.6173226313209665D1*t65
     #*t266*t70-0.3703935787925799D1*t158*t161+0.6965646129395627D1
     #*t157*t30*t167-0.1236778371778789D-1*t275*t277
      t399 = s1+0.1236778371778789D-1*(0.2697586091519874D1*
     #(0.7836071998691172D0*sigmabb*t266+0.3580200260842915D3*t131
     #*t286-0.2066359982982071D2*t44*t290+0.2213957124623647D1*t44
     #*t340-0.1790100130421458D3*t44*t343+0.7240949783240664D0*t31
     #*t347)*t48-0.5395172183039748D1*t116*t120*t136
     #+0.5395172183039748D1*t358*t359-0.2697586091519874D1*t121*
     #(0.35535663829313D4*t130*sigmabb*t363*t285-0.1025493943854243D3
     #*t122*t103*t106*t27+0.2197487022544806D2*t122*t23*t338*t27
     #-0.177678319146565D4*t122*t363*t27+0.2113847883581765D1*t39*t266
     #+0.2897369528551702D4/t380*t30*t286-0.1114836790033136D3*t131
     #*t290+0.1194467989321217D2*t131*t340-0.9657898428505673D3*t131
     #*t343+0.1953308542466386D1*t44*t347))*t140+t337+t329-t294+t296
     #-t298-t309-t302
      v2rhob2(i) = -0.1D-22*t77*t204+0.2642020300445714D-2*t78+0.2D1
     #*t99+0.2473556743557577D-1*t141+0.1587401051968199D1*t159
     #-0.3703935787925799D1*t162+0.6965646129395627D1*t168+rhob*t399
      v2sigmaaa2(i) = 0.D0
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      t407 = t182**2
      t416 = t185**2
      v2sigmabb2(i) = rhob*(0.1236778371778789D-1*
     #(0.1477292174974578D0*t29*t35*t48-0.5395172183039748D1*t175*t120
     #*t182+0.5395172183039748D1*t358*t407-0.3985122824322565D0*t121
     #*t43*t35)*t140-0.1236778371778789D-1*t416*t277
     #-0.261211729852336D1*t64*t191*t70+0.2149159713855873D1*t65/t33
     #/t260*t70)
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = 1/rhoa
      t3 = t2**(1.D0/3.D0)
      t5 = 1.D0+0.1274696188700087D0*t3
      t6 = t2**(1.D0/6.D0)
      t9 = dsqrt(t2)
      t11 = t3**2
      t13 = 0.1112037486309468D2*t6+0.3844746237447211D1*t3
     #+0.1644733775567609D1*t9+0.2405871291288192D0*t11
      t16 = 1.D0+0.321646831778707D2/t13
      t17 = dlog(t16)
      t18 = t5*t17
      t19 = 0.3109D-1*t18
      t20 = rhoa**2
      t21 = rhoa**(1.D0/3.D0)
      t23 = 1/t21/t20
      t27 = dexp(0.2513789108010112D1*t18)
      t28 = t27-1.D0
      t29 = 1/t28
      t30 = sigmaaa**2
      t31 = t29*t30
      t32 = t20**2
      t33 = t21**2
      t35 = 1/t33/t32
      t38 = 0.1007494971260294D0*sigmaaa*t23+0.2738174287780083D-1*t31
     #*t35
      t39 = t29*sigmaaa
      t42 = t28**2
      t43 = 1/t42
      t44 = t43*t30
      t47 = 1.D0+0.2717804421747983D0*t39*t23+0.7386460874872889D-1
     #*t44*t35
      t48 = 1/t47
      t51 = 1.D0+0.2697586091519874D1*t38*t48
      t52 = dlog(t51)
      t53 = 0.1236778371778789D-1*t52
      t56 = 0.2568D1+0.1443307452126544D2*t3+0.2843543831490386D-2*t11
      t60 = 1.D0+0.5411317332115466D1*t3+0.1816419932959077D0*t11
     #+0.1763993811759022D-1*t2
      t61 = 1/t60
      t64 = 0.1D-2*t56*t61-0.1853571428571429D-2
      t65 = t64*sigmaaa
      t70 = dexp(-0.1645530784602056D1/t33/t20*sigmaaa)
      t71 = t23*t70
      t73 = 0.7937005259840997D0*t65*t71
      zk(i) = rhoa*(-t19+t53+t73)
      t75 = 1/t11
      t76 = 1/t20
      t77 = t75*t76
      t78 = t77*t17
      t79 = 0.1321010150222857D-2*t78
      t80 = t13**2
      t81 = 1/t80
      t82 = t5*t81
      t83 = t6**2
      t84 = t83**2
      t85 = t84*t6
      t86 = 1/t85
      t90 = 1/t9
      t93 = 1/t3
      t94 = t93*t76
      t96 = -0.1853395810515781D1*t86*t76-0.128158207914907D1*t77
     #-0.8223668877838045D0*t90*t76-0.1603914194192128D0*t94
      t97 = 1/t16
      t99 = t82*t96*t97
      t100 = 0.1D1*t99
      t101 = t20*rhoa
      t103 = 1/t21/t101
      t106 = t79+t100
      t108 = t35*t106*t27
      t111 = t32*rhoa
      t113 = 1/t33/t111
      t116 = -0.2350821599607352D0*sigmaaa*t103+0.2213957124623647D1
     #*t44*t108-0.1277814667630705D0*t31*t113
      t119 = t47**2
      t120 = 1/t119
      t121 = t38*t120
      t122 = t43*sigmaaa
      t130 = 1/t42/t28
      t131 = t130*t30
      t136 = 0.2197487022544806D2*t122*t23*t106*t27
     #-0.6341543650745294D0*t39*t103+0.1194467989321217D2*t131*t108
     #-0.3447015074940681D0*t44*t113
      t139 = 0.2697586091519874D1*t116*t48-0.2697586091519874D1*t121
     #*t136
      t140 = 1/t51
      t141 = t139*t140
      t145 = -0.4811024840421814D1*t77-0.1895695887660258D-2*t94
      t148 = t60**2
      t149 = 1/t148
      t150 = t56*t149
      t154 = -0.1803772444038489D1*t77-0.1210946621972718D0*t94
     #-0.1763993811759022D-1*t76
      t157 = 0.1D-2*t145*t61-0.1D-2*t150*t154
      t158 = t157*sigmaaa
      t159 = t158*t71
      t161 = t103*t70
      t162 = t65*t161
      t164 = t64*t30
      t165 = t32*t20
      t167 = 1/t165*t70
      t168 = t164*t167
      vrhoa(i) = -t19+t53+t73+rhoa*(t79+t100+0.1236778371778789D-1
     #*t141+0.7937005259840997D0*t159-0.1851967893962899D1*t162
     #+0.3482823064697813D1*t168)
      vrhob(i) = 0.D0
      t175 = 0.1007494971260294D0*t23+0.5476348575560166D-1*t39*t35
      t182 = 0.2717804421747983D0*t29*t23+0.1477292174974578D0*t122*t35
      t185 = 0.2697586091519874D1*t175*t48-0.2697586091519874D1*t121
     #*t182
      t191 = 1/t111
      vsigmaaa(i) = rhoa*(0.1236778371778789D-1*t185*t140
     #+0.7937005259840997D0*t64*t23*t70-0.130605864926168D1*t65*t191
     #*t70)
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      t204 = dlog(1.D0+0.160818243221511D2/(0.598255043577108D1*t6
     #+0.2225569421150687D1*t3+0.8004286349993634D0*t9
     #+0.1897004325747559D0*t11))
      t215 = 1/t32
      t216 = 1/t11/t2*t215
      t218 = 1/t101
      t219 = t75*t218
      t223 = 1/t3/t2*t215
      t225 = t93*t218
      t236 = t154**2
      t253 = t32**2
      t260 = t32*t101
      t266 = 1/t21/t32
      t275 = t139**2
      t276 = t51**2
      t277 = 1/t276
      t282 = t106**2
      t283 = t35*t282
      t285 = dexp(0.5027578216020225D1*t18)
      t286 = t283*t285
      t290 = t113*t106*t27
      t294 = 0.1D-22*t219*t204
      t296 = 0.8806734334819047D-3*t216*t17
      t298 = 0.2642020300445714D-2*t219*t17
      t302 = 0.8497974591333914D-1*t77*t81*t96*t97
      t306 = t96**2
      t309 = 0.2D1*t5/t80/t13*t306*t97
      t329 = 0.1D1*t82*(-0.1544496508763151D1/t85/t2*t215
     #+0.3706791621031562D1*t86*t218-0.854388052766047D0*t216
     #+0.2563164158298141D1*t219-0.4111834438919023D0/t9/t2*t215
     #+0.1644733775567609D1*t90*t218-0.5346380647307093D-1*t223
     #+0.3207828388384256D0*t225)*t97
      t330 = t80**2
      t333 = t16**2
      t337 = 0.321646831778707D2*t5/t330*t306/t333
      t338 = -t294+t296-t298-t302-t309+t329+t337
      t340 = t35*t338*t27
      t343 = t283*t27
      t347 = 1/t33/t165
      t358 = t38/t119/t47
      t359 = t136**2
      t363 = t23*t282
      t380 = t42**2
      s1 = 0.7937005259840997D0*(0.1D-2*(-0.3207349893614542D1*t216
     #+0.9622049680843627D1*t219-0.6318986292200858D-3*t223
     #+0.3791391775320515D-2*t225)*t61-0.2D-2*t145*t149*t154+0.2D-2
     #*t56/t148/t60*t236-0.1D-2*t150*(-0.1202514962692326D1*t216
     #+0.3607544888076978D1*t219-0.4036488739909061D-1*t223
     #+0.2421893243945437D0*t225+0.3527987623518044D-1*t218))*sigmaaa
     #*t71+0.1528291352075288D2*t64*t30*sigmaaa/t33/t253/rhoa*t70
     #-0.2902352553914844D2*t164/t260*t70+0.6173226313209665D1*t65
     #*t266*t70-0.3703935787925799D1*t158*t161+0.6965646129395627D1
     #*t157*t30*t167-0.1236778371778789D-1*t275*t277
      t399 = s1+0.1236778371778789D-1*(0.2697586091519874D1*
     #(0.7836071998691172D0*sigmaaa*t266+0.3580200260842915D3*t131
     #*t286-0.2066359982982071D2*t44*t290+0.2213957124623647D1*t44
     #*t340-0.1790100130421458D3*t44*t343+0.7240949783240664D0*t31
     #*t347)*t48-0.5395172183039748D1*t116*t120*t136
     #+0.5395172183039748D1*t358*t359-0.2697586091519874D1*t121*
     #(0.35535663829313D4*t130*sigmaaa*t363*t285-0.1025493943854243D3
     #*t122*t103*t106*t27+0.2197487022544806D2*t122*t23*t338*t27
     #-0.177678319146565D4*t122*t363*t27+0.2113847883581765D1*t39*t266
     #+0.2897369528551702D4/t380*t30*t286-0.1114836790033136D3*t131
     #*t290+0.1194467989321217D2*t131*t340-0.9657898428505673D3*t131
     #*t343+0.1953308542466386D1*t44*t347))*t140+t337+t329-t294+t296
     #-t298-t309-t302
      v2rhoa2(i) = -0.1D-22*t77*t204+0.2642020300445714D-2*t78+0.2D1
     #*t99+0.2473556743557577D-1*t141+0.1587401051968199D1*t159
     #-0.3703935787925799D1*t162+0.6965646129395627D1*t168+rhoa*t399
      v2rhob2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t407 = t182**2
      t416 = t185**2
      v2sigmaaa2(i) = rhoa*(0.1236778371778789D-1*
     #(0.1477292174974578D0*t29*t35*t48-0.5395172183039748D1*t175*t120
     #*t182+0.5395172183039748D1*t358*t407-0.3985122824322565D0*t121
     #*t43*t35)*t140-0.1236778371778789D-1*t416*t277
     #-0.261211729852336D1*t64*t191*t70+0.2149159713855873D1*t65/t33
     #/t260*t70)
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      v2sigmabb2(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = 1/rho
      t5 = t4**(1.D0/3.D0)
      t7 = 1.D0+0.1325688999052018D0*t5
      t8 = t4**(1.D0/6.D0)
      t11 = dsqrt(t4)
      t13 = t5**2
      t15 = 0.598255043577108D1*t8+0.2225569421150687D1*t5
     #+0.8004286349993634D0*t11+0.1897004325747559D0*t13
      t18 = 1.D0+0.160818243221511D2/t15
      t19 = dlog(t18)
      t21 = 0.62182D-1*t7*t19
      t23 = 1.D0+0.6901399211255825D-1*t5
      t28 = 0.8157414703487641D1*t8+0.2247591863577616D1*t5
     #+0.4300972471276643D0*t11+0.1911512595127338D0*t13
      t31 = 1.D0+0.2960857464321668D2/t28
      t32 = dlog(t31)
      t33 = t23*t32
      t35 = rhoa-1.D0*rhob
      t36 = t35*t4
      t37 = 1.D0+t36
      t38 = t37**(1.D0/3.D0)
      t39 = t38*t37
      t41 = 1.D0-1.D0*t36
      t42 = t41**(1.D0/3.D0)
      t43 = t42*t41
      t44 = t39+t43-2.D0
      t45 = t35**2
      t46 = t45**2
      t47 = rho**2
      t48 = t47**2
      t49 = 1/t48
      t50 = t46*t49
      t52 = 1.D0-1.D0*t50
      t53 = t44*t52
      t55 = 0.3799574853701528D-1*t33*t53
      t57 = 1.D0+0.1274696188700087D0*t5
      t62 = 0.1112037486309468D2*t8+0.3844746237447211D1*t5
     #+0.1644733775567609D1*t11+0.2405871291288192D0*t13
      t65 = 1.D0+0.321646831778707D2/t62
      t66 = dlog(t65)
      t69 = -0.3109D-1*t57*t66+t21
      t70 = t69*t44
      t72 = 0.1923661050931536D1*t70*t50
      t73 = t38**2
      t75 = t42**2
      t77 = 0.5D0*t73+0.5D0*t75
      t78 = t77**2
      t79 = t78*t77
      t80 = 1/t78
      t81 = sigma*t80
      t82 = rho**(1.D0/3.D0)
      t84 = 1/t82/t47
      t87 = -t21+t55+t72
      t88 = 1/t79
      t89 = t87*t88
      t91 = dexp(-0.4042761511756372D2*t89)
      t92 = t91-1.D0
      t93 = 1/t92
      t94 = sigma**2
      t95 = t93*t94
      t96 = t78**2
      t97 = 1/t96
      t98 = t82**2
      t100 = 1/t98/t48
      t101 = t97*t100
      t104 = 0.634682060977037D-1*t81*t84+0.1086645186223595D-1*t95*t101
      t105 = t93*sigma
      t106 = t80*t84
      t109 = t92**2
      t110 = 1/t109
      t111 = t110*t94
      t114 = 1.D0+0.1712109500228824D0*t105*t106+0.2931318940773793D-1
     #*t111*t101
      t115 = 1/t114
      t118 = 1.D0+0.2697586091519874D1*t104*t115
      t119 = dlog(t118)
      t121 = 0.2473556743557577D-1*t79*t119
      t124 = 0.2568D1+0.1443307452126544D2*t5+0.2843543831490386D-2*t13
      t128 = 1.D0+0.5411317332115466D1*t5+0.1816419932959077D0*t13
     #+0.1763993811759022D-1*t4
      t129 = 1/t128
      t132 = 0.1D-2*t124*t129-0.1853571428571429D-2
      t133 = t132*t77
      t136 = 1/t98/t47
      t140 = dexp(-0.261211729852336D1*t78*t136*sigma)
      t141 = sigma*t84*t140
      t143 = 0.1D1*t133*t141
      zk(i) = rho*(-t21+t55+t72+t121+t143)
      t149 = 0.1333333333333333D1*t38*t4-0.1333333333333333D1*t42*t4
      t151 = t33*t149*t52
      t152 = 0.3799574853701528D-1*t151
      t153 = t45*t35
      t154 = t44*t153
      t156 = t33*t154*t49
      t157 = 0.1519829941480611D0*t156
      t158 = t69*t149
      t159 = t158*t50
      t160 = 0.1923661050931536D1*t159
      t161 = t153*t49
      t162 = t70*t161
      t163 = 0.7694644203726145D1*t162
      t164 = t78*t119
      t165 = 1/t38
      t168 = 1/t42
      t171 = 0.3333333333333333D0*t165*t4-0.3333333333333333D0*t168*t4
      t172 = t164*t171
      t173 = 0.7420670230672731D-1*t172
      t174 = sigma*t88
      t175 = t84*t171
      t178 = t111*t97
      t179 = t152-t157+t160+t163
      t182 = t87*t97
      t185 = -0.4042761511756372D2*t179*t88+0.1212828453526912D3*t182
     #*t171
      t186 = t100*t185
      t187 = t186*t91
      t190 = t96*t77
      t191 = 1/t190
      t192 = t191*t100
      t193 = t192*t171
      t196 = -0.1269364121954074D0*t174*t175-0.1086645186223595D-1
     #*t178*t187-0.4346580744894379D-1*t95*t193
      t199 = t114**2
      t200 = 1/t199
      t201 = t104*t200
      t202 = t110*sigma
      t203 = t202*t80
      t204 = t84*t185
      t205 = t204*t91
      t208 = t88*t84
      t209 = t208*t171
      t213 = 1/t109/t92
      t214 = t213*t94
      t215 = t214*t97
      t220 = -0.1712109500228824D0*t203*t205-0.3424219000457648D0*t105
     #*t209-0.5862637881547585D-1*t215*t187-0.1172527576309517D0*t111
     #*t193
      t223 = 0.2697586091519874D1*t196*t115-0.2697586091519874D1*t201
     #*t220
      t224 = t79*t223
      t225 = 1/t118
      t226 = t224*t225
      t227 = 0.2473556743557577D-1*t226
      t228 = t132*t171
      t229 = t228*t141
      t230 = 0.1D1*t229
      t232 = t132*t78*t94
      t233 = t48*rho
      t234 = 1/t233
      t236 = t234*t171*t140
      t237 = t232*t236
      t238 = 0.522423459704672D1*t237
      t241 = 1/t13
      t242 = 1/t47
      t243 = t241*t242
      t244 = t243*t19
      t245 = 0.2747799777968419D-2*t244
      t246 = t15**2
      t247 = 1/t246
      t248 = t7*t247
      t249 = t8**2
      t250 = t249**2
      t251 = t250*t8
      t252 = 1/t251
      t253 = t252*t242
      t256 = 1/t11
      t257 = t256*t242
      t259 = 1/t5
      t260 = t259*t242
      t262 = -0.99709173929518D0*t253-0.7418564737168958D0*t243
     #-0.4002143174996817D0*t257-0.1264669550498372D0*t260
      t263 = 1/t18
      t265 = t248*t262*t263
      t266 = 0.1D1*t265
      t267 = t32*t44
      t268 = t267*t52
      t269 = t243*t268
      t270 = 0.8740794299481065D-3*t269
      t271 = t28**2
      t272 = 1/t271
      t273 = t23*t272
      t278 = -0.135956911724794D1*t253-0.7491972878592054D0*t243
     #-0.2150486235638321D0*t257-0.1274341730084892D0*t260
      t279 = t273*t278
      t280 = 1/t31
      t281 = t280*t44
      t282 = t281*t52
      t283 = t279*t282
      t284 = 0.1124999956683108D1*t283
      t285 = t38*t35
      t288 = t42*t35
      t291 = -0.1333333333333333D1*t285*t242+0.1333333333333333D1*t288
     #*t242
      t293 = t33*t291*t52
      t294 = 0.3799574853701528D-1*t293
      t295 = t44*t46
      t297 = t33*t295*t234
      t298 = 0.1519829941480611D0*t297
      t301 = t62**2
      t302 = 1/t301
      t303 = t57*t302
      t308 = -0.1853395810515781D1*t253-0.128158207914907D1*t243
     #-0.8223668877838045D0*t257-0.1603914194192128D0*t260
      t309 = 1/t65
      t315 = 0.1321010150222857D-2*t243*t66+0.1D1*t303*t308*t309
     #-0.2747799777968419D-2*t244-0.1D1*t265
      t316 = t315*t44
      t317 = t316*t50
      t318 = 0.1923661050931536D1*t317
      t319 = t69*t291
      t320 = t319*t50
      t321 = 0.1923661050931536D1*t320
      t322 = t46*t234
      t323 = t70*t322
      t324 = 0.7694644203726145D1*t323
      t325 = t165*t35
      t328 = t168*t35
      t331 = -0.3333333333333333D0*t325*t242+0.3333333333333333D0*t328
     #*t242
      t332 = t164*t331
      t334 = t84*t331
      t337 = t47*rho
      t339 = 1/t82/t337
      t342 = t245+t266-t270-t284+t294+t298+t318+t321-t324
      t347 = -0.4042761511756372D2*t342*t88+0.1212828453526912D3*t182
     #*t331
      t348 = t100*t347
      t349 = t348*t91
      t352 = t192*t331
      t356 = 1/t98/t233
      t357 = t97*t356
      t360 = -0.1269364121954074D0*t174*t334-0.148092480894642D0*t81
     #*t339-0.1086645186223595D-1*t178*t349-0.4346580744894379D-1*t95
     #*t352-0.5071010869043442D-1*t95*t357
      t363 = t84*t347
      t364 = t363*t91
      t367 = t208*t331
      t370 = t80*t339
      t379 = -0.1712109500228824D0*t203*t364-0.3424219000457648D0*t105
     #*t367-0.3994922167200589D0*t105*t370-0.5862637881547585D-1*t215
     #*t349-0.1172527576309517D0*t111*t352-0.136794883902777D0*t111*t357
      t382 = 0.2697586091519874D1*t360*t115-0.2697586091519874D1*t201
     #*t379
      t383 = t79*t382
      t384 = t383*t225
      t388 = -0.4811024840421814D1*t243-0.1895695887660258D-2*t260
      t391 = t128**2
      t392 = 1/t391
      t393 = t124*t392
      t397 = -0.1803772444038489D1*t243-0.1210946621972718D0*t260
     #-0.1763993811759022D-1*t242
      t400 = 0.1D-2*t388*t129-0.1D-2*t393*t397
      t401 = t400*t77
      t402 = t401*t141
      t404 = t132*t331
      t405 = t404*t141
      t408 = sigma*t339*t140
      t409 = t133*t408
      t411 = t133*sigma
      t412 = t77*t136
      t413 = sigma*t331
      t417 = 1/t98/t337
      t418 = t78*t417
      t421 = -0.522423459704672D1*t412*t413+0.6965646129395627D1*t418
     #*sigma
      t423 = t84*t421*t140
      t424 = t411*t423
      t426 = t245+t266-t270-t284+t294+t298+t318+t321-t324
     #+0.7420670230672731D-1*t332+0.2473556743557577D-1*t384+0.1D1
     #*t402+0.1D1*t405-0.2333333333333333D1*t409+0.1D1*t424
      t427 = rho*t426
      vrhoa(i) = rho*(t152-t157+t160+t163+t173+t227+t230-t238)-t21+t55
     #+t72+t121+t143+t427
      t428 = -t149
      t430 = t33*t428*t52
      t431 = 0.3799574853701528D-1*t430
      t432 = 0.1519829941480611D0*t156
      t433 = t69*t428
      t434 = t433*t50
      t435 = 0.1923661050931536D1*t434
      t436 = 0.7694644203726145D1*t162
      t437 = -t171
      t438 = t164*t437
      t439 = 0.7420670230672731D-1*t438
      t440 = t84*t437
      t443 = t431+t432+t435-t436
      t448 = -0.4042761511756372D2*t443*t88+0.1212828453526912D3*t182
     #*t437
      t449 = t100*t448
      t450 = t449*t91
      t453 = t192*t437
      t456 = -0.1269364121954074D0*t174*t440-0.1086645186223595D-1
     #*t178*t450-0.4346580744894379D-1*t95*t453
      t459 = t84*t448
      t460 = t459*t91
      t463 = t208*t437
      t470 = -0.1712109500228824D0*t203*t460-0.3424219000457648D0*t105
     #*t463-0.5862637881547585D-1*t215*t450-0.1172527576309517D0*t111
     #*t453
      t473 = 0.2697586091519874D1*t456*t115-0.2697586091519874D1*t201
     #*t470
      t474 = t79*t473
      t475 = t474*t225
      t476 = 0.2473556743557577D-1*t475
      t477 = t132*t437
      t478 = t477*t141
      t479 = 0.1D1*t478
      t481 = t234*t437*t140
      t482 = t232*t481
      t483 = 0.522423459704672D1*t482
      vrhob(i) = rho*(t431+t432+t435-t436+t439+t476+t479-t483)-t21+t55
     #+t72+t121+t143+t427
      t489 = 0.634682060977037D-1*t106+0.2173290372447189D-1*t105*t101
      t492 = t93*t80
      t497 = 0.1712109500228824D0*t492*t84+0.5862637881547585D-1*t202
     #*t101
      t500 = 0.2697586091519874D1*t489*t115-0.2697586091519874D1*t201
     #*t497
      t502 = t79*t500*t225
      t503 = 0.2473556743557577D-1*t502
      t504 = t84*t140
      t505 = t133*t504
      t506 = 0.1D1*t505
      t507 = t132*t79
      t509 = sigma*t234*t140
      t510 = t507*t509
      t511 = 0.261211729852336D1*t510
      vsigmaaa(i) = rho*(t503+t506-t511)
      vsigmaab(i) = 2.D0*vsigmaaa(i)
      vsigmabb(i) = vsigmaaa(i)
      t516 = 0.2D1*t265
      t517 = 0.7599149707403056D-1*t293
      t520 = 1/t73
      t523 = 1/t75
      t526 = 0.4444444444444444D0*t520*t242+0.4444444444444444D0*t523
     #*t242
      t529 = 0.3799574853701528D-1*t33*t526*t52
      t532 = t33*t149*t153*t49
      t533 = 0.3039659882961223D0*t532
      t536 = t33*t44*t45*t49
      t537 = 0.4559489824441834D0*t536
      t540 = 0.1923661050931536D1*t69*t526*t50
      t541 = t158*t161
      t542 = 0.1538928840745229D2*t541
      t544 = t70*t45*t49
      t545 = 0.2308393261117844D2*t544
      t546 = t77*t119
      t547 = t171**2
      t550 = t78*t223
      t551 = t225*t171
      t554 = 1/t39
      t557 = 1/t43
      t560 = -0.1111111111111111D0*t554*t242-0.1111111111111111D0*t557
     #*t242
      t562 = 0.7420670230672731D-1*t164*t560
      t563 = sigma*t97
      t569 = 0.1269364121954074D0*t174*t84*t560
      t570 = t185**2
      t571 = t100*t570
      t573 = dexp(-0.8085523023512745D2*t89)
      t574 = t571*t573
      t577 = t111*t191
      t578 = t91*t171
      t579 = t186*t578
      t585 = t179*t97
      t588 = t87*t191
      t592 = 0.1212828453526912D3*t182*t560
      t593 = -0.4042761511756372D2*(t529-t533-t537+t540+t542+t545)*t88
     #+0.2425656907053823D3*t585*t171-0.4851313814107647D3*t588*t547
     #+t592
      t595 = t100*t593*t91
      t598 = t571*t91
      t602 = 1/t96/t78
      t603 = t602*t100
      t604 = t603*t547
      t607 = t192*t560
      t609 = 0.4346580744894379D-1*t95*t607
      t613 = t196*t200
      t618 = t104/t199/t114
      t619 = t220**2
      t622 = t213*sigma
      t623 = t622*t80
      t624 = t84*t570
      t628 = t202*t88
      t639 = t97*t84
      t645 = 0.3424219000457648D0*t105*t208*t560
      t646 = t109**2
      t649 = 1/t646*t94*t97
      t652 = t214*t191
      t662 = 0.1172527576309517D0*t111*t607
      t663 = 0.3424219000457648D0*t623*t624*t573+0.6848438000915295D0
     #*t628*t204*t578-0.1712109500228824D0*t203*t84*t593*t91
     #-0.1712109500228824D0*t203*t624*t91+0.1027265700137294D1*t105
     #*t639*t547-t645+0.1758791364464276D0*t649*t574
     #+0.4690110305238068D0*t652*t579-0.5862637881547585D-1*t215*t595
     #-0.5862637881547585D-1*t215*t598+0.5862637881547585D0*t111*t604
     #-t662
      t670 = t223**2
      t672 = t118**2
      t673 = 1/t672
      t678 = 0.1D1*t132*t560*t141
      t681 = t234*t77
      t682 = t681*t140
      t688 = 0.522423459704672D1*t232*t234*t560*t140
      t690 = t507*t94*sigma
      t691 = t48*t337
      t693 = 1/t98/t691
      t698 = t529-t533-t537+t540+t542+t545+0.1484134046134546D0*t546
     #*t547+0.1484134046134546D0*t550*t551+t562+0.2473556743557577D-1
     #*t79*(0.2697586091519874D1*(0.3808092365862222D0*t563*t84*t547
     #-t569+0.2173290372447189D-1*t215*t574+0.8693161489788758D-1*t577
     #*t579-0.1086645186223595D-1*t178*t595-0.1086645186223595D-1*t178
     #*t598+0.2173290372447189D0*t95*t604-t609)*t115
     #-0.5395172183039748D1*t613*t220+0.5395172183039748D1*t618*t619
     #-0.2697586091519874D1*t201*t663)*t225-0.2473556743557577D-1*t79
     #*t670*t673+t678-0.1567270379114016D2*t132*t547*t94*t682-t688
     #+0.272926271249799D2*t690*t693*t547*t140
      t701 = 0.5495599555936838D-2*t244
      t702 = 0.1484134046134546D0*t332
      t705 = 0.7599149707403056D-1*t151+0.3847322101863073D1*t159
     #+0.1538928840745229D2*t162+t516+t517+0.1484134046134546D0*t172
     #-0.3039659882961223D0*t156+rho*t698+0.4947113487115154D-1*t226
     #+t701+t702+0.2D1*t229-0.1044846919409344D2*t237
      t706 = 0.3039659882961223D0*t297
      t707 = 0.3847322101863073D1*t317
      t708 = 0.3847322101863073D1*t320
      t709 = 0.1748158859896213D-2*t269
      t710 = 0.2249999913366216D1*t283
      t711 = 0.1538928840745229D2*t323
      t712 = 0.4947113487115154D-1*t384
      t713 = 0.4666666666666667D1*t409
      t714 = 0.2D1*t424
      t715 = 0.2D1*t405
      t716 = 0.2D1*t402
      t717 = t78*t382
      t718 = t225*t331
      t724 = t278**2
      t727 = 0.2249999913366216D1*t23/t271/t28*t724*t282
      t728 = t382**2
      t738 = 1/t82/t48
      t743 = t421**2
      t752 = t331**2
      t756 = t77*t417
      t762 = 1/t337
      t770 = -0.1111111111111111D0*t554*t45*t49+0.6666666666666667D0
     #*t325*t762-0.1111111111111111D0*t557*t45*t49
     #-0.6666666666666667D0*t328*t762
      t782 = t404*sigma
      t792 = 1/t13/t4*t49
      t794 = t241*t762
      t798 = 1/t5/t4*t49
      t800 = t259*t762
      t811 = t397**2
      t841 = t356*t347*t91
      t844 = t91*t331
      t845 = t348*t844
      t851 = t262**2
      t853 = t7/t246/t15*t851*t263
      t854 = 0.2D1*t853
      t857 = 1/t251/t4*t49
      t859 = t252*t762
      t865 = 1/t11/t4*t49
      t867 = t256*t762
      t873 = t248*(-0.8309097827459833D0*t857+0.199418347859036D1*t859
     #-0.4945709824779306D0*t792+0.1483712947433792D1*t794
     #-0.2001071587498409D0*t865+0.8004286349993634D0*t867
     #-0.4215565168327908D-1*t798+0.2529339100996745D0*t800)*t263
      t874 = 0.1D1*t873
      t875 = t246**2
      t878 = t18**2
      t881 = t7/t875*t851/t878
      t882 = 0.160818243221511D2*t881
      t894 = t308**2
      t910 = t301**2
      t913 = t65**2
      t918 = t792*t19
      t920 = t794*t19
      t924 = t243*t247*t262*t263
      t929 = 0.8806734334819047D-3*t792*t66-0.2642020300445714D-2*t794
     #*t66-0.8497974591333914D-1*t243*t302*t308*t309-0.2D1*t57/t301
     #/t62*t894*t309+0.1D1*t303*(-0.1544496508763151D1*t857
     #+0.3706791621031562D1*t859-0.854388052766047D0*t792
     #+0.2563164158298141D1*t794-0.4111834438919023D0*t865
     #+0.1644733775567609D1*t867-0.5346380647307093D-1*t798
     #+0.3207828388384256D0*t800)*t309+0.321646831778707D2*t57/t910
     #*t894/t913-0.1831866518645613D-2*t918+0.5495599555936838D-2*t920
     #+0.8837926660346786D-1*t924+0.2D1*t853-0.1D1*t873
     #-0.160818243221511D2*t881
      t932 = 0.1923661050931536D1*t929*t44*t50
      t943 = 0.4444444444444444D0*t520*t45*t49+0.2666666666666667D1
     #*t285*t762+0.4444444444444444D0*t523*t45*t49
     #-0.2666666666666667D1*t288*t762
      t946 = 0.3799574853701528D-1*t33*t943*t52
      t947 = 0.8837926660346786D-1*t924
      t948 = t271**2
      t952 = t31**2
      t957 = 0.3330964519106732D2*t23/t948*t724/t952*t44*t52
      t969 = 0.1124999956683108D1*t273*(-0.1132974264373283D1*t857
     #+0.271913823449588D1*t859-0.4994648585728036D0*t792
     #+0.1498394575718411D1*t794-0.1075243117819161D0*t865
     #+0.4300972471276643D0*t867-0.4247805766949639D-1*t798
     #+0.2548683460169784D0*t800)*t282
      t970 = 0.1831866518645613D-2*t918
      t972 = 0.1748158859896213D-2*t794*t268
      t976 = 0.2249999913366216D1*t279*t280*t291*t52
      t977 = t727-t854+t874+t882+t932+t946-t947-t957-t969+t970+t972-t976
      t978 = 0.5495599555936838D-2*t920
      t982 = 0.3039659882961223D0*t33*t291*t46*t234
      t985 = 0.8999999653464862D1*t279*t281*t322
      t986 = t48*t47
      t987 = 1/t986
      t990 = 0.3847322101863073D2*t70*t46*t987
      t992 = 0.1538928840745229D2*t319*t322
      t995 = 0.3847322101863073D1*t315*t291*t50
      t997 = 0.1538928840745229D2*t316*t322
      t1000 = 0.1923661050931536D1*t69*t943*t50
      t1003 = 0.7599149707403056D0*t33*t295*t987
      t1007 = 0.1748158859896213D-2*t243*t32*t291*t52
      t1009 = 0.5827196199654043D-3*t792*t268
      t1014 = 0.5176049209143758D-1*t243*t272*t278*t280*t53
      t1019 = 0.6992635439584852D-2*t241/t691*t267*t46
      t1020 = -t978+t982-t985+t990-t992+t995-t997+t1000-t1003-t1007
     #-t1009+t1014-t1019
      t1024 = t342*t97
      t1031 = -0.4042761511756372D2*(t977+t1020)*t88
     #+0.2425656907053823D3*t1024*t331-0.4851313814107647D3*t588*t752
     #+0.1212828453526912D3*t182*t770
      t1033 = t100*t1031*t91
      t1036 = t347**2
      t1037 = t100*t1036
      t1038 = t1037*t573
      t1041 = t1037*t91
      t1046 = t97/t98/t986
      t1049 = t603*t752
      t1052 = t191*t356
      t1053 = t1052*t331
      t1056 = t192*t770
      t1059 = 0.3808092365862222D0*t563*t84*t752+0.5923699235785679D0
     #*t174*t339*t331-0.1269364121954074D0*t174*t84*t770
     #+0.4936416029821399D0*t81*t738+0.1014202173808688D0*t178*t841
     #+0.8693161489788758D-1*t577*t845-0.1086645186223595D-1*t178
     #*t1033+0.2173290372447189D-1*t215*t1038-0.1086645186223595D-1
     #*t178*t1041+0.2873572825791284D0*t95*t1046+0.2173290372447189D0
     #*t95*t1049+0.4056808695234754D0*t95*t1053-0.4346580744894379D-1
     #*t95*t1056
      t1062 = t360*t200
      t1065 = t379**2
      t1085 = t84*t1036
      t1100 = t88*t339
      t1117 = -0.5862637881547585D-1*t215*t1041+0.6848438000915295D0
     #*t628*t363*t844+0.7989844334401178D0*t203*t339*t347*t91
     #+0.4690110305238068D0*t652*t845-0.1712109500228824D0*t203*t84
     #*t1031*t91-0.5862637881547585D-1*t215*t1033+0.3424219000457648D0
     #*t623*t1085*t573+0.1331640722400196D1*t105*t80*t738
     #-0.1712109500228824D0*t203*t1085*t91+0.547179535611108D0*t215
     #*t841+0.1027265700137294D1*t105*t639*t752+0.1597968866880236D1
     #*t105*t1100*t331-0.3424219000457648D0*t105*t208*t770
     #+0.1758791364464276D0*t649*t1038+0.7751710087824029D0*t111*t1046
     #+0.5862637881547585D0*t111*t1049+0.1094359071222216D1*t111*t1053
     #-0.1172527576309517D0*t111*t1056
      s1 = 0.1484134046134546D0*t717*t718+t727-0.2473556743557577D-1
     #*t79*t728*t673-0.4666666666666667D1*t401*t408+0.2D1*t400*t331
     #*t141+0.7777777777777778D1*t133*sigma*t738*t140+0.1D1*t411*t84
     #*t743*t140-0.4666666666666667D1*t411*t339*t421*t140+0.1D1*t411
     #*t84*(-0.522423459704672D1*t752*t136*sigma+0.2786258451758251D2
     #*t756*t413-0.522423459704672D1*t412*sigma*t770
     #-0.2554070247445063D2*t78*t100*sigma)*t140+0.2D1*t782*t423
      t1126 = s1-0.4666666666666667D1*t404*t408+0.2D1*t401*sigma*t423
     #+0.1D1*(0.1D-2*(-0.3207349893614542D1*t792+0.9622049680843627D1
     #*t794-0.6318986292200858D-3*t798+0.3791391775320515D-2*t800)
     #*t129-0.2D-2*t388*t392*t397+0.2D-2*t124/t391/t128*t811-0.1D-2
     #*t393*(-0.1202514962692326D1*t792+0.3607544888076978D1*t794
     #-0.4036488739909061D-1*t798+0.2421893243945437D0*t800
     #+0.3527987623518044D-1*t762))*t77*t141+0.1D1*t132*t770*t141
     #+0.2473556743557577D-1*t79*(0.2697586091519874D1*t1059*t115
     #-0.5395172183039748D1*t1062*t379+0.5395172183039748D1*t618*t1065
     #-0.2697586091519874D1*t201*t1117)*t225+0.1484134046134546D0*t546
     #*t752-t854+t874+t882+t932
      t1130 = -t985+t990-t992+t995-t997+t1000-t1003-t1007-t1009+t1014
     #-t1019
      t1133 = rho*(t1126+t946-t947-t957+0.7420670230672731D-1*t164
     #*t770-t969+t970+t972-t976-t978+t982+t1130)
      t1137 = 0.1519829941480611D0*t33*t149*t46*t234
      t1139 = t33*t154*t234
      t1140 = 0.6079319765922445D0*t1139
      t1151 = -0.4444444444444444D0*t520*t35*t762-0.1333333333333333D1
     #*t38*t242-0.4444444444444444D0*t523*t35*t762
     #+0.1333333333333333D1*t42*t242
      t1154 = 0.3799574853701528D-1*t33*t1151*t52
      t1157 = 0.1923661050931536D1*t315*t149*t50
      t1158 = t316*t161
      t1159 = 0.7694644203726145D1*t1158
      t1162 = 0.1923661050931536D1*t69*t1151*t50
      t1164 = t70*t153*t234
      t1165 = 0.3077857681490458D2*t1164
      t1169 = 0.8740794299481065D-3*t243*t32*t149*t52
      t1172 = t241*t987*t267*t153
      t1173 = 0.3496317719792426D-2*t1172
      t1175 = t279*t281*t161
      t1176 = 0.4499999826732431D1*t1175
      t1180 = 0.1124999956683108D1*t279*t280*t149*t52
      t1183 = t33*t291*t153*t49
      t1184 = 0.1519829941480611D0*t1183
      t1186 = 0.7694644203726145D1*t158*t322
      t1189 = t1137+t1140+t1154+t1157+t1159+t1162-t1165-t1169+t1173
     #+t1176-t1180-t1184-t1186+0.7420670230672731D-1*t717*t551
      t1200 = 0.1111111111111111D0*t554*t35*t762-0.3333333333333333D0
     #*t165*t242+0.1111111111111111D0*t557*t35*t762
     #+0.3333333333333333D0*t168*t242
      t1202 = 0.7420670230672731D-1*t164*t1200
      t1204 = 0.7420670230672731D-1*t550*t718
      t1205 = t319*t161
      t1206 = 0.7694644203726145D1*t1205
      t1207 = t331*t171
      t1209 = 0.1484134046134546D0*t546*t1207
      t1212 = 0.2473556743557577D-1*t383*t673*t223
      t1229 = 0.1D1*t400*t171*t141
      t1231 = 0.2333333333333333D1*t228*t408
      t1234 = 0.1D1*t132*t1200*t141
      t1235 = t404*t94
      t1236 = t171*t140
      t1238 = t1235*t681*t1236
      t1242 = t232*t987*t171*t140
      t1245 = t400*t78*t94
      t1247 = 0.522423459704672D1*t1245*t236
      t1248 = t228*sigma
      t1250 = 0.1D1*t1248*t423
      t1251 = t234*t421
      t1254 = 0.522423459704672D1*t232*t1251*t1236
      t1255 = t334*t171
      t1264 = t573*t185
      t1265 = t348*t1264
      t1268 = t348*t578
      t1271 = -t1169+t1173-t1180+t1176+t1154-t1184+t1137+t1140+t1157
     #+t1159+t1162+t1206-t1186-t1165
      t1282 = -0.4042761511756372D2*t1271*t88+0.1212828453526912D3
     #*t1024*t171+0.1212828453526912D3*t585*t331-0.4851313814107647D3
     #*t588*t1207+0.1212828453526912D3*t182*t1200
      t1284 = t100*t1282*t91
      t1287 = t185*t91
      t1288 = t348*t1287
      t1291 = t100*t331
      t1292 = t1291*t1287
      t1295 = t95*t602
      t1296 = t1291*t171
      t1299 = t192*t1200
      t1303 = t356*t185*t91
      t1306 = t1052*t171
      t1309 = 0.3808092365862222D0*t563*t1255-0.1269364121954074D0
     #*t174*t84*t1200+0.296184961789284D0*t174*t339*t171
     #+0.2173290372447189D-1*t215*t1265+0.4346580744894379D-1*t577
     #*t1268-0.1086645186223595D-1*t178*t1284-0.1086645186223595D-1
     #*t178*t1288+0.4346580744894379D-1*t577*t1292
     #+0.2173290372447189D0*t1295*t1296-0.4346580744894379D-1*t95
     #*t1299+0.5071010869043442D-1*t178*t1303+0.2028404347617377D0*t95
     #*t1306
      t1335 = t105*t97
      t1358 = t111*t602
      t1367 = 0.3424219000457648D0*t623*t363*t1264
     #+0.3424219000457648D0*t628*t363*t578-0.1712109500228824D0*t203
     #*t84*t1282*t91-0.1712109500228824D0*t203*t363*t1287
     #+0.3424219000457648D0*t628*t334*t1287+0.1027265700137294D1*t1335
     #*t1255-0.3424219000457648D0*t105*t208*t1200+0.3994922167200589D0
     #*t203*t339*t185*t91+0.7989844334401178D0*t105*t1100*t171
     #+0.1758791364464276D0*t649*t1265+0.2345055152619034D0*t652*t1268
     #-0.5862637881547585D-1*t215*t1284-0.5862637881547585D-1*t215
     #*t1288+0.2345055152619034D0*t652*t1292+0.5862637881547585D0
     #*t1358*t1296-0.1172527576309517D0*t111*t1299+0.273589767805554D0
     #*t215*t1303+0.547179535611108D0*t111*t1306
      t1373 = 0.2473556743557577D-1*t79*(0.2697586091519874D1*t1309
     #*t115-0.2697586091519874D1*t1062*t220-0.2697586091519874D1*t613
     #*t379+0.5395172183039748D1*t618*t379*t220-0.2697586091519874D1
     #*t201*t1367)*t225
      t1374 = t1202+t1204+t1206+t1209-t1212+0.1D1*t411*t84*(
     #-0.522423459704672D1*t171*t136*t413-0.522423459704672D1*t412
     #*sigma*t1200+0.1393129225879125D2*t756*sigma*t171)*t140+t1229
     #-t1231+t1234-0.522423459704672D1*t1238+0.1218988072644235D2
     #*t1242-t1247+t1250-t1254+t1373
      t1376 = rho*(t1189+t1374)
      t1383 = t1202+t1204+t1206+t1209-t1212+t1229-t1231+t1234
     #-0.1044846919409344D2*t1238+0.261211729852336D2*t1242-t1247
     #+t1250-t1254-0.522423459704672D1*t232*t234*t1200*t140+t1373
      t1385 = rho*(t1189+t1383)
      t1386 = t706+t707+t708-t709-t710-t711+t712-t713+t714+t715+t716
     #+t1133+t1376+t1385
      v2rhoa2(i) = t705+t1386
      t1392 = -0.1538928840745229D2*t162+t516+t517
     #+0.4947113487115154D-1*t475+0.3039659882961223D0*t156+0.2D1*t478
     #-0.1044846919409344D2*t482+t701+t702+t706+t707+t708-t709
      t1394 = t225*t437
      t1396 = 0.7420670230672731D-1*t717*t1394
      t1397 = 0.6079319765922445D0*t1139
      t1398 = 0.7694644203726145D1*t1158
      t1399 = 0.3077857681490458D2*t1164
      t1400 = t673*t473
      t1402 = 0.2473556743557577D-1*t383*t1400
      t1403 = 0.3496317719792426D-2*t1172
      t1404 = 0.4499999826732431D1*t1175
      t1405 = 0.1519829941480611D0*t1183
      t1406 = -t1200
      t1412 = 0.7420670230672731D-1*t164*t1406
      t1415 = t232*t987*t437*t140
      t1418 = 0.2333333333333333D1*t477*t408
      t1419 = t437*t140
      t1420 = t681*t1419
      t1421 = t1235*t1420
      t1423 = t477*sigma
      t1425 = 0.1D1*t1423*t423
      t1426 = t1396-t1397-t1398+t1399-t1402-t1403-t1404+t1405
     #-0.522423459704672D1*t232*t234*t1406*t140+t1412
     #+0.261211729852336D2*t1415-t1418-0.1044846919409344D2*t1421+t1425
      t1430 = 0.7694644203726145D1*t1205
      t1433 = t334*t437
      t1442 = t573*t448
      t1443 = t348*t1442
      t1446 = t91*t437
      t1447 = t348*t1446
      t1453 = 0.8740794299481065D-3*t243*t32*t428*t52
      t1457 = 0.1124999956683108D1*t279*t280*t428*t52
      t1458 = -t1151
      t1461 = 0.3799574853701528D-1*t33*t1458*t52
      t1465 = 0.1519829941480611D0*t33*t428*t46*t234
      t1468 = 0.1923661050931536D1*t315*t428*t50
      t1471 = 0.1923661050931536D1*t69*t1458*t50
      t1473 = 0.7694644203726145D1*t433*t322
      t1474 = -t1453-t1403-t1457-t1404+t1461+t1405+t1465-t1397+t1468
     #-t1398+t1471-t1430-t1473+t1399
      t1479 = t443*t97
      t1482 = t331*t437
      t1487 = -0.4042761511756372D2*t1474*t88+0.1212828453526912D3
     #*t1024*t437+0.1212828453526912D3*t1479*t331-0.4851313814107647D3
     #*t588*t1482+0.1212828453526912D3*t182*t1406
      t1489 = t100*t1487*t91
      t1492 = t448*t91
      t1493 = t348*t1492
      t1496 = t1291*t1492
      t1499 = t1291*t437
      t1502 = t192*t1406
      t1506 = t356*t448*t91
      t1509 = t1052*t437
      t1512 = 0.3808092365862222D0*t563*t1433-0.1269364121954074D0
     #*t174*t84*t1406+0.296184961789284D0*t174*t339*t437
     #+0.2173290372447189D-1*t215*t1443+0.4346580744894379D-1*t577
     #*t1447-0.1086645186223595D-1*t178*t1489-0.1086645186223595D-1
     #*t178*t1493+0.4346580744894379D-1*t577*t1496
     #+0.2173290372447189D0*t1295*t1499-0.4346580744894379D-1*t95
     #*t1502+0.5071010869043442D-1*t178*t1506+0.2028404347617377D0*t95
     #*t1509
      t1517 = t456*t200
      t1569 = 0.3424219000457648D0*t623*t363*t1442
     #+0.3424219000457648D0*t628*t363*t1446-0.1712109500228824D0*t203
     #*t84*t1487*t91-0.1712109500228824D0*t203*t363*t1492
     #+0.3424219000457648D0*t628*t334*t1492+0.1027265700137294D1*t1335
     #*t1433-0.3424219000457648D0*t105*t208*t1406+0.3994922167200589D0
     #*t203*t339*t448*t91+0.7989844334401178D0*t105*t1100*t437
     #+0.1758791364464276D0*t649*t1443+0.2345055152619034D0*t652*t1447
     #-0.5862637881547585D-1*t215*t1489-0.5862637881547585D-1*t215
     #*t1493+0.2345055152619034D0*t652*t1496+0.5862637881547585D0
     #*t1358*t1499-0.1172527576309517D0*t111*t1502+0.273589767805554D0
     #*t215*t1506+0.547179535611108D0*t111*t1509
      t1578 = t78*t473
      t1587 = 0.1D1*t132*t1406*t141-t1430-0.522423459704672D1*t1245
     #*t481+0.2473556743557577D-1*t79*(0.2697586091519874D1*t1512*t115
     #-0.2697586091519874D1*t1062*t470-0.2697586091519874D1*t1517*t379
     #+0.5395172183039748D1*t618*t379*t470-0.2697586091519874D1*t201
     #*t1569)*t225+0.1484134046134546D0*t546*t1482
     #+0.7420670230672731D-1*t1578*t718-0.522423459704672D1*t232*t1251
     #*t1419+t1461+t1468+t1471-t1473+0.1D1*t400*t437*t141-t1453-t1457
     #+t1465
      t1589 = rho*(t1426+t1587)
      t1608 = t1396-t1397-t1398+t1399-t1402-t1403-t1404+t1405+t1412
     #+0.1218988072644235D2*t1415-t1418-0.522423459704672D1*t1421
     #+0.1D1*t411*t84*(-0.522423459704672D1*t437*t136*t413
     #-0.522423459704672D1*t412*sigma*t1406+0.1393129225879125D2*t756
     #*sigma*t437)*t140+t1425
      t1610 = rho*(t1608+t1587)
      t1613 = t33*t428*t153*t49
      t1614 = 0.3039659882961223D0*t1613
      t1615 = t433*t161
      t1616 = 0.1538928840745229D2*t1615
      t1617 = t437**2
      t1625 = t448**2
      t1626 = t100*t1625
      t1627 = t1626*t573
      t1630 = t449*t1446
      t1640 = -0.4042761511756372D2*(t529+t1614-t537+t540-t1616+t545)
     #*t88+0.2425656907053823D3*t1479*t437-0.4851313814107647D3*t588
     #*t1617+t592
      t1642 = t100*t1640*t91
      t1645 = t1626*t91
      t1648 = t603*t1617
      t1656 = t470**2
      t1659 = t84*t1625
      t1686 = 0.3424219000457648D0*t623*t1659*t573
     #+0.6848438000915295D0*t628*t459*t1446-0.1712109500228824D0*t203
     #*t84*t1640*t91-0.1712109500228824D0*t203*t1659*t91
     #+0.1027265700137294D1*t105*t639*t1617-t645+0.1758791364464276D0
     #*t649*t1627+0.4690110305238068D0*t652*t1630
     #-0.5862637881547585D-1*t215*t1642-0.5862637881547585D-1*t215
     #*t1645+0.5862637881547585D0*t111*t1648-t662
      t1693 = t473**2
      t1705 = t529+t1614-t537+t540-t1616+t545+0.1484134046134546D0
     #*t546*t1617+0.1484134046134546D0*t1578*t1394+t562
     #+0.2473556743557577D-1*t79*(0.2697586091519874D1*
     #(0.3808092365862222D0*t563*t84*t1617-t569+0.2173290372447189D-1
     #*t215*t1627+0.8693161489788758D-1*t577*t1630
     #-0.1086645186223595D-1*t178*t1642-0.1086645186223595D-1*t178
     #*t1645+0.2173290372447189D0*t95*t1648-t609)*t115
     #-0.5395172183039748D1*t1517*t470+0.5395172183039748D1*t618*t1656
     #-0.2697586091519874D1*t201*t1686)*t225-0.2473556743557577D-1*t79
     #*t1693*t673+t678-0.1567270379114016D2*t132*t1617*t94*t682-t688
     #+0.272926271249799D2*t690*t693*t1617*t140
      t1707 = -t710-t711+t712+0.1484134046134546D0*t438+t1589-t713
     #+0.7599149707403056D-1*t430+0.3847322101863073D1*t434+t714+t715
     #+t716+t1610+t1133+rho*t1705
      v2rhob2(i) = t1392+t1707
      t1708 = -t526
      t1711 = 0.3799574853701528D-1*t33*t1708*t52
      t1712 = 0.1519829941480611D0*t532
      t1713 = 0.1519829941480611D0*t1613
      t1714 = 0.4559489824441834D0*t536
      t1717 = 0.1923661050931536D1*t69*t1708*t50
      t1718 = 0.7694644203726145D1*t541
      t1719 = 0.7694644203726145D1*t1615
      t1720 = 0.2308393261117844D2*t544
      t1721 = t171*t437
      t1726 = -t560
      t1731 = t175*t437
      t1737 = t186*t1442
      t1740 = t186*t1446
      t1754 = -0.4042761511756372D2*(t1711+t1712-t1713+t1714+t1717
     #-t1718+t1719-t1720)*t88+0.1212828453526912D3*t585*t437
     #+0.1212828453526912D3*t1479*t171-0.4851313814107647D3*t588*t1721
     #+0.1212828453526912D3*t182*t1726
      t1756 = t100*t1754*t91
      t1759 = t186*t1492
      t1762 = t100*t171
      t1763 = t1762*t1492
      t1766 = t1762*t437
      t1769 = t192*t1726
      t1817 = 0.3424219000457648D0*t623*t204*t1442
     #+0.3424219000457648D0*t628*t204*t1446-0.1712109500228824D0*t203
     #*t84*t1754*t91-0.1712109500228824D0*t203*t204*t1492
     #+0.3424219000457648D0*t628*t175*t1492+0.1027265700137294D1*t1335
     #*t1731-0.3424219000457648D0*t105*t208*t1726+0.1758791364464276D0
     #*t649*t1737+0.2345055152619034D0*t652*t1740
     #-0.5862637881547585D-1*t215*t1756-0.5862637881547585D-1*t215
     #*t1759+0.2345055152619034D0*t652*t1763+0.5862637881547585D0
     #*t1358*t1766-0.1172527576309517D0*t111*t1769
      t1836 = t693*t171
      s1 = t1711+t1712-t1713+t1714+t1717-t1718+t1719-t1720
     #+0.1484134046134546D0*t546*t1721
      s2 = s1+0.7420670230672731D-1*t1578*t551+0.7420670230672731D-1
     #*t164*t1726+0.7420670230672731D-1*t550*t1394
     #+0.2473556743557577D-1*t79*(0.2697586091519874D1*
     #(0.3808092365862222D0*t563*t1731-0.1269364121954074D0*t174*t84
     #*t1726+0.2173290372447189D-1*t215*t1737+0.4346580744894379D-1
     #*t577*t1740-0.1086645186223595D-1*t178*t1756
     #-0.1086645186223595D-1*t178*t1759+0.4346580744894379D-1*t577
     #*t1763+0.2173290372447189D0*t1295*t1766-0.4346580744894379D-1
     #*t95*t1769)*t115-0.2697586091519874D1*t613*t470
     #-0.2697586091519874D1*t1517*t220+0.5395172183039748D1*t618*t220
     #*t470-0.2697586091519874D1*t201*t1817)*t225
      t1840 = s2-0.2473556743557577D-1*t224*t1400+0.1D1*t132*t1726
     #*t141-0.1567270379114016D2*t228*t94*t1420-0.522423459704672D1
     #*t232*t234*t1726*t140+0.272926271249799D2*t690*t1836*t1419
      t1842 = t152+t160+t516+t517+t173+rho*t1840+t476+t479-t483+t227
     #+t701+t702+t230-t238+t706+t707
      t1847 = t708-t709-t710-t711+t712+t439+0.5D0*t1589-t713+t431+t435
     #+t714+t715+t716+0.5D0*t1610+t1133+0.5D0*t1376+0.5D0*t1385
      v2rhoab(i) = t1842+t1847
      t1848 = t78*t500
      t1852 = t202*t97
      t1862 = t489*t200
      t1868 = t110*t80
      t1871 = t93*t88
      t1874 = t622*t97
      t1886 = t673*t500
      t1892 = t234*t78*t140
      t1896 = t132*t96*t94
      t1901 = rho*(0.7420670230672731D-1*t1848*t551
     #+0.2473556743557577D-1*t79*(0.2697586091519874D1*(
     #-0.1269364121954074D0*t209-0.2173290372447189D-1*t1852*t187
     #-0.8693161489788758D-1*t105*t193)*t115-0.2697586091519874D1*t613
     #*t497-0.2697586091519874D1*t1862*t220+0.5395172183039748D1*t618
     #*t220*t497-0.2697586091519874D1*t201*(-0.1712109500228824D0
     #*t1868*t205-0.3424219000457648D0*t1871*t175-0.1172527576309517D0
     #*t1874*t187-0.2345055152619034D0*t202*t193))*t225
     #-0.2473556743557577D-1*t224*t1886+0.1D1*t228*t504
     #-0.130605864926168D2*t1248*t1892+0.1364631356248995D2*t1896
     #*t1836*t140)
      s1 = 0.7420670230672731D-1*t1848*t718+0.2473556743557577D-1*t79*
     #(0.2697586091519874D1*(-0.1269364121954074D0*t367
     #-0.148092480894642D0*t370-0.2173290372447189D-1*t1852*t349
     #-0.8693161489788758D-1*t105*t352-0.1014202173808688D0*t105*t357)
     #*t115-0.2697586091519874D1*t1062*t497-0.2697586091519874D1*t1862
     #*t379+0.5395172183039748D1*t618*t379*t497-0.2697586091519874D1
     #*t201*(-0.1712109500228824D0*t1868*t364-0.3424219000457648D0
     #*t1871*t334-0.3994922167200589D0*t492*t339-0.1172527576309517D0
     #*t1874*t349-0.2345055152619034D0*t202*t352-0.273589767805554D0
     #*t202*t357))*t225-0.2473556743557577D-1*t383*t1886+0.1D1*t401
     #*t504-0.261211729852336D1*t400*t79*t509+0.1D1*t404*t504
      t1973 = s1-0.261211729852336D1*t782*t1892-0.2333333333333333D1
     #*t133*t339*t140+0.6094940363221173D1*t507*sigma*t987*t140+0.1D1
     #*t133*t423+0.1D1*t411*t84*(-0.522423459704672D1*t412*t331
     #+0.6965646129395627D1*t418)*t140-0.261211729852336D1*t507*sigma
     #*t1251*t140
      t1974 = rho*t1973
      v2rhoasigmaaa(i) = t1901+t503+t506-t511+t1974
      t1976 = 0.4947113487115154D-1*t502
      t1977 = 0.2D1*t505
      t1978 = 0.522423459704672D1*t510
      t1979 = 2.D0*t1974
      v2rhoasigmaab(i) = 2.D0*t1901+t1976+t1977-t1978+t1979
      v2rhoasigmabb(i) = v2rhoasigmaaa(i)
      t2023 = rho*(0.7420670230672731D-1*t1848*t1394
     #+0.2473556743557577D-1*t79*(0.2697586091519874D1*(
     #-0.1269364121954074D0*t463-0.2173290372447189D-1*t1852*t450
     #-0.8693161489788758D-1*t105*t453)*t115-0.2697586091519874D1
     #*t1517*t497-0.2697586091519874D1*t1862*t470+0.5395172183039748D1
     #*t618*t470*t497-0.2697586091519874D1*t201*(-0.1712109500228824D0
     #*t1868*t460-0.3424219000457648D0*t1871*t440-0.1172527576309517D0
     #*t1874*t450-0.2345055152619034D0*t202*t453))*t225
     #-0.2473556743557577D-1*t474*t1886+0.1D1*t477*t504
     #-0.130605864926168D2*t1423*t1892+0.1364631356248995D2*t1896*t693
     #*t437*t140)
      v2rhobsigmaaa(i) = t2023+t503+t506-t511+t1974
      v2rhobsigmaab(i) = 2.D0*t2023+t1976+t1977-t1978+t1979
      v2rhobsigmabb(i) = v2rhobsigmaaa(i)
      t2031 = t497**2
      t2042 = t500**2
      v2sigmaaa2(i) = rho*(0.2473556743557577D-1*t79*
     #(0.5862637881547585D-1*t93*t97*t100*t115-0.5395172183039748D1
     #*t1862*t497+0.5395172183039748D1*t618*t2031-0.1581497040888031D0
     #*t201*t110*t97*t100)*t225-0.2473556743557577D-1*t79*t2042*t673
     #-0.522423459704672D1*t507*t234*t140+0.6823156781244976D1*t132
     #*t190*sigma*t693*t140)
      v2sigmaaaab(i) = 2.D0*v2sigmaaa2(i)
      v2sigmaaabb(i) = v2sigmaaa2(i)
      v2sigmaab2(i) = 4.D0*v2sigmaaabb(i)
      v2sigmaabbb(i) = v2sigmaaaab(i)
      v2sigmabb2(i) = v2sigmaaabb(i)
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      v2rhob2(i) = 0.0d0
      v2rhoab(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2rhoasigmaab(i) = 0.0d0
      v2rhoasigmabb(i) = 0.0d0
      v2rhobsigmaaa(i) = 0.0d0
      v2rhobsigmaab(i) = 0.0d0
      v2rhobsigmabb(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      v2sigmaab2(i) = 0.0d0
      v2sigmabb2(i) = 0.0d0
      v2sigmaaaab(i) = 0.0d0
      v2sigmaaabb(i) = 0.0d0
      v2sigmaabbb(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end
      
      
      subroutine rks_c_pw91
     & (ideriv,npt,rhoa1,sigmaaa1,
     &  zk,vrhoa,vsigmaaa,
     &  v2rhoa2,v2rhoasigmaaa,v2sigmaaa2)
c
c     J.P. Perdew, J.A. Chevary, S.H. Vosko, K.A. Jackson, 
c     M.R. Pederson, D.J. Singh, C. Fiolhais
c     Atoms, molecules, solids and surfaces: 
c     Applications of the generalized gradient approximation 
c     for exchange and correlation
c     Phys. Rev. B 46 (1992) 6671--6687
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt)
      REAL sigmaaa1(npt)
      REAL zk(npt),vrhoa(npt),vsigmaaa(npt)
      REAL v2rhoa2(npt),v2rhoasigmaaa(npt),v2sigmaaa2(npt)
      parameter(tol=1.0d-20)
      
      if(ideriv.eq.0) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = 1/rho
      t3 = t2**(1.D0/3.D0)
      t6 = t2**(1.D0/6.D0)
      t9 = dsqrt(t2)
      t11 = t3**2
      t17 = dlog(1.D0+0.160818243221511D2/(0.598255043577108D1*t6
     #+0.2225569421150687D1*t3+0.8004286349993634D0*t9
     #+0.1897004325747559D0*t11))
      t18 = (1.D0+0.1325688999052018D0*t3)*t17
      t20 = rho**2
      t21 = rho**(1.D0/3.D0)
      t23 = 1/t21/t20
      t27 = dexp(0.2513869963240348D1*t18)
      t28 = t27-1.D0
      t29 = 1/t28
      t30 = sigma**2
      t32 = t20**2
      t33 = t21**2
      t35 = 1/t33/t32
      t42 = t28**2
      t52 = dlog(1.D0+0.2697586091519874D1*(0.634682060977037D-1*sigma
     #*t23+0.1086645186223595D-1*t29*t30*t35)/(1.D0
     #+0.1712109500228824D0*t29*sigma*t23+0.2931318940773793D-1/t42
     #*t30*t35))
      t70 = dexp(-0.261211729852336D1/t33/t20*sigma)
      zk(i) = rho*(-0.62182D-1*t18+0.2473556743557577D-1*t52+0.1D1*
     #(0.1D-2*(0.2568D1+0.1443307452126544D2*t3+0.2843543831490386D-2
     #*t11)/(1.D0+0.5411317332115466D1*t3+0.1816419932959077D0*t11
     #+0.1763993811759022D-1*t2)-0.1853571428571429D-2)*sigma*t23*t70)
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = 1/rho
      t3 = t2**(1.D0/3.D0)
      t5 = 1.D0+0.1325688999052018D0*t3
      t6 = t2**(1.D0/6.D0)
      t9 = dsqrt(t2)
      t11 = t3**2
      t13 = 0.598255043577108D1*t6+0.2225569421150687D1*t3
     #+0.8004286349993634D0*t9+0.1897004325747559D0*t11
      t16 = 1.D0+0.160818243221511D2/t13
      t17 = dlog(t16)
      t18 = t5*t17
      t19 = 0.62182D-1*t18
      t20 = rho**2
      t21 = rho**(1.D0/3.D0)
      t23 = 1/t21/t20
      t27 = dexp(0.2513869963240348D1*t18)
      t28 = t27-1.D0
      t29 = 1/t28
      t30 = sigma**2
      t31 = t29*t30
      t32 = t20**2
      t33 = t21**2
      t35 = 1/t33/t32
      t38 = 0.634682060977037D-1*sigma*t23+0.1086645186223595D-1*t31*t35
      t39 = t29*sigma
      t42 = t28**2
      t43 = 1/t42
      t44 = t43*t30
      t47 = 1.D0+0.1712109500228824D0*t39*t23+0.2931318940773793D-1
     #*t44*t35
      t48 = 1/t47
      t51 = 1.D0+0.2697586091519874D1*t38*t48
      t52 = dlog(t51)
      t53 = 0.2473556743557577D-1*t52
      t56 = 0.2568D1+0.1443307452126544D2*t3+0.2843543831490386D-2*t11
      t60 = 1.D0+0.5411317332115466D1*t3+0.1816419932959077D0*t11
     #+0.1763993811759022D-1*t2
      t61 = 1/t60
      t64 = 0.1D-2*t56*t61-0.1853571428571429D-2
      t65 = t64*sigma
      t70 = dexp(-0.261211729852336D1/t33/t20*sigma)
      t71 = t23*t70
      t73 = 0.1D1*t65*t71
      zk(i) = rho*(-t19+t53+t73)
      t76 = 1/t20
      t77 = 1/t11*t76
      t78 = t77*t17
      t80 = t13**2
      t83 = t6**2
      t84 = t83**2
      t94 = 1/t3*t76
      t99 = t5/t80*(-0.99709173929518D0/t84/t6*t76
     #-0.7418564737168958D0*t77-0.4002143174996817D0/t9*t76
     #-0.1264669550498372D0*t94)/t16
      t103 = 1/t21/t20/rho
      t108 = -0.1110869918438343D0*t78-0.4042761511756372D2*t99
      t110 = t35*t108*t27
      t113 = t32*rho
      t115 = 1/t33/t113
      t121 = t47**2
      t123 = t38/t121
      t124 = t43*sigma
      t142 = 1/t51
      t150 = t60**2
      vrhoa(i) = -t19+t53+t73+rho*(0.2747799777968419D-2*t78+0.1D1*t99
     #+0.2473556743557577D-1*(0.2697586091519874D1*(
     #-0.148092480894642D0*sigma*t103-0.1086645186223595D-1*t44*t110
     #-0.5071010869043442D-1*t31*t115)*t48-0.2697586091519874D1*t123*(
     #-0.1712109500228824D0*t124*t23*t108*t27-0.3994922167200589D0*t39
     #*t103-0.5862637881547585D-1/t42/t28*t30*t110-0.136794883902777D0
     #*t44*t115))*t142+0.1D1*(0.1D-2*(-0.4811024840421814D1*t77
     #-0.1895695887660258D-2*t94)*t61-0.1D-2*t56/t150*(
     #-0.1803772444038489D1*t77-0.1210946621972718D0*t94
     #-0.1763993811759022D-1*t76))*sigma*t71-0.2333333333333333D1*t65
     #*t103*t70+0.6965646129395627D1*t64*t30/t32/t20*t70)
      vsigmaaa(i) = 4.D0*rho*(0.2473556743557577D-1*
     #(0.2697586091519874D1*(0.634682060977037D-1*t23
     #+0.2173290372447189D-1*t39*t35)*t48-0.2697586091519874D1*t123*
     #(0.1712109500228824D0*t29*t23+0.5862637881547585D-1*t124*t35))
     #*t142+0.1D1*t64*t23*t70-0.261211729852336D1*t65/t113*t70)
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = 1/rho
      t3 = t2**(1.D0/3.D0)
      t5 = 1.D0+0.1325688999052018D0*t3
      t6 = t2**(1.D0/6.D0)
      t9 = dsqrt(t2)
      t11 = t3**2
      t13 = 0.598255043577108D1*t6+0.2225569421150687D1*t3
     #+0.8004286349993634D0*t9+0.1897004325747559D0*t11
      t16 = 1.D0+0.160818243221511D2/t13
      t17 = dlog(t16)
      t18 = t5*t17
      t19 = 0.62182D-1*t18
      t20 = rho**2
      t21 = rho**(1.D0/3.D0)
      t23 = 1/t21/t20
      t27 = dexp(0.2513869963240348D1*t18)
      t28 = t27-1.D0
      t29 = 1/t28
      t30 = sigma**2
      t31 = t29*t30
      t32 = t20**2
      t33 = t21**2
      t35 = 1/t33/t32
      t38 = 0.634682060977037D-1*sigma*t23+0.1086645186223595D-1*t31*t35
      t39 = t29*sigma
      t42 = t28**2
      t43 = 1/t42
      t44 = t43*t30
      t47 = 1.D0+0.1712109500228824D0*t39*t23+0.2931318940773793D-1
     #*t44*t35
      t48 = 1/t47
      t51 = 1.D0+0.2697586091519874D1*t38*t48
      t52 = dlog(t51)
      t53 = 0.2473556743557577D-1*t52
      t56 = 0.2568D1+0.1443307452126544D2*t3+0.2843543831490386D-2*t11
      t60 = 1.D0+0.5411317332115466D1*t3+0.1816419932959077D0*t11
     #+0.1763993811759022D-1*t2
      t61 = 1/t60
      t64 = 0.1D-2*t56*t61-0.1853571428571429D-2
      t65 = t64*sigma
      t70 = dexp(-0.261211729852336D1/t33/t20*sigma)
      t71 = t23*t70
      t73 = 0.1D1*t65*t71
      zk(i) = rho*(-t19+t53+t73)
      t75 = 1/t11
      t76 = 1/t20
      t77 = t75*t76
      t78 = t77*t17
      t80 = t13**2
      t81 = 1/t80
      t82 = t5*t81
      t83 = t6**2
      t84 = t83**2
      t85 = t84*t6
      t86 = 1/t85
      t90 = 1/t9
      t93 = 1/t3
      t94 = t93*t76
      t96 = -0.99709173929518D0*t86*t76-0.7418564737168958D0*t77
     #-0.4002143174996817D0*t90*t76-0.1264669550498372D0*t94
      t97 = 1/t16
      t99 = t82*t96*t97
      t101 = t20*rho
      t103 = 1/t21/t101
      t108 = -0.1110869918438343D0*t78-0.4042761511756372D2*t99
      t110 = t35*t108*t27
      t113 = t32*rho
      t115 = 1/t33/t113
      t118 = -0.148092480894642D0*sigma*t103-0.1086645186223595D-1*t44
     #*t110-0.5071010869043442D-1*t31*t115
      t121 = t47**2
      t122 = 1/t121
      t123 = t38*t122
      t124 = t43*sigma
      t132 = 1/t42/t28
      t133 = t132*t30
      t138 = -0.1712109500228824D0*t124*t23*t108*t27
     #-0.3994922167200589D0*t39*t103-0.5862637881547585D-1*t133*t110
     #-0.136794883902777D0*t44*t115
      t141 = 0.2697586091519874D1*t118*t48-0.2697586091519874D1*t123
     #*t138
      t142 = 1/t51
      t143 = t141*t142
      t147 = -0.4811024840421814D1*t77-0.1895695887660258D-2*t94
      t150 = t60**2
      t151 = 1/t150
      t152 = t56*t151
      t156 = -0.1803772444038489D1*t77-0.1210946621972718D0*t94
     #-0.1763993811759022D-1*t76
      t159 = 0.1D-2*t147*t61-0.1D-2*t152*t156
      t160 = t159*sigma
      t161 = t160*t71
      t163 = t103*t70
      t164 = t65*t163
      t166 = t64*t30
      t167 = t32*t20
      t169 = 1/t167*t70
      t170 = t166*t169
      vrhoa(i) = -t19+t53+t73+rho*(0.2747799777968419D-2*t78+0.1D1*t99
     #+0.2473556743557577D-1*t143+0.1D1*t161-0.2333333333333333D1*t164
     #+0.6965646129395627D1*t170)
      t177 = 0.634682060977037D-1*t23+0.2173290372447189D-1*t39*t35
      t184 = 0.1712109500228824D0*t29*t23+0.5862637881547585D-1*t124*t35
      t187 = 0.2697586091519874D1*t177*t48-0.2697586091519874D1*t123
     #*t184
      t188 = t187*t142
      t191 = t64*t23*t70
      t193 = 1/t113
      t194 = t193*t70
      t195 = t65*t194
      vsigmaaa(i) = 4.D0*rho*(0.2473556743557577D-1*t188+0.1D1*t191
     #-0.261211729852336D1*t195)
      t215 = dlog(1.D0+0.2960857464321668D2/(0.8157414703487641D1*t6
     #+0.2247591863577616D1*t3+0.4300972471276643D0*t9
     #+0.1911512595127338D0*t11))
      t217 = (1.D0+0.6901399211255825D-1*t3)*t215*t76
      t219 = t52*t76
      t222 = 1/t21/t32
      t223 = sigma*t222
      t228 = 0.1365402220407279D1*t217-0.1675913308826898D1*t18*t76
      t230 = t35*t228*t27
      t234 = 1/t33/t167
      t235 = t31*t234
      t244 = t39*t222
      t248 = t44*t234
      t258 = t64*t222*sigma*t70
      t260 = t32*t101
      t263 = t166/t260*t70
      t270 = -t228
      t272 = t35*t270*t27
      t299 = 1/t32
      t302 = 1/t101
      t307 = 1/t11/t2*t299
      t309 = t75*t302
      t319 = 1/t3/t2*t299
      t321 = t93*t302
      t325 = t82*(-0.8309097827459833D0/t85/t2*t299
     #+0.199418347859036D1*t86*t302-0.4945709824779306D0*t307
     #+0.1483712947433792D1*t309-0.2001071587498409D0/t9/t2*t299
     #+0.8004286349993634D0*t90*t302-0.4215565168327908D-1*t319
     #+0.2529339100996745D0*t321)*t97
      t327 = t80**2
      t330 = t96**2
      t331 = t16**2
      t334 = t5/t327*t330/t331
      t336 = t309*t17
      t338 = t307*t17
      t342 = t77*t81*t96*t97
      t348 = t5/t80/t13*t330*t97
      t352 = t32**2
      t374 = t156**2
      t391 = t141**2
      t392 = t51**2
      t393 = 1/t392
      t397 = t115*t108*t27
      t406 = -0.4042761511756372D2*t325-0.6501498040842D3*t334
     #+0.2221739836876686D0*t336-0.740579945625562D-1*t338
     #+0.3572962974617552D1*t342+0.8085523023512745D2*t348
      t408 = t35*t406*t27
      t411 = t108**2
      t412 = t35*t411
      t414 = dexp(0.5027739926480695D1*t18)
      t415 = t412*t414
      t418 = t412*t27
      t426 = t118*t122
      t431 = t38/t121/t47
      t432 = t138**2
      t443 = t132*sigma
      t444 = t23*t411
      t459 = t42**2
      s1 = 0.1D1*t325+0.160818243221511D2*t334-0.5495599555936838D-2
     #*t336+0.1831866518645613D-2*t338-0.8837926660346786D-1*t342
     #-0.2D1*t348+0.4852022599996427D2*t64*t30*sigma/t33/t352/rho*t70
      s2 = s1-0.5804705107829689D2*t263+0.7777777777777778D1*t258
     #+0.1D1*(0.1D-2*(-0.3207349893614542D1*t307+0.9622049680843627D1
     #*t309-0.6318986292200858D-3*t319+0.3791391775320515D-2*t321)*t61
     #-0.2D-2*t147*t151*t156+0.2D-2*t56/t150/t60*t374-0.1D-2*t152*(
     #-0.1202514962692326D1*t307+0.3607544888076978D1*t309
     #-0.4036488739909061D-1*t319+0.2421893243945437D0*t321
     #+0.3527987623518044D-1*t302))*sigma*t71
      t473 = s2-0.4666666666666667D1*t160*t163-0.2473556743557577D-1
     #*t391*t393+0.2473556743557577D-1*(0.2697586091519874D1*
     #(0.1014202173808688D0*t44*t397-0.1086645186223595D-1*t44*t408
     #+0.2173290372447189D-1*t133*t415-0.1086645186223595D-1*t44*t418
     #+0.2873572825791284D0*t235+0.4936416029821399D0*t223)*t48
     #-0.5395172183039748D1*t426*t138+0.5395172183039748D1*t431*t432
     #-0.2697586091519874D1*t123*(-0.1712109500228824D0*t124*t23*t406
     #*t27+0.7989844334401178D0*t124*t103*t108*t27
     #+0.3424219000457648D0*t443*t444*t414-0.1712109500228824D0*t124
     #*t444*t27+0.1331640722400196D1*t244+0.547179535611108D0*t133
     #*t397-0.5862637881547585D-1*t133*t408-0.5862637881547585D-1*t133
     #*t418+0.7751710087824029D0*t248+0.1758791364464276D0/t459*t30
     #*t415))*t142+0.1393129225879125D2*t159*t30*t169
      s1 = 0.2786258451758251D2*t170-0.9333333333333333D1*t164
     #+0.9894226974230308D-1*t143+0.4D1*t161
      s2 = s1+0.1099119911187368D-1*t78+0.4D1*t99
      s3 = s2+rho*(-0.3377399869956914D-1*t217+0.1649037829038385D-1
     #*t219+0.2473556743557577D-1*(0.2697586091519874D1*(
     #-0.2820809159897942D-1*t223-0.1086645186223595D-1*t44*t230
     #-0.9659068321987509D-2*t235)*t48-0.2697586091519874D1*t123*(
     #-0.1712109500228824D0*t124*t23*t228*t27-0.760937555657255D-1
     #*t244-0.5862637881547585D-1*t133*t230-0.2605616836243371D-1*t248
     #))*t142+0.2222222222222222D0*t258-0.1160941021565938D1*t263)
      v2rhoa2(i) = s3+rho*(0.3377399869956914D-1*t217
     #-0.1649037829038385D-1*t219+0.2473556743557577D-1*
     #(0.2697586091519874D1*(0.2820809159897942D-1*t223
     #-0.1086645186223595D-1*t44*t272+0.9659068321987509D-2*t235)*t48
     #-0.2697586091519874D1*t123*(-0.1712109500228824D0*t124*t23*t270
     #*t27+0.760937555657255D-1*t244-0.5862637881547585D-1*t133*t272
     #+0.2605616836243371D-1*t248))*t142-0.2222222222222222D0*t258
     #+0.1160941021565938D1*t263)+2.D0*rho*t473
      t489 = t177*t122
      v2rhoasigmaaa(i) = 0.9894226974230308D-1*t188+0.4D1*t191
     #-0.1044846919409344D2*t195+4.D0*rho*(0.2473556743557577D-1*
     #(0.2697586091519874D1*(-0.148092480894642D0*t103
     #-0.2173290372447189D-1*t124*t110-0.1014202173808688D0*t39*t115)
     #*t48-0.2697586091519874D1*t426*t184-0.2697586091519874D1*t489
     #*t138+0.5395172183039748D1*t431*t138*t184-0.2697586091519874D1
     #*t123*(-0.1712109500228824D0*t43*t23*t108*t27
     #-0.3994922167200589D0*t29*t103-0.1172527576309517D0*t443*t110
     #-0.273589767805554D0*t124*t115))*t142-0.2473556743557577D-1*t141
     #*t393*t187+0.1D1*t159*t23*t70-0.261211729852336D1*t160*t194
     #-0.2333333333333333D1*t64*t103*t70+0.2002623262201243D2*t65*t169
     #-0.181950847499866D2*t166/t33/t352*t70)
      t537 = t184**2
      t546 = t187**2
      v2sigmaaa2(i) = 16.D0*rho*(0.2473556743557577D-1*
     #(0.5862637881547585D-1*t29*t35*t48-0.5395172183039748D1*t489
     #*t184+0.5395172183039748D1*t431*t537-0.1581497040888031D0*t123
     #*t43*t35)*t142-0.2473556743557577D-1*t546*t393
     #-0.522423459704672D1*t64*t193*t70+0.6823156781244976D1*t65/t33
     #/t260*t70)
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end

c:C_PW91subrend
_ENDIF
_IF(ccpdft,all,xc_b3lyp)
c:XC_B3LYPsubrstart

c    Generated: Thu Feb 13 08:52:41 GMT 2003

      subroutine uks_xc_b3lyp
     & (ideriv,npt,rhoa1,rhob1,sigmaaa1,sigmabb1,sigmaab1,
     &  zk,vrhoa,vrhob,vsigmaaa,vsigmabb,vsigmaab,
     &  v2rhoa2,v2rhob2,v2rhoab,
     &  v2rhoasigmaaa,v2rhoasigmaab,v2rhoasigmabb,
     &  v2rhobsigmabb,v2rhobsigmaab,v2rhobsigmaaa,
     &  v2sigmaaa2,v2sigmaaaab,v2sigmaaabb,
     &  v2sigmaab2,v2sigmaabbb,v2sigmabb2)
c
c     P.J. Stephens, F.J. Devlin, C.F. Chabalowski, M.J. Frisch
c     Ab initio calculation of vibrational absorption and circular 
c     dichroism spectra using density functional force fields
c     J. Phys. Chem. 98 (1994) 11623-11627
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt),rhob1(npt)
      REAL sigmaaa1(npt),sigmabb1(npt),sigmaab1(npt)
      REAL zk(npt),vrhoa(npt),vrhob(npt)
      REAL vsigmaaa(npt),vsigmabb(npt),vsigmaab(npt)
      REAL v2rhoa2(npt),v2rhob2(npt),v2rhoab(npt)
      REAL v2rhoasigmaaa(npt),v2rhoasigmaab(npt)
      REAL v2rhoasigmabb(npt),v2rhobsigmabb(npt)
      REAL v2rhobsigmaab(npt),v2rhobsigmaaa(npt)
      REAL v2sigmaaa2(npt),v2sigmaaaab(npt),v2sigmaaabb(npt)
      REAL v2sigmaab2(npt),v2sigmaabbb(npt),v2sigmabb2(npt)
      parameter(tol=1.0d-20)
      
      if (ideriv.eq.0) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t3 = t2*rhob
      t5 = 1/t3
      t7 = dsqrt(sigmabb)
      t8 = t7*t5
      t9 = dlog(t8+dsqrt(1+t8**2))
      t16 = 1/rhob
      t17 = t16**(1.D0/3.D0)
      t19 = t16**(1.D0/6.D0)
      t22 = 1/(0.6203504908994D0*t17+0.1584942278842832D2*t19
     #+0.101578D3)
      t25 = dlog(0.6203504908994D0*t17*t22)
      t31 = datan(0.1171685277708993D1/(0.1575246635799487D1*t19
     #+0.201231D2))
      t35 = (0.7876233178997433D0*t19+0.743294D0)**2
      t37 = dlog(t35*t22)
      zk(i) = -0.74442058907928D0*t3-0.3024D-2*t5*sigmabb/(1.D0
     #+0.252D-1*t8*t9)+0.19D0*rhob*(0.1554535D-1*t25
     #+0.6188180297906063D0*t31+0.2667310007273315D-2*t37)
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t3 = t2*rhoa
      t5 = 1/t3
      t7 = dsqrt(sigmaaa)
      t8 = t7*t5
      t9 = dlog(t8+dsqrt(1+t8**2))
      t16 = 1/rhoa
      t17 = t16**(1.D0/3.D0)
      t19 = t16**(1.D0/6.D0)
      t22 = 1/(0.6203504908994D0*t17+0.1584942278842832D2*t19
     #+0.101578D3)
      t25 = dlog(0.6203504908994D0*t17*t22)
      t31 = datan(0.1171685277708993D1/(0.1575246635799487D1*t19
     #+0.201231D2))
      t35 = (0.7876233178997433D0*t19+0.743294D0)**2
      t37 = dlog(t35*t22)
      zk(i) = -0.74442058907928D0*t3-0.3024D-2*t5*sigmaaa/(1.D0
     #+0.252D-1*t8*t9)+0.19D0*rhoa*(0.1554535D-1*t25
     #+0.6188180297906063D0*t31+0.2667310007273315D-2*t37)
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t5 = t4*rhoa
      t7 = 1/t5
      t9 = dsqrt(sigmaaa)
      t10 = t9*t7
      t11 = dlog(t10+dsqrt(1+t10**2))
      t18 = rhob**(1.D0/3.D0)
      t19 = t18*rhob
      t21 = 1/t19
      t23 = dsqrt(sigmabb)
      t24 = t23*t21
      t25 = dlog(t24+dsqrt(1+t24**2))
      t32 = rho**(1.D0/3.D0)
      t33 = 1/t32
      t36 = 1/(1.D0+0.349D0*t33)
      t38 = 1/rho
      t39 = rhob*t38
      t42 = 0.2533D0*t33
      t43 = dexp(-t42)
      t45 = rho**2
      t47 = t32**2
      t51 = rhoa**2
      t52 = t4**2
      t55 = rhob**2
      t56 = t18**2
      t60 = t33*t36
      t82 = 0.6666666666666667D0*t45
      t93 = t38**(1.D0/3.D0)
      t94 = 0.6203504908994D0*t93
      t95 = t38**(1.D0/6.D0)
      t98 = 1/(t94+0.1029581201158544D2*t95+0.427198D2)
      t101 = dlog(0.6203504908994D0*t93*t98)
      t103 = 0.1575246635799487D1*t95
      t107 = datan(0.448998886412873D-1/(t103+0.13072D2))
      t109 = 0.7876233178997433D0*t95
      t111 = (t109+0.409286D0)**2
      t113 = dlog(t111*t98)
      t117 = 1/(t94+0.1584942278842832D2*t95+0.101578D3)
      t120 = dlog(0.6203504908994D0*t93*t117)
      t125 = datan(0.1171685277708993D1/(t103+0.201231D2))
      t128 = (t109+0.743294D0)**2
      t130 = dlog(t128*t117)
      t138 = (rhoa-1.D0*rhob)*t38
      t139 = 1.D0+t138
      t140 = t139**(1.D0/3.D0)
      t143 = 1.D0-1.D0*t138
      t144 = t143**(1.D0/3.D0)
      s1 = -0.74442058907928D0*t5-0.3024D-2*t7*sigmaaa/(1.D0+0.252D-1
     #*t10*t11)-0.74442058907928D0*t19
      s2 = s1-0.3024D-2*t21*sigmabb/(1.D0+0.252D-1*t24*t25)
      zk(i) = s2-0.1593432D0*t36*rhoa*t39-0.52583256D-2*t43*t36/t47
     #/t45/rho*(rhoa*rhob*(0.3646239897876478D2*t52*t51
     #+0.3646239897876478D2*t56*t55+(0.2611111111111111D1
     #-0.9850555555555556D-1*t33-0.1357222222222222D0*t60)*sigma-1.D0*
     #(0.25D1-0.1407222222222222D-1*t33-0.1938888888888889D-1*t60)*
     #(sigmaaa+sigmabb)-0.1111111111111111D0*(t42+0.349D0*t60-11.D0)*
     #(rhoa*t38*sigmaaa+t39*sigmabb))-0.6666666666666667D0*t45*sigma+
     #(t82-1.D0*t51)*sigmabb+(t82-1.D0*t55)*sigmaaa)+0.19D0*rho*
     #(0.310907D-1*t101+0.205219729378375D2*t107+0.4431373767749538D-2
     #*t113+0.1923661050931536D1*(0.1554535D-1*t120
     #+0.6188180297906063D0*t125+0.2667310007273315D-2*t130
     #-0.310907D-1*t101-0.205219729378375D2*t107-0.4431373767749538D-2
     #*t113)*(t140*t139+t144*t143-2.D0))
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t3 = t2*rhob
      t5 = 1/t3
      t6 = t5*sigmabb
      t7 = dsqrt(sigmabb)
      t8 = t7*t5
      t9 = dlog(t8+dsqrt(1+t8**2))
      t12 = 1.D0+0.252D-1*t8*t9
      t13 = 1/t12
      t16 = 1/rhob
      t17 = t16**(1.D0/3.D0)
      t19 = t16**(1.D0/6.D0)
      t21 = 0.6203504908994D0*t17+0.1584942278842832D2*t19+0.101578D3
      t22 = 1/t21
      t25 = dlog(0.6203504908994D0*t17*t22)
      t28 = 0.1575246635799487D1*t19+0.201231D2
      t31 = datan(0.1171685277708993D1/t28)
      t34 = 0.7876233178997433D0*t19+0.743294D0
      t35 = t34**2
      t37 = dlog(t35*t22)
      zk(i) = -0.74442058907928D0*t3-0.3024D-2*t6*t13+0.19D0*rhob*
     #(0.1554535D-1*t25+0.6188180297906063D0*t31+0.2667310007273315D-2
     #*t37)
      vrhoa(i) = 0.D0
      t43 = rhob**2
      t45 = 1/t2/t43
      t49 = t12**2
      t50 = 1/t49
      t55 = t2**2
      t60 = 1/t55/t43
      t63 = dsqrt(1.D0+sigmabb*t60)
      t64 = 1/t63
      t74 = t17**2
      t75 = 1/t74
      t77 = 1/t43
      t80 = t21**2
      t81 = 1/t80
      t85 = t19**2
      t86 = t85**2
      t88 = 1/t86/t19
      t89 = t88*t77
      t91 = -0.2067834969664667D0*t75*t77-0.2641570464738054D1*t89
      t99 = t28**2
      t100 = 1/t99
      vrhob(i) = -0.99256078543904D0*t2+0.4032D-2*t45*sigmabb*t13
     #+0.3024D-2*t6*t50*(-0.336D-1*t7*t45*t9-0.336D-1*sigmabb/t55/t43
     #/rhob*t64)+0.29536165D-2*t25+0.1175754256602152D0*t31
     #+0.5067889013819299D-3*t37+0.19D0*rhob*(0.2505897912236993D-1*(
     #-0.2067834969664667D0*t75*t22*t77-0.6203504908994D0*t17*t81*t91)
     #/t17*t21+0.1903580477513215D0*t100*t88*t77/(1.D0+0.137284639D1
     #*t100)+0.2667310007273315D-2*(-0.2625411059665811D0*t34*t22*t89
     #-1.D0*t35*t81*t91)/t35*t21)
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      vsigmabb(i) = -0.3024D-2*t5*t13+0.3024D-2*t6*t50*(0.126D-1/t7*t5
     #*t9+0.126D-1*t60*t64)
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t3 = t2*rhoa
      t5 = 1/t3
      t6 = t5*sigmaaa
      t7 = dsqrt(sigmaaa)
      t8 = t7*t5
      t9 = dlog(t8+dsqrt(1+t8**2))
      t12 = 1.D0+0.252D-1*t8*t9
      t13 = 1/t12
      t16 = 1/rhoa
      t17 = t16**(1.D0/3.D0)
      t19 = t16**(1.D0/6.D0)
      t21 = 0.6203504908994D0*t17+0.1584942278842832D2*t19+0.101578D3
      t22 = 1/t21
      t25 = dlog(0.6203504908994D0*t17*t22)
      t28 = 0.1575246635799487D1*t19+0.201231D2
      t31 = datan(0.1171685277708993D1/t28)
      t34 = 0.7876233178997433D0*t19+0.743294D0
      t35 = t34**2
      t37 = dlog(t35*t22)
      zk(i) = -0.74442058907928D0*t3-0.3024D-2*t6*t13+0.19D0*rhoa*
     #(0.1554535D-1*t25+0.6188180297906063D0*t31+0.2667310007273315D-2
     #*t37)
      t43 = rhoa**2
      t45 = 1/t2/t43
      t49 = t12**2
      t50 = 1/t49
      t55 = t2**2
      t60 = 1/t55/t43
      t63 = dsqrt(1.D0+sigmaaa*t60)
      t64 = 1/t63
      t74 = t17**2
      t75 = 1/t74
      t77 = 1/t43
      t80 = t21**2
      t81 = 1/t80
      t85 = t19**2
      t86 = t85**2
      t88 = 1/t86/t19
      t89 = t88*t77
      t91 = -0.2067834969664667D0*t75*t77-0.2641570464738054D1*t89
      t99 = t28**2
      t100 = 1/t99
      vrhoa(i) = -0.99256078543904D0*t2+0.4032D-2*t45*sigmaaa*t13
     #+0.3024D-2*t6*t50*(-0.336D-1*t7*t45*t9-0.336D-1*sigmaaa/t55/t43
     #/rhoa*t64)+0.29536165D-2*t25+0.1175754256602152D0*t31
     #+0.5067889013819299D-3*t37+0.19D0*rhoa*(0.2505897912236993D-1*(
     #-0.2067834969664667D0*t75*t22*t77-0.6203504908994D0*t17*t81*t91)
     #/t17*t21+0.1903580477513215D0*t100*t88*t77/(1.D0+0.137284639D1
     #*t100)+0.2667310007273315D-2*(-0.2625411059665811D0*t34*t22*t89
     #-1.D0*t35*t81*t91)/t35*t21)
      vrhob(i) = 0.D0
      vsigmaaa(i) = -0.3024D-2*t5*t13+0.3024D-2*t6*t50*(0.126D-1/t7*t5
     #*t9+0.126D-1*t60*t64)
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t5 = t4*rhoa
      t7 = 1/t5
      t8 = t7*sigmaaa
      t9 = dsqrt(sigmaaa)
      t10 = t9*t7
      t11 = dlog(t10+dsqrt(1+t10**2))
      t14 = 1.D0+0.252D-1*t10*t11
      t15 = 1/t14
      t18 = rhob**(1.D0/3.D0)
      t19 = t18*rhob
      t21 = 1/t19
      t22 = t21*sigmabb
      t23 = dsqrt(sigmabb)
      t24 = t23*t21
      t25 = dlog(t24+dsqrt(1+t24**2))
      t28 = 1.D0+0.252D-1*t24*t25
      t29 = 1/t28
      t32 = rho**(1.D0/3.D0)
      t33 = 1/t32
      t35 = 1.D0+0.349D0*t33
      t36 = 1/t35
      t37 = t36*rhoa
      t38 = 1/rho
      t39 = rhob*t38
      t42 = 0.2533D0*t33
      t43 = dexp(-t42)
      t44 = t43*t36
      t45 = rho**2
      t47 = t32**2
      t49 = 1/t47/t45/rho
      t50 = rhoa*rhob
      t51 = rhoa**2
      t52 = t4**2
      t53 = t52*t51
      t55 = rhob**2
      t56 = t18**2
      t57 = t56*t55
      t60 = t33*t36
      t62 = 0.2611111111111111D1-0.9850555555555556D-1*t33
     #-0.1357222222222222D0*t60
      t67 = sigmaaa+sigmabb
      t71 = t42+0.349D0*t60-11.D0
      t75 = rhoa*t38*sigmaaa+t39*sigmabb
      t78 = 0.3646239897876478D2*t53+0.3646239897876478D2*t57+t62
     #*sigma-1.D0*(0.25D1-0.1407222222222222D-1*t33
     #-0.1938888888888889D-1*t60)*t67-0.1111111111111111D0*t71*t75
      t82 = 0.6666666666666667D0*t45
      t83 = 1.D0*t51
      t86 = 1.D0*t55
      t89 = t50*t78-0.6666666666666667D0*t45*sigma+(t82-t83)*sigmabb+
     #(t82-t86)*sigmaaa
      t93 = t38**(1.D0/3.D0)
      t94 = 0.6203504908994D0*t93
      t95 = t38**(1.D0/6.D0)
      t97 = t94+0.1029581201158544D2*t95+0.427198D2
      t98 = 1/t97
      t101 = dlog(0.6203504908994D0*t93*t98)
      t103 = 0.1575246635799487D1*t95
      t104 = t103+0.13072D2
      t107 = datan(0.448998886412873D-1/t104)
      t109 = 0.7876233178997433D0*t95
      t110 = t109+0.409286D0
      t111 = t110**2
      t113 = dlog(t111*t98)
      t116 = t94+0.1584942278842832D2*t95+0.101578D3
      t117 = 1/t116
      t120 = dlog(0.6203504908994D0*t93*t117)
      t122 = t103+0.201231D2
      t125 = datan(0.1171685277708993D1/t122)
      t127 = t109+0.743294D0
      t128 = t127**2
      t130 = dlog(t128*t117)
      t135 = 0.1554535D-1*t120+0.6188180297906063D0*t125
     #+0.2667310007273315D-2*t130-0.310907D-1*t101-0.205219729378375D2
     #*t107-0.4431373767749538D-2*t113
      t137 = rhoa-1.D0*rhob
      t138 = t137*t38
      t139 = 1.D0+t138
      t140 = t139**(1.D0/3.D0)
      t143 = 1.D0-1.D0*t138
      t144 = t143**(1.D0/3.D0)
      t146 = t140*t139+t144*t143-2.D0
      t147 = t135*t146
      zk(i) = -0.74442058907928D0*t5-0.3024D-2*t8*t15
     #-0.74442058907928D0*t19-0.3024D-2*t22*t29-0.1593432D0*t37*t39
     #-0.52583256D-2*t44*t49*t89+0.19D0*rho*(0.310907D-1*t101
     #+0.205219729378375D2*t107+0.4431373767749538D-2*t113
     #+0.1923661050931536D1*t147)
      t154 = 1/t4/t51
      t158 = t14**2
      t159 = 1/t158
      t167 = 1/t53
      t170 = dsqrt(1.D0+sigmaaa*t167)
      t171 = 1/t170
      t184 = t71*t38
      t195 = rho*t135
      t200 = 0.1333333333333333D1*t140*t38-0.1333333333333333D1*t144*t38
      t203 = t35**2
      t204 = 1/t203
      t210 = 0.185369256D-1*t204*rhoa*rhob/t32/t45
      t211 = 1/t45
      t212 = rhob*t211
      t214 = 0.1593432D0*t37*t212
      t215 = t45**2
      t217 = 1/t215/rho
      t221 = 0.44397795816D-3*t217*t43*t36*t89
      t225 = 0.6117185448D-3*t43*t204*t217*t89
      t230 = 0.192805272D-1*t44/t47/t215*t89
      t232 = 1/t32/rho
      t234 = t232*t36
      t238 = 1/t47/rho*t204
      t273 = 0.52583256D-2*t44*t49*(t50*((0.3283518518518519D-1*t232
     #+0.4524074074074074D-1*t234-0.1578901851851852D-1*t238)*sigma
     #-1.D0*(0.4690740740740741D-2*t232+0.6462962962962963D-2*t234
     #-0.2255574074074074D-2*t238)*t67-0.1111111111111111D0*(
     #-0.8443333333333333D-1*t232-0.1163333333333333D0*t234
     #+0.4060033333333333D-1*t238)*t75-0.1111111111111111D0*t71*(-1.D0
     #*rhoa*t211*sigmaaa-1.D0*t212*sigmabb))-0.1333333333333333D1*rho
     #*sigma+0.1333333333333333D1*rho*sigmabb+0.1333333333333333D1*rho
     #*sigmaaa)
      t274 = 0.5907233D-2*t101
      t275 = 0.3899174858189126D1*t107
      t276 = 0.8419610158724123D-3*t113
      t277 = 0.3654955996769919D0*t147
      t278 = t93**2
      t279 = 1/t278
      t283 = t97**2
      t284 = 1/t283
      t287 = 0.2067834969664667D0*t279*t211
      t288 = t95**2
      t289 = t288**2
      t291 = 1/t289/t95
      t292 = t291*t211
      t294 = -t287-0.1715968668597574D1*t292
      t298 = 1/t93
      t300 = (-0.2067834969664667D0*t279*t98*t211-0.6203504908994D0
     #*t93*t284*t294)*t298*t97
      t302 = t104**2
      t303 = 1/t302
      t309 = t303*t291*t211/(1.D0+0.2016D-2*t303)
      t320 = (-0.2625411059665811D0*t110*t98*t292-1.D0*t111*t284*t294)
     #/t111*t97
      t325 = t116**2
      t326 = 1/t325
      t329 = -t287-0.2641570464738054D1*t292
      t336 = t122**2
      t337 = 1/t336
      t373 = 0.19D0*rho*(0.5011795824473985D-1*t300
     #+0.2419143800947354D0*t309+0.4431373767749538D-2*t320
     #+0.1923661050931536D1*(0.2505897912236993D-1*(
     #-0.2067834969664667D0*t279*t117*t211-0.6203504908994D0*t93*t326
     #*t329)*t298*t116+0.1903580477513215D0*t337*t291*t211/(1.D0
     #+0.137284639D1*t337)+0.2667310007273315D-2*(
     #-0.2625411059665811D0*t127*t117*t292-1.D0*t128*t326*t329)/t128
     #*t116-0.5011795824473985D-1*t300-0.2419143800947354D0*t309
     #-0.4431373767749538D-2*t320)*t146+0.1923661050931536D1*t135*(
     #-0.1333333333333333D1*t140*t137*t211+0.1333333333333333D1*t144
     #*t137*t211))
      vrhoa(i) = -0.99256078543904D0*t4+0.4032D-2*t154*sigmaaa*t15
     #+0.3024D-2*t8*t159*(-0.336D-1*t9*t154*t11-0.336D-1*sigmaaa/t52
     #/t51/rhoa*t171)-0.1593432D0*t36*rhob*t38-0.52583256D-2*t44*t49*
     #(rhob*t78+t50*(0.9723306394337274D2*t52*rhoa
     #-0.1111111111111111D0*t184*sigmaaa)-2.D0*rhoa*sigmabb)
     #+0.3654955996769919D0*t195*t200-t210+t214-t221-t225+t230-t273
     #+t274+t275+t276+t277+t373
      t376 = 1/t18/t55
      t380 = t28**2
      t381 = 1/t380
      t389 = 1/t57
      t392 = dsqrt(1.D0+sigmabb*t389)
      t393 = 1/t392
      vrhob(i) = -0.99256078543904D0*t18+0.4032D-2*t376*sigmabb*t29
     #+0.3024D-2*t22*t381*(-0.336D-1*t23*t376*t25-0.336D-1*sigmabb/t56
     #/t55/rhob*t393)-0.1593432D0*t37*t38-0.52583256D-2*t44*t49*(rhoa
     #*t78+t50*(0.9723306394337274D2*t56*rhob-0.1111111111111111D0
     #*t184*sigmabb)-2.D0*rhob*sigmaaa)-0.3654955996769919D0*t195*t200
     #-t210+t214-t221-t225+t230-t273+t274+t275+t276+t277+t373
      t430 = 0.1407222222222222D-1*t33
      t431 = 0.1938888888888889D-1*t60
      t445 = t44*t49*(t50*t62-0.6666666666666667D0*t45)
      t446 = 0.52583256D-2*t445
      vsigmaaa(i) = -0.3024D-2*t7*t15+0.3024D-2*t8*t159*(0.126D-1/t9
     #*t7*t11+0.126D-1*t167*t171)-0.52583256D-2*t44*t49*(t50*(-0.25D1
     #+t430+t431-0.1111111111111111D0*t71*rhoa*t38)+t82-t86)-t446
      vsigmaab(i) = -0.105166512D-1*t445
      vsigmabb(i) = -0.3024D-2*t21*t29+0.3024D-2*t22*t381*(0.126D-1
     #/t23*t21*t25+0.126D-1*t389*t393)-0.52583256D-2*t44*t49*(t50*(
     #-0.25D1+t430+t431-0.1111111111111111D0*t71*rhob*t38)+t82-t83)-t446
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t3 = t2*rhob
      t5 = 1/t3
      t6 = t5*sigmabb
      t7 = dsqrt(sigmabb)
      t8 = t7*t5
      t9 = dlog(t8+dsqrt(1+t8**2))
      t12 = 1.D0+0.252D-1*t8*t9
      t13 = 1/t12
      t16 = 1/rhob
      t17 = t16**(1.D0/3.D0)
      t19 = t16**(1.D0/6.D0)
      t21 = 0.6203504908994D0*t17+0.1584942278842832D2*t19+0.101578D3
      t22 = 1/t21
      t25 = dlog(0.6203504908994D0*t17*t22)
      t28 = 0.1575246635799487D1*t19+0.201231D2
      t31 = datan(0.1171685277708993D1/t28)
      t34 = 0.7876233178997433D0*t19+0.743294D0
      t35 = t34**2
      t37 = dlog(t35*t22)
      zk(i) = -0.74442058907928D0*t3-0.3024D-2*t6*t13+0.19D0*rhob*
     #(0.1554535D-1*t25+0.6188180297906063D0*t31+0.2667310007273315D-2
     #*t37)
      vrhoa(i) = 0.D0
      t43 = rhob**2
      t45 = 1/t2/t43
      t46 = t45*sigmabb
      t49 = t12**2
      t50 = 1/t49
      t54 = t43*rhob
      t55 = t2**2
      t60 = 1/t55/t43
      t62 = 1.D0+sigmabb*t60
      t63 = dsqrt(t62)
      t64 = 1/t63
      t67 = -0.336D-1*t7*t45*t9-0.336D-1*sigmabb/t55/t54*t64
      t68 = t50*t67
      t74 = t17**2
      t75 = 1/t74
      t76 = t75*t22
      t77 = 1/t43
      t80 = t21**2
      t81 = 1/t80
      t82 = t17*t81
      t85 = t19**2
      t86 = t85**2
      t87 = t86*t19
      t88 = 1/t87
      t89 = t88*t77
      t91 = -0.2067834969664667D0*t75*t77-0.2641570464738054D1*t89
      t94 = -0.2067834969664667D0*t76*t77-0.6203504908994D0*t82*t91
      t95 = 1/t17
      t96 = t94*t95
      t97 = t96*t21
      t99 = t28**2
      t100 = 1/t99
      t101 = t100*t88
      t103 = 1.D0+0.137284639D1*t100
      t104 = 1/t103
      t106 = t101*t77*t104
      t108 = t34*t22
      t111 = t35*t81
      t114 = -0.2625411059665811D0*t108*t89-1.D0*t111*t91
      t115 = 1/t35
      t116 = t114*t115
      t117 = t116*t21
      vrhob(i) = -0.99256078543904D0*t2+0.4032D-2*t46*t13+0.3024D-2*t6
     #*t68+0.29536165D-2*t25+0.1175754256602152D0*t31
     #+0.5067889013819299D-3*t37+0.19D0*rhob*(0.2505897912236993D-1
     #*t97+0.1903580477513215D0*t106+0.2667310007273315D-2*t117)
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      t130 = 0.126D-1/t7*t5*t9+0.126D-1*t60*t64
      vsigmabb(i) = -0.3024D-2*t5*t13+0.3024D-2*t6*t50*t130
      v2rhoa2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t137 = 1/t2/t54
      t144 = 1/t49/t12
      t145 = t67**2
      t152 = t43**2
      t158 = sigmabb**2
      t164 = 1/t63/t62
      t175 = 1/t74/t16
      t177 = 1/t152
      t178 = t175*t22*t177
      t184 = 1/t54
      t188 = 1/t80/t21
      t190 = t91**2
      t198 = 1/t87/t16
      t199 = t198*t177
      t201 = t88*t184
      t203 = -0.1378556646443111D0*t175*t177+0.4135669939329333D0*t75
     #*t184-0.2201308720615045D1*t199+0.5283140929476108D1*t201
      t221 = t177*t104
      t230 = t99**2
      t234 = t103**2
      s1 = -0.3308535951463467D0/t55-0.9408D-2*t137*sigmabb*t13
     #-0.8064D-2*t46*t68-0.6048D-2*t6*t144*t145
      s2 = s1+0.3024D-2*t6*t50*(0.784D-1*t7*t137*t9+0.168D0*sigmabb
     #/t55/t152*t64-0.448D-1*t158/t2/t152/t54*t164)
     #+0.9522412066500572D-2*t97
      s3 = s2+0.7233605814550218D-1*t106
      s4 = s3
      s5 = 0.101357780276386D-2*t117+0.19D0*rhob*
     #(0.2505897912236993D-1*(-0.1378556646443111D0*t178
     #+0.4135669939329333D0*t75*t81*t77*t91+0.4135669939329333D0*t76
     #*t184+0.12407009817988D1*t17*t188*t190-0.6203504908994D0*t82
     #*t203)*t95*t21+0.8352993040789975D-2*t94/t17/t16*t21*t77
     #+0.2505897912236993D-1*t96*t91+0.9995362477254242D-1/t99/t28
     #*t175*t221+0.1586317064594346D0*t100*t198*t221
     #-0.3807160955026431D0*t101*t184*t104-0.1372209729363994D0/t230
     #/t28*t175*t177/t234+0.2667310007273315D-2*(0.3446391616107778D-1
     #*t178+0.5250822119331622D0*t34*t81*t89*t91-0.2187842549721509D0
     #*t108*t199+0.5250822119331622D0*t108*t201+2.D0*t35*t188*t190
     #-1.D0*t111*t203)*t115*t21+0.7002785192652656D-3*t114/t35/t34*t21
     #*t88*t77+0.2667310007273315D-2*t116*t91)
      v2rhob2(i) = s4+s5
      v2sigmaaa2(i) = 0.D0
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      t272 = t130**2
      v2sigmabb2(i) = 0.6048D-2*t5*t50*t130-0.6048D-2*t6*t144*t272
     #+0.3024D-2*t6*t50*(-0.63D-2/t7/sigmabb*t5*t9+0.63D-2/sigmabb*t60
     #*t64-0.63D-2/t2/t152/rhob*t164)
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t3 = t2*rhoa
      t5 = 1/t3
      t6 = t5*sigmaaa
      t7 = dsqrt(sigmaaa)
      t8 = t7*t5
      t9 = dlog(t8+dsqrt(1+t8**2))
      t12 = 1.D0+0.252D-1*t8*t9
      t13 = 1/t12
      t16 = 1/rhoa
      t17 = t16**(1.D0/3.D0)
      t19 = t16**(1.D0/6.D0)
      t21 = 0.6203504908994D0*t17+0.1584942278842832D2*t19+0.101578D3
      t22 = 1/t21
      t25 = dlog(0.6203504908994D0*t17*t22)
      t28 = 0.1575246635799487D1*t19+0.201231D2
      t31 = datan(0.1171685277708993D1/t28)
      t34 = 0.7876233178997433D0*t19+0.743294D0
      t35 = t34**2
      t37 = dlog(t35*t22)
      zk(i) = -0.74442058907928D0*t3-0.3024D-2*t6*t13+0.19D0*rhoa*
     #(0.1554535D-1*t25+0.6188180297906063D0*t31+0.2667310007273315D-2
     #*t37)
      t43 = rhoa**2
      t45 = 1/t2/t43
      t46 = t45*sigmaaa
      t49 = t12**2
      t50 = 1/t49
      t54 = t43*rhoa
      t55 = t2**2
      t60 = 1/t55/t43
      t62 = 1.D0+sigmaaa*t60
      t63 = dsqrt(t62)
      t64 = 1/t63
      t67 = -0.336D-1*t7*t45*t9-0.336D-1*sigmaaa/t55/t54*t64
      t68 = t50*t67
      t74 = t17**2
      t75 = 1/t74
      t76 = t75*t22
      t77 = 1/t43
      t80 = t21**2
      t81 = 1/t80
      t82 = t17*t81
      t85 = t19**2
      t86 = t85**2
      t87 = t86*t19
      t88 = 1/t87
      t89 = t88*t77
      t91 = -0.2067834969664667D0*t75*t77-0.2641570464738054D1*t89
      t94 = -0.2067834969664667D0*t76*t77-0.6203504908994D0*t82*t91
      t95 = 1/t17
      t96 = t94*t95
      t97 = t96*t21
      t99 = t28**2
      t100 = 1/t99
      t101 = t100*t88
      t103 = 1.D0+0.137284639D1*t100
      t104 = 1/t103
      t106 = t101*t77*t104
      t108 = t34*t22
      t111 = t35*t81
      t114 = -0.2625411059665811D0*t108*t89-1.D0*t111*t91
      t115 = 1/t35
      t116 = t114*t115
      t117 = t116*t21
      vrhoa(i) = -0.99256078543904D0*t2+0.4032D-2*t46*t13+0.3024D-2*t6
     #*t68+0.29536165D-2*t25+0.1175754256602152D0*t31
     #+0.5067889013819299D-3*t37+0.19D0*rhoa*(0.2505897912236993D-1
     #*t97+0.1903580477513215D0*t106+0.2667310007273315D-2*t117)
      vrhob(i) = 0.D0
      t130 = 0.126D-1/t7*t5*t9+0.126D-1*t60*t64
      vsigmaaa(i) = -0.3024D-2*t5*t13+0.3024D-2*t6*t50*t130
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      t137 = 1/t2/t54
      t144 = 1/t49/t12
      t145 = t67**2
      t152 = t43**2
      t158 = sigmaaa**2
      t164 = 1/t63/t62
      t175 = 1/t74/t16
      t177 = 1/t152
      t178 = t175*t22*t177
      t184 = 1/t54
      t188 = 1/t80/t21
      t190 = t91**2
      t198 = 1/t87/t16
      t199 = t198*t177
      t201 = t88*t184
      t203 = -0.1378556646443111D0*t175*t177+0.4135669939329333D0*t75
     #*t184-0.2201308720615045D1*t199+0.5283140929476108D1*t201
      t221 = t177*t104
      t230 = t99**2
      t234 = t103**2
      s1 = -0.3308535951463467D0/t55-0.9408D-2*t137*sigmaaa*t13
     #-0.8064D-2*t46*t68-0.6048D-2*t6*t144*t145
      s2 = s1+0.3024D-2*t6*t50*(0.784D-1*t7*t137*t9+0.168D0*sigmaaa
     #/t55/t152*t64-0.448D-1*t158/t2/t152/t54*t164)
     #+0.9522412066500572D-2*t97
      s3 = s2+0.7233605814550218D-1*t106
      s4 = s3
      s5 = 0.101357780276386D-2*t117+0.19D0*rhoa*
     #(0.2505897912236993D-1*(-0.1378556646443111D0*t178
     #+0.4135669939329333D0*t75*t81*t77*t91+0.4135669939329333D0*t76
     #*t184+0.12407009817988D1*t17*t188*t190-0.6203504908994D0*t82
     #*t203)*t95*t21+0.8352993040789975D-2*t94/t17/t16*t21*t77
     #+0.2505897912236993D-1*t96*t91+0.9995362477254242D-1/t99/t28
     #*t175*t221+0.1586317064594346D0*t100*t198*t221
     #-0.3807160955026431D0*t101*t184*t104-0.1372209729363994D0/t230
     #/t28*t175*t177/t234+0.2667310007273315D-2*(0.3446391616107778D-1
     #*t178+0.5250822119331622D0*t34*t81*t89*t91-0.2187842549721509D0
     #*t108*t199+0.5250822119331622D0*t108*t201+2.D0*t35*t188*t190
     #-1.D0*t111*t203)*t115*t21+0.7002785192652656D-3*t114/t35/t34*t21
     #*t88*t77+0.2667310007273315D-2*t116*t91)
      v2rhoa2(i) = s4+s5
      v2rhob2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t272 = t130**2
      v2sigmaaa2(i) = 0.6048D-2*t5*t50*t130-0.6048D-2*t6*t144*t272
     #+0.3024D-2*t6*t50*(-0.63D-2/t7/sigmaaa*t5*t9+0.63D-2/sigmaaa*t60
     #*t64-0.63D-2/t2/t152/rhoa*t164)
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      v2sigmabb2(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t5 = t4*rhoa
      t7 = 1/t5
      t8 = t7*sigmaaa
      t9 = dsqrt(sigmaaa)
      t10 = t9*t7
      t11 = dlog(t10+dsqrt(1+t10**2))
      t14 = 1.D0+0.252D-1*t10*t11
      t15 = 1/t14
      t18 = rhob**(1.D0/3.D0)
      t19 = t18*rhob
      t21 = 1/t19
      t22 = t21*sigmabb
      t23 = dsqrt(sigmabb)
      t24 = t23*t21
      t25 = dlog(t24+dsqrt(1+t24**2))
      t28 = 1.D0+0.252D-1*t24*t25
      t29 = 1/t28
      t32 = rho**(1.D0/3.D0)
      t33 = 1/t32
      t35 = 1.D0+0.349D0*t33
      t36 = 1/t35
      t37 = t36*rhoa
      t38 = 1/rho
      t39 = rhob*t38
      t42 = 0.2533D0*t33
      t43 = dexp(-t42)
      t44 = t43*t36
      t45 = rho**2
      t46 = t45*rho
      t47 = t32**2
      t49 = 1/t47/t46
      t50 = rhoa*rhob
      t51 = rhoa**2
      t52 = t4**2
      t53 = t52*t51
      t54 = 0.3646239897876478D2*t53
      t55 = rhob**2
      t56 = t18**2
      t57 = t56*t55
      t58 = 0.3646239897876478D2*t57
      t60 = t33*t36
      t62 = 0.2611111111111111D1-0.9850555555555556D-1*t33
     #-0.1357222222222222D0*t60
      t63 = t62*sigma
      t67 = sigmaaa+sigmabb
      t69 = 1.D0*(0.25D1-0.1407222222222222D-1*t33
     #-0.1938888888888889D-1*t60)*t67
      t71 = t42+0.349D0*t60-11.D0
      t75 = rhoa*t38*sigmaaa+t39*sigmabb
      t77 = 0.1111111111111111D0*t71*t75
      t78 = t54+t58+t63-t69-t77
      t82 = 0.6666666666666667D0*t45
      t83 = 1.D0*t51
      t86 = 1.D0*t55
      t89 = t50*t78-0.6666666666666667D0*t45*sigma+(t82-t83)*sigmabb+
     #(t82-t86)*sigmaaa
      t93 = t38**(1.D0/3.D0)
      t94 = 0.6203504908994D0*t93
      t95 = t38**(1.D0/6.D0)
      t97 = t94+0.1029581201158544D2*t95+0.427198D2
      t98 = 1/t97
      t101 = dlog(0.6203504908994D0*t93*t98)
      t103 = 0.1575246635799487D1*t95
      t104 = t103+0.13072D2
      t107 = datan(0.448998886412873D-1/t104)
      t109 = 0.7876233178997433D0*t95
      t110 = t109+0.409286D0
      t111 = t110**2
      t113 = dlog(t111*t98)
      t116 = t94+0.1584942278842832D2*t95+0.101578D3
      t117 = 1/t116
      t120 = dlog(0.6203504908994D0*t93*t117)
      t122 = t103+0.201231D2
      t125 = datan(0.1171685277708993D1/t122)
      t127 = t109+0.743294D0
      t128 = t127**2
      t130 = dlog(t128*t117)
      t135 = 0.1554535D-1*t120+0.6188180297906063D0*t125
     #+0.2667310007273315D-2*t130-0.310907D-1*t101-0.205219729378375D2
     #*t107-0.4431373767749538D-2*t113
      t137 = rhoa-1.D0*rhob
      t138 = t137*t38
      t139 = 1.D0+t138
      t140 = t139**(1.D0/3.D0)
      t143 = 1.D0-1.D0*t138
      t144 = t143**(1.D0/3.D0)
      t146 = t140*t139+t144*t143-2.D0
      t147 = t135*t146
      zk(i) = -0.74442058907928D0*t5-0.3024D-2*t8*t15
     #-0.74442058907928D0*t19-0.3024D-2*t22*t29-0.1593432D0*t37*t39
     #-0.52583256D-2*t44*t49*t89+0.19D0*rho*(0.310907D-1*t101
     #+0.205219729378375D2*t107+0.4431373767749538D-2*t113
     #+0.1923661050931536D1*t147)
      t154 = 1/t4/t51
      t155 = t154*sigmaaa
      t158 = t14**2
      t159 = 1/t158
      t163 = t51*rhoa
      t165 = 1/t52/t163
      t167 = 1/t53
      t169 = 1.D0+sigmaaa*t167
      t170 = dsqrt(t169)
      t171 = 1/t170
      t174 = -0.336D-1*t9*t154*t11-0.336D-1*sigmaaa*t165*t171
      t175 = t159*t174
      t178 = t36*rhob
      t182 = t52*rhoa
      t184 = t71*t38
      t187 = 0.9723306394337274D2*t182-0.1111111111111111D0*t184*sigmaaa
      t191 = rhob*t78+t50*t187-2.D0*rhoa*sigmabb
      t195 = rho*t135
      t200 = 0.1333333333333333D1*t140*t38-0.1333333333333333D1*t144*t38
      t203 = t35**2
      t204 = 1/t203
      t205 = t204*rhoa
      t207 = 1/t32/t45
      t210 = 0.185369256D-1*t205*rhob*t207
      t211 = 1/t45
      t212 = rhob*t211
      t214 = 0.1593432D0*t37*t212
      t215 = t45**2
      t216 = t215*rho
      t217 = 1/t216
      t218 = t217*t43
      t219 = t36*t89
      t221 = 0.44397795816D-3*t218*t219
      t222 = t43*t204
      t225 = 0.6117185448D-3*t222*t217*t89
      t227 = 1/t47/t215
      t230 = 0.192805272D-1*t44*t227*t89
      t232 = 1/t32/rho
      t234 = t232*t36
      t238 = 1/t47/rho*t204
      t240 = 0.3283518518518519D-1*t232+0.4524074074074074D-1*t234
     #-0.1578901851851852D-1*t238
      t251 = -0.8443333333333333D-1*t232-0.1163333333333333D0*t234
     #+0.4060033333333333D-1*t238
      t259 = -1.D0*rhoa*t211*sigmaaa-1.D0*t212*sigmabb
      t262 = t240*sigma-1.D0*(0.4690740740740741D-2*t232
     #+0.6462962962962963D-2*t234-0.2255574074074074D-2*t238)*t67
     #-0.1111111111111111D0*t251*t75-0.1111111111111111D0*t71*t259
      t270 = t50*t262-0.1333333333333333D1*rho*sigma
     #+0.1333333333333333D1*rho*sigmabb+0.1333333333333333D1*rho*sigmaaa
      t273 = 0.52583256D-2*t44*t49*t270
      t274 = 0.5907233D-2*t101
      t275 = 0.3899174858189126D1*t107
      t276 = 0.8419610158724123D-3*t113
      t277 = 0.3654955996769919D0*t147
      t278 = t93**2
      t279 = 1/t278
      t280 = t279*t98
      t283 = t97**2
      t284 = 1/t283
      t285 = t93*t284
      t287 = 0.2067834969664667D0*t279*t211
      t288 = t95**2
      t289 = t288**2
      t290 = t289*t95
      t291 = 1/t290
      t292 = t291*t211
      t294 = -t287-0.1715968668597574D1*t292
      t297 = -0.2067834969664667D0*t280*t211-0.6203504908994D0*t285*t294
      t298 = 1/t93
      t299 = t297*t298
      t300 = t299*t97
      t302 = t104**2
      t303 = 1/t302
      t304 = t303*t291
      t306 = 1.D0+0.2016D-2*t303
      t307 = 1/t306
      t309 = t304*t211*t307
      t311 = t110*t98
      t314 = t111*t284
      t317 = -0.2625411059665811D0*t311*t292-1.D0*t314*t294
      t318 = 1/t111
      t319 = t317*t318
      t320 = t319*t97
      t322 = t279*t117
      t325 = t116**2
      t326 = 1/t325
      t327 = t93*t326
      t329 = -t287-0.2641570464738054D1*t292
      t332 = -0.2067834969664667D0*t322*t211-0.6203504908994D0*t327*t329
      t333 = t332*t298
      t336 = t122**2
      t337 = 1/t336
      t338 = t337*t291
      t340 = 1.D0+0.137284639D1*t337
      t341 = 1/t340
      t345 = t127*t117
      t348 = t128*t326
      t351 = -0.2625411059665811D0*t345*t292-1.D0*t348*t329
      t352 = 1/t128
      t353 = t351*t352
      t359 = 0.2505897912236993D-1*t333*t116+0.1903580477513215D0*t338
     #*t211*t341+0.2667310007273315D-2*t353*t116-0.5011795824473985D-1
     #*t300-0.2419143800947354D0*t309-0.4431373767749538D-2*t320
      t360 = t359*t146
      t362 = t140*t137
      t365 = t144*t137
      t368 = -0.1333333333333333D1*t362*t211+0.1333333333333333D1*t365
     #*t211
      t369 = t135*t368
      t373 = 0.19D0*rho*(0.5011795824473985D-1*t300
     #+0.2419143800947354D0*t309+0.4431373767749538D-2*t320
     #+0.1923661050931536D1*t360+0.1923661050931536D1*t369)
      vrhoa(i) = -0.99256078543904D0*t4+0.4032D-2*t155*t15+0.3024D-2
     #*t8*t175-0.1593432D0*t178*t38-0.52583256D-2*t44*t49*t191
     #+0.3654955996769919D0*t195*t200-t210+t214-t221-t225+t230-t273
     #+t274+t275+t276+t277+t373
      t376 = 1/t18/t55
      t377 = t376*sigmabb
      t380 = t28**2
      t381 = 1/t380
      t385 = t55*rhob
      t387 = 1/t56/t385
      t389 = 1/t57
      t391 = 1.D0+sigmabb*t389
      t392 = dsqrt(t391)
      t393 = 1/t392
      t396 = -0.336D-1*t23*t376*t25-0.336D-1*sigmabb*t387*t393
      t397 = t381*t396
      t403 = t56*rhob
      t407 = 0.9723306394337274D2*t403-0.1111111111111111D0*t184*sigmabb
      t411 = rhoa*t78+t50*t407-2.D0*rhob*sigmaaa
      t415 = -t200
      vrhob(i) = -0.99256078543904D0*t18+0.4032D-2*t377*t29+0.3024D-2
     #*t22*t397-0.1593432D0*t37*t38-0.52583256D-2*t44*t49*t411
     #+0.3654955996769919D0*t195*t415-t210+t214-t221-t225+t230-t273
     #+t274+t275+t276+t277+t373
      t420 = 1/t9
      t426 = 0.126D-1*t420*t7*t11+0.126D-1*t167*t171
      t427 = t159*t426
      t430 = 0.1407222222222222D-1*t33
      t431 = 0.1938888888888889D-1*t60
      t432 = t71*rhoa
      t435 = -0.25D1+t430+t431-0.1111111111111111D0*t432*t38
      t437 = t50*t435+t82-t86
      t443 = t50*t62-0.6666666666666667D0*t45
      t445 = t44*t49*t443
      t446 = 0.52583256D-2*t445
      vsigmaaa(i) = -0.3024D-2*t7*t15+0.3024D-2*t8*t427-0.52583256D-2
     #*t44*t49*t437-t446
      vsigmaab(i) = -0.105166512D-1*t445
      t450 = 1/t23
      t456 = 0.126D-1*t450*t21*t25+0.126D-1*t389*t393
      t457 = t381*t456
      t460 = t71*rhob
      t463 = -0.25D1+t430+t431-0.1111111111111111D0*t460*t38
      t465 = t50*t463+t82-t83
      vsigmabb(i) = -0.3024D-2*t21*t29+0.3024D-2*t22*t457
     #-0.52583256D-2*t44*t49*t465-t446
      t469 = 0.9192746443599945D-1*t309
      t470 = 0.1904482413300114D-1*t300
      t471 = 0.1683922031744825D-2*t320
      t472 = 0.7309911993539838D0*t360
      t473 = 0.7309911993539838D0*t369
      t478 = 0.899757936D-1*t44/t47/t216*t89
      t483 = 0.61789752D-1*t205*rhob/t32/t46
      t484 = t215*t45
      t485 = 1/t484
      t488 = 0.53015607216D-2*t222*t485*t89
      t490 = 1/t32/t484
      t491 = t490*t43
      t494 = 0.10329887159856D-3*t491*t204*t89
      t497 = 0.385610544D-1*t44*t227*t270
      t500 = 0.12234370896D-2*t222*t217*t270
      t501 = 1/t46
      t502 = rhob*t501
      t503 = t37*t502
      t504 = 0.3186864D0*t503
      t506 = t207*t36
      t510 = 1/t47/t45*t204
      t513 = 1/t203/t35
      t514 = t501*t513
      t549 = t44*t49*(t50*((-0.4378024691358025D-1*t207
     #-0.6032098765432099D-1*t506+0.3157803703703704D-1*t510
     #-0.3673578308641975D-2*t514)*sigma-1.D0*(-0.6254320987654321D-2
     #*t207-0.8617283950617284D-2*t506+0.4511148148148148D-2*t510
     #-0.5247969012345679D-3*t514)*t67-0.1111111111111111D0*
     #(0.1125777777777778D0*t207+0.1551111111111111D0*t506
     #-0.8120066666666667D-1*t510+0.9446344222222222D-2*t514)*t75
     #-0.2222222222222222D0*t251*t259-0.1111111111111111D0*t71*(2.D0
     #*rhoa*t501*sigmaaa+2.D0*t502*sigmabb))-0.1333333333333333D1
     #*sigma+0.1333333333333333D1*sigmabb+0.1333333333333333D1*sigmaaa)
      t550 = 0.52583256D-2*t549
      t553 = 0.88795591632D-3*t218*t36*t270
      t555 = 0.37486538933976D-4*t491*t219
      t559 = 1/t158/t14
      t560 = t174**2
      t565 = 1/t4/t163
      t569 = t51**2
      t575 = sigmaaa**2
      t581 = 1/t170/t169
      t588 = t469+t470+t471+t472+t473-t478+t483+t488-t494+t497-t500
     #-t504-t550-t553-t555-0.8064D-2*t155*t175-0.6048D-2*t8*t559*t560
     #+0.3024D-2*t8*t159*(0.784D-1*t9*t565*t11+0.168D0*sigmaaa/t52
     #/t569*t171-0.448D-1*t575/t4/t569/t163*t581)
      t589 = rho*t359
      t590 = t589*t200
      t593 = 1/t278/t38
      t595 = 1/t215
      t596 = t593*t98*t595
      t605 = 1/t283/t97
      t607 = t294**2
      t611 = 0.1378556646443111D0*t593*t595
      t613 = 0.4135669939329333D0*t279*t501
      t615 = 1/t290/t38
      t616 = t615*t595
      t618 = t291*t501
      t620 = -t611+t613-0.1429973890497978D1*t616+0.3431937337195148D1
     #*t618
      t625 = (-0.1378556646443111D0*t596+0.4135669939329333D0*t279
     #*t284*t211*t294+0.4135669939329333D0*t280*t501
     #+0.12407009817988D1*t93*t605*t607-0.6203504908994D0*t285*t620)
     #*t298*t97
      t628 = 1/t93/t38
      t631 = t297*t628*t97*t211
      t633 = t299*t294
      t638 = t595*t307
      t639 = 1/t302/t104*t593*t638
      t642 = t303*t615*t638
      t645 = t304*t501*t307
      t647 = t302**2
      t651 = t306**2
      t654 = 1/t647/t104*t593*t595/t651
      t672 = (0.3446391616107778D-1*t596+0.5250822119331622D0*t110
     #*t284*t292*t294-0.2187842549721509D0*t311*t616
     #+0.5250822119331622D0*t311*t618+2.D0*t111*t605*t607-1.D0*t314
     #*t620)*t318*t97
      t679 = t317/t111/t110*t97*t291*t211
      t681 = t319*t294
      t684 = t593*t117*t595
      t693 = 1/t325/t116
      t695 = t329**2
      t700 = -t611+t613-0.2201308720615045D1*t616+0.5283140929476108D1
     #*t618
      t716 = t595*t341
      t725 = t336**2
      t729 = t340**2
      s1 = 0.2505897912236993D-1*(-0.1378556646443111D0*t684
     #+0.4135669939329333D0*t279*t326*t211*t329+0.4135669939329333D0
     #*t322*t501+0.12407009817988D1*t93*t693*t695-0.6203504908994D0
     #*t327*t700)*t298*t116+0.8352993040789975D-2*t332*t628*t116*t211
     #+0.2505897912236993D-1*t333*t329+0.9995362477254242D-1/t336/t122
     #*t593*t716+0.1586317064594346D0*t337*t615*t716
     #-0.3807160955026431D0*t338*t501*t341-0.1372209729363994D0/t725
     #/t122*t593*t595/t729+0.2667310007273315D-2*
     #(0.3446391616107778D-1*t684+0.5250822119331622D0*t127*t326*t292
     #*t329-0.2187842549721509D0*t345*t616+0.5250822119331622D0*t345
     #*t618+2.D0*t128*t693*t695-1.D0*t348*t700)*t352*t116
     #+0.7002785192652656D-3*t351/t128/t127*t116*t291*t211
     #+0.2667310007273315D-2*t353*t329
      t771 = s1-0.5011795824473985D-1*t625-0.1670598608157995D-1*t631
     #-0.5011795824473985D-1*t633-0.1270249377985834D0*t639
     #-0.2015953167456128D0*t642+0.4838287601894708D0*t645
     #+0.2560822746019441D-3*t654-0.4431373767749538D-2*t672
     #-0.1163417769936259D-2*t679-0.4431373767749538D-2*t681
      t776 = t140**2
      t777 = 1/t776
      t778 = t137**2
      t784 = t144**2
      t785 = 1/t784
      t794 = 0.5011795824473985D-1*t625+0.1670598608157995D-1*t631
     #+0.5011795824473985D-1*t633+0.1270249377985834D0*t639
     #+0.2015953167456128D0*t642-0.4838287601894708D0*t645
     #-0.2560822746019441D-3*t654+0.4431373767749538D-2*t672
     #+0.1163417769936259D-2*t679+0.4431373767749538D-2*t681
     #+0.1923661050931536D1*t771*t146+0.3847322101863073D1*t359*t368
     #+0.1923661050931536D1*t135*(0.4444444444444444D0*t777*t778*t595
     #+0.2666666666666667D1*t362*t501+0.4444444444444444D0*t785*t778
     #*t595-0.2666666666666667D1*t365*t501)
      t795 = rho*t794
      t796 = 0.19D0*t795
      t814 = -0.4444444444444444D0*t777*t137*t501-0.1333333333333333D1
     #*t140*t211-0.4444444444444444D0*t785*t137*t501
     #+0.1333333333333333D1*t144*t211
      t818 = rho*(0.1923661050931536D1*t359*t200+0.1923661050931536D1
     #*t135*t814)
      t823 = 0.1423265147568D-3*t43*t513*t490*t89
      t835 = 0.384780897072D-2*t485*t43*t219
      t837 = t218*t36*t191
      t840 = t222*t217*t191
      t843 = t44*t227*t191
      t846 = t251*t38
      t849 = t71*t211
      t856 = t44*t49*(rhob*t262+t50*(-0.1111111111111111D0*t846
     #*sigmaaa+0.1111111111111111D0*t849*sigmaaa))
      t859 = rhob*t49
      t861 = 0.43129246896D-2*t513*rhoa*t859
      t862 = t135*t200
      t868 = 0.4444444444444444D0*t777*t211+0.4444444444444444D0*t785
     #*t211
      t870 = 0.3654955996769919D0*t195*t868
      t872 = t204*rhob*t207
      t874 = t178*t211
      t876 = t195*t814
      t878 = 0.3654955996769919D0*t590+t796-0.9408D-2*t565*sigmaaa*t15
     #-0.3308535951463467D0/t52+0.19D0*t818-t823-0.52583256D-2*t44*t49
     #*(2.D0*rhob*t187+0.1620551065722879D3*t182*rhob-2.D0*sigmabb)
     #+t835-0.88795591632D-3*t837-0.12234370896D-2*t840+0.385610544D-1
     #*t843-0.105166512D-1*t856-t861+0.7309911993539838D0*t862+t870
     #-0.370738512D-1*t872+0.3186864D0*t874+0.3654955996769919D0*t876
      v2rhoa2(i) = t588+t878
      t879 = t135*t415
      t884 = 1/t380/t28
      t885 = t396**2
      t890 = 1/t18/t385
      t894 = t55**2
      t900 = sigmabb**2
      t906 = 1/t392/t391
      t923 = t218*t36*t411
      t926 = t222*t217*t411
      t929 = t44*t227*t411
      t940 = t44*t49*(rhoa*t262+t50*(-0.1111111111111111D0*t846
     #*sigmabb+0.1111111111111111D0*t849*sigmabb))
      t942 = t469+t470+t471+t472+t473+0.7309911993539838D0*t879
     #-0.8064D-2*t377*t397-0.6048D-2*t22*t884*t885+0.3024D-2*t22*t381*
     #(0.784D-1*t23*t890*t25+0.168D0*sigmabb/t56/t894*t393-0.448D-1
     #*t900/t18/t894/t385*t906)-0.52583256D-2*t44*t49*(2.D0*rhoa*t407
     #+0.1620551065722879D3*rhoa*t403-2.D0*sigmaaa)-0.88795591632D-3
     #*t923-0.12234370896D-2*t926+0.385610544D-1*t929-0.105166512D-1
     #*t940-t478+t483+t488-t494
      t950 = -t814
      t954 = rho*(0.1923661050931536D1*t359*t415+0.1923661050931536D1
     #*t135*t950)
      t956 = t205*t207
      t958 = t37*t211
      t960 = t195*t950
      t962 = t589*t415
      t964 = t497-t500-t504-t550-t553-t555-0.9408D-2*t890*sigmabb*t29
     #-0.3308535951463467D0/t56+0.19D0*t954-0.370738512D-1*t956
     #+0.3186864D0*t958+0.3654955996769919D0*t960+0.3654955996769919D0
     #*t962+t796-t823+t835-t861+t870
      v2rhob2(i) = t942+t964
      t974 = -t478+t483+t488-t494+t497-t500-0.3186864D0*t503
     #-0.52583256D-2*t549-t553-t555+0.182747799838496D0*t590
      t1003 = -0.6117185448D-3*t840+0.192805272D-1*t843-0.52583256D-2
     #*t856-t861+0.3654955996769919D0*t862-0.185369256D-1*t872
     #+0.1593432D0*t874+0.182747799838496D0*t876-0.52583256D-2*t44*t49
     #*(t54+t58+t63-t69-t77+rhob*t407+rhoa*t187)-0.1593432D0*t36*t38
     #-0.3654955996769919D0*t195*t868
      v2rhoab(i) = t469+t470+t471+t472+t473+0.3654955996769919D0*t879
     #-0.44397795816D-3*t923-0.6117185448D-3*t926+0.192805272D-1*t929
     #-0.52583256D-2*t940+t974+0.95D-1*t954-0.185369256D-1*t956
     #+0.1593432D0*t958+0.182747799838496D0*t960+0.182747799838496D0
     #*t962+0.19D0*t795+0.95D-1*t818-t823+t835-0.44397795816D-3*t837
     #+t1003
      t1009 = t7*t159
      t1033 = 0.1111111111111111D0*t50*t184
      t1040 = 0.44397795816D-3*t218*t36*t437
      t1043 = 0.6117185448D-3*t222*t217*t437
      t1046 = 0.192805272D-1*t44*t227*t437
      t1047 = 0.4690740740740741D-2*t232
      t1048 = 0.6462962962962963D-2*t234
      t1049 = 0.2255574074074074D-2*t238
      t1057 = 0.1333333333333333D1*rho
      t1061 = 0.52583256D-2*t44*t49*(t50*(-t1047-t1048+t1049
     #-0.1111111111111111D0*t251*rhoa*t38+0.1111111111111111D0*t432
     #*t211)+t1057)
      t1063 = t44*t859*t62
      t1064 = 0.52583256D-2*t1063
      t1066 = t218*t36*t443
      t1067 = 0.44397795816D-3*t1066
      t1069 = t222*t217*t443
      t1070 = 0.6117185448D-3*t1069
      t1072 = t44*t227*t443
      t1073 = 0.192805272D-1*t1072
      t1078 = t44*t49*(t50*t240-0.1333333333333333D1*rho)
      t1079 = 0.52583256D-2*t1078
      v2rhoasigmaaa(i) = 0.4032D-2*t154*t15-0.4032D-2*t155*t427
     #+0.3024D-2*t1009*t174-0.6048D-2*t8*t559*t174*t426+0.3024D-2*t8
     #*t159*(-0.168D-1*t420*t154*t11-0.504D-1*t165*t171+0.168D-1
     #*sigmaaa/t4/t569/t51*t581)-0.52583256D-2*t44*t49*(rhob*t435
     #-t1033)-t1040-t1043+t1046-t1061-t1064-t1067-t1070+t1073-t1079
      t1081 = 0.88795591632D-3*t1066
      t1082 = 0.12234370896D-2*t1069
      t1083 = 0.385610544D-1*t1072
      t1084 = 0.105166512D-1*t1078
      v2rhoasigmaab(i) = -0.105166512D-1*t1063-t1081-t1082+t1083-t1084
      t1093 = 0.44397795816D-3*t218*t36*t465
      t1096 = 0.6117185448D-3*t222*t217*t465
      t1099 = 0.192805272D-1*t44*t227*t465
      t1110 = 0.52583256D-2*t44*t49*(t50*(-t1047-t1048+t1049
     #-0.1111111111111111D0*t251*rhob*t38+0.1111111111111111D0*t460
     #*t211)+t1057)
      v2rhoasigmabb(i) = -0.52583256D-2*t44*t49*(rhob*t463-2.D0*rhoa)
     #-t1093-t1096+t1099-t1110-t1064-t1067-t1070+t1073-t1079
      t1119 = t44*t49*rhoa*t62
      t1120 = 0.52583256D-2*t1119
      v2rhobsigmaaa(i) = -0.52583256D-2*t44*t49*(rhoa*t435-2.D0*rhob)
     #-t1040-t1043+t1046-t1061-t1120-t1067-t1070+t1073-t1079
      v2rhobsigmaab(i) = -0.105166512D-1*t1119-t1081-t1082+t1083-t1084
      t1126 = t21*t381
      v2rhobsigmabb(i) = 0.4032D-2*t376*t29-0.4032D-2*t377*t457
     #+0.3024D-2*t1126*t396-0.6048D-2*t22*t884*t396*t456+0.3024D-2*t22
     #*t381*(-0.168D-1*t450*t376*t25-0.504D-1*t387*t393+0.168D-1
     #*sigmabb/t18/t894/t55*t906)-0.52583256D-2*t44*t49*(rhoa*t463
     #-t1033)-t1093-t1096+t1099-t1110-t1120-t1067-t1070+t1073-t1079
      t1155 = t426**2
      v2sigmaaa2(i) = 0.6048D-2*t1009*t426-0.6048D-2*t8*t559*t1155
     #+0.3024D-2*t8*t159*(-0.63D-2/t9/sigmaaa*t7*t11+0.63D-2/sigmaaa
     #*t167*t171-0.63D-2/t4/t569/rhoa*t581)
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      t1179 = t456**2
      v2sigmabb2(i) = 0.6048D-2*t1126*t456-0.6048D-2*t22*t884*t1179
     #+0.3024D-2*t22*t381*(-0.63D-2/t23/sigmabb*t21*t25+0.63D-2
     #/sigmabb*t389*t393-0.63D-2/t18/t894/rhob*t906)
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      v2rhob2(i) = 0.0d0
      v2rhoab(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2rhoasigmaab(i) = 0.0d0
      v2rhoasigmabb(i) = 0.0d0
      v2rhobsigmaaa(i) = 0.0d0
      v2rhobsigmaab(i) = 0.0d0
      v2rhobsigmabb(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      v2sigmaab2(i) = 0.0d0
      v2sigmabb2(i) = 0.0d0
      v2sigmaaaab(i) = 0.0d0
      v2sigmaaabb(i) = 0.0d0
      v2sigmaabbb(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end
      
      
      subroutine rks_xc_b3lyp
     & (ideriv,npt,rhoa1,sigmaaa1,
     &  zk,vrhoa,vsigmaaa,
     &  v2rhoa2,v2rhoasigmaaa,v2sigmaaa2)
c
c     P.J. Stephens, F.J. Devlin, C.F. Chabalowski, M.J. Frisch
c     Ab initio calculation of vibrational absorption and circular 
c     dichroism spectra using density functional force fields
c     J. Phys. Chem. 98 (1994) 11623-11627
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt)
      REAL sigmaaa1(npt)
      REAL zk(npt),vrhoa(npt),vsigmaaa(npt)
      REAL v2rhoa2(npt),v2rhoasigmaaa(npt),v2sigmaaa2(npt)
      parameter(tol=1.0d-20)
      
      if(ideriv.eq.0) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t3 = t2*rho
      t5 = 1/t3
      t7 = dsqrt(sigma)
      t8 = t7*t5
      t10 = dlog(0.1259921049894873D1*t8+dsqrt(1+0.1587401051968199D1
     #*t8**2))
      t17 = 1/t2
      t20 = 1/(1.D0+0.349D0*t17)
      t23 = 0.2533D0*t17
      t24 = dexp(-t23)
      t26 = rho**2
      t28 = t2**2
      t34 = t17*t20
      t56 = 1/rho
      t57 = t56**(1.D0/3.D0)
      t59 = t56**(1.D0/6.D0)
      t62 = 1/(0.6203504908994D0*t57+0.1029581201158544D2*t59
     #+0.427198D2)
      t65 = dlog(0.6203504908994D0*t57*t62)
      t71 = datan(0.448998886412873D-1/(0.1575246635799487D1*t59
     #+0.13072D2))
      t75 = (0.7876233178997433D0*t59+0.409286D0)**2
      t77 = dlog(t75*t62)
      zk(i) = -0.5908470131056179D0*t3-0.3810001254882096D-2*t5*sigma/
     #(1.D0+0.317500104573508D-1*t8*t10)-0.398358D-1*t20*rho
     #-0.52583256D-2*t24*t20/t28/t26/rho*(0.25D0*t26*
     #(0.1148493600075277D2*t28*t26+(0.2611111111111111D1
     #-0.9850555555555556D-1*t17-0.1357222222222222D0*t34)*sigma-0.5D0
     #*(0.25D1-0.1407222222222222D-1*t17-0.1938888888888889D-1*t34)
     #*sigma-0.2777777777777778D-1*(t23+0.349D0*t34-11.D0)*sigma)
     #-0.4583333333333333D0*t26*sigma)+0.19D0*rho*(0.310907D-1*t65
     #+0.205219729378375D2*t71+0.4431373767749538D-2*t77)
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t3 = t2*rho
      t5 = 1/t3
      t6 = t5*sigma
      t7 = dsqrt(sigma)
      t8 = t7*t5
      t10 = dlog(0.1259921049894873D1*t8+dsqrt(1+0.1587401051968199D1
     #*t8**2))
      t13 = 1.D0+0.317500104573508D-1*t8*t10
      t14 = 1/t13
      t17 = 1/t2
      t19 = 1.D0+0.349D0*t17
      t20 = 1/t19
      t23 = 0.2533D0*t17
      t24 = dexp(-t23)
      t25 = t24*t20
      t26 = rho**2
      t28 = t2**2
      t30 = 1/t28/t26/rho
      t31 = t28*t26
      t34 = t17*t20
      t36 = 0.2611111111111111D1-0.9850555555555556D-1*t17
     #-0.1357222222222222D0*t34
      t44 = t23+0.349D0*t34-11.D0
      t47 = 0.1148493600075277D2*t31+t36*sigma-0.5D0*(0.25D1
     #-0.1407222222222222D-1*t17-0.1938888888888889D-1*t34)*sigma
     #-0.2777777777777778D-1*t44*sigma
      t52 = 0.25D0*t26*t47-0.4583333333333333D0*t26*sigma
      t56 = 1/rho
      t57 = t56**(1.D0/3.D0)
      t59 = t56**(1.D0/6.D0)
      t61 = 0.6203504908994D0*t57+0.1029581201158544D2*t59+0.427198D2
      t62 = 1/t61
      t65 = dlog(0.6203504908994D0*t57*t62)
      t68 = 0.1575246635799487D1*t59+0.13072D2
      t71 = datan(0.448998886412873D-1/t68)
      t74 = 0.7876233178997433D0*t59+0.409286D0
      t75 = t74**2
      t77 = dlog(t75*t62)
      zk(i) = -0.5908470131056179D0*t3-0.3810001254882096D-2*t6*t14
     #-0.398358D-1*t20*rho-0.52583256D-2*t25*t30*t52+0.19D0*rho*
     #(0.310907D-1*t65+0.205219729378375D2*t71+0.4431373767749538D-2
     #*t77)
      t84 = 1/t2/t26
      t88 = t13**2
      t89 = 1/t88
      t94 = 1/t31
      t98 = dsqrt(1.D0+0.1587401051968199D1*sigma*t94)
      t99 = 1/t98
      t109 = t28*rho
      t112 = t44*t56*sigma
      t117 = rho*sigma
      t123 = t19**2
      t124 = 1/t123
      t127 = t26**2
      t129 = 1/t127/rho
      t144 = t5*t20
      t146 = 1/t109
      t147 = t146*t124
      t175 = t57**2
      t176 = 1/t175
      t178 = 1/t26
      t181 = t61**2
      t182 = 1/t181
      t186 = t59**2
      t187 = t186**2
      t189 = 1/t187/t59
      t190 = t189*t178
      t192 = -0.2067834969664667D0*t176*t178-0.1715968668597574D1*t190
      t200 = t68**2
      t201 = 1/t200
      s1 = -0.7877960174741572D0*t2+0.5080001673176129D-2*t84*sigma
     #*t14+0.1905000627441048D-2*t6*t89*(-0.8466669455293548D-1*t7*t84
     #*t10-0.106673350692263D0*sigma*t30*t99)-0.398358D-1*t20
     #-0.52583256D-2*t25*t30*(0.5D0*rho*t47+0.25D0*t26*
     #(0.3062649600200738D2*t109-0.2777777777777778D-1*t112)-0.25D0
     #*t117)-0.46342314D-2*t124*t17-0.44397795816D-3*t129*t24*t20*t52
      s2 = s1-0.6117185448D-3*t24*t124*t129*t52+0.192805272D-1*t25/t28
     #/t127*t52-0.52583256D-2*t25*t30*(0.25D0*t26*(
     #(0.3283518518518519D-1*t5+0.4524074074074074D-1*t144
     #-0.1578901851851852D-1*t147)*sigma-0.5D0*(0.4690740740740741D-2
     #*t5+0.6462962962962963D-2*t144-0.2255574074074074D-2*t147)*sigma
     #-0.2777777777777778D-1*(-0.8443333333333333D-1*t5
     #-0.1163333333333333D0*t144+0.4060033333333333D-1*t147)*sigma
     #+0.2777777777777778D-1*t112)-0.6666666666666667D0*t117)
      vrhoa(i) = s2+0.5907233D-2*t65+0.3899174858189126D1*t71
     #+0.8419610158724123D-3*t77+0.19D0*rho*(0.5011795824473985D-1*(
     #-0.2067834969664667D0*t176*t62*t178-0.6203504908994D0*t57*t182
     #*t192)/t57*t61+0.2419143800947354D0*t201*t189*t178/(1.D0
     #+0.2016D-2*t201)+0.4431373767749538D-2*(-0.2625411059665811D0
     #*t74*t62*t190-1.D0*t75*t182*t192)/t75*t61)
      vsigmaaa(i) = -0.1524000501952839D-1*t5*t14
     #+0.3810001254882096D-2*t6*t89*(0.6350002091470161D-1/t7*t5*t10
     #+0.8000501301919725D-1*t94*t99)+0.5842584D-3*t25*t146
     #-0.210333024D-1*t25*t30*(0.25D0*t26*t36-0.6666666666666667D0*t26)
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t3 = t2*rho
      t5 = 1/t3
      t6 = t5*sigma
      t7 = dsqrt(sigma)
      t8 = t7*t5
      t10 = dlog(0.1259921049894873D1*t8+dsqrt(1+0.1587401051968199D1
     #*t8**2))
      t13 = 1.D0+0.317500104573508D-1*t8*t10
      t14 = 1/t13
      t17 = 1/t2
      t19 = 1.D0+0.349D0*t17
      t20 = 1/t19
      t23 = 0.2533D0*t17
      t24 = dexp(-t23)
      t25 = t24*t20
      t26 = rho**2
      t27 = t26*rho
      t28 = t2**2
      t30 = 1/t28/t27
      t31 = t28*t26
      t32 = 0.1148493600075277D2*t31
      t34 = t17*t20
      t36 = 0.2611111111111111D1-0.9850555555555556D-1*t17
     #-0.1357222222222222D0*t34
      t37 = t36*sigma
      t42 = 0.5D0*(0.25D1-0.1407222222222222D-1*t17
     #-0.1938888888888889D-1*t34)*sigma
      t44 = t23+0.349D0*t34-11.D0
      t46 = 0.2777777777777778D-1*t44*sigma
      t47 = t32+t37-t42-t46
      t52 = 0.25D0*t26*t47-0.4583333333333333D0*t26*sigma
      t56 = 1/rho
      t57 = t56**(1.D0/3.D0)
      t59 = t56**(1.D0/6.D0)
      t61 = 0.6203504908994D0*t57+0.1029581201158544D2*t59+0.427198D2
      t62 = 1/t61
      t65 = dlog(0.6203504908994D0*t57*t62)
      t68 = 0.1575246635799487D1*t59+0.13072D2
      t71 = datan(0.448998886412873D-1/t68)
      t74 = 0.7876233178997433D0*t59+0.409286D0
      t75 = t74**2
      t77 = dlog(t75*t62)
      zk(i) = -0.5908470131056179D0*t3-0.3810001254882096D-2*t6*t14
     #-0.398358D-1*t20*rho-0.52583256D-2*t25*t30*t52+0.19D0*rho*
     #(0.310907D-1*t65+0.205219729378375D2*t71+0.4431373767749538D-2
     #*t77)
      t84 = 1/t2/t26
      t85 = t84*sigma
      t88 = t13**2
      t89 = 1/t88
      t94 = 1/t31
      t97 = 1.D0+0.1587401051968199D1*sigma*t94
      t98 = dsqrt(t97)
      t99 = 1/t98
      t102 = -0.8466669455293548D-1*t7*t84*t10-0.106673350692263D0
     #*sigma*t30*t99
      t103 = t89*t102
      t109 = t28*rho
      t111 = t44*t56
      t112 = t111*sigma
      t114 = 0.3062649600200738D2*t109-0.2777777777777778D-1*t112
      t117 = rho*sigma
      t119 = 0.5D0*rho*t47+0.25D0*t26*t114-0.25D0*t117
      t123 = t19**2
      t124 = 1/t123
      t127 = t26**2
      t128 = t127*rho
      t129 = 1/t128
      t130 = t129*t24
      t131 = t20*t52
      t134 = t24*t124
      t139 = 1/t28/t127
      t144 = t5*t20
      t146 = 1/t109
      t147 = t146*t124
      t149 = 0.3283518518518519D-1*t5+0.4524074074074074D-1*t144
     #-0.1578901851851852D-1*t147
      t160 = -0.8443333333333333D-1*t5-0.1163333333333333D0*t144
     #+0.4060033333333333D-1*t147
      t164 = t149*sigma-0.5D0*(0.4690740740740741D-2*t5
     #+0.6462962962962963D-2*t144-0.2255574074074074D-2*t147)*sigma
     #-0.2777777777777778D-1*t160*sigma+0.2777777777777778D-1*t112
      t168 = 0.25D0*t26*t164-0.6666666666666667D0*t117
      t175 = t57**2
      t176 = 1/t175
      t177 = t176*t62
      t178 = 1/t26
      t181 = t61**2
      t182 = 1/t181
      t183 = t57*t182
      t186 = t59**2
      t187 = t186**2
      t188 = t187*t59
      t189 = 1/t188
      t190 = t189*t178
      t192 = -0.2067834969664667D0*t176*t178-0.1715968668597574D1*t190
      t195 = -0.2067834969664667D0*t177*t178-0.6203504908994D0*t183*t192
      t196 = 1/t57
      t197 = t195*t196
      t198 = t197*t61
      t200 = t68**2
      t201 = 1/t200
      t202 = t201*t189
      t204 = 1.D0+0.2016D-2*t201
      t205 = 1/t204
      t207 = t202*t178*t205
      t209 = t74*t62
      t212 = t75*t182
      t215 = -0.2625411059665811D0*t209*t190-1.D0*t212*t192
      t216 = 1/t75
      t217 = t215*t216
      t218 = t217*t61
      vrhoa(i) = -0.7877960174741572D0*t2+0.5080001673176129D-2*t85
     #*t14+0.1905000627441048D-2*t6*t103-0.398358D-1*t20-0.52583256D-2
     #*t25*t30*t119-0.46342314D-2*t124*t17-0.44397795816D-3*t130*t131
     #-0.6117185448D-3*t134*t129*t52+0.192805272D-1*t25*t139*t52
     #-0.52583256D-2*t25*t30*t168+0.5907233D-2*t65
     #+0.3899174858189126D1*t71+0.8419610158724123D-3*t77+0.19D0*rho*
     #(0.5011795824473985D-1*t198+0.2419143800947354D0*t207
     #+0.4431373767749538D-2*t218)
      t225 = 1/t7
      t231 = 0.6350002091470161D-1*t225*t5*t10+0.8000501301919725D-1
     #*t94*t99
      t232 = t89*t231
      t240 = 0.25D0*t26*t36-0.6666666666666667D0*t26
      vsigmaaa(i) = -0.1524000501952839D-1*t5*t14
     #+0.3810001254882096D-2*t6*t232+0.5842584D-3*t25*t146
     #-0.210333024D-1*t25*t30*t240
      t254 = 1/t2/t27
      t258 = rho*t114
      t269 = 1/t123/t19
      t271 = t127*t26
      t273 = 1/t2/t271
      t277 = 1/t271
      t287 = t84*t20
      t289 = t94*t124
      t291 = 1/t27
      t292 = t291*t269
      t311 = t160*t56*sigma
      t314 = t44*t178*sigma
      s1 = -0.177591183264D-2*t130*t20*t119-0.24468741792D-2*t134*t129
     #*t119+0.771221088D-1*t25*t139*t119-0.2370667447482193D-1*t254
     #*sigma*t14-0.52583256D-2*t25*t30*(t258+0.2552208000167282D2*t31
     #-0.5D0*sigma)+0.771221088D-1*t25*t139*t168
      s2 = s1-0.2846530295136D-3*t24*t269*t273*t52+0.106031214432D-1
     #*t134*t277*t52-0.1799515872D0*t25/t28/t128*t52
      t342 = s2-0.105166512D-1*t25*t30*(0.25D0*t26*((
     #-0.4378024691358025D-1*t84-0.6032098765432099D-1*t287
     #+0.3157803703703704D-1*t289-0.3673578308641975D-2*t292)*sigma
     #-0.5D0*(-0.6254320987654321D-2*t84-0.8617283950617284D-2*t287
     #+0.4511148148148148D-2*t289-0.5247969012345679D-3*t292)*sigma
     #-0.2777777777777778D-1*(0.1125777777777778D0*t84
     #+0.1551111111111111D0*t287-0.8120066666666667D-1*t289
     #+0.9446344222222222D-2*t292)*sigma+0.5555555555555556D-1*t311
     #-0.5555555555555556D-1*t314)-0.6666666666666667D0*sigma)
     #+0.769561794144D-2*t277*t24*t131-0.52583256D-2*t25*t30*(t32+t37
     #-t42-t46+t258)-0.210333024D-1*t25*t30*(0.5D0*rho*t164+0.25D0*t26
     #*(-0.2777777777777778D-1*t311+0.2777777777777778D-1*t314))
      t346 = t273*t24
      t363 = sigma**2
      t369 = 1/t98/t97
      t377 = 1/t88/t13
      t378 = t102**2
      t392 = 1/t175/t56
      t394 = 1/t127
      t395 = t392*t62*t394
      t404 = 1/t181/t61
      t406 = t192**2
      t414 = 1/t188/t56
      t415 = t414*t394
      t417 = t189*t291
      t419 = -0.1378556646443111D0*t392*t394+0.4135669939329333D0*t176
     #*t291-0.1429973890497978D1*t415+0.3431937337195148D1*t417
      t437 = t394*t205
      t446 = t200**2
      t450 = t204**2
      s1 = -0.177591183264D-2*t130*t20*t168-0.74973077867952D-4*t346
     #*t131-0.20659774319712D-3*t346*t124*t52+0.1838549288719989D0
     #*t207+0.3808964826600229D-1*t198+0.3367844063489649D-2*t218
     #-0.1016000334635226D-1*t85*t103
      s2 = s1+0.1905000627441048D-2*t6*t89*(0.3951112412470322D0*t7
     #*t254*t10+0.106673350692263D1*sigma*t139*t99
     #-0.4515557042823225D0*t363/t2/t127/t27*t369)
     #-0.3810001254882096D-2*t6*t377*t378-0.24468741792D-2*t134*t129
     #*t168
      s3 = s2-0.5251973449827715D0/t28
      s4 = s3-0.61789752D-2*t124*t5
      s5 = s4
      s7 = -0.21564623448D-2*t269*t146
      s8 = 0.38D0*rho*(0.5011795824473985D-1*(-0.1378556646443111D0
     #*t395+0.4135669939329333D0*t176*t182*t178*t192
     #+0.4135669939329333D0*t177*t291+0.12407009817988D1*t57*t404*t406
     #-0.6203504908994D0*t183*t419)*t196*t61+0.1670598608157995D-1
     #*t195/t57/t56*t61*t178+0.5011795824473985D-1*t197*t192
     #+0.1270249377985834D0/t200/t68*t392*t437+0.2015953167456128D0
     #*t201*t414*t437-0.4838287601894708D0*t202*t291*t205
     #-0.2560822746019441D-3/t446/t68*t392*t394/t450
     #+0.4431373767749538D-2*(0.3446391616107778D-1*t395
     #+0.5250822119331622D0*t74*t182*t190*t192-0.2187842549721509D0
     #*t209*t415+0.5250822119331622D0*t209*t417+2.D0*t75*t404*t406
     #-1.D0*t212*t419)*t216*t61+0.1163417769936259D-2*t215/t75/t74*t61
     #*t189*t178+0.4431373767749538D-2*t217*t192)
      s6 = s7+s8
      t485 = s5+s6
      v2rhoa2(i) = t342+t485
      t490 = t5*t89
      s1 = 0.2032000669270451D-1*t84*t14-0.5080001673176129D-2*t85
     #*t232+0.7620002509764193D-2*t490*t102-0.3810001254882096D-2*t6
     #*t377*t102*t231+0.1905000627441048D-2*t6*t89*(
     #-0.169333389105871D0*t225*t84*t10-0.640040104153578D0*t30*t99
     #+0.3386667782117419D0*sigma*t273*t369)-0.52583256D-2*t25*t30*(
     #-0.9444444444444444D0*rho-0.2777777777777778D-1*rho*t44)
     #+0.4933088424D-4*t291*t24*t20
      v2rhoasigmaaa(i) = s1+0.679687272D-4*t134*t291+0.80822412D-2*t25
     #*t94-0.105166512D-1*t25*t30*(0.25D0*t26*(-0.3D-22*t144
     #+0.5555555555555556D-1*t111)+0.1333333333333333D1*rho)
     #-0.105166512D-1*t25*t94*t36-0.177591183264D-2*t130*t20*t240
     #-0.24468741792D-2*t134*t129*t240+0.771221088D-1*t25*t139*t240
     #-0.210333024D-1*t25*t30*(0.25D0*t26*t149-0.1333333333333333D1*rho)
      t554 = t231**2
      v2sigmaaa2(i) = 0.3048001003905677D-1*t490*t231
     #-0.7620002509764193D-2*t6*t377*t554+0.3810001254882096D-2*t6*t89
     #*(-0.1270000418294032D0/t7/sigma*t5*t10+0.1600100260383945D0
     #/sigma*t94*t99-0.2540000836588064D0/t2/t128*t369)
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end

c:XC_B3LYPsubrend
_ENDIF
_IF(ccpdft,all,xc_b3lyp_vwn5)
c:XC_B3LYP_VWN5subrstart

c    Generated: Tue Sep  2 09:00:26 GMT 2003

      subroutine uks_xc_b3lyp_vwn5
     & (ideriv,npt,rhoa1,rhob1,sigmaaa1,sigmabb1,sigmaab1,
     &  zk,vrhoa,vrhob,vsigmaaa,vsigmabb,vsigmaab,
     &  v2rhoa2,v2rhob2,v2rhoab,
     &  v2rhoasigmaaa,v2rhoasigmaab,v2rhoasigmabb,
     &  v2rhobsigmabb,v2rhobsigmaab,v2rhobsigmaaa,
     &  v2sigmaaa2,v2sigmaaaab,v2sigmaaabb,
     &  v2sigmaab2,v2sigmaabbb,v2sigmabb2)
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt),rhob1(npt)
      REAL sigmaaa1(npt),sigmabb1(npt),sigmaab1(npt)
      REAL zk(npt),vrhoa(npt),vrhob(npt)
      REAL vsigmaaa(npt),vsigmabb(npt),vsigmaab(npt)
      REAL v2rhoa2(npt),v2rhob2(npt),v2rhoab(npt)
      REAL v2rhoasigmaaa(npt),v2rhoasigmaab(npt)
      REAL v2rhoasigmabb(npt),v2rhobsigmabb(npt)
      REAL v2rhobsigmaab(npt),v2rhobsigmaaa(npt)
      REAL v2sigmaaa2(npt),v2sigmaaaab(npt),v2sigmaaabb(npt)
      REAL v2sigmaab2(npt),v2sigmaabbb(npt),v2sigmabb2(npt)
      parameter(tol=1.0d-20)
      
      if (ideriv.eq.0) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t3 = t2*rhob
      t5 = 1/t3
      t7 = dsqrt(sigmabb)
      t8 = t7*t5
      t9 = dlog(t8+dsqrt(1+t8**2))
      t16 = 1/rhob
      t17 = t16**(1.D0/3.D0)
      t19 = t16**(1.D0/6.D0)
      t22 = 1/(0.6203504908994D0*t17+0.5560951426165705D1*t19
     #+0.180578D2)
      t25 = dlog(0.6203504908994D0*t17*t22)
      t31 = datan(0.4730926909560113D1/(0.1575246635799487D1*t19
     #+0.706042D1))
      t35 = (0.7876233178997433D0*t19+0.325D0)**2
      t37 = dlog(t35*t22)
      zk(i) = -0.74442058907928D0*t3-0.3024D-2*t5*sigmabb/(1.D0
     #+0.252D-1*t8*t9)+0.19D0*rhob*(0.1554535D-1*t25
     #+0.5249139316978094D-1*t31+0.2247867095542612D-2*t37)
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t3 = t2*rhoa
      t5 = 1/t3
      t7 = dsqrt(sigmaaa)
      t8 = t7*t5
      t9 = dlog(t8+dsqrt(1+t8**2))
      t16 = 1/rhoa
      t17 = t16**(1.D0/3.D0)
      t19 = t16**(1.D0/6.D0)
      t22 = 1/(0.6203504908994D0*t17+0.5560951426165705D1*t19
     #+0.180578D2)
      t25 = dlog(0.6203504908994D0*t17*t22)
      t31 = datan(0.4730926909560113D1/(0.1575246635799487D1*t19
     #+0.706042D1))
      t35 = (0.7876233178997433D0*t19+0.325D0)**2
      t37 = dlog(t35*t22)
      zk(i) = -0.74442058907928D0*t3-0.3024D-2*t5*sigmaaa/(1.D0
     #+0.252D-1*t8*t9)+0.19D0*rhoa*(0.1554535D-1*t25
     #+0.5249139316978094D-1*t31+0.2247867095542612D-2*t37)
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t5 = t4*rhoa
      t7 = 1/t5
      t9 = dsqrt(sigmaaa)
      t10 = t9*t7
      t11 = dlog(t10+dsqrt(1+t10**2))
      t18 = rhob**(1.D0/3.D0)
      t19 = t18*rhob
      t21 = 1/t19
      t23 = dsqrt(sigmabb)
      t24 = t23*t21
      t25 = dlog(t24+dsqrt(1+t24**2))
      t32 = rho**(1.D0/3.D0)
      t33 = 1/t32
      t36 = 1/(1.D0+0.349D0*t33)
      t38 = 1/rho
      t39 = rhob*t38
      t42 = 0.2533D0*t33
      t43 = dexp(-t42)
      t45 = rho**2
      t47 = t32**2
      t51 = rhoa**2
      t52 = t4**2
      t55 = rhob**2
      t56 = t18**2
      t60 = t33*t36
      t82 = 0.6666666666666667D0*t45
      t93 = t38**(1.D0/3.D0)
      t94 = 0.6203504908994D0*t93
      t95 = t38**(1.D0/6.D0)
      t98 = 1/(t94+0.2935818660072219D1*t95+0.129352D2)
      t101 = dlog(0.6203504908994D0*t93*t98)
      t103 = 0.1575246635799487D1*t95
      t107 = datan(0.615199081975908D1/(t103+0.372744D1))
      t109 = 0.7876233178997433D0*t95
      t111 = (t109+0.10498D0)**2
      t113 = dlog(t111*t98)
      t117 = 1/(t94+0.8908571061768626D0*t95+0.130045D2)
      t120 = dlog(0.6203504908994D0*t93*t117)
      t124 = datan(0.7123108917818118D1/(t103+0.113107D1))
      t127 = (t109+0.47584D-2)**2
      t129 = dlog(t127*t117)
      t131 = t120+0.3177080047439415D0*t124+0.4140337942820627D-3*t129
      t133 = rhoa-1.D0*rhob
      t134 = t133*t38
      t135 = 1.D0+t134
      t136 = t135**(1.D0/3.D0)
      t139 = 1.D0-1.D0*t134
      t140 = t139**(1.D0/3.D0)
      t146 = 1/(t94+0.5560951426165705D1*t95+0.180578D2)
      t149 = dlog(0.6203504908994D0*t93*t146)
      t154 = datan(0.4730926909560113D1/(t103+0.706042D1))
      t157 = (t109+0.325D0)**2
      t159 = dlog(t157*t146)
      t169 = t133**2
      t170 = t169**2
      t172 = t45**2
      s1 = -0.74442058907928D0*t5-0.3024D-2*t7*sigmaaa/(1.D0+0.252D-1
     #*t10*t11)-0.74442058907928D0*t19
      s2 = s1-0.3024D-2*t21*sigmabb/(1.D0+0.252D-1*t24*t25)
      s3 = s2-0.1593432D0*t36*rhoa*t39
      s4 = s3
      s6 = -0.52583256D-2*t43*t36/t47/t45/rho*(rhoa*rhob*
     #(0.3646239897876478D2*t52*t51+0.3646239897876478D2*t56*t55+
     #(0.2611111111111111D1-0.9850555555555556D-1*t33
     #-0.1357222222222222D0*t60)*sigma-1.D0*(0.25D1
     #-0.1407222222222222D-1*t33-0.1938888888888889D-1*t60)*(sigmaaa
     #+sigmabb)-0.1111111111111111D0*(t42+0.349D0*t60-11.D0)*(rhoa*t38
     #*sigmaaa+t39*sigmabb))-0.6666666666666667D0*t45*sigma+(t82-1.D0
     #*t51)*sigmabb+(t82-1.D0*t55)*sigmaaa)
      s7 = 0.19D0*rho*(0.310907D-1*t101+0.3878329487811301D-1*t107
     #+0.9690227711544374D-3*t113-0.1899772193293833D-1*t131*(t136
     #*t135+t140*t139-2.D0)*(1.D0+(-0.101257459063883D3*(0.1554535D-1
     #*t149+0.5249139316978094D-1*t154+0.2247867095542612D-2*t159
     #-0.310907D-1*t101-0.3878329487811301D-1*t107
     #-0.9690227711544374D-3*t113)/t131-1.D0)*t170/t172))
      s5 = s6+s7
      zk(i) = s4+s5
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t3 = t2*rhob
      t5 = 1/t3
      t6 = t5*sigmabb
      t7 = dsqrt(sigmabb)
      t8 = t7*t5
      t9 = dlog(t8+dsqrt(1+t8**2))
      t12 = 1.D0+0.252D-1*t8*t9
      t13 = 1/t12
      t16 = 1/rhob
      t17 = t16**(1.D0/3.D0)
      t19 = t16**(1.D0/6.D0)
      t21 = 0.6203504908994D0*t17+0.5560951426165705D1*t19+0.180578D2
      t22 = 1/t21
      t25 = dlog(0.6203504908994D0*t17*t22)
      t28 = 0.1575246635799487D1*t19+0.706042D1
      t31 = datan(0.4730926909560113D1/t28)
      t34 = 0.7876233178997433D0*t19+0.325D0
      t35 = t34**2
      t37 = dlog(t35*t22)
      zk(i) = -0.74442058907928D0*t3-0.3024D-2*t6*t13+0.19D0*rhob*
     #(0.1554535D-1*t25+0.5249139316978094D-1*t31
     #+0.2247867095542612D-2*t37)
      vrhoa(i) = 0.D0
      t43 = rhob**2
      t45 = 1/t2/t43
      t49 = t12**2
      t50 = 1/t49
      t55 = t2**2
      t60 = 1/t55/t43
      t63 = dsqrt(1.D0+sigmabb*t60)
      t64 = 1/t63
      t74 = t17**2
      t75 = 1/t74
      t77 = 1/t43
      t80 = t21**2
      t81 = 1/t80
      t85 = t19**2
      t86 = t85**2
      t88 = 1/t86/t19
      t89 = t88*t77
      t91 = -0.2067834969664667D0*t75*t77-0.9268252376942842D0*t89
      t99 = t28**2
      t100 = 1/t99
      vrhob(i) = -0.99256078543904D0*t2+0.4032D-2*t45*sigmabb*t13
     #+0.3024D-2*t6*t50*(-0.336D-1*t7*t45*t9-0.336D-1*sigmabb/t55/t43
     #/rhob*t64)+0.29536165D-2*t25+0.9973364702258378D-2*t31
     #+0.4270947481530962D-3*t37+0.19D0*rhob*(0.2505897912236993D-1*(
     #-0.2067834969664667D0*t75*t22*t77-0.6203504908994D0*t17*t81*t91)
     #/t17*t21+0.6519760588836059D-1*t100*t88*t77/(1.D0
     #+0.223816694236D2*t100)+0.2247867095542612D-2*(
     #-0.2625411059665811D0*t34*t22*t89-1.D0*t35*t81*t91)/t35*t21)
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      vsigmabb(i) = -0.3024D-2*t5*t13+0.3024D-2*t6*t50*(0.126D-1/t7*t5
     #*t9+0.126D-1*t60*t64)
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t3 = t2*rhoa
      t5 = 1/t3
      t6 = t5*sigmaaa
      t7 = dsqrt(sigmaaa)
      t8 = t7*t5
      t9 = dlog(t8+dsqrt(1+t8**2))
      t12 = 1.D0+0.252D-1*t8*t9
      t13 = 1/t12
      t16 = 1/rhoa
      t17 = t16**(1.D0/3.D0)
      t19 = t16**(1.D0/6.D0)
      t21 = 0.6203504908994D0*t17+0.5560951426165705D1*t19+0.180578D2
      t22 = 1/t21
      t25 = dlog(0.6203504908994D0*t17*t22)
      t28 = 0.1575246635799487D1*t19+0.706042D1
      t31 = datan(0.4730926909560113D1/t28)
      t34 = 0.7876233178997433D0*t19+0.325D0
      t35 = t34**2
      t37 = dlog(t35*t22)
      zk(i) = -0.74442058907928D0*t3-0.3024D-2*t6*t13+0.19D0*rhoa*
     #(0.1554535D-1*t25+0.5249139316978094D-1*t31
     #+0.2247867095542612D-2*t37)
      t43 = rhoa**2
      t45 = 1/t2/t43
      t49 = t12**2
      t50 = 1/t49
      t55 = t2**2
      t60 = 1/t55/t43
      t63 = dsqrt(1.D0+sigmaaa*t60)
      t64 = 1/t63
      t74 = t17**2
      t75 = 1/t74
      t77 = 1/t43
      t80 = t21**2
      t81 = 1/t80
      t85 = t19**2
      t86 = t85**2
      t88 = 1/t86/t19
      t89 = t88*t77
      t91 = -0.2067834969664667D0*t75*t77-0.9268252376942842D0*t89
      t99 = t28**2
      t100 = 1/t99
      vrhoa(i) = -0.99256078543904D0*t2+0.4032D-2*t45*sigmaaa*t13
     #+0.3024D-2*t6*t50*(-0.336D-1*t7*t45*t9-0.336D-1*sigmaaa/t55/t43
     #/rhoa*t64)+0.29536165D-2*t25+0.9973364702258378D-2*t31
     #+0.4270947481530962D-3*t37+0.19D0*rhoa*(0.2505897912236993D-1*(
     #-0.2067834969664667D0*t75*t22*t77-0.6203504908994D0*t17*t81*t91)
     #/t17*t21+0.6519760588836059D-1*t100*t88*t77/(1.D0
     #+0.223816694236D2*t100)+0.2247867095542612D-2*(
     #-0.2625411059665811D0*t34*t22*t89-1.D0*t35*t81*t91)/t35*t21)
      vrhob(i) = 0.D0
      vsigmaaa(i) = -0.3024D-2*t5*t13+0.3024D-2*t6*t50*(0.126D-1/t7*t5
     #*t9+0.126D-1*t60*t64)
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t5 = t4*rhoa
      t7 = 1/t5
      t8 = t7*sigmaaa
      t9 = dsqrt(sigmaaa)
      t10 = t9*t7
      t11 = dlog(t10+dsqrt(1+t10**2))
      t14 = 1.D0+0.252D-1*t10*t11
      t15 = 1/t14
      t18 = rhob**(1.D0/3.D0)
      t19 = t18*rhob
      t21 = 1/t19
      t22 = t21*sigmabb
      t23 = dsqrt(sigmabb)
      t24 = t23*t21
      t25 = dlog(t24+dsqrt(1+t24**2))
      t28 = 1.D0+0.252D-1*t24*t25
      t29 = 1/t28
      t32 = rho**(1.D0/3.D0)
      t33 = 1/t32
      t35 = 1.D0+0.349D0*t33
      t36 = 1/t35
      t37 = t36*rhoa
      t38 = 1/rho
      t39 = rhob*t38
      t42 = 0.2533D0*t33
      t43 = dexp(-t42)
      t44 = t43*t36
      t45 = rho**2
      t47 = t32**2
      t49 = 1/t47/t45/rho
      t50 = rhoa*rhob
      t51 = rhoa**2
      t52 = t4**2
      t53 = t52*t51
      t55 = rhob**2
      t56 = t18**2
      t57 = t56*t55
      t60 = t33*t36
      t62 = 0.2611111111111111D1-0.9850555555555556D-1*t33
     #-0.1357222222222222D0*t60
      t67 = sigmaaa+sigmabb
      t71 = t42+0.349D0*t60-11.D0
      t75 = rhoa*t38*sigmaaa+t39*sigmabb
      t78 = 0.3646239897876478D2*t53+0.3646239897876478D2*t57+t62
     #*sigma-1.D0*(0.25D1-0.1407222222222222D-1*t33
     #-0.1938888888888889D-1*t60)*t67-0.1111111111111111D0*t71*t75
      t82 = 0.6666666666666667D0*t45
      t83 = 1.D0*t51
      t86 = 1.D0*t55
      t89 = t50*t78-0.6666666666666667D0*t45*sigma+(t82-t83)*sigmabb+
     #(t82-t86)*sigmaaa
      t93 = t38**(1.D0/3.D0)
      t94 = 0.6203504908994D0*t93
      t95 = t38**(1.D0/6.D0)
      t97 = t94+0.2935818660072219D1*t95+0.129352D2
      t98 = 1/t97
      t101 = dlog(0.6203504908994D0*t93*t98)
      t103 = 0.1575246635799487D1*t95
      t104 = t103+0.372744D1
      t107 = datan(0.615199081975908D1/t104)
      t109 = 0.7876233178997433D0*t95
      t110 = t109+0.10498D0
      t111 = t110**2
      t113 = dlog(t111*t98)
      t116 = t94+0.8908571061768626D0*t95+0.130045D2
      t117 = 1/t116
      t120 = dlog(0.6203504908994D0*t93*t117)
      t121 = t103+0.113107D1
      t124 = datan(0.7123108917818118D1/t121)
      t126 = t109+0.47584D-2
      t127 = t126**2
      t129 = dlog(t127*t117)
      t131 = t120+0.3177080047439415D0*t124+0.4140337942820627D-3*t129
      t133 = rhoa-1.D0*rhob
      t134 = t133*t38
      t135 = 1.D0+t134
      t136 = t135**(1.D0/3.D0)
      t139 = 1.D0-1.D0*t134
      t140 = t139**(1.D0/3.D0)
      t142 = t136*t135+t140*t139-2.D0
      t143 = t131*t142
      t145 = t94+0.5560951426165705D1*t95+0.180578D2
      t146 = 1/t145
      t149 = dlog(0.6203504908994D0*t93*t146)
      t151 = t103+0.706042D1
      t154 = datan(0.4730926909560113D1/t151)
      t156 = t109+0.325D0
      t157 = t156**2
      t159 = dlog(t157*t146)
      t164 = 0.1554535D-1*t149+0.5249139316978094D-1*t154
     #+0.2247867095542612D-2*t159-0.310907D-1*t101
     #-0.3878329487811301D-1*t107-0.9690227711544374D-3*t113
      t165 = 1/t131
      t168 = -0.101257459063883D3*t164*t165-1.D0
      t169 = t133**2
      t170 = t169**2
      t171 = t168*t170
      t172 = t45**2
      t173 = 1/t172
      t175 = 1.D0+t171*t173
      t176 = t143*t175
      zk(i) = -0.74442058907928D0*t5-0.3024D-2*t8*t15
     #-0.74442058907928D0*t19-0.3024D-2*t22*t29-0.1593432D0*t37*t39
     #-0.52583256D-2*t44*t49*t89+0.19D0*rho*(0.310907D-1*t101
     #+0.3878329487811301D-1*t107+0.9690227711544374D-3*t113
     #-0.1899772193293833D-1*t176)
      t183 = 1/t4/t51
      t187 = t14**2
      t188 = 1/t187
      t196 = 1/t53
      t199 = dsqrt(1.D0+sigmaaa*t196)
      t200 = 1/t199
      t213 = t71*t38
      t228 = 0.1333333333333333D1*t136*t38-0.1333333333333333D1*t140*t38
      t235 = t143*t168*t169*t133*t173
      t240 = t35**2
      t241 = 1/t240
      t247 = 0.185369256D-1*t241*rhoa*rhob/t32/t45
      t248 = 1/t45
      t249 = rhob*t248
      t251 = 0.1593432D0*t37*t249
      t253 = 1/t172/rho
      t257 = 0.44397795816D-3*t253*t43*t36*t89
      t261 = 0.6117185448D-3*t43*t241*t253*t89
      t266 = 0.192805272D-1*t44/t47/t172*t89
      t268 = 1/t32/rho
      t270 = t268*t36
      t274 = 1/t47/rho*t241
      t309 = 0.52583256D-2*t44*t49*(t50*((0.3283518518518519D-1*t268
     #+0.4524074074074074D-1*t270-0.1578901851851852D-1*t274)*sigma
     #-1.D0*(0.4690740740740741D-2*t268+0.6462962962962963D-2*t270
     #-0.2255574074074074D-2*t274)*t67-0.1111111111111111D0*(
     #-0.8443333333333333D-1*t268-0.1163333333333333D0*t270
     #+0.4060033333333333D-1*t274)*t75-0.1111111111111111D0*t71*(-1.D0
     #*rhoa*t248*sigmaaa-1.D0*t249*sigmabb))-0.1333333333333333D1*rho
     #*sigma+0.1333333333333333D1*rho*sigmabb+0.1333333333333333D1*rho
     #*sigmaaa)
      t310 = 0.5907233D-2*t101
      t311 = 0.7368826026841473D-2*t107
      t312 = 0.1841143265193431D-3*t113
      t313 = 0.3609567167258283D-2*t176
      t314 = t93**2
      t315 = 1/t314
      t319 = t97**2
      t320 = 1/t319
      t323 = 0.2067834969664667D0*t315*t248
      t324 = t95**2
      t325 = t324**2
      t327 = 1/t325/t95
      t328 = t327*t248
      t330 = -t323-0.4893031100120365D0*t328
      t334 = 1/t93
      t336 = (-0.2067834969664667D0*t315*t98*t248-0.6203504908994D0
     #*t93*t320*t330)*t334*t97
      t338 = t104**2
      t339 = 1/t338
      t345 = t339*t327*t248/(1.D0+0.378469910464D2*t339)
      t356 = (-0.2625411059665811D0*t110*t98*t328-1.D0*t111*t320*t330)
     #/t111*t97
      t361 = t116**2
      t362 = 1/t361
      t365 = -t323-0.1484761843628104D0*t328
      t372 = t121**2
      t373 = 1/t372
      t392 = 0.161199195401647D1*(-0.2067834969664667D0*t315*t117*t248
     #-0.6203504908994D0*t93*t362*t365)*t334*t116+0.5941485651138659D0
     #*t373*t327*t248/(1.D0+0.507386806551D2*t373)
     #+0.4140337942820627D-3*(-0.2625411059665811D0*t126*t117*t328
     #-1.D0*t127*t362*t365)/t127*t116
      t409 = t145**2
      t410 = 1/t409
      t413 = -t323-0.9268252376942842D0*t328
      t420 = t151**2
      t421 = 1/t420
      t446 = t131**2
      t461 = 0.19D0*rho*(0.5011795824473985D-1*t336
     #+0.626408570946439D-1*t345+0.9690227711544374D-3*t356
     #-0.1899772193293833D-1*t392*t142*t175-0.1899772193293833D-1*t131
     #*(-0.1333333333333333D1*t136*t133*t248+0.1333333333333333D1*t140
     #*t133*t248)*t175-0.1899772193293833D-1*t143*((
     #-0.101257459063883D3*(0.2505897912236993D-1*(
     #-0.2067834969664667D0*t315*t146*t248-0.6203504908994D0*t93*t410
     #*t413)*t334*t145+0.6519760588836059D-1*t421*t327*t248/(1.D0
     #+0.223816694236D2*t421)+0.2247867095542612D-2*(
     #-0.2625411059665811D0*t156*t146*t328-1.D0*t157*t410*t413)/t157
     #*t145-0.5011795824473985D-1*t336-0.626408570946439D-1*t345
     #-0.9690227711544374D-3*t356)*t165+0.101257459063883D3*t164/t446
     #*t392)*t170*t173-4.D0*t171*t253))
      vrhoa(i) = -0.99256078543904D0*t4+0.4032D-2*t183*sigmaaa*t15
     #+0.3024D-2*t8*t188*(-0.336D-1*t9*t183*t11-0.336D-1*sigmaaa/t52
     #/t51/rhoa*t200)-0.1593432D0*t36*rhob*t38-0.52583256D-2*t44*t49*
     #(rhob*t78+t50*(0.9723306394337274D2*t52*rhoa
     #-0.1111111111111111D0*t213*sigmaaa)-2.D0*rhoa*sigmabb)+0.19D0
     #*rho*(-0.1899772193293833D-1*t131*t228*t175
     #-0.7599088773175333D-1*t235)-t247+t251-t257-t261+t266-t309+t310
     #+t311+t312-t313+t461
      t464 = 1/t18/t55
      t468 = t28**2
      t469 = 1/t468
      t477 = 1/t57
      t480 = dsqrt(1.D0+sigmabb*t477)
      t481 = 1/t480
      vrhob(i) = -0.99256078543904D0*t18+0.4032D-2*t464*sigmabb*t29
     #+0.3024D-2*t22*t469*(-0.336D-1*t23*t464*t25-0.336D-1*sigmabb/t56
     #/t55/rhob*t481)-0.1593432D0*t37*t38-0.52583256D-2*t44*t49*(rhoa
     #*t78+t50*(0.9723306394337274D2*t56*rhob-0.1111111111111111D0
     #*t213*sigmabb)-2.D0*rhob*sigmaaa)+0.19D0*rho*
     #(0.1899772193293833D-1*t131*t228*t175+0.7599088773175333D-1*t235
     #)-t247+t251-t257-t261+t266-t309+t310+t311+t312-t313+t461
      t523 = 0.1407222222222222D-1*t33
      t524 = 0.1938888888888889D-1*t60
      t538 = t44*t49*(t50*t62-0.6666666666666667D0*t45)
      t539 = 0.52583256D-2*t538
      vsigmaaa(i) = -0.3024D-2*t7*t15+0.3024D-2*t8*t188*(0.126D-1/t9
     #*t7*t11+0.126D-1*t196*t200)-0.52583256D-2*t44*t49*(t50*(-0.25D1
     #+t523+t524-0.1111111111111111D0*t71*rhoa*t38)+t82-t86)-t539
      vsigmaab(i) = -0.105166512D-1*t538
      vsigmabb(i) = -0.3024D-2*t21*t29+0.3024D-2*t22*t469*(0.126D-1
     #/t23*t21*t25+0.126D-1*t477*t481)-0.52583256D-2*t44*t49*(t50*(
     #-0.25D1+t523+t524-0.1111111111111111D0*t71*rhob*t38)+t82-t83)-t539
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t3 = t2*rhob
      t5 = 1/t3
      t6 = t5*sigmabb
      t7 = dsqrt(sigmabb)
      t8 = t7*t5
      t9 = dlog(t8+dsqrt(1+t8**2))
      t12 = 1.D0+0.252D-1*t8*t9
      t13 = 1/t12
      t16 = 1/rhob
      t17 = t16**(1.D0/3.D0)
      t19 = t16**(1.D0/6.D0)
      t21 = 0.6203504908994D0*t17+0.5560951426165705D1*t19+0.180578D2
      t22 = 1/t21
      t25 = dlog(0.6203504908994D0*t17*t22)
      t28 = 0.1575246635799487D1*t19+0.706042D1
      t31 = datan(0.4730926909560113D1/t28)
      t34 = 0.7876233178997433D0*t19+0.325D0
      t35 = t34**2
      t37 = dlog(t35*t22)
      zk(i) = -0.74442058907928D0*t3-0.3024D-2*t6*t13+0.19D0*rhob*
     #(0.1554535D-1*t25+0.5249139316978094D-1*t31
     #+0.2247867095542612D-2*t37)
      vrhoa(i) = 0.D0
      t43 = rhob**2
      t45 = 1/t2/t43
      t46 = t45*sigmabb
      t49 = t12**2
      t50 = 1/t49
      t54 = t43*rhob
      t55 = t2**2
      t60 = 1/t55/t43
      t62 = 1.D0+sigmabb*t60
      t63 = dsqrt(t62)
      t64 = 1/t63
      t67 = -0.336D-1*t7*t45*t9-0.336D-1*sigmabb/t55/t54*t64
      t68 = t50*t67
      t74 = t17**2
      t75 = 1/t74
      t76 = t75*t22
      t77 = 1/t43
      t80 = t21**2
      t81 = 1/t80
      t82 = t17*t81
      t85 = t19**2
      t86 = t85**2
      t87 = t86*t19
      t88 = 1/t87
      t89 = t88*t77
      t91 = -0.2067834969664667D0*t75*t77-0.9268252376942842D0*t89
      t94 = -0.2067834969664667D0*t76*t77-0.6203504908994D0*t82*t91
      t95 = 1/t17
      t96 = t94*t95
      t97 = t96*t21
      t99 = t28**2
      t100 = 1/t99
      t101 = t100*t88
      t103 = 1.D0+0.223816694236D2*t100
      t104 = 1/t103
      t106 = t101*t77*t104
      t108 = t34*t22
      t111 = t35*t81
      t114 = -0.2625411059665811D0*t108*t89-1.D0*t111*t91
      t115 = 1/t35
      t116 = t114*t115
      t117 = t116*t21
      vrhob(i) = -0.99256078543904D0*t2+0.4032D-2*t46*t13+0.3024D-2*t6
     #*t68+0.29536165D-2*t25+0.9973364702258378D-2*t31
     #+0.4270947481530962D-3*t37+0.19D0*rhob*(0.2505897912236993D-1
     #*t97+0.6519760588836059D-1*t106+0.2247867095542612D-2*t117)
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      t130 = 0.126D-1/t7*t5*t9+0.126D-1*t60*t64
      vsigmabb(i) = -0.3024D-2*t5*t13+0.3024D-2*t6*t50*t130
      v2rhoa2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t137 = 1/t2/t54
      t144 = 1/t49/t12
      t145 = t67**2
      t152 = t43**2
      t158 = sigmabb**2
      t164 = 1/t63/t62
      t175 = 1/t74/t16
      t177 = 1/t152
      t178 = t175*t22*t177
      t184 = 1/t54
      t188 = 1/t80/t21
      t190 = t91**2
      t198 = 1/t87/t16
      t199 = t198*t177
      t201 = t88*t184
      t203 = -0.1378556646443111D0*t175*t177+0.4135669939329333D0*t75
     #*t184-0.7723543647452368D0*t199+0.1853650475388568D1*t201
      t221 = t177*t104
      t230 = t99**2
      t234 = t103**2
      s1 = -0.3308535951463467D0/t55-0.9408D-2*t137*sigmabb*t13
     #-0.8064D-2*t46*t68-0.6048D-2*t6*t144*t145
      s2 = s1+0.3024D-2*t6*t50*(0.784D-1*t7*t137*t9+0.168D0*sigmabb
     #/t55/t152*t64-0.448D-1*t158/t2/t152/t54*t164)
     #+0.9522412066500572D-2*t97
      s3 = s2+0.2477509023757703D-1*t106
      s4 = s3
      s5 = 0.8541894963061925D-3*t117+0.19D0*rhob*
     #(0.2505897912236993D-1*(-0.1378556646443111D0*t178
     #+0.4135669939329333D0*t75*t81*t77*t91+0.4135669939329333D0*t76
     #*t184+0.12407009817988D1*t17*t188*t190-0.6203504908994D0*t82
     #*t203)*t95*t21+0.8352993040789975D-2*t94/t17/t16*t21*t77
     #+0.2505897912236993D-1*t96*t91+0.3423410311260694D-1/t99/t28
     #*t175*t221+0.5433133824030049D-1*t100*t198*t221
     #-0.1303952117767212D0*t101*t184*t104-0.7662163788798043D0/t230
     #/t28*t175*t177/t234+0.2247867095542612D-2*(0.3446391616107778D-1
     #*t178+0.5250822119331622D0*t34*t81*t89*t91-0.2187842549721509D0
     #*t108*t199+0.5250822119331622D0*t108*t201+2.D0*t35*t188*t190
     #-1.D0*t111*t203)*t115*t21+0.5901575133296437D-3*t114/t35/t34*t21
     #*t88*t77+0.2247867095542612D-2*t116*t91)
      v2rhob2(i) = s4+s5
      v2sigmaaa2(i) = 0.D0
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      t272 = t130**2
      v2sigmabb2(i) = 0.6048D-2*t5*t50*t130-0.6048D-2*t6*t144*t272
     #+0.3024D-2*t6*t50*(-0.63D-2/t7/sigmabb*t5*t9+0.63D-2/sigmabb*t60
     #*t64-0.63D-2/t2/t152/rhob*t164)
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t3 = t2*rhoa
      t5 = 1/t3
      t6 = t5*sigmaaa
      t7 = dsqrt(sigmaaa)
      t8 = t7*t5
      t9 = dlog(t8+dsqrt(1+t8**2))
      t12 = 1.D0+0.252D-1*t8*t9
      t13 = 1/t12
      t16 = 1/rhoa
      t17 = t16**(1.D0/3.D0)
      t19 = t16**(1.D0/6.D0)
      t21 = 0.6203504908994D0*t17+0.5560951426165705D1*t19+0.180578D2
      t22 = 1/t21
      t25 = dlog(0.6203504908994D0*t17*t22)
      t28 = 0.1575246635799487D1*t19+0.706042D1
      t31 = datan(0.4730926909560113D1/t28)
      t34 = 0.7876233178997433D0*t19+0.325D0
      t35 = t34**2
      t37 = dlog(t35*t22)
      zk(i) = -0.74442058907928D0*t3-0.3024D-2*t6*t13+0.19D0*rhoa*
     #(0.1554535D-1*t25+0.5249139316978094D-1*t31
     #+0.2247867095542612D-2*t37)
      t43 = rhoa**2
      t45 = 1/t2/t43
      t46 = t45*sigmaaa
      t49 = t12**2
      t50 = 1/t49
      t54 = t43*rhoa
      t55 = t2**2
      t60 = 1/t55/t43
      t62 = 1.D0+sigmaaa*t60
      t63 = dsqrt(t62)
      t64 = 1/t63
      t67 = -0.336D-1*t7*t45*t9-0.336D-1*sigmaaa/t55/t54*t64
      t68 = t50*t67
      t74 = t17**2
      t75 = 1/t74
      t76 = t75*t22
      t77 = 1/t43
      t80 = t21**2
      t81 = 1/t80
      t82 = t17*t81
      t85 = t19**2
      t86 = t85**2
      t87 = t86*t19
      t88 = 1/t87
      t89 = t88*t77
      t91 = -0.2067834969664667D0*t75*t77-0.9268252376942842D0*t89
      t94 = -0.2067834969664667D0*t76*t77-0.6203504908994D0*t82*t91
      t95 = 1/t17
      t96 = t94*t95
      t97 = t96*t21
      t99 = t28**2
      t100 = 1/t99
      t101 = t100*t88
      t103 = 1.D0+0.223816694236D2*t100
      t104 = 1/t103
      t106 = t101*t77*t104
      t108 = t34*t22
      t111 = t35*t81
      t114 = -0.2625411059665811D0*t108*t89-1.D0*t111*t91
      t115 = 1/t35
      t116 = t114*t115
      t117 = t116*t21
      vrhoa(i) = -0.99256078543904D0*t2+0.4032D-2*t46*t13+0.3024D-2*t6
     #*t68+0.29536165D-2*t25+0.9973364702258378D-2*t31
     #+0.4270947481530962D-3*t37+0.19D0*rhoa*(0.2505897912236993D-1
     #*t97+0.6519760588836059D-1*t106+0.2247867095542612D-2*t117)
      vrhob(i) = 0.D0
      t130 = 0.126D-1/t7*t5*t9+0.126D-1*t60*t64
      vsigmaaa(i) = -0.3024D-2*t5*t13+0.3024D-2*t6*t50*t130
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      t137 = 1/t2/t54
      t144 = 1/t49/t12
      t145 = t67**2
      t152 = t43**2
      t158 = sigmaaa**2
      t164 = 1/t63/t62
      t175 = 1/t74/t16
      t177 = 1/t152
      t178 = t175*t22*t177
      t184 = 1/t54
      t188 = 1/t80/t21
      t190 = t91**2
      t198 = 1/t87/t16
      t199 = t198*t177
      t201 = t88*t184
      t203 = -0.1378556646443111D0*t175*t177+0.4135669939329333D0*t75
     #*t184-0.7723543647452368D0*t199+0.1853650475388568D1*t201
      t221 = t177*t104
      t230 = t99**2
      t234 = t103**2
      s1 = -0.3308535951463467D0/t55-0.9408D-2*t137*sigmaaa*t13
     #-0.8064D-2*t46*t68-0.6048D-2*t6*t144*t145
      s2 = s1+0.3024D-2*t6*t50*(0.784D-1*t7*t137*t9+0.168D0*sigmaaa
     #/t55/t152*t64-0.448D-1*t158/t2/t152/t54*t164)
     #+0.9522412066500572D-2*t97
      s3 = s2+0.2477509023757703D-1*t106
      s4 = s3
      s5 = 0.8541894963061925D-3*t117+0.19D0*rhoa*
     #(0.2505897912236993D-1*(-0.1378556646443111D0*t178
     #+0.4135669939329333D0*t75*t81*t77*t91+0.4135669939329333D0*t76
     #*t184+0.12407009817988D1*t17*t188*t190-0.6203504908994D0*t82
     #*t203)*t95*t21+0.8352993040789975D-2*t94/t17/t16*t21*t77
     #+0.2505897912236993D-1*t96*t91+0.3423410311260694D-1/t99/t28
     #*t175*t221+0.5433133824030049D-1*t100*t198*t221
     #-0.1303952117767212D0*t101*t184*t104-0.7662163788798043D0/t230
     #/t28*t175*t177/t234+0.2247867095542612D-2*(0.3446391616107778D-1
     #*t178+0.5250822119331622D0*t34*t81*t89*t91-0.2187842549721509D0
     #*t108*t199+0.5250822119331622D0*t108*t201+2.D0*t35*t188*t190
     #-1.D0*t111*t203)*t115*t21+0.5901575133296437D-3*t114/t35/t34*t21
     #*t88*t77+0.2247867095542612D-2*t116*t91)
      v2rhoa2(i) = s4+s5
      v2rhob2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t272 = t130**2
      v2sigmaaa2(i) = 0.6048D-2*t5*t50*t130-0.6048D-2*t6*t144*t272
     #+0.3024D-2*t6*t50*(-0.63D-2/t7/sigmaaa*t5*t9+0.63D-2/sigmaaa*t60
     #*t64-0.63D-2/t2/t152/rhoa*t164)
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      v2sigmabb2(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t5 = t4*rhoa
      t7 = 1/t5
      t8 = t7*sigmaaa
      t9 = dsqrt(sigmaaa)
      t10 = t9*t7
      t11 = dlog(t10+dsqrt(1+t10**2))
      t14 = 1.D0+0.252D-1*t10*t11
      t15 = 1/t14
      t18 = rhob**(1.D0/3.D0)
      t19 = t18*rhob
      t21 = 1/t19
      t22 = t21*sigmabb
      t23 = dsqrt(sigmabb)
      t24 = t23*t21
      t25 = dlog(t24+dsqrt(1+t24**2))
      t28 = 1.D0+0.252D-1*t24*t25
      t29 = 1/t28
      t32 = rho**(1.D0/3.D0)
      t33 = 1/t32
      t35 = 1.D0+0.349D0*t33
      t36 = 1/t35
      t37 = t36*rhoa
      t38 = 1/rho
      t39 = rhob*t38
      t42 = 0.2533D0*t33
      t43 = dexp(-t42)
      t44 = t43*t36
      t45 = rho**2
      t46 = t45*rho
      t47 = t32**2
      t49 = 1/t47/t46
      t50 = rhoa*rhob
      t51 = rhoa**2
      t52 = t4**2
      t53 = t52*t51
      t54 = 0.3646239897876478D2*t53
      t55 = rhob**2
      t56 = t18**2
      t57 = t56*t55
      t58 = 0.3646239897876478D2*t57
      t60 = t33*t36
      t62 = 0.2611111111111111D1-0.9850555555555556D-1*t33
     #-0.1357222222222222D0*t60
      t63 = t62*sigma
      t67 = sigmaaa+sigmabb
      t69 = 1.D0*(0.25D1-0.1407222222222222D-1*t33
     #-0.1938888888888889D-1*t60)*t67
      t71 = t42+0.349D0*t60-11.D0
      t75 = rhoa*t38*sigmaaa+t39*sigmabb
      t77 = 0.1111111111111111D0*t71*t75
      t78 = t54+t58+t63-t69-t77
      t82 = 0.6666666666666667D0*t45
      t83 = 1.D0*t51
      t86 = 1.D0*t55
      t89 = t50*t78-0.6666666666666667D0*t45*sigma+(t82-t83)*sigmabb+
     #(t82-t86)*sigmaaa
      t93 = t38**(1.D0/3.D0)
      t94 = 0.6203504908994D0*t93
      t95 = t38**(1.D0/6.D0)
      t97 = t94+0.2935818660072219D1*t95+0.129352D2
      t98 = 1/t97
      t101 = dlog(0.6203504908994D0*t93*t98)
      t103 = 0.1575246635799487D1*t95
      t104 = t103+0.372744D1
      t107 = datan(0.615199081975908D1/t104)
      t109 = 0.7876233178997433D0*t95
      t110 = t109+0.10498D0
      t111 = t110**2
      t113 = dlog(t111*t98)
      t116 = t94+0.8908571061768626D0*t95+0.130045D2
      t117 = 1/t116
      t120 = dlog(0.6203504908994D0*t93*t117)
      t121 = t103+0.113107D1
      t124 = datan(0.7123108917818118D1/t121)
      t126 = t109+0.47584D-2
      t127 = t126**2
      t129 = dlog(t127*t117)
      t131 = t120+0.3177080047439415D0*t124+0.4140337942820627D-3*t129
      t133 = rhoa-1.D0*rhob
      t134 = t133*t38
      t135 = 1.D0+t134
      t136 = t135**(1.D0/3.D0)
      t139 = 1.D0-1.D0*t134
      t140 = t139**(1.D0/3.D0)
      t142 = t136*t135+t140*t139-2.D0
      t143 = t131*t142
      t145 = t94+0.5560951426165705D1*t95+0.180578D2
      t146 = 1/t145
      t149 = dlog(0.6203504908994D0*t93*t146)
      t151 = t103+0.706042D1
      t154 = datan(0.4730926909560113D1/t151)
      t156 = t109+0.325D0
      t157 = t156**2
      t159 = dlog(t157*t146)
      t164 = 0.1554535D-1*t149+0.5249139316978094D-1*t154
     #+0.2247867095542612D-2*t159-0.310907D-1*t101
     #-0.3878329487811301D-1*t107-0.9690227711544374D-3*t113
      t165 = 1/t131
      t168 = -0.101257459063883D3*t164*t165-1.D0
      t169 = t133**2
      t170 = t169**2
      t171 = t168*t170
      t172 = t45**2
      t173 = 1/t172
      t175 = 1.D0+t171*t173
      t176 = t143*t175
      zk(i) = -0.74442058907928D0*t5-0.3024D-2*t8*t15
     #-0.74442058907928D0*t19-0.3024D-2*t22*t29-0.1593432D0*t37*t39
     #-0.52583256D-2*t44*t49*t89+0.19D0*rho*(0.310907D-1*t101
     #+0.3878329487811301D-1*t107+0.9690227711544374D-3*t113
     #-0.1899772193293833D-1*t176)
      t183 = 1/t4/t51
      t184 = t183*sigmaaa
      t187 = t14**2
      t188 = 1/t187
      t192 = t51*rhoa
      t194 = 1/t52/t192
      t196 = 1/t53
      t198 = 1.D0+sigmaaa*t196
      t199 = dsqrt(t198)
      t200 = 1/t199
      t203 = -0.336D-1*t9*t183*t11-0.336D-1*sigmaaa*t194*t200
      t204 = t188*t203
      t207 = t36*rhob
      t211 = t52*rhoa
      t213 = t71*t38
      t216 = 0.9723306394337274D2*t211-0.1111111111111111D0*t213*sigmaaa
      t220 = rhob*t78+t50*t216-2.D0*rhoa*sigmabb
      t228 = 0.1333333333333333D1*t136*t38-0.1333333333333333D1*t140*t38
      t229 = t131*t228
      t230 = t229*t175
      t232 = t169*t133
      t233 = t168*t232
      t234 = t233*t173
      t235 = t143*t234
      t240 = t35**2
      t241 = 1/t240
      t242 = t241*rhoa
      t244 = 1/t32/t45
      t247 = 0.185369256D-1*t242*rhob*t244
      t248 = 1/t45
      t249 = rhob*t248
      t251 = 0.1593432D0*t37*t249
      t252 = t172*rho
      t253 = 1/t252
      t254 = t253*t43
      t255 = t36*t89
      t257 = 0.44397795816D-3*t254*t255
      t258 = t43*t241
      t261 = 0.6117185448D-3*t258*t253*t89
      t263 = 1/t47/t172
      t266 = 0.192805272D-1*t44*t263*t89
      t268 = 1/t32/rho
      t270 = t268*t36
      t274 = 1/t47/rho*t241
      t276 = 0.3283518518518519D-1*t268+0.4524074074074074D-1*t270
     #-0.1578901851851852D-1*t274
      t287 = -0.8443333333333333D-1*t268-0.1163333333333333D0*t270
     #+0.4060033333333333D-1*t274
      t295 = -1.D0*rhoa*t248*sigmaaa-1.D0*t249*sigmabb
      t298 = t276*sigma-1.D0*(0.4690740740740741D-2*t268
     #+0.6462962962962963D-2*t270-0.2255574074074074D-2*t274)*t67
     #-0.1111111111111111D0*t287*t75-0.1111111111111111D0*t71*t295
      t306 = t50*t298-0.1333333333333333D1*rho*sigma
     #+0.1333333333333333D1*rho*sigmabb+0.1333333333333333D1*rho*sigmaaa
      t309 = 0.52583256D-2*t44*t49*t306
      t310 = 0.5907233D-2*t101
      t311 = 0.7368826026841473D-2*t107
      t312 = 0.1841143265193431D-3*t113
      t313 = 0.3609567167258283D-2*t176
      t314 = t93**2
      t315 = 1/t314
      t316 = t315*t98
      t319 = t97**2
      t320 = 1/t319
      t321 = t93*t320
      t323 = 0.2067834969664667D0*t315*t248
      t324 = t95**2
      t325 = t324**2
      t326 = t325*t95
      t327 = 1/t326
      t328 = t327*t248
      t330 = -t323-0.4893031100120365D0*t328
      t333 = -0.2067834969664667D0*t316*t248-0.6203504908994D0*t321*t330
      t334 = 1/t93
      t335 = t333*t334
      t336 = t335*t97
      t338 = t104**2
      t339 = 1/t338
      t340 = t339*t327
      t342 = 1.D0+0.378469910464D2*t339
      t343 = 1/t342
      t345 = t340*t248*t343
      t347 = t110*t98
      t350 = t111*t320
      t353 = -0.2625411059665811D0*t347*t328-1.D0*t350*t330
      t354 = 1/t111
      t355 = t353*t354
      t356 = t355*t97
      t358 = t315*t117
      t361 = t116**2
      t362 = 1/t361
      t363 = t93*t362
      t365 = -t323-0.1484761843628104D0*t328
      t368 = -0.2067834969664667D0*t358*t248-0.6203504908994D0*t363*t365
      t369 = t368*t334
      t372 = t121**2
      t373 = 1/t372
      t374 = t373*t327
      t376 = 1.D0+0.507386806551D2*t373
      t377 = 1/t376
      t381 = t126*t117
      t384 = t127*t362
      t387 = -0.2625411059665811D0*t381*t328-1.D0*t384*t365
      t388 = 1/t127
      t389 = t387*t388
      t392 = 0.161199195401647D1*t369*t116+0.5941485651138659D0*t374
     #*t248*t377+0.4140337942820627D-3*t389*t116
      t393 = t392*t142
      t394 = t393*t175
      t396 = t136*t133
      t399 = t140*t133
      t402 = -0.1333333333333333D1*t396*t248+0.1333333333333333D1*t399
     #*t248
      t403 = t131*t402
      t404 = t403*t175
      t406 = t315*t146
      t409 = t145**2
      t410 = 1/t409
      t411 = t93*t410
      t413 = -t323-0.9268252376942842D0*t328
      t416 = -0.2067834969664667D0*t406*t248-0.6203504908994D0*t411*t413
      t417 = t416*t334
      t420 = t151**2
      t421 = 1/t420
      t422 = t421*t327
      t424 = 1.D0+0.223816694236D2*t421
      t425 = 1/t424
      t429 = t156*t146
      t432 = t157*t410
      t435 = -0.2625411059665811D0*t429*t328-1.D0*t432*t413
      t436 = 1/t157
      t437 = t435*t436
      t443 = 0.2505897912236993D-1*t417*t145+0.6519760588836059D-1
     #*t422*t248*t425+0.2247867095542612D-2*t437*t145
     #-0.5011795824473985D-1*t336-0.626408570946439D-1*t345
     #-0.9690227711544374D-3*t356
      t446 = t131**2
      t447 = 1/t446
      t448 = t164*t447
      t451 = -0.101257459063883D3*t443*t165+0.101257459063883D3*t448
     #*t392
      t452 = t451*t170
      t456 = t452*t173-4.D0*t171*t253
      t457 = t143*t456
      t461 = 0.19D0*rho*(0.5011795824473985D-1*t336
     #+0.626408570946439D-1*t345+0.9690227711544374D-3*t356
     #-0.1899772193293833D-1*t394-0.1899772193293833D-1*t404
     #-0.1899772193293833D-1*t457)
      vrhoa(i) = -0.99256078543904D0*t4+0.4032D-2*t184*t15+0.3024D-2
     #*t8*t204-0.1593432D0*t207*t38-0.52583256D-2*t44*t49*t220+0.19D0
     #*rho*(-0.1899772193293833D-1*t230-0.7599088773175333D-1*t235)
     #-t247+t251-t257-t261+t266-t309+t310+t311+t312-t313+t461
      t464 = 1/t18/t55
      t465 = t464*sigmabb
      t468 = t28**2
      t469 = 1/t468
      t473 = t55*rhob
      t475 = 1/t56/t473
      t477 = 1/t57
      t479 = 1.D0+sigmabb*t477
      t480 = dsqrt(t479)
      t481 = 1/t480
      t484 = -0.336D-1*t23*t464*t25-0.336D-1*sigmabb*t475*t481
      t485 = t469*t484
      t491 = t56*rhob
      t495 = 0.9723306394337274D2*t491-0.1111111111111111D0*t213*sigmabb
      t499 = rhoa*t78+t50*t495-2.D0*rhob*sigmaaa
      t503 = -t228
      t504 = t131*t503
      t505 = t504*t175
      vrhob(i) = -0.99256078543904D0*t18+0.4032D-2*t465*t29+0.3024D-2
     #*t22*t485-0.1593432D0*t37*t38-0.52583256D-2*t44*t49*t499+0.19D0
     #*rho*(-0.1899772193293833D-1*t505+0.7599088773175333D-1*t235)
     #-t247+t251-t257-t261+t266-t309+t310+t311+t312-t313+t461
      t513 = 1/t9
      t519 = 0.126D-1*t513*t7*t11+0.126D-1*t196*t200
      t520 = t188*t519
      t523 = 0.1407222222222222D-1*t33
      t524 = 0.1938888888888889D-1*t60
      t525 = t71*rhoa
      t528 = -0.25D1+t523+t524-0.1111111111111111D0*t525*t38
      t530 = t50*t528+t82-t86
      t536 = t50*t62-0.6666666666666667D0*t45
      t538 = t44*t49*t536
      t539 = 0.52583256D-2*t538
      vsigmaaa(i) = -0.3024D-2*t7*t15+0.3024D-2*t8*t520-0.52583256D-2
     #*t44*t49*t530-t539
      vsigmaab(i) = -0.105166512D-1*t538
      t543 = 1/t23
      t549 = 0.126D-1*t543*t21*t25+0.126D-1*t477*t481
      t550 = t469*t549
      t553 = t71*rhob
      t556 = -0.25D1+t523+t524-0.1111111111111111D0*t553*t38
      t558 = t50*t556+t82-t83
      vsigmabb(i) = -0.3024D-2*t21*t29+0.3024D-2*t22*t550
     #-0.52583256D-2*t44*t49*t558-t539
      t565 = 1/t187/t14
      t566 = t203**2
      t571 = 1/t4/t192
      t575 = t51**2
      t581 = sigmaaa**2
      t587 = 1/t199/t198
      t597 = t258*t253*t220
      t600 = t254*t36*t220
      t603 = t287*t38
      t606 = t71*t248
      t613 = t44*t49*(rhob*t298+t50*(-0.1111111111111111D0*t603
     #*sigmaaa+0.1111111111111111D0*t606*sigmaaa))
      t616 = t44*t263*t220
      t618 = 0.2380352569596468D-1*t345
      t620 = 1/t314/t38
      t622 = t620*t98*t173
      t628 = 1/t46
      t632 = 1/t319/t97
      t634 = t330**2
      t638 = 0.1378556646443111D0*t620*t173
      t640 = 0.4135669939329333D0*t315*t628
      t642 = 1/t326/t38
      t643 = t642*t173
      t645 = t327*t628
      t647 = -t638+t640-0.4077525916766971D0*t643+0.978606220024073D0
     #*t645
      t652 = (-0.1378556646443111D0*t622+0.4135669939329333D0*t315
     #*t320*t248*t330+0.4135669939329333D0*t316*t628
     #+0.12407009817988D1*t93*t632*t634-0.6203504908994D0*t321*t647)
     #*t334*t97
      t655 = 1/t93/t38
      t658 = t333*t655*t97*t248
      t660 = t335*t330
      t665 = t173*t343
      t666 = 1/t338/t104*t620*t665
      t669 = t339*t642*t665
      t672 = t340*t628*t343
      t674 = t338**2
      t678 = t342**2
      t681 = 1/t674/t104*t620*t173/t678
      t699 = (0.3446391616107778D-1*t622+0.5250822119331622D0*t110
     #*t320*t328*t330-0.2187842549721509D0*t347*t643
     #+0.5250822119331622D0*t347*t645+2.D0*t111*t632*t634-1.D0*t350
     #*t647)*t354*t97
      t706 = t353/t111/t110*t97*t327*t248
      t708 = t355*t330
      t711 = t620*t117*t173
      t720 = 1/t361/t116
      t722 = t365**2
      t727 = -t638+t640-0.1237301536356754D0*t643+0.2969523687256209D0
     #*t645
      t743 = t173*t377
      t752 = t372**2
      t756 = t376**2
      t788 = 0.161199195401647D1*(-0.1378556646443111D0*t711
     #+0.4135669939329333D0*t315*t362*t248*t365+0.4135669939329333D0
     #*t358*t628+0.12407009817988D1*t93*t720*t722-0.6203504908994D0
     #*t363*t727)*t334*t116+0.5373306513388232D0*t368*t655*t116*t248
     #+0.161199195401647D1*t369*t365+0.3119768427869032D0/t372/t121
     #*t620*t743+0.495123804261555D0*t373*t642*t743
     #-0.1188297130227732D1*t374*t628*t377-0.1582929339795102D2/t752
     #/t121*t620*t173/t756+0.4140337942820627D-3*
     #(0.3446391616107778D-1*t711+0.5250822119331622D0*t126*t362*t328
     #*t365-0.2187842549721509D0*t381*t643+0.5250822119331622D0*t381
     #*t645+2.D0*t127*t720*t722-1.D0*t384*t727)*t388*t116
     #+0.1087008902583527D-3*t387/t127/t126*t116*t327*t248
     #+0.4140337942820627D-3*t389*t365
      t797 = t136**2
      t798 = 1/t797
      t804 = t140**2
      t805 = 1/t804
      t818 = t620*t146*t173
      t827 = 1/t409/t145
      t829 = t413**2
      t834 = -t638+t640-0.7723543647452368D0*t643+0.1853650475388568D1
     #*t645
      t850 = t173*t425
      t859 = t420**2
      t863 = t424**2
      s1 = 0.2505897912236993D-1*(-0.1378556646443111D0*t818
     #+0.4135669939329333D0*t315*t410*t248*t413+0.4135669939329333D0
     #*t406*t628+0.12407009817988D1*t93*t827*t829-0.6203504908994D0
     #*t411*t834)*t334*t145+0.8352993040789975D-2*t416*t655*t145*t248
     #+0.2505897912236993D-1*t417*t413+0.3423410311260694D-1/t420/t151
     #*t620*t850+0.5433133824030049D-1*t421*t642*t850
     #-0.1303952117767212D0*t422*t628*t425-0.7662163788798043D0/t859
     #/t151*t620*t173/t863+0.2247867095542612D-2*
     #(0.3446391616107778D-1*t818+0.5250822119331622D0*t156*t410*t328
     #*t413-0.2187842549721509D0*t429*t643+0.5250822119331622D0*t429
     #*t645+2.D0*t157*t827*t829-1.D0*t432*t834)*t436*t145
     #+0.5901575133296437D-3*t435/t157/t156*t145*t327*t248
     #+0.2247867095542612D-2*t437*t413
      t905 = s1-0.5011795824473985D-1*t652-0.1670598608157995D-1*t658
     #-0.5011795824473985D-1*t660-0.3289159980064473D-1*t666
     #-0.5220071424553658D-1*t669+0.1252817141892878D0*t672
     #+0.1244848083156773D1*t681-0.9690227711544374D-3*t699
     #-0.2544083100456872D-3*t706-0.9690227711544374D-3*t708
      t914 = t392**2
      t924 = t172*t45
      t925 = 1/t924
      t931 = 0.5011795824473985D-1*t652+0.1670598608157995D-1*t658
     #+0.5011795824473985D-1*t660+0.3289159980064473D-1*t666
     #+0.5220071424553658D-1*t669-0.1252817141892878D0*t672
     #-0.1244848083156773D1*t681+0.9690227711544374D-3*t699
     #+0.2544083100456872D-3*t706+0.9690227711544374D-3*t708
     #-0.1899772193293833D-1*t788*t142*t175-0.3799544386587666D-1*t392
     #*t402*t175-0.3799544386587666D-1*t393*t456-0.1899772193293833D-1
     #*t131*(0.4444444444444444D0*t798*t169*t173+0.2666666666666667D1
     #*t396*t628+0.4444444444444444D0*t805*t169*t173
     #-0.2666666666666667D1*t399*t628)*t175-0.3799544386587666D-1*t403
     #*t456-0.1899772193293833D-1*t143*((-0.101257459063883D3*t905
     #*t165+0.2025149181277661D3*t443*t447*t392-0.2025149181277661D3
     #*t164/t446/t131*t914+0.101257459063883D3*t448*t788)*t170*t173
     #-8.D0*t452*t253+20.D0*t171*t925)
      t933 = 0.19D0*rho*t931
      t934 = 0.1904482413300114D-1*t336
      t935 = 0.3682286530386862D-3*t356
      t940 = t241*rhob*t244
      t942 = t207*t248
      t944 = 0.7219134334516566D-2*t394
      t945 = 0.7219134334516566D-2*t404
      t946 = -0.7219134334516566D-2*t230-0.2887653733806626D-1*t235
     #-0.6048D-2*t8*t565*t566+0.3024D-2*t8*t188*(0.784D-1*t9*t571*t11
     #+0.168D0*sigmaaa/t52/t575*t200-0.448D-1*t581/t4/t575/t192*t587)
     #-0.8064D-2*t184*t204-0.12234370896D-2*t597-0.88795591632D-3*t600
     #-0.105166512D-1*t613+0.385610544D-1*t616+t618+t933+t934+t935
     #-0.9408D-2*t571*sigmaaa*t15-0.370738512D-1*t940+0.3186864D0*t942
     #-t944-t945
      t947 = 0.7219134334516566D-2*t457
      t951 = 1/t240/t35
      t953 = rhob*t49
      t955 = 0.43129246896D-2*t951*rhoa*t953
      t960 = 0.4444444444444444D0*t798*t248+0.4444444444444444D0*t805
     #*t248
      t963 = 0.1899772193293833D-1*t131*t960*t175
      t964 = t229*t234
      t968 = t143*t168*t169*t173
      t969 = 0.22797266319526D0*t968
      t975 = 0.1899772193293833D-1*t392*t228*t175
      t976 = t393*t234
      t977 = 0.7599088773175333D-1*t976
      t988 = -0.4444444444444444D0*t798*t133*t628-0.1333333333333333D1
     #*t136*t248-0.4444444444444444D0*t805*t133*t628
     #+0.1333333333333333D1*t140*t248
      t991 = 0.1899772193293833D-1*t131*t988*t175
      t992 = t403*t234
      t993 = 0.7599088773175333D-1*t992
      t995 = 0.1899772193293833D-1*t229*t456
      t997 = t451*t232*t173
      t999 = t233*t253
      t1001 = 4.D0*t997-16.D0*t999
      t1005 = rho*(-t975-t977-t991-t993-t995-0.1899772193293833D-1
     #*t143*t1001)
      t1009 = 0.88795591632D-3*t254*t36*t306
      t1012 = 0.384780897072D-2*t925*t43*t255
      t1015 = 0.385610544D-1*t44*t263*t306
      t1018 = 0.12234370896D-2*t258*t253*t306
      t1020 = 1/t32/t924
      t1021 = t1020*t43
      t1024 = 0.10329887159856D-3*t1021*t241*t89
      t1028 = 0.1423265147568D-3*t43*t951*t1020*t89
      t1033 = 0.61789752D-1*t242*rhob/t32/t46
      t1034 = rhob*t628
      t1036 = 0.3186864D0*t37*t1034
      t1038 = 0.37486538933976D-4*t1021*t255
      t1043 = 0.899757936D-1*t44/t47/t252*t89
      t1045 = t244*t36
      t1049 = 1/t47/t45*t241
      t1051 = t628*t951
      t1087 = 0.52583256D-2*t44*t49*(t50*((-0.4378024691358025D-1*t244
     #-0.6032098765432099D-1*t1045+0.3157803703703704D-1*t1049
     #-0.3673578308641975D-2*t1051)*sigma-1.D0*(-0.6254320987654321D-2
     #*t244-0.8617283950617284D-2*t1045+0.4511148148148148D-2*t1049
     #-0.5247969012345679D-3*t1051)*t67-0.1111111111111111D0*
     #(0.1125777777777778D0*t244+0.1551111111111111D0*t1045
     #-0.8120066666666667D-1*t1049+0.9446344222222222D-2*t1051)*t75
     #-0.2222222222222222D0*t287*t295-0.1111111111111111D0*t71*(2.D0
     #*rhoa*t628*sigmaaa+2.D0*t1034*sigmabb))-0.1333333333333333D1
     #*sigma+0.1333333333333333D1*sigmabb+0.1333333333333333D1*sigmaaa)
      t1090 = 0.53015607216D-2*t258*t925*t89
      t1100 = t143*t997
      t1102 = t143*t999
      t1105 = rho*(-t975-t991-t995-t977-t993-0.7599088773175333D-1
     #*t1100+0.3039635509270133D0*t1102)
      t1107 = -t947-0.3308535951463467D0/t52-t955+0.19D0*rho*(-t963
     #-0.1519817754635067D0*t964-t969)+0.19D0*t1005-t1009+t1012+t1015
     #-t1018-t1024-t1028+t1033-t1036-t1038-t1043-t1087+t1090
     #-0.52583256D-2*t44*t49*(2.D0*rhob*t216+0.1620551065722879D3*t211
     #*rhob-2.D0*sigmabb)+0.19D0*t1105
      v2rhoa2(i) = t946+t1107
      t1109 = t254*t36*t499
      t1112 = t258*t253*t499
      t1116 = t504*t234
      t1122 = t44*t263*t499
      t1133 = t44*t49*(rhoa*t298+t50*(-0.1111111111111111D0*t603
     #*sigmabb+0.1111111111111111D0*t606*sigmabb))
      t1146 = 0.1899772193293833D-1*t392*t503*t175
      t1150 = -0.1899772193293833D-1*t131*t988*t175
      t1152 = 0.1899772193293833D-1*t504*t456
      t1153 = 0.7599088773175333D-1*t976
      t1154 = 0.7599088773175333D-1*t992
      t1158 = rho*(-t1146-t1150-t1152+t1153+t1154
     #+0.7599088773175333D-1*t1100-0.3039635509270133D0*t1102)
      t1160 = -0.88795591632D-3*t1109-0.12234370896D-2*t1112
     #+0.2887653733806626D-1*t235+t618+t933+t934+t935-t944-t945-t947
     #-0.7219134334516566D-2*t505+0.19D0*rho*(-t963
     #+0.1519817754635067D0*t1116-t969)+0.385610544D-1*t1122
     #-0.105166512D-1*t1133-0.52583256D-2*t44*t49*(2.D0*rhoa*t495
     #+0.1620551065722879D3*rhoa*t491-2.D0*sigmaaa)-t955+0.19D0*t1158
     #-t1009
      t1162 = 1/t18/t473
      t1170 = rho*(-t1146+t1153-t1150+t1154-t1152
     #+0.1899772193293833D-1*t143*t1001)
      t1177 = 1/t468/t28
      t1178 = t484**2
      t1185 = t55**2
      t1191 = sigmabb**2
      t1197 = 1/t480/t479
      t1204 = t37*t248
      t1206 = t242*t244
      t1208 = t1012+t1015-t1018-t1024-t1028+t1033-t1036-t1038-t1043
     #-t1087+t1090-0.9408D-2*t1162*sigmabb*t29+0.19D0*t1170
     #-0.3308535951463467D0/t56-0.8064D-2*t465*t485-0.6048D-2*t22
     #*t1177*t1178+0.3024D-2*t22*t469*(0.784D-1*t23*t1162*t25+0.168D0
     #*sigmabb/t56/t1185*t481-0.448D-1*t1191/t18/t1185/t473*t1197)
     #+0.3186864D0*t1204-0.370738512D-1*t1206
      v2rhob2(i) = t1160+t1208
      t1221 = -0.44397795816D-3*t1109-0.6117185448D-3*t1112
     #-0.3609567167258283D-2*t230-0.6117185448D-3*t597
     #-0.44397795816D-3*t600-0.52583256D-2*t613+0.192805272D-1*t616
     #+t618+t933+t934+t935-0.185369256D-1*t940+0.1593432D0*t942-t944
     #-t945-t947-0.3609567167258283D-2*t505+0.192805272D-1*t1122
     #-0.52583256D-2*t1133-t955
      t1247 = -t1038-t1043-t1087+t1090+0.95D-1*t1170+0.95D-1*t1105
     #+0.1593432D0*t1204-0.185369256D-1*t1206-0.52583256D-2*t44*t49*
     #(t54+t58+t63-t69-t77+rhob*t495+rhoa*t216)-0.1593432D0*t36*t38
     #+0.19D0*rho*(0.1899772193293833D-1*t131*t960*t175
     #+0.7599088773175333D-1*t964-0.7599088773175333D-1*t1116
     #+0.22797266319526D0*t968)
      v2rhoab(i) = t1221+0.95D-1*t1005+0.95D-1*t1158-t1009+t1012+t1015
     #-t1018-t1024-t1028+t1033-t1036+t1247
      t1253 = t7*t188
      t1277 = 0.1111111111111111D0*t50*t213
      t1284 = 0.44397795816D-3*t254*t36*t530
      t1287 = 0.6117185448D-3*t258*t253*t530
      t1290 = 0.192805272D-1*t44*t263*t530
      t1291 = 0.4690740740740741D-2*t268
      t1292 = 0.6462962962962963D-2*t270
      t1293 = 0.2255574074074074D-2*t274
      t1301 = 0.1333333333333333D1*rho
      t1305 = 0.52583256D-2*t44*t49*(t50*(-t1291-t1292+t1293
     #-0.1111111111111111D0*t287*rhoa*t38+0.1111111111111111D0*t525
     #*t248)+t1301)
      t1307 = t44*t953*t62
      t1308 = 0.52583256D-2*t1307
      t1310 = t254*t36*t536
      t1311 = 0.44397795816D-3*t1310
      t1313 = t258*t253*t536
      t1314 = 0.6117185448D-3*t1313
      t1316 = t44*t263*t536
      t1317 = 0.192805272D-1*t1316
      t1322 = t44*t49*(t50*t276-0.1333333333333333D1*rho)
      t1323 = 0.52583256D-2*t1322
      v2rhoasigmaaa(i) = 0.4032D-2*t183*t15-0.4032D-2*t184*t520
     #+0.3024D-2*t1253*t203-0.6048D-2*t8*t565*t203*t519+0.3024D-2*t8
     #*t188*(-0.168D-1*t513*t183*t11-0.504D-1*t194*t200+0.168D-1
     #*sigmaaa/t4/t575/t51*t587)-0.52583256D-2*t44*t49*(rhob*t528
     #-t1277)-t1284-t1287+t1290-t1305-t1308-t1311-t1314+t1317-t1323
      t1325 = 0.88795591632D-3*t1310
      t1326 = 0.12234370896D-2*t1313
      t1327 = 0.385610544D-1*t1316
      t1328 = 0.105166512D-1*t1322
      v2rhoasigmaab(i) = -0.105166512D-1*t1307-t1325-t1326+t1327-t1328
      t1337 = 0.44397795816D-3*t254*t36*t558
      t1340 = 0.6117185448D-3*t258*t253*t558
      t1343 = 0.192805272D-1*t44*t263*t558
      t1354 = 0.52583256D-2*t44*t49*(t50*(-t1291-t1292+t1293
     #-0.1111111111111111D0*t287*rhob*t38+0.1111111111111111D0*t553
     #*t248)+t1301)
      v2rhoasigmabb(i) = -0.52583256D-2*t44*t49*(rhob*t556-2.D0*rhoa)
     #-t1337-t1340+t1343-t1354-t1308-t1311-t1314+t1317-t1323
      t1363 = t44*t49*rhoa*t62
      t1364 = 0.52583256D-2*t1363
      v2rhobsigmaaa(i) = -0.52583256D-2*t44*t49*(rhoa*t528-2.D0*rhob)
     #-t1284-t1287+t1290-t1305-t1364-t1311-t1314+t1317-t1323
      v2rhobsigmaab(i) = -0.105166512D-1*t1363-t1325-t1326+t1327-t1328
      t1370 = t21*t469
      v2rhobsigmabb(i) = 0.4032D-2*t464*t29-0.4032D-2*t465*t550
     #+0.3024D-2*t1370*t484-0.6048D-2*t22*t1177*t484*t549+0.3024D-2
     #*t22*t469*(-0.168D-1*t543*t464*t25-0.504D-1*t475*t481+0.168D-1
     #*sigmabb/t18/t1185/t55*t1197)-0.52583256D-2*t44*t49*(rhoa*t556
     #-t1277)-t1337-t1340+t1343-t1354-t1364-t1311-t1314+t1317-t1323
      t1399 = t519**2
      v2sigmaaa2(i) = 0.6048D-2*t1253*t519-0.6048D-2*t8*t565*t1399
     #+0.3024D-2*t8*t188*(-0.63D-2/t9/sigmaaa*t7*t11+0.63D-2/sigmaaa
     #*t196*t200-0.63D-2/t4/t575/rhoa*t587)
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      t1423 = t549**2
      v2sigmabb2(i) = 0.6048D-2*t1370*t549-0.6048D-2*t22*t1177*t1423
     #+0.3024D-2*t22*t469*(-0.63D-2/t23/sigmabb*t21*t25+0.63D-2
     #/sigmabb*t477*t481-0.63D-2/t18/t1185/rhob*t1197)
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      v2rhob2(i) = 0.0d0
      v2rhoab(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2rhoasigmaab(i) = 0.0d0
      v2rhoasigmabb(i) = 0.0d0
      v2rhobsigmaaa(i) = 0.0d0
      v2rhobsigmaab(i) = 0.0d0
      v2rhobsigmabb(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      v2sigmaab2(i) = 0.0d0
      v2sigmabb2(i) = 0.0d0
      v2sigmaaaab(i) = 0.0d0
      v2sigmaaabb(i) = 0.0d0
      v2sigmaabbb(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end
      
      
      subroutine rks_xc_b3lyp_vwn5
     & (ideriv,npt,rhoa1,sigmaaa1,
     &  zk,vrhoa,vsigmaaa,
     &  v2rhoa2,v2rhoasigmaaa,v2sigmaaa2)
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt)
      REAL sigmaaa1(npt)
      REAL zk(npt),vrhoa(npt),vsigmaaa(npt)
      REAL v2rhoa2(npt),v2rhoasigmaaa(npt),v2sigmaaa2(npt)
      parameter(tol=1.0d-20)
      
      if(ideriv.eq.0) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t3 = t2*rho
      t5 = 1/t3
      t7 = dsqrt(sigma)
      t8 = t7*t5
      t10 = dlog(0.1259921049894873D1*t8+dsqrt(1+0.1587401051968199D1
     #*t8**2))
      t17 = 1/t2
      t20 = 1/(1.D0+0.349D0*t17)
      t23 = 0.2533D0*t17
      t24 = dexp(-t23)
      t26 = rho**2
      t28 = t2**2
      t34 = t17*t20
      t56 = 1/rho
      t57 = t56**(1.D0/3.D0)
      t59 = t56**(1.D0/6.D0)
      t62 = 1/(0.6203504908994D0*t57+0.2935818660072219D1*t59
     #+0.129352D2)
      t65 = dlog(0.6203504908994D0*t57*t62)
      t71 = datan(0.615199081975908D1/(0.1575246635799487D1*t59
     #+0.372744D1))
      t75 = (0.7876233178997433D0*t59+0.10498D0)**2
      t77 = dlog(t75*t62)
      zk(i) = -0.5908470131056179D0*t3-0.3810001254882096D-2*t5*sigma/
     #(1.D0+0.317500104573508D-1*t8*t10)-0.398358D-1*t20*rho
     #-0.52583256D-2*t24*t20/t28/t26/rho*(0.25D0*t26*
     #(0.1148493600075277D2*t28*t26+(0.2611111111111111D1
     #-0.9850555555555556D-1*t17-0.1357222222222222D0*t34)*sigma-0.5D0
     #*(0.25D1-0.1407222222222222D-1*t17-0.1938888888888889D-1*t34)
     #*sigma-0.2777777777777778D-1*(t23+0.349D0*t34-11.D0)*sigma)
     #-0.4583333333333333D0*t26*sigma)+0.19D0*rho*(0.310907D-1*t65
     #+0.3878329487811301D-1*t71+0.9690227711544374D-3*t77)
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t3 = t2*rho
      t5 = 1/t3
      t6 = t5*sigma
      t7 = dsqrt(sigma)
      t8 = t7*t5
      t10 = dlog(0.1259921049894873D1*t8+dsqrt(1+0.1587401051968199D1
     #*t8**2))
      t13 = 1.D0+0.317500104573508D-1*t8*t10
      t14 = 1/t13
      t17 = 1/t2
      t19 = 1.D0+0.349D0*t17
      t20 = 1/t19
      t23 = 0.2533D0*t17
      t24 = dexp(-t23)
      t25 = t24*t20
      t26 = rho**2
      t28 = t2**2
      t30 = 1/t28/t26/rho
      t31 = t28*t26
      t34 = t17*t20
      t36 = 0.2611111111111111D1-0.9850555555555556D-1*t17
     #-0.1357222222222222D0*t34
      t44 = t23+0.349D0*t34-11.D0
      t47 = 0.1148493600075277D2*t31+t36*sigma-0.5D0*(0.25D1
     #-0.1407222222222222D-1*t17-0.1938888888888889D-1*t34)*sigma
     #-0.2777777777777778D-1*t44*sigma
      t52 = 0.25D0*t26*t47-0.4583333333333333D0*t26*sigma
      t56 = 1/rho
      t57 = t56**(1.D0/3.D0)
      t59 = t56**(1.D0/6.D0)
      t61 = 0.6203504908994D0*t57+0.2935818660072219D1*t59+0.129352D2
      t62 = 1/t61
      t65 = dlog(0.6203504908994D0*t57*t62)
      t68 = 0.1575246635799487D1*t59+0.372744D1
      t71 = datan(0.615199081975908D1/t68)
      t74 = 0.7876233178997433D0*t59+0.10498D0
      t75 = t74**2
      t77 = dlog(t75*t62)
      zk(i) = -0.5908470131056179D0*t3-0.3810001254882096D-2*t6*t14
     #-0.398358D-1*t20*rho-0.52583256D-2*t25*t30*t52+0.19D0*rho*
     #(0.310907D-1*t65+0.3878329487811301D-1*t71+0.9690227711544374D-3
     #*t77)
      t84 = 1/t2/t26
      t88 = t13**2
      t89 = 1/t88
      t94 = 1/t31
      t98 = dsqrt(1.D0+0.1587401051968199D1*sigma*t94)
      t99 = 1/t98
      t109 = t28*rho
      t112 = t44*t56*sigma
      t117 = rho*sigma
      t123 = t19**2
      t124 = 1/t123
      t127 = t26**2
      t129 = 1/t127/rho
      t144 = t5*t20
      t146 = 1/t109
      t147 = t146*t124
      t175 = t57**2
      t176 = 1/t175
      t178 = 1/t26
      t181 = t61**2
      t182 = 1/t181
      t186 = t59**2
      t187 = t186**2
      t189 = 1/t187/t59
      t190 = t189*t178
      t192 = -0.2067834969664667D0*t176*t178-0.4893031100120365D0*t190
      t200 = t68**2
      t201 = 1/t200
      s1 = -0.7877960174741572D0*t2+0.5080001673176129D-2*t84*sigma
     #*t14+0.1905000627441048D-2*t6*t89*(-0.8466669455293548D-1*t7*t84
     #*t10-0.106673350692263D0*sigma*t30*t99)-0.398358D-1*t20
     #-0.52583256D-2*t25*t30*(0.5D0*rho*t47+0.25D0*t26*
     #(0.3062649600200738D2*t109-0.2777777777777778D-1*t112)-0.25D0
     #*t117)-0.46342314D-2*t124*t17-0.44397795816D-3*t129*t24*t20*t52
      s2 = s1-0.6117185448D-3*t24*t124*t129*t52+0.192805272D-1*t25/t28
     #/t127*t52-0.52583256D-2*t25*t30*(0.25D0*t26*(
     #(0.3283518518518519D-1*t5+0.4524074074074074D-1*t144
     #-0.1578901851851852D-1*t147)*sigma-0.5D0*(0.4690740740740741D-2
     #*t5+0.6462962962962963D-2*t144-0.2255574074074074D-2*t147)*sigma
     #-0.2777777777777778D-1*(-0.8443333333333333D-1*t5
     #-0.1163333333333333D0*t144+0.4060033333333333D-1*t147)*sigma
     #+0.2777777777777778D-1*t112)-0.6666666666666667D0*t117)
      vrhoa(i) = s2+0.5907233D-2*t65+0.7368826026841473D-2*t71
     #+0.1841143265193431D-3*t77+0.19D0*rho*(0.5011795824473985D-1*(
     #-0.2067834969664667D0*t176*t62*t178-0.6203504908994D0*t57*t182
     #*t192)/t57*t61+0.626408570946439D-1*t201*t189*t178/(1.D0
     #+0.378469910464D2*t201)+0.9690227711544374D-3*(
     #-0.2625411059665811D0*t74*t62*t190-1.D0*t75*t182*t192)/t75*t61)
      vsigmaaa(i) = -0.1524000501952839D-1*t5*t14
     #+0.3810001254882096D-2*t6*t89*(0.6350002091470161D-1/t7*t5*t10
     #+0.8000501301919725D-1*t94*t99)+0.5842584D-3*t25*t146
     #-0.210333024D-1*t25*t30*(0.25D0*t26*t36-0.6666666666666667D0*t26)
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t3 = t2*rho
      t5 = 1/t3
      t6 = t5*sigma
      t7 = dsqrt(sigma)
      t8 = t7*t5
      t10 = dlog(0.1259921049894873D1*t8+dsqrt(1+0.1587401051968199D1
     #*t8**2))
      t13 = 1.D0+0.317500104573508D-1*t8*t10
      t14 = 1/t13
      t17 = 1/t2
      t19 = 1.D0+0.349D0*t17
      t20 = 1/t19
      t23 = 0.2533D0*t17
      t24 = dexp(-t23)
      t25 = t24*t20
      t26 = rho**2
      t27 = t26*rho
      t28 = t2**2
      t30 = 1/t28/t27
      t31 = t28*t26
      t32 = 0.1148493600075277D2*t31
      t34 = t17*t20
      t36 = 0.2611111111111111D1-0.9850555555555556D-1*t17
     #-0.1357222222222222D0*t34
      t37 = t36*sigma
      t42 = 0.5D0*(0.25D1-0.1407222222222222D-1*t17
     #-0.1938888888888889D-1*t34)*sigma
      t44 = t23+0.349D0*t34-11.D0
      t46 = 0.2777777777777778D-1*t44*sigma
      t47 = t32+t37-t42-t46
      t52 = 0.25D0*t26*t47-0.4583333333333333D0*t26*sigma
      t56 = 1/rho
      t57 = t56**(1.D0/3.D0)
      t59 = t56**(1.D0/6.D0)
      t61 = 0.6203504908994D0*t57+0.2935818660072219D1*t59+0.129352D2
      t62 = 1/t61
      t65 = dlog(0.6203504908994D0*t57*t62)
      t68 = 0.1575246635799487D1*t59+0.372744D1
      t71 = datan(0.615199081975908D1/t68)
      t74 = 0.7876233178997433D0*t59+0.10498D0
      t75 = t74**2
      t77 = dlog(t75*t62)
      zk(i) = -0.5908470131056179D0*t3-0.3810001254882096D-2*t6*t14
     #-0.398358D-1*t20*rho-0.52583256D-2*t25*t30*t52+0.19D0*rho*
     #(0.310907D-1*t65+0.3878329487811301D-1*t71+0.9690227711544374D-3
     #*t77)
      t84 = 1/t2/t26
      t85 = t84*sigma
      t88 = t13**2
      t89 = 1/t88
      t94 = 1/t31
      t97 = 1.D0+0.1587401051968199D1*sigma*t94
      t98 = dsqrt(t97)
      t99 = 1/t98
      t102 = -0.8466669455293548D-1*t7*t84*t10-0.106673350692263D0
     #*sigma*t30*t99
      t103 = t89*t102
      t109 = t28*rho
      t111 = t44*t56
      t112 = t111*sigma
      t114 = 0.3062649600200738D2*t109-0.2777777777777778D-1*t112
      t117 = rho*sigma
      t119 = 0.5D0*rho*t47+0.25D0*t26*t114-0.25D0*t117
      t123 = t19**2
      t124 = 1/t123
      t127 = t26**2
      t128 = t127*rho
      t129 = 1/t128
      t130 = t129*t24
      t131 = t20*t52
      t134 = t24*t124
      t139 = 1/t28/t127
      t144 = t5*t20
      t146 = 1/t109
      t147 = t146*t124
      t149 = 0.3283518518518519D-1*t5+0.4524074074074074D-1*t144
     #-0.1578901851851852D-1*t147
      t160 = -0.8443333333333333D-1*t5-0.1163333333333333D0*t144
     #+0.4060033333333333D-1*t147
      t164 = t149*sigma-0.5D0*(0.4690740740740741D-2*t5
     #+0.6462962962962963D-2*t144-0.2255574074074074D-2*t147)*sigma
     #-0.2777777777777778D-1*t160*sigma+0.2777777777777778D-1*t112
      t168 = 0.25D0*t26*t164-0.6666666666666667D0*t117
      t175 = t57**2
      t176 = 1/t175
      t177 = t176*t62
      t178 = 1/t26
      t181 = t61**2
      t182 = 1/t181
      t183 = t57*t182
      t186 = t59**2
      t187 = t186**2
      t188 = t187*t59
      t189 = 1/t188
      t190 = t189*t178
      t192 = -0.2067834969664667D0*t176*t178-0.4893031100120365D0*t190
      t195 = -0.2067834969664667D0*t177*t178-0.6203504908994D0*t183*t192
      t196 = 1/t57
      t197 = t195*t196
      t198 = t197*t61
      t200 = t68**2
      t201 = 1/t200
      t202 = t201*t189
      t204 = 1.D0+0.378469910464D2*t201
      t205 = 1/t204
      t207 = t202*t178*t205
      t209 = t74*t62
      t212 = t75*t182
      t215 = -0.2625411059665811D0*t209*t190-1.D0*t212*t192
      t216 = 1/t75
      t217 = t215*t216
      t218 = t217*t61
      vrhoa(i) = -0.7877960174741572D0*t2+0.5080001673176129D-2*t85
     #*t14+0.1905000627441048D-2*t6*t103-0.398358D-1*t20-0.52583256D-2
     #*t25*t30*t119-0.46342314D-2*t124*t17-0.44397795816D-3*t130*t131
     #-0.6117185448D-3*t134*t129*t52+0.192805272D-1*t25*t139*t52
     #-0.52583256D-2*t25*t30*t168+0.5907233D-2*t65
     #+0.7368826026841473D-2*t71+0.1841143265193431D-3*t77+0.19D0*rho*
     #(0.5011795824473985D-1*t198+0.626408570946439D-1*t207
     #+0.9690227711544374D-3*t218)
      t225 = 1/t7
      t231 = 0.6350002091470161D-1*t225*t5*t10+0.8000501301919725D-1
     #*t94*t99
      t232 = t89*t231
      t240 = 0.25D0*t26*t36-0.6666666666666667D0*t26
      vsigmaaa(i) = -0.1524000501952839D-1*t5*t14
     #+0.3810001254882096D-2*t6*t232+0.5842584D-3*t25*t146
     #-0.210333024D-1*t25*t30*t240
      t248 = t160*t56*sigma
      t251 = t44*t178*sigma
      t260 = rho*t114
      t267 = t127*t26
      t269 = 1/t2/t267
      t270 = t269*t24
      t276 = 1/t267
      t281 = 1/t2/t27
      t288 = sigma**2
      t294 = 1/t98/t97
      t304 = 1/t88/t13
      t305 = t102**2
      t322 = 0.4760705139192936D-1*t207-0.210333024D-1*t25*t30*(0.5D0
     #*rho*t164+0.25D0*t26*(-0.2777777777777778D-1*t248
     #+0.2777777777777778D-1*t251))-0.52583256D-2*t25*t30*(t260
     #+0.2552208000167282D2*t31-0.5D0*sigma)-0.74973077867952D-4*t270
     #*t131-0.20659774319712D-3*t270*t124*t52+0.769561794144D-2*t276
     #*t24*t131+0.1905000627441048D-2*t6*t89*(0.3951112412470322D0*t7
     #*t281*t10+0.106673350692263D1*sigma*t139*t99
     #-0.4515557042823225D0*t288/t2/t127/t27*t294)
     #-0.1016000334635226D-1*t85*t103-0.3810001254882096D-2*t6*t304
     #*t305-0.177591183264D-2*t130*t20*t168+0.106031214432D-1*t134
     #*t276*t52-0.24468741792D-2*t134*t129*t168-0.52583256D-2*t25*t30*
     #(t32+t37-t42-t46+t260)
      t329 = t84*t20
      t331 = t94*t124
      t333 = 1/t27
      t335 = 1/t123/t19
      t336 = t333*t335
      t386 = 1/t175/t56
      t388 = 1/t127
      t389 = t386*t62*t388
      t398 = 1/t181/t61
      t400 = t192**2
      t408 = 1/t188/t56
      t409 = t408*t388
      t411 = t189*t333
      t413 = -0.1378556646443111D0*t386*t388+0.4135669939329333D0*t176
     #*t333-0.4077525916766971D0*t409+0.978606220024073D0*t411
      t431 = t388*t205
      t440 = t200**2
      t444 = t204**2
      s1 = -0.1799515872D0*t25/t28/t128*t52-0.105166512D-1*t25*t30*
     #(0.25D0*t26*((-0.4378024691358025D-1*t84-0.6032098765432099D-1
     #*t329+0.3157803703703704D-1*t331-0.3673578308641975D-2*t336)
     #*sigma-0.5D0*(-0.6254320987654321D-2*t84-0.8617283950617284D-2
     #*t329+0.4511148148148148D-2*t331-0.5247969012345679D-3*t336)
     #*sigma-0.2777777777777778D-1*(0.1125777777777778D0*t84
     #+0.1551111111111111D0*t329-0.8120066666666667D-1*t331
     #+0.9446344222222222D-2*t336)*sigma+0.5555555555555556D-1*t248
     #-0.5555555555555556D-1*t251)-0.6666666666666667D0*sigma)
     #-0.2846530295136D-3*t24*t335*t269*t52+0.771221088D-1*t25*t139
     #*t168-0.177591183264D-2*t130*t20*t119-0.24468741792D-2*t134*t129
     #*t119+0.771221088D-1*t25*t139*t119
      s2 = s1+0.3808964826600229D-1*t198+0.7364573060773724D-3*t218
     #-0.2370667447482193D-1*t281*sigma*t14
      s3 = s2+0.38D0*rho*(0.5011795824473985D-1*(-0.1378556646443111D0
     #*t389+0.4135669939329333D0*t176*t182*t178*t192
     #+0.4135669939329333D0*t177*t333+0.12407009817988D1*t57*t398*t400
     #-0.6203504908994D0*t183*t413)*t196*t61+0.1670598608157995D-1
     #*t195/t57/t56*t61*t178+0.5011795824473985D-1*t197*t192
     #+0.3289159980064473D-1/t200/t68*t386*t431+0.5220071424553658D-1
     #*t201*t408*t431-0.1252817141892878D0*t202*t333*t205
     #-0.1244848083156773D1/t440/t68*t386*t388/t444
     #+0.9690227711544374D-3*(0.3446391616107778D-1*t389
     #+0.5250822119331622D0*t74*t182*t190*t192-0.2187842549721509D0
     #*t209*t409+0.5250822119331622D0*t209*t411+2.D0*t75*t398*t400
     #-1.D0*t212*t413)*t216*t61+0.2544083100456872D-3*t215/t75/t74*t61
     #*t189*t178+0.9690227711544374D-3*t217*t192)
      t485 = s3-0.61789752D-2*t124*t5-0.21564623448D-2*t335*t146
     #-0.5251973449827715D0/t28
      v2rhoa2(i) = t322+t485
      t490 = t5*t89
      s1 = 0.2032000669270451D-1*t84*t14-0.5080001673176129D-2*t85
     #*t232+0.7620002509764193D-2*t490*t102-0.3810001254882096D-2*t6
     #*t304*t102*t231+0.1905000627441048D-2*t6*t89*(
     #-0.169333389105871D0*t225*t84*t10-0.640040104153578D0*t30*t99
     #+0.3386667782117419D0*sigma*t269*t294)-0.52583256D-2*t25*t30*(
     #-0.9444444444444444D0*rho-0.2777777777777778D-1*rho*t44)
     #+0.4933088424D-4*t333*t24*t20
      v2rhoasigmaaa(i) = s1+0.679687272D-4*t134*t333+0.80822412D-2*t25
     #*t94-0.105166512D-1*t25*t30*(0.25D0*t26*(-0.3D-22*t144
     #+0.5555555555555556D-1*t111)+0.1333333333333333D1*rho)
     #-0.105166512D-1*t25*t94*t36-0.177591183264D-2*t130*t20*t240
     #-0.24468741792D-2*t134*t129*t240+0.771221088D-1*t25*t139*t240
     #-0.210333024D-1*t25*t30*(0.25D0*t26*t149-0.1333333333333333D1*rho)
      t554 = t231**2
      v2sigmaaa2(i) = 0.3048001003905677D-1*t490*t231
     #-0.7620002509764193D-2*t6*t304*t554+0.3810001254882096D-2*t6*t89
     #*(-0.1270000418294032D0/t7/sigma*t5*t10+0.1600100260383945D0
     #/sigma*t94*t99-0.2540000836588064D0/t2/t128*t294)
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end

c:XC_B3LYP_VWN5subrend
_ENDIF
_IF(ccpdft,all,xc_b3lyp_vwn5rpa)
c:XC_B3LYP_VWN5RPAsubrstart

c    Generated: Tue Sep  2 15:21:39 GMT 2003

      subroutine uks_xc_b3lyp_vwn5rpa
     & (ideriv,npt,rhoa1,rhob1,sigmaaa1,sigmabb1,sigmaab1,
     &  zk,vrhoa,vrhob,vsigmaaa,vsigmabb,vsigmaab,
     &  v2rhoa2,v2rhob2,v2rhoab,
     &  v2rhoasigmaaa,v2rhoasigmaab,v2rhoasigmabb,
     &  v2rhobsigmabb,v2rhobsigmaab,v2rhobsigmaaa,
     &  v2sigmaaa2,v2sigmaaaab,v2sigmaaabb,
     &  v2sigmaab2,v2sigmaabbb,v2sigmabb2)
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt),rhob1(npt)
      REAL sigmaaa1(npt),sigmabb1(npt),sigmaab1(npt)
      REAL zk(npt),vrhoa(npt),vrhob(npt)
      REAL vsigmaaa(npt),vsigmabb(npt),vsigmaab(npt)
      REAL v2rhoa2(npt),v2rhob2(npt),v2rhoab(npt)
      REAL v2rhoasigmaaa(npt),v2rhoasigmaab(npt)
      REAL v2rhoasigmabb(npt),v2rhobsigmabb(npt)
      REAL v2rhobsigmaab(npt),v2rhobsigmaaa(npt)
      REAL v2sigmaaa2(npt),v2sigmaaaab(npt),v2sigmaaabb(npt)
      REAL v2sigmaab2(npt),v2sigmaabbb(npt),v2sigmabb2(npt)
      parameter(tol=1.0d-20)
      
      if (ideriv.eq.0) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t3 = t2*rhob
      t5 = 1/t3
      t7 = dsqrt(sigmabb)
      t8 = t7*t5
      t9 = dlog(t8+dsqrt(1+t8**2))
      t16 = 1/rhob
      t17 = t16**(1.D0/3.D0)
      t19 = t16**(1.D0/6.D0)
      t22 = 1/(0.6203504908994D0*t17+0.1584942278842832D2*t19
     #+0.101578D3)
      t25 = dlog(0.6203504908994D0*t17*t22)
      t31 = datan(0.1171685277708993D1/(0.1575246635799487D1*t19
     #+0.201231D2))
      t35 = (0.7876233178997433D0*t19+0.743294D0)**2
      t37 = dlog(t35*t22)
      zk(i) = -0.74442058907928D0*t3-0.3024D-2*t5*sigmabb/(1.D0
     #+0.252D-1*t8*t9)+0.19D0*rhob*(0.1554535D-1*t25
     #+0.6188180297906063D0*t31+0.2667310007273315D-2*t37)
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t3 = t2*rhoa
      t5 = 1/t3
      t7 = dsqrt(sigmaaa)
      t8 = t7*t5
      t9 = dlog(t8+dsqrt(1+t8**2))
      t16 = 1/rhoa
      t17 = t16**(1.D0/3.D0)
      t19 = t16**(1.D0/6.D0)
      t22 = 1/(0.6203504908994D0*t17+0.1584942278842832D2*t19
     #+0.101578D3)
      t25 = dlog(0.6203504908994D0*t17*t22)
      t31 = datan(0.1171685277708993D1/(0.1575246635799487D1*t19
     #+0.201231D2))
      t35 = (0.7876233178997433D0*t19+0.743294D0)**2
      t37 = dlog(t35*t22)
      zk(i) = -0.74442058907928D0*t3-0.3024D-2*t5*sigmaaa/(1.D0
     #+0.252D-1*t8*t9)+0.19D0*rhoa*(0.1554535D-1*t25
     #+0.6188180297906063D0*t31+0.2667310007273315D-2*t37)
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t5 = t4*rhoa
      t7 = 1/t5
      t9 = dsqrt(sigmaaa)
      t10 = t9*t7
      t11 = dlog(t10+dsqrt(1+t10**2))
      t18 = rhob**(1.D0/3.D0)
      t19 = t18*rhob
      t21 = 1/t19
      t23 = dsqrt(sigmabb)
      t24 = t23*t21
      t25 = dlog(t24+dsqrt(1+t24**2))
      t32 = rho**(1.D0/3.D0)
      t33 = 1/t32
      t36 = 1/(1.D0+0.349D0*t33)
      t38 = 1/rho
      t39 = rhob*t38
      t42 = 0.2533D0*t33
      t43 = dexp(-t42)
      t45 = rho**2
      t47 = t32**2
      t51 = rhoa**2
      t52 = t4**2
      t55 = rhob**2
      t56 = t18**2
      t60 = t33*t36
      t82 = 0.6666666666666667D0*t45
      t93 = t38**(1.D0/3.D0)
      t94 = 0.6203504908994D0*t93
      t95 = t38**(1.D0/6.D0)
      t98 = 1/(t94+0.1029581201158544D2*t95+0.427198D2)
      t101 = dlog(0.6203504908994D0*t93*t98)
      t103 = 0.1575246635799487D1*t95
      t107 = datan(0.448998886412873D-1/(t103+0.13072D2))
      t109 = 0.7876233178997433D0*t95
      t111 = (t109+0.409286D0)**2
      t113 = dlog(t111*t98)
      t117 = 1/(t94+0.8908571061768626D0*t95+0.130045D2)
      t120 = dlog(0.6203504908994D0*t93*t117)
      t124 = datan(0.7123108917818118D1/(t103+0.113107D1))
      t127 = (t109+0.47584D-2)**2
      t129 = dlog(t127*t117)
      t131 = t120+0.3177080047439415D0*t124+0.4140337942820627D-3*t129
      t133 = rhoa-1.D0*rhob
      t134 = t133*t38
      t135 = 1.D0+t134
      t136 = t135**(1.D0/3.D0)
      t139 = 1.D0-1.D0*t134
      t140 = t139**(1.D0/3.D0)
      t146 = 1/(t94+0.1584942278842832D2*t95+0.101578D3)
      t149 = dlog(0.6203504908994D0*t93*t146)
      t154 = datan(0.1171685277708993D1/(t103+0.201231D2))
      t157 = (t109+0.743294D0)**2
      t159 = dlog(t157*t146)
      t169 = t133**2
      t170 = t169**2
      t172 = t45**2
      s1 = -0.74442058907928D0*t5-0.3024D-2*t7*sigmaaa/(1.D0+0.252D-1
     #*t10*t11)-0.74442058907928D0*t19
      s2 = s1-0.3024D-2*t21*sigmabb/(1.D0+0.252D-1*t24*t25)
      s3 = s2-0.1593432D0*t36*rhoa*t39
      s4 = s3
      s6 = -0.52583256D-2*t43*t36/t47/t45/rho*(rhoa*rhob*
     #(0.3646239897876478D2*t52*t51+0.3646239897876478D2*t56*t55+
     #(0.2611111111111111D1-0.9850555555555556D-1*t33
     #-0.1357222222222222D0*t60)*sigma-1.D0*(0.25D1
     #-0.1407222222222222D-1*t33-0.1938888888888889D-1*t60)*(sigmaaa
     #+sigmabb)-0.1111111111111111D0*(t42+0.349D0*t60-11.D0)*(rhoa*t38
     #*sigmaaa+t39*sigmabb))-0.6666666666666667D0*t45*sigma+(t82-1.D0
     #*t51)*sigmabb+(t82-1.D0*t55)*sigmaaa)
      s7 = 0.19D0*rho*(0.310907D-1*t101+0.205219729378375D2*t107
     #+0.4431373767749538D-2*t113-0.1899772193293833D-1*t131*(t136
     #*t135+t140*t139-2.D0)*(1.D0+(-0.101257459063883D3*(0.1554535D-1
     #*t149+0.6188180297906063D0*t154+0.2667310007273315D-2*t159
     #-0.310907D-1*t101-0.205219729378375D2*t107-0.4431373767749538D-2
     #*t113)/t131-1.D0)*t170/t172))
      s5 = s6+s7
      zk(i) = s4+s5
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t3 = t2*rhob
      t5 = 1/t3
      t6 = t5*sigmabb
      t7 = dsqrt(sigmabb)
      t8 = t7*t5
      t9 = dlog(t8+dsqrt(1+t8**2))
      t12 = 1.D0+0.252D-1*t8*t9
      t13 = 1/t12
      t16 = 1/rhob
      t17 = t16**(1.D0/3.D0)
      t19 = t16**(1.D0/6.D0)
      t21 = 0.6203504908994D0*t17+0.1584942278842832D2*t19+0.101578D3
      t22 = 1/t21
      t25 = dlog(0.6203504908994D0*t17*t22)
      t28 = 0.1575246635799487D1*t19+0.201231D2
      t31 = datan(0.1171685277708993D1/t28)
      t34 = 0.7876233178997433D0*t19+0.743294D0
      t35 = t34**2
      t37 = dlog(t35*t22)
      zk(i) = -0.74442058907928D0*t3-0.3024D-2*t6*t13+0.19D0*rhob*
     #(0.1554535D-1*t25+0.6188180297906063D0*t31+0.2667310007273315D-2
     #*t37)
      vrhoa(i) = 0.D0
      t43 = rhob**2
      t45 = 1/t2/t43
      t49 = t12**2
      t50 = 1/t49
      t55 = t2**2
      t60 = 1/t55/t43
      t63 = dsqrt(1.D0+sigmabb*t60)
      t64 = 1/t63
      t74 = t17**2
      t75 = 1/t74
      t77 = 1/t43
      t80 = t21**2
      t81 = 1/t80
      t85 = t19**2
      t86 = t85**2
      t88 = 1/t86/t19
      t89 = t88*t77
      t91 = -0.2067834969664667D0*t75*t77-0.2641570464738054D1*t89
      t99 = t28**2
      t100 = 1/t99
      vrhob(i) = -0.99256078543904D0*t2+0.4032D-2*t45*sigmabb*t13
     #+0.3024D-2*t6*t50*(-0.336D-1*t7*t45*t9-0.336D-1*sigmabb/t55/t43
     #/rhob*t64)+0.29536165D-2*t25+0.1175754256602152D0*t31
     #+0.5067889013819299D-3*t37+0.19D0*rhob*(0.2505897912236993D-1*(
     #-0.2067834969664667D0*t75*t22*t77-0.6203504908994D0*t17*t81*t91)
     #/t17*t21+0.1903580477513215D0*t100*t88*t77/(1.D0+0.137284639D1
     #*t100)+0.2667310007273315D-2*(-0.2625411059665811D0*t34*t22*t89
     #-1.D0*t35*t81*t91)/t35*t21)
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      vsigmabb(i) = -0.3024D-2*t5*t13+0.3024D-2*t6*t50*(0.126D-1/t7*t5
     #*t9+0.126D-1*t60*t64)
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t3 = t2*rhoa
      t5 = 1/t3
      t6 = t5*sigmaaa
      t7 = dsqrt(sigmaaa)
      t8 = t7*t5
      t9 = dlog(t8+dsqrt(1+t8**2))
      t12 = 1.D0+0.252D-1*t8*t9
      t13 = 1/t12
      t16 = 1/rhoa
      t17 = t16**(1.D0/3.D0)
      t19 = t16**(1.D0/6.D0)
      t21 = 0.6203504908994D0*t17+0.1584942278842832D2*t19+0.101578D3
      t22 = 1/t21
      t25 = dlog(0.6203504908994D0*t17*t22)
      t28 = 0.1575246635799487D1*t19+0.201231D2
      t31 = datan(0.1171685277708993D1/t28)
      t34 = 0.7876233178997433D0*t19+0.743294D0
      t35 = t34**2
      t37 = dlog(t35*t22)
      zk(i) = -0.74442058907928D0*t3-0.3024D-2*t6*t13+0.19D0*rhoa*
     #(0.1554535D-1*t25+0.6188180297906063D0*t31+0.2667310007273315D-2
     #*t37)
      t43 = rhoa**2
      t45 = 1/t2/t43
      t49 = t12**2
      t50 = 1/t49
      t55 = t2**2
      t60 = 1/t55/t43
      t63 = dsqrt(1.D0+sigmaaa*t60)
      t64 = 1/t63
      t74 = t17**2
      t75 = 1/t74
      t77 = 1/t43
      t80 = t21**2
      t81 = 1/t80
      t85 = t19**2
      t86 = t85**2
      t88 = 1/t86/t19
      t89 = t88*t77
      t91 = -0.2067834969664667D0*t75*t77-0.2641570464738054D1*t89
      t99 = t28**2
      t100 = 1/t99
      vrhoa(i) = -0.99256078543904D0*t2+0.4032D-2*t45*sigmaaa*t13
     #+0.3024D-2*t6*t50*(-0.336D-1*t7*t45*t9-0.336D-1*sigmaaa/t55/t43
     #/rhoa*t64)+0.29536165D-2*t25+0.1175754256602152D0*t31
     #+0.5067889013819299D-3*t37+0.19D0*rhoa*(0.2505897912236993D-1*(
     #-0.2067834969664667D0*t75*t22*t77-0.6203504908994D0*t17*t81*t91)
     #/t17*t21+0.1903580477513215D0*t100*t88*t77/(1.D0+0.137284639D1
     #*t100)+0.2667310007273315D-2*(-0.2625411059665811D0*t34*t22*t89
     #-1.D0*t35*t81*t91)/t35*t21)
      vrhob(i) = 0.D0
      vsigmaaa(i) = -0.3024D-2*t5*t13+0.3024D-2*t6*t50*(0.126D-1/t7*t5
     #*t9+0.126D-1*t60*t64)
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t5 = t4*rhoa
      t7 = 1/t5
      t8 = t7*sigmaaa
      t9 = dsqrt(sigmaaa)
      t10 = t9*t7
      t11 = dlog(t10+dsqrt(1+t10**2))
      t14 = 1.D0+0.252D-1*t10*t11
      t15 = 1/t14
      t18 = rhob**(1.D0/3.D0)
      t19 = t18*rhob
      t21 = 1/t19
      t22 = t21*sigmabb
      t23 = dsqrt(sigmabb)
      t24 = t23*t21
      t25 = dlog(t24+dsqrt(1+t24**2))
      t28 = 1.D0+0.252D-1*t24*t25
      t29 = 1/t28
      t32 = rho**(1.D0/3.D0)
      t33 = 1/t32
      t35 = 1.D0+0.349D0*t33
      t36 = 1/t35
      t37 = t36*rhoa
      t38 = 1/rho
      t39 = rhob*t38
      t42 = 0.2533D0*t33
      t43 = dexp(-t42)
      t44 = t43*t36
      t45 = rho**2
      t47 = t32**2
      t49 = 1/t47/t45/rho
      t50 = rhoa*rhob
      t51 = rhoa**2
      t52 = t4**2
      t53 = t52*t51
      t55 = rhob**2
      t56 = t18**2
      t57 = t56*t55
      t60 = t33*t36
      t62 = 0.2611111111111111D1-0.9850555555555556D-1*t33
     #-0.1357222222222222D0*t60
      t67 = sigmaaa+sigmabb
      t71 = t42+0.349D0*t60-11.D0
      t75 = rhoa*t38*sigmaaa+t39*sigmabb
      t78 = 0.3646239897876478D2*t53+0.3646239897876478D2*t57+t62
     #*sigma-1.D0*(0.25D1-0.1407222222222222D-1*t33
     #-0.1938888888888889D-1*t60)*t67-0.1111111111111111D0*t71*t75
      t82 = 0.6666666666666667D0*t45
      t83 = 1.D0*t51
      t86 = 1.D0*t55
      t89 = t50*t78-0.6666666666666667D0*t45*sigma+(t82-t83)*sigmabb+
     #(t82-t86)*sigmaaa
      t93 = t38**(1.D0/3.D0)
      t94 = 0.6203504908994D0*t93
      t95 = t38**(1.D0/6.D0)
      t97 = t94+0.1029581201158544D2*t95+0.427198D2
      t98 = 1/t97
      t101 = dlog(0.6203504908994D0*t93*t98)
      t103 = 0.1575246635799487D1*t95
      t104 = t103+0.13072D2
      t107 = datan(0.448998886412873D-1/t104)
      t109 = 0.7876233178997433D0*t95
      t110 = t109+0.409286D0
      t111 = t110**2
      t113 = dlog(t111*t98)
      t116 = t94+0.8908571061768626D0*t95+0.130045D2
      t117 = 1/t116
      t120 = dlog(0.6203504908994D0*t93*t117)
      t121 = t103+0.113107D1
      t124 = datan(0.7123108917818118D1/t121)
      t126 = t109+0.47584D-2
      t127 = t126**2
      t129 = dlog(t127*t117)
      t131 = t120+0.3177080047439415D0*t124+0.4140337942820627D-3*t129
      t133 = rhoa-1.D0*rhob
      t134 = t133*t38
      t135 = 1.D0+t134
      t136 = t135**(1.D0/3.D0)
      t139 = 1.D0-1.D0*t134
      t140 = t139**(1.D0/3.D0)
      t142 = t136*t135+t140*t139-2.D0
      t143 = t131*t142
      t145 = t94+0.1584942278842832D2*t95+0.101578D3
      t146 = 1/t145
      t149 = dlog(0.6203504908994D0*t93*t146)
      t151 = t103+0.201231D2
      t154 = datan(0.1171685277708993D1/t151)
      t156 = t109+0.743294D0
      t157 = t156**2
      t159 = dlog(t157*t146)
      t164 = 0.1554535D-1*t149+0.6188180297906063D0*t154
     #+0.2667310007273315D-2*t159-0.310907D-1*t101-0.205219729378375D2
     #*t107-0.4431373767749538D-2*t113
      t165 = 1/t131
      t168 = -0.101257459063883D3*t164*t165-1.D0
      t169 = t133**2
      t170 = t169**2
      t171 = t168*t170
      t172 = t45**2
      t173 = 1/t172
      t175 = 1.D0+t171*t173
      t176 = t143*t175
      zk(i) = -0.74442058907928D0*t5-0.3024D-2*t8*t15
     #-0.74442058907928D0*t19-0.3024D-2*t22*t29-0.1593432D0*t37*t39
     #-0.52583256D-2*t44*t49*t89+0.19D0*rho*(0.310907D-1*t101
     #+0.205219729378375D2*t107+0.4431373767749538D-2*t113
     #-0.1899772193293833D-1*t176)
      t183 = 1/t4/t51
      t187 = t14**2
      t188 = 1/t187
      t196 = 1/t53
      t199 = dsqrt(1.D0+sigmaaa*t196)
      t200 = 1/t199
      t213 = t71*t38
      t228 = 0.1333333333333333D1*t136*t38-0.1333333333333333D1*t140*t38
      t235 = t143*t168*t169*t133*t173
      t240 = t35**2
      t241 = 1/t240
      t247 = 0.185369256D-1*t241*rhoa*rhob/t32/t45
      t248 = 1/t45
      t249 = rhob*t248
      t251 = 0.1593432D0*t37*t249
      t253 = 1/t172/rho
      t257 = 0.44397795816D-3*t253*t43*t36*t89
      t261 = 0.6117185448D-3*t43*t241*t253*t89
      t266 = 0.192805272D-1*t44/t47/t172*t89
      t268 = 1/t32/rho
      t270 = t268*t36
      t274 = 1/t47/rho*t241
      t309 = 0.52583256D-2*t44*t49*(t50*((0.3283518518518519D-1*t268
     #+0.4524074074074074D-1*t270-0.1578901851851852D-1*t274)*sigma
     #-1.D0*(0.4690740740740741D-2*t268+0.6462962962962963D-2*t270
     #-0.2255574074074074D-2*t274)*t67-0.1111111111111111D0*(
     #-0.8443333333333333D-1*t268-0.1163333333333333D0*t270
     #+0.4060033333333333D-1*t274)*t75-0.1111111111111111D0*t71*(-1.D0
     #*rhoa*t248*sigmaaa-1.D0*t249*sigmabb))-0.1333333333333333D1*rho
     #*sigma+0.1333333333333333D1*rho*sigmabb+0.1333333333333333D1*rho
     #*sigmaaa)
      t310 = 0.5907233D-2*t101
      t311 = 0.3899174858189126D1*t107
      t312 = 0.8419610158724123D-3*t113
      t313 = 0.3609567167258283D-2*t176
      t314 = t93**2
      t315 = 1/t314
      t319 = t97**2
      t320 = 1/t319
      t323 = 0.2067834969664667D0*t315*t248
      t324 = t95**2
      t325 = t324**2
      t327 = 1/t325/t95
      t328 = t327*t248
      t330 = -t323-0.1715968668597574D1*t328
      t334 = 1/t93
      t336 = (-0.2067834969664667D0*t315*t98*t248-0.6203504908994D0
     #*t93*t320*t330)*t334*t97
      t338 = t104**2
      t339 = 1/t338
      t345 = t339*t327*t248/(1.D0+0.2016D-2*t339)
      t356 = (-0.2625411059665811D0*t110*t98*t328-1.D0*t111*t320*t330)
     #/t111*t97
      t361 = t116**2
      t362 = 1/t361
      t365 = -t323-0.1484761843628104D0*t328
      t372 = t121**2
      t373 = 1/t372
      t392 = 0.161199195401647D1*(-0.2067834969664667D0*t315*t117*t248
     #-0.6203504908994D0*t93*t362*t365)*t334*t116+0.5941485651138659D0
     #*t373*t327*t248/(1.D0+0.507386806551D2*t373)
     #+0.4140337942820627D-3*(-0.2625411059665811D0*t126*t117*t328
     #-1.D0*t127*t362*t365)/t127*t116
      t409 = t145**2
      t410 = 1/t409
      t413 = -t323-0.2641570464738054D1*t328
      t420 = t151**2
      t421 = 1/t420
      t446 = t131**2
      t461 = 0.19D0*rho*(0.5011795824473985D-1*t336
     #+0.2419143800947354D0*t345+0.4431373767749538D-2*t356
     #-0.1899772193293833D-1*t392*t142*t175-0.1899772193293833D-1*t131
     #*(-0.1333333333333333D1*t136*t133*t248+0.1333333333333333D1*t140
     #*t133*t248)*t175-0.1899772193293833D-1*t143*((
     #-0.101257459063883D3*(0.2505897912236993D-1*(
     #-0.2067834969664667D0*t315*t146*t248-0.6203504908994D0*t93*t410
     #*t413)*t334*t145+0.1903580477513215D0*t421*t327*t248/(1.D0
     #+0.137284639D1*t421)+0.2667310007273315D-2*(
     #-0.2625411059665811D0*t156*t146*t328-1.D0*t157*t410*t413)/t157
     #*t145-0.5011795824473985D-1*t336-0.2419143800947354D0*t345
     #-0.4431373767749538D-2*t356)*t165+0.101257459063883D3*t164/t446
     #*t392)*t170*t173-4.D0*t171*t253))
      vrhoa(i) = -0.99256078543904D0*t4+0.4032D-2*t183*sigmaaa*t15
     #+0.3024D-2*t8*t188*(-0.336D-1*t9*t183*t11-0.336D-1*sigmaaa/t52
     #/t51/rhoa*t200)-0.1593432D0*t36*rhob*t38-0.52583256D-2*t44*t49*
     #(rhob*t78+t50*(0.9723306394337274D2*t52*rhoa
     #-0.1111111111111111D0*t213*sigmaaa)-2.D0*rhoa*sigmabb)+0.19D0
     #*rho*(-0.1899772193293833D-1*t131*t228*t175
     #-0.7599088773175333D-1*t235)-t247+t251-t257-t261+t266-t309+t310
     #+t311+t312-t313+t461
      t464 = 1/t18/t55
      t468 = t28**2
      t469 = 1/t468
      t477 = 1/t57
      t480 = dsqrt(1.D0+sigmabb*t477)
      t481 = 1/t480
      vrhob(i) = -0.99256078543904D0*t18+0.4032D-2*t464*sigmabb*t29
     #+0.3024D-2*t22*t469*(-0.336D-1*t23*t464*t25-0.336D-1*sigmabb/t56
     #/t55/rhob*t481)-0.1593432D0*t37*t38-0.52583256D-2*t44*t49*(rhoa
     #*t78+t50*(0.9723306394337274D2*t56*rhob-0.1111111111111111D0
     #*t213*sigmabb)-2.D0*rhob*sigmaaa)+0.19D0*rho*
     #(0.1899772193293833D-1*t131*t228*t175+0.7599088773175333D-1*t235
     #)-t247+t251-t257-t261+t266-t309+t310+t311+t312-t313+t461
      t523 = 0.1407222222222222D-1*t33
      t524 = 0.1938888888888889D-1*t60
      t538 = t44*t49*(t50*t62-0.6666666666666667D0*t45)
      t539 = 0.52583256D-2*t538
      vsigmaaa(i) = -0.3024D-2*t7*t15+0.3024D-2*t8*t188*(0.126D-1/t9
     #*t7*t11+0.126D-1*t196*t200)-0.52583256D-2*t44*t49*(t50*(-0.25D1
     #+t523+t524-0.1111111111111111D0*t71*rhoa*t38)+t82-t86)-t539
      vsigmaab(i) = -0.105166512D-1*t538
      vsigmabb(i) = -0.3024D-2*t21*t29+0.3024D-2*t22*t469*(0.126D-1
     #/t23*t21*t25+0.126D-1*t477*t481)-0.52583256D-2*t44*t49*(t50*(
     #-0.25D1+t523+t524-0.1111111111111111D0*t71*rhob*t38)+t82-t83)-t539
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t3 = t2*rhob
      t5 = 1/t3
      t6 = t5*sigmabb
      t7 = dsqrt(sigmabb)
      t8 = t7*t5
      t9 = dlog(t8+dsqrt(1+t8**2))
      t12 = 1.D0+0.252D-1*t8*t9
      t13 = 1/t12
      t16 = 1/rhob
      t17 = t16**(1.D0/3.D0)
      t19 = t16**(1.D0/6.D0)
      t21 = 0.6203504908994D0*t17+0.1584942278842832D2*t19+0.101578D3
      t22 = 1/t21
      t25 = dlog(0.6203504908994D0*t17*t22)
      t28 = 0.1575246635799487D1*t19+0.201231D2
      t31 = datan(0.1171685277708993D1/t28)
      t34 = 0.7876233178997433D0*t19+0.743294D0
      t35 = t34**2
      t37 = dlog(t35*t22)
      zk(i) = -0.74442058907928D0*t3-0.3024D-2*t6*t13+0.19D0*rhob*
     #(0.1554535D-1*t25+0.6188180297906063D0*t31+0.2667310007273315D-2
     #*t37)
      vrhoa(i) = 0.D0
      t43 = rhob**2
      t45 = 1/t2/t43
      t46 = t45*sigmabb
      t49 = t12**2
      t50 = 1/t49
      t54 = t43*rhob
      t55 = t2**2
      t60 = 1/t55/t43
      t62 = 1.D0+sigmabb*t60
      t63 = dsqrt(t62)
      t64 = 1/t63
      t67 = -0.336D-1*t7*t45*t9-0.336D-1*sigmabb/t55/t54*t64
      t68 = t50*t67
      t74 = t17**2
      t75 = 1/t74
      t76 = t75*t22
      t77 = 1/t43
      t80 = t21**2
      t81 = 1/t80
      t82 = t17*t81
      t85 = t19**2
      t86 = t85**2
      t87 = t86*t19
      t88 = 1/t87
      t89 = t88*t77
      t91 = -0.2067834969664667D0*t75*t77-0.2641570464738054D1*t89
      t94 = -0.2067834969664667D0*t76*t77-0.6203504908994D0*t82*t91
      t95 = 1/t17
      t96 = t94*t95
      t97 = t96*t21
      t99 = t28**2
      t100 = 1/t99
      t101 = t100*t88
      t103 = 1.D0+0.137284639D1*t100
      t104 = 1/t103
      t106 = t101*t77*t104
      t108 = t34*t22
      t111 = t35*t81
      t114 = -0.2625411059665811D0*t108*t89-1.D0*t111*t91
      t115 = 1/t35
      t116 = t114*t115
      t117 = t116*t21
      vrhob(i) = -0.99256078543904D0*t2+0.4032D-2*t46*t13+0.3024D-2*t6
     #*t68+0.29536165D-2*t25+0.1175754256602152D0*t31
     #+0.5067889013819299D-3*t37+0.19D0*rhob*(0.2505897912236993D-1
     #*t97+0.1903580477513215D0*t106+0.2667310007273315D-2*t117)
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      t130 = 0.126D-1/t7*t5*t9+0.126D-1*t60*t64
      vsigmabb(i) = -0.3024D-2*t5*t13+0.3024D-2*t6*t50*t130
      v2rhoa2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t137 = 1/t2/t54
      t144 = 1/t49/t12
      t145 = t67**2
      t152 = t43**2
      t158 = sigmabb**2
      t164 = 1/t63/t62
      t175 = 1/t74/t16
      t177 = 1/t152
      t178 = t175*t22*t177
      t184 = 1/t54
      t188 = 1/t80/t21
      t190 = t91**2
      t198 = 1/t87/t16
      t199 = t198*t177
      t201 = t88*t184
      t203 = -0.1378556646443111D0*t175*t177+0.4135669939329333D0*t75
     #*t184-0.2201308720615045D1*t199+0.5283140929476108D1*t201
      t221 = t177*t104
      t230 = t99**2
      t234 = t103**2
      s1 = -0.3308535951463467D0/t55-0.9408D-2*t137*sigmabb*t13
     #-0.8064D-2*t46*t68-0.6048D-2*t6*t144*t145
      s2 = s1+0.3024D-2*t6*t50*(0.784D-1*t7*t137*t9+0.168D0*sigmabb
     #/t55/t152*t64-0.448D-1*t158/t2/t152/t54*t164)
     #+0.9522412066500572D-2*t97
      s3 = s2+0.7233605814550218D-1*t106
      s4 = s3
      s5 = 0.101357780276386D-2*t117+0.19D0*rhob*
     #(0.2505897912236993D-1*(-0.1378556646443111D0*t178
     #+0.4135669939329333D0*t75*t81*t77*t91+0.4135669939329333D0*t76
     #*t184+0.12407009817988D1*t17*t188*t190-0.6203504908994D0*t82
     #*t203)*t95*t21+0.8352993040789975D-2*t94/t17/t16*t21*t77
     #+0.2505897912236993D-1*t96*t91+0.9995362477254242D-1/t99/t28
     #*t175*t221+0.1586317064594346D0*t100*t198*t221
     #-0.3807160955026431D0*t101*t184*t104-0.1372209729363994D0/t230
     #/t28*t175*t177/t234+0.2667310007273315D-2*(0.3446391616107778D-1
     #*t178+0.5250822119331622D0*t34*t81*t89*t91-0.2187842549721509D0
     #*t108*t199+0.5250822119331622D0*t108*t201+2.D0*t35*t188*t190
     #-1.D0*t111*t203)*t115*t21+0.7002785192652656D-3*t114/t35/t34*t21
     #*t88*t77+0.2667310007273315D-2*t116*t91)
      v2rhob2(i) = s4+s5
      v2sigmaaa2(i) = 0.D0
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      t272 = t130**2
      v2sigmabb2(i) = 0.6048D-2*t5*t50*t130-0.6048D-2*t6*t144*t272
     #+0.3024D-2*t6*t50*(-0.63D-2/t7/sigmabb*t5*t9+0.63D-2/sigmabb*t60
     #*t64-0.63D-2/t2/t152/rhob*t164)
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t3 = t2*rhoa
      t5 = 1/t3
      t6 = t5*sigmaaa
      t7 = dsqrt(sigmaaa)
      t8 = t7*t5
      t9 = dlog(t8+dsqrt(1+t8**2))
      t12 = 1.D0+0.252D-1*t8*t9
      t13 = 1/t12
      t16 = 1/rhoa
      t17 = t16**(1.D0/3.D0)
      t19 = t16**(1.D0/6.D0)
      t21 = 0.6203504908994D0*t17+0.1584942278842832D2*t19+0.101578D3
      t22 = 1/t21
      t25 = dlog(0.6203504908994D0*t17*t22)
      t28 = 0.1575246635799487D1*t19+0.201231D2
      t31 = datan(0.1171685277708993D1/t28)
      t34 = 0.7876233178997433D0*t19+0.743294D0
      t35 = t34**2
      t37 = dlog(t35*t22)
      zk(i) = -0.74442058907928D0*t3-0.3024D-2*t6*t13+0.19D0*rhoa*
     #(0.1554535D-1*t25+0.6188180297906063D0*t31+0.2667310007273315D-2
     #*t37)
      t43 = rhoa**2
      t45 = 1/t2/t43
      t46 = t45*sigmaaa
      t49 = t12**2
      t50 = 1/t49
      t54 = t43*rhoa
      t55 = t2**2
      t60 = 1/t55/t43
      t62 = 1.D0+sigmaaa*t60
      t63 = dsqrt(t62)
      t64 = 1/t63
      t67 = -0.336D-1*t7*t45*t9-0.336D-1*sigmaaa/t55/t54*t64
      t68 = t50*t67
      t74 = t17**2
      t75 = 1/t74
      t76 = t75*t22
      t77 = 1/t43
      t80 = t21**2
      t81 = 1/t80
      t82 = t17*t81
      t85 = t19**2
      t86 = t85**2
      t87 = t86*t19
      t88 = 1/t87
      t89 = t88*t77
      t91 = -0.2067834969664667D0*t75*t77-0.2641570464738054D1*t89
      t94 = -0.2067834969664667D0*t76*t77-0.6203504908994D0*t82*t91
      t95 = 1/t17
      t96 = t94*t95
      t97 = t96*t21
      t99 = t28**2
      t100 = 1/t99
      t101 = t100*t88
      t103 = 1.D0+0.137284639D1*t100
      t104 = 1/t103
      t106 = t101*t77*t104
      t108 = t34*t22
      t111 = t35*t81
      t114 = -0.2625411059665811D0*t108*t89-1.D0*t111*t91
      t115 = 1/t35
      t116 = t114*t115
      t117 = t116*t21
      vrhoa(i) = -0.99256078543904D0*t2+0.4032D-2*t46*t13+0.3024D-2*t6
     #*t68+0.29536165D-2*t25+0.1175754256602152D0*t31
     #+0.5067889013819299D-3*t37+0.19D0*rhoa*(0.2505897912236993D-1
     #*t97+0.1903580477513215D0*t106+0.2667310007273315D-2*t117)
      vrhob(i) = 0.D0
      t130 = 0.126D-1/t7*t5*t9+0.126D-1*t60*t64
      vsigmaaa(i) = -0.3024D-2*t5*t13+0.3024D-2*t6*t50*t130
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      t137 = 1/t2/t54
      t144 = 1/t49/t12
      t145 = t67**2
      t152 = t43**2
      t158 = sigmaaa**2
      t164 = 1/t63/t62
      t175 = 1/t74/t16
      t177 = 1/t152
      t178 = t175*t22*t177
      t184 = 1/t54
      t188 = 1/t80/t21
      t190 = t91**2
      t198 = 1/t87/t16
      t199 = t198*t177
      t201 = t88*t184
      t203 = -0.1378556646443111D0*t175*t177+0.4135669939329333D0*t75
     #*t184-0.2201308720615045D1*t199+0.5283140929476108D1*t201
      t221 = t177*t104
      t230 = t99**2
      t234 = t103**2
      s1 = -0.3308535951463467D0/t55-0.9408D-2*t137*sigmaaa*t13
     #-0.8064D-2*t46*t68-0.6048D-2*t6*t144*t145
      s2 = s1+0.3024D-2*t6*t50*(0.784D-1*t7*t137*t9+0.168D0*sigmaaa
     #/t55/t152*t64-0.448D-1*t158/t2/t152/t54*t164)
     #+0.9522412066500572D-2*t97
      s3 = s2+0.7233605814550218D-1*t106
      s4 = s3
      s5 = 0.101357780276386D-2*t117+0.19D0*rhoa*
     #(0.2505897912236993D-1*(-0.1378556646443111D0*t178
     #+0.4135669939329333D0*t75*t81*t77*t91+0.4135669939329333D0*t76
     #*t184+0.12407009817988D1*t17*t188*t190-0.6203504908994D0*t82
     #*t203)*t95*t21+0.8352993040789975D-2*t94/t17/t16*t21*t77
     #+0.2505897912236993D-1*t96*t91+0.9995362477254242D-1/t99/t28
     #*t175*t221+0.1586317064594346D0*t100*t198*t221
     #-0.3807160955026431D0*t101*t184*t104-0.1372209729363994D0/t230
     #/t28*t175*t177/t234+0.2667310007273315D-2*(0.3446391616107778D-1
     #*t178+0.5250822119331622D0*t34*t81*t89*t91-0.2187842549721509D0
     #*t108*t199+0.5250822119331622D0*t108*t201+2.D0*t35*t188*t190
     #-1.D0*t111*t203)*t115*t21+0.7002785192652656D-3*t114/t35/t34*t21
     #*t88*t77+0.2667310007273315D-2*t116*t91)
      v2rhoa2(i) = s4+s5
      v2rhob2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t272 = t130**2
      v2sigmaaa2(i) = 0.6048D-2*t5*t50*t130-0.6048D-2*t6*t144*t272
     #+0.3024D-2*t6*t50*(-0.63D-2/t7/sigmaaa*t5*t9+0.63D-2/sigmaaa*t60
     #*t64-0.63D-2/t2/t152/rhoa*t164)
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      v2sigmabb2(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t5 = t4*rhoa
      t7 = 1/t5
      t8 = t7*sigmaaa
      t9 = dsqrt(sigmaaa)
      t10 = t9*t7
      t11 = dlog(t10+dsqrt(1+t10**2))
      t14 = 1.D0+0.252D-1*t10*t11
      t15 = 1/t14
      t18 = rhob**(1.D0/3.D0)
      t19 = t18*rhob
      t21 = 1/t19
      t22 = t21*sigmabb
      t23 = dsqrt(sigmabb)
      t24 = t23*t21
      t25 = dlog(t24+dsqrt(1+t24**2))
      t28 = 1.D0+0.252D-1*t24*t25
      t29 = 1/t28
      t32 = rho**(1.D0/3.D0)
      t33 = 1/t32
      t35 = 1.D0+0.349D0*t33
      t36 = 1/t35
      t37 = t36*rhoa
      t38 = 1/rho
      t39 = rhob*t38
      t42 = 0.2533D0*t33
      t43 = dexp(-t42)
      t44 = t43*t36
      t45 = rho**2
      t46 = t45*rho
      t47 = t32**2
      t49 = 1/t47/t46
      t50 = rhoa*rhob
      t51 = rhoa**2
      t52 = t4**2
      t53 = t52*t51
      t54 = 0.3646239897876478D2*t53
      t55 = rhob**2
      t56 = t18**2
      t57 = t56*t55
      t58 = 0.3646239897876478D2*t57
      t60 = t33*t36
      t62 = 0.2611111111111111D1-0.9850555555555556D-1*t33
     #-0.1357222222222222D0*t60
      t63 = t62*sigma
      t67 = sigmaaa+sigmabb
      t69 = 1.D0*(0.25D1-0.1407222222222222D-1*t33
     #-0.1938888888888889D-1*t60)*t67
      t71 = t42+0.349D0*t60-11.D0
      t75 = rhoa*t38*sigmaaa+t39*sigmabb
      t77 = 0.1111111111111111D0*t71*t75
      t78 = t54+t58+t63-t69-t77
      t82 = 0.6666666666666667D0*t45
      t83 = 1.D0*t51
      t86 = 1.D0*t55
      t89 = t50*t78-0.6666666666666667D0*t45*sigma+(t82-t83)*sigmabb+
     #(t82-t86)*sigmaaa
      t93 = t38**(1.D0/3.D0)
      t94 = 0.6203504908994D0*t93
      t95 = t38**(1.D0/6.D0)
      t97 = t94+0.1029581201158544D2*t95+0.427198D2
      t98 = 1/t97
      t101 = dlog(0.6203504908994D0*t93*t98)
      t103 = 0.1575246635799487D1*t95
      t104 = t103+0.13072D2
      t107 = datan(0.448998886412873D-1/t104)
      t109 = 0.7876233178997433D0*t95
      t110 = t109+0.409286D0
      t111 = t110**2
      t113 = dlog(t111*t98)
      t116 = t94+0.8908571061768626D0*t95+0.130045D2
      t117 = 1/t116
      t120 = dlog(0.6203504908994D0*t93*t117)
      t121 = t103+0.113107D1
      t124 = datan(0.7123108917818118D1/t121)
      t126 = t109+0.47584D-2
      t127 = t126**2
      t129 = dlog(t127*t117)
      t131 = t120+0.3177080047439415D0*t124+0.4140337942820627D-3*t129
      t133 = rhoa-1.D0*rhob
      t134 = t133*t38
      t135 = 1.D0+t134
      t136 = t135**(1.D0/3.D0)
      t139 = 1.D0-1.D0*t134
      t140 = t139**(1.D0/3.D0)
      t142 = t136*t135+t140*t139-2.D0
      t143 = t131*t142
      t145 = t94+0.1584942278842832D2*t95+0.101578D3
      t146 = 1/t145
      t149 = dlog(0.6203504908994D0*t93*t146)
      t151 = t103+0.201231D2
      t154 = datan(0.1171685277708993D1/t151)
      t156 = t109+0.743294D0
      t157 = t156**2
      t159 = dlog(t157*t146)
      t164 = 0.1554535D-1*t149+0.6188180297906063D0*t154
     #+0.2667310007273315D-2*t159-0.310907D-1*t101-0.205219729378375D2
     #*t107-0.4431373767749538D-2*t113
      t165 = 1/t131
      t168 = -0.101257459063883D3*t164*t165-1.D0
      t169 = t133**2
      t170 = t169**2
      t171 = t168*t170
      t172 = t45**2
      t173 = 1/t172
      t175 = 1.D0+t171*t173
      t176 = t143*t175
      zk(i) = -0.74442058907928D0*t5-0.3024D-2*t8*t15
     #-0.74442058907928D0*t19-0.3024D-2*t22*t29-0.1593432D0*t37*t39
     #-0.52583256D-2*t44*t49*t89+0.19D0*rho*(0.310907D-1*t101
     #+0.205219729378375D2*t107+0.4431373767749538D-2*t113
     #-0.1899772193293833D-1*t176)
      t183 = 1/t4/t51
      t184 = t183*sigmaaa
      t187 = t14**2
      t188 = 1/t187
      t192 = t51*rhoa
      t194 = 1/t52/t192
      t196 = 1/t53
      t198 = 1.D0+sigmaaa*t196
      t199 = dsqrt(t198)
      t200 = 1/t199
      t203 = -0.336D-1*t9*t183*t11-0.336D-1*sigmaaa*t194*t200
      t204 = t188*t203
      t207 = t36*rhob
      t211 = t52*rhoa
      t213 = t71*t38
      t216 = 0.9723306394337274D2*t211-0.1111111111111111D0*t213*sigmaaa
      t220 = rhob*t78+t50*t216-2.D0*rhoa*sigmabb
      t228 = 0.1333333333333333D1*t136*t38-0.1333333333333333D1*t140*t38
      t229 = t131*t228
      t230 = t229*t175
      t232 = t169*t133
      t233 = t168*t232
      t234 = t233*t173
      t235 = t143*t234
      t240 = t35**2
      t241 = 1/t240
      t242 = t241*rhoa
      t244 = 1/t32/t45
      t247 = 0.185369256D-1*t242*rhob*t244
      t248 = 1/t45
      t249 = rhob*t248
      t251 = 0.1593432D0*t37*t249
      t252 = t172*rho
      t253 = 1/t252
      t254 = t253*t43
      t255 = t36*t89
      t257 = 0.44397795816D-3*t254*t255
      t258 = t43*t241
      t261 = 0.6117185448D-3*t258*t253*t89
      t263 = 1/t47/t172
      t266 = 0.192805272D-1*t44*t263*t89
      t268 = 1/t32/rho
      t270 = t268*t36
      t274 = 1/t47/rho*t241
      t276 = 0.3283518518518519D-1*t268+0.4524074074074074D-1*t270
     #-0.1578901851851852D-1*t274
      t287 = -0.8443333333333333D-1*t268-0.1163333333333333D0*t270
     #+0.4060033333333333D-1*t274
      t295 = -1.D0*rhoa*t248*sigmaaa-1.D0*t249*sigmabb
      t298 = t276*sigma-1.D0*(0.4690740740740741D-2*t268
     #+0.6462962962962963D-2*t270-0.2255574074074074D-2*t274)*t67
     #-0.1111111111111111D0*t287*t75-0.1111111111111111D0*t71*t295
      t306 = t50*t298-0.1333333333333333D1*rho*sigma
     #+0.1333333333333333D1*rho*sigmabb+0.1333333333333333D1*rho*sigmaaa
      t309 = 0.52583256D-2*t44*t49*t306
      t310 = 0.5907233D-2*t101
      t311 = 0.3899174858189126D1*t107
      t312 = 0.8419610158724123D-3*t113
      t313 = 0.3609567167258283D-2*t176
      t314 = t93**2
      t315 = 1/t314
      t316 = t315*t98
      t319 = t97**2
      t320 = 1/t319
      t321 = t93*t320
      t323 = 0.2067834969664667D0*t315*t248
      t324 = t95**2
      t325 = t324**2
      t326 = t325*t95
      t327 = 1/t326
      t328 = t327*t248
      t330 = -t323-0.1715968668597574D1*t328
      t333 = -0.2067834969664667D0*t316*t248-0.6203504908994D0*t321*t330
      t334 = 1/t93
      t335 = t333*t334
      t336 = t335*t97
      t338 = t104**2
      t339 = 1/t338
      t340 = t339*t327
      t342 = 1.D0+0.2016D-2*t339
      t343 = 1/t342
      t345 = t340*t248*t343
      t347 = t110*t98
      t350 = t111*t320
      t353 = -0.2625411059665811D0*t347*t328-1.D0*t350*t330
      t354 = 1/t111
      t355 = t353*t354
      t356 = t355*t97
      t358 = t315*t117
      t361 = t116**2
      t362 = 1/t361
      t363 = t93*t362
      t365 = -t323-0.1484761843628104D0*t328
      t368 = -0.2067834969664667D0*t358*t248-0.6203504908994D0*t363*t365
      t369 = t368*t334
      t372 = t121**2
      t373 = 1/t372
      t374 = t373*t327
      t376 = 1.D0+0.507386806551D2*t373
      t377 = 1/t376
      t381 = t126*t117
      t384 = t127*t362
      t387 = -0.2625411059665811D0*t381*t328-1.D0*t384*t365
      t388 = 1/t127
      t389 = t387*t388
      t392 = 0.161199195401647D1*t369*t116+0.5941485651138659D0*t374
     #*t248*t377+0.4140337942820627D-3*t389*t116
      t393 = t392*t142
      t394 = t393*t175
      t396 = t136*t133
      t399 = t140*t133
      t402 = -0.1333333333333333D1*t396*t248+0.1333333333333333D1*t399
     #*t248
      t403 = t131*t402
      t404 = t403*t175
      t406 = t315*t146
      t409 = t145**2
      t410 = 1/t409
      t411 = t93*t410
      t413 = -t323-0.2641570464738054D1*t328
      t416 = -0.2067834969664667D0*t406*t248-0.6203504908994D0*t411*t413
      t417 = t416*t334
      t420 = t151**2
      t421 = 1/t420
      t422 = t421*t327
      t424 = 1.D0+0.137284639D1*t421
      t425 = 1/t424
      t429 = t156*t146
      t432 = t157*t410
      t435 = -0.2625411059665811D0*t429*t328-1.D0*t432*t413
      t436 = 1/t157
      t437 = t435*t436
      t443 = 0.2505897912236993D-1*t417*t145+0.1903580477513215D0*t422
     #*t248*t425+0.2667310007273315D-2*t437*t145-0.5011795824473985D-1
     #*t336-0.2419143800947354D0*t345-0.4431373767749538D-2*t356
      t446 = t131**2
      t447 = 1/t446
      t448 = t164*t447
      t451 = -0.101257459063883D3*t443*t165+0.101257459063883D3*t448
     #*t392
      t452 = t451*t170
      t456 = t452*t173-4.D0*t171*t253
      t457 = t143*t456
      t461 = 0.19D0*rho*(0.5011795824473985D-1*t336
     #+0.2419143800947354D0*t345+0.4431373767749538D-2*t356
     #-0.1899772193293833D-1*t394-0.1899772193293833D-1*t404
     #-0.1899772193293833D-1*t457)
      vrhoa(i) = -0.99256078543904D0*t4+0.4032D-2*t184*t15+0.3024D-2
     #*t8*t204-0.1593432D0*t207*t38-0.52583256D-2*t44*t49*t220+0.19D0
     #*rho*(-0.1899772193293833D-1*t230-0.7599088773175333D-1*t235)
     #-t247+t251-t257-t261+t266-t309+t310+t311+t312-t313+t461
      t464 = 1/t18/t55
      t465 = t464*sigmabb
      t468 = t28**2
      t469 = 1/t468
      t473 = t55*rhob
      t475 = 1/t56/t473
      t477 = 1/t57
      t479 = 1.D0+sigmabb*t477
      t480 = dsqrt(t479)
      t481 = 1/t480
      t484 = -0.336D-1*t23*t464*t25-0.336D-1*sigmabb*t475*t481
      t485 = t469*t484
      t491 = t56*rhob
      t495 = 0.9723306394337274D2*t491-0.1111111111111111D0*t213*sigmabb
      t499 = rhoa*t78+t50*t495-2.D0*rhob*sigmaaa
      t503 = -t228
      t504 = t131*t503
      t505 = t504*t175
      vrhob(i) = -0.99256078543904D0*t18+0.4032D-2*t465*t29+0.3024D-2
     #*t22*t485-0.1593432D0*t37*t38-0.52583256D-2*t44*t49*t499+0.19D0
     #*rho*(-0.1899772193293833D-1*t505+0.7599088773175333D-1*t235)
     #-t247+t251-t257-t261+t266-t309+t310+t311+t312-t313+t461
      t513 = 1/t9
      t519 = 0.126D-1*t513*t7*t11+0.126D-1*t196*t200
      t520 = t188*t519
      t523 = 0.1407222222222222D-1*t33
      t524 = 0.1938888888888889D-1*t60
      t525 = t71*rhoa
      t528 = -0.25D1+t523+t524-0.1111111111111111D0*t525*t38
      t530 = t50*t528+t82-t86
      t536 = t50*t62-0.6666666666666667D0*t45
      t538 = t44*t49*t536
      t539 = 0.52583256D-2*t538
      vsigmaaa(i) = -0.3024D-2*t7*t15+0.3024D-2*t8*t520-0.52583256D-2
     #*t44*t49*t530-t539
      vsigmaab(i) = -0.105166512D-1*t538
      t543 = 1/t23
      t549 = 0.126D-1*t543*t21*t25+0.126D-1*t477*t481
      t550 = t469*t549
      t553 = t71*rhob
      t556 = -0.25D1+t523+t524-0.1111111111111111D0*t553*t38
      t558 = t50*t556+t82-t83
      vsigmabb(i) = -0.3024D-2*t21*t29+0.3024D-2*t22*t550
     #-0.52583256D-2*t44*t49*t558-t539
      t573 = 1/t314/t38
      t575 = t573*t98*t173
      t581 = 1/t46
      t585 = 1/t319/t97
      t587 = t330**2
      t591 = 0.1378556646443111D0*t573*t173
      t593 = 0.4135669939329333D0*t315*t581
      t595 = 1/t326/t38
      t596 = t595*t173
      t598 = t327*t581
      t600 = -t591+t593-0.1429973890497978D1*t596+0.3431937337195148D1
     #*t598
      t605 = (-0.1378556646443111D0*t575+0.4135669939329333D0*t315
     #*t320*t248*t330+0.4135669939329333D0*t316*t581
     #+0.12407009817988D1*t93*t585*t587-0.6203504908994D0*t321*t600)
     #*t334*t97
      t608 = 1/t93/t38
      t611 = t333*t608*t97*t248
      t613 = t335*t330
      t618 = t173*t343
      t619 = 1/t338/t104*t573*t618
      t622 = t339*t595*t618
      t625 = t340*t581*t343
      t627 = t338**2
      t631 = t342**2
      t634 = 1/t627/t104*t573*t173/t631
      t652 = (0.3446391616107778D-1*t575+0.5250822119331622D0*t110
     #*t320*t328*t330-0.2187842549721509D0*t347*t596
     #+0.5250822119331622D0*t347*t598+2.D0*t111*t585*t587-1.D0*t350
     #*t600)*t354*t97
      t659 = t353/t111/t110*t97*t327*t248
      t661 = t355*t330
      t664 = t573*t117*t173
      t673 = 1/t361/t116
      t675 = t365**2
      t680 = -t591+t593-0.1237301536356754D0*t596+0.2969523687256209D0
     #*t598
      t696 = t173*t377
      t705 = t372**2
      t709 = t376**2
      t741 = 0.161199195401647D1*(-0.1378556646443111D0*t664
     #+0.4135669939329333D0*t315*t362*t248*t365+0.4135669939329333D0
     #*t358*t581+0.12407009817988D1*t93*t673*t675-0.6203504908994D0
     #*t363*t680)*t334*t116+0.5373306513388232D0*t368*t608*t116*t248
     #+0.161199195401647D1*t369*t365+0.3119768427869032D0/t372/t121
     #*t573*t696+0.495123804261555D0*t373*t595*t696
     #-0.1188297130227732D1*t374*t581*t377-0.1582929339795102D2/t705
     #/t121*t573*t173/t709+0.4140337942820627D-3*
     #(0.3446391616107778D-1*t664+0.5250822119331622D0*t126*t362*t328
     #*t365-0.2187842549721509D0*t381*t596+0.5250822119331622D0*t381
     #*t598+2.D0*t127*t673*t675-1.D0*t384*t680)*t388*t116
     #+0.1087008902583527D-3*t387/t127/t126*t116*t327*t248
     #+0.4140337942820627D-3*t389*t365
      t750 = t136**2
      t751 = 1/t750
      t757 = t140**2
      t758 = 1/t757
      t771 = t573*t146*t173
      t780 = 1/t409/t145
      t782 = t413**2
      t787 = -t591+t593-0.2201308720615045D1*t596+0.5283140929476108D1
     #*t598
      t803 = t173*t425
      t812 = t420**2
      t816 = t424**2
      s1 = 0.2505897912236993D-1*(-0.1378556646443111D0*t771
     #+0.4135669939329333D0*t315*t410*t248*t413+0.4135669939329333D0
     #*t406*t581+0.12407009817988D1*t93*t780*t782-0.6203504908994D0
     #*t411*t787)*t334*t145+0.8352993040789975D-2*t416*t608*t145*t248
     #+0.2505897912236993D-1*t417*t413+0.9995362477254242D-1/t420/t151
     #*t573*t803+0.1586317064594346D0*t421*t595*t803
     #-0.3807160955026431D0*t422*t581*t425-0.1372209729363994D0/t812
     #/t151*t573*t173/t816+0.2667310007273315D-2*
     #(0.3446391616107778D-1*t771+0.5250822119331622D0*t156*t410*t328
     #*t413-0.2187842549721509D0*t429*t596+0.5250822119331622D0*t429
     #*t598+2.D0*t157*t780*t782-1.D0*t432*t787)*t436*t145
     #+0.7002785192652656D-3*t435/t157/t156*t145*t327*t248
     #+0.2667310007273315D-2*t437*t413
      t858 = s1-0.5011795824473985D-1*t605-0.1670598608157995D-1*t611
     #-0.5011795824473985D-1*t613-0.1270249377985834D0*t619
     #-0.2015953167456128D0*t622+0.4838287601894708D0*t625
     #+0.2560822746019441D-3*t634-0.4431373767749538D-2*t652
     #-0.1163417769936259D-2*t659-0.4431373767749538D-2*t661
      t867 = t392**2
      t877 = t172*t45
      t878 = 1/t877
      t884 = 0.5011795824473985D-1*t605+0.1670598608157995D-1*t611
     #+0.5011795824473985D-1*t613+0.1270249377985834D0*t619
     #+0.2015953167456128D0*t622-0.4838287601894708D0*t625
     #-0.2560822746019441D-3*t634+0.4431373767749538D-2*t652
     #+0.1163417769936259D-2*t659+0.4431373767749538D-2*t661
     #-0.1899772193293833D-1*t741*t142*t175-0.3799544386587666D-1*t392
     #*t402*t175-0.3799544386587666D-1*t393*t456-0.1899772193293833D-1
     #*t131*(0.4444444444444444D0*t751*t169*t173+0.2666666666666667D1
     #*t396*t581+0.4444444444444444D0*t758*t169*t173
     #-0.2666666666666667D1*t399*t581)*t175-0.3799544386587666D-1*t403
     #*t456-0.1899772193293833D-1*t143*((-0.101257459063883D3*t858
     #*t165+0.2025149181277661D3*t443*t447*t392-0.2025149181277661D3
     #*t164/t446/t131*t867+0.101257459063883D3*t448*t741)*t170*t173
     #-8.D0*t452*t253+20.D0*t171*t878)
      t886 = 0.19D0*rho*t884
      t889 = 1/t187/t14
      t890 = t203**2
      t895 = 1/t4/t192
      t899 = t51**2
      t905 = sigmaaa**2
      t911 = 1/t199/t198
      t921 = t254*t36*t220
      t924 = t44*t263*t220
      t927 = t258*t253*t220
      t930 = t287*t38
      t933 = t71*t248
      t940 = t44*t49*(rhob*t298+t50*(-0.1111111111111111D0*t930
     #*sigmaaa+0.1111111111111111D0*t933*sigmaaa))
      t942 = 0.9192746443599945D-1*t345
      t943 = 0.1904482413300114D-1*t336
      t944 = 0.1683922031744825D-2*t356
      t945 = 0.7219134334516566D-2*t394
      t946 = 0.7219134334516566D-2*t404
      t951 = 0.4444444444444444D0*t751*t248+0.4444444444444444D0*t758
     #*t248
      t954 = 0.1899772193293833D-1*t131*t951*t175
      t955 = t229*t234
      t959 = t143*t168*t169*t173
      t960 = 0.22797266319526D0*t959
      t966 = -0.2887653733806626D-1*t235-0.52583256D-2*t44*t49*(2.D0
     #*rhob*t216+0.1620551065722879D3*t211*rhob-2.D0*sigmabb)+t886
     #-0.7219134334516566D-2*t230-0.6048D-2*t8*t889*t890+0.3024D-2*t8
     #*t188*(0.784D-1*t9*t895*t11+0.168D0*sigmaaa/t52/t899*t200
     #-0.448D-1*t905/t4/t899/t192*t911)-0.8064D-2*t184*t204
     #-0.88795591632D-3*t921+0.385610544D-1*t924-0.12234370896D-2*t927
     #-0.105166512D-1*t940+t942+t943+t944-t945-t946+0.19D0*rho*(-t954
     #-0.1519817754635067D0*t955-t960)-0.3308535951463467D0/t52
      t967 = 0.7219134334516566D-2*t457
      t969 = 1/t240/t35
      t971 = rhob*t49
      t973 = 0.43129246896D-2*t969*rhoa*t971
      t978 = 0.61789752D-1*t242*rhob/t32/t46
      t981 = 0.384780897072D-2*t878*t43*t255
      t984 = 0.88795591632D-3*t254*t36*t306
      t985 = rhob*t581
      t987 = 0.3186864D0*t37*t985
      t989 = 1/t32/t877
      t990 = t989*t43
      t992 = 0.37486538933976D-4*t990*t255
      t995 = 0.10329887159856D-3*t990*t241*t89
      t998 = 0.12234370896D-2*t258*t253*t306
      t1001 = 0.1899772193293833D-1*t392*t228*t175
      t1002 = t393*t234
      t1003 = 0.7599088773175333D-1*t1002
      t1014 = -0.4444444444444444D0*t751*t133*t581
     #-0.1333333333333333D1*t136*t248-0.4444444444444444D0*t758*t133
     #*t581+0.1333333333333333D1*t140*t248
      t1017 = 0.1899772193293833D-1*t131*t1014*t175
      t1018 = t403*t234
      t1019 = 0.7599088773175333D-1*t1018
      t1021 = 0.1899772193293833D-1*t229*t456
      t1023 = t451*t232*t173
      t1025 = t233*t253
      t1027 = 4.D0*t1023-16.D0*t1025
      t1031 = rho*(-t1001-t1003-t1017-t1019-t1021
     #-0.1899772193293833D-1*t143*t1027)
      t1036 = 0.1423265147568D-3*t43*t969*t989*t89
      t1039 = 0.53015607216D-2*t258*t878*t89
      t1042 = 0.385610544D-1*t44*t263*t306
      t1044 = t244*t36
      t1048 = 1/t47/t45*t241
      t1050 = t581*t969
      t1086 = 0.52583256D-2*t44*t49*(t50*((-0.4378024691358025D-1*t244
     #-0.6032098765432099D-1*t1044+0.3157803703703704D-1*t1048
     #-0.3673578308641975D-2*t1050)*sigma-1.D0*(-0.6254320987654321D-2
     #*t244-0.8617283950617284D-2*t1044+0.4511148148148148D-2*t1048
     #-0.5247969012345679D-3*t1050)*t67-0.1111111111111111D0*
     #(0.1125777777777778D0*t244+0.1551111111111111D0*t1044
     #-0.8120066666666667D-1*t1048+0.9446344222222222D-2*t1050)*t75
     #-0.2222222222222222D0*t287*t295-0.1111111111111111D0*t71*(2.D0
     #*rhoa*t581*sigmaaa+2.D0*t985*sigmabb))-0.1333333333333333D1
     #*sigma+0.1333333333333333D1*sigmabb+0.1333333333333333D1*sigmaaa)
      t1091 = 0.899757936D-1*t44/t47/t252*t89
      t1095 = t143*t1023
      t1097 = t143*t1025
      t1100 = rho*(-t1001-t1017-t1021-t1003-t1019
     #-0.7599088773175333D-1*t1095+0.3039635509270133D0*t1097)
      t1103 = t241*rhob*t244
      t1105 = t207*t248
      t1107 = -t967-t973+t978+t981-t984-t987-t992-t995-t998+0.19D0
     #*t1031-t1036+t1039+t1042-t1086-t1091-0.9408D-2*t895*sigmaaa*t15
     #+0.19D0*t1100-0.370738512D-1*t1103+0.3186864D0*t1105
      v2rhoa2(i) = t966+t1107
      t1119 = t254*t36*t499
      t1122 = t258*t253*t499
      t1125 = t44*t263*t499
      t1136 = t44*t49*(rhoa*t298+t50*(-0.1111111111111111D0*t930
     #*sigmabb+0.1111111111111111D0*t933*sigmabb))
      t1138 = t504*t234
      t1143 = t242*t244
      t1145 = t37*t248
      t1147 = 0.2887653733806626D-1*t235+t886+t942+t943+t944-t945-t946
     #-0.52583256D-2*t44*t49*(2.D0*rhoa*t495+0.1620551065722879D3*rhoa
     #*t491-2.D0*sigmaaa)-0.88795591632D-3*t1119-0.12234370896D-2
     #*t1122+0.385610544D-1*t1125-0.105166512D-1*t1136+0.19D0*rho*(
     #-t954+0.1519817754635067D0*t1138-t960)-t967-0.370738512D-1*t1143
     #+0.3186864D0*t1145-t973+t978
      t1151 = 0.1899772193293833D-1*t392*t503*t175
      t1152 = 0.7599088773175333D-1*t1002
      t1156 = -0.1899772193293833D-1*t131*t1014*t175
      t1157 = 0.7599088773175333D-1*t1018
      t1159 = 0.1899772193293833D-1*t504*t456
      t1164 = rho*(-t1151+t1152-t1156+t1157-t1159
     #+0.1899772193293833D-1*t143*t1027)
      t1167 = 1/t18/t473
      t1174 = rho*(-t1151-t1156-t1159+t1152+t1157
     #+0.7599088773175333D-1*t1095-0.3039635509270133D0*t1097)
      t1183 = t55**2
      t1189 = sigmabb**2
      t1195 = 1/t480/t479
      t1203 = 1/t468/t28
      t1204 = t484**2
      t1208 = t981-t984-t987-t992-t995-t998-0.7219134334516566D-2*t505
     #+0.19D0*t1164-t1036+t1039+t1042-t1086-t1091-0.9408D-2*t1167
     #*sigmabb*t29+0.19D0*t1174-0.8064D-2*t465*t485
     #-0.3308535951463467D0/t56+0.3024D-2*t22*t469*(0.784D-1*t23*t1167
     #*t25+0.168D0*sigmabb/t56/t1183*t481-0.448D-1*t1189/t18/t1183
     #/t473*t1195)-0.6048D-2*t22*t1203*t1204
      v2rhob2(i) = t1147+t1208
      t1220 = t886-0.3609567167258283D-2*t230-0.44397795816D-3*t921
     #+0.192805272D-1*t924-0.6117185448D-3*t927-0.52583256D-2*t940
     #+t942+t943+t944-t945-t946-0.44397795816D-3*t1119-0.6117185448D-3
     #*t1122+0.192805272D-1*t1125-0.52583256D-2*t1136-t967
     #-0.185369256D-1*t1143+0.1593432D0*t1145-t973+t978
      t1247 = t1039+t1042-t1086-t1091+0.95D-1*t1174+0.95D-1*t1100
     #-0.185369256D-1*t1103+0.1593432D0*t1105-0.52583256D-2*t44*t49*
     #(t54+t58+t63-t69-t77+rhob*t495+rhoa*t216)-0.1593432D0*t36*t38
     #+0.19D0*rho*(0.1899772193293833D-1*t131*t951*t175
     #+0.7599088773175333D-1*t955-0.7599088773175333D-1*t1138
     #+0.22797266319526D0*t959)
      v2rhoab(i) = t1220+t981-t984-t987-t992-t995-t998
     #-0.3609567167258283D-2*t505+0.95D-1*t1031+0.95D-1*t1164-t1036
     #+t1247
      t1253 = t7*t188
      t1277 = 0.1111111111111111D0*t50*t213
      t1284 = 0.44397795816D-3*t254*t36*t530
      t1287 = 0.6117185448D-3*t258*t253*t530
      t1290 = 0.192805272D-1*t44*t263*t530
      t1291 = 0.4690740740740741D-2*t268
      t1292 = 0.6462962962962963D-2*t270
      t1293 = 0.2255574074074074D-2*t274
      t1301 = 0.1333333333333333D1*rho
      t1305 = 0.52583256D-2*t44*t49*(t50*(-t1291-t1292+t1293
     #-0.1111111111111111D0*t287*rhoa*t38+0.1111111111111111D0*t525
     #*t248)+t1301)
      t1307 = t44*t971*t62
      t1308 = 0.52583256D-2*t1307
      t1310 = t254*t36*t536
      t1311 = 0.44397795816D-3*t1310
      t1313 = t258*t253*t536
      t1314 = 0.6117185448D-3*t1313
      t1316 = t44*t263*t536
      t1317 = 0.192805272D-1*t1316
      t1322 = t44*t49*(t50*t276-0.1333333333333333D1*rho)
      t1323 = 0.52583256D-2*t1322
      v2rhoasigmaaa(i) = 0.4032D-2*t183*t15-0.4032D-2*t184*t520
     #+0.3024D-2*t1253*t203-0.6048D-2*t8*t889*t203*t519+0.3024D-2*t8
     #*t188*(-0.168D-1*t513*t183*t11-0.504D-1*t194*t200+0.168D-1
     #*sigmaaa/t4/t899/t51*t911)-0.52583256D-2*t44*t49*(rhob*t528
     #-t1277)-t1284-t1287+t1290-t1305-t1308-t1311-t1314+t1317-t1323
      t1325 = 0.88795591632D-3*t1310
      t1326 = 0.12234370896D-2*t1313
      t1327 = 0.385610544D-1*t1316
      t1328 = 0.105166512D-1*t1322
      v2rhoasigmaab(i) = -0.105166512D-1*t1307-t1325-t1326+t1327-t1328
      t1337 = 0.44397795816D-3*t254*t36*t558
      t1340 = 0.6117185448D-3*t258*t253*t558
      t1343 = 0.192805272D-1*t44*t263*t558
      t1354 = 0.52583256D-2*t44*t49*(t50*(-t1291-t1292+t1293
     #-0.1111111111111111D0*t287*rhob*t38+0.1111111111111111D0*t553
     #*t248)+t1301)
      v2rhoasigmabb(i) = -0.52583256D-2*t44*t49*(rhob*t556-2.D0*rhoa)
     #-t1337-t1340+t1343-t1354-t1308-t1311-t1314+t1317-t1323
      t1363 = t44*t49*rhoa*t62
      t1364 = 0.52583256D-2*t1363
      v2rhobsigmaaa(i) = -0.52583256D-2*t44*t49*(rhoa*t528-2.D0*rhob)
     #-t1284-t1287+t1290-t1305-t1364-t1311-t1314+t1317-t1323
      v2rhobsigmaab(i) = -0.105166512D-1*t1363-t1325-t1326+t1327-t1328
      t1370 = t21*t469
      v2rhobsigmabb(i) = 0.4032D-2*t464*t29-0.4032D-2*t465*t550
     #+0.3024D-2*t1370*t484-0.6048D-2*t22*t1203*t484*t549+0.3024D-2
     #*t22*t469*(-0.168D-1*t543*t464*t25-0.504D-1*t475*t481+0.168D-1
     #*sigmabb/t18/t1183/t55*t1195)-0.52583256D-2*t44*t49*(rhoa*t556
     #-t1277)-t1337-t1340+t1343-t1354-t1364-t1311-t1314+t1317-t1323
      t1399 = t519**2
      v2sigmaaa2(i) = 0.6048D-2*t1253*t519-0.6048D-2*t8*t889*t1399
     #+0.3024D-2*t8*t188*(-0.63D-2/t9/sigmaaa*t7*t11+0.63D-2/sigmaaa
     #*t196*t200-0.63D-2/t4/t899/rhoa*t911)
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      t1423 = t549**2
      v2sigmabb2(i) = 0.6048D-2*t1370*t549-0.6048D-2*t22*t1203*t1423
     #+0.3024D-2*t22*t469*(-0.63D-2/t23/sigmabb*t21*t25+0.63D-2
     #/sigmabb*t477*t481-0.63D-2/t18/t1183/rhob*t1195)
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      v2rhob2(i) = 0.0d0
      v2rhoab(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2rhoasigmaab(i) = 0.0d0
      v2rhoasigmabb(i) = 0.0d0
      v2rhobsigmaaa(i) = 0.0d0
      v2rhobsigmaab(i) = 0.0d0
      v2rhobsigmabb(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      v2sigmaab2(i) = 0.0d0
      v2sigmabb2(i) = 0.0d0
      v2sigmaaaab(i) = 0.0d0
      v2sigmaaabb(i) = 0.0d0
      v2sigmaabbb(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end
      
      
      subroutine rks_xc_b3lyp_vwn5rpa
     & (ideriv,npt,rhoa1,sigmaaa1,
     &  zk,vrhoa,vsigmaaa,
     &  v2rhoa2,v2rhoasigmaaa,v2sigmaaa2)
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt)
      REAL sigmaaa1(npt)
      REAL zk(npt),vrhoa(npt),vsigmaaa(npt)
      REAL v2rhoa2(npt),v2rhoasigmaaa(npt),v2sigmaaa2(npt)
      parameter(tol=1.0d-20)
      
      if(ideriv.eq.0) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t3 = t2*rho
      t5 = 1/t3
      t7 = dsqrt(sigma)
      t8 = t7*t5
      t10 = dlog(0.1259921049894873D1*t8+dsqrt(1+0.1587401051968199D1
     #*t8**2))
      t17 = 1/t2
      t20 = 1/(1.D0+0.349D0*t17)
      t23 = 0.2533D0*t17
      t24 = dexp(-t23)
      t26 = rho**2
      t28 = t2**2
      t34 = t17*t20
      t56 = 1/rho
      t57 = t56**(1.D0/3.D0)
      t59 = t56**(1.D0/6.D0)
      t62 = 1/(0.6203504908994D0*t57+0.1029581201158544D2*t59
     #+0.427198D2)
      t65 = dlog(0.6203504908994D0*t57*t62)
      t71 = datan(0.448998886412873D-1/(0.1575246635799487D1*t59
     #+0.13072D2))
      t75 = (0.7876233178997433D0*t59+0.409286D0)**2
      t77 = dlog(t75*t62)
      zk(i) = -0.5908470131056179D0*t3-0.3810001254882096D-2*t5*sigma/
     #(1.D0+0.317500104573508D-1*t8*t10)-0.398358D-1*t20*rho
     #-0.52583256D-2*t24*t20/t28/t26/rho*(0.25D0*t26*
     #(0.1148493600075277D2*t28*t26+(0.2611111111111111D1
     #-0.9850555555555556D-1*t17-0.1357222222222222D0*t34)*sigma-0.5D0
     #*(0.25D1-0.1407222222222222D-1*t17-0.1938888888888889D-1*t34)
     #*sigma-0.2777777777777778D-1*(t23+0.349D0*t34-11.D0)*sigma)
     #-0.4583333333333333D0*t26*sigma)+0.19D0*rho*(0.310907D-1*t65
     #+0.205219729378375D2*t71+0.4431373767749538D-2*t77)
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t3 = t2*rho
      t5 = 1/t3
      t6 = t5*sigma
      t7 = dsqrt(sigma)
      t8 = t7*t5
      t10 = dlog(0.1259921049894873D1*t8+dsqrt(1+0.1587401051968199D1
     #*t8**2))
      t13 = 1.D0+0.317500104573508D-1*t8*t10
      t14 = 1/t13
      t17 = 1/t2
      t19 = 1.D0+0.349D0*t17
      t20 = 1/t19
      t23 = 0.2533D0*t17
      t24 = dexp(-t23)
      t25 = t24*t20
      t26 = rho**2
      t28 = t2**2
      t30 = 1/t28/t26/rho
      t31 = t28*t26
      t34 = t17*t20
      t36 = 0.2611111111111111D1-0.9850555555555556D-1*t17
     #-0.1357222222222222D0*t34
      t44 = t23+0.349D0*t34-11.D0
      t47 = 0.1148493600075277D2*t31+t36*sigma-0.5D0*(0.25D1
     #-0.1407222222222222D-1*t17-0.1938888888888889D-1*t34)*sigma
     #-0.2777777777777778D-1*t44*sigma
      t52 = 0.25D0*t26*t47-0.4583333333333333D0*t26*sigma
      t56 = 1/rho
      t57 = t56**(1.D0/3.D0)
      t59 = t56**(1.D0/6.D0)
      t61 = 0.6203504908994D0*t57+0.1029581201158544D2*t59+0.427198D2
      t62 = 1/t61
      t65 = dlog(0.6203504908994D0*t57*t62)
      t68 = 0.1575246635799487D1*t59+0.13072D2
      t71 = datan(0.448998886412873D-1/t68)
      t74 = 0.7876233178997433D0*t59+0.409286D0
      t75 = t74**2
      t77 = dlog(t75*t62)
      zk(i) = -0.5908470131056179D0*t3-0.3810001254882096D-2*t6*t14
     #-0.398358D-1*t20*rho-0.52583256D-2*t25*t30*t52+0.19D0*rho*
     #(0.310907D-1*t65+0.205219729378375D2*t71+0.4431373767749538D-2
     #*t77)
      t84 = 1/t2/t26
      t88 = t13**2
      t89 = 1/t88
      t94 = 1/t31
      t98 = dsqrt(1.D0+0.1587401051968199D1*sigma*t94)
      t99 = 1/t98
      t109 = t28*rho
      t112 = t44*t56*sigma
      t117 = rho*sigma
      t123 = t19**2
      t124 = 1/t123
      t127 = t26**2
      t129 = 1/t127/rho
      t144 = t5*t20
      t146 = 1/t109
      t147 = t146*t124
      t175 = t57**2
      t176 = 1/t175
      t178 = 1/t26
      t181 = t61**2
      t182 = 1/t181
      t186 = t59**2
      t187 = t186**2
      t189 = 1/t187/t59
      t190 = t189*t178
      t192 = -0.2067834969664667D0*t176*t178-0.1715968668597574D1*t190
      t200 = t68**2
      t201 = 1/t200
      s1 = -0.7877960174741572D0*t2+0.5080001673176129D-2*t84*sigma
     #*t14+0.1905000627441048D-2*t6*t89*(-0.8466669455293548D-1*t7*t84
     #*t10-0.106673350692263D0*sigma*t30*t99)-0.398358D-1*t20
     #-0.52583256D-2*t25*t30*(0.5D0*rho*t47+0.25D0*t26*
     #(0.3062649600200738D2*t109-0.2777777777777778D-1*t112)-0.25D0
     #*t117)-0.46342314D-2*t124*t17-0.44397795816D-3*t129*t24*t20*t52
      s2 = s1-0.6117185448D-3*t24*t124*t129*t52+0.192805272D-1*t25/t28
     #/t127*t52-0.52583256D-2*t25*t30*(0.25D0*t26*(
     #(0.3283518518518519D-1*t5+0.4524074074074074D-1*t144
     #-0.1578901851851852D-1*t147)*sigma-0.5D0*(0.4690740740740741D-2
     #*t5+0.6462962962962963D-2*t144-0.2255574074074074D-2*t147)*sigma
     #-0.2777777777777778D-1*(-0.8443333333333333D-1*t5
     #-0.1163333333333333D0*t144+0.4060033333333333D-1*t147)*sigma
     #+0.2777777777777778D-1*t112)-0.6666666666666667D0*t117)
      vrhoa(i) = s2+0.5907233D-2*t65+0.3899174858189126D1*t71
     #+0.8419610158724123D-3*t77+0.19D0*rho*(0.5011795824473985D-1*(
     #-0.2067834969664667D0*t176*t62*t178-0.6203504908994D0*t57*t182
     #*t192)/t57*t61+0.2419143800947354D0*t201*t189*t178/(1.D0
     #+0.2016D-2*t201)+0.4431373767749538D-2*(-0.2625411059665811D0
     #*t74*t62*t190-1.D0*t75*t182*t192)/t75*t61)
      vsigmaaa(i) = -0.1524000501952839D-1*t5*t14
     #+0.3810001254882096D-2*t6*t89*(0.6350002091470161D-1/t7*t5*t10
     #+0.8000501301919725D-1*t94*t99)+0.5842584D-3*t25*t146
     #-0.210333024D-1*t25*t30*(0.25D0*t26*t36-0.6666666666666667D0*t26)
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t3 = t2*rho
      t5 = 1/t3
      t6 = t5*sigma
      t7 = dsqrt(sigma)
      t8 = t7*t5
      t10 = dlog(0.1259921049894873D1*t8+dsqrt(1+0.1587401051968199D1
     #*t8**2))
      t13 = 1.D0+0.317500104573508D-1*t8*t10
      t14 = 1/t13
      t17 = 1/t2
      t19 = 1.D0+0.349D0*t17
      t20 = 1/t19
      t23 = 0.2533D0*t17
      t24 = dexp(-t23)
      t25 = t24*t20
      t26 = rho**2
      t27 = t26*rho
      t28 = t2**2
      t30 = 1/t28/t27
      t31 = t28*t26
      t32 = 0.1148493600075277D2*t31
      t34 = t17*t20
      t36 = 0.2611111111111111D1-0.9850555555555556D-1*t17
     #-0.1357222222222222D0*t34
      t37 = t36*sigma
      t42 = 0.5D0*(0.25D1-0.1407222222222222D-1*t17
     #-0.1938888888888889D-1*t34)*sigma
      t44 = t23+0.349D0*t34-11.D0
      t46 = 0.2777777777777778D-1*t44*sigma
      t47 = t32+t37-t42-t46
      t52 = 0.25D0*t26*t47-0.4583333333333333D0*t26*sigma
      t56 = 1/rho
      t57 = t56**(1.D0/3.D0)
      t59 = t56**(1.D0/6.D0)
      t61 = 0.6203504908994D0*t57+0.1029581201158544D2*t59+0.427198D2
      t62 = 1/t61
      t65 = dlog(0.6203504908994D0*t57*t62)
      t68 = 0.1575246635799487D1*t59+0.13072D2
      t71 = datan(0.448998886412873D-1/t68)
      t74 = 0.7876233178997433D0*t59+0.409286D0
      t75 = t74**2
      t77 = dlog(t75*t62)
      zk(i) = -0.5908470131056179D0*t3-0.3810001254882096D-2*t6*t14
     #-0.398358D-1*t20*rho-0.52583256D-2*t25*t30*t52+0.19D0*rho*
     #(0.310907D-1*t65+0.205219729378375D2*t71+0.4431373767749538D-2
     #*t77)
      t84 = 1/t2/t26
      t85 = t84*sigma
      t88 = t13**2
      t89 = 1/t88
      t94 = 1/t31
      t97 = 1.D0+0.1587401051968199D1*sigma*t94
      t98 = dsqrt(t97)
      t99 = 1/t98
      t102 = -0.8466669455293548D-1*t7*t84*t10-0.106673350692263D0
     #*sigma*t30*t99
      t103 = t89*t102
      t109 = t28*rho
      t111 = t44*t56
      t112 = t111*sigma
      t114 = 0.3062649600200738D2*t109-0.2777777777777778D-1*t112
      t117 = rho*sigma
      t119 = 0.5D0*rho*t47+0.25D0*t26*t114-0.25D0*t117
      t123 = t19**2
      t124 = 1/t123
      t127 = t26**2
      t128 = t127*rho
      t129 = 1/t128
      t130 = t129*t24
      t131 = t20*t52
      t134 = t24*t124
      t139 = 1/t28/t127
      t144 = t5*t20
      t146 = 1/t109
      t147 = t146*t124
      t149 = 0.3283518518518519D-1*t5+0.4524074074074074D-1*t144
     #-0.1578901851851852D-1*t147
      t160 = -0.8443333333333333D-1*t5-0.1163333333333333D0*t144
     #+0.4060033333333333D-1*t147
      t164 = t149*sigma-0.5D0*(0.4690740740740741D-2*t5
     #+0.6462962962962963D-2*t144-0.2255574074074074D-2*t147)*sigma
     #-0.2777777777777778D-1*t160*sigma+0.2777777777777778D-1*t112
      t168 = 0.25D0*t26*t164-0.6666666666666667D0*t117
      t175 = t57**2
      t176 = 1/t175
      t177 = t176*t62
      t178 = 1/t26
      t181 = t61**2
      t182 = 1/t181
      t183 = t57*t182
      t186 = t59**2
      t187 = t186**2
      t188 = t187*t59
      t189 = 1/t188
      t190 = t189*t178
      t192 = -0.2067834969664667D0*t176*t178-0.1715968668597574D1*t190
      t195 = -0.2067834969664667D0*t177*t178-0.6203504908994D0*t183*t192
      t196 = 1/t57
      t197 = t195*t196
      t198 = t197*t61
      t200 = t68**2
      t201 = 1/t200
      t202 = t201*t189
      t204 = 1.D0+0.2016D-2*t201
      t205 = 1/t204
      t207 = t202*t178*t205
      t209 = t74*t62
      t212 = t75*t182
      t215 = -0.2625411059665811D0*t209*t190-1.D0*t212*t192
      t216 = 1/t75
      t217 = t215*t216
      t218 = t217*t61
      vrhoa(i) = -0.7877960174741572D0*t2+0.5080001673176129D-2*t85
     #*t14+0.1905000627441048D-2*t6*t103-0.398358D-1*t20-0.52583256D-2
     #*t25*t30*t119-0.46342314D-2*t124*t17-0.44397795816D-3*t130*t131
     #-0.6117185448D-3*t134*t129*t52+0.192805272D-1*t25*t139*t52
     #-0.52583256D-2*t25*t30*t168+0.5907233D-2*t65
     #+0.3899174858189126D1*t71+0.8419610158724123D-3*t77+0.19D0*rho*
     #(0.5011795824473985D-1*t198+0.2419143800947354D0*t207
     #+0.4431373767749538D-2*t218)
      t225 = 1/t7
      t231 = 0.6350002091470161D-1*t225*t5*t10+0.8000501301919725D-1
     #*t94*t99
      t232 = t89*t231
      t240 = 0.25D0*t26*t36-0.6666666666666667D0*t26
      vsigmaaa(i) = -0.1524000501952839D-1*t5*t14
     #+0.3810001254882096D-2*t6*t232+0.5842584D-3*t25*t146
     #-0.210333024D-1*t25*t30*t240
      t245 = t127*t26
      t247 = 1/t2/t245
      t248 = t247*t24
      t254 = rho*t114
      t260 = t84*t20
      t262 = t94*t124
      t264 = 1/t27
      t266 = 1/t123/t19
      t267 = t264*t266
      t286 = t160*t56*sigma
      t289 = t44*t178*sigma
      t307 = 1/t245
      s1 = 0.1838549288719989D0*t207-0.74973077867952D-4*t248*t131
     #-0.20659774319712D-3*t248*t124*t52-0.52583256D-2*t25*t30*(t32
     #+t37-t42-t46+t254)-0.105166512D-1*t25*t30*(0.25D0*t26*((
     #-0.4378024691358025D-1*t84-0.6032098765432099D-1*t260
     #+0.3157803703703704D-1*t262-0.3673578308641975D-2*t267)*sigma
     #-0.5D0*(-0.6254320987654321D-2*t84-0.8617283950617284D-2*t260
     #+0.4511148148148148D-2*t262-0.5247969012345679D-3*t267)*sigma
     #-0.2777777777777778D-1*(0.1125777777777778D0*t84
     #+0.1551111111111111D0*t260-0.8120066666666667D-1*t262
     #+0.9446344222222222D-2*t267)*sigma+0.5555555555555556D-1*t286
     #-0.5555555555555556D-1*t289)-0.6666666666666667D0*sigma)
     #-0.1799515872D0*t25/t28/t128*t52
      t323 = s1+0.771221088D-1*t25*t139*t168+0.106031214432D-1*t134
     #*t307*t52-0.2846530295136D-3*t24*t266*t247*t52-0.24468741792D-2
     #*t134*t129*t168-0.177591183264D-2*t130*t20*t119
     #+0.3808964826600229D-1*t198+0.3367844063489649D-2*t218
      t325 = 1/t2/t27
      t348 = 1/t88/t13
      t349 = t102**2
      t376 = sigma**2
      t382 = 1/t98/t97
      t392 = 1/t175/t56
      t394 = 1/t127
      t395 = t392*t62*t394
      t404 = 1/t181/t61
      t406 = t192**2
      t414 = 1/t188/t56
      t415 = t414*t394
      t417 = t189*t264
      t419 = -0.1378556646443111D0*t392*t394+0.4135669939329333D0*t176
     #*t264-0.1429973890497978D1*t415+0.3431937337195148D1*t417
      t437 = t394*t205
      t446 = t200**2
      t450 = t204**2
      s1 = -0.2370667447482193D-1*t325*sigma*t14-0.21564623448D-2*t266
     #*t146-0.5251973449827715D0/t28-0.61789752D-2*t124*t5
     #-0.24468741792D-2*t134*t129*t119+0.771221088D-1*t25*t139*t119
     #-0.52583256D-2*t25*t30*(t254+0.2552208000167282D2*t31-0.5D0*sigma)
      s2 = s1-0.3810001254882096D-2*t6*t348*t349-0.177591183264D-2
     #*t130*t20*t168-0.210333024D-1*t25*t30*(0.5D0*rho*t164+0.25D0*t26
     #*(-0.2777777777777778D-1*t286+0.2777777777777778D-1*t289))
      s3 = s2+0.769561794144D-2*t307*t24*t131
      s4 = s3+0.1905000627441048D-2*t6*t89*(0.3951112412470322D0*t7
     #*t325*t10+0.106673350692263D1*sigma*t139*t99
     #-0.4515557042823225D0*t376/t2/t127/t27*t382)
      s5 = s4
      s7 = -0.1016000334635226D-1*t85*t103
      s8 = 0.38D0*rho*(0.5011795824473985D-1*(-0.1378556646443111D0
     #*t395+0.4135669939329333D0*t176*t182*t178*t192
     #+0.4135669939329333D0*t177*t264+0.12407009817988D1*t57*t404*t406
     #-0.6203504908994D0*t183*t419)*t196*t61+0.1670598608157995D-1
     #*t195/t57/t56*t61*t178+0.5011795824473985D-1*t197*t192
     #+0.1270249377985834D0/t200/t68*t392*t437+0.2015953167456128D0
     #*t201*t414*t437-0.4838287601894708D0*t202*t264*t205
     #-0.2560822746019441D-3/t446/t68*t392*t394/t450
     #+0.4431373767749538D-2*(0.3446391616107778D-1*t395
     #+0.5250822119331622D0*t74*t182*t190*t192-0.2187842549721509D0
     #*t209*t415+0.5250822119331622D0*t209*t417+2.D0*t75*t404*t406
     #-1.D0*t212*t419)*t216*t61+0.1163417769936259D-2*t215/t75/t74*t61
     #*t189*t178+0.4431373767749538D-2*t217*t192)
      s6 = s7+s8
      t485 = s5+s6
      v2rhoa2(i) = t323+t485
      t490 = t5*t89
      s1 = 0.2032000669270451D-1*t84*t14-0.5080001673176129D-2*t85
     #*t232+0.7620002509764193D-2*t490*t102-0.3810001254882096D-2*t6
     #*t348*t102*t231+0.1905000627441048D-2*t6*t89*(
     #-0.169333389105871D0*t225*t84*t10-0.640040104153578D0*t30*t99
     #+0.3386667782117419D0*sigma*t247*t382)-0.52583256D-2*t25*t30*(
     #-0.9444444444444444D0*rho-0.2777777777777778D-1*rho*t44)
     #+0.4933088424D-4*t264*t24*t20
      v2rhoasigmaaa(i) = s1+0.679687272D-4*t134*t264+0.80822412D-2*t25
     #*t94-0.105166512D-1*t25*t30*(0.25D0*t26*(-0.3D-22*t144
     #+0.5555555555555556D-1*t111)+0.1333333333333333D1*rho)
     #-0.105166512D-1*t25*t94*t36-0.177591183264D-2*t130*t20*t240
     #-0.24468741792D-2*t134*t129*t240+0.771221088D-1*t25*t139*t240
     #-0.210333024D-1*t25*t30*(0.25D0*t26*t149-0.1333333333333333D1*rho)
      t554 = t231**2
      v2sigmaaa2(i) = 0.3048001003905677D-1*t490*t231
     #-0.7620002509764193D-2*t6*t348*t554+0.3810001254882096D-2*t6*t89
     #*(-0.1270000418294032D0/t7/sigma*t5*t10+0.1600100260383945D0
     #/sigma*t94*t99-0.2540000836588064D0/t2/t128*t382)
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end

c:XC_B3LYP_VWN5RPAsubrend
_ENDIF
_IF(ccpdft,all,xc_b3pw91)
c:XC_B3PW91subrstart

c    Generated: Mon Nov 19 16:25:12 GMT 2007

      subroutine uks_xc_b3pw91
     & (ideriv,npt,rhoa1,rhob1,sigmaaa1,sigmabb1,sigmaab1,
     &  zk,vrhoa,vrhob,vsigmaaa,vsigmabb,vsigmaab,
     &  v2rhoa2,v2rhob2,v2rhoab,
     &  v2rhoasigmaaa,v2rhoasigmaab,v2rhoasigmabb,
     &  v2rhobsigmabb,v2rhobsigmaab,v2rhobsigmaaa,
     &  v2sigmaaa2,v2sigmaaaab,v2sigmaaabb,
     &  v2sigmaab2,v2sigmaabbb,v2sigmabb2)
c
c     A.D. Becke
c     Density-functional thermochemistry. III. 
c     The role of exact exchange
c     J.Chem.Phys. 98 (1993) 5648--5652
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt),rhob1(npt)
      REAL sigmaaa1(npt),sigmabb1(npt),sigmaab1(npt)
      REAL zk(npt),vrhoa(npt),vrhob(npt)
      REAL vsigmaaa(npt),vsigmabb(npt),vsigmaab(npt)
      REAL v2rhoa2(npt),v2rhob2(npt),v2rhoab(npt)
      REAL v2rhoasigmaaa(npt),v2rhoasigmaab(npt)
      REAL v2rhoasigmabb(npt),v2rhobsigmabb(npt)
      REAL v2rhobsigmaab(npt),v2rhobsigmaaa(npt)
      REAL v2sigmaaa2(npt),v2sigmaaaab(npt),v2sigmaaabb(npt)
      REAL v2sigmaab2(npt),v2sigmaabbb(npt),v2sigmabb2(npt)
      parameter(tol=1.0d-20)
      
      if (ideriv.eq.0) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t3 = t2*rhob
      t5 = 1/t3
      t7 = dsqrt(sigmabb)
      t8 = t7*t5
      t9 = dlog(t8+dsqrt(1+t8**2))
      t16 = 1/rhob
      t17 = t16**(1.D0/3.D0)
      t19 = 1.D0+0.1274696188700087D0*t17
      t20 = t16**(1.D0/6.D0)
      t23 = dsqrt(t16)
      t25 = t17**2
      t31 = dlog(1.D0+0.3216395899738507D2/(0.1112037486309468D2*t20
     #+0.3844746237447211D1*t17+0.1644733775567609D1*t23
     #+0.2405871291288192D0*t25))
      t32 = t19*t31
      t34 = rhob**2
      t36 = 1/t2/t34
      t40 = dexp(0.2513845706671277D1*t32)
      t41 = t40-1.D0
      t42 = 1/t41
      t43 = sigmabb**2
      t45 = t34**2
      t46 = t2**2
      t48 = 1/t46/t45
      t55 = t41**2
      t65 = dlog(1.D0+0.2697586091519874D1*(0.1007494971260294D0
     #*sigmabb*t36+0.2738174287780083D-1*t42*t43*t48)/(1.D0
     #+0.2717804421747983D0*t42*sigmabb*t36+0.7386460874872889D-1/t55
     #*t43*t48))
      t83 = dexp(-0.1645530784602056D1/t46/t34*sigmabb)
      zk(i) = -0.74442058907928D0*t3-0.3024D-2*t5*sigmabb/(1.D0
     #+0.252D-1*t8*t9)+0.81D0*rhob*(-0.310907D-1*t32
     #+0.1236778371778789D-1*t65+0.7937005259840997D0*(0.1D-2*
     #(0.2568D1+0.1443307452126544D2*t17+0.2843543831490386D-2*t25)/
     #(1.D0+0.5411317332115466D1*t17+0.1816419932959077D0*t25
     #+0.1763993811759022D-1*t16)-0.1853571428571429D-2)*sigmabb*t36
     #*t83)-0.5907233D-2*rhob*t19*t31
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t3 = t2*rhoa
      t5 = 1/t3
      t7 = dsqrt(sigmaaa)
      t8 = t7*t5
      t9 = dlog(t8+dsqrt(1+t8**2))
      t16 = 1/rhoa
      t17 = t16**(1.D0/3.D0)
      t19 = 1.D0+0.1274696188700087D0*t17
      t20 = t16**(1.D0/6.D0)
      t23 = dsqrt(t16)
      t25 = t17**2
      t31 = dlog(1.D0+0.3216395899738507D2/(0.1112037486309468D2*t20
     #+0.3844746237447211D1*t17+0.1644733775567609D1*t23
     #+0.2405871291288192D0*t25))
      t32 = t19*t31
      t34 = rhoa**2
      t36 = 1/t2/t34
      t40 = dexp(0.2513845706671277D1*t32)
      t41 = t40-1.D0
      t42 = 1/t41
      t43 = sigmaaa**2
      t45 = t34**2
      t46 = t2**2
      t48 = 1/t46/t45
      t55 = t41**2
      t65 = dlog(1.D0+0.2697586091519874D1*(0.1007494971260294D0
     #*sigmaaa*t36+0.2738174287780083D-1*t42*t43*t48)/(1.D0
     #+0.2717804421747983D0*t42*sigmaaa*t36+0.7386460874872889D-1/t55
     #*t43*t48))
      t83 = dexp(-0.1645530784602056D1/t46/t34*sigmaaa)
      zk(i) = -0.74442058907928D0*t3-0.3024D-2*t5*sigmaaa/(1.D0
     #+0.252D-1*t8*t9)+0.81D0*rhoa*(-0.310907D-1*t32
     #+0.1236778371778789D-1*t65+0.7937005259840997D0*(0.1D-2*
     #(0.2568D1+0.1443307452126544D2*t17+0.2843543831490386D-2*t25)/
     #(1.D0+0.5411317332115466D1*t17+0.1816419932959077D0*t25
     #+0.1763993811759022D-1*t16)-0.1853571428571429D-2)*sigmaaa*t36
     #*t83)-0.5907233D-2*rhoa*t19*t31
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t5 = t4*rhoa
      t7 = 1/t5
      t9 = dsqrt(sigmaaa)
      t10 = t9*t7
      t11 = dlog(t10+dsqrt(1+t10**2))
      t18 = rhob**(1.D0/3.D0)
      t19 = t18*rhob
      t21 = 1/t19
      t23 = dsqrt(sigmabb)
      t24 = t23*t21
      t25 = dlog(t24+dsqrt(1+t24**2))
      t32 = 1/rho
      t33 = t32**(1.D0/3.D0)
      t36 = t32**(1.D0/6.D0)
      t39 = dsqrt(t32)
      t41 = t33**2
      t47 = dlog(1.D0+0.1608197949869254D2/(0.598255043577108D1*t36
     #+0.2225569421150687D1*t33+0.8004286349993634D0*t39
     #+0.1897004325747559D0*t41))
      t49 = 0.621814D-1*(1.D0+0.1325688999052018D0*t33)*t47
      t60 = dlog(1.D0+0.2960874997779344D2/(0.8157414703487641D1*t36
     #+0.2247591863577616D1*t33+0.4300972471276643D0*t39
     #+0.1911512595127338D0*t41))
      t63 = rhoa-1.D0*rhob
      t64 = t63*t32
      t65 = 1.D0+t64
      t66 = t65**(1.D0/3.D0)
      t69 = 1.D0-1.D0*t64
      t70 = t69**(1.D0/3.D0)
      t72 = t66*t65+t70*t69-2.D0
      t73 = t63**2
      t74 = t73**2
      t75 = rho**2
      t76 = t75**2
      t78 = t74/t76
      t83 = 0.3799552353702395D-1*(1.D0+0.6901399211255825D-1*t33)*t60
     #*t72*(1.D0-1.D0*t78)
      t94 = dlog(1.D0+0.3216395899738507D2/(0.1112037486309468D2*t36
     #+0.3844746237447211D1*t33+0.1644733775567609D1*t39
     #+0.2405871291288192D0*t41))
      t100 = 0.1923661050931536D1*(-0.310907D-1*(1.D0
     #+0.1274696188700087D0*t33)*t94+t49)*t72*t78
      t101 = t66**2
      t103 = t70**2
      t105 = 0.5D0*t101+0.5D0*t103
      t106 = t105**2
      t107 = t106*t105
      t108 = 1/t106
      t110 = rho**(1.D0/3.D0)
      t112 = 1/t110/t75
      t115 = -t49+t83+t100
      t119 = dexp(-0.4042761511756372D2*t115/t107)
      t120 = t119-1.D0
      t121 = 1/t120
      t122 = sigma**2
      t124 = t106**2
      t126 = t110**2
      t129 = 1/t124/t126/t76
      t137 = t120**2
      t147 = dlog(1.D0+0.2697586091519874D1*(0.634682060977037D-1
     #*sigma*t108*t112+0.1086645186223595D-1*t121*t122*t129)/(1.D0
     #+0.1712109500228824D0*t121*sigma*t108*t112+0.2931318940773793D-1
     #/t137*t122*t129))
      t168 = dexp(-0.261211729852336D1*t106/t126/t75*sigma)
      zk(i) = -0.74442058907928D0*t5-0.3024D-2*t7*sigmaaa/(1.D0
     #+0.252D-1*t10*t11)-0.74442058907928D0*t19-0.3024D-2*t21*sigmabb/
     #(1.D0+0.252D-1*t24*t25)+0.81D0*rho*(-t49+t83+t100
     #+0.2473556743557577D-1*t107*t147+0.1D1*(0.1D-2*(0.2568D1
     #+0.1443307452126544D2*t33+0.2843543831490386D-2*t41)/(1.D0
     #+0.5411317332115466D1*t33+0.1816419932959077D0*t41
     #+0.1763993811759022D-1*t32)-0.1853571428571429D-2)*t105*sigma
     #*t112*t168)+0.19D0*rho*t115
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t3 = t2*rhob
      t5 = 1/t3
      t6 = t5*sigmabb
      t7 = dsqrt(sigmabb)
      t8 = t7*t5
      t9 = dlog(t8+dsqrt(1+t8**2))
      t12 = 1.D0+0.252D-1*t8*t9
      t13 = 1/t12
      t16 = 1/rhob
      t17 = t16**(1.D0/3.D0)
      t19 = 1.D0+0.1274696188700087D0*t17
      t20 = t16**(1.D0/6.D0)
      t23 = dsqrt(t16)
      t25 = t17**2
      t27 = 0.1112037486309468D2*t20+0.3844746237447211D1*t17
     #+0.1644733775567609D1*t23+0.2405871291288192D0*t25
      t30 = 1.D0+0.3216395899738507D2/t27
      t31 = dlog(t30)
      t32 = t19*t31
      t34 = rhob**2
      t36 = 1/t2/t34
      t37 = sigmabb*t36
      t40 = dexp(0.2513845706671277D1*t32)
      t41 = t40-1.D0
      t42 = 1/t41
      t43 = sigmabb**2
      t44 = t42*t43
      t45 = t34**2
      t46 = t2**2
      t48 = 1/t46/t45
      t51 = 0.1007494971260294D0*t37+0.2738174287780083D-1*t44*t48
      t52 = t42*sigmabb
      t55 = t41**2
      t56 = 1/t55
      t57 = t56*t43
      t60 = 1.D0+0.2717804421747983D0*t52*t36+0.7386460874872889D-1
     #*t57*t48
      t61 = 1/t60
      t64 = 1.D0+0.2697586091519874D1*t51*t61
      t65 = dlog(t64)
      t69 = 0.2568D1+0.1443307452126544D2*t17+0.2843543831490386D-2*t25
      t73 = 1.D0+0.5411317332115466D1*t17+0.1816419932959077D0*t25
     #+0.1763993811759022D-1*t16
      t74 = 1/t73
      t77 = 0.1D-2*t69*t74-0.1853571428571429D-2
      t78 = t77*sigmabb
      t80 = 1/t46/t34
      t81 = t80*sigmabb
      t83 = dexp(-0.1645530784602056D1*t81)
      t84 = t36*t83
      t85 = t78*t84
      t90 = rhob*t19
      zk(i) = -0.74442058907928D0*t3-0.3024D-2*t6*t13+0.81D0*rhob*(
     #-0.310907D-1*t32+0.1236778371778789D-1*t65+0.7937005259840997D0
     #*t85)-0.5907233D-2*t90*t31
      vrhoa(i) = 0.D0
      t96 = t12**2
      t97 = 1/t96
      t101 = t34*rhob
      t106 = dsqrt(1.D0+t81)
      t107 = 1/t106
      t117 = 1/t25
      t118 = 1/t34
      t119 = t117*t118
      t120 = t119*t31
      t122 = t27**2
      t123 = 1/t122
      t125 = t20**2
      t126 = t125**2
      t136 = 1/t17*t118
      t138 = -0.1853395810515781D1/t126/t20*t118-0.128158207914907D1
     #*t119-0.8223668877838045D0/t23*t118-0.1603914194192128D0*t136
      t139 = 1/t30
      t141 = t19*t123*t138*t139
      t144 = 1/t2/t101
      t149 = -0.1068129847091318D0*t120-0.8085523023512745D2*t141
      t151 = t48*t149*t40
      t154 = t45*rhob
      t156 = 1/t46/t154
      t162 = t60**2
      t164 = t51/t162
      t165 = t56*sigmabb
      t183 = 1/t64
      t191 = t73**2
      s1 = -0.99256078543904D0*t2+0.4032D-2*t37*t13+0.3024D-2*t6*t97*(
     #-0.336D-1*t7*t36*t9-0.336D-1*sigmabb/t46/t101*t107)-0.310907D-1
     #*t32
      s2 = s1+0.1001790481140819D-1*t65+0.6428974260471208D0*t85
      vrhob(i) = s2+0.81D0*rhob*(0.1321039893133927D-2*t120+0.1D1*t141
     #+0.1236778371778789D-1*(0.2697586091519874D1*(
     #-0.2350821599607352D0*sigmabb*t144-0.2738174287780083D-1*t57
     #*t151-0.1277814667630705D0*t44*t156)*t61-0.2697586091519874D1
     #*t164*(-0.2717804421747983D0*t165*t36*t149*t40
     #-0.6341543650745294D0*t52*t144-0.1477292174974578D0/t55/t41*t43
     #*t151-0.3447015074940681D0*t57*t156))*t183+0.7937005259840997D0*
     #(0.1D-2*(-0.4811024840421814D1*t119-0.1895695887660258D-2*t136)
     #*t74-0.1D-2*t69/t191*(-0.1803772444038489D1*t119
     #-0.1210946621972718D0*t136-0.1763993811759022D-1*t118))*sigmabb
     #*t84-0.1851967893962899D1*t78*t144*t83+0.3482823064697813D1*t77
     #*t43/t45/t34*t83)+0.2509975796954461D-3*t16*t117*t31+0.19D0*t90
     #*t123*t138*t139
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      vsigmabb(i) = -0.3024D-2*t5*t13+0.3024D-2*t6*t97*(0.126D-1/t7*t5
     #*t9+0.126D-1*t80*t107)+0.81D0*rhob*(0.1236778371778789D-1*
     #(0.2697586091519874D1*(0.1007494971260294D0*t36
     #+0.5476348575560166D-1*t52*t48)*t61-0.2697586091519874D1*t164*
     #(0.2717804421747983D0*t42*t36+0.1477292174974578D0*t165*t48))
     #*t183+0.7937005259840997D0*t77*t36*t83-0.130605864926168D1*t78
     #/t154*t83)
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t3 = t2*rhoa
      t5 = 1/t3
      t6 = t5*sigmaaa
      t7 = dsqrt(sigmaaa)
      t8 = t7*t5
      t9 = dlog(t8+dsqrt(1+t8**2))
      t12 = 1.D0+0.252D-1*t8*t9
      t13 = 1/t12
      t16 = 1/rhoa
      t17 = t16**(1.D0/3.D0)
      t19 = 1.D0+0.1274696188700087D0*t17
      t20 = t16**(1.D0/6.D0)
      t23 = dsqrt(t16)
      t25 = t17**2
      t27 = 0.1112037486309468D2*t20+0.3844746237447211D1*t17
     #+0.1644733775567609D1*t23+0.2405871291288192D0*t25
      t30 = 1.D0+0.3216395899738507D2/t27
      t31 = dlog(t30)
      t32 = t19*t31
      t34 = rhoa**2
      t36 = 1/t2/t34
      t37 = sigmaaa*t36
      t40 = dexp(0.2513845706671277D1*t32)
      t41 = t40-1.D0
      t42 = 1/t41
      t43 = sigmaaa**2
      t44 = t42*t43
      t45 = t34**2
      t46 = t2**2
      t48 = 1/t46/t45
      t51 = 0.1007494971260294D0*t37+0.2738174287780083D-1*t44*t48
      t52 = t42*sigmaaa
      t55 = t41**2
      t56 = 1/t55
      t57 = t56*t43
      t60 = 1.D0+0.2717804421747983D0*t52*t36+0.7386460874872889D-1
     #*t57*t48
      t61 = 1/t60
      t64 = 1.D0+0.2697586091519874D1*t51*t61
      t65 = dlog(t64)
      t69 = 0.2568D1+0.1443307452126544D2*t17+0.2843543831490386D-2*t25
      t73 = 1.D0+0.5411317332115466D1*t17+0.1816419932959077D0*t25
     #+0.1763993811759022D-1*t16
      t74 = 1/t73
      t77 = 0.1D-2*t69*t74-0.1853571428571429D-2
      t78 = t77*sigmaaa
      t80 = 1/t46/t34
      t81 = t80*sigmaaa
      t83 = dexp(-0.1645530784602056D1*t81)
      t84 = t36*t83
      t85 = t78*t84
      t90 = rhoa*t19
      zk(i) = -0.74442058907928D0*t3-0.3024D-2*t6*t13+0.81D0*rhoa*(
     #-0.310907D-1*t32+0.1236778371778789D-1*t65+0.7937005259840997D0
     #*t85)-0.5907233D-2*t90*t31
      t96 = t12**2
      t97 = 1/t96
      t101 = t34*rhoa
      t106 = dsqrt(1.D0+t81)
      t107 = 1/t106
      t117 = 1/t25
      t118 = 1/t34
      t119 = t117*t118
      t120 = t119*t31
      t122 = t27**2
      t123 = 1/t122
      t125 = t20**2
      t126 = t125**2
      t136 = 1/t17*t118
      t138 = -0.1853395810515781D1/t126/t20*t118-0.128158207914907D1
     #*t119-0.8223668877838045D0/t23*t118-0.1603914194192128D0*t136
      t139 = 1/t30
      t141 = t19*t123*t138*t139
      t144 = 1/t2/t101
      t149 = -0.1068129847091318D0*t120-0.8085523023512745D2*t141
      t151 = t48*t149*t40
      t154 = t45*rhoa
      t156 = 1/t46/t154
      t162 = t60**2
      t164 = t51/t162
      t165 = t56*sigmaaa
      t183 = 1/t64
      t191 = t73**2
      s1 = -0.99256078543904D0*t2+0.4032D-2*t37*t13+0.3024D-2*t6*t97*(
     #-0.336D-1*t7*t36*t9-0.336D-1*sigmaaa/t46/t101*t107)-0.310907D-1
     #*t32
      s2 = s1+0.1001790481140819D-1*t65+0.6428974260471208D0*t85
      vrhoa(i) = s2+0.81D0*rhoa*(0.1321039893133927D-2*t120+0.1D1*t141
     #+0.1236778371778789D-1*(0.2697586091519874D1*(
     #-0.2350821599607352D0*sigmaaa*t144-0.2738174287780083D-1*t57
     #*t151-0.1277814667630705D0*t44*t156)*t61-0.2697586091519874D1
     #*t164*(-0.2717804421747983D0*t165*t36*t149*t40
     #-0.6341543650745294D0*t52*t144-0.1477292174974578D0/t55/t41*t43
     #*t151-0.3447015074940681D0*t57*t156))*t183+0.7937005259840997D0*
     #(0.1D-2*(-0.4811024840421814D1*t119-0.1895695887660258D-2*t136)
     #*t74-0.1D-2*t69/t191*(-0.1803772444038489D1*t119
     #-0.1210946621972718D0*t136-0.1763993811759022D-1*t118))*sigmaaa
     #*t84-0.1851967893962899D1*t78*t144*t83+0.3482823064697813D1*t77
     #*t43/t45/t34*t83)+0.2509975796954461D-3*t16*t117*t31+0.19D0*t90
     #*t123*t138*t139
      vrhob(i) = 0.D0
      vsigmaaa(i) = -0.3024D-2*t5*t13+0.3024D-2*t6*t97*(0.126D-1/t7*t5
     #*t9+0.126D-1*t80*t107)+0.81D0*rhoa*(0.1236778371778789D-1*
     #(0.2697586091519874D1*(0.1007494971260294D0*t36
     #+0.5476348575560166D-1*t52*t48)*t61-0.2697586091519874D1*t164*
     #(0.2717804421747983D0*t42*t36+0.1477292174974578D0*t165*t48))
     #*t183+0.7937005259840997D0*t77*t36*t83-0.130605864926168D1*t78
     #/t154*t83)
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t5 = t4*rhoa
      t7 = 1/t5
      t8 = t7*sigmaaa
      t9 = dsqrt(sigmaaa)
      t10 = t9*t7
      t11 = dlog(t10+dsqrt(1+t10**2))
      t14 = 1.D0+0.252D-1*t10*t11
      t15 = 1/t14
      t18 = rhob**(1.D0/3.D0)
      t19 = t18*rhob
      t21 = 1/t19
      t22 = t21*sigmabb
      t23 = dsqrt(sigmabb)
      t24 = t23*t21
      t25 = dlog(t24+dsqrt(1+t24**2))
      t28 = 1.D0+0.252D-1*t24*t25
      t29 = 1/t28
      t32 = 1/rho
      t33 = t32**(1.D0/3.D0)
      t35 = 1.D0+0.1325688999052018D0*t33
      t36 = t32**(1.D0/6.D0)
      t39 = dsqrt(t32)
      t41 = t33**2
      t43 = 0.598255043577108D1*t36+0.2225569421150687D1*t33
     #+0.8004286349993634D0*t39+0.1897004325747559D0*t41
      t46 = 1.D0+0.1608197949869254D2/t43
      t47 = dlog(t46)
      t48 = t35*t47
      t49 = 0.621814D-1*t48
      t51 = 1.D0+0.6901399211255825D-1*t33
      t56 = 0.8157414703487641D1*t36+0.2247591863577616D1*t33
     #+0.4300972471276643D0*t39+0.1911512595127338D0*t41
      t59 = 1.D0+0.2960874997779344D2/t56
      t60 = dlog(t59)
      t61 = t51*t60
      t63 = rhoa-1.D0*rhob
      t64 = t63*t32
      t65 = 1.D0+t64
      t66 = t65**(1.D0/3.D0)
      t69 = 1.D0-1.D0*t64
      t70 = t69**(1.D0/3.D0)
      t72 = t66*t65+t70*t69-2.D0
      t73 = t63**2
      t74 = t73**2
      t75 = rho**2
      t76 = t75**2
      t77 = 1/t76
      t78 = t74*t77
      t80 = 1.D0-1.D0*t78
      t83 = 0.3799552353702395D-1*t61*t72*t80
      t85 = 1.D0+0.1274696188700087D0*t33
      t90 = 0.1112037486309468D2*t36+0.3844746237447211D1*t33
     #+0.1644733775567609D1*t39+0.2405871291288192D0*t41
      t93 = 1.D0+0.3216395899738507D2/t90
      t94 = dlog(t93)
      t97 = -0.310907D-1*t85*t94+t49
      t98 = t97*t72
      t100 = 0.1923661050931536D1*t98*t78
      t101 = t66**2
      t103 = t70**2
      t105 = 0.5D0*t101+0.5D0*t103
      t106 = t105**2
      t107 = t106*t105
      t108 = 1/t106
      t109 = sigma*t108
      t110 = rho**(1.D0/3.D0)
      t112 = 1/t110/t75
      t115 = -t49+t83+t100
      t116 = 1/t107
      t119 = dexp(-0.4042761511756372D2*t115*t116)
      t120 = t119-1.D0
      t121 = 1/t120
      t122 = sigma**2
      t123 = t121*t122
      t124 = t106**2
      t125 = 1/t124
      t126 = t110**2
      t128 = 1/t126/t76
      t129 = t125*t128
      t132 = 0.634682060977037D-1*t109*t112+0.1086645186223595D-1*t123
     #*t129
      t133 = t121*sigma
      t134 = t108*t112
      t137 = t120**2
      t138 = 1/t137
      t139 = t138*t122
      t142 = 1.D0+0.1712109500228824D0*t133*t134+0.2931318940773793D-1
     #*t139*t129
      t143 = 1/t142
      t146 = 1.D0+0.2697586091519874D1*t132*t143
      t147 = dlog(t146)
      t148 = t107*t147
      t152 = 0.2568D1+0.1443307452126544D2*t33+0.2843543831490386D-2*t41
      t156 = 1.D0+0.5411317332115466D1*t33+0.1816419932959077D0*t41
     #+0.1763993811759022D-1*t32
      t157 = 1/t156
      t160 = 0.1D-2*t152*t157-0.1853571428571429D-2
      t161 = t160*t105
      t164 = 1/t126/t75
      t168 = dexp(-0.261211729852336D1*t106*t164*sigma)
      t169 = sigma*t112*t168
      t170 = t161*t169
      zk(i) = -0.74442058907928D0*t5-0.3024D-2*t8*t15
     #-0.74442058907928D0*t19-0.3024D-2*t22*t29+0.81D0*rho*(-t49+t83
     #+t100+0.2473556743557577D-1*t148+0.1D1*t170)+0.19D0*rho*t115
      t178 = rhoa**2
      t180 = 1/t4/t178
      t184 = t14**2
      t185 = 1/t184
      t190 = t4**2
      t195 = 1/t190/t178
      t198 = dsqrt(1.D0+t195*sigmaaa)
      t199 = 1/t198
      t210 = 0.1333333333333333D1*t66*t32-0.1333333333333333D1*t70*t32
      t213 = 0.3799552353702395D-1*t61*t210*t80
      t214 = t73*t63
      t217 = t61*t72*t214*t77
      t218 = 0.1519820941480958D0*t217
      t221 = 0.1923661050931536D1*t97*t210*t78
      t223 = t98*t214*t77
      t224 = 0.7694644203726145D1*t223
      t225 = t106*t147
      t226 = 1/t66
      t229 = 1/t70
      t232 = 0.3333333333333333D0*t226*t32-0.3333333333333333D0*t229*t32
      t235 = sigma*t116
      t239 = t139*t125
      t240 = t213-t218+t221+t224
      t243 = t115*t125
      t246 = -0.4042761511756372D2*t240*t116+0.1212828453526912D3*t243
     #*t232
      t248 = t128*t246*t119
      t253 = 1/t124/t105*t128
      t254 = t253*t232
      t260 = t142**2
      t262 = t132/t260
      t263 = t138*sigma
      t264 = t263*t108
      t269 = t116*t112
      t276 = 1/t137/t120*t122*t125
      t286 = 1/t146
      t293 = t160*t106*t122
      t294 = t76*rho
      t295 = 1/t294
      t305 = 0.621814D-1*t48
      t306 = 0.2003580962281637D-1*t148
      t307 = 0.81D0*t170
      t309 = 1/t75
      t310 = 1/t41*t309
      t311 = t310*t47
      t312 = 0.2747773264188438D-2*t311
      t313 = t43**2
      t316 = t36**2
      t317 = t316**2
      t320 = 1/t317/t36*t309
      t324 = 1/t39*t309
      t327 = 1/t33*t309
      t332 = t35/t313*(-0.99709173929518D0*t320-0.7418564737168958D0
     #*t310-0.4002143174996817D0*t324-0.1264669550498372D0*t327)/t46
      t333 = 0.1D1*t332
      t337 = 0.8740742538988973D-3*t310*t60*t72*t80
      t338 = t56**2
      t351 = 0.1124999956683108D1*t51/t338*(-0.135956911724794D1*t320
     #-0.7491972878592054D0*t310-0.2150486235638321D0*t324
     #-0.1274341730084892D0*t327)/t59*t72*t80
      t358 = -0.1333333333333333D1*t66*t63*t309+0.1333333333333333D1
     #*t70*t63*t309
      t361 = 0.3799552353702395D-1*t61*t358*t80
      t365 = 0.1519820941480958D0*t61*t72*t74*t295
      t368 = t90**2
      t385 = 0.1923661050931536D1*(0.1321039893133927D-2*t310*t94
     #+0.1D1*t85/t368*(-0.1853395810515781D1*t320-0.128158207914907D1
     #*t310-0.8223668877838045D0*t324-0.1603914194192128D0*t327)/t93
     #-0.2747773264188438D-2*t311-0.1D1*t332)*t72*t78
      t388 = 0.1923661050931536D1*t97*t358*t78
      t391 = 0.7694644203726145D1*t98*t74*t295
      t398 = -0.3333333333333333D0*t226*t63*t309+0.3333333333333333D0
     #*t229*t63*t309
      t404 = t75*rho
      t406 = 1/t110/t404
      t409 = t312+t333-t337-t351+t361+t365+t385+t388-t391
      t414 = -0.4042761511756372D2*t409*t116+0.1212828453526912D3*t243
     #*t398
      t416 = t128*t414*t119
      t419 = t253*t398
      t424 = t125/t126/t294
      t458 = t156**2
      s1 = t312+t333-t337-t351+t361+t365+t385
      s2 = s1+t388-t391+0.7420670230672731D-1*t225*t398
      s3 = s2+0.2473556743557577D-1*t107*(0.2697586091519874D1*(
     #-0.1269364121954074D0*t235*t112*t398-0.148092480894642D0*t109
     #*t406-0.1086645186223595D-1*t239*t416-0.4346580744894379D-1*t123
     #*t419-0.5071010869043442D-1*t123*t424)*t143-0.2697586091519874D1
     #*t262*(-0.1712109500228824D0*t264*t112*t414*t119
     #-0.3424219000457648D0*t133*t269*t398-0.3994922167200589D0*t133
     #*t108*t406-0.5862637881547585D-1*t276*t416-0.1172527576309517D0
     #*t139*t419-0.136794883902777D0*t139*t424))*t286+0.1D1*(0.1D-2*(
     #-0.4811024840421814D1*t310-0.1895695887660258D-2*t327)*t157
     #-0.1D-2*t152/t458*(-0.1803772444038489D1*t310
     #-0.1210946621972718D0*t327-0.1763993811759022D-1*t309))*t105*t169
      t493 = s3+0.1D1*t160*t398*t169-0.2333333333333333D1*t161*sigma
     #*t406*t168+0.1D1*t161*sigma*t112*(-0.522423459704672D1*t105*t164
     #*sigma*t398+0.6965646129395627D1*t106/t126/t404*sigma)*t168
      t495 = 0.81D0*rho*t493
      t497 = 0.19D0*rho*t409
      vrhoa(i) = -0.99256078543904D0*t4+0.4032D-2*t180*sigmaaa*t15
     #+0.3024D-2*t8*t185*(-0.336D-1*t9*t180*t11-0.336D-1*sigmaaa/t190
     #/t178/rhoa*t199)+0.81D0*rho*(t213-t218+t221+t224
     #+0.7420670230672731D-1*t225*t232+0.2473556743557577D-1*t107*
     #(0.2697586091519874D1*(-0.1269364121954074D0*t235*t112*t232
     #-0.1086645186223595D-1*t239*t248-0.4346580744894379D-1*t123*t254
     #)*t143-0.2697586091519874D1*t262*(-0.1712109500228824D0*t264
     #*t112*t246*t119-0.3424219000457648D0*t133*t269*t232
     #-0.5862637881547585D-1*t276*t248-0.1172527576309517D0*t139*t254)
     #)*t286+0.1D1*t160*t232*t169-0.522423459704672D1*t293*t295*t232
     #*t168)+0.19D0*rho*t240-t305+t83+t100+t306+t307+t495+t497
      t499 = rhob**2
      t501 = 1/t18/t499
      t505 = t28**2
      t506 = 1/t505
      t511 = t18**2
      t516 = 1/t511/t499
      t519 = dsqrt(1.D0+t516*sigmabb)
      t520 = 1/t519
      t527 = -t210
      t530 = 0.3799552353702395D-1*t61*t527*t80
      t531 = 0.1519820941480958D0*t217
      t534 = 0.1923661050931536D1*t97*t527*t78
      t535 = 0.7694644203726145D1*t223
      t536 = -t232
      t542 = t530+t531+t534-t535
      t547 = -0.4042761511756372D2*t542*t116+0.1212828453526912D3*t243
     #*t536
      t549 = t128*t547*t119
      t552 = t253*t536
      vrhob(i) = -0.99256078543904D0*t18+0.4032D-2*t501*sigmabb*t29
     #+0.3024D-2*t22*t506*(-0.336D-1*t23*t501*t25-0.336D-1*sigmabb
     #/t511/t499/rhob*t520)+0.81D0*rho*(t530+t531+t534-t535
     #+0.7420670230672731D-1*t225*t536+0.2473556743557577D-1*t107*
     #(0.2697586091519874D1*(-0.1269364121954074D0*t235*t112*t536
     #-0.1086645186223595D-1*t239*t549-0.4346580744894379D-1*t123*t552
     #)*t143-0.2697586091519874D1*t262*(-0.1712109500228824D0*t264
     #*t112*t547*t119-0.3424219000457648D0*t133*t269*t536
     #-0.5862637881547585D-1*t276*t549-0.1172527576309517D0*t139*t552)
     #)*t286+0.1D1*t160*t536*t169-0.522423459704672D1*t293*t295*t536
     #*t168)+0.19D0*rho*t542-t305+t83+t100+t306+t307+t495+t497
      t627 = rho*(0.2473556743557577D-1*t107*(0.2697586091519874D1*
     #(0.634682060977037D-1*t134+0.2173290372447189D-1*t133*t129)*t143
     #-0.2697586091519874D1*t262*(0.1712109500228824D0*t121*t108*t112
     #+0.5862637881547585D-1*t263*t129))*t286+0.1D1*t161*t112*t168
     #-0.261211729852336D1*t160*t107*sigma*t295*t168)
      t628 = 0.81D0*t627
      vsigmaaa(i) = -0.3024D-2*t7*t15+0.3024D-2*t8*t185*(0.126D-1/t9
     #*t7*t11+0.126D-1*t195*t199)+t628
      vsigmaab(i) = 0.162D1*t627
      vsigmabb(i) = -0.3024D-2*t21*t29+0.3024D-2*t22*t506*(0.126D-1
     #/t23*t21*t25+0.126D-1*t516*t520)+t628
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t3 = t2*rhob
      t5 = 1/t3
      t6 = t5*sigmabb
      t7 = dsqrt(sigmabb)
      t8 = t7*t5
      t9 = dlog(t8+dsqrt(1+t8**2))
      t12 = 1.D0+0.252D-1*t8*t9
      t13 = 1/t12
      t16 = 1/rhob
      t17 = t16**(1.D0/3.D0)
      t19 = 1.D0+0.1274696188700087D0*t17
      t20 = t16**(1.D0/6.D0)
      t23 = dsqrt(t16)
      t25 = t17**2
      t27 = 0.1112037486309468D2*t20+0.3844746237447211D1*t17
     #+0.1644733775567609D1*t23+0.2405871291288192D0*t25
      t30 = 1.D0+0.3216395899738507D2/t27
      t31 = dlog(t30)
      t32 = t19*t31
      t34 = rhob**2
      t36 = 1/t2/t34
      t37 = sigmabb*t36
      t40 = dexp(0.2513845706671277D1*t32)
      t41 = t40-1.D0
      t42 = 1/t41
      t43 = sigmabb**2
      t44 = t42*t43
      t45 = t34**2
      t46 = t2**2
      t48 = 1/t46/t45
      t51 = 0.1007494971260294D0*t37+0.2738174287780083D-1*t44*t48
      t52 = t42*sigmabb
      t55 = t41**2
      t56 = 1/t55
      t57 = t56*t43
      t60 = 1.D0+0.2717804421747983D0*t52*t36+0.7386460874872889D-1
     #*t57*t48
      t61 = 1/t60
      t64 = 1.D0+0.2697586091519874D1*t51*t61
      t65 = dlog(t64)
      t69 = 0.2568D1+0.1443307452126544D2*t17+0.2843543831490386D-2*t25
      t73 = 1.D0+0.5411317332115466D1*t17+0.1816419932959077D0*t25
     #+0.1763993811759022D-1*t16
      t74 = 1/t73
      t77 = 0.1D-2*t69*t74-0.1853571428571429D-2
      t78 = t77*sigmabb
      t80 = 1/t46/t34
      t81 = t80*sigmabb
      t83 = dexp(-0.1645530784602056D1*t81)
      t84 = t36*t83
      t85 = t78*t84
      t90 = rhob*t19
      zk(i) = -0.74442058907928D0*t3-0.3024D-2*t6*t13+0.81D0*rhob*(
     #-0.310907D-1*t32+0.1236778371778789D-1*t65+0.7937005259840997D0
     #*t85)-0.5907233D-2*t90*t31
      vrhoa(i) = 0.D0
      t96 = t12**2
      t97 = 1/t96
      t101 = t34*rhob
      t105 = 1.D0+t81
      t106 = dsqrt(t105)
      t107 = 1/t106
      t110 = -0.336D-1*t7*t36*t9-0.336D-1*sigmabb/t46/t101*t107
      t111 = t97*t110
      t117 = 1/t25
      t118 = 1/t34
      t119 = t117*t118
      t120 = t119*t31
      t122 = t27**2
      t123 = 1/t122
      t124 = t19*t123
      t125 = t20**2
      t126 = t125**2
      t127 = t126*t20
      t128 = 1/t127
      t132 = 1/t23
      t135 = 1/t17
      t136 = t135*t118
      t138 = -0.1853395810515781D1*t128*t118-0.128158207914907D1*t119
     #-0.8223668877838045D0*t132*t118-0.1603914194192128D0*t136
      t139 = 1/t30
      t141 = t124*t138*t139
      t144 = 1/t2/t101
      t145 = sigmabb*t144
      t149 = -0.1068129847091318D0*t120-0.8085523023512745D2*t141
      t151 = t48*t149*t40
      t154 = t45*rhob
      t156 = 1/t46/t154
      t159 = -0.2350821599607352D0*t145-0.2738174287780083D-1*t57*t151
     #-0.1277814667630705D0*t44*t156
      t162 = t60**2
      t163 = 1/t162
      t164 = t51*t163
      t165 = t56*sigmabb
      t173 = 1/t55/t41
      t174 = t173*t43
      t179 = -0.2717804421747983D0*t165*t36*t149*t40
     #-0.6341543650745294D0*t52*t144-0.1477292174974578D0*t174*t151
     #-0.3447015074940681D0*t57*t156
      t182 = 0.2697586091519874D1*t159*t61-0.2697586091519874D1*t164
     #*t179
      t183 = 1/t64
      t184 = t182*t183
      t188 = -0.4811024840421814D1*t119-0.1895695887660258D-2*t136
      t191 = t73**2
      t192 = 1/t191
      t193 = t69*t192
      t197 = -0.1803772444038489D1*t119-0.1210946621972718D0*t136
     #-0.1763993811759022D-1*t118
      t200 = 0.1D-2*t188*t74-0.1D-2*t193*t197
      t201 = t200*sigmabb
      t202 = t201*t84
      t204 = t144*t83
      t205 = t78*t204
      t207 = t77*t43
      t208 = t45*t34
      t210 = 1/t208*t83
      t211 = t207*t210
      t216 = t16*t117
      t220 = t123*t138*t139
      vrhob(i) = -0.99256078543904D0*t2+0.4032D-2*t37*t13+0.3024D-2*t6
     #*t111-0.310907D-1*t32+0.1001790481140819D-1*t65
     #+0.6428974260471208D0*t85+0.81D0*rhob*(0.1321039893133927D-2
     #*t120+0.1D1*t141+0.1236778371778789D-1*t184+0.7937005259840997D0
     #*t202-0.1851967893962899D1*t205+0.3482823064697813D1*t211)
     #+0.2509975796954461D-3*t216*t31+0.19D0*t90*t220
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      t231 = 0.126D-1/t7*t5*t9+0.126D-1*t80*t107
      t238 = 0.1007494971260294D0*t36+0.5476348575560166D-1*t52*t48
      t245 = 0.2717804421747983D0*t42*t36+0.1477292174974578D0*t165*t48
      t248 = 0.2697586091519874D1*t238*t61-0.2697586091519874D1*t164
     #*t245
      t254 = 1/t154
      vsigmabb(i) = -0.3024D-2*t5*t13+0.3024D-2*t6*t97*t231+0.81D0
     #*rhob*(0.1236778371778789D-1*t248*t183+0.7937005259840997D0*t77
     #*t36*t83-0.130605864926168D1*t78*t254*t83)
      v2rhoa2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t273 = t45*t101
      t278 = 1/t106/t105
      t289 = t182**2
      t290 = t64**2
      t291 = 1/t290
      t295 = 1/t25/t16
      t296 = 1/t45
      t297 = t295*t296
      t299 = 1/t101
      t300 = t117*t299
      t304 = 1/t17/t16*t296
      t306 = t135*t299
      t317 = t197**2
      t333 = 1/t2/t45
      t336 = t149**2
      t337 = t48*t336
      t339 = dexp(0.5027691413342554D1*t32)
      t340 = t337*t339
      t344 = t156*t149*t40
      t347 = t297*t31
      t349 = t300*t31
      t351 = t119*t220
      t354 = 1/t122/t27
      t356 = t138**2
      t358 = t19*t354*t356*t139
      t376 = -0.1544496508763151D1/t127/t16*t296+0.3706791621031562D1
     #*t128*t299-0.854388052766047D0*t297+0.2563164158298141D1*t300
     #-0.4111834438919023D0/t23/t16*t296+0.1644733775567609D1*t132
     #*t299-0.5346380647307093D-1*t304+0.3207828388384256D0*t306
      t378 = t124*t376*t139
      t380 = t122**2
      t381 = 1/t380
      t383 = t30**2
      t384 = 1/t383
      t386 = t19*t381*t356*t384
      t388 = -0.7120865647275453D-1*t347+0.2136259694182636D0*t349
     #+0.6871056921145667D1*t351+0.1617104604702549D3*t358
     #-0.8085523023512745D2*t378-0.2600624310006769D4*t386
      t390 = t48*t388*t40
      t393 = t337*t40
      t397 = 1/t46/t208
      t408 = t51/t162/t60
      t409 = t179**2
      t413 = t36*t336
      t430 = t55**2
      t469 = t45**2
      s3 = -0.1236778371778789D-1*t289*t291
      s5 = 0.7937005259840997D0*(0.1D-2*(-0.3207349893614542D1*t297
     #+0.9622049680843627D1*t300-0.6318986292200858D-3*t304
     #+0.3791391775320515D-2*t306)*t74-0.2D-2*t188*t192*t197+0.2D-2
     #*t69/t191/t73*t317-0.1D-2*t193*(-0.1202514962692326D1*t297
     #+0.3607544888076978D1*t300-0.4036488739909061D-1*t304
     #+0.2421893243945437D0*t306+0.3527987623518044D-1*t299))*sigmabb
     #*t84
      s6 = 0.1236778371778789D-1*(0.2697586091519874D1*
     #(0.7836071998691172D0*sigmabb*t333+0.5476348575560166D-1*t174
     #*t340+0.2555629335261411D0*t57*t344-0.2738174287780083D-1*t57
     #*t390-0.2738174287780083D-1*t57*t393+0.7240949783240664D0*t44
     #*t397)*t61-0.5395172183039748D1*t159*t163*t179
     #+0.5395172183039748D1*t408*t409-0.2697586091519874D1*t164*
     #(0.5435608843495966D0*t173*sigmabb*t413*t339
     #+0.1268308730149059D1*t165*t144*t149*t40-0.2717804421747983D0
     #*t165*t36*t388*t40-0.2717804421747983D0*t165*t413*t40
     #+0.2113847883581765D1*t52*t333+0.4431876524923733D0/t430*t43
     #*t340+0.1378806029976273D1*t174*t344-0.1477292174974578D0*t174
     #*t390-0.1477292174974578D0*t174*t393+0.1953308542466386D1*t57
     #*t397))*t183
      s4 = s5+s6
      s2 = s3+s4
      s1 = s2+0.3216395899738507D2*t386+0.8806932620892844D-3*t347
     #-0.8497974591333914D-1*t351-0.2D1*t358
      t476 = s1+0.1D1*t378-0.2642079786267853D-2*t349
     #-0.3703935787925799D1*t201*t204+0.6965646129395627D1*t200*t43
     #*t210+0.6173226313209665D1*t78*t333*t83-0.2902352553914844D2
     #*t207/t273*t83+0.1528291352075288D2*t77*t43*sigmabb/t46/t469
     #/rhob*t83
      t480 = 1/t96/t12
      t481 = t110**2
      v2rhob2(i) = -0.3308535951463467D0/t46-0.9408D-2*t145*t13
     #-0.8064D-2*t37*t111+0.3024D-2*t6*t97*(0.784D-1*t7*t144*t9
     #+0.168D0*sigmabb*t48*t107-0.448D-1*t43/t2/t273*t278)
     #+0.2003580962281637D-1*t184+0.1285794852094242D1*t202
     #-0.3000187988219897D1*t205+0.5642173364810458D1*t211+0.81D0*rhob
     #*t476-0.6048D-2*t6*t480*t481+0.2D1*t141+0.2140084626876961D-2
     #*t120+0.167331719796964D-3*t299*t295*t31-0.1614615172353444D-1
     #*t216*t220-0.38D0*t90*t354*t356*t139+0.19D0*t90*t123*t376*t139
     #+0.6111152209503163D1*t90*t381*t356*t384
      v2sigmaaa2(i) = 0.D0
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      t507 = t231**2
      t534 = t245**2
      t543 = t248**2
      v2sigmabb2(i) = 0.6048D-2*t5*t97*t231-0.6048D-2*t6*t480*t507
     #+0.3024D-2*t6*t97*(-0.63D-2/t7/sigmabb*t5*t9+0.63D-2/sigmabb*t80
     #*t107-0.63D-2/t2/t154*t278)+0.81D0*rhob*(0.1236778371778789D-1*
     #(0.1477292174974578D0*t42*t48*t61-0.5395172183039748D1*t238*t163
     #*t245+0.5395172183039748D1*t408*t534-0.3985122824322565D0*t164
     #*t56*t48)*t183-0.1236778371778789D-1*t543*t291
     #-0.261211729852336D1*t77*t254*t83+0.2149159713855873D1*t78/t46
     #/t273*t83)
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t3 = t2*rhoa
      t5 = 1/t3
      t6 = t5*sigmaaa
      t7 = dsqrt(sigmaaa)
      t8 = t7*t5
      t9 = dlog(t8+dsqrt(1+t8**2))
      t12 = 1.D0+0.252D-1*t8*t9
      t13 = 1/t12
      t16 = 1/rhoa
      t17 = t16**(1.D0/3.D0)
      t19 = 1.D0+0.1274696188700087D0*t17
      t20 = t16**(1.D0/6.D0)
      t23 = dsqrt(t16)
      t25 = t17**2
      t27 = 0.1112037486309468D2*t20+0.3844746237447211D1*t17
     #+0.1644733775567609D1*t23+0.2405871291288192D0*t25
      t30 = 1.D0+0.3216395899738507D2/t27
      t31 = dlog(t30)
      t32 = t19*t31
      t34 = rhoa**2
      t36 = 1/t2/t34
      t37 = sigmaaa*t36
      t40 = dexp(0.2513845706671277D1*t32)
      t41 = t40-1.D0
      t42 = 1/t41
      t43 = sigmaaa**2
      t44 = t42*t43
      t45 = t34**2
      t46 = t2**2
      t48 = 1/t46/t45
      t51 = 0.1007494971260294D0*t37+0.2738174287780083D-1*t44*t48
      t52 = t42*sigmaaa
      t55 = t41**2
      t56 = 1/t55
      t57 = t56*t43
      t60 = 1.D0+0.2717804421747983D0*t52*t36+0.7386460874872889D-1
     #*t57*t48
      t61 = 1/t60
      t64 = 1.D0+0.2697586091519874D1*t51*t61
      t65 = dlog(t64)
      t69 = 0.2568D1+0.1443307452126544D2*t17+0.2843543831490386D-2*t25
      t73 = 1.D0+0.5411317332115466D1*t17+0.1816419932959077D0*t25
     #+0.1763993811759022D-1*t16
      t74 = 1/t73
      t77 = 0.1D-2*t69*t74-0.1853571428571429D-2
      t78 = t77*sigmaaa
      t80 = 1/t46/t34
      t81 = t80*sigmaaa
      t83 = dexp(-0.1645530784602056D1*t81)
      t84 = t36*t83
      t85 = t78*t84
      t90 = rhoa*t19
      zk(i) = -0.74442058907928D0*t3-0.3024D-2*t6*t13+0.81D0*rhoa*(
     #-0.310907D-1*t32+0.1236778371778789D-1*t65+0.7937005259840997D0
     #*t85)-0.5907233D-2*t90*t31
      t96 = t12**2
      t97 = 1/t96
      t101 = t34*rhoa
      t105 = 1.D0+t81
      t106 = dsqrt(t105)
      t107 = 1/t106
      t110 = -0.336D-1*t7*t36*t9-0.336D-1*sigmaaa/t46/t101*t107
      t111 = t97*t110
      t117 = 1/t25
      t118 = 1/t34
      t119 = t117*t118
      t120 = t119*t31
      t122 = t27**2
      t123 = 1/t122
      t124 = t19*t123
      t125 = t20**2
      t126 = t125**2
      t127 = t126*t20
      t128 = 1/t127
      t132 = 1/t23
      t135 = 1/t17
      t136 = t135*t118
      t138 = -0.1853395810515781D1*t128*t118-0.128158207914907D1*t119
     #-0.8223668877838045D0*t132*t118-0.1603914194192128D0*t136
      t139 = 1/t30
      t141 = t124*t138*t139
      t144 = 1/t2/t101
      t145 = sigmaaa*t144
      t149 = -0.1068129847091318D0*t120-0.8085523023512745D2*t141
      t151 = t48*t149*t40
      t154 = t45*rhoa
      t156 = 1/t46/t154
      t159 = -0.2350821599607352D0*t145-0.2738174287780083D-1*t57*t151
     #-0.1277814667630705D0*t44*t156
      t162 = t60**2
      t163 = 1/t162
      t164 = t51*t163
      t165 = t56*sigmaaa
      t173 = 1/t55/t41
      t174 = t173*t43
      t179 = -0.2717804421747983D0*t165*t36*t149*t40
     #-0.6341543650745294D0*t52*t144-0.1477292174974578D0*t174*t151
     #-0.3447015074940681D0*t57*t156
      t182 = 0.2697586091519874D1*t159*t61-0.2697586091519874D1*t164
     #*t179
      t183 = 1/t64
      t184 = t182*t183
      t188 = -0.4811024840421814D1*t119-0.1895695887660258D-2*t136
      t191 = t73**2
      t192 = 1/t191
      t193 = t69*t192
      t197 = -0.1803772444038489D1*t119-0.1210946621972718D0*t136
     #-0.1763993811759022D-1*t118
      t200 = 0.1D-2*t188*t74-0.1D-2*t193*t197
      t201 = t200*sigmaaa
      t202 = t201*t84
      t204 = t144*t83
      t205 = t78*t204
      t207 = t77*t43
      t208 = t45*t34
      t210 = 1/t208*t83
      t211 = t207*t210
      t216 = t16*t117
      t220 = t123*t138*t139
      vrhoa(i) = -0.99256078543904D0*t2+0.4032D-2*t37*t13+0.3024D-2*t6
     #*t111-0.310907D-1*t32+0.1001790481140819D-1*t65
     #+0.6428974260471208D0*t85+0.81D0*rhoa*(0.1321039893133927D-2
     #*t120+0.1D1*t141+0.1236778371778789D-1*t184+0.7937005259840997D0
     #*t202-0.1851967893962899D1*t205+0.3482823064697813D1*t211)
     #+0.2509975796954461D-3*t216*t31+0.19D0*t90*t220
      vrhob(i) = 0.D0
      t231 = 0.126D-1/t7*t5*t9+0.126D-1*t80*t107
      t238 = 0.1007494971260294D0*t36+0.5476348575560166D-1*t52*t48
      t245 = 0.2717804421747983D0*t42*t36+0.1477292174974578D0*t165*t48
      t248 = 0.2697586091519874D1*t238*t61-0.2697586091519874D1*t164
     #*t245
      t254 = 1/t154
      vsigmaaa(i) = -0.3024D-2*t5*t13+0.3024D-2*t6*t97*t231+0.81D0
     #*rhoa*(0.1236778371778789D-1*t248*t183+0.7937005259840997D0*t77
     #*t36*t83-0.130605864926168D1*t78*t254*t83)
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      t262 = 1/t122/t27
      t263 = t138**2
      t270 = 1/t101
      t272 = 1/t25/t16
      t278 = 1/t45
      t283 = t272*t278
      t285 = t117*t270
      t295 = 1/t17/t16*t278
      t297 = t135*t270
      t299 = -0.1544496508763151D1/t127/t16*t278+0.3706791621031562D1
     #*t128*t270-0.854388052766047D0*t283+0.2563164158298141D1*t285
     #-0.4111834438919023D0/t23/t16*t278+0.1644733775567609D1*t132
     #*t270-0.5346380647307093D-1*t295+0.3207828388384256D0*t297
      t304 = t122**2
      t305 = 1/t304
      t307 = t30**2
      t308 = 1/t307
      t328 = t45*t101
      t333 = 1/t106/t105
      t342 = t182**2
      t343 = t64**2
      t344 = 1/t343
      t360 = t197**2
      t385 = 1/t2/t45
      t391 = t45**2
      t400 = t149**2
      t401 = t48*t400
      t403 = dexp(0.5027691413342554D1*t32)
      t404 = t401*t403
      t408 = t156*t149*t40
      t411 = t283*t31
      t413 = t285*t31
      t415 = t119*t220
      t419 = t19*t262*t263*t139
      t422 = t124*t299*t139
      t426 = t19*t305*t263*t308
      t428 = -0.7120865647275453D-1*t411+0.2136259694182636D0*t413
     #+0.6871056921145667D1*t415+0.1617104604702549D3*t419
     #-0.8085523023512745D2*t422-0.2600624310006769D4*t426
      t430 = t48*t428*t40
      t433 = t401*t40
      t437 = 1/t46/t208
      t448 = t51/t162/t60
      t449 = t179**2
      t453 = t36*t400
      t470 = t55**2
      s1 = -0.1236778371778789D-1*t342*t344+0.7937005259840997D0*
     #(0.1D-2*(-0.3207349893614542D1*t283+0.9622049680843627D1*t285
     #-0.6318986292200858D-3*t295+0.3791391775320515D-2*t297)*t74
     #-0.2D-2*t188*t192*t197+0.2D-2*t69/t191/t73*t360-0.1D-2*t193*(
     #-0.1202514962692326D1*t283+0.3607544888076978D1*t285
     #-0.4036488739909061D-1*t295+0.2421893243945437D0*t297
     #+0.3527987623518044D-1*t270))*sigmaaa*t84-0.3703935787925799D1
     #*t201*t204+0.6965646129395627D1*t200*t43*t210
     #-0.2902352553914844D2*t207/t328*t83+0.6173226313209665D1*t78
     #*t385*t83+0.1528291352075288D2*t77*t43*sigmaaa/t46/t391/rhoa*t83
      s2 = s1+0.1236778371778789D-1*(0.2697586091519874D1*
     #(0.7836071998691172D0*sigmaaa*t385+0.5476348575560166D-1*t174
     #*t404+0.2555629335261411D0*t57*t408-0.2738174287780083D-1*t57
     #*t430-0.2738174287780083D-1*t57*t433+0.7240949783240664D0*t44
     #*t437)*t61-0.5395172183039748D1*t159*t163*t179
     #+0.5395172183039748D1*t448*t449-0.2697586091519874D1*t164*
     #(0.5435608843495966D0*t173*sigmaaa*t453*t403
     #+0.1268308730149059D1*t165*t144*t149*t40-0.2717804421747983D0
     #*t165*t36*t428*t40-0.2717804421747983D0*t165*t453*t40
     #+0.2113847883581765D1*t52*t385+0.4431876524923733D0/t470*t43
     #*t404+0.1378806029976273D1*t174*t408-0.1477292174974578D0*t174
     #*t430-0.1477292174974578D0*t174*t433+0.1953308542466386D1*t57
     #*t437))*t183+0.1D1*t422-0.2642079786267853D-2*t413
      t495 = s2+0.8806932620892844D-3*t411-0.8497974591333914D-1*t415
     #-0.2D1*t419+0.3216395899738507D2*t426
      t499 = 1/t96/t12
      t500 = t110**2
      v2rhoa2(i) = -0.38D0*t90*t262*t263*t139-0.1614615172353444D-1
     #*t216*t220+0.167331719796964D-3*t270*t272*t31+0.19D0*t90*t123
     #*t299*t139+0.6111152209503163D1*t90*t305*t263*t308
     #+0.2003580962281637D-1*t184+0.1285794852094242D1*t202+0.2D1*t141
     #+0.2140084626876961D-2*t120-0.3308535951463467D0/t46-0.9408D-2
     #*t145*t13-0.8064D-2*t37*t111+0.3024D-2*t6*t97*(0.784D-1*t7*t144
     #*t9+0.168D0*sigmaaa*t48*t107-0.448D-1*t43/t2/t328*t333)
     #-0.3000187988219897D1*t205+0.5642173364810458D1*t211+0.81D0*rhoa
     #*t495-0.6048D-2*t6*t499*t500
      v2rhob2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t507 = t231**2
      t534 = t245**2
      t543 = t248**2
      v2sigmaaa2(i) = 0.6048D-2*t5*t97*t231-0.6048D-2*t6*t499*t507
     #+0.3024D-2*t6*t97*(-0.63D-2/t7/sigmaaa*t5*t9+0.63D-2/sigmaaa*t80
     #*t107-0.63D-2/t2/t154*t333)+0.81D0*rhoa*(0.1236778371778789D-1*
     #(0.1477292174974578D0*t42*t48*t61-0.5395172183039748D1*t238*t163
     #*t245+0.5395172183039748D1*t448*t534-0.3985122824322565D0*t164
     #*t56*t48)*t183-0.1236778371778789D-1*t543*t344
     #-0.261211729852336D1*t77*t254*t83+0.2149159713855873D1*t78/t46
     #/t328*t83)
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      v2sigmabb2(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t5 = t4*rhoa
      t7 = 1/t5
      t8 = t7*sigmaaa
      t9 = dsqrt(sigmaaa)
      t10 = t9*t7
      t11 = dlog(t10+dsqrt(1+t10**2))
      t14 = 1.D0+0.252D-1*t10*t11
      t15 = 1/t14
      t18 = rhob**(1.D0/3.D0)
      t19 = t18*rhob
      t21 = 1/t19
      t22 = t21*sigmabb
      t23 = dsqrt(sigmabb)
      t24 = t23*t21
      t25 = dlog(t24+dsqrt(1+t24**2))
      t28 = 1.D0+0.252D-1*t24*t25
      t29 = 1/t28
      t32 = 1/rho
      t33 = t32**(1.D0/3.D0)
      t35 = 1.D0+0.1325688999052018D0*t33
      t36 = t32**(1.D0/6.D0)
      t39 = dsqrt(t32)
      t41 = t33**2
      t43 = 0.598255043577108D1*t36+0.2225569421150687D1*t33
     #+0.8004286349993634D0*t39+0.1897004325747559D0*t41
      t46 = 1.D0+0.1608197949869254D2/t43
      t47 = dlog(t46)
      t48 = t35*t47
      t49 = 0.621814D-1*t48
      t51 = 1.D0+0.6901399211255825D-1*t33
      t56 = 0.8157414703487641D1*t36+0.2247591863577616D1*t33
     #+0.4300972471276643D0*t39+0.1911512595127338D0*t41
      t59 = 1.D0+0.2960874997779344D2/t56
      t60 = dlog(t59)
      t61 = t51*t60
      t63 = rhoa-1.D0*rhob
      t64 = t63*t32
      t65 = 1.D0+t64
      t66 = t65**(1.D0/3.D0)
      t67 = t66*t65
      t69 = 1.D0-1.D0*t64
      t70 = t69**(1.D0/3.D0)
      t71 = t70*t69
      t72 = t67+t71-2.D0
      t73 = t63**2
      t74 = t73**2
      t75 = rho**2
      t76 = t75**2
      t77 = 1/t76
      t78 = t74*t77
      t80 = 1.D0-1.D0*t78
      t81 = t72*t80
      t83 = 0.3799552353702395D-1*t61*t81
      t85 = 1.D0+0.1274696188700087D0*t33
      t90 = 0.1112037486309468D2*t36+0.3844746237447211D1*t33
     #+0.1644733775567609D1*t39+0.2405871291288192D0*t41
      t93 = 1.D0+0.3216395899738507D2/t90
      t94 = dlog(t93)
      t97 = -0.310907D-1*t85*t94+t49
      t98 = t97*t72
      t100 = 0.1923661050931536D1*t98*t78
      t101 = t66**2
      t103 = t70**2
      t105 = 0.5D0*t101+0.5D0*t103
      t106 = t105**2
      t107 = t106*t105
      t108 = 1/t106
      t109 = sigma*t108
      t110 = rho**(1.D0/3.D0)
      t112 = 1/t110/t75
      t115 = -t49+t83+t100
      t116 = 1/t107
      t117 = t115*t116
      t119 = dexp(-0.4042761511756372D2*t117)
      t120 = t119-1.D0
      t121 = 1/t120
      t122 = sigma**2
      t123 = t121*t122
      t124 = t106**2
      t125 = 1/t124
      t126 = t110**2
      t128 = 1/t126/t76
      t129 = t125*t128
      t132 = 0.634682060977037D-1*t109*t112+0.1086645186223595D-1*t123
     #*t129
      t133 = t121*sigma
      t134 = t108*t112
      t137 = t120**2
      t138 = 1/t137
      t139 = t138*t122
      t142 = 1.D0+0.1712109500228824D0*t133*t134+0.2931318940773793D-1
     #*t139*t129
      t143 = 1/t142
      t146 = 1.D0+0.2697586091519874D1*t132*t143
      t147 = dlog(t146)
      t148 = t107*t147
      t152 = 0.2568D1+0.1443307452126544D2*t33+0.2843543831490386D-2*t41
      t156 = 1.D0+0.5411317332115466D1*t33+0.1816419932959077D0*t41
     #+0.1763993811759022D-1*t32
      t157 = 1/t156
      t160 = 0.1D-2*t152*t157-0.1853571428571429D-2
      t161 = t160*t105
      t164 = 1/t126/t75
      t168 = dexp(-0.261211729852336D1*t106*t164*sigma)
      t169 = sigma*t112*t168
      t170 = t161*t169
      zk(i) = -0.74442058907928D0*t5-0.3024D-2*t8*t15
     #-0.74442058907928D0*t19-0.3024D-2*t22*t29+0.81D0*rho*(-t49+t83
     #+t100+0.2473556743557577D-1*t148+0.1D1*t170)+0.19D0*rho*t115
      t178 = rhoa**2
      t180 = 1/t4/t178
      t181 = t180*sigmaaa
      t184 = t14**2
      t185 = 1/t184
      t189 = t178*rhoa
      t190 = t4**2
      t192 = 1/t190/t189
      t195 = 1/t190/t178
      t197 = 1.D0+t195*sigmaaa
      t198 = dsqrt(t197)
      t199 = 1/t198
      t202 = -0.336D-1*t9*t180*t11-0.336D-1*sigmaaa*t192*t199
      t203 = t185*t202
      t210 = 0.1333333333333333D1*t66*t32-0.1333333333333333D1*t70*t32
      t212 = t61*t210*t80
      t213 = 0.3799552353702395D-1*t212
      t214 = t73*t63
      t215 = t72*t214
      t217 = t61*t215*t77
      t218 = 0.1519820941480958D0*t217
      t219 = t97*t210
      t220 = t219*t78
      t221 = 0.1923661050931536D1*t220
      t222 = t214*t77
      t223 = t98*t222
      t224 = 0.7694644203726145D1*t223
      t225 = t106*t147
      t226 = 1/t66
      t229 = 1/t70
      t232 = 0.3333333333333333D0*t226*t32-0.3333333333333333D0*t229*t32
      t233 = t225*t232
      t235 = sigma*t116
      t236 = t112*t232
      t239 = t139*t125
      t240 = t213-t218+t221+t224
      t243 = t115*t125
      t246 = -0.4042761511756372D2*t240*t116+0.1212828453526912D3*t243
     #*t232
      t247 = t128*t246
      t248 = t247*t119
      t251 = t124*t105
      t252 = 1/t251
      t253 = t252*t128
      t254 = t253*t232
      t257 = -0.1269364121954074D0*t235*t236-0.1086645186223595D-1
     #*t239*t248-0.4346580744894379D-1*t123*t254
      t260 = t142**2
      t261 = 1/t260
      t262 = t132*t261
      t263 = t138*sigma
      t264 = t263*t108
      t265 = t112*t246
      t266 = t265*t119
      t269 = t116*t112
      t270 = t269*t232
      t274 = 1/t137/t120
      t275 = t274*t122
      t276 = t275*t125
      t281 = -0.1712109500228824D0*t264*t266-0.3424219000457648D0*t133
     #*t270-0.5862637881547585D-1*t276*t248-0.1172527576309517D0*t139
     #*t254
      t284 = 0.2697586091519874D1*t257*t143-0.2697586091519874D1*t262
     #*t281
      t285 = t107*t284
      t286 = 1/t146
      t287 = t285*t286
      t289 = t160*t232
      t290 = t289*t169
      t293 = t160*t106*t122
      t294 = t76*rho
      t295 = 1/t294
      t297 = t295*t232*t168
      t298 = t293*t297
      t305 = 0.621814D-1*t48
      t306 = 0.2003580962281637D-1*t148
      t307 = 0.81D0*t170
      t308 = 1/t41
      t309 = 1/t75
      t310 = t308*t309
      t311 = t310*t47
      t312 = 0.2747773264188438D-2*t311
      t313 = t43**2
      t314 = 1/t313
      t315 = t35*t314
      t316 = t36**2
      t317 = t316**2
      t318 = t317*t36
      t319 = 1/t318
      t320 = t319*t309
      t323 = 1/t39
      t324 = t323*t309
      t326 = 1/t33
      t327 = t326*t309
      t329 = -0.99709173929518D0*t320-0.7418564737168958D0*t310
     #-0.4002143174996817D0*t324-0.1264669550498372D0*t327
      t330 = 1/t46
      t332 = t315*t329*t330
      t333 = 0.1D1*t332
      t334 = t60*t72
      t335 = t334*t80
      t336 = t310*t335
      t337 = 0.8740742538988973D-3*t336
      t338 = t56**2
      t339 = 1/t338
      t340 = t51*t339
      t345 = -0.135956911724794D1*t320-0.7491972878592054D0*t310
     #-0.2150486235638321D0*t324-0.1274341730084892D0*t327
      t346 = t340*t345
      t347 = 1/t59
      t348 = t347*t72
      t349 = t348*t80
      t350 = t346*t349
      t351 = 0.1124999956683108D1*t350
      t352 = t66*t63
      t355 = t70*t63
      t358 = -0.1333333333333333D1*t352*t309+0.1333333333333333D1*t355
     #*t309
      t360 = t61*t358*t80
      t361 = 0.3799552353702395D-1*t360
      t362 = t72*t74
      t364 = t61*t362*t295
      t365 = 0.1519820941480958D0*t364
      t368 = t90**2
      t369 = 1/t368
      t370 = t85*t369
      t375 = -0.1853395810515781D1*t320-0.128158207914907D1*t310
     #-0.8223668877838045D0*t324-0.1603914194192128D0*t327
      t376 = 1/t93
      t382 = 0.1321039893133927D-2*t310*t94+0.1D1*t370*t375*t376
     #-0.2747773264188438D-2*t311-0.1D1*t332
      t383 = t382*t72
      t384 = t383*t78
      t385 = 0.1923661050931536D1*t384
      t386 = t97*t358
      t387 = t386*t78
      t388 = 0.1923661050931536D1*t387
      t389 = t74*t295
      t390 = t98*t389
      t391 = 0.7694644203726145D1*t390
      t392 = t226*t63
      t395 = t229*t63
      t398 = -0.3333333333333333D0*t392*t309+0.3333333333333333D0*t395
     #*t309
      t399 = t225*t398
      t401 = t112*t398
      t404 = t75*rho
      t406 = 1/t110/t404
      t409 = t312+t333-t337-t351+t361+t365+t385+t388-t391
      t414 = -0.4042761511756372D2*t409*t116+0.1212828453526912D3*t243
     #*t398
      t415 = t128*t414
      t416 = t415*t119
      t419 = t253*t398
      t423 = 1/t126/t294
      t424 = t125*t423
      t427 = -0.1269364121954074D0*t235*t401-0.148092480894642D0*t109
     #*t406-0.1086645186223595D-1*t239*t416-0.4346580744894379D-1*t123
     #*t419-0.5071010869043442D-1*t123*t424
      t430 = t112*t414
      t431 = t430*t119
      t434 = t269*t398
      t437 = t108*t406
      t446 = -0.1712109500228824D0*t264*t431-0.3424219000457648D0*t133
     #*t434-0.3994922167200589D0*t133*t437-0.5862637881547585D-1*t276
     #*t416-0.1172527576309517D0*t139*t419-0.136794883902777D0*t139*t424
      t449 = 0.2697586091519874D1*t427*t143-0.2697586091519874D1*t262
     #*t446
      t450 = t107*t449
      t451 = t450*t286
      t455 = -0.4811024840421814D1*t310-0.1895695887660258D-2*t327
      t458 = t156**2
      t459 = 1/t458
      t460 = t152*t459
      t464 = -0.1803772444038489D1*t310-0.1210946621972718D0*t327
     #-0.1763993811759022D-1*t309
      t467 = 0.1D-2*t455*t157-0.1D-2*t460*t464
      t468 = t467*t105
      t469 = t468*t169
      t471 = t160*t398
      t472 = t471*t169
      t475 = sigma*t406*t168
      t476 = t161*t475
      t478 = t161*sigma
      t479 = t105*t164
      t480 = sigma*t398
      t484 = 1/t126/t404
      t485 = t106*t484
      t488 = -0.522423459704672D1*t479*t480+0.6965646129395627D1*t485
     #*sigma
      t490 = t112*t488*t168
      t491 = t478*t490
      t493 = t312+t333-t337-t351+t361+t365+t385+t388-t391
     #+0.7420670230672731D-1*t399+0.2473556743557577D-1*t451+0.1D1
     #*t469+0.1D1*t472-0.2333333333333333D1*t476+0.1D1*t491
      t495 = 0.81D0*rho*t493
      t497 = 0.19D0*rho*t409
      vrhoa(i) = -0.99256078543904D0*t4+0.4032D-2*t181*t15+0.3024D-2
     #*t8*t203+0.81D0*rho*(t213-t218+t221+t224+0.7420670230672731D-1
     #*t233+0.2473556743557577D-1*t287+0.1D1*t290-0.522423459704672D1
     #*t298)+0.19D0*rho*t240-t305+t83+t100+t306+t307+t495+t497
      t499 = rhob**2
      t501 = 1/t18/t499
      t502 = t501*sigmabb
      t505 = t28**2
      t506 = 1/t505
      t510 = t499*rhob
      t511 = t18**2
      t513 = 1/t511/t510
      t516 = 1/t511/t499
      t518 = 1.D0+t516*sigmabb
      t519 = dsqrt(t518)
      t520 = 1/t519
      t523 = -0.336D-1*t23*t501*t25-0.336D-1*sigmabb*t513*t520
      t524 = t506*t523
      t527 = -t210
      t529 = t61*t527*t80
      t530 = 0.3799552353702395D-1*t529
      t531 = 0.1519820941480958D0*t217
      t532 = t97*t527
      t533 = t532*t78
      t534 = 0.1923661050931536D1*t533
      t535 = 0.7694644203726145D1*t223
      t536 = -t232
      t537 = t225*t536
      t539 = t112*t536
      t542 = t530+t531+t534-t535
      t547 = -0.4042761511756372D2*t542*t116+0.1212828453526912D3*t243
     #*t536
      t548 = t128*t547
      t549 = t548*t119
      t552 = t253*t536
      t555 = -0.1269364121954074D0*t235*t539-0.1086645186223595D-1
     #*t239*t549-0.4346580744894379D-1*t123*t552
      t558 = t112*t547
      t559 = t558*t119
      t562 = t269*t536
      t569 = -0.1712109500228824D0*t264*t559-0.3424219000457648D0*t133
     #*t562-0.5862637881547585D-1*t276*t549-0.1172527576309517D0*t139
     #*t552
      t572 = 0.2697586091519874D1*t555*t143-0.2697586091519874D1*t262
     #*t569
      t573 = t107*t572
      t574 = t573*t286
      t576 = t160*t536
      t577 = t576*t169
      t580 = t295*t536*t168
      t581 = t293*t580
      vrhob(i) = -0.99256078543904D0*t18+0.4032D-2*t502*t29+0.3024D-2
     #*t22*t524+0.81D0*rho*(t530+t531+t534-t535+0.7420670230672731D-1
     #*t537+0.2473556743557577D-1*t574+0.1D1*t577-0.522423459704672D1
     #*t581)+0.19D0*rho*t542-t305+t83+t100+t306+t307+t495+t497
      t590 = 1/t9
      t596 = 0.126D-1*t590*t7*t11+0.126D-1*t195*t199
      t597 = t185*t596
      t603 = 0.634682060977037D-1*t134+0.2173290372447189D-1*t133*t129
      t606 = t121*t108
      t611 = 0.1712109500228824D0*t606*t112+0.5862637881547585D-1*t263
     #*t129
      t614 = 0.2697586091519874D1*t603*t143-0.2697586091519874D1*t262
     #*t611
      t616 = t107*t614*t286
      t618 = t112*t168
      t619 = t161*t618
      t621 = t160*t107
      t623 = sigma*t295*t168
      t624 = t621*t623
      t627 = rho*(0.2473556743557577D-1*t616+0.1D1*t619
     #-0.261211729852336D1*t624)
      t628 = 0.81D0*t627
      vsigmaaa(i) = -0.3024D-2*t7*t15+0.3024D-2*t8*t597+t628
      vsigmaab(i) = 0.162D1*t627
      t631 = 1/t23
      t637 = 0.126D-1*t631*t21*t25+0.126D-1*t516*t520
      t638 = t506*t637
      vsigmabb(i) = -0.3024D-2*t21*t29+0.3024D-2*t22*t638+t628
      t643 = 0.2D1*t332
      t644 = 0.7599104707404789D-1*t360
      t645 = 0.3847322101863073D1*t384
      t646 = 0.1748148507797795D-2*t336
      t647 = 0.2249999913366216D1*t350
      t648 = 0.3039641882961916D0*t364
      t649 = 0.5495546528376876D-2*t311
      t650 = 0.3847322101863073D1*t387
      t651 = 0.1538928840745229D2*t390
      t652 = 0.1202148577368982D0*t399
      t656 = 0.4007161924563275D-1*t451
      t658 = 1/t184/t14
      t659 = t202**2
      t664 = -0.3039641882961916D0*t217+0.1202148577368982D0*t233+t643
     #+t644+t645-t646-t647+t648+t649+t650-t651+t652
     #+0.7599104707404789D-1*t212+0.3847322101863073D1*t220
     #+0.1538928840745229D2*t223+t656-0.6048D-2*t8*t658*t659+0.162D1
     #*t290
      t669 = 1/t4/t189
      t673 = t178**2
      t679 = sigmaaa**2
      t685 = 1/t198/t197
      t696 = t106*t449
      t697 = t286*t232
      t699 = 0.7420670230672731D-1*t696*t697
      t700 = sigma*t125
      t701 = t401*t232
      t703 = 0.3808092365862222D0*t700*t701
      t706 = 0.296184961789284D0*t235*t406*t232
      t707 = 1/t67
      t709 = 1/t404
      t714 = 1/t71
      t720 = 0.1111111111111111D0*t707*t63*t709-0.3333333333333333D0
     #*t226*t309+0.1111111111111111D0*t714*t63*t709
     #+0.3333333333333333D0*t229*t309
      t723 = 0.1269364121954074D0*t235*t112*t720
      t725 = dexp(-0.8085523023512745D2*t117)
      t726 = t725*t246
      t727 = t415*t726
      t729 = 0.2173290372447189D-1*t276*t727
      t730 = t139*t252
      t731 = t128*t398
      t732 = t246*t119
      t733 = t731*t732
      t735 = 0.4346580744894379D-1*t730*t733
      t737 = t423*t246*t119
      t739 = 0.5071010869043442D-1*t239*t737
      t743 = 0.8740742538988973D-3*t310*t60*t210*t80
      t747 = 0.1124999956683108D1*t346*t347*t210*t80
      t748 = 1/t101
      t754 = 1/t103
      t760 = -0.4444444444444444D0*t748*t63*t709-0.1333333333333333D1
     #*t66*t309-0.4444444444444444D0*t754*t63*t709
     #+0.1333333333333333D1*t70*t309
      t763 = 0.3799552353702395D-1*t61*t760*t80
      t767 = 0.1519820941480958D0*t61*t210*t74*t295
      t768 = t76*t75
      t769 = 1/t768
      t772 = t308*t769*t334*t214
      t773 = 0.3496297015595589D-2*t772
      t775 = t346*t348*t222
      t776 = 0.4499999826732431D1*t775
      t779 = t61*t358*t214*t77
      t780 = 0.1519820941480958D0*t779
      t782 = t61*t215*t295
      t783 = 0.6079283765923831D0*t782
      t786 = 0.1923661050931536D1*t382*t210*t78
      t789 = 0.1923661050931536D1*t97*t760*t78
      t791 = 0.7694644203726145D1*t219*t389
      t792 = t383*t222
      t793 = 0.7694644203726145D1*t792
      t794 = t386*t222
      t795 = 0.7694644203726145D1*t794
      t797 = t98*t214*t295
      t798 = 0.3077857681490458D2*t797
      t799 = -t743-t747+t763+t767+t773+t776-t780+t783+t786+t789-t791
     #+t793+t795-t798
      t802 = t240*t125
      t804 = 0.1212828453526912D3*t802*t398
      t805 = t409*t125
      t807 = 0.1212828453526912D3*t805*t232
      t808 = t115*t252
      t809 = t398*t232
      t811 = 0.4851313814107647D3*t808*t809
      t813 = 0.1212828453526912D3*t243*t720
      t814 = -0.4042761511756372D2*t799*t116+t804+t807-t811+t813
      t816 = t128*t814*t119
      t819 = t415*t732
      t821 = 0.1086645186223595D-1*t239*t819
      t822 = t119*t232
      t823 = t415*t822
      t825 = 0.4346580744894379D-1*t730*t823
      t827 = 1/t124/t106
      t828 = t123*t827
      t829 = t731*t232
      t831 = 0.2173290372447189D0*t828*t829
      t832 = t252*t423
      t833 = t832*t232
      t835 = 0.2028404347617377D0*t123*t833
      t836 = t253*t720
      t838 = 0.4346580744894379D-1*t123*t836
      t839 = t703+t706-t723+t729+t735+t739-0.1086645186223595D-1*t239
     #*t816-t821+t825+t831+t835-t838
      t842 = t257*t261
      t844 = 0.2697586091519874D1*t842*t446
      t845 = t427*t261
      t847 = 0.2697586091519874D1*t845*t281
      t850 = t132/t260/t142
      t853 = 0.5395172183039748D1*t850*t446*t281
      t854 = t274*sigma
      t855 = t854*t108
      t858 = 0.3424219000457648D0*t855*t430*t726
      t859 = t263*t116
      t862 = 0.3424219000457648D0*t859*t401*t732
      t866 = 0.3994922167200589D0*t264*t406*t246*t119
      t873 = 0.1712109500228824D0*t264*t430*t732
      t876 = 0.3424219000457648D0*t859*t430*t822
      t877 = t133*t125
      t879 = 0.1027265700137294D1*t877*t701
      t880 = t116*t406
      t883 = 0.7989844334401178D0*t133*t880*t232
      t886 = 0.3424219000457648D0*t133*t269*t720
      t887 = t137**2
      t890 = 1/t887*t122*t125
      t892 = 0.1758791364464276D0*t890*t727
      t893 = t275*t252
      t895 = 0.2345055152619034D0*t893*t733
      t897 = 0.273589767805554D0*t276*t737
      t901 = 0.5862637881547585D-1*t276*t819
      t903 = 0.2345055152619034D0*t893*t823
      t904 = t139*t827
      t906 = 0.5862637881547585D0*t904*t829
      t908 = 0.547179535611108D0*t139*t833
      t910 = 0.1172527576309517D0*t139*t836
      t911 = t858+t862+t866-0.1712109500228824D0*t264*t112*t814*t119
     #-t873+t876+t879+t883-t886+t892+t895+t897-0.5862637881547585D-1
     #*t276*t816-t901+t903+t906+t908-t910
      t918 = t146**2
      t919 = 1/t918
      t922 = 0.2473556743557577D-1*t450*t919*t284
      t927 = t289*sigma
      t929 = 0.1D1*t927*t490
      t931 = 0.2333333333333333D1*t289*t475
      t934 = 0.1D1*t160*t720*t169
      t937 = t293*t769*t232*t168
      t939 = t699+0.2473556743557577D-1*t107*(0.2697586091519874D1
     #*t839*t143-t844-t847+t853-0.2697586091519874D1*t262*t911)*t286
     #-t922-0.522423459704672D1*t293*t295*t720*t168+t773+t929-t931
     #+t934+0.261211729852336D2*t937+t763+t786+t793+t789+t795
      t940 = t471*t122
      t941 = t295*t105
      t942 = t232*t168
      t944 = t940*t941*t942
      t947 = t467*t106*t122
      t949 = 0.522423459704672D1*t947*t297
      t952 = 0.1D1*t467*t232*t169
      t953 = t295*t488
      t956 = 0.522423459704672D1*t293*t953*t942
      t957 = t106*t284
      t958 = t286*t398
      t960 = 0.7420670230672731D-1*t957*t958
      t962 = 0.7420670230672731D-1*t225*t720
      t963 = t105*t147
      t965 = 0.1484134046134546D0*t963*t809
      t966 = -t791-t798-0.1044846919409344D2*t944-t747-t949-t743+t952
     #+t783+t767-t780-t956+t776+t960+t962+t965
      t968 = rho*(t939+t966)
      t972 = 0.162D1*t469
      t973 = 0.162D1*t472
      t974 = 0.378D1*t476
      t975 = 0.162D1*t491
      t980 = 0.4444444444444444D0*t748*t309+0.4444444444444444D0*t754
     #*t309
      t983 = 0.3799552353702395D-1*t61*t980*t80
      t986 = t61*t210*t214*t77
      t987 = 0.3039641882961916D0*t986
      t990 = t61*t72*t73*t77
      t991 = 0.4559462824442873D0*t990
      t994 = 0.1923661050931536D1*t97*t980*t78
      t995 = t219*t222
      t996 = 0.1538928840745229D2*t995
      t998 = t98*t73*t77
      t999 = 0.2308393261117844D2*t998
      t1000 = t232**2
      t1009 = -0.1111111111111111D0*t707*t309-0.1111111111111111D0
     #*t714*t309
      t1011 = 0.7420670230672731D-1*t225*t1009
      t1017 = 0.1269364121954074D0*t235*t112*t1009
      t1018 = t246**2
      t1019 = t128*t1018
      t1020 = t1019*t725
      t1023 = t247*t822
      t1026 = t983-t987-t991+t994+t996+t999
      t1034 = 0.1212828453526912D3*t243*t1009
      t1035 = -0.4042761511756372D2*t1026*t116+0.2425656907053823D3
     #*t802*t232-0.4851313814107647D3*t808*t1000+t1034
      t1037 = t128*t1035*t119
      t1040 = t1019*t119
      t1043 = t827*t128
      t1044 = t1043*t1000
      t1047 = t253*t1009
      t1049 = 0.4346580744894379D-1*t123*t1047
      t1055 = t281**2
      t1058 = t112*t1018
      t1072 = t125*t112
      t1078 = 0.3424219000457648D0*t133*t269*t1009
      t1090 = 0.1172527576309517D0*t139*t1047
      t1091 = 0.3424219000457648D0*t855*t1058*t725
     #+0.6848438000915295D0*t859*t265*t822-0.1712109500228824D0*t264
     #*t112*t1035*t119-0.1712109500228824D0*t264*t1058*t119
     #+0.1027265700137294D1*t133*t1072*t1000-t1078
     #+0.1758791364464276D0*t890*t1020+0.4690110305238068D0*t893*t1023
     #-0.5862637881547585D-1*t276*t1037-0.5862637881547585D-1*t276
     #*t1040+0.5862637881547585D0*t139*t1044-t1090
      t1098 = t284**2
      t1104 = 0.1D1*t160*t1009*t169
      t1107 = t941*t168
      t1113 = 0.522423459704672D1*t293*t295*t1009*t168
      t1115 = t621*t122*sigma
      t1116 = t76*t404
      t1118 = 1/t126/t1116
      t1123 = t983-t987-t991+t994+t996+t999+0.1484134046134546D0*t963
     #*t1000+0.1484134046134546D0*t957*t697+t1011
     #+0.2473556743557577D-1*t107*(0.2697586091519874D1*
     #(0.3808092365862222D0*t700*t112*t1000-t1017
     #+0.2173290372447189D-1*t276*t1020+0.8693161489788758D-1*t730
     #*t1023-0.1086645186223595D-1*t239*t1037-0.1086645186223595D-1
     #*t239*t1040+0.2173290372447189D0*t123*t1044-t1049)*t143
     #-0.5395172183039748D1*t842*t281+0.5395172183039748D1*t850*t1055
     #-0.2697586091519874D1*t262*t1091)*t286-0.2473556743557577D-1
     #*t107*t1098*t919+t1104-0.1567270379114016D2*t160*t1000*t122
     #*t1107-t1113+0.272926271249799D2*t1115*t1118*t1000*t168
      t1128 = 0.3496297015595589D-2*t772
      t1129 = -t743+t1128-t747+t776+t763-t780+t767+t783+t786+t793+t789
     #+t795-t791-t798
      t1132 = -0.4042761511756372D2*t1129*t116+t807+t804-t811+t813
      t1134 = t128*t1132*t119
      t1137 = t703-t723+t706+t729+t825-0.1086645186223595D-1*t239
     #*t1134-t821+t735+t831-t838+t739+t835
      t1146 = t858+t876-0.1712109500228824D0*t264*t112*t1132*t119-t873
     #+t862+t879-t886+t866+t883+t892+t903-0.5862637881547585D-1*t276
     #*t1134-t901+t895+t906-t910+t897+t908
      t1154 = t699-t922+t1128+0.2473556743557577D-1*t107*
     #(0.2697586091519874D1*t1137*t143-t847-t844+t853
     #-0.2697586091519874D1*t262*t1146)*t286+t929-t931+t934
     #+0.1218988072644235D2*t937+t763+t786+t793+t789+t795-t791
      t1162 = t105*t484
      t1171 = -t798-0.522423459704672D1*t944-t747-t949-t743+t952+0.1D1
     #*t478*t112*(-0.522423459704672D1*t232*t164*t480
     #-0.522423459704672D1*t479*sigma*t720+0.1393129225879125D2*t1162
     #*sigma*t232)*t168+t783+t767-t780-t956+t776+t960+t962+t965
      t1173 = rho*(t1154+t1171)
      t1175 = rho*t1129
      t1177 = rho*t799
      t1179 = t398**2
      t1182 = t471*sigma
      t1185 = t449**2
      t1189 = t313**2
      t1192 = t329**2
      t1193 = t46**2
      t1196 = t35/t1189*t1192/t1193
      t1197 = 0.1608197949869254D2*t1196
      t1200 = 1/t318/t32*t77
      t1202 = t319*t709
      t1206 = 1/t41/t32*t77
      t1208 = t308*t709
      t1212 = 1/t39/t32*t77
      t1214 = t323*t709
      t1218 = 1/t33/t32*t77
      t1220 = t326*t709
      t1224 = t315*(-0.8309097827459833D0*t1200+0.199418347859036D1
     #*t1202-0.4945709824779306D0*t1206+0.1483712947433792D1*t1208
     #-0.2001071587498409D0*t1212+0.8004286349993634D0*t1214
     #-0.4215565168327908D-1*t1218+0.2529339100996745D0*t1220)*t330
      t1225 = 0.1D1*t1224
      t1230 = t35/t313/t43*t1192*t330
      t1231 = 0.2D1*t1230
      t1244 = -0.1111111111111111D0*t707*t73*t77+0.6666666666666667D0
     #*t392*t709-0.1111111111111111D0*t714*t73*t77
     #-0.6666666666666667D0*t395*t709
      t1266 = t464**2
      t1281 = t488**2
      t1297 = 0.6992594031191179D-2*t308/t1116*t334*t74
      t1299 = 0.5827161692659315D-3*t1206*t335
      t1303 = 0.1748148507797795D-2*t310*t60*t358*t80
      t1305 = 1/t110/t76
      t1329 = t345**2
      t1332 = 0.2249999913366216D1*t51/t338/t56*t1329*t349
      s1 = 0.1484134046134546D0*t963*t1179+0.2D1*t1182*t490
     #-0.2473556743557577D-1*t107*t1185*t919+t1197+t1225-t1231
     #+0.1484134046134546D0*t696*t958+0.1D1*t160*t1244*t169
     #-0.4666666666666667D1*t468*t475+0.2D1*t468*sigma*t490
      s2 = s1+0.1D1*(0.1D-2*(-0.3207349893614542D1*t1206
     #+0.9622049680843627D1*t1208-0.6318986292200858D-3*t1218
     #+0.3791391775320515D-2*t1220)*t157-0.2D-2*t455*t459*t464+0.2D-2
     #*t152/t458/t156*t1266-0.1D-2*t460*(-0.1202514962692326D1*t1206
     #+0.3607544888076978D1*t1208-0.4036488739909061D-1*t1218
     #+0.2421893243945437D0*t1220+0.3527987623518044D-1*t709))*t105
     #*t169+0.1D1*t478*t112*t1281*t168+0.2D1*t467*t398*t169
     #-0.4666666666666667D1*t478*t406*t488*t168
      t1333 = s2-t1297-t1299-t1303+0.7777777777777778D1*t161*sigma
     #*t1305*t168+0.1D1*t478*t112*(-0.522423459704672D1*t1179*t164
     #*sigma+0.2786258451758251D2*t1162*t480-0.522423459704672D1*t479
     #*sigma*t1244-0.2554070247445063D2*t106*t128*sigma)*t168+t1332
      t1338 = 0.5176049209143758D-1*t310*t339*t345*t347*t81
      t1342 = 0.1748148507797795D-2*t1208*t335
      t1343 = t1206*t47
      t1344 = 0.1831848842792292D-2*t1343
      t1345 = t1208*t47
      t1346 = 0.5495546528376876D-2*t1345
      t1358 = 0.1124999956683108D1*t340*(-0.1132974264373283D1*t1200
     #+0.271913823449588D1*t1202-0.4994648585728036D0*t1206
     #+0.1498394575718411D1*t1208-0.1075243117819161D0*t1212
     #+0.4300972471276643D0*t1214-0.4247805766949639D-1*t1218
     #+0.2548683460169784D0*t1220)*t349
      t1361 = 0.7599104707404789D0*t61*t362*t769
      t1364 = t310*t314*t329*t330
      t1365 = 0.8837926660346786D-1*t1364
      t1377 = t375**2
      t1393 = t368**2
      t1396 = t93**2
      t1407 = 0.8806932620892844D-3*t1206*t94-0.2642079786267853D-2
     #*t1208*t94-0.8497974591333914D-1*t310*t369*t375*t376-0.2D1*t85
     #/t368/t90*t1377*t376+0.1D1*t370*(-0.1544496508763151D1*t1200
     #+0.3706791621031562D1*t1202-0.854388052766047D0*t1206
     #+0.2563164158298141D1*t1208-0.4111834438919023D0*t1212
     #+0.1644733775567609D1*t1214-0.5346380647307093D-1*t1218
     #+0.3207828388384256D0*t1220)*t376+0.3216395899738507D2*t85/t1393
     #*t1377/t1396-0.1831848842792292D-2*t1343+0.5495546528376876D-2
     #*t1345+0.8837926660346786D-1*t1364+0.2D1*t1230-0.1D1*t1224
     #-0.1608197949869254D2*t1196
      t1410 = 0.1923661050931536D1*t1407*t72*t78
      t1421 = 0.4444444444444444D0*t748*t73*t77+0.2666666666666667D1
     #*t352*t709+0.4444444444444444D0*t754*t73*t77
     #-0.2666666666666667D1*t355*t709
      t1424 = 0.3799552353702395D-1*t61*t1421*t80
      t1427 = 0.1538928840745229D2*t386*t389
      t1429 = 0.1538928840745229D2*t383*t389
      t1432 = 0.1923661050931536D1*t97*t1421*t78
      t1435 = 0.3847322101863073D1*t382*t358*t78
      t1438 = 0.3847322101863073D2*t98*t74*t769
      t1450 = t1197+t1225-t1231-t1297-t1299-t1303+t1332+t1338+t1342
     #+t1344-t1346-t1358
      t1454 = 0.2249999913366216D1*t346*t347*t358*t80
      t1458 = 0.3039641882961916D0*t61*t358*t74*t295
      t1461 = 0.8999999653464862D1*t346*t348*t389
      t1462 = t338**2
      t1466 = t59**2
      t1471 = 0.3330984244245859D2*t51/t1462*t1329/t1466*t72*t80
      t1472 = -t1361-t1365+t1410+t1424-t1427-t1429+t1432+t1435+t1438
     #-t1454+t1458-t1461-t1471
      t1473 = t1450+t1472
      t1482 = -0.4042761511756372D2*t1473*t116+0.2425656907053823D3
     #*t805*t398-0.4851313814107647D3*t808*t1179+0.1212828453526912D3
     #*t243*t1244
      t1484 = t128*t1482*t119
      t1487 = t119*t398
      t1488 = t415*t1487
      t1492 = t423*t414*t119
      t1495 = t414**2
      t1496 = t128*t1495
      t1497 = t1496*t725
      t1500 = t1496*t119
      t1505 = t125/t126/t768
      t1508 = t1043*t1179
      t1511 = t832*t398
      t1514 = t253*t1244
      t1517 = 0.3808092365862222D0*t700*t112*t1179
     #+0.5923699235785679D0*t235*t406*t398-0.1269364121954074D0*t235
     #*t112*t1244+0.4936416029821399D0*t109*t1305
     #-0.1086645186223595D-1*t239*t1484+0.8693161489788758D-1*t730
     #*t1488+0.1014202173808688D0*t239*t1492+0.2173290372447189D-1
     #*t276*t1497-0.1086645186223595D-1*t239*t1500
     #+0.2873572825791284D0*t123*t1505+0.2173290372447189D0*t123*t1508
     #+0.4056808695234754D0*t123*t1511-0.4346580744894379D-1*t123*t1514
      t1522 = t446**2
      t1536 = t112*t1495
      t1573 = 0.5862637881547585D0*t139*t1508-0.5862637881547585D-1
     #*t276*t1500+0.6848438000915295D0*t859*t430*t1487
     #+0.7989844334401178D0*t264*t406*t414*t119+0.3424219000457648D0
     #*t855*t1536*t725-0.5862637881547585D-1*t276*t1484
     #+0.1094359071222216D1*t139*t1511-0.1712109500228824D0*t264*t112
     #*t1482*t119-0.1712109500228824D0*t264*t1536*t119
     #+0.1027265700137294D1*t133*t1072*t1179+0.1597968866880236D1*t133
     #*t880*t398-0.3424219000457648D0*t133*t269*t1244
     #+0.1331640722400196D1*t133*t108*t1305+0.4690110305238068D0*t893
     #*t1488+0.547179535611108D0*t276*t1492+0.1758791364464276D0*t890
     #*t1497+0.7751710087824029D0*t139*t1505-0.1172527576309517D0*t139
     #*t1514
      t1582 = -t1427-t1429+t1432+t1435+t1438+0.2473556743557577D-1
     #*t107*(0.2697586091519874D1*t1517*t143-0.5395172183039748D1*t845
     #*t446+0.5395172183039748D1*t850*t1522-0.2697586091519874D1*t262
     #*t1573)*t286+0.7420670230672731D-1*t225*t1244-t1454+t1458-t1461
     #-t1471
      t1586 = 0.81D0*rho*(t1333+t1338-0.4666666666666667D1*t471*t475
     #+t1342+t1344-t1346-t1358-t1361-t1365+t1410+t1424+t1582)
      t1588 = 0.19D0*rho*t1473
      t1589 = -0.8463260047215686D1*t298-0.8064D-2*t181*t203+0.3024D-2
     #*t8*t185*(0.784D-1*t9*t669*t11+0.168D0*sigmaaa/t190/t673*t199
     #-0.448D-1*t679/t4/t673/t189*t685)+0.4007161924563275D-1*t287
     #-0.9408D-2*t669*sigmaaa*t15+0.81D0*t968-0.3308535951463467D0
     #/t190+t972+t973-t974+t975+0.81D0*rho*t1123+0.19D0*rho*t1026
     #+0.81D0*t1173+0.19D0*t1175+0.19D0*t1177+t1586+t1588
      v2rhoa2(i) = t664+t1589
      t1594 = 0.3039641882961916D0*t217+t643+t644+t645-t646-t647+t648
     #+t649+t650-t651+t652-0.1538928840745229D2*t223+t656
     #+0.7599104707404789D-1*t529+0.3847322101863073D1*t533+t972+t973
     #-t974
      t1597 = t61*t527*t214*t77
      t1598 = 0.3039641882961916D0*t1597
      t1599 = t532*t222
      t1600 = 0.1538928840745229D2*t1599
      t1601 = t983+t1598-t991+t994-t1600+t999
      t1607 = 1/t18/t510
      t1611 = t536**2
      t1614 = t106*t572
      t1615 = t286*t536
      t1621 = t547**2
      t1622 = t128*t1621
      t1623 = t1622*t725
      t1626 = t119*t536
      t1627 = t548*t1626
      t1632 = t542*t125
      t1637 = -0.4042761511756372D2*t1601*t116+0.2425656907053823D3
     #*t1632*t536-0.4851313814107647D3*t808*t1611+t1034
      t1639 = t128*t1637*t119
      t1642 = t1622*t119
      t1645 = t1043*t1611
      t1651 = t555*t261
      t1654 = t569**2
      t1657 = t112*t1621
      t1684 = 0.3424219000457648D0*t855*t1657*t725
     #+0.6848438000915295D0*t859*t558*t1626-0.1712109500228824D0*t264
     #*t112*t1637*t119-0.1712109500228824D0*t264*t1657*t119
     #+0.1027265700137294D1*t133*t1072*t1611-t1078
     #+0.1758791364464276D0*t890*t1623+0.4690110305238068D0*t893*t1627
     #-0.5862637881547585D-1*t276*t1639-0.5862637881547585D-1*t276
     #*t1642+0.5862637881547585D0*t139*t1645-t1090
      t1691 = t572**2
      t1703 = t983+t1598-t991+t994-t1600+t999+0.1484134046134546D0
     #*t963*t1611+0.1484134046134546D0*t1614*t1615+t1011
     #+0.2473556743557577D-1*t107*(0.2697586091519874D1*
     #(0.3808092365862222D0*t700*t112*t1611-t1017
     #+0.2173290372447189D-1*t276*t1623+0.8693161489788758D-1*t730
     #*t1627-0.1086645186223595D-1*t239*t1639-0.1086645186223595D-1
     #*t239*t1642+0.2173290372447189D0*t123*t1645-t1049)*t143
     #-0.5395172183039748D1*t1651*t569+0.5395172183039748D1*t850*t1654
     #-0.2697586091519874D1*t262*t1684)*t286-0.2473556743557577D-1
     #*t107*t1691*t919+t1104-0.1567270379114016D2*t160*t1611*t122
     #*t1107-t1113+0.272926271249799D2*t1115*t1118*t1611*t168
      t1708 = t536*t168
      t1711 = 0.522423459704672D1*t293*t953*t1708
      t1713 = 0.7420670230672731D-1*t1614*t958
      t1714 = t398*t536
      t1716 = 0.1484134046134546D0*t963*t1714
      t1717 = -t720
      t1719 = 0.7420670230672731D-1*t225*t1717
      t1720 = t919*t572
      t1722 = 0.2473556743557577D-1*t450*t1720
      t1725 = t293*t769*t536*t168
      t1728 = 0.2333333333333333D1*t576*t475
      t1731 = 0.1D1*t160*t1717*t169
      t1733 = 0.522423459704672D1*t947*t580
      t1734 = t941*t1708
      t1735 = t940*t1734
      t1737 = t576*sigma
      t1739 = 0.1D1*t1737*t490
      t1754 = 0.3496297015595589D-2*t772
      t1755 = 0.7694644203726145D1*t792
      t1756 = -t1711+t1713+t1716+t1719-t1722+0.1218988072644235D2
     #*t1725-t1728+t1731-t1733-0.522423459704672D1*t1735+t1739+0.1D1
     #*t478*t112*(-0.522423459704672D1*t536*t164*t480
     #-0.522423459704672D1*t479*sigma*t1717+0.1393129225879125D2*t1162
     #*sigma*t536)*t168-t1754-t1755
      t1757 = 0.7694644203726145D1*t794
      t1758 = 0.3077857681490458D2*t797
      t1759 = 0.6079283765923831D0*t782
      t1760 = 0.1519820941480958D0*t779
      t1761 = 0.4499999826732431D1*t775
      t1762 = t401*t536
      t1771 = t725*t547
      t1772 = t415*t1771
      t1775 = t415*t1626
      t1781 = 0.8740742538988973D-3*t310*t60*t527*t80
      t1785 = 0.1124999956683108D1*t346*t347*t527*t80
      t1786 = -t760
      t1789 = 0.3799552353702395D-1*t61*t1786*t80
      t1793 = 0.1519820941480958D0*t61*t527*t74*t295
      t1796 = 0.1923661050931536D1*t382*t527*t78
      t1799 = 0.1923661050931536D1*t97*t1786*t78
      t1801 = 0.7694644203726145D1*t532*t389
      t1802 = -t1781-t1754-t1785-t1761+t1789+t1760+t1793-t1759+t1796
     #-t1755+t1799-t1757-t1801+t1758
      t1813 = -0.4042761511756372D2*t1802*t116+0.1212828453526912D3
     #*t805*t536+0.1212828453526912D3*t1632*t398-0.4851313814107647D3
     #*t808*t1714+0.1212828453526912D3*t243*t1717
      t1815 = t128*t1813*t119
      t1818 = t547*t119
      t1819 = t415*t1818
      t1822 = t731*t1818
      t1825 = t731*t536
      t1828 = t253*t1717
      t1832 = t423*t547*t119
      t1835 = t832*t536
      t1838 = 0.3808092365862222D0*t700*t1762-0.1269364121954074D0
     #*t235*t112*t1717+0.296184961789284D0*t235*t406*t536
     #+0.2173290372447189D-1*t276*t1772+0.4346580744894379D-1*t730
     #*t1775-0.1086645186223595D-1*t239*t1815-0.1086645186223595D-1
     #*t239*t1819+0.4346580744894379D-1*t730*t1822
     #+0.2173290372447189D0*t828*t1825-0.4346580744894379D-1*t123
     #*t1828+0.5071010869043442D-1*t239*t1832+0.2028404347617377D0
     #*t123*t1835
      t1894 = 0.3424219000457648D0*t855*t430*t1771
     #+0.3424219000457648D0*t859*t430*t1626-0.1712109500228824D0*t264
     #*t112*t1813*t119-0.1712109500228824D0*t264*t430*t1818
     #+0.3424219000457648D0*t859*t401*t1818+0.1027265700137294D1*t877
     #*t1762-0.3424219000457648D0*t133*t269*t1717+0.3994922167200589D0
     #*t264*t406*t547*t119+0.7989844334401178D0*t133*t880*t536
     #+0.1758791364464276D0*t890*t1772+0.2345055152619034D0*t893*t1775
     #-0.5862637881547585D-1*t276*t1815-0.5862637881547585D-1*t276
     #*t1819+0.2345055152619034D0*t893*t1822+0.5862637881547585D0*t904
     #*t1825-0.1172527576309517D0*t139*t1828+0.273589767805554D0*t276
     #*t1832+0.547179535611108D0*t139*t1835
      t1900 = 0.2473556743557577D-1*t107*(0.2697586091519874D1*t1838
     #*t143-0.2697586091519874D1*t845*t569-0.2697586091519874D1*t1651
     #*t446+0.5395172183039748D1*t850*t446*t569-0.2697586091519874D1
     #*t262*t1894)*t286
      t1902 = 0.7420670230672731D-1*t696*t1615
      t1905 = 0.1D1*t467*t536*t169
      t1906 = -t1757+t1758-t1759+t1760-t1761+t1900+t1902-t1785+t1789
     #+t1796-t1781+t1793+t1799-t1801+t1905
      t1908 = rho*(t1756+t1906)
      t1912 = -t1711+t1713+t1716+t1719-t1722+0.261211729852336D2*t1725
     #-t1728+t1731-t1733-0.1044846919409344D2*t1735+t1739-t1754-t1755
     #-t1757
      t1917 = t1758-t1759+t1760-t1761+t1900-0.522423459704672D1*t293
     #*t295*t1717*t168+t1902-t1785+t1789+t1796-t1781+t1793+t1799-t1801
     #+t1905
      t1919 = rho*(t1912+t1917)
      t1924 = 1/t505/t28
      t1925 = t523**2
      t1931 = rho*t1802
      t1936 = t499**2
      t1942 = sigmabb**2
      t1948 = 1/t519/t518
      t1955 = t975+0.19D0*rho*t1601+0.1202148577368982D0*t537
     #+0.4007161924563275D-1*t574-0.9408D-2*t1607*sigmabb*t29+0.81D0
     #*rho*t1703-0.8463260047215686D1*t581+0.162D1*t577+0.81D0*t1908
     #+t1586+0.81D0*t1919+t1588-0.8064D-2*t502*t524-0.6048D-2*t22
     #*t1924*t1925-0.3308535951463467D0/t511+0.38D0*t1931+0.3024D-2
     #*t22*t506*(0.784D-1*t23*t1607*t25+0.168D0*sigmabb/t511/t1936
     #*t520-0.448D-1*t1942/t18/t1936/t510*t1948)
      v2rhob2(i) = t1594+t1955
      t1960 = 0.6010742886844912D-1*t233+t643+t644+t645-t646-t647+t648
     #+t649+t650-t651+t652+t213+t221+t656+0.81D0*t290
     #-0.4231630023607843D1*t298+0.2003580962281637D-1*t287+t530+t534
      t1968 = -t980
      t1971 = 0.3799552353702395D-1*t61*t1968*t80
      t1972 = 0.1519820941480958D0*t986
      t1973 = 0.1519820941480958D0*t1597
      t1974 = 0.4559462824442873D0*t990
      t1977 = 0.1923661050931536D1*t97*t1968*t78
      t1978 = 0.7694644203726145D1*t995
      t1979 = 0.7694644203726145D1*t1599
      t1980 = 0.2308393261117844D2*t998
      t1981 = t232*t536
      t1986 = -t1009
      t1991 = t236*t536
      t1997 = t247*t1771
      t2000 = t247*t1626
      t2003 = t1971+t1972-t1973+t1974+t1977-t1978+t1979-t1980
      t2014 = -0.4042761511756372D2*t2003*t116+0.1212828453526912D3
     #*t802*t536+0.1212828453526912D3*t1632*t232-0.4851313814107647D3
     #*t808*t1981+0.1212828453526912D3*t243*t1986
      t2016 = t128*t2014*t119
      t2019 = t247*t1818
      t2022 = t128*t232
      t2023 = t2022*t1818
      t2026 = t2022*t536
      t2029 = t253*t1986
      t2077 = 0.3424219000457648D0*t855*t265*t1771
     #+0.3424219000457648D0*t859*t265*t1626-0.1712109500228824D0*t264
     #*t112*t2014*t119-0.1712109500228824D0*t264*t265*t1818
     #+0.3424219000457648D0*t859*t236*t1818+0.1027265700137294D1*t877
     #*t1991-0.3424219000457648D0*t133*t269*t1986+0.1758791364464276D0
     #*t890*t1997+0.2345055152619034D0*t893*t2000
     #-0.5862637881547585D-1*t276*t2016-0.5862637881547585D-1*t276
     #*t2019+0.2345055152619034D0*t893*t2023+0.5862637881547585D0*t904
     #*t2026-0.1172527576309517D0*t139*t2029
      t2096 = t1118*t232
      s1 = t1971+t1972-t1973+t1974+t1977-t1978+t1979-t1980
     #+0.1484134046134546D0*t963*t1981
      s2 = s1+0.7420670230672731D-1*t1614*t697+0.7420670230672731D-1
     #*t225*t1986+0.7420670230672731D-1*t957*t1615
     #+0.2473556743557577D-1*t107*(0.2697586091519874D1*
     #(0.3808092365862222D0*t700*t1991-0.1269364121954074D0*t235*t112
     #*t1986+0.2173290372447189D-1*t276*t1997+0.4346580744894379D-1
     #*t730*t2000-0.1086645186223595D-1*t239*t2016
     #-0.1086645186223595D-1*t239*t2019+0.4346580744894379D-1*t730
     #*t2023+0.2173290372447189D0*t828*t2026-0.4346580744894379D-1
     #*t123*t2029)*t143-0.2697586091519874D1*t842*t569
     #-0.2697586091519874D1*t1651*t281+0.5395172183039748D1*t850*t281
     #*t569-0.2697586091519874D1*t262*t2077)*t286
      t2100 = s2-0.2473556743557577D-1*t285*t1720+0.1D1*t160*t1986
     #*t169-0.1567270379114016D2*t289*t122*t1734-0.522423459704672D1
     #*t293*t295*t1986*t168+0.272926271249799D2*t1115*t2096*t1708
      t2109 = 0.405D0*t968+t972+t973-t974+t975+0.6010742886844912D-1
     #*t537+0.2003580962281637D-1*t574+0.405D0*t1173
     #-0.4231630023607843D1*t581+0.81D0*t577+0.95D-1*t1175+0.81D0*rho
     #*t2100+0.405D0*t1908+0.95D-1*t1177+t1586+0.405D0*t1919+t1588
     #+0.19D0*rho*t2003+0.19D0*t1931
      v2rhoab(i) = t1960+t2109
      t2114 = t7*t185
      t2136 = t106*t614
      t2140 = t263*t125
      t2150 = t603*t261
      t2156 = t138*t108
      t2159 = t121*t116
      t2162 = t854*t125
      t2174 = t919*t614
      t2180 = t295*t106*t168
      t2184 = t160*t124*t122
      t2189 = rho*(0.7420670230672731D-1*t2136*t697
     #+0.2473556743557577D-1*t107*(0.2697586091519874D1*(
     #-0.1269364121954074D0*t270-0.2173290372447189D-1*t2140*t248
     #-0.8693161489788758D-1*t133*t254)*t143-0.2697586091519874D1*t842
     #*t611-0.2697586091519874D1*t2150*t281+0.5395172183039748D1*t850
     #*t281*t611-0.2697586091519874D1*t262*(-0.1712109500228824D0
     #*t2156*t266-0.3424219000457648D0*t2159*t236-0.1172527576309517D0
     #*t2162*t248-0.2345055152619034D0*t263*t254))*t286
     #-0.2473556743557577D-1*t285*t2174+0.1D1*t289*t618
     #-0.130605864926168D2*t927*t2180+0.1364631356248995D2*t2184*t2096
     #*t168)
      t2190 = 0.81D0*t2189
      t2191 = 0.2003580962281637D-1*t616
      t2192 = 0.81D0*t619
      t2193 = 0.2115815011803922D1*t624
      s1 = 0.7420670230672731D-1*t2136*t958+0.2473556743557577D-1*t107
     #*(0.2697586091519874D1*(-0.1269364121954074D0*t434
     #-0.148092480894642D0*t437-0.2173290372447189D-1*t2140*t416
     #-0.8693161489788758D-1*t133*t419-0.1014202173808688D0*t133*t424)
     #*t143-0.2697586091519874D1*t845*t611-0.2697586091519874D1*t2150
     #*t446+0.5395172183039748D1*t850*t446*t611-0.2697586091519874D1
     #*t262*(-0.1712109500228824D0*t2156*t431-0.3424219000457648D0
     #*t2159*t401-0.3994922167200589D0*t606*t406-0.1172527576309517D0
     #*t2162*t416-0.2345055152619034D0*t263*t419-0.273589767805554D0
     #*t263*t424))*t286-0.2473556743557577D-1*t450*t2174+0.1D1*t468
     #*t618-0.261211729852336D1*t467*t107*t623+0.1D1*t471*t618
      t2265 = s1-0.261211729852336D1*t1182*t2180-0.2333333333333333D1
     #*t161*t406*t168+0.6094940363221173D1*t621*sigma*t769*t168+0.1D1
     #*t161*t490+0.1D1*t478*t112*(-0.522423459704672D1*t479*t398
     #+0.6965646129395627D1*t485)*t168-0.261211729852336D1*t621*sigma
     #*t953*t168
      t2266 = rho*t2265
      t2267 = 0.81D0*t2266
      v2rhoasigmaaa(i) = 0.4032D-2*t180*t15-0.4032D-2*t181*t597
     #+0.3024D-2*t2114*t202-0.6048D-2*t8*t658*t202*t596+0.3024D-2*t8
     #*t185*(-0.168D-1*t590*t180*t11-0.504D-1*t192*t199+0.168D-1
     #*sigmaaa/t4/t673/t178*t685)+t2190+t2191+t2192-t2193+t2267
      t2269 = 0.4007161924563275D-1*t616
      t2270 = 0.162D1*t619
      t2271 = 0.4231630023607843D1*t624
      t2272 = 0.162D1*t2266
      v2rhoasigmaab(i) = 0.162D1*t2189+t2269+t2270-t2271+t2272
      v2rhoasigmabb(i) = t2190+t2191+t2192-t2193+t2267
      t2316 = rho*(0.7420670230672731D-1*t2136*t1615
     #+0.2473556743557577D-1*t107*(0.2697586091519874D1*(
     #-0.1269364121954074D0*t562-0.2173290372447189D-1*t2140*t549
     #-0.8693161489788758D-1*t133*t552)*t143-0.2697586091519874D1
     #*t1651*t611-0.2697586091519874D1*t2150*t569+0.5395172183039748D1
     #*t850*t569*t611-0.2697586091519874D1*t262*(-0.1712109500228824D0
     #*t2156*t559-0.3424219000457648D0*t2159*t539-0.1172527576309517D0
     #*t2162*t549-0.2345055152619034D0*t263*t552))*t286
     #-0.2473556743557577D-1*t573*t2174+0.1D1*t576*t618
     #-0.130605864926168D2*t1737*t2180+0.1364631356248995D2*t2184
     #*t1118*t536*t168)
      t2317 = 0.81D0*t2316
      v2rhobsigmaaa(i) = t2317+t2191+t2192-t2193+t2267
      v2rhobsigmaab(i) = 0.162D1*t2316+t2269+t2270-t2271+t2272
      t2323 = t21*t506
      v2rhobsigmabb(i) = 0.4032D-2*t501*t29-0.4032D-2*t502*t638
     #+0.3024D-2*t2323*t523-0.6048D-2*t22*t1924*t523*t637+0.3024D-2
     #*t22*t506*(-0.168D-1*t631*t501*t25-0.504D-1*t513*t520+0.168D-1
     #*sigmabb/t18/t1936/t499*t1948)+t2317+t2191+t2192-t2193+t2267
      t2347 = t596**2
      t2375 = t611**2
      t2386 = t614**2
      t2399 = rho*(0.2473556743557577D-1*t107*(0.5862637881547585D-1
     #*t121*t125*t128*t143-0.5395172183039748D1*t2150*t611
     #+0.5395172183039748D1*t850*t2375-0.1581497040888031D0*t262*t138
     #*t125*t128)*t286-0.2473556743557577D-1*t107*t2386*t919
     #-0.522423459704672D1*t621*t295*t168+0.6823156781244976D1*t160
     #*t251*sigma*t1118*t168)
      t2400 = 0.81D0*t2399
      v2sigmaaa2(i) = 0.6048D-2*t2114*t596-0.6048D-2*t8*t658*t2347
     #+0.3024D-2*t8*t185*(-0.63D-2/t9/sigmaaa*t7*t11+0.63D-2/sigmaaa
     #*t195*t199-0.63D-2/t4/t673/rhoa*t685)+t2400
      v2sigmaaaab(i) = 0.162D1*t2399
      v2sigmaaabb(i) = t2400
      v2sigmaab2(i) = 0.324D1*t2399
      v2sigmaabbb(i) = v2sigmaaaab(i)
      t2403 = t637**2
      v2sigmabb2(i) = 0.6048D-2*t2323*t637-0.6048D-2*t22*t1924*t2403
     #+0.3024D-2*t22*t506*(-0.63D-2/t23/sigmabb*t21*t25+0.63D-2
     #/sigmabb*t516*t520-0.63D-2/t18/t1936/rhob*t1948)+v2sigmaaabb(i)
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      v2rhob2(i) = 0.0d0
      v2rhoab(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2rhoasigmaab(i) = 0.0d0
      v2rhoasigmabb(i) = 0.0d0
      v2rhobsigmaaa(i) = 0.0d0
      v2rhobsigmaab(i) = 0.0d0
      v2rhobsigmabb(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      v2sigmaab2(i) = 0.0d0
      v2sigmabb2(i) = 0.0d0
      v2sigmaaaab(i) = 0.0d0
      v2sigmaaabb(i) = 0.0d0
      v2sigmaabbb(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end
      
      
      subroutine rks_xc_b3pw91
     & (ideriv,npt,rhoa1,sigmaaa1,
     &  zk,vrhoa,vsigmaaa,
     &  v2rhoa2,v2rhoasigmaaa,v2sigmaaa2)
c
c     A.D. Becke
c     Density-functional thermochemistry. III. 
c     The role of exact exchange
c     J.Chem.Phys. 98 (1993) 5648--5652
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt)
      REAL sigmaaa1(npt)
      REAL zk(npt),vrhoa(npt),vsigmaaa(npt)
      REAL v2rhoa2(npt),v2rhoasigmaaa(npt),v2sigmaaa2(npt)
      parameter(tol=1.0d-20)
      
      if(ideriv.eq.0) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t3 = t2*rho
      t5 = 1/t3
      t7 = dsqrt(sigma)
      t8 = t7*t5
      t10 = dlog(0.1259921049894873D1*t8+dsqrt(1+0.1587401051968199D1
     #*t8**2))
      t17 = 1/rho
      t18 = t17**(1.D0/3.D0)
      t20 = 1.D0+0.1325688999052018D0*t18
      t21 = t17**(1.D0/6.D0)
      t24 = dsqrt(t17)
      t26 = t18**2
      t32 = dlog(1.D0+0.1608197949869254D2/(0.598255043577108D1*t21
     #+0.2225569421150687D1*t18+0.8004286349993634D0*t24
     #+0.1897004325747559D0*t26))
      t33 = t20*t32
      t35 = rho**2
      t37 = 1/t2/t35
      t41 = dexp(0.2513845706671277D1*t33)
      t42 = t41-1.D0
      t43 = 1/t42
      t44 = sigma**2
      t46 = t35**2
      t47 = t2**2
      t49 = 1/t47/t46
      t56 = t42**2
      t66 = dlog(1.D0+0.2697586091519874D1*(0.634682060977037D-1*sigma
     #*t37+0.1086645186223595D-1*t43*t44*t49)/(1.D0
     #+0.1712109500228824D0*t43*sigma*t37+0.2931318940773793D-1/t56
     #*t44*t49))
      t84 = dexp(-0.261211729852336D1/t47/t35*sigma)
      zk(i) = -0.5908470131056179D0*t3-0.3810001254882096D-2*t5*sigma/
     #(1.D0+0.317500104573508D-1*t8*t10)+0.81D0*rho*(-0.621814D-1*t33
     #+0.2473556743557577D-1*t66+0.1D1*(0.1D-2*(0.2568D1
     #+0.1443307452126544D2*t18+0.2843543831490386D-2*t26)/(1.D0
     #+0.5411317332115466D1*t18+0.1816419932959077D0*t26
     #+0.1763993811759022D-1*t17)-0.1853571428571429D-2)*sigma*t37*t84
     #)-0.11814466D-1*rho*t20*t32
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t3 = t2*rho
      t5 = 1/t3
      t6 = t5*sigma
      t7 = dsqrt(sigma)
      t8 = t7*t5
      t10 = dlog(0.1259921049894873D1*t8+dsqrt(1+0.1587401051968199D1
     #*t8**2))
      t13 = 1.D0+0.317500104573508D-1*t8*t10
      t14 = 1/t13
      t17 = 1/rho
      t18 = t17**(1.D0/3.D0)
      t20 = 1.D0+0.1325688999052018D0*t18
      t21 = t17**(1.D0/6.D0)
      t24 = dsqrt(t17)
      t26 = t18**2
      t28 = 0.598255043577108D1*t21+0.2225569421150687D1*t18
     #+0.8004286349993634D0*t24+0.1897004325747559D0*t26
      t31 = 1.D0+0.1608197949869254D2/t28
      t32 = dlog(t31)
      t33 = t20*t32
      t35 = rho**2
      t37 = 1/t2/t35
      t38 = sigma*t37
      t41 = dexp(0.2513845706671277D1*t33)
      t42 = t41-1.D0
      t43 = 1/t42
      t44 = sigma**2
      t45 = t43*t44
      t46 = t35**2
      t47 = t2**2
      t49 = 1/t47/t46
      t52 = 0.634682060977037D-1*t38+0.1086645186223595D-1*t45*t49
      t53 = t43*sigma
      t56 = t42**2
      t57 = 1/t56
      t58 = t57*t44
      t61 = 1.D0+0.1712109500228824D0*t53*t37+0.2931318940773793D-1
     #*t58*t49
      t62 = 1/t61
      t65 = 1.D0+0.2697586091519874D1*t52*t62
      t66 = dlog(t65)
      t70 = 0.2568D1+0.1443307452126544D2*t18+0.2843543831490386D-2*t26
      t74 = 1.D0+0.5411317332115466D1*t18+0.1816419932959077D0*t26
     #+0.1763993811759022D-1*t17
      t75 = 1/t74
      t78 = 0.1D-2*t70*t75-0.1853571428571429D-2
      t79 = t78*sigma
      t81 = 1/t47/t35
      t82 = t81*sigma
      t84 = dexp(-0.261211729852336D1*t82)
      t85 = t37*t84
      t86 = t79*t85
      zk(i) = -0.5908470131056179D0*t3-0.3810001254882096D-2*t6*t14
     #+0.81D0*rho*(-0.621814D-1*t33+0.2473556743557577D-1*t66+0.1D1
     #*t86)-0.11814466D-1*rho*t20*t32
      t97 = t13**2
      t98 = 1/t97
      t102 = t35*rho
      t108 = dsqrt(1.D0+0.1587401051968199D1*t82)
      t109 = 1/t108
      t120 = 1/t35
      t121 = 1/t26*t120
      t122 = t121*t32
      t123 = 0.2747773264188438D-2*t122
      t124 = t28**2
      t127 = t21**2
      t128 = t127**2
      t138 = 1/t18*t120
      t143 = t20/t124*(-0.99709173929518D0/t128/t21*t120
     #-0.7418564737168958D0*t121-0.4002143174996817D0/t24*t120
     #-0.1264669550498372D0*t138)/t31
      t144 = 0.1D1*t143
      t146 = 1/t2/t102
      t151 = -0.1110859199549419D0*t122-0.4042761511756372D2*t143
      t153 = t49*t151*t41
      t156 = t46*rho
      t158 = 1/t47/t156
      t164 = t61**2
      t166 = t52/t164
      t167 = t57*sigma
      t185 = 1/t65
      t193 = t74**2
      s1 = -0.7877960174741572D0*t2+0.5080001673176129D-2*t38*t14
     #+0.1905000627441048D-2*t6*t98*(-0.8466669455293548D-1*t7*t37*t10
     #-0.106673350692263D0*sigma/t47/t102*t109)-0.621814D-1*t33
      vrhoa(i) = s1+0.2003580962281637D-1*t66+0.81D0*t86+0.81D0*rho*
     #(t123+t144+0.2473556743557577D-1*(0.2697586091519874D1*(
     #-0.148092480894642D0*sigma*t146-0.1086645186223595D-1*t58*t153
     #-0.5071010869043442D-1*t45*t158)*t62-0.2697586091519874D1*t166*(
     #-0.1712109500228824D0*t167*t37*t151*t41-0.3994922167200589D0*t53
     #*t146-0.5862637881547585D-1/t56/t42*t44*t153-0.136794883902777D0
     #*t58*t158))*t185+0.1D1*(0.1D-2*(-0.4811024840421814D1*t121
     #-0.1895695887660258D-2*t138)*t75-0.1D-2*t70/t193*(
     #-0.1803772444038489D1*t121-0.1210946621972718D0*t138
     #-0.1763993811759022D-1*t120))*sigma*t85-0.2333333333333333D1*t79
     #*t146*t84+0.6965646129395627D1*t78*t44/t46/t35*t84)+0.19D0*rho*
     #(t123+t144)
      vsigmaaa(i) = -0.1524000501952839D-1*t5*t14
     #+0.3810001254882096D-2*t6*t98*(0.6350002091470161D-1/t7*t5*t10
     #+0.8000501301919725D-1*t81*t109)+0.324D1*rho*
     #(0.2473556743557577D-1*(0.2697586091519874D1*
     #(0.634682060977037D-1*t37+0.2173290372447189D-1*t53*t49)*t62
     #-0.2697586091519874D1*t166*(0.1712109500228824D0*t43*t37
     #+0.5862637881547585D-1*t167*t49))*t185+0.1D1*t78*t37*t84
     #-0.261211729852336D1*t79/t156*t84)
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t3 = t2*rho
      t5 = 1/t3
      t6 = t5*sigma
      t7 = dsqrt(sigma)
      t8 = t7*t5
      t10 = dlog(0.1259921049894873D1*t8+dsqrt(1+0.1587401051968199D1
     #*t8**2))
      t13 = 1.D0+0.317500104573508D-1*t8*t10
      t14 = 1/t13
      t17 = 1/rho
      t18 = t17**(1.D0/3.D0)
      t20 = 1.D0+0.1325688999052018D0*t18
      t21 = t17**(1.D0/6.D0)
      t24 = dsqrt(t17)
      t26 = t18**2
      t28 = 0.598255043577108D1*t21+0.2225569421150687D1*t18
     #+0.8004286349993634D0*t24+0.1897004325747559D0*t26
      t31 = 1.D0+0.1608197949869254D2/t28
      t32 = dlog(t31)
      t33 = t20*t32
      t35 = rho**2
      t37 = 1/t2/t35
      t38 = sigma*t37
      t41 = dexp(0.2513845706671277D1*t33)
      t42 = t41-1.D0
      t43 = 1/t42
      t44 = sigma**2
      t45 = t43*t44
      t46 = t35**2
      t47 = t2**2
      t49 = 1/t47/t46
      t52 = 0.634682060977037D-1*t38+0.1086645186223595D-1*t45*t49
      t53 = t43*sigma
      t56 = t42**2
      t57 = 1/t56
      t58 = t57*t44
      t61 = 1.D0+0.1712109500228824D0*t53*t37+0.2931318940773793D-1
     #*t58*t49
      t62 = 1/t61
      t65 = 1.D0+0.2697586091519874D1*t52*t62
      t66 = dlog(t65)
      t70 = 0.2568D1+0.1443307452126544D2*t18+0.2843543831490386D-2*t26
      t74 = 1.D0+0.5411317332115466D1*t18+0.1816419932959077D0*t26
     #+0.1763993811759022D-1*t17
      t75 = 1/t74
      t78 = 0.1D-2*t70*t75-0.1853571428571429D-2
      t79 = t78*sigma
      t81 = 1/t47/t35
      t82 = t81*sigma
      t84 = dexp(-0.261211729852336D1*t82)
      t85 = t37*t84
      t86 = t79*t85
      zk(i) = -0.5908470131056179D0*t3-0.3810001254882096D-2*t6*t14
     #+0.81D0*rho*(-0.621814D-1*t33+0.2473556743557577D-1*t66+0.1D1
     #*t86)-0.11814466D-1*rho*t20*t32
      t97 = t13**2
      t98 = 1/t97
      t102 = t35*rho
      t104 = 1/t47/t102
      t107 = 1.D0+0.1587401051968199D1*t82
      t108 = dsqrt(t107)
      t109 = 1/t108
      t112 = -0.8466669455293548D-1*t7*t37*t10-0.106673350692263D0
     #*sigma*t104*t109
      t113 = t98*t112
      t119 = 1/t26
      t120 = 1/t35
      t121 = t119*t120
      t122 = t121*t32
      t123 = 0.2747773264188438D-2*t122
      t124 = t28**2
      t125 = 1/t124
      t126 = t20*t125
      t127 = t21**2
      t128 = t127**2
      t129 = t128*t21
      t130 = 1/t129
      t134 = 1/t24
      t137 = 1/t18
      t138 = t137*t120
      t140 = -0.99709173929518D0*t130*t120-0.7418564737168958D0*t121
     #-0.4002143174996817D0*t134*t120-0.1264669550498372D0*t138
      t141 = 1/t31
      t143 = t126*t140*t141
      t144 = 0.1D1*t143
      t146 = 1/t2/t102
      t147 = sigma*t146
      t151 = -0.1110859199549419D0*t122-0.4042761511756372D2*t143
      t153 = t49*t151*t41
      t156 = t46*rho
      t158 = 1/t47/t156
      t161 = -0.148092480894642D0*t147-0.1086645186223595D-1*t58*t153
     #-0.5071010869043442D-1*t45*t158
      t164 = t61**2
      t165 = 1/t164
      t166 = t52*t165
      t167 = t57*sigma
      t175 = 1/t56/t42
      t176 = t175*t44
      t181 = -0.1712109500228824D0*t167*t37*t151*t41
     #-0.3994922167200589D0*t53*t146-0.5862637881547585D-1*t176*t153
     #-0.136794883902777D0*t58*t158
      t184 = 0.2697586091519874D1*t161*t62-0.2697586091519874D1*t166
     #*t181
      t185 = 1/t65
      t186 = t184*t185
      t190 = -0.4811024840421814D1*t121-0.1895695887660258D-2*t138
      t193 = t74**2
      t194 = 1/t193
      t195 = t70*t194
      t199 = -0.1803772444038489D1*t121-0.1210946621972718D0*t138
     #-0.1763993811759022D-1*t120
      t202 = 0.1D-2*t190*t75-0.1D-2*t195*t199
      t203 = t202*sigma
      t204 = t203*t85
      t206 = t146*t84
      t207 = t79*t206
      t209 = t78*t44
      t210 = t46*t35
      t212 = 1/t210*t84
      t213 = t209*t212
      vrhoa(i) = -0.7877960174741572D0*t2+0.5080001673176129D-2*t38
     #*t14+0.1905000627441048D-2*t6*t113-0.621814D-1*t33
     #+0.2003580962281637D-1*t66+0.81D0*t86+0.81D0*rho*(t123+t144
     #+0.2473556743557577D-1*t186+0.1D1*t204-0.2333333333333333D1*t207
     #+0.6965646129395627D1*t213)+0.19D0*rho*(t123+t144)
      t223 = 1/t7
      t229 = 0.6350002091470161D-1*t223*t5*t10+0.8000501301919725D-1
     #*t81*t109
      t230 = t98*t229
      t236 = 0.634682060977037D-1*t37+0.2173290372447189D-1*t53*t49
      t243 = 0.1712109500228824D0*t43*t37+0.5862637881547585D-1*t167*t49
      t246 = 0.2697586091519874D1*t236*t62-0.2697586091519874D1*t166
     #*t243
      t247 = t246*t185
      t250 = t78*t37*t84
      t252 = 1/t156
      t253 = t252*t84
      t254 = t79*t253
      vsigmaaa(i) = -0.1524000501952839D-1*t5*t14
     #+0.3810001254882096D-2*t6*t230+0.324D1*rho*
     #(0.2473556743557577D-1*t247+0.1D1*t250-0.261211729852336D1*t254)
      t266 = 1/t97/t13
      t267 = t112**2
      t279 = t46*t102
      t284 = 1/t108/t107
      t294 = t140**2
      t296 = t20/t124/t28*t294*t141
      t297 = 0.2D1*t296
      t300 = 1/t46
      t303 = 1/t102
      t308 = 1/t26/t17*t300
      t310 = t119*t303
      t320 = 1/t18/t17*t300
      t322 = t137*t303
      t326 = t126*(-0.8309097827459833D0/t129/t17*t300
     #+0.199418347859036D1*t130*t303-0.4945709824779306D0*t308
     #+0.1483712947433792D1*t310-0.2001071587498409D0/t24/t17*t300
     #+0.8004286349993634D0*t134*t303-0.4215565168327908D-1*t320
     #+0.2529339100996745D0*t322)*t141
      t327 = 0.1D1*t326
      t328 = t124**2
      t331 = t31**2
      t334 = t20/t328*t294/t331
      t335 = 0.1608197949869254D2*t334
      t336 = t310*t32
      t337 = 0.5495546528376876D-2*t336
      t338 = t308*t32
      t339 = 0.1831848842792292D-2*t338
      t342 = t121*t125*t140*t141
      t343 = 0.8837926660346786D-1*t342
      t354 = t184**2
      t355 = t65**2
      t356 = 1/t355
      t361 = t46**2
      t370 = t209/t279*t84
      t373 = 1/t2/t46
      t375 = t79*t373*t84
      t390 = t199**2
      t408 = t158*t151*t41
      t417 = 0.8085523023512745D2*t296-0.4042761511756372D2*t326
     #-0.6501560775016922D3*t334+0.2221718399098838D0*t336
     #-0.7405727996996128D-1*t338+0.3572962974617552D1*t342
      t419 = t49*t417*t41
      t422 = t151**2
      t423 = t49*t422
      t425 = dexp(0.5027691413342554D1*t33)
      t426 = t423*t425
      t429 = t423*t41
      t433 = 1/t47/t210
      t434 = t45*t433
      t436 = sigma*t373
      t441 = t161*t165
      t446 = t52/t164/t61
      t447 = t181**2
      t458 = t175*sigma
      t459 = t37*t422
      t463 = t53*t373
      t472 = t56**2
      t479 = t58*t433
      s1 = -t297+t327+t335-t337+t339-t343+0.1393129225879125D2*t202
     #*t44*t212
      s2 = s1-0.2473556743557577D-1*t354*t356+0.4852022599996427D2*t78
     #*t44*sigma/t47/t361/rho*t84-0.5804705107829689D2*t370
      s3 = s2+0.7777777777777778D1*t375
      s4 = s3+0.1D1*(0.1D-2*(-0.3207349893614542D1*t308
     #+0.9622049680843627D1*t310-0.6318986292200858D-3*t320
     #+0.3791391775320515D-2*t322)*t75-0.2D-2*t190*t194*t199+0.2D-2
     #*t70/t193/t74*t390-0.1D-2*t195*(-0.1202514962692326D1*t308
     #+0.3607544888076978D1*t310-0.4036488739909061D-1*t320
     #+0.2421893243945437D0*t322+0.3527987623518044D-1*t303))*sigma*t85
      t487 = s4-0.4666666666666667D1*t203*t206+0.2473556743557577D-1*
     #(0.2697586091519874D1*(0.1014202173808688D0*t58*t408
     #-0.1086645186223595D-1*t58*t419+0.2173290372447189D-1*t176*t426
     #-0.1086645186223595D-1*t58*t429+0.2873572825791284D0*t434
     #+0.4936416029821399D0*t436)*t62-0.5395172183039748D1*t441*t181
     #+0.5395172183039748D1*t446*t447-0.2697586091519874D1*t166*
     #(0.7989844334401178D0*t167*t146*t151*t41-0.1712109500228824D0
     #*t167*t37*t417*t41+0.3424219000457648D0*t458*t459*t425
     #+0.1331640722400196D1*t463-0.5862637881547585D-1*t176*t419
     #-0.1712109500228824D0*t167*t459*t41+0.547179535611108D0*t176
     #*t408+0.1758791364464276D0/t472*t44*t426-0.5862637881547585D-1
     #*t176*t429+0.7751710087824029D0*t479))*t185
      t500 = dlog(1.D0+0.2960874997779344D2/(0.8157414703487641D1*t21
     #+0.2247591863577616D1*t18+0.4300972471276643D0*t24
     #+0.1911512595127338D0*t26))
      t502 = (1.D0+0.6901399211255825D-1*t18)*t500*t120
      t504 = t66*t120
      t510 = 0.1365394134884567D1*t502-0.1675897137780851D1*t33*t120
      t512 = t49*t510*t41
      t541 = -t510
      t543 = t49*t541*t41
      s1 = 0.1099109305675375D-1*t122+0.4D1*t143+0.801432384912655D-1
     #*t186+0.324D1*t204-0.756D1*t207+0.2256869345924183D2*t213
     #-0.3810001254882096D-2*t6*t266*t267
      s2 = s1-0.1016000334635226D-1*t38*t113+0.1905000627441048D-2*t6
     #*t98*(0.3951112412470322D0*t7*t146*t10+0.106673350692263D1*sigma
     #*t49*t109-0.4515557042823225D0*t44/t2/t279*t284)+0.38D0*rho*(
     #-t297+t327+t335-t337+t339-t343)
      s3 = s2-0.2370667447482193D-1*t147*t14-0.5251973449827715D0/t47
      s4 = s3+0.162D1*rho*t487
      s5 = s4
      s6 = 0.81D0*rho*(-0.3377379869957684D-1*t502
     #+0.1649037829038385D-1*t504+0.2473556743557577D-1*
     #(0.2697586091519874D1*(-0.2820809159897942D-1*t436
     #-0.1086645186223595D-1*t58*t512-0.9659068321987509D-2*t434)*t62
     #-0.2697586091519874D1*t166*(-0.1712109500228824D0*t167*t37*t510
     #*t41-0.760937555657255D-1*t463-0.5862637881547585D-1*t176*t512
     #-0.2605616836243371D-1*t479))*t185+0.2222222222222222D0*t375
     #-0.1160941021565938D1*t370)+0.81D0*rho*(0.3377379869957684D-1
     #*t502-0.1649037829038385D-1*t504+0.2473556743557577D-1*
     #(0.2697586091519874D1*(0.2820809159897942D-1*t436
     #-0.1086645186223595D-1*t58*t543+0.9659068321987509D-2*t434)*t62
     #-0.2697586091519874D1*t166*(-0.1712109500228824D0*t167*t37*t541
     #*t41+0.760937555657255D-1*t463-0.5862637881547585D-1*t176*t543
     #+0.2605616836243371D-1*t479))*t185-0.2222222222222222D0*t375
     #+0.1160941021565938D1*t370)
      v2rhoa2(i) = s5+s6
      t573 = t5*t98
      t607 = t236*t165
      s1 = 0.2032000669270451D-1*t37*t14-0.5080001673176129D-2*t38
     #*t230+0.7620002509764193D-2*t573*t112-0.3810001254882096D-2*t6
     #*t266*t112*t229
      s2 = s1+0.1905000627441048D-2*t6*t98*(-0.169333389105871D0*t223
     #*t37*t10-0.640040104153578D0*t104*t109+0.3386667782117419D0
     #*sigma/t2/t210*t284)+0.801432384912655D-1*t247
      v2rhoasigmaaa(i) = s2+0.324D1*t250-0.8463260047215686D1*t254
     #+0.324D1*rho*(0.2473556743557577D-1*(0.2697586091519874D1*(
     #-0.148092480894642D0*t146-0.2173290372447189D-1*t167*t153
     #-0.1014202173808688D0*t53*t158)*t62-0.2697586091519874D1*t441
     #*t243-0.2697586091519874D1*t607*t181+0.5395172183039748D1*t446
     #*t181*t243-0.2697586091519874D1*t166*(-0.1712109500228824D0*t57
     #*t37*t151*t41-0.3994922167200589D0*t43*t146-0.1172527576309517D0
     #*t458*t153-0.273589767805554D0*t167*t158))*t185
     #-0.2473556743557577D-1*t184*t356*t246+0.1D1*t202*t37*t84
     #-0.261211729852336D1*t203*t253-0.2333333333333333D1*t78*t146*t84
     #+0.2002623262201243D2*t79*t212-0.181950847499866D2*t209/t47/t361
     #*t84)
      t652 = t229**2
      t678 = t243**2
      t687 = t246**2
      v2sigmaaa2(i) = 0.3048001003905677D-1*t573*t229
     #-0.7620002509764193D-2*t6*t266*t652+0.3810001254882096D-2*t6*t98
     #*(-0.1270000418294032D0/t7/sigma*t5*t10+0.1600100260383945D0
     #/sigma*t81*t109-0.2540000836588064D0/t2/t156*t284)+0.1296D2*rho*
     #(0.2473556743557577D-1*(0.5862637881547585D-1*t43*t49*t62
     #-0.5395172183039748D1*t607*t243+0.5395172183039748D1*t446*t678
     #-0.1581497040888031D0*t166*t57*t49)*t185-0.2473556743557577D-1
     #*t687*t356-0.522423459704672D1*t78*t252*t84+0.6823156781244976D1
     #*t79/t47/t279*t84)
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end

c:XC_B3PW91subrend
_ENDIF
_IF(ccpdft,all,x_b97)
c:X_B97subrstart

c    Generated: Thu Feb 13 11:28:56 GMT 2003

      subroutine uks_x_b97
     & (ideriv,npt,rhoa1,rhob1,sigmaaa1,sigmabb1,sigmaab1,
     &  zk,vrhoa,vrhob,vsigmaaa,vsigmabb,vsigmaab,
     &  v2rhoa2,v2rhob2,v2rhoab,
     &  v2rhoasigmaaa,v2rhoasigmaab,v2rhoasigmabb,
     &  v2rhobsigmabb,v2rhobsigmaab,v2rhobsigmaaa,
     &  v2sigmaaa2,v2sigmaaaab,v2sigmaaabb,
     &  v2sigmaab2,v2sigmaabbb,v2sigmabb2)
c
c     A.D. Becke
c     Density-functional thermochemistry. V. Systematic optimization of
c     exchange-correlation functionals
c     J. Chem. Phys. 107 (1997) 8554-8560
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt),rhob1(npt)
      REAL sigmaaa1(npt),sigmabb1(npt),sigmaab1(npt)
      REAL zk(npt),vrhoa(npt),vrhob(npt)
      REAL vsigmaaa(npt),vsigmabb(npt),vsigmaab(npt)
      REAL v2rhoa2(npt),v2rhob2(npt),v2rhoab(npt)
      REAL v2rhoasigmaaa(npt),v2rhoasigmaab(npt)
      REAL v2rhoasigmabb(npt),v2rhobsigmabb(npt)
      REAL v2rhobsigmaab(npt),v2rhobsigmaaa(npt)
      REAL v2sigmaaa2(npt),v2sigmaaaab(npt),v2sigmaaabb(npt)
      REAL v2sigmaab2(npt),v2sigmaabbb(npt),v2sigmabb2(npt)
      parameter(tol=1.0d-20)
      
      if (ideriv.eq.0) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t4 = rhob**2
      t5 = t2**2
      t8 = sigmabb/t5/t4
      t10 = 1.D0+0.4D-2*t8
      t14 = sigmabb**2
      t15 = t4**2
      t20 = t10**2
      zk(i) = -0.9305257363491D0*t2*rhob*(0.8094D0+0.20292D-2*t8/t10
     #+0.119696D-4*t14/t2/t15/rhob/t20)
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t4 = rhoa**2
      t5 = t2**2
      t8 = sigmaaa/t5/t4
      t10 = 1.D0+0.4D-2*t8
      t14 = sigmaaa**2
      t15 = t4**2
      t20 = t10**2
      zk(i) = -0.9305257363491D0*t2*rhoa*(0.8094D0+0.20292D-2*t8/t10
     #+0.119696D-4*t14/t2/t15/rhoa/t20)
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t6 = rhoa**2
      t7 = t4**2
      t10 = sigmaaa/t7/t6
      t12 = 1.D0+0.4D-2*t10
      t16 = sigmaaa**2
      t17 = t6**2
      t22 = t12**2
      t29 = rhob**(1.D0/3.D0)
      t31 = rhob**2
      t32 = t29**2
      t35 = sigmabb/t32/t31
      t37 = 1.D0+0.4D-2*t35
      t41 = sigmabb**2
      t42 = t31**2
      t47 = t37**2
      zk(i) = -0.9305257363491D0*t4*rhoa*(0.8094D0+0.20292D-2*t10/t12
     #+0.119696D-4*t16/t4/t17/rhoa/t22)-0.9305257363491D0*t29*rhob*
     #(0.8094D0+0.20292D-2*t35/t37+0.119696D-4*t41/t29/t42/rhob/t47)
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t3 = t2*rhob
      t4 = rhob**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigmabb*t7
      t10 = 1.D0+0.4D-2*t8
      t11 = 1/t10
      t14 = sigmabb**2
      t15 = t4**2
      t18 = 1/t2/t15/rhob
      t20 = t10**2
      t21 = 1/t20
      t24 = 0.8094D0+0.20292D-2*t8*t11+0.119696D-4*t14*t18*t21
      zk(i) = -0.9305257363491D0*t3*t24
      vrhoa(i) = 0.D0
      t42 = t15**2
      t47 = 1/t20/t10
      vrhob(i) = -0.12407009817988D1*t2*t24-0.9305257363491D0*t3*(
     #-0.54112D-2*sigmabb/t5/t4/rhob*t11-0.4219306666666667D-4*t14/t2
     #/t15/t4*t21+0.2553514666666667D-6*t14*sigmabb/t42/rhob*t47)
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      vsigmabb(i) = -0.9305257363491D0*t3*(0.20292D-2*t7*t11
     #+0.158224D-4*sigmabb*t18*t21-0.957568D-7*t14/t42*t47)
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t3 = t2*rhoa
      t4 = rhoa**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigmaaa*t7
      t10 = 1.D0+0.4D-2*t8
      t11 = 1/t10
      t14 = sigmaaa**2
      t15 = t4**2
      t18 = 1/t2/t15/rhoa
      t20 = t10**2
      t21 = 1/t20
      t24 = 0.8094D0+0.20292D-2*t8*t11+0.119696D-4*t14*t18*t21
      zk(i) = -0.9305257363491D0*t3*t24
      t42 = t15**2
      t47 = 1/t20/t10
      vrhoa(i) = -0.12407009817988D1*t2*t24-0.9305257363491D0*t3*(
     #-0.54112D-2*sigmaaa/t5/t4/rhoa*t11-0.4219306666666667D-4*t14/t2
     #/t15/t4*t21+0.2553514666666667D-6*t14*sigmaaa/t42/rhoa*t47)
      vrhob(i) = 0.D0
      vsigmaaa(i) = -0.9305257363491D0*t3*(0.20292D-2*t7*t11
     #+0.158224D-4*sigmaaa*t18*t21-0.957568D-7*t14/t42*t47)
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t5 = t4*rhoa
      t6 = rhoa**2
      t7 = t4**2
      t9 = 1/t7/t6
      t10 = sigmaaa*t9
      t12 = 1.D0+0.4D-2*t10
      t13 = 1/t12
      t16 = sigmaaa**2
      t17 = t6**2
      t20 = 1/t4/t17/rhoa
      t22 = t12**2
      t23 = 1/t22
      t26 = 0.8094D0+0.20292D-2*t10*t13+0.119696D-4*t16*t20*t23
      t29 = rhob**(1.D0/3.D0)
      t30 = t29*rhob
      t31 = rhob**2
      t32 = t29**2
      t34 = 1/t32/t31
      t35 = sigmabb*t34
      t37 = 1.D0+0.4D-2*t35
      t38 = 1/t37
      t41 = sigmabb**2
      t42 = t31**2
      t45 = 1/t29/t42/rhob
      t47 = t37**2
      t48 = 1/t47
      t51 = 0.8094D0+0.20292D-2*t35*t38+0.119696D-4*t41*t45*t48
      zk(i) = -0.9305257363491D0*t5*t26-0.9305257363491D0*t30*t51
      t69 = t17**2
      t74 = 1/t22/t12
      vrhoa(i) = -0.12407009817988D1*t4*t26-0.9305257363491D0*t5*(
     #-0.54112D-2*sigmaaa/t7/t6/rhoa*t13-0.4219306666666667D-4*t16/t4
     #/t17/t6*t23+0.2553514666666667D-6*t16*sigmaaa/t69/rhoa*t74)
      t95 = t42**2
      t100 = 1/t47/t37
      vrhob(i) = -0.12407009817988D1*t29*t51-0.9305257363491D0*t30*(
     #-0.54112D-2*sigmabb/t32/t31/rhob*t38-0.4219306666666667D-4*t41
     #/t29/t42/t31*t48+0.2553514666666667D-6*t41*sigmabb/t95/rhob*t100)
      vsigmaaa(i) = -0.9305257363491D0*t5*(0.20292D-2*t9*t13
     #+0.158224D-4*sigmaaa*t20*t23-0.957568D-7*t16/t69*t74)
      vsigmaab(i) = 0.D0
      vsigmabb(i) = -0.9305257363491D0*t30*(0.20292D-2*t34*t38
     #+0.158224D-4*sigmabb*t45*t48-0.957568D-7*t41/t95*t100)
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t3 = t2*rhob
      t4 = rhob**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigmabb*t7
      t10 = 1.D0+0.4D-2*t8
      t11 = 1/t10
      t14 = sigmabb**2
      t15 = t4**2
      t18 = 1/t2/t15/rhob
      t20 = t10**2
      t21 = 1/t20
      t24 = 0.8094D0+0.20292D-2*t8*t11+0.119696D-4*t14*t18*t21
      zk(i) = -0.9305257363491D0*t3*t24
      vrhoa(i) = 0.D0
      t29 = t4*rhob
      t41 = t14*sigmabb
      t42 = t15**2
      t47 = 1/t20/t10
      t50 = -0.54112D-2*sigmabb/t5/t29*t11-0.4219306666666667D-4*t14
     #/t2/t15/t4*t21+0.2553514666666667D-6*t41/t42/rhob*t47
      vrhob(i) = -0.12407009817988D1*t2*t24-0.9305257363491D0*t3*t50
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      t58 = 1/t42
      vsigmabb(i) = -0.9305257363491D0*t3*(0.20292D-2*t7*t11
     #+0.158224D-4*sigmabb*t18*t21-0.957568D-7*t14*t58*t47)
      v2rhoa2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t81 = t42*t4
      t86 = t14**2
      t91 = t20**2
      t92 = 1/t91
      v2rhob2(i) = -0.4135669939329333D0/t5*t24-0.24814019635976D1*t2
     #*t50-0.9305257363491D0*t3*(0.1984106666666667D-1*sigmabb/t5/t15
     #*t11+0.2095032888888889D-3*t14/t2/t15/t29*t21
     #-0.3198281955555556D-5*t41/t81*t47+0.8171246933333333D-8*t86/t5
     #/t42/t15*t92)
      v2sigmaaa2(i) = 0.D0
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      v2sigmabb2(i) = -0.9305257363491D0*t3*(0.77056D-5*t18*t21
     #-0.3180928D-6*sigmabb*t58*t47+0.11490816D-8*t14/t5/t81*t92)
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t3 = t2*rhoa
      t4 = rhoa**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigmaaa*t7
      t10 = 1.D0+0.4D-2*t8
      t11 = 1/t10
      t14 = sigmaaa**2
      t15 = t4**2
      t18 = 1/t2/t15/rhoa
      t20 = t10**2
      t21 = 1/t20
      t24 = 0.8094D0+0.20292D-2*t8*t11+0.119696D-4*t14*t18*t21
      zk(i) = -0.9305257363491D0*t3*t24
      t29 = t4*rhoa
      t41 = t14*sigmaaa
      t42 = t15**2
      t47 = 1/t20/t10
      t50 = -0.54112D-2*sigmaaa/t5/t29*t11-0.4219306666666667D-4*t14
     #/t2/t15/t4*t21+0.2553514666666667D-6*t41/t42/rhoa*t47
      vrhoa(i) = -0.12407009817988D1*t2*t24-0.9305257363491D0*t3*t50
      vrhob(i) = 0.D0
      t58 = 1/t42
      vsigmaaa(i) = -0.9305257363491D0*t3*(0.20292D-2*t7*t11
     #+0.158224D-4*sigmaaa*t18*t21-0.957568D-7*t14*t58*t47)
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      t81 = t42*t4
      t86 = t14**2
      t91 = t20**2
      t92 = 1/t91
      v2rhoa2(i) = -0.4135669939329333D0/t5*t24-0.24814019635976D1*t2
     #*t50-0.9305257363491D0*t3*(0.1984106666666667D-1*sigmaaa/t5/t15
     #*t11+0.2095032888888889D-3*t14/t2/t15/t29*t21
     #-0.3198281955555556D-5*t41/t81*t47+0.8171246933333333D-8*t86/t5
     #/t42/t15*t92)
      v2rhob2(i) = 0.D0
      v2rhoab(i) = 0.D0
      v2sigmaaa2(i) = -0.9305257363491D0*t3*(0.77056D-5*t18*t21
     #-0.3180928D-6*sigmaaa*t58*t47+0.11490816D-8*t14/t5/t81*t92)
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      v2sigmabb2(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t5 = t4*rhoa
      t6 = rhoa**2
      t7 = t4**2
      t9 = 1/t7/t6
      t10 = sigmaaa*t9
      t12 = 1.D0+0.4D-2*t10
      t13 = 1/t12
      t16 = sigmaaa**2
      t17 = t6**2
      t20 = 1/t4/t17/rhoa
      t22 = t12**2
      t23 = 1/t22
      t26 = 0.8094D0+0.20292D-2*t10*t13+0.119696D-4*t16*t20*t23
      t29 = rhob**(1.D0/3.D0)
      t30 = t29*rhob
      t31 = rhob**2
      t32 = t29**2
      t34 = 1/t32/t31
      t35 = sigmabb*t34
      t37 = 1.D0+0.4D-2*t35
      t38 = 1/t37
      t41 = sigmabb**2
      t42 = t31**2
      t45 = 1/t29/t42/rhob
      t47 = t37**2
      t48 = 1/t47
      t51 = 0.8094D0+0.20292D-2*t35*t38+0.119696D-4*t41*t45*t48
      zk(i) = -0.9305257363491D0*t5*t26-0.9305257363491D0*t30*t51
      t56 = t6*rhoa
      t58 = 1/t7/t56
      t64 = 1/t4/t17/t6
      t68 = t16*sigmaaa
      t69 = t17**2
      t71 = 1/t69/rhoa
      t74 = 1/t22/t12
      t77 = -0.54112D-2*sigmaaa*t58*t13-0.4219306666666667D-4*t16*t64
     #*t23+0.2553514666666667D-6*t68*t71*t74
      vrhoa(i) = -0.12407009817988D1*t4*t26-0.9305257363491D0*t5*t77
      t82 = t31*rhob
      t84 = 1/t32/t82
      t90 = 1/t29/t42/t31
      t94 = t41*sigmabb
      t95 = t42**2
      t97 = 1/t95/rhob
      t100 = 1/t47/t37
      t103 = -0.54112D-2*sigmabb*t84*t38-0.4219306666666667D-4*t41*t90
     #*t48+0.2553514666666667D-6*t94*t97*t100
      vrhob(i) = -0.12407009817988D1*t29*t51-0.9305257363491D0*t30*t103
      t111 = 1/t69
      t115 = 0.20292D-2*t9*t13+0.158224D-4*sigmaaa*t20*t23-0.957568D-7
     #*t16*t111*t74
      vsigmaaa(i) = -0.9305257363491D0*t5*t115
      vsigmaab(i) = 0.D0
      t123 = 1/t95
      t127 = 0.20292D-2*t34*t38+0.158224D-4*sigmabb*t45*t48
     #-0.957568D-7*t41*t123*t100
      vsigmabb(i) = -0.9305257363491D0*t30*t127
      t146 = t69*t6
      t151 = t16**2
      t156 = t22**2
      t157 = 1/t156
      v2rhoa2(i) = -0.4135669939329333D0/t7*t26-0.24814019635976D1*t4
     #*t77-0.9305257363491D0*t5*(0.1984106666666667D-1*sigmaaa/t7/t17
     #*t13+0.2095032888888889D-3*t16/t4/t17/t56*t23
     #-0.3198281955555556D-5*t68/t146*t74+0.8171246933333333D-8*t151
     #/t7/t69/t17*t157)
      t179 = t95*t31
      t184 = t41**2
      t189 = t47**2
      t190 = 1/t189
      v2rhob2(i) = -0.4135669939329333D0/t32*t51-0.24814019635976D1
     #*t29*t103-0.9305257363491D0*t30*(0.1984106666666667D-1*sigmabb
     #/t32/t42*t38+0.2095032888888889D-3*t41/t29/t42/t82*t48
     #-0.3198281955555556D-5*t94/t179*t100+0.8171246933333333D-8*t184
     #/t32/t95/t42*t190)
      v2rhoab(i) = 0.D0
      v2rhoasigmaaa(i) = -0.12407009817988D1*t4*t115-0.9305257363491D0
     #*t5*(-0.54112D-2*t58*t13-0.6274133333333333D-4*sigmaaa*t64*t23
     #+0.1103598933333333D-5*t16*t71*t74-0.30642176D-8*t68/t7/t69/t56
     #*t157)
      v2rhoasigmaab(i) = 0.D0
      v2rhoasigmabb(i) = 0.D0
      v2rhobsigmaaa(i) = 0.D0
      v2rhobsigmaab(i) = 0.D0
      v2rhobsigmabb(i) = -0.12407009817988D1*t29*t127
     #-0.9305257363491D0*t30*(-0.54112D-2*t84*t38
     #-0.6274133333333333D-4*sigmabb*t90*t48+0.1103598933333333D-5*t41
     #*t97*t100-0.30642176D-8*t94/t32/t95/t82*t190)
      v2sigmaaa2(i) = -0.9305257363491D0*t5*(0.77056D-5*t20*t23
     #-0.3180928D-6*sigmaaa*t111*t74+0.11490816D-8*t16/t7/t146*t157)
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      v2sigmabb2(i) = -0.9305257363491D0*t30*(0.77056D-5*t45*t48
     #-0.3180928D-6*sigmabb*t123*t100+0.11490816D-8*t41/t32/t179*t190)
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      v2rhob2(i) = 0.0d0
      v2rhoab(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2rhoasigmaab(i) = 0.0d0
      v2rhoasigmabb(i) = 0.0d0
      v2rhobsigmaaa(i) = 0.0d0
      v2rhobsigmaab(i) = 0.0d0
      v2rhobsigmabb(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      v2sigmaab2(i) = 0.0d0
      v2sigmabb2(i) = 0.0d0
      v2sigmaaaab(i) = 0.0d0
      v2sigmaaabb(i) = 0.0d0
      v2sigmaabbb(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end
      
      
      subroutine rks_x_b97
     & (ideriv,npt,rhoa1,sigmaaa1,
     &  zk,vrhoa,vsigmaaa,
     &  v2rhoa2,v2rhoasigmaaa,v2sigmaaa2)
c
c     A.D. Becke
c     Density-functional thermochemistry. V. Systematic optimization of
c     exchange-correlation functionals
c     J. Chem. Phys. 107 (1997) 8554-8560
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt)
      REAL sigmaaa1(npt)
      REAL zk(npt),vrhoa(npt),vsigmaaa(npt)
      REAL v2rhoa2(npt),v2rhoasigmaaa(npt),v2sigmaaa2(npt)
      parameter(tol=1.0d-20)
      
      if(ideriv.eq.0) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t4 = rho**2
      t5 = t2**2
      t8 = sigma/t5/t4
      t10 = 1.D0+0.6349604207872798D-2*t8
      t14 = sigma**2
      t15 = t4**2
      t20 = t10**2
      zk(i) = -0.7385587663820224D0*t2*rho*(0.8094D0
     #+0.322115421465387D-2*t8/t10+0.3016150199764335D-4*t14/t2/t15
     #/rho/t20)
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t3 = t2*rho
      t4 = rho**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigma*t7
      t10 = 1.D0+0.6349604207872798D-2*t8
      t11 = 1/t10
      t14 = sigma**2
      t15 = t4**2
      t18 = 1/t2/t15/rho
      t20 = t10**2
      t21 = 1/t20
      t24 = 0.8094D0+0.322115421465387D-2*t8*t11+0.3016150199764335D-4
     #*t14*t18*t21
      zk(i) = -0.7385587663820224D0*t3*t24
      t42 = t15**2
      t47 = 1/t20/t10
      vrhoa(i) = -0.9847450218426965D0*t2*t24-0.3692793831910112D0*t3*
     #(-0.1717948914482064D-1*sigma/t5/t4/rho*t11
     #-0.2126397314118042D-3*t14/t2/t15/t4*t21+0.2042811733333333D-5
     #*t14*sigma/t42/rho*t47)
      vsigmaaa(i) = -0.7385587663820224D0*t3*(0.1288461685861548D-1*t7
     #*t11+0.1594797985588531D-3*sigma*t18*t21-0.15321088D-5*t14/t42
     #*t47)
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t3 = t2*rho
      t4 = rho**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigma*t7
      t10 = 1.D0+0.6349604207872798D-2*t8
      t11 = 1/t10
      t14 = sigma**2
      t15 = t4**2
      t18 = 1/t2/t15/rho
      t20 = t10**2
      t21 = 1/t20
      t24 = 0.8094D0+0.322115421465387D-2*t8*t11+0.3016150199764335D-4
     #*t14*t18*t21
      zk(i) = -0.7385587663820224D0*t3*t24
      t29 = t4*rho
      t31 = 1/t5/t29
      t37 = 1/t2/t15/t4
      t41 = t14*sigma
      t42 = t15**2
      t44 = 1/t42/rho
      t47 = 1/t20/t10
      t50 = -0.1717948914482064D-1*sigma*t31*t11-0.2126397314118042D-3
     #*t14*t37*t21+0.2042811733333333D-5*t41*t44*t47
      vrhoa(i) = -0.9847450218426965D0*t2*t24-0.3692793831910112D0*t3
     #*t50
      t58 = 1/t42
      t62 = 0.1288461685861548D-1*t7*t11+0.1594797985588531D-3*sigma
     #*t18*t21-0.15321088D-5*t14*t58*t47
      vsigmaaa(i) = -0.7385587663820224D0*t3*t62
      t81 = t42*t4
      t86 = t14**2
      t91 = t20**2
      t92 = 1/t91
      v2rhoa2(i) = -0.6564966812284644D0/t5*t24-0.1969490043685393D1
     #*t2*t50-0.3692793831910112D0*t3*(0.1259829203953514D0*sigma/t5
     #/t15*t11+0.2111660829546542D-2*t14/t2/t15/t29*t21
     #-0.5117251128888889D-4*t41/t81*t47+0.2075367356458441D-6*t86/t5
     #/t42/t15*t92)
      v2rhoasigmaaa(i) = -0.9847450218426965D0*t2*t62
     #-0.3692793831910112D0*t3*(-0.6871795657928257D-1*t31*t11
     #-0.1264786025042201D-2*sigma*t37*t21+0.3531516586666667D-4*t14
     #*t44*t47-0.1556525517343831D-6*t41/t5/t42/t29*t92)
      v2sigmaaa2(i) = -0.7385587663820224D0*t3*(0.3106703245462379D-3
     #*t18*t21-0.203579392D-4*sigma*t58*t47+0.1167394138007873D-6*t14
     #/t5/t81*t92)
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end

c:X_B97subrend
_ENDIF
_IF(ccpdft,all,xc_b97)
c:XC_B97subrstart

c    Generated: Tue Jul 22 14:39:42 GMT 2003

      subroutine uks_xc_b97
     & (ideriv,npt,rhoa1,rhob1,sigmaaa1,sigmabb1,sigmaab1,
     &  zk,vrhoa,vrhob,vsigmaaa,vsigmabb,vsigmaab,
     &  v2rhoa2,v2rhob2,v2rhoab,
     &  v2rhoasigmaaa,v2rhoasigmaab,v2rhoasigmabb,
     &  v2rhobsigmabb,v2rhobsigmaab,v2rhobsigmaaa,
     &  v2sigmaaa2,v2sigmaaaab,v2sigmaaabb,
     &  v2sigmaab2,v2sigmaabbb,v2sigmabb2)
c
c     A.D. Becke
c     Density-functional thermochemistry. V. Systematic optimization of
c     exchange-correlation functionals
c     J. Chem. Phys. 107 (1997) 8554-8560
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt),rhob1(npt)
      REAL sigmaaa1(npt),sigmabb1(npt),sigmaab1(npt)
      REAL zk(npt),vrhoa(npt),vrhob(npt)
      REAL vsigmaaa(npt),vsigmabb(npt),vsigmaab(npt)
      REAL v2rhoa2(npt),v2rhob2(npt),v2rhoab(npt)
      REAL v2rhoasigmaaa(npt),v2rhoasigmaab(npt)
      REAL v2rhoasigmabb(npt),v2rhobsigmabb(npt)
      REAL v2rhobsigmaab(npt),v2rhobsigmaaa(npt)
      REAL v2sigmaaa2(npt),v2sigmaaaab(npt),v2sigmaaabb(npt)
      REAL v2sigmaab2(npt),v2sigmaabbb(npt),v2sigmabb2(npt)
      parameter(tol=1.0d-20)
      
      if (ideriv.eq.0) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t4 = rhob**2
      t5 = t2**2
      t8 = sigmabb/t5/t4
      t10 = 1.D0+0.4D-2*t8
      t14 = sigmabb**2
      t15 = t4**2
      t19 = t14/t2/t15/rhob
      t20 = t10**2
      t27 = 1/rhob
      t28 = t27**(1.D0/3.D0)
      t32 = t27**(1.D0/6.D0)
      t35 = dsqrt(t27)
      t37 = t28**2
      t43 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t32
     #+0.3844746237447211D1*t28+0.1644733775567609D1*t35
     #+0.2405871291288192D0*t37))
      t45 = 1.D0+0.2D0*t8
      t49 = t45**2
      zk(i) = -0.9305257363491D0*t2*rhob*(0.8094D0+0.20292D-2*t8/t10
     #+0.119696D-4*t19/t20)-0.3109D-1*rhob*(1.D0+0.1274696188700087D0
     #*t28)*t43*(0.1737D0+0.46974D0*t8/t45-0.99472D-1*t19/t49)
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t4 = rhoa**2
      t5 = t2**2
      t8 = sigmaaa/t5/t4
      t10 = 1.D0+0.4D-2*t8
      t14 = sigmaaa**2
      t15 = t4**2
      t19 = t14/t2/t15/rhoa
      t20 = t10**2
      t27 = 1/rhoa
      t28 = t27**(1.D0/3.D0)
      t32 = t27**(1.D0/6.D0)
      t35 = dsqrt(t27)
      t37 = t28**2
      t43 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t32
     #+0.3844746237447211D1*t28+0.1644733775567609D1*t35
     #+0.2405871291288192D0*t37))
      t45 = 1.D0+0.2D0*t8
      t49 = t45**2
      zk(i) = -0.9305257363491D0*t2*rhoa*(0.8094D0+0.20292D-2*t8/t10
     #+0.119696D-4*t19/t20)-0.3109D-1*rhoa*(1.D0+0.1274696188700087D0
     #*t28)*t43*(0.1737D0+0.46974D0*t8/t45-0.99472D-1*t19/t49)
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t6 = rhoa**2
      t7 = t4**2
      t10 = sigmaaa/t7/t6
      t12 = 1.D0+0.4D-2*t10
      t16 = sigmaaa**2
      t17 = t6**2
      t21 = t16/t4/t17/rhoa
      t22 = t12**2
      t29 = 1/rhoa
      t30 = t29**(1.D0/3.D0)
      t33 = rhoa*(1.D0+0.1274696188700087D0*t30)
      t34 = t29**(1.D0/6.D0)
      t37 = dsqrt(t29)
      t39 = t30**2
      t45 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t34
     #+0.3844746237447211D1*t30+0.1644733775567609D1*t37
     #+0.2405871291288192D0*t39))
      t47 = 1.D0+0.2D0*t10
      t51 = t47**2
      t59 = rhob**(1.D0/3.D0)
      t61 = rhob**2
      t62 = t59**2
      t65 = sigmabb/t62/t61
      t67 = 1.D0+0.4D-2*t65
      t71 = sigmabb**2
      t72 = t61**2
      t76 = t71/t59/t72/rhob
      t77 = t67**2
      t84 = 1/rhob
      t85 = t84**(1.D0/3.D0)
      t88 = rhob*(1.D0+0.1274696188700087D0*t85)
      t89 = t84**(1.D0/6.D0)
      t92 = dsqrt(t84)
      t94 = t85**2
      t100 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t89
     #+0.3844746237447211D1*t85+0.1644733775567609D1*t92
     #+0.2405871291288192D0*t94))
      t102 = 1.D0+0.2D0*t65
      t106 = t102**2
      t114 = rhoa+rhob
      t115 = 1/t114
      t116 = t115**(1.D0/3.D0)
      t119 = t115**(1.D0/6.D0)
      t122 = dsqrt(t115)
      t124 = t116**2
      t130 = dlog(1.D0+0.160818243221511D2/(0.598255043577108D1*t119
     #+0.2225569421150687D1*t116+0.8004286349993634D0*t122
     #+0.1897004325747559D0*t124))
      t132 = 0.62182D-1*(1.D0+0.1325688999052018D0*t116)*t130
      t143 = dlog(1.D0+0.2960857464321668D2/(0.8157414703487641D1*t119
     #+0.2247591863577616D1*t116+0.4300972471276643D0*t122
     #+0.1911512595127338D0*t124))
      t146 = rhoa-1.D0*rhob
      t147 = t146*t115
      t148 = 1.D0+t147
      t149 = t148**(1.D0/3.D0)
      t152 = 1.D0-1.D0*t147
      t153 = t152**(1.D0/3.D0)
      t155 = t149*t148+t153*t152-2.D0
      t156 = t146**2
      t157 = t156**2
      t158 = t114**2
      t159 = t158**2
      t161 = t157/t159
      t177 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t119
     #+0.3844746237447211D1*t116+0.1644733775567609D1*t122
     #+0.2405871291288192D0*t124))
      t193 = 0.5D0*t10+0.5D0*t65
      t196 = 1.D0+0.3D-2*t10+0.3D-2*t65
      t200 = t193**2
      t201 = t196**2
      zk(i) = -0.9305257363491D0*t4*rhoa*(0.8094D0+0.20292D-2*t10/t12
     #+0.119696D-4*t21/t22)-0.3109D-1*t33*t45*(0.1737D0+0.46974D0*t10
     #/t47-0.99472D-1*t21/t51)-0.9305257363491D0*t59*rhob*(0.8094D0
     #+0.20292D-2*t65/t67+0.119696D-4*t76/t77)-0.3109D-1*t88*t100*
     #(0.1737D0+0.46974D0*t65/t102-0.99472D-1*t76/t106)+(t114*(-t132
     #+0.3799574853701528D-1*(1.D0+0.6901399211255825D-1*t116)*t143
     #*t155*(1.D0-1.D0*t161)+0.1923661050931536D1*(-0.3109D-1*(1.D0
     #+0.1274696188700087D0*t116)*t177+t132)*t155*t161)+0.3109D-1*t33
     #*t45+0.3109D-1*t88*t100)*(0.9454D0+0.44826D-2*t193/t196
     #-0.1654596D-3*t200/t201)
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t3 = t2*rhob
      t4 = rhob**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigmabb*t7
      t10 = 1.D0+0.4D-2*t8
      t11 = 1/t10
      t14 = sigmabb**2
      t15 = t4**2
      t18 = 1/t2/t15/rhob
      t19 = t14*t18
      t20 = t10**2
      t21 = 1/t20
      t24 = 0.8094D0+0.20292D-2*t8*t11+0.119696D-4*t19*t21
      t27 = 1/rhob
      t28 = t27**(1.D0/3.D0)
      t30 = 1.D0+0.1274696188700087D0*t28
      t31 = rhob*t30
      t32 = t27**(1.D0/6.D0)
      t35 = dsqrt(t27)
      t37 = t28**2
      t39 = 0.1112037486309468D2*t32+0.3844746237447211D1*t28
     #+0.1644733775567609D1*t35+0.2405871291288192D0*t37
      t42 = 1.D0+0.321646831778707D2/t39
      t43 = dlog(t42)
      t45 = 1.D0+0.2D0*t8
      t46 = 1/t45
      t49 = t45**2
      t50 = 1/t49
      t53 = 0.1737D0+0.46974D0*t8*t46-0.99472D-1*t19*t50
      t54 = t43*t53
      zk(i) = -0.9305257363491D0*t3*t24-0.3109D-1*t31*t54
      vrhoa(i) = 0.D0
      t62 = sigmabb/t5/t4/rhob
      t68 = t14/t2/t15/t4
      t72 = t15**2
      t75 = t14*sigmabb/t72/rhob
      t77 = 1/t20/t10
      t86 = 1/t37
      t90 = t39**2
      t93 = t32**2
      t94 = t93**2
      t97 = 1/t4
      t119 = 1/t49/t45
      vrhob(i) = -0.12407009817988D1*t2*t24-0.9305257363491D0*t3*(
     #-0.54112D-2*t62*t11-0.4219306666666667D-4*t68*t21
     #+0.2553514666666667D-6*t75*t77)-0.3109D-1*t30*t43*t53
     #+0.1321010150222857D-2*t27*t86*t54+0.1D1*t31/t90*(
     #-0.1853395810515781D1/t94/t32*t97-0.128158207914907D1*t86*t97
     #-0.8223668877838045D0/t35*t97-0.1603914194192128D0/t28*t97)/t42
     #*t53-0.3109D-1*t31*t43*(-0.125264D1*t62*t46+0.7810453333333333D0
     #*t68*t50-0.1061034666666667D0*t75*t119)
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      t128 = sigmabb*t18
      t132 = t14/t72
      vsigmabb(i) = -0.9305257363491D0*t3*(0.20292D-2*t7*t11
     #+0.158224D-4*t128*t21-0.957568D-7*t132*t77)-0.3109D-1*t31*t43*
     #(0.46974D0*t7*t46-0.292892D0*t128*t50+0.397888D-1*t132*t119)
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t3 = t2*rhoa
      t4 = rhoa**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigmaaa*t7
      t10 = 1.D0+0.4D-2*t8
      t11 = 1/t10
      t14 = sigmaaa**2
      t15 = t4**2
      t18 = 1/t2/t15/rhoa
      t19 = t14*t18
      t20 = t10**2
      t21 = 1/t20
      t24 = 0.8094D0+0.20292D-2*t8*t11+0.119696D-4*t19*t21
      t27 = 1/rhoa
      t28 = t27**(1.D0/3.D0)
      t30 = 1.D0+0.1274696188700087D0*t28
      t31 = rhoa*t30
      t32 = t27**(1.D0/6.D0)
      t35 = dsqrt(t27)
      t37 = t28**2
      t39 = 0.1112037486309468D2*t32+0.3844746237447211D1*t28
     #+0.1644733775567609D1*t35+0.2405871291288192D0*t37
      t42 = 1.D0+0.321646831778707D2/t39
      t43 = dlog(t42)
      t45 = 1.D0+0.2D0*t8
      t46 = 1/t45
      t49 = t45**2
      t50 = 1/t49
      t53 = 0.1737D0+0.46974D0*t8*t46-0.99472D-1*t19*t50
      t54 = t43*t53
      zk(i) = -0.9305257363491D0*t3*t24-0.3109D-1*t31*t54
      t62 = sigmaaa/t5/t4/rhoa
      t68 = t14/t2/t15/t4
      t72 = t15**2
      t75 = t14*sigmaaa/t72/rhoa
      t77 = 1/t20/t10
      t86 = 1/t37
      t90 = t39**2
      t93 = t32**2
      t94 = t93**2
      t97 = 1/t4
      t119 = 1/t49/t45
      vrhoa(i) = -0.12407009817988D1*t2*t24-0.9305257363491D0*t3*(
     #-0.54112D-2*t62*t11-0.4219306666666667D-4*t68*t21
     #+0.2553514666666667D-6*t75*t77)-0.3109D-1*t30*t43*t53
     #+0.1321010150222857D-2*t27*t86*t54+0.1D1*t31/t90*(
     #-0.1853395810515781D1/t94/t32*t97-0.128158207914907D1*t86*t97
     #-0.8223668877838045D0/t35*t97-0.1603914194192128D0/t28*t97)/t42
     #*t53-0.3109D-1*t31*t43*(-0.125264D1*t62*t46+0.7810453333333333D0
     #*t68*t50-0.1061034666666667D0*t75*t119)
      vrhob(i) = 0.D0
      t128 = sigmaaa*t18
      t132 = t14/t72
      vsigmaaa(i) = -0.9305257363491D0*t3*(0.20292D-2*t7*t11
     #+0.158224D-4*t128*t21-0.957568D-7*t132*t77)-0.3109D-1*t31*t43*
     #(0.46974D0*t7*t46-0.292892D0*t128*t50+0.397888D-1*t132*t119)
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t5 = t4*rhoa
      t6 = rhoa**2
      t7 = t4**2
      t9 = 1/t7/t6
      t10 = sigmaaa*t9
      t12 = 1.D0+0.4D-2*t10
      t13 = 1/t12
      t16 = sigmaaa**2
      t17 = t6**2
      t20 = 1/t4/t17/rhoa
      t21 = t16*t20
      t22 = t12**2
      t23 = 1/t22
      t26 = 0.8094D0+0.20292D-2*t10*t13+0.119696D-4*t21*t23
      t29 = 1/rhoa
      t30 = t29**(1.D0/3.D0)
      t32 = 1.D0+0.1274696188700087D0*t30
      t33 = rhoa*t32
      t34 = t29**(1.D0/6.D0)
      t37 = dsqrt(t29)
      t39 = t30**2
      t41 = 0.1112037486309468D2*t34+0.3844746237447211D1*t30
     #+0.1644733775567609D1*t37+0.2405871291288192D0*t39
      t44 = 1.D0+0.321646831778707D2/t41
      t45 = dlog(t44)
      t47 = 1.D0+0.2D0*t10
      t48 = 1/t47
      t51 = t47**2
      t52 = 1/t51
      t55 = 0.1737D0+0.46974D0*t10*t48-0.99472D-1*t21*t52
      t56 = t45*t55
      t59 = rhob**(1.D0/3.D0)
      t60 = t59*rhob
      t61 = rhob**2
      t62 = t59**2
      t64 = 1/t62/t61
      t65 = sigmabb*t64
      t67 = 1.D0+0.4D-2*t65
      t68 = 1/t67
      t71 = sigmabb**2
      t72 = t61**2
      t75 = 1/t59/t72/rhob
      t76 = t71*t75
      t77 = t67**2
      t78 = 1/t77
      t81 = 0.8094D0+0.20292D-2*t65*t68+0.119696D-4*t76*t78
      t84 = 1/rhob
      t85 = t84**(1.D0/3.D0)
      t87 = 1.D0+0.1274696188700087D0*t85
      t88 = rhob*t87
      t89 = t84**(1.D0/6.D0)
      t92 = dsqrt(t84)
      t94 = t85**2
      t96 = 0.1112037486309468D2*t89+0.3844746237447211D1*t85
     #+0.1644733775567609D1*t92+0.2405871291288192D0*t94
      t99 = 1.D0+0.321646831778707D2/t96
      t100 = dlog(t99)
      t102 = 1.D0+0.2D0*t65
      t103 = 1/t102
      t106 = t102**2
      t107 = 1/t106
      t110 = 0.1737D0+0.46974D0*t65*t103-0.99472D-1*t76*t107
      t111 = t100*t110
      t114 = rhoa+rhob
      t115 = 1/t114
      t116 = t115**(1.D0/3.D0)
      t118 = 1.D0+0.1325688999052018D0*t116
      t119 = t115**(1.D0/6.D0)
      t122 = dsqrt(t115)
      t124 = t116**2
      t126 = 0.598255043577108D1*t119+0.2225569421150687D1*t116
     #+0.8004286349993634D0*t122+0.1897004325747559D0*t124
      t129 = 1.D0+0.160818243221511D2/t126
      t130 = dlog(t129)
      t132 = 0.62182D-1*t118*t130
      t134 = 1.D0+0.6901399211255825D-1*t116
      t139 = 0.8157414703487641D1*t119+0.2247591863577616D1*t116
     #+0.4300972471276643D0*t122+0.1911512595127338D0*t124
      t142 = 1.D0+0.2960857464321668D2/t139
      t143 = dlog(t142)
      t144 = t134*t143
      t146 = rhoa-1.D0*rhob
      t147 = t146*t115
      t148 = 1.D0+t147
      t149 = t148**(1.D0/3.D0)
      t152 = 1.D0-1.D0*t147
      t153 = t152**(1.D0/3.D0)
      t155 = t149*t148+t153*t152-2.D0
      t156 = t146**2
      t157 = t156**2
      t158 = t114**2
      t159 = t158**2
      t160 = 1/t159
      t161 = t157*t160
      t163 = 1.D0-1.D0*t161
      t166 = 0.3799574853701528D-1*t144*t155*t163
      t168 = 1.D0+0.1274696188700087D0*t116
      t173 = 0.1112037486309468D2*t119+0.3844746237447211D1*t116
     #+0.1644733775567609D1*t122+0.2405871291288192D0*t124
      t176 = 1.D0+0.321646831778707D2/t173
      t177 = dlog(t176)
      t180 = -0.3109D-1*t168*t177+t132
      t181 = t180*t155
      t183 = 0.1923661050931536D1*t181*t161
      t190 = t114*(-t132+t166+t183)+0.3109D-1*t33*t45+0.3109D-1*t88*t100
      t193 = 0.5D0*t10+0.5D0*t65
      t196 = 1.D0+0.3D-2*t10+0.3D-2*t65
      t197 = 1/t196
      t200 = t193**2
      t201 = t196**2
      t202 = 1/t201
      t205 = 0.9454D0+0.44826D-2*t193*t197-0.1654596D-3*t200*t202
      zk(i) = -0.9305257363491D0*t5*t26-0.3109D-1*t33*t56
     #-0.9305257363491D0*t60*t81-0.3109D-1*t88*t111+t190*t205
      t212 = sigmaaa/t7/t6/rhoa
      t218 = t16/t4/t17/t6
      t222 = t17**2
      t225 = t16*sigmaaa/t222/rhoa
      t227 = 1/t22/t12
      t233 = t32*t45
      t236 = 1/t39
      t237 = t29*t236
      t240 = t41**2
      t241 = 1/t240
      t243 = t34**2
      t244 = t243**2
      t247 = 1/t6
      t258 = -0.1853395810515781D1/t244/t34*t247-0.128158207914907D1
     #*t236*t247-0.8223668877838045D0/t37*t247-0.1603914194192128D0
     #/t30*t247
      t259 = 1/t44
      t269 = 1/t51/t47
      t277 = 1/t158
      t278 = 1/t124*t277
      t279 = t278*t130
      t280 = 0.2747799777968419D-2*t279
      t281 = t126**2
      t284 = t119**2
      t285 = t284**2
      t288 = 1/t285/t119*t277
      t292 = 1/t122*t277
      t295 = 1/t116*t277
      t300 = t118/t281*(-0.99709173929518D0*t288-0.7418564737168958D0
     #*t278-0.4002143174996817D0*t292-0.1264669550498372D0*t295)/t129
      t301 = 0.1D1*t300
      t305 = 0.8740794299481065D-3*t278*t143*t155*t163
      t306 = t139**2
      t319 = 0.1124999956683108D1*t134/t306*(-0.135956911724794D1*t288
     #-0.7491972878592054D0*t278-0.2150486235638321D0*t292
     #-0.1274341730084892D0*t295)/t142*t155*t163
      t320 = t146*t277
      t321 = 1.D0*t320
      t325 = 1.D0*t115
      t329 = 0.1333333333333333D1*t149*(t115-t321)
     #+0.1333333333333333D1*t153*(-t325+t320)
      t334 = t156*t146*t160
      t335 = 4.D0*t334
      t338 = t157/t159/t114
      t339 = 4.D0*t338
      t346 = t173**2
      t363 = 0.1923661050931536D1*(0.1321010150222857D-2*t278*t177
     #+0.1D1*t168/t346*(-0.1853395810515781D1*t288-0.128158207914907D1
     #*t278-0.8223668877838045D0*t292-0.1603914194192128D0*t295)/t176
     #-0.2747799777968419D-2*t279-0.1D1*t300)*t155*t161
      t367 = t181*t334
      t370 = 0.7694644203726145D1*t181*t338
      t384 = t193*t202
      t389 = t200/t201/t196
      vrhoa(i) = -0.12407009817988D1*t4*t26-0.9305257363491D0*t5*(
     #-0.54112D-2*t212*t13-0.4219306666666667D-4*t218*t23
     #+0.2553514666666667D-6*t225*t227)-0.3109D-1*t233*t55
     #+0.1321010150222857D-2*t237*t56+0.1D1*t33*t241*t258*t259*t55
     #-0.3109D-1*t33*t45*(-0.125264D1*t212*t48+0.7810453333333333D0
     #*t218*t52-0.1061034666666667D0*t225*t269)+(-t132+t166+t183+t114*
     #(t280+t301-t305-t319+0.3799574853701528D-1*t144*t329*t163
     #+0.3799574853701528D-1*t144*t155*(-t335+t339)+t363
     #+0.1923661050931536D1*t180*t329*t161+0.7694644203726145D1*t367
     #-t370)+0.3109D-1*t233-0.1321010150222857D-2*t237*t45-0.1D1*t33
     #*t241*t258*t259)*t205+t190*(-0.59768D-2*t212*t197+0.4770864D-3
     #*t384*t212-0.26473536D-5*t389*t212)
      t399 = sigmabb/t62/t61/rhob
      t405 = t71/t59/t72/t61
      t409 = t72**2
      t412 = t71*sigmabb/t409/rhob
      t414 = 1/t77/t67
      t420 = t87*t100
      t423 = 1/t94
      t424 = t84*t423
      t427 = t96**2
      t428 = 1/t427
      t430 = t89**2
      t431 = t430**2
      t434 = 1/t61
      t445 = -0.1853395810515781D1/t431/t89*t434-0.128158207914907D1
     #*t423*t434-0.8223668877838045D0/t92*t434-0.1603914194192128D0
     #/t85*t434
      t446 = 1/t99
      t456 = 1/t106/t102
      t469 = 0.1333333333333333D1*t149*(-t325-t321)
     #+0.1333333333333333D1*t153*(t115+t320)
      s1 = -0.12407009817988D1*t59*t81-0.9305257363491D0*t60*(
     #-0.54112D-2*t399*t68-0.4219306666666667D-4*t405*t78
     #+0.2553514666666667D-6*t412*t414)-0.3109D-1*t420*t110
     #+0.1321010150222857D-2*t424*t111
      vrhob(i) = s1+0.1D1*t88*t428*t445*t446*t110-0.3109D-1*t88*t100*(
     #-0.125264D1*t399*t103+0.7810453333333333D0*t405*t107
     #-0.1061034666666667D0*t412*t456)+(-t132+t166+t183+t114*(t280
     #+t301-t305-t319+0.3799574853701528D-1*t144*t469*t163
     #+0.3799574853701528D-1*t144*t155*(t335+t339)+t363
     #+0.1923661050931536D1*t180*t469*t161-0.7694644203726145D1*t367
     #-t370)+0.3109D-1*t420-0.1321010150222857D-2*t424*t100-0.1D1*t88
     #*t428*t445*t446)*t205+t190*(-0.59768D-2*t399*t197+0.4770864D-3
     #*t384*t399-0.26473536D-5*t389*t399)
      t502 = sigmaaa*t20
      t506 = t16/t222
      vsigmaaa(i) = -0.9305257363491D0*t5*(0.20292D-2*t9*t13
     #+0.158224D-4*t502*t23-0.957568D-7*t506*t227)-0.3109D-1*t33*t45*
     #(0.46974D0*t9*t48-0.292892D0*t502*t52+0.397888D-1*t506*t269)
     #+t190*(0.22413D-2*t9*t197-0.1789074D-3*t384*t9+0.9927576D-6*t389
     #*t9)
      vsigmaab(i) = 0.D0
      t532 = sigmabb*t75
      t536 = t71/t409
      vsigmabb(i) = -0.9305257363491D0*t60*(0.20292D-2*t64*t68
     #+0.158224D-4*t532*t78-0.957568D-7*t536*t414)-0.3109D-1*t88*t100*
     #(0.46974D0*t64*t103-0.292892D0*t532*t107+0.397888D-1*t536*t456)
     #+t190*(0.22413D-2*t64*t197-0.1789074D-3*t384*t64+0.9927576D-6
     #*t389*t64)
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t3 = t2*rhob
      t4 = rhob**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigmabb*t7
      t10 = 1.D0+0.4D-2*t8
      t11 = 1/t10
      t14 = sigmabb**2
      t15 = t4**2
      t18 = 1/t2/t15/rhob
      t19 = t14*t18
      t20 = t10**2
      t21 = 1/t20
      t24 = 0.8094D0+0.20292D-2*t8*t11+0.119696D-4*t19*t21
      t27 = 1/rhob
      t28 = t27**(1.D0/3.D0)
      t30 = 1.D0+0.1274696188700087D0*t28
      t31 = rhob*t30
      t32 = t27**(1.D0/6.D0)
      t35 = dsqrt(t27)
      t37 = t28**2
      t39 = 0.1112037486309468D2*t32+0.3844746237447211D1*t28
     #+0.1644733775567609D1*t35+0.2405871291288192D0*t37
      t42 = 1.D0+0.321646831778707D2/t39
      t43 = dlog(t42)
      t45 = 1.D0+0.2D0*t8
      t46 = 1/t45
      t49 = t45**2
      t50 = 1/t49
      t53 = 0.1737D0+0.46974D0*t8*t46-0.99472D-1*t19*t50
      t54 = t43*t53
      zk(i) = -0.9305257363491D0*t3*t24-0.3109D-1*t31*t54
      vrhoa(i) = 0.D0
      t59 = t4*rhob
      t62 = sigmabb/t5/t59
      t68 = t14/t2/t15/t4
      t71 = t14*sigmabb
      t72 = t15**2
      t75 = t71/t72/rhob
      t77 = 1/t20/t10
      t80 = -0.54112D-2*t62*t11-0.4219306666666667D-4*t68*t21
     #+0.2553514666666667D-6*t75*t77
      t83 = t30*t43
      t86 = 1/t37
      t87 = t27*t86
      t90 = t39**2
      t91 = 1/t90
      t92 = t31*t91
      t93 = t32**2
      t94 = t93**2
      t95 = t94*t32
      t96 = 1/t95
      t97 = 1/t4
      t102 = 1/t35
      t105 = 1/t28
      t108 = -0.1853395810515781D1*t96*t97-0.128158207914907D1*t86*t97
     #-0.8223668877838045D0*t102*t97-0.1603914194192128D0*t105*t97
      t109 = 1/t42
      t110 = t108*t109
      t111 = t110*t53
      t119 = 1/t49/t45
      t122 = -0.125264D1*t62*t46+0.7810453333333333D0*t68*t50
     #-0.1061034666666667D0*t75*t119
      t123 = t43*t122
      vrhob(i) = -0.12407009817988D1*t2*t24-0.9305257363491D0*t3*t80
     #-0.3109D-1*t83*t53+0.1321010150222857D-2*t87*t54+0.1D1*t92*t111
     #-0.3109D-1*t31*t123
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      t128 = sigmabb*t18
      t131 = 1/t72
      t132 = t14*t131
      vsigmabb(i) = -0.9305257363491D0*t3*(0.20292D-2*t7*t11
     #+0.158224D-4*t128*t21-0.957568D-7*t132*t77)-0.3109D-1*t31*t43*
     #(0.46974D0*t7*t46-0.292892D0*t128*t50+0.397888D-1*t132*t119)
      v2rhoa2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t155 = sigmabb/t5/t15
      t161 = t14/t2/t15/t59
      t164 = t72*t4
      t166 = t71/t164
      t169 = t14**2
      t173 = t169/t5/t72/t15
      t174 = t20**2
      t175 = 1/t174
      t186 = 1/t59
      t188 = 1/t37/t27
      t200 = t108**2
      t207 = 1/t15
      t233 = t90**2
      t236 = t42**2
      t251 = t49**2
      t252 = 1/t251
      s1 = -0.4135669939329333D0/t5*t24-0.24814019635976D1*t2*t80
     #-0.9305257363491D0*t3*(0.1984106666666667D-1*t155*t11
     #+0.2095032888888889D-3*t161*t21-0.3198281955555556D-5*t166*t77
     #+0.8171246933333333D-8*t173*t175)+0.2D1*t30*t91*t111-0.6218D-1
     #*t83*t122+0.8806734334819047D-3*t186*t188*t54
      v2rhob2(i) = s1-0.8497974591333914D-1*t87*t91*t111
     #+0.2642020300445714D-2*t87*t123-0.2D1*t31/t90/t39*t200*t109*t53
     #+0.1D1*t92*(-0.1544496508763151D1/t95/t27*t207
     #+0.3706791621031562D1*t96*t186-0.854388052766047D0*t188*t207
     #+0.2563164158298141D1*t86*t186-0.4111834438919023D0/t35/t27*t207
     #+0.1644733775567609D1*t102*t186-0.5346380647307093D-1/t28/t27
     #*t207+0.3207828388384256D0*t105*t186)*t109*t53
     #+0.321646831778707D2*t31/t233*t200/t236*t53+0.2D1*t92*t110*t122
     #-0.3109D-1*t31*t43*(0.4593013333333333D1*t155*t46
     #-0.5614695111111111D1*t161*t50+0.1788046222222222D1*t166*t119
     #-0.1697655466666667D0*t173*t252)
      v2sigmaaa2(i) = 0.D0
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      t261 = sigmabb*t131
      t266 = t14/t5/t164
      v2sigmabb2(i) = -0.9305257363491D0*t3*(0.77056D-5*t18*t21
     #-0.3180928D-6*t261*t77+0.11490816D-8*t266*t175)-0.3109D-1*t31
     #*t43*(-0.38684D0*t18*t50+0.1967344D0*t261*t119-0.2387328D-1*t266
     #*t252)
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t3 = t2*rhoa
      t4 = rhoa**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigmaaa*t7
      t10 = 1.D0+0.4D-2*t8
      t11 = 1/t10
      t14 = sigmaaa**2
      t15 = t4**2
      t18 = 1/t2/t15/rhoa
      t19 = t14*t18
      t20 = t10**2
      t21 = 1/t20
      t24 = 0.8094D0+0.20292D-2*t8*t11+0.119696D-4*t19*t21
      t27 = 1/rhoa
      t28 = t27**(1.D0/3.D0)
      t30 = 1.D0+0.1274696188700087D0*t28
      t31 = rhoa*t30
      t32 = t27**(1.D0/6.D0)
      t35 = dsqrt(t27)
      t37 = t28**2
      t39 = 0.1112037486309468D2*t32+0.3844746237447211D1*t28
     #+0.1644733775567609D1*t35+0.2405871291288192D0*t37
      t42 = 1.D0+0.321646831778707D2/t39
      t43 = dlog(t42)
      t45 = 1.D0+0.2D0*t8
      t46 = 1/t45
      t49 = t45**2
      t50 = 1/t49
      t53 = 0.1737D0+0.46974D0*t8*t46-0.99472D-1*t19*t50
      t54 = t43*t53
      zk(i) = -0.9305257363491D0*t3*t24-0.3109D-1*t31*t54
      t59 = t4*rhoa
      t62 = sigmaaa/t5/t59
      t68 = t14/t2/t15/t4
      t71 = t14*sigmaaa
      t72 = t15**2
      t75 = t71/t72/rhoa
      t77 = 1/t20/t10
      t80 = -0.54112D-2*t62*t11-0.4219306666666667D-4*t68*t21
     #+0.2553514666666667D-6*t75*t77
      t83 = t30*t43
      t86 = 1/t37
      t87 = t27*t86
      t90 = t39**2
      t91 = 1/t90
      t92 = t31*t91
      t93 = t32**2
      t94 = t93**2
      t95 = t94*t32
      t96 = 1/t95
      t97 = 1/t4
      t102 = 1/t35
      t105 = 1/t28
      t108 = -0.1853395810515781D1*t96*t97-0.128158207914907D1*t86*t97
     #-0.8223668877838045D0*t102*t97-0.1603914194192128D0*t105*t97
      t109 = 1/t42
      t110 = t108*t109
      t111 = t110*t53
      t119 = 1/t49/t45
      t122 = -0.125264D1*t62*t46+0.7810453333333333D0*t68*t50
     #-0.1061034666666667D0*t75*t119
      t123 = t43*t122
      vrhoa(i) = -0.12407009817988D1*t2*t24-0.9305257363491D0*t3*t80
     #-0.3109D-1*t83*t53+0.1321010150222857D-2*t87*t54+0.1D1*t92*t111
     #-0.3109D-1*t31*t123
      vrhob(i) = 0.D0
      t128 = sigmaaa*t18
      t131 = 1/t72
      t132 = t14*t131
      vsigmaaa(i) = -0.9305257363491D0*t3*(0.20292D-2*t7*t11
     #+0.158224D-4*t128*t21-0.957568D-7*t132*t77)-0.3109D-1*t31*t43*
     #(0.46974D0*t7*t46-0.292892D0*t128*t50+0.397888D-1*t132*t119)
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      t155 = sigmaaa/t5/t15
      t161 = t14/t2/t15/t59
      t164 = t72*t4
      t166 = t71/t164
      t169 = t14**2
      t173 = t169/t5/t72/t15
      t174 = t20**2
      t175 = 1/t174
      t186 = 1/t59
      t188 = 1/t37/t27
      t200 = t108**2
      t207 = 1/t15
      t233 = t90**2
      t236 = t42**2
      t251 = t49**2
      t252 = 1/t251
      s1 = -0.4135669939329333D0/t5*t24-0.24814019635976D1*t2*t80
     #-0.9305257363491D0*t3*(0.1984106666666667D-1*t155*t11
     #+0.2095032888888889D-3*t161*t21-0.3198281955555556D-5*t166*t77
     #+0.8171246933333333D-8*t173*t175)+0.2D1*t30*t91*t111-0.6218D-1
     #*t83*t122+0.8806734334819047D-3*t186*t188*t54
      v2rhoa2(i) = s1-0.8497974591333914D-1*t87*t91*t111
     #+0.2642020300445714D-2*t87*t123-0.2D1*t31/t90/t39*t200*t109*t53
     #+0.1D1*t92*(-0.1544496508763151D1/t95/t27*t207
     #+0.3706791621031562D1*t96*t186-0.854388052766047D0*t188*t207
     #+0.2563164158298141D1*t86*t186-0.4111834438919023D0/t35/t27*t207
     #+0.1644733775567609D1*t102*t186-0.5346380647307093D-1/t28/t27
     #*t207+0.3207828388384256D0*t105*t186)*t109*t53
     #+0.321646831778707D2*t31/t233*t200/t236*t53+0.2D1*t92*t110*t122
     #-0.3109D-1*t31*t43*(0.4593013333333333D1*t155*t46
     #-0.5614695111111111D1*t161*t50+0.1788046222222222D1*t166*t119
     #-0.1697655466666667D0*t173*t252)
      v2rhob2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t261 = sigmaaa*t131
      t266 = t14/t5/t164
      v2sigmaaa2(i) = -0.9305257363491D0*t3*(0.77056D-5*t18*t21
     #-0.3180928D-6*t261*t77+0.11490816D-8*t266*t175)-0.3109D-1*t31
     #*t43*(-0.38684D0*t18*t50+0.1967344D0*t261*t119-0.2387328D-1*t266
     #*t252)
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      v2sigmabb2(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t5 = t4*rhoa
      t6 = rhoa**2
      t7 = t4**2
      t9 = 1/t7/t6
      t10 = sigmaaa*t9
      t12 = 1.D0+0.4D-2*t10
      t13 = 1/t12
      t16 = sigmaaa**2
      t17 = t6**2
      t20 = 1/t4/t17/rhoa
      t21 = t16*t20
      t22 = t12**2
      t23 = 1/t22
      t26 = 0.8094D0+0.20292D-2*t10*t13+0.119696D-4*t21*t23
      t29 = 1/rhoa
      t30 = t29**(1.D0/3.D0)
      t32 = 1.D0+0.1274696188700087D0*t30
      t33 = rhoa*t32
      t34 = t29**(1.D0/6.D0)
      t37 = dsqrt(t29)
      t39 = t30**2
      t41 = 0.1112037486309468D2*t34+0.3844746237447211D1*t30
     #+0.1644733775567609D1*t37+0.2405871291288192D0*t39
      t44 = 1.D0+0.321646831778707D2/t41
      t45 = dlog(t44)
      t47 = 1.D0+0.2D0*t10
      t48 = 1/t47
      t51 = t47**2
      t52 = 1/t51
      t55 = 0.1737D0+0.46974D0*t10*t48-0.99472D-1*t21*t52
      t56 = t45*t55
      t59 = rhob**(1.D0/3.D0)
      t60 = t59*rhob
      t61 = rhob**2
      t62 = t59**2
      t64 = 1/t62/t61
      t65 = sigmabb*t64
      t67 = 1.D0+0.4D-2*t65
      t68 = 1/t67
      t71 = sigmabb**2
      t72 = t61**2
      t75 = 1/t59/t72/rhob
      t76 = t71*t75
      t77 = t67**2
      t78 = 1/t77
      t81 = 0.8094D0+0.20292D-2*t65*t68+0.119696D-4*t76*t78
      t84 = 1/rhob
      t85 = t84**(1.D0/3.D0)
      t87 = 1.D0+0.1274696188700087D0*t85
      t88 = rhob*t87
      t89 = t84**(1.D0/6.D0)
      t92 = dsqrt(t84)
      t94 = t85**2
      t96 = 0.1112037486309468D2*t89+0.3844746237447211D1*t85
     #+0.1644733775567609D1*t92+0.2405871291288192D0*t94
      t99 = 1.D0+0.321646831778707D2/t96
      t100 = dlog(t99)
      t102 = 1.D0+0.2D0*t65
      t103 = 1/t102
      t106 = t102**2
      t107 = 1/t106
      t110 = 0.1737D0+0.46974D0*t65*t103-0.99472D-1*t76*t107
      t111 = t100*t110
      t114 = rhoa+rhob
      t115 = 1/t114
      t116 = t115**(1.D0/3.D0)
      t118 = 1.D0+0.1325688999052018D0*t116
      t119 = t115**(1.D0/6.D0)
      t122 = dsqrt(t115)
      t124 = t116**2
      t126 = 0.598255043577108D1*t119+0.2225569421150687D1*t116
     #+0.8004286349993634D0*t122+0.1897004325747559D0*t124
      t129 = 1.D0+0.160818243221511D2/t126
      t130 = dlog(t129)
      t132 = 0.62182D-1*t118*t130
      t134 = 1.D0+0.6901399211255825D-1*t116
      t139 = 0.8157414703487641D1*t119+0.2247591863577616D1*t116
     #+0.4300972471276643D0*t122+0.1911512595127338D0*t124
      t142 = 1.D0+0.2960857464321668D2/t139
      t143 = dlog(t142)
      t144 = t134*t143
      t146 = rhoa-1.D0*rhob
      t147 = t146*t115
      t148 = 1.D0+t147
      t149 = t148**(1.D0/3.D0)
      t152 = 1.D0-1.D0*t147
      t153 = t152**(1.D0/3.D0)
      t155 = t149*t148+t153*t152-2.D0
      t156 = t146**2
      t157 = t156**2
      t158 = t114**2
      t159 = t158**2
      t160 = 1/t159
      t161 = t157*t160
      t163 = 1.D0-1.D0*t161
      t164 = t155*t163
      t166 = 0.3799574853701528D-1*t144*t164
      t168 = 1.D0+0.1274696188700087D0*t116
      t173 = 0.1112037486309468D2*t119+0.3844746237447211D1*t116
     #+0.1644733775567609D1*t122+0.2405871291288192D0*t124
      t176 = 1.D0+0.321646831778707D2/t173
      t177 = dlog(t176)
      t180 = -0.3109D-1*t168*t177+t132
      t181 = t180*t155
      t183 = 0.1923661050931536D1*t181*t161
      t190 = t114*(-t132+t166+t183)+0.3109D-1*t33*t45+0.3109D-1*t88*t100
      t193 = 0.5D0*t10+0.5D0*t65
      t196 = 1.D0+0.3D-2*t10+0.3D-2*t65
      t197 = 1/t196
      t200 = t193**2
      t201 = t196**2
      t202 = 1/t201
      t205 = 0.9454D0+0.44826D-2*t193*t197-0.1654596D-3*t200*t202
      zk(i) = -0.9305257363491D0*t5*t26-0.3109D-1*t33*t56
     #-0.9305257363491D0*t60*t81-0.3109D-1*t88*t111+t190*t205
      t209 = t6*rhoa
      t211 = 1/t7/t209
      t212 = sigmaaa*t211
      t217 = 1/t4/t17/t6
      t218 = t16*t217
      t221 = t16*sigmaaa
      t222 = t17**2
      t224 = 1/t222/rhoa
      t225 = t221*t224
      t227 = 1/t22/t12
      t230 = -0.54112D-2*t212*t13-0.4219306666666667D-4*t218*t23
     #+0.2553514666666667D-6*t225*t227
      t233 = t32*t45
      t236 = 1/t39
      t237 = t29*t236
      t240 = t41**2
      t241 = 1/t240
      t242 = t33*t241
      t243 = t34**2
      t244 = t243**2
      t245 = t244*t34
      t246 = 1/t245
      t247 = 1/t6
      t252 = 1/t37
      t255 = 1/t30
      t258 = -0.1853395810515781D1*t246*t247-0.128158207914907D1*t236
     #*t247-0.8223668877838045D0*t252*t247-0.1603914194192128D0*t255
     #*t247
      t259 = 1/t44
      t260 = t258*t259
      t261 = t260*t55
      t269 = 1/t51/t47
      t272 = -0.125264D1*t212*t48+0.7810453333333333D0*t218*t52
     #-0.1061034666666667D0*t225*t269
      t273 = t45*t272
      t276 = 1/t124
      t277 = 1/t158
      t278 = t276*t277
      t279 = t278*t130
      t280 = 0.2747799777968419D-2*t279
      t281 = t126**2
      t282 = 1/t281
      t283 = t118*t282
      t284 = t119**2
      t285 = t284**2
      t286 = t285*t119
      t287 = 1/t286
      t288 = t287*t277
      t291 = 1/t122
      t292 = t291*t277
      t294 = 1/t116
      t295 = t294*t277
      t297 = -0.99709173929518D0*t288-0.7418564737168958D0*t278
     #-0.4002143174996817D0*t292-0.1264669550498372D0*t295
      t298 = 1/t129
      t300 = t283*t297*t298
      t301 = 0.1D1*t300
      t302 = t143*t155
      t303 = t302*t163
      t304 = t278*t303
      t305 = 0.8740794299481065D-3*t304
      t306 = t139**2
      t307 = 1/t306
      t308 = t134*t307
      t313 = -0.135956911724794D1*t288-0.7491972878592054D0*t278
     #-0.2150486235638321D0*t292-0.1274341730084892D0*t295
      t314 = t308*t313
      t315 = 1/t142
      t316 = t315*t155
      t317 = t316*t163
      t318 = t314*t317
      t319 = 0.1124999956683108D1*t318
      t320 = t146*t277
      t321 = 1.D0*t320
      t322 = t115-t321
      t325 = 1.D0*t115
      t326 = -t325+t320
      t329 = 0.1333333333333333D1*t149*t322+0.1333333333333333D1*t153
     #*t326
      t331 = t144*t329*t163
      t332 = 0.3799574853701528D-1*t331
      t333 = t156*t146
      t334 = t333*t160
      t335 = 4.D0*t334
      t337 = 1/t159/t114
      t338 = t157*t337
      t339 = 4.D0*t338
      t340 = -t335+t339
      t342 = t144*t155*t340
      t343 = 0.3799574853701528D-1*t342
      t346 = t173**2
      t347 = 1/t346
      t348 = t168*t347
      t353 = -0.1853395810515781D1*t288-0.128158207914907D1*t278
     #-0.8223668877838045D0*t292-0.1603914194192128D0*t295
      t354 = 1/t176
      t360 = 0.1321010150222857D-2*t278*t177+0.1D1*t348*t353*t354
     #-0.2747799777968419D-2*t279-0.1D1*t300
      t361 = t360*t155
      t362 = t361*t161
      t363 = 0.1923661050931536D1*t362
      t364 = t180*t329
      t365 = t364*t161
      t366 = 0.1923661050931536D1*t365
      t367 = t181*t334
      t369 = t181*t338
      t370 = 0.7694644203726145D1*t369
      t377 = t241*t258*t259
      t380 = -t132+t166+t183+t114*(t280+t301-t305-t319+t332+t343+t363
     #+t366+0.7694644203726145D1*t367-t370)+0.3109D-1*t233
     #-0.1321010150222857D-2*t237*t45-0.1D1*t33*t377
      t384 = t193*t202
      t388 = 1/t201/t196
      t389 = t200*t388
      t392 = -0.59768D-2*t212*t197+0.4770864D-3*t384*t212
     #-0.26473536D-5*t389*t212
      vrhoa(i) = -0.12407009817988D1*t4*t26-0.9305257363491D0*t5*t230
     #-0.3109D-1*t233*t55+0.1321010150222857D-2*t237*t56+0.1D1*t242
     #*t261-0.3109D-1*t33*t273+t380*t205+t190*t392
      t396 = t61*rhob
      t398 = 1/t62/t396
      t399 = sigmabb*t398
      t404 = 1/t59/t72/t61
      t405 = t71*t404
      t408 = t71*sigmabb
      t409 = t72**2
      t411 = 1/t409/rhob
      t412 = t408*t411
      t414 = 1/t77/t67
      t417 = -0.54112D-2*t399*t68-0.4219306666666667D-4*t405*t78
     #+0.2553514666666667D-6*t412*t414
      t420 = t87*t100
      t423 = 1/t94
      t424 = t84*t423
      t427 = t96**2
      t428 = 1/t427
      t429 = t88*t428
      t430 = t89**2
      t431 = t430**2
      t432 = t431*t89
      t433 = 1/t432
      t434 = 1/t61
      t439 = 1/t92
      t442 = 1/t85
      t445 = -0.1853395810515781D1*t433*t434-0.128158207914907D1*t423
     #*t434-0.8223668877838045D0*t439*t434-0.1603914194192128D0*t442
     #*t434
      t446 = 1/t99
      t447 = t445*t446
      t448 = t447*t110
      t456 = 1/t106/t102
      t459 = -0.125264D1*t399*t103+0.7810453333333333D0*t405*t107
     #-0.1061034666666667D0*t412*t456
      t460 = t100*t459
      t463 = -t325-t321
      t466 = t115+t320
      t469 = 0.1333333333333333D1*t149*t463+0.1333333333333333D1*t153
     #*t466
      t471 = t144*t469*t163
      t472 = 0.3799574853701528D-1*t471
      t473 = t335+t339
      t475 = t144*t155*t473
      t476 = 0.3799574853701528D-1*t475
      t477 = t180*t469
      t478 = t477*t161
      t479 = 0.1923661050931536D1*t478
      t487 = t428*t445*t446
      t490 = -t132+t166+t183+t114*(t280+t301-t305-t319+t472+t476+t363
     #+t479-0.7694644203726145D1*t367-t370)+0.3109D-1*t420
     #-0.1321010150222857D-2*t424*t100-0.1D1*t88*t487
      t498 = -0.59768D-2*t399*t197+0.4770864D-3*t384*t399
     #-0.26473536D-5*t389*t399
      vrhob(i) = -0.12407009817988D1*t59*t81-0.9305257363491D0*t60
     #*t417-0.3109D-1*t420*t110+0.1321010150222857D-2*t424*t111+0.1D1
     #*t429*t448-0.3109D-1*t88*t460+t490*t205+t190*t498
      t502 = sigmaaa*t20
      t505 = 1/t222
      t506 = t16*t505
      t509 = 0.20292D-2*t9*t13+0.158224D-4*t502*t23-0.957568D-7*t506
     #*t227
      t518 = 0.46974D0*t9*t48-0.292892D0*t502*t52+0.397888D-1*t506*t269
      t519 = t45*t518
      t528 = 0.22413D-2*t9*t197-0.1789074D-3*t384*t9+0.9927576D-6*t389
     #*t9
      vsigmaaa(i) = -0.9305257363491D0*t5*t509-0.3109D-1*t33*t519+t190
     #*t528
      vsigmaab(i) = 0.D0
      t532 = sigmabb*t75
      t535 = 1/t409
      t536 = t71*t535
      t539 = 0.20292D-2*t64*t68+0.158224D-4*t532*t78-0.957568D-7*t536
     #*t414
      t548 = 0.46974D0*t64*t103-0.292892D0*t532*t107+0.397888D-1*t536
     #*t456
      t549 = t100*t548
      t558 = 0.22413D-2*t64*t197-0.1789074D-3*t384*t64+0.9927576D-6
     #*t389*t64
      vsigmabb(i) = -0.9305257363491D0*t60*t539-0.3109D-1*t88*t549
     #+t190*t558
      t562 = t32*t241
      t566 = 1/t240/t41
      t567 = t258**2
      t574 = 1/t209
      t576 = 1/t39/t29
      t577 = t574*t576
      t582 = 1/t17
      t603 = -0.1544496508763151D1/t245/t29*t582+0.3706791621031562D1
     #*t246*t574-0.854388052766047D0*t576*t582+0.2563164158298141D1
     #*t236*t574-0.4111834438919023D0/t37/t29*t582
     #+0.1644733775567609D1*t252*t574-0.5346380647307093D-1/t30/t29
     #*t582+0.3207828388384256D0*t255*t574
      t609 = t240**2
      t610 = 1/t609
      t612 = t44**2
      t613 = 1/t612
      t617 = 0.5495599555936838D-2*t279
      t618 = 0.2D1*t300
      t621 = 0.1538928840745229D2*t369
      t623 = 0.1748158859896213D-2*t304
      t624 = 0.2249999913366216D1*t318
      t625 = 0.3847322101863073D1*t362
      t628 = 1/t124/t115*t160
      t629 = t628*t130
      t630 = 0.1831866518645613D-2*t629
      t632 = 1/t158/t114
      t633 = t276*t632
      t634 = t633*t130
      t635 = 0.5495599555936838D-2*t634
      t638 = t278*t282*t297*t298
      t639 = 0.8837926660346786D-1*t638
      t641 = t278*t302*t340
      t643 = t281**2
      t646 = t297**2
      t647 = t129**2
      t650 = t118/t643*t646/t647
      t651 = 0.160818243221511D2*t650
      t652 = t156*t160
      t653 = 12.D0*t652
      t654 = t333*t337
      t655 = 32.D0*t654
      t658 = t157/t159/t158
      t659 = 20.D0*t658
      t664 = t149**2
      t665 = 1/t664
      t666 = t322**2
      t669 = 2.D0*t277
      t671 = 2.D0*t146*t632
      t672 = -t669+t671
      t675 = t153**2
      t676 = 1/t675
      t677 = t326**2
      t683 = 0.4444444444444444D0*t665*t666+0.1333333333333333D1*t149
     #*t672+0.4444444444444444D0*t676*t677-0.1333333333333333D1*t153
     #*t672
      t689 = t278*t143*t329*t163
      t692 = 0.5827196199654043D-3*t628*t303
      t694 = 0.1748158859896213D-2*t633*t303
      t699 = 0.5176049209143758D-1*t278*t307*t313*t315*t164
      t703 = t313**2
      t706 = 0.2249999913366216D1*t134/t306/t139*t703*t317
      t709 = 1/t286/t115*t160
      t711 = t287*t632
      t717 = 1/t122/t115*t160
      t719 = t291*t632
      t723 = 1/t116/t115*t160
      t725 = t294*t632
      t730 = 0.1124999956683108D1*t308*(-0.1132974264373283D1*t709
     #+0.271913823449588D1*t711-0.4994648585728036D0*t628
     #+0.1498394575718411D1*t633-0.1075243117819161D0*t717
     #+0.4300972471276643D0*t719-0.4247805766949639D-1*t723
     #+0.2548683460169784D0*t725)*t317
      t733 = t314*t315*t329*t163
      t735 = t630-t635-t639-0.1748158859896213D-2*t641+t651
     #+0.3799574853701528D-1*t144*t155*(-t653+t655-t659)
     #+0.3799574853701528D-1*t144*t683*t163-0.1748158859896213D-2*t689
     #-t692+t694+t699+t706-t730-0.2249999913366216D1*t733
      t737 = t314*t316*t340
      t742 = t364*t338
      t744 = t364*t334
      t746 = t181*t654
      t748 = t181*t652
      t749 = 0.2308393261117844D2*t748
      t761 = t353**2
      t777 = t346**2
      t780 = t176**2
      t792 = t118/t281/t126*t646*t298
      t804 = t283*(-0.8309097827459833D0*t709+0.199418347859036D1*t711
     #-0.4945709824779306D0*t628+0.1483712947433792D1*t633
     #-0.2001071587498409D0*t717+0.8004286349993634D0*t719
     #-0.4215565168327908D-1*t723+0.2529339100996745D0*t725)*t298
      t807 = 0.8806734334819047D-3*t628*t177-0.2642020300445714D-2
     #*t633*t177-0.8497974591333914D-1*t278*t347*t353*t354-0.2D1*t168
     #/t346/t173*t761*t354+0.1D1*t348*(-0.1544496508763151D1*t709
     #+0.3706791621031562D1*t711-0.854388052766047D0*t628
     #+0.2563164158298141D1*t633-0.4111834438919023D0*t717
     #+0.1644733775567609D1*t719-0.5346380647307093D-1*t723
     #+0.3207828388384256D0*t725)*t354+0.321646831778707D2*t168/t777
     #*t761/t780-0.1831866518645613D-2*t629+0.5495599555936838D-2*t634
     #+0.8837926660346786D-1*t638+0.2D1*t792-0.1D1*t804
     #-0.160818243221511D2*t650
      t810 = 0.1923661050931536D1*t807*t155*t161
      t812 = 0.3847322101863073D2*t181*t658
      t817 = t360*t329*t161
      t819 = 0.1D1*t804
      t820 = t306**2
      t824 = t142**2
      t829 = 0.3330964519106732D2*t134/t820*t703/t824*t155*t163
      t830 = 0.2D1*t792
      t831 = t361*t334
      t834 = 0.1538928840745229D2*t361*t338
      t835 = -0.2249999913366216D1*t737+0.1923661050931536D1*t180*t683
     #*t161-0.1538928840745229D2*t742+0.1538928840745229D2*t744
     #-0.6155715362980916D2*t746+t749+t810+t812+0.7599149707403056D-1
     #*t144*t329*t340+0.3847322101863073D1*t817+t819-t829-t830
     #+0.1538928840745229D2*t831-t834
      t838 = -0.2D1*t562*t260+0.2D1*t33*t566*t567*t259
     #+0.8497974591333914D-1*t237*t377-0.8806734334819047D-3*t577*t45
     #-0.1D1*t33*t241*t603*t259+0.7599149707403056D-1*t331
     #-0.321646831778707D2*t33*t610*t567*t613+t617+t618
     #+0.3847322101863073D1*t365+0.1538928840745229D2*t367-t621
     #+0.7599149707403056D-1*t342-t623-t624+t625+t114*(t735+t835)
      t842 = sigmaaa/t7/t17
      t848 = t16/t4/t17/t209
      t851 = t193*t388
      t856 = t201**2
      t858 = t200/t856
      t876 = t222*t6
      t878 = t221/t876
      t881 = t16**2
      t885 = t881/t7/t222/t17
      t886 = t22**2
      t887 = 1/t886
      t899 = t51**2
      t900 = 1/t899
      s1 = 2.D0*t380*t392+t838*t205+t190*(0.2191493333333333D-1*t842
     #*t197-0.6839296D-3*t848*t202+0.14692992D-4*t851*t848
     #-0.17493168D-2*t384*t842-0.635364864D-7*t858*t848+0.97069632D-5
     #*t389*t842)-0.6218D-1*t233*t272-0.4135669939329333D0/t7*t26
     #-0.24814019635976D1*t4*t230-0.9305257363491D0*t5*
     #(0.1984106666666667D-1*t842*t13+0.2095032888888889D-3*t848*t23
     #-0.3198281955555556D-5*t878*t227+0.8171246933333333D-8*t885*t887
     #)-0.3109D-1*t33*t45*(0.4593013333333333D1*t842*t48
     #-0.5614695111111111D1*t848*t52+0.1788046222222222D1*t878*t269
     #-0.1697655466666667D0*t885*t900)
      v2rhoa2(i) = s1+0.2D1*t562*t261+0.2642020300445714D-2*t237*t273
     #+0.8806734334819047D-3*t577*t56-0.8497974591333914D-1*t237*t241
     #*t261-0.2D1*t33*t566*t567*t259*t55+0.1D1*t242*t603*t259*t55
     #+0.2D1*t242*t260*t272+0.321646831778707D2*t33*t610*t567*t613*t55
      t937 = sigmabb/t62/t72
      t943 = t71/t59/t72/t396
      t962 = t409*t61
      t964 = t408/t962
      t967 = t71**2
      t971 = t967/t62/t409/t72
      t972 = t77**2
      t973 = 1/t972
      t987 = 1/t396
      t989 = 1/t94/t84
      t990 = t987*t989
      t995 = t87*t428
      t1000 = 1/t72
      t1021 = -0.1544496508763151D1/t432/t84*t1000
     #+0.3706791621031562D1*t433*t987-0.854388052766047D0*t989*t1000
     #+0.2563164158298141D1*t423*t987-0.4111834438919023D0/t92/t84
     #*t1000+0.1644733775567609D1*t439*t987-0.5346380647307093D-1/t85
     #/t84*t1000+0.3207828388384256D0*t442*t987
      t1027 = 1/t427/t96
      t1029 = t445**2
      t1034 = t427**2
      t1035 = 1/t1034
      t1037 = t99**2
      t1038 = 1/t1037
      t1068 = t477*t338
      t1070 = t477*t334
      t1073 = -0.1538928840745229D2*t1068-0.1538928840745229D2*t1070
     #+t630-t635-t639+t651-t692+t694+t699+t706-t730
     #+0.6155715362980916D2*t746+t749+t810
      t1078 = t463**2
      t1081 = t669+t671
      t1084 = t466**2
      t1090 = 0.4444444444444444D0*t665*t1078+0.1333333333333333D1
     #*t149*t1081+0.4444444444444444D0*t676*t1084-0.1333333333333333D1
     #*t153*t1081
      t1099 = t360*t469*t161
      t1105 = t278*t302*t473
      t1109 = t278*t143*t469*t163
      t1112 = t314*t316*t473
      t1116 = t314*t315*t469*t163
      t1118 = t812+t819-t829-t830-0.1538928840745229D2*t831-t834
     #+0.7599149707403056D-1*t144*t469*t473+0.3799574853701528D-1*t144
     #*t1090*t163+0.3799574853701528D-1*t144*t155*(-t653-t655-t659)
     #+0.3847322101863073D1*t1099+0.1923661050931536D1*t180*t1090*t161
     #-0.1748158859896213D-2*t1105-0.1748158859896213D-2*t1109
     #-0.2249999913366216D1*t1112-0.2249999913366216D1*t1116
      t1121 = -0.1D1*t88*t428*t1021*t446+0.2D1*t88*t1027*t1029*t446
     #-0.8806734334819047D-3*t990*t100+0.8497974591333914D-1*t424*t487
     #-0.2D1*t995*t447-0.321646831778707D2*t88*t1035*t1029*t1038+t617
     #+t618-0.1538928840745229D2*t367-t621-t623-t624+t625
     #+0.3847322101863073D1*t478+0.7599149707403056D-1*t471
     #+0.7599149707403056D-1*t475+t114*(t1073+t1118)
      t1129 = t106**2
      t1130 = 1/t1129
      s1 = 2.D0*t490*t498+t190*(0.2191493333333333D-1*t937*t197
     #-0.6839296D-3*t943*t202+0.14692992D-4*t851*t943-0.17493168D-2
     #*t384*t937-0.635364864D-7*t858*t943+0.97069632D-5*t389*t937)
     #-0.6218D-1*t420*t459-0.9305257363491D0*t60*
     #(0.1984106666666667D-1*t937*t68+0.2095032888888889D-3*t943*t78
     #-0.3198281955555556D-5*t964*t414+0.8171246933333333D-8*t971*t973
     #)-0.24814019635976D1*t59*t417-0.4135669939329333D0/t62*t81
     #-0.8497974591333914D-1*t424*t428*t448+0.8806734334819047D-3*t990
     #*t111
      v2rhob2(i) = s1+0.2642020300445714D-2*t424*t460+0.2D1*t995*t448
     #+0.1D1*t429*t1021*t446*t110-0.2D1*t88*t1027*t1029*t446*t110
     #+0.321646831778707D2*t88*t1035*t1029*t1038*t110+0.2D1*t429*t447
     #*t459+t1121*t205-0.3109D-1*t88*t100*(0.4593013333333333D1*t937
     #*t103-0.5614695111111111D1*t943*t107+0.1788046222222222D1*t964
     #*t456-0.1697655466666667D0*t971*t1130)
      t1160 = 0.4444444444444444D0*t665*t322*t463+0.2666666666666667D1
     #*t149*t146*t632+0.4444444444444444D0*t676*t326*t466
     #-0.2666666666666667D1*t153*t146*t632
      t1170 = -0.7694644203726145D1*t1068+0.7694644203726145D1*t1070
     #+t630-t635-t639-0.8740794299481065D-3*t641+t651
     #-0.8740794299481065D-3*t689+0.3799574853701528D-1*t144*t469*t340
     #+0.3799574853701528D-1*t144*t155*(t653-t659)
     #+0.3799574853701528D-1*t144*t1160*t163+0.3799574853701528D-1
     #*t144*t329*t473+0.1923661050931536D1*t180*t1160*t161-t692+t694
     #+t699+t706
      t1182 = -t730-0.1124999956683108D1*t733-0.1124999956683108D1
     #*t737-0.7694644203726145D1*t742-0.7694644203726145D1*t744
     #-0.2308393261117844D2*t748+t810+t812+0.1923661050931536D1*t817
     #+t819-t829-t830-t834+0.1923661050931536D1*t1099
     #-0.8740794299481065D-3*t1105-0.8740794299481065D-3*t1109
     #-0.1124999956683108D1*t1112-0.1124999956683108D1*t1116
      t1185 = t617+t618-t623-t624+t472+t476+t625+t479-t621+t332+t343
     #+t366+t114*(t1170+t1182)
      t1195 = t211*sigmabb*t398
      v2rhoab(i) = t1185*t205+t380*t498+t490*t392+t190*(-0.6839296D-3
     #*t212*t202*sigmabb*t398+0.14692992D-4*t851*sigmaaa*t1195
     #-0.635364864D-7*t858*sigmaaa*t1195)
      t1207 = sigmaaa*t217
      t1210 = t16*t224
      t1216 = t221/t7/t222/t209
      v2rhoasigmaaa(i) = -0.12407009817988D1*t4*t509-0.9305257363491D0
     #*t5*(-0.54112D-2*t211*t13-0.6274133333333333D-4*t1207*t23
     #+0.1103598933333333D-5*t1210*t227-0.30642176D-8*t1216*t887)
     #-0.3109D-1*t233*t518+0.1321010150222857D-2*t237*t519+0.1D1*t242
     #*t260*t518-0.3109D-1*t33*t45*(-0.125264D1*t211*t48
     #+0.1812618666666667D1*t1207*t52-0.6307285333333333D0*t1210*t269
     #+0.6366208D-1*t1216*t900)+t380*t528+t190*(-0.59768D-2*t211*t197
     #+0.2564736D-3*t1207*t202-0.5509872D-5*t851*t1207+0.4770864D-3
     #*t384*t211+0.238261824D-7*t858*t1207-0.26473536D-5*t389*t211)
      v2rhoasigmaab(i) = 0.D0
      t1260 = t212*t64
      v2rhoasigmabb(i) = t380*t558+t190*(0.2564736D-3*t212*t202*t64
     #-0.5509872D-5*t851*t1260+0.238261824D-7*t858*t1260)
      t1268 = t202*t9
      t1271 = t399*t9
      v2rhobsigmaaa(i) = t490*t528+t190*(0.2564736D-3*t399*t1268
     #-0.5509872D-5*t851*t1271+0.238261824D-7*t858*t1271)
      v2rhobsigmaab(i) = 0.D0
      t1282 = sigmabb*t404
      t1285 = t71*t411
      t1291 = t408/t62/t409/t396
      v2rhobsigmabb(i) = -0.12407009817988D1*t59*t539
     #-0.9305257363491D0*t60*(-0.54112D-2*t398*t68
     #-0.6274133333333333D-4*t1282*t78+0.1103598933333333D-5*t1285
     #*t414-0.30642176D-8*t1291*t973)-0.3109D-1*t420*t548
     #+0.1321010150222857D-2*t424*t549+0.1D1*t429*t447*t548-0.3109D-1
     #*t88*t100*(-0.125264D1*t398*t103+0.1812618666666667D1*t1282*t107
     #-0.6307285333333333D0*t1285*t456+0.6366208D-1*t1291*t1130)+t490
     #*t558+t190*(-0.59768D-2*t398*t197+0.2564736D-3*t1282*t202
     #-0.5509872D-5*t851*t1282+0.4770864D-3*t384*t398+0.238261824D-7
     #*t858*t1282-0.26473536D-5*t389*t398)
      t1333 = sigmaaa*t505
      t1338 = t16/t7/t876
      v2sigmaaa2(i) = -0.9305257363491D0*t5*(0.77056D-5*t20*t23
     #-0.3180928D-6*t1333*t227+0.11490816D-8*t1338*t887)-0.3109D-1*t33
     #*t45*(-0.38684D0*t20*t52+0.1967344D0*t1333*t269-0.2387328D-1
     #*t1338*t900)+t190*(-0.961776D-4*t20*t202+0.2066202D-5*t851*t20
     #-0.89348184D-8*t858*t20)
      v2sigmaaaab(i) = 0.D0
      t1364 = t9*t64
      v2sigmaaabb(i) = t190*(-0.961776D-4*t1268*t64+0.2066202D-5*t851
     #*t1364-0.89348184D-8*t858*t1364)
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      t1372 = sigmabb*t535
      t1377 = t71/t62/t962
      v2sigmabb2(i) = -0.9305257363491D0*t60*(0.77056D-5*t75*t78
     #-0.3180928D-6*t1372*t414+0.11490816D-8*t1377*t973)-0.3109D-1*t88
     #*t100*(-0.38684D0*t75*t107+0.1967344D0*t1372*t456-0.2387328D-1
     #*t1377*t1130)+t190*(-0.961776D-4*t75*t202+0.2066202D-5*t851*t75
     #-0.89348184D-8*t858*t75)
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      v2rhob2(i) = 0.0d0
      v2rhoab(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2rhoasigmaab(i) = 0.0d0
      v2rhoasigmabb(i) = 0.0d0
      v2rhobsigmaaa(i) = 0.0d0
      v2rhobsigmaab(i) = 0.0d0
      v2rhobsigmabb(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      v2sigmaab2(i) = 0.0d0
      v2sigmabb2(i) = 0.0d0
      v2sigmaaaab(i) = 0.0d0
      v2sigmaaabb(i) = 0.0d0
      v2sigmaabbb(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end
      
      
      subroutine rks_xc_b97
     & (ideriv,npt,rhoa1,sigmaaa1,
     &  zk,vrhoa,vsigmaaa,
     &  v2rhoa2,v2rhoasigmaaa,v2sigmaaa2)
c
c     A.D. Becke
c     Density-functional thermochemistry. V. Systematic optimization of
c     exchange-correlation functionals
c     J. Chem. Phys. 107 (1997) 8554-8560
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt)
      REAL sigmaaa1(npt)
      REAL zk(npt),vrhoa(npt),vsigmaaa(npt)
      REAL v2rhoa2(npt),v2rhoasigmaaa(npt),v2sigmaaa2(npt)
      parameter(tol=1.0d-20)
      
      if(ideriv.eq.0) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t4 = rho**2
      t5 = t2**2
      t8 = sigma/t5/t4
      t10 = 1.D0+0.6349604207872798D-2*t8
      t14 = sigma**2
      t15 = t4**2
      t19 = t14/t2/t15/rho
      t20 = t10**2
      t27 = 1/rho
      t28 = t27**(1.D0/3.D0)
      t31 = rho*(1.D0+0.1606016560364007D0*t28)
      t32 = t27**(1.D0/6.D0)
      t35 = dsqrt(t27)
      t37 = t28**2
      t43 = dlog(1.D0+0.321646831778707D2/(0.1248219874679732D2*t32
     #+0.4844076716063854D1*t28+0.2326004811900819D1*t35
     #+0.3819082618690966D0*t37))
      t45 = 1.D0+0.3174802103936399D0*t8
      t49 = t45**2
      t68 = dlog(1.D0+0.160818243221511D2/(0.598255043577108D1*t32
     #+0.2225569421150687D1*t28+0.8004286349993634D0*t35
     #+0.1897004325747559D0*t37))
      t75 = 1.D0+0.9524406311809197D-2*t8
      t79 = t75**2
      zk(i) = -0.7385587663820224D0*t2*rho*(0.8094D0
     #+0.322115421465387D-2*t8/t10+0.3016150199764335D-4*t19/t20)
     #-0.3109D-1*t31*t43*(0.1737D0+0.745665770151542D0*t8/t45
     #-0.2506537333502856D0*t19/t49)+(-0.62182D-1*rho*(1.D0
     #+0.1325688999052018D0*t28)*t68+0.3109D-1*t31*t43)*(0.9454D0
     #+0.7115683955552651D-2*t8/t75-0.4169320658943715D-3*t19/t79)
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t3 = t2*rho
      t4 = rho**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigma*t7
      t10 = 1.D0+0.6349604207872798D-2*t8
      t11 = 1/t10
      t14 = sigma**2
      t15 = t4**2
      t18 = 1/t2/t15/rho
      t19 = t14*t18
      t20 = t10**2
      t21 = 1/t20
      t24 = 0.8094D0+0.322115421465387D-2*t8*t11+0.3016150199764335D-4
     #*t19*t21
      t27 = 1/rho
      t28 = t27**(1.D0/3.D0)
      t30 = 1.D0+0.1606016560364007D0*t28
      t31 = rho*t30
      t32 = t27**(1.D0/6.D0)
      t35 = dsqrt(t27)
      t37 = t28**2
      t39 = 0.1248219874679732D2*t32+0.4844076716063854D1*t28
     #+0.2326004811900819D1*t35+0.3819082618690966D0*t37
      t42 = 1.D0+0.321646831778707D2/t39
      t43 = dlog(t42)
      t45 = 1.D0+0.3174802103936399D0*t8
      t46 = 1/t45
      t49 = t45**2
      t50 = 1/t49
      t53 = 0.1737D0+0.745665770151542D0*t8*t46-0.2506537333502856D0
     #*t19*t50
      t54 = t43*t53
      t58 = 1.D0+0.1325688999052018D0*t28
      t64 = 0.598255043577108D1*t32+0.2225569421150687D1*t28
     #+0.8004286349993634D0*t35+0.1897004325747559D0*t37
      t67 = 1.D0+0.160818243221511D2/t64
      t68 = dlog(t67)
      t73 = -0.62182D-1*rho*t58*t68+0.3109D-1*t31*t43
      t75 = 1.D0+0.9524406311809197D-2*t8
      t76 = 1/t75
      t79 = t75**2
      t80 = 1/t79
      t83 = 0.9454D0+0.7115683955552651D-2*t8*t76
     #-0.4169320658943715D-3*t19*t80
      zk(i) = -0.7385587663820224D0*t3*t24-0.3109D-1*t31*t54+t73*t83
      t90 = sigma/t5/t4/rho
      t96 = t14/t2/t15/t4
      t100 = t15**2
      t103 = t14*sigma/t100/rho
      t105 = 1/t20/t10
      t111 = t30*t43
      t114 = 1/t37
      t115 = t27*t114
      t118 = t39**2
      t119 = 1/t118
      t121 = t32**2
      t122 = t121**2
      t125 = 1/t4
      t126 = 1/t122/t32*t125
      t128 = t114*t125
      t131 = 1/t35*t125
      t134 = 1/t28*t125
      t136 = -0.4160732915599108D1*t126-0.3229384477375903D1*t128
     #-0.2326004811900819D1*t131-0.5092110158254621D0*t134
      t137 = 1/t42
      t147 = 1/t49/t45
      t158 = t64**2
      t186 = 1/t79/t75
      vrhoa(i) = -0.9847450218426965D0*t2*t24-0.3692793831910112D0*t3*
     #(-0.1717948914482064D-1*t90*t11-0.2126397314118042D-3*t96*t21
     #+0.2042811733333333D-5*t103*t105)-0.3109D-1*t111*t53
     #+0.1664368495390566D-2*t115*t54+0.5D0*t31*t119*t136*t137*t53
     #-0.15545D-1*t31*t43*(-0.3976884107474891D1*t90*t46
     #+0.3936221825555298D1*t96*t50-0.8488277333333333D0*t103*t147)+(
     #-0.62182D-1*t58*t68+rho*(0.2747799777968419D-2*t128*t68+0.1D1
     #*t58/t158*(-0.99709173929518D0*t126-0.7418564737168958D0*t128
     #-0.4002143174996817D0*t131-0.1264669550498372D0*t134)/t67)
     #+0.3109D-1*t111-0.1664368495390566D-2*t115*t43-0.5D0*t31*t119
     #*t136*t137)*t83+t73*(-0.1897515721480707D-1*t90*t76
     #+0.2404364791914262D-2*t96*t80-0.211788288D-4*t103*t186)
      t193 = sigma*t18
      t197 = t14/t100
      vsigmaaa(i) = -0.7385587663820224D0*t3*(0.1288461685861548D-1*t7
     #*t11+0.1594797985588531D-3*t193*t21-0.15321088D-5*t197*t105)
     #-0.3109D-1*t31*t43*(0.2982663080606168D1*t7*t46
     #-0.2952166369166474D1*t193*t50+0.6366208D0*t197*t147)+2.D0*t73*
     #(0.142313679111053D-1*t7*t76-0.1803273593935696D-2*t193*t80
     #+0.158841216D-4*t197*t186)
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t3 = t2*rho
      t4 = rho**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigma*t7
      t10 = 1.D0+0.6349604207872798D-2*t8
      t11 = 1/t10
      t14 = sigma**2
      t15 = t4**2
      t18 = 1/t2/t15/rho
      t19 = t14*t18
      t20 = t10**2
      t21 = 1/t20
      t24 = 0.8094D0+0.322115421465387D-2*t8*t11+0.3016150199764335D-4
     #*t19*t21
      t27 = 1/rho
      t28 = t27**(1.D0/3.D0)
      t30 = 1.D0+0.1606016560364007D0*t28
      t31 = rho*t30
      t32 = t27**(1.D0/6.D0)
      t35 = dsqrt(t27)
      t37 = t28**2
      t39 = 0.1248219874679732D2*t32+0.4844076716063854D1*t28
     #+0.2326004811900819D1*t35+0.3819082618690966D0*t37
      t42 = 1.D0+0.321646831778707D2/t39
      t43 = dlog(t42)
      t45 = 1.D0+0.3174802103936399D0*t8
      t46 = 1/t45
      t49 = t45**2
      t50 = 1/t49
      t53 = 0.1737D0+0.745665770151542D0*t8*t46-0.2506537333502856D0
     #*t19*t50
      t54 = t43*t53
      t58 = 1.D0+0.1325688999052018D0*t28
      t64 = 0.598255043577108D1*t32+0.2225569421150687D1*t28
     #+0.8004286349993634D0*t35+0.1897004325747559D0*t37
      t67 = 1.D0+0.160818243221511D2/t64
      t68 = dlog(t67)
      t73 = -0.62182D-1*rho*t58*t68+0.3109D-1*t31*t43
      t75 = 1.D0+0.9524406311809197D-2*t8
      t76 = 1/t75
      t79 = t75**2
      t80 = 1/t79
      t83 = 0.9454D0+0.7115683955552651D-2*t8*t76
     #-0.4169320658943715D-3*t19*t80
      zk(i) = -0.7385587663820224D0*t3*t24-0.3109D-1*t31*t54+t73*t83
      t87 = t4*rho
      t89 = 1/t5/t87
      t90 = sigma*t89
      t95 = 1/t2/t15/t4
      t96 = t14*t95
      t99 = t14*sigma
      t100 = t15**2
      t102 = 1/t100/rho
      t103 = t99*t102
      t105 = 1/t20/t10
      t108 = -0.1717948914482064D-1*t90*t11-0.2126397314118042D-3*t96
     #*t21+0.2042811733333333D-5*t103*t105
      t111 = t30*t43
      t114 = 1/t37
      t115 = t27*t114
      t118 = t39**2
      t119 = 1/t118
      t120 = t31*t119
      t121 = t32**2
      t122 = t121**2
      t123 = t122*t32
      t124 = 1/t123
      t125 = 1/t4
      t126 = t124*t125
      t128 = t114*t125
      t130 = 1/t35
      t131 = t130*t125
      t133 = 1/t28
      t134 = t133*t125
      t136 = -0.4160732915599108D1*t126-0.3229384477375903D1*t128
     #-0.2326004811900819D1*t131-0.5092110158254621D0*t134
      t137 = 1/t42
      t138 = t136*t137
      t139 = t138*t53
      t147 = 1/t49/t45
      t150 = -0.3976884107474891D1*t90*t46+0.3936221825555298D1*t96
     #*t50-0.8488277333333333D0*t103*t147
      t151 = t43*t150
      t156 = t128*t68
      t158 = t64**2
      t159 = 1/t158
      t160 = t58*t159
      t165 = -0.99709173929518D0*t126-0.7418564737168958D0*t128
     #-0.4002143174996817D0*t131-0.1264669550498372D0*t134
      t166 = 1/t67
      t168 = t160*t165*t166
      t176 = t119*t136*t137
      t179 = -0.62182D-1*t58*t68+rho*(0.2747799777968419D-2*t156+0.1D1
     #*t168)+0.3109D-1*t111-0.1664368495390566D-2*t115*t43-0.5D0*t31
     #*t176
      t186 = 1/t79/t75
      t189 = -0.1897515721480707D-1*t90*t76+0.2404364791914262D-2*t96
     #*t80-0.211788288D-4*t103*t186
      vrhoa(i) = -0.9847450218426965D0*t2*t24-0.3692793831910112D0*t3
     #*t108-0.3109D-1*t111*t53+0.1664368495390566D-2*t115*t54+0.5D0
     #*t120*t139-0.15545D-1*t31*t151+t179*t83+t73*t189
      t193 = sigma*t18
      t196 = 1/t100
      t197 = t14*t196
      t200 = 0.1288461685861548D-1*t7*t11+0.1594797985588531D-3*t193
     #*t21-0.15321088D-5*t197*t105
      t209 = 0.2982663080606168D1*t7*t46-0.2952166369166474D1*t193*t50
     #+0.6366208D0*t197*t147
      t210 = t43*t209
      t219 = 0.142313679111053D-1*t7*t76-0.1803273593935696D-2*t193
     #*t80+0.158841216D-4*t197*t186
      vsigmaaa(i) = -0.7385587663820224D0*t3*t200-0.3109D-1*t31*t210
     #+2.D0*t73*t219
      t224 = sigma/t5/t15
      t230 = t14/t2/t15/t87
      t233 = t100*t4
      t235 = t99/t233
      t238 = t14**2
      t242 = t238/t5/t100/t15
      t243 = t20**2
      t244 = 1/t243
      t252 = 1/t87
      t254 = 1/t37/t27
      t255 = t252*t254
      t262 = 1/t118/t39
      t264 = t136**2
      t271 = t30*t119
      t280 = t49**2
      t281 = 1/t280
      t290 = 1/t15
      t291 = 1/t123/t27*t290
      t293 = t124*t252
      t295 = t254*t290
      t297 = t114*t252
      t301 = 1/t35/t27*t290
      t303 = t130*t252
      t307 = 1/t28/t27*t290
      t309 = t133*t252
      t311 = -0.6934554859331846D1*t291+0.1664293166239643D2*t293
     #-0.4305845969834537D1*t295+0.1291753790950361D2*t297
     #-0.2326004811900819D1*t301+0.9304019247603276D1*t303
     #-0.3394740105503081D0*t307+0.2036844063301848D1*t309
      t321 = 0.5495599555936838D-2*t156
      t322 = 0.2D1*t168
      t333 = dlog(1.D0+0.2960857464321668D2/(0.8157414703487641D1*t32
     #+0.2247591863577616D1*t28+0.4300972471276643D0*t35
     #+0.1911512595127338D0*t37))
      t335 = (1.D0+0.6901399211255825D-1*t28)*t333*t125
      t340 = 0.8837926660346786D-1*t128*t159*t165*t166
      t342 = 0.5495599555936838D-2*t297*t68
      t344 = 0.1831866518645613D-2*t295*t68
      t345 = t158**2
      t348 = t165**2
      t349 = t67**2
      t353 = 0.160818243221511D2*t58/t345*t348/t349
      t365 = 0.1D1*t160*(-0.8309097827459833D0*t291
     #+0.199418347859036D1*t293-0.4945709824779306D0*t295
     #+0.1483712947433792D1*t297-0.2001071587498409D0*t301
     #+0.8004286349993634D0*t303-0.4215565168327908D-1*t307
     #+0.2529339100996745D0*t309)*t166
      t371 = 0.2D1*t58/t158/t64*t348*t166
      t380 = t118**2
      t381 = 1/t380
      t383 = t42**2
      t384 = 1/t383
      t410 = t230*t80
      t412 = t235*t186
      t414 = t79**2
      t415 = 1/t414
      t417 = 0.1613726165595571D-5*t242*t415
      s1 = -0.3692793831910112D0*t3*(0.1259829203953514D0*t224*t11
     #+0.2111660829546542D-2*t230*t21-0.5117251128888889D-4*t235*t105
     #+0.2075367356458441D-6*t242*t244)-0.6218D-1*t111*t150
     #+0.2219157993854088D-2*t255*t54-0.1070677706909338D0*t115*t119
     #*t139-0.1D1*t31*t262*t264*t137*t53+0.3328736990781132D-2*t115
     #*t151+0.2D1*t271*t139-0.15545D-1*t31*t43*(0.291638167881492D2
     #*t224*t46-0.5659258047384578D2*t230*t50+0.2860873955555556D2
     #*t235*t147-0.431177611786597D1*t242*t281)+0.5D0*t120*t311*t137*t53
      v2rhoa2(i) = s1-0.6564966812284644D0/t5*t24-0.1969490043685393D1
     #*t2*t108+(t321+t322+rho*(0.3377399869956914D-1*t335-t340-t342
     #+t344+t353+t365-t371)-0.2219157993854088D-2*t255*t43
     #+0.1070677706909338D0*t115*t176-0.2D1*t271*t138
     #-0.1608234158893535D2*t31*t381*t264*t384-0.5D0*t31*t119*t311
     #*t137+0.1D1*t31*t262*t264*t137)*t83+0.1608234158893535D2*t31
     #*t381*t264*t384*t53+0.1D1*t120*t138*t150+4.D0*t179*t189+t73*
     #(0.1391511529085852D0*t224*t76-0.2452558687152736D-1*t410
     #+0.3903992832D-3*t412-t417)+(t321+t322+rho*(
     #-0.3377399869956914D-1*t335-t340-t342+t344+t353+t365-t371))*t83
     #+t73*(-0.6893578397489445D-2*t410+0.235087872D-3*t412-t417)
      t433 = sigma*t95
      t436 = t14*t102
      t442 = t99/t5/t100/t87
      t471 = t433*t80
      t473 = t436*t186
      t476 = 0.1210294624196678D-5*t442*t415
      v2rhoasigmaaa(i) = -0.9847450218426965D0*t2*t200
     #-0.3692793831910112D0*t3*(-0.6871795657928257D-1*t89*t11
     #-0.1264786025042201D-2*t433*t21+0.3531516586666667D-4*t436*t105
     #-0.1556525517343831D-6*t442*t244)-0.3109D-1*t111*t209
     #+0.1664368495390566D-2*t115*t210+0.5D0*t120*t138*t209-0.15545D-1
     #*t31*t43*(-0.1590753642989956D2*t89*t46+0.3654010261705139D2
     #*t433*t50-0.2018331306666667D2*t436*t147+0.3233832088399478D1
     #*t442*t281)+2.D0*t179*t219+t73*(-0.7590062885922828D-1*t89*t76
     #+0.1478764296577413D-1*t471-0.2610312192D-3*t473+t476)+t73*
     #(0.5170183798117084D-2*t471-0.176315904D-3*t473+t476)
      t485 = sigma*t196
      t490 = t14/t5/t233
      v2sigmaaa2(i) = -0.7385587663820224D0*t3*(0.3106703245462379D-3
     #*t18*t21-0.203579392D-4*t485*t105+0.1167394138007873D-6*t490
     #*t244)-0.3109D-1*t31*t43*(-0.1559641148612265D2*t18*t50
     #+0.125910016D2*t485*t147-0.2425374066299608D1*t490*t281)+4.D0
     #*t73*(-0.3877637848587813D-2*t18*t80+0.132236928D-3*t485*t186
     #-0.9077209681475088D-6*t490*t415)
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end

c:XC_B97subrend
_ENDIF
_IF(ccpdft,all,xc_b97_1)
c:XC_B97_1subrstart

c    Generated: Mon Nov 19 16:36:44 GMT 2007

      subroutine uks_xc_b97_1
     & (ideriv,npt,rhoa1,rhob1,sigmaaa1,sigmabb1,sigmaab1,
     &  zk,vrhoa,vrhob,vsigmaaa,vsigmabb,vsigmaab,
     &  v2rhoa2,v2rhob2,v2rhoab,
     &  v2rhoasigmaaa,v2rhoasigmaab,v2rhoasigmabb,
     &  v2rhobsigmabb,v2rhobsigmaab,v2rhobsigmaaa,
     &  v2sigmaaa2,v2sigmaaaab,v2sigmaaabb,
     &  v2sigmaab2,v2sigmaabbb,v2sigmabb2)
c
c     F.A. Hamprecht, A.J. Cohen, D.J. Tozer, and N.C. Handy
c     Development and assessment of new exchange-correlation functionals
c     J. Chem. Phys. 109 (1998) 6264-6271
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt),rhob1(npt)
      REAL sigmaaa1(npt),sigmabb1(npt),sigmaab1(npt)
      REAL zk(npt),vrhoa(npt),vrhob(npt)
      REAL vsigmaaa(npt),vsigmabb(npt),vsigmaab(npt)
      REAL v2rhoa2(npt),v2rhob2(npt),v2rhoab(npt)
      REAL v2rhoasigmaaa(npt),v2rhoasigmaab(npt)
      REAL v2rhoasigmabb(npt),v2rhobsigmabb(npt)
      REAL v2rhobsigmaab(npt),v2rhobsigmaaa(npt)
      REAL v2sigmaaa2(npt),v2sigmaaaab(npt),v2sigmaaabb(npt)
      REAL v2sigmaab2(npt),v2sigmaabbb(npt),v2sigmabb2(npt)
      parameter(tol=1.0d-20)
      
      if (ideriv.eq.0) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t4 = rhob**2
      t5 = t2**2
      t8 = sigmabb/t5/t4
      t10 = 1.D0+0.4D-2*t8
      t14 = sigmabb**2
      t15 = t4**2
      t19 = t14/t2/t15/rhob
      t20 = t10**2
      t27 = 1/rhob
      t28 = t27**(1.D0/3.D0)
      t32 = t27**(1.D0/6.D0)
      t35 = dsqrt(t27)
      t37 = t28**2
      t43 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t32
     #+0.3844746237447211D1*t28+0.1644733775567609D1*t35
     #+0.2405871291288192D0*t37))
      t45 = 1.D0+0.2D0*t8
      t49 = t45**2
      zk(i) = -0.9305257363491D0*t2*rhob*(0.789518D0+0.229522D-2*t8
     #/t10+0.105756D-4*t19/t20)-0.3109D-1*rhob*(1.D0
     #+0.1274696188700087D0*t28)*t43*(0.820011D-1+0.543362D0*t8/t45
     #-0.1148412D0*t19/t49)
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t4 = rhoa**2
      t5 = t2**2
      t8 = sigmaaa/t5/t4
      t10 = 1.D0+0.4D-2*t8
      t14 = sigmaaa**2
      t15 = t4**2
      t19 = t14/t2/t15/rhoa
      t20 = t10**2
      t27 = 1/rhoa
      t28 = t27**(1.D0/3.D0)
      t32 = t27**(1.D0/6.D0)
      t35 = dsqrt(t27)
      t37 = t28**2
      t43 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t32
     #+0.3844746237447211D1*t28+0.1644733775567609D1*t35
     #+0.2405871291288192D0*t37))
      t45 = 1.D0+0.2D0*t8
      t49 = t45**2
      zk(i) = -0.9305257363491D0*t2*rhoa*(0.789518D0+0.229522D-2*t8
     #/t10+0.105756D-4*t19/t20)-0.3109D-1*rhoa*(1.D0
     #+0.1274696188700087D0*t28)*t43*(0.820011D-1+0.543362D0*t8/t45
     #-0.1148412D0*t19/t49)
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t6 = rhoa**2
      t7 = t4**2
      t10 = sigmaaa/t7/t6
      t12 = 1.D0+0.4D-2*t10
      t16 = sigmaaa**2
      t17 = t6**2
      t21 = t16/t4/t17/rhoa
      t22 = t12**2
      t29 = 1/rhoa
      t30 = t29**(1.D0/3.D0)
      t33 = rhoa*(1.D0+0.1274696188700087D0*t30)
      t34 = t29**(1.D0/6.D0)
      t37 = dsqrt(t29)
      t39 = t30**2
      t45 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t34
     #+0.3844746237447211D1*t30+0.1644733775567609D1*t37
     #+0.2405871291288192D0*t39))
      t47 = 1.D0+0.2D0*t10
      t51 = t47**2
      t59 = rhob**(1.D0/3.D0)
      t61 = rhob**2
      t62 = t59**2
      t65 = sigmabb/t62/t61
      t67 = 1.D0+0.4D-2*t65
      t71 = sigmabb**2
      t72 = t61**2
      t76 = t71/t59/t72/rhob
      t77 = t67**2
      t84 = 1/rhob
      t85 = t84**(1.D0/3.D0)
      t88 = rhob*(1.D0+0.1274696188700087D0*t85)
      t89 = t84**(1.D0/6.D0)
      t92 = dsqrt(t84)
      t94 = t85**2
      t100 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t89
     #+0.3844746237447211D1*t85+0.1644733775567609D1*t92
     #+0.2405871291288192D0*t94))
      t102 = 1.D0+0.2D0*t65
      t106 = t102**2
      t114 = rhoa+rhob
      t115 = 1/t114
      t116 = t115**(1.D0/3.D0)
      t119 = t115**(1.D0/6.D0)
      t122 = dsqrt(t115)
      t124 = t116**2
      t130 = dlog(1.D0+0.160818243221511D2/(0.598255043577108D1*t119
     #+0.2225569421150687D1*t116+0.8004286349993634D0*t122
     #+0.1897004325747559D0*t124))
      t132 = 0.62182D-1*(1.D0+0.1325688999052018D0*t116)*t130
      t143 = dlog(1.D0+0.2960857464321668D2/(0.8157414703487641D1*t119
     #+0.2247591863577616D1*t116+0.4300972471276643D0*t122
     #+0.1911512595127338D0*t124))
      t146 = rhoa-1.D0*rhob
      t147 = t146*t115
      t148 = 1.D0+t147
      t149 = t148**(1.D0/3.D0)
      t152 = 1.D0-1.D0*t147
      t153 = t152**(1.D0/3.D0)
      t155 = t149*t148+t153*t152-2.D0
      t156 = t146**2
      t157 = t156**2
      t158 = t114**2
      t159 = t158**2
      t161 = t157/t159
      t177 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t119
     #+0.3844746237447211D1*t116+0.1644733775567609D1*t122
     #+0.2405871291288192D0*t124))
      t193 = 0.5D0*t10+0.5D0*t65
      t196 = 1.D0+0.3D-2*t10+0.3D-2*t65
      t200 = t193**2
      t201 = t196**2
      zk(i) = -0.9305257363491D0*t4*rhoa*(0.789518D0+0.229522D-2*t10
     #/t12+0.105756D-4*t21/t22)-0.3109D-1*t33*t45*(0.820011D-1
     #+0.543362D0*t10/t47-0.1148412D0*t21/t51)-0.9305257363491D0*t59
     #*rhob*(0.789518D0+0.229522D-2*t65/t67+0.105756D-4*t76/t77)
     #-0.3109D-1*t88*t100*(0.820011D-1+0.543362D0*t65/t102-0.1148412D0
     #*t76/t106)+(t114*(-t132+0.3799574853701528D-1*(1.D0
     #+0.6901399211255825D-1*t116)*t143*t155*(1.D0-1.D0*t161)
     #+0.1923661050931536D1*(-0.3109D-1*(1.D0+0.1274696188700087D0
     #*t116)*t177+t132)*t155*t161)+0.3109D-1*t33*t45+0.3109D-1*t88
     #*t100)*(0.955689D0+0.4731312D-2*t193/t196-0.19723284D-3*t200/t201)
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t3 = t2*rhob
      t4 = rhob**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigmabb*t7
      t10 = 1.D0+0.4D-2*t8
      t11 = 1/t10
      t14 = sigmabb**2
      t15 = t4**2
      t18 = 1/t2/t15/rhob
      t19 = t14*t18
      t20 = t10**2
      t21 = 1/t20
      t24 = 0.789518D0+0.229522D-2*t8*t11+0.105756D-4*t19*t21
      t27 = 1/rhob
      t28 = t27**(1.D0/3.D0)
      t30 = 1.D0+0.1274696188700087D0*t28
      t31 = rhob*t30
      t32 = t27**(1.D0/6.D0)
      t35 = dsqrt(t27)
      t37 = t28**2
      t39 = 0.1112037486309468D2*t32+0.3844746237447211D1*t28
     #+0.1644733775567609D1*t35+0.2405871291288192D0*t37
      t42 = 1.D0+0.321646831778707D2/t39
      t43 = dlog(t42)
      t45 = 1.D0+0.2D0*t8
      t46 = 1/t45
      t49 = t45**2
      t50 = 1/t49
      t53 = 0.820011D-1+0.543362D0*t8*t46-0.1148412D0*t19*t50
      t54 = t43*t53
      zk(i) = -0.9305257363491D0*t3*t24-0.3109D-1*t31*t54
      vrhoa(i) = 0.D0
      t62 = sigmabb/t5/t4/rhob
      t68 = t14/t2/t15/t4
      t72 = t15**2
      t75 = t14*sigmabb/t72/rhob
      t77 = 1/t20/t10
      t86 = 1/t37
      t90 = t39**2
      t93 = t32**2
      t94 = t93**2
      t97 = 1/t4
      t119 = 1/t49/t45
      vrhob(i) = -0.12407009817988D1*t2*t24-0.9305257363491D0*t3*(
     #-0.6120586666666667D-2*t62*t11-0.3192085333333333D-4*t68*t21
     #+0.2256128D-6*t75*t77)-0.3109D-1*t30*t43*t53
     #+0.1321010150222857D-2*t27*t86*t54+0.1D1*t31/t90*(
     #-0.1853395810515781D1/t94/t32*t97-0.128158207914907D1*t86*t97
     #-0.8223668877838045D0/t35*t97-0.1603914194192128D0/t28*t97)/t42
     #*t53-0.3109D-1*t31*t43*(-0.1448965333333333D1*t62*t46
     #+0.9022794666666667D0*t68*t50-0.12249728D0*t75*t119)
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      t128 = sigmabb*t18
      t132 = t14/t72
      vsigmabb(i) = -0.9305257363491D0*t3*(0.229522D-2*t7*t11
     #+0.1197032D-4*t128*t21-0.846048D-7*t132*t77)-0.3109D-1*t31*t43*
     #(0.543362D0*t7*t46-0.3383548D0*t128*t50+0.4593648D-1*t132*t119)
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t3 = t2*rhoa
      t4 = rhoa**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigmaaa*t7
      t10 = 1.D0+0.4D-2*t8
      t11 = 1/t10
      t14 = sigmaaa**2
      t15 = t4**2
      t18 = 1/t2/t15/rhoa
      t19 = t14*t18
      t20 = t10**2
      t21 = 1/t20
      t24 = 0.789518D0+0.229522D-2*t8*t11+0.105756D-4*t19*t21
      t27 = 1/rhoa
      t28 = t27**(1.D0/3.D0)
      t30 = 1.D0+0.1274696188700087D0*t28
      t31 = rhoa*t30
      t32 = t27**(1.D0/6.D0)
      t35 = dsqrt(t27)
      t37 = t28**2
      t39 = 0.1112037486309468D2*t32+0.3844746237447211D1*t28
     #+0.1644733775567609D1*t35+0.2405871291288192D0*t37
      t42 = 1.D0+0.321646831778707D2/t39
      t43 = dlog(t42)
      t45 = 1.D0+0.2D0*t8
      t46 = 1/t45
      t49 = t45**2
      t50 = 1/t49
      t53 = 0.820011D-1+0.543362D0*t8*t46-0.1148412D0*t19*t50
      t54 = t43*t53
      zk(i) = -0.9305257363491D0*t3*t24-0.3109D-1*t31*t54
      t62 = sigmaaa/t5/t4/rhoa
      t68 = t14/t2/t15/t4
      t72 = t15**2
      t75 = t14*sigmaaa/t72/rhoa
      t77 = 1/t20/t10
      t86 = 1/t37
      t90 = t39**2
      t93 = t32**2
      t94 = t93**2
      t97 = 1/t4
      t119 = 1/t49/t45
      vrhoa(i) = -0.12407009817988D1*t2*t24-0.9305257363491D0*t3*(
     #-0.6120586666666667D-2*t62*t11-0.3192085333333333D-4*t68*t21
     #+0.2256128D-6*t75*t77)-0.3109D-1*t30*t43*t53
     #+0.1321010150222857D-2*t27*t86*t54+0.1D1*t31/t90*(
     #-0.1853395810515781D1/t94/t32*t97-0.128158207914907D1*t86*t97
     #-0.8223668877838045D0/t35*t97-0.1603914194192128D0/t28*t97)/t42
     #*t53-0.3109D-1*t31*t43*(-0.1448965333333333D1*t62*t46
     #+0.9022794666666667D0*t68*t50-0.12249728D0*t75*t119)
      vrhob(i) = 0.D0
      t128 = sigmaaa*t18
      t132 = t14/t72
      vsigmaaa(i) = -0.9305257363491D0*t3*(0.229522D-2*t7*t11
     #+0.1197032D-4*t128*t21-0.846048D-7*t132*t77)-0.3109D-1*t31*t43*
     #(0.543362D0*t7*t46-0.3383548D0*t128*t50+0.4593648D-1*t132*t119)
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t5 = t4*rhoa
      t6 = rhoa**2
      t7 = t4**2
      t9 = 1/t7/t6
      t10 = sigmaaa*t9
      t12 = 1.D0+0.4D-2*t10
      t13 = 1/t12
      t16 = sigmaaa**2
      t17 = t6**2
      t20 = 1/t4/t17/rhoa
      t21 = t16*t20
      t22 = t12**2
      t23 = 1/t22
      t26 = 0.789518D0+0.229522D-2*t10*t13+0.105756D-4*t21*t23
      t29 = 1/rhoa
      t30 = t29**(1.D0/3.D0)
      t32 = 1.D0+0.1274696188700087D0*t30
      t33 = rhoa*t32
      t34 = t29**(1.D0/6.D0)
      t37 = dsqrt(t29)
      t39 = t30**2
      t41 = 0.1112037486309468D2*t34+0.3844746237447211D1*t30
     #+0.1644733775567609D1*t37+0.2405871291288192D0*t39
      t44 = 1.D0+0.321646831778707D2/t41
      t45 = dlog(t44)
      t47 = 1.D0+0.2D0*t10
      t48 = 1/t47
      t51 = t47**2
      t52 = 1/t51
      t55 = 0.820011D-1+0.543362D0*t10*t48-0.1148412D0*t21*t52
      t56 = t45*t55
      t59 = rhob**(1.D0/3.D0)
      t60 = t59*rhob
      t61 = rhob**2
      t62 = t59**2
      t64 = 1/t62/t61
      t65 = sigmabb*t64
      t67 = 1.D0+0.4D-2*t65
      t68 = 1/t67
      t71 = sigmabb**2
      t72 = t61**2
      t75 = 1/t59/t72/rhob
      t76 = t71*t75
      t77 = t67**2
      t78 = 1/t77
      t81 = 0.789518D0+0.229522D-2*t65*t68+0.105756D-4*t76*t78
      t84 = 1/rhob
      t85 = t84**(1.D0/3.D0)
      t87 = 1.D0+0.1274696188700087D0*t85
      t88 = rhob*t87
      t89 = t84**(1.D0/6.D0)
      t92 = dsqrt(t84)
      t94 = t85**2
      t96 = 0.1112037486309468D2*t89+0.3844746237447211D1*t85
     #+0.1644733775567609D1*t92+0.2405871291288192D0*t94
      t99 = 1.D0+0.321646831778707D2/t96
      t100 = dlog(t99)
      t102 = 1.D0+0.2D0*t65
      t103 = 1/t102
      t106 = t102**2
      t107 = 1/t106
      t110 = 0.820011D-1+0.543362D0*t65*t103-0.1148412D0*t76*t107
      t111 = t100*t110
      t114 = rhoa+rhob
      t115 = 1/t114
      t116 = t115**(1.D0/3.D0)
      t118 = 1.D0+0.1325688999052018D0*t116
      t119 = t115**(1.D0/6.D0)
      t122 = dsqrt(t115)
      t124 = t116**2
      t126 = 0.598255043577108D1*t119+0.2225569421150687D1*t116
     #+0.8004286349993634D0*t122+0.1897004325747559D0*t124
      t129 = 1.D0+0.160818243221511D2/t126
      t130 = dlog(t129)
      t132 = 0.62182D-1*t118*t130
      t134 = 1.D0+0.6901399211255825D-1*t116
      t139 = 0.8157414703487641D1*t119+0.2247591863577616D1*t116
     #+0.4300972471276643D0*t122+0.1911512595127338D0*t124
      t142 = 1.D0+0.2960857464321668D2/t139
      t143 = dlog(t142)
      t144 = t134*t143
      t146 = rhoa-1.D0*rhob
      t147 = t146*t115
      t148 = 1.D0+t147
      t149 = t148**(1.D0/3.D0)
      t152 = 1.D0-1.D0*t147
      t153 = t152**(1.D0/3.D0)
      t155 = t149*t148+t153*t152-2.D0
      t156 = t146**2
      t157 = t156**2
      t158 = t114**2
      t159 = t158**2
      t160 = 1/t159
      t161 = t157*t160
      t163 = 1.D0-1.D0*t161
      t166 = 0.3799574853701528D-1*t144*t155*t163
      t168 = 1.D0+0.1274696188700087D0*t116
      t173 = 0.1112037486309468D2*t119+0.3844746237447211D1*t116
     #+0.1644733775567609D1*t122+0.2405871291288192D0*t124
      t176 = 1.D0+0.321646831778707D2/t173
      t177 = dlog(t176)
      t180 = -0.3109D-1*t168*t177+t132
      t181 = t180*t155
      t183 = 0.1923661050931536D1*t181*t161
      t190 = t114*(-t132+t166+t183)+0.3109D-1*t33*t45+0.3109D-1*t88*t100
      t193 = 0.5D0*t10+0.5D0*t65
      t196 = 1.D0+0.3D-2*t10+0.3D-2*t65
      t197 = 1/t196
      t200 = t193**2
      t201 = t196**2
      t202 = 1/t201
      t205 = 0.955689D0+0.4731312D-2*t193*t197-0.19723284D-3*t200*t202
      zk(i) = -0.9305257363491D0*t5*t26-0.3109D-1*t33*t56
     #-0.9305257363491D0*t60*t81-0.3109D-1*t88*t111+t190*t205
      t212 = sigmaaa/t7/t6/rhoa
      t218 = t16/t4/t17/t6
      t222 = t17**2
      t225 = t16*sigmaaa/t222/rhoa
      t227 = 1/t22/t12
      t233 = t32*t45
      t236 = 1/t39
      t237 = t29*t236
      t240 = t41**2
      t241 = 1/t240
      t243 = t34**2
      t244 = t243**2
      t247 = 1/t6
      t258 = -0.1853395810515781D1/t244/t34*t247-0.128158207914907D1
     #*t236*t247-0.8223668877838045D0/t37*t247-0.1603914194192128D0
     #/t30*t247
      t259 = 1/t44
      t269 = 1/t51/t47
      t277 = 1/t158
      t278 = 1/t124*t277
      t279 = t278*t130
      t280 = 0.2747799777968419D-2*t279
      t281 = t126**2
      t284 = t119**2
      t285 = t284**2
      t288 = 1/t285/t119*t277
      t292 = 1/t122*t277
      t295 = 1/t116*t277
      t300 = t118/t281*(-0.99709173929518D0*t288-0.7418564737168958D0
     #*t278-0.4002143174996817D0*t292-0.1264669550498372D0*t295)/t129
      t301 = 0.1D1*t300
      t305 = 0.8740794299481065D-3*t278*t143*t155*t163
      t306 = t139**2
      t319 = 0.1124999956683108D1*t134/t306*(-0.135956911724794D1*t288
     #-0.7491972878592054D0*t278-0.2150486235638321D0*t292
     #-0.1274341730084892D0*t295)/t142*t155*t163
      t320 = t146*t277
      t321 = 1.D0*t320
      t325 = 1.D0*t115
      t329 = 0.1333333333333333D1*t149*(t115-t321)
     #+0.1333333333333333D1*t153*(-t325+t320)
      t334 = t156*t146*t160
      t335 = 4.D0*t334
      t338 = t157/t159/t114
      t339 = 4.D0*t338
      t346 = t173**2
      t363 = 0.1923661050931536D1*(0.1321010150222857D-2*t278*t177
     #+0.1D1*t168/t346*(-0.1853395810515781D1*t288-0.128158207914907D1
     #*t278-0.8223668877838045D0*t292-0.1603914194192128D0*t295)/t176
     #-0.2747799777968419D-2*t279-0.1D1*t300)*t155*t161
      t367 = t181*t334
      t370 = 0.7694644203726145D1*t181*t338
      t384 = t193*t202
      t389 = t200/t201/t196
      s1 = -0.12407009817988D1*t4*t26-0.9305257363491D0*t5*(
     #-0.6120586666666667D-2*t212*t13-0.3192085333333333D-4*t218*t23
     #+0.2256128D-6*t225*t227)-0.3109D-1*t233*t55
     #+0.1321010150222857D-2*t237*t56
      vrhoa(i) = s1+0.1D1*t33*t241*t258*t259*t55-0.3109D-1*t33*t45*(
     #-0.1448965333333333D1*t212*t48+0.9022794666666667D0*t218*t52
     #-0.12249728D0*t225*t269)+(-t132+t166+t183+t114*(t280+t301-t305
     #-t319+0.3799574853701528D-1*t144*t329*t163+0.3799574853701528D-1
     #*t144*t155*(-t335+t339)+t363+0.1923661050931536D1*t180*t329*t161
     #+0.7694644203726145D1*t367-t370)+0.3109D-1*t233
     #-0.1321010150222857D-2*t237*t45-0.1D1*t33*t241*t258*t259)*t205
     #+t190*(-0.6308416D-2*t212*t197+0.563804736D-3*t384*t212
     #-0.315572544D-5*t389*t212)
      t399 = sigmabb/t62/t61/rhob
      t405 = t71/t59/t72/t61
      t409 = t72**2
      t412 = t71*sigmabb/t409/rhob
      t414 = 1/t77/t67
      t420 = t87*t100
      t423 = 1/t94
      t424 = t84*t423
      t427 = t96**2
      t428 = 1/t427
      t430 = t89**2
      t431 = t430**2
      t434 = 1/t61
      t445 = -0.1853395810515781D1/t431/t89*t434-0.128158207914907D1
     #*t423*t434-0.8223668877838045D0/t92*t434-0.1603914194192128D0
     #/t85*t434
      t446 = 1/t99
      t456 = 1/t106/t102
      t469 = 0.1333333333333333D1*t149*(-t325-t321)
     #+0.1333333333333333D1*t153*(t115+t320)
      s1 = -0.12407009817988D1*t59*t81-0.9305257363491D0*t60*(
     #-0.6120586666666667D-2*t399*t68-0.3192085333333333D-4*t405*t78
     #+0.2256128D-6*t412*t414)-0.3109D-1*t420*t110
     #+0.1321010150222857D-2*t424*t111
      vrhob(i) = s1+0.1D1*t88*t428*t445*t446*t110-0.3109D-1*t88*t100*(
     #-0.1448965333333333D1*t399*t103+0.9022794666666667D0*t405*t107
     #-0.12249728D0*t412*t456)+(-t132+t166+t183+t114*(t280+t301-t305
     #-t319+0.3799574853701528D-1*t144*t469*t163+0.3799574853701528D-1
     #*t144*t155*(t335+t339)+t363+0.1923661050931536D1*t180*t469*t161
     #-0.7694644203726145D1*t367-t370)+0.3109D-1*t420
     #-0.1321010150222857D-2*t424*t100-0.1D1*t88*t428*t445*t446)*t205
     #+t190*(-0.6308416D-2*t399*t197+0.563804736D-3*t384*t399
     #-0.315572544D-5*t389*t399)
      t502 = sigmaaa*t20
      t506 = t16/t222
      vsigmaaa(i) = -0.9305257363491D0*t5*(0.229522D-2*t9*t13
     #+0.1197032D-4*t502*t23-0.846048D-7*t506*t227)-0.3109D-1*t33*t45*
     #(0.543362D0*t9*t48-0.3383548D0*t502*t52+0.4593648D-1*t506*t269)
     #+t190*(0.2365656D-2*t9*t197-0.211426776D-3*t384*t9
     #+0.118339704D-5*t389*t9)
      vsigmaab(i) = 0.D0
      t532 = sigmabb*t75
      t536 = t71/t409
      vsigmabb(i) = -0.9305257363491D0*t60*(0.229522D-2*t64*t68
     #+0.1197032D-4*t532*t78-0.846048D-7*t536*t414)-0.3109D-1*t88*t100
     #*(0.543362D0*t64*t103-0.3383548D0*t532*t107+0.4593648D-1*t536
     #*t456)+t190*(0.2365656D-2*t64*t197-0.211426776D-3*t384*t64
     #+0.118339704D-5*t389*t64)
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t3 = t2*rhob
      t4 = rhob**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigmabb*t7
      t10 = 1.D0+0.4D-2*t8
      t11 = 1/t10
      t14 = sigmabb**2
      t15 = t4**2
      t18 = 1/t2/t15/rhob
      t19 = t14*t18
      t20 = t10**2
      t21 = 1/t20
      t24 = 0.789518D0+0.229522D-2*t8*t11+0.105756D-4*t19*t21
      t27 = 1/rhob
      t28 = t27**(1.D0/3.D0)
      t30 = 1.D0+0.1274696188700087D0*t28
      t31 = rhob*t30
      t32 = t27**(1.D0/6.D0)
      t35 = dsqrt(t27)
      t37 = t28**2
      t39 = 0.1112037486309468D2*t32+0.3844746237447211D1*t28
     #+0.1644733775567609D1*t35+0.2405871291288192D0*t37
      t42 = 1.D0+0.321646831778707D2/t39
      t43 = dlog(t42)
      t45 = 1.D0+0.2D0*t8
      t46 = 1/t45
      t49 = t45**2
      t50 = 1/t49
      t53 = 0.820011D-1+0.543362D0*t8*t46-0.1148412D0*t19*t50
      t54 = t43*t53
      zk(i) = -0.9305257363491D0*t3*t24-0.3109D-1*t31*t54
      vrhoa(i) = 0.D0
      t59 = t4*rhob
      t62 = sigmabb/t5/t59
      t68 = t14/t2/t15/t4
      t71 = t14*sigmabb
      t72 = t15**2
      t75 = t71/t72/rhob
      t77 = 1/t20/t10
      t80 = -0.6120586666666667D-2*t62*t11-0.3192085333333333D-4*t68
     #*t21+0.2256128D-6*t75*t77
      t83 = t30*t43
      t86 = 1/t37
      t87 = t27*t86
      t90 = t39**2
      t91 = 1/t90
      t92 = t31*t91
      t93 = t32**2
      t94 = t93**2
      t95 = t94*t32
      t96 = 1/t95
      t97 = 1/t4
      t102 = 1/t35
      t105 = 1/t28
      t108 = -0.1853395810515781D1*t96*t97-0.128158207914907D1*t86*t97
     #-0.8223668877838045D0*t102*t97-0.1603914194192128D0*t105*t97
      t109 = 1/t42
      t110 = t108*t109
      t111 = t110*t53
      t119 = 1/t49/t45
      t122 = -0.1448965333333333D1*t62*t46+0.9022794666666667D0*t68
     #*t50-0.12249728D0*t75*t119
      t123 = t43*t122
      vrhob(i) = -0.12407009817988D1*t2*t24-0.9305257363491D0*t3*t80
     #-0.3109D-1*t83*t53+0.1321010150222857D-2*t87*t54+0.1D1*t92*t111
     #-0.3109D-1*t31*t123
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      t128 = sigmabb*t18
      t131 = 1/t72
      t132 = t14*t131
      vsigmabb(i) = -0.9305257363491D0*t3*(0.229522D-2*t7*t11
     #+0.1197032D-4*t128*t21-0.846048D-7*t132*t77)-0.3109D-1*t31*t43*
     #(0.543362D0*t7*t46-0.3383548D0*t128*t50+0.4593648D-1*t132*t119)
      v2rhoa2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t155 = sigmabb/t5/t15
      t161 = t14/t2/t15/t59
      t164 = t72*t4
      t166 = t71/t164
      t169 = t14**2
      t173 = t169/t5/t72/t15
      t174 = t20**2
      t175 = 1/t174
      t186 = 1/t59
      t188 = 1/t37/t27
      t200 = t108**2
      t207 = 1/t15
      t233 = t90**2
      t236 = t42**2
      t251 = t49**2
      t252 = 1/t251
      s1 = -0.4135669939329333D0/t5*t24-0.24814019635976D1*t2*t80
     #-0.9305257363491D0*t3*(0.2244215111111111D-1*t155*t11
     #+0.1368791466666667D-3*t161*t21-0.2711493404444444D-5*t166*t77
     #+0.72196096D-8*t173*t175)+0.2D1*t30*t91*t111-0.6218D-1*t83*t122
     #+0.8806734334819047D-3*t186*t188*t54
      v2rhob2(i) = s1-0.8497974591333914D-1*t87*t91*t111
     #+0.2642020300445714D-2*t87*t123-0.2D1*t31/t90/t39*t200*t109*t53
     #+0.1D1*t92*(-0.1544496508763151D1/t95/t27*t207
     #+0.3706791621031562D1*t96*t186-0.854388052766047D0*t188*t207
     #+0.2563164158298141D1*t86*t186-0.4111834438919023D0/t35/t27*t207
     #+0.1644733775567609D1*t102*t186-0.5346380647307093D-1/t28/t27
     #*t207+0.3207828388384256D0*t105*t186)*t109*t53
     #+0.321646831778707D2*t31/t233*t200/t236*t53+0.2D1*t92*t110*t122
     #-0.3109D-1*t31*t43*(0.5312872888888889D1*t155*t46
     #-0.6487218133333333D1*t161*t50+0.2064906951111111D1*t166*t119
     #-0.195995648D0*t173*t252)
      v2sigmaaa2(i) = 0.D0
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      t261 = sigmabb*t131
      t266 = t14/t5/t164
      v2sigmabb2(i) = -0.9305257363491D0*t3*(0.278944D-5*t18*t21
     #-0.26497216D-6*t261*t77+0.10152576D-8*t266*t175)-0.3109D-1*t31
     #*t43*(-0.4470272D0*t18*t50+0.22721488D0*t261*t119-0.27561888D-1
     #*t266*t252)
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t3 = t2*rhoa
      t4 = rhoa**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigmaaa*t7
      t10 = 1.D0+0.4D-2*t8
      t11 = 1/t10
      t14 = sigmaaa**2
      t15 = t4**2
      t18 = 1/t2/t15/rhoa
      t19 = t14*t18
      t20 = t10**2
      t21 = 1/t20
      t24 = 0.789518D0+0.229522D-2*t8*t11+0.105756D-4*t19*t21
      t27 = 1/rhoa
      t28 = t27**(1.D0/3.D0)
      t30 = 1.D0+0.1274696188700087D0*t28
      t31 = rhoa*t30
      t32 = t27**(1.D0/6.D0)
      t35 = dsqrt(t27)
      t37 = t28**2
      t39 = 0.1112037486309468D2*t32+0.3844746237447211D1*t28
     #+0.1644733775567609D1*t35+0.2405871291288192D0*t37
      t42 = 1.D0+0.321646831778707D2/t39
      t43 = dlog(t42)
      t45 = 1.D0+0.2D0*t8
      t46 = 1/t45
      t49 = t45**2
      t50 = 1/t49
      t53 = 0.820011D-1+0.543362D0*t8*t46-0.1148412D0*t19*t50
      t54 = t43*t53
      zk(i) = -0.9305257363491D0*t3*t24-0.3109D-1*t31*t54
      t59 = t4*rhoa
      t62 = sigmaaa/t5/t59
      t68 = t14/t2/t15/t4
      t71 = t14*sigmaaa
      t72 = t15**2
      t75 = t71/t72/rhoa
      t77 = 1/t20/t10
      t80 = -0.6120586666666667D-2*t62*t11-0.3192085333333333D-4*t68
     #*t21+0.2256128D-6*t75*t77
      t83 = t30*t43
      t86 = 1/t37
      t87 = t27*t86
      t90 = t39**2
      t91 = 1/t90
      t92 = t31*t91
      t93 = t32**2
      t94 = t93**2
      t95 = t94*t32
      t96 = 1/t95
      t97 = 1/t4
      t102 = 1/t35
      t105 = 1/t28
      t108 = -0.1853395810515781D1*t96*t97-0.128158207914907D1*t86*t97
     #-0.8223668877838045D0*t102*t97-0.1603914194192128D0*t105*t97
      t109 = 1/t42
      t110 = t108*t109
      t111 = t110*t53
      t119 = 1/t49/t45
      t122 = -0.1448965333333333D1*t62*t46+0.9022794666666667D0*t68
     #*t50-0.12249728D0*t75*t119
      t123 = t43*t122
      vrhoa(i) = -0.12407009817988D1*t2*t24-0.9305257363491D0*t3*t80
     #-0.3109D-1*t83*t53+0.1321010150222857D-2*t87*t54+0.1D1*t92*t111
     #-0.3109D-1*t31*t123
      vrhob(i) = 0.D0
      t128 = sigmaaa*t18
      t131 = 1/t72
      t132 = t14*t131
      vsigmaaa(i) = -0.9305257363491D0*t3*(0.229522D-2*t7*t11
     #+0.1197032D-4*t128*t21-0.846048D-7*t132*t77)-0.3109D-1*t31*t43*
     #(0.543362D0*t7*t46-0.3383548D0*t128*t50+0.4593648D-1*t132*t119)
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      t155 = sigmaaa/t5/t15
      t161 = t14/t2/t15/t59
      t164 = t72*t4
      t166 = t71/t164
      t169 = t14**2
      t173 = t169/t5/t72/t15
      t174 = t20**2
      t175 = 1/t174
      t186 = 1/t59
      t188 = 1/t37/t27
      t200 = t108**2
      t207 = 1/t15
      t233 = t90**2
      t236 = t42**2
      t251 = t49**2
      t252 = 1/t251
      s1 = -0.4135669939329333D0/t5*t24-0.24814019635976D1*t2*t80
     #-0.9305257363491D0*t3*(0.2244215111111111D-1*t155*t11
     #+0.1368791466666667D-3*t161*t21-0.2711493404444444D-5*t166*t77
     #+0.72196096D-8*t173*t175)+0.2D1*t30*t91*t111-0.6218D-1*t83*t122
     #+0.8806734334819047D-3*t186*t188*t54
      v2rhoa2(i) = s1-0.8497974591333914D-1*t87*t91*t111
     #+0.2642020300445714D-2*t87*t123-0.2D1*t31/t90/t39*t200*t109*t53
     #+0.1D1*t92*(-0.1544496508763151D1/t95/t27*t207
     #+0.3706791621031562D1*t96*t186-0.854388052766047D0*t188*t207
     #+0.2563164158298141D1*t86*t186-0.4111834438919023D0/t35/t27*t207
     #+0.1644733775567609D1*t102*t186-0.5346380647307093D-1/t28/t27
     #*t207+0.3207828388384256D0*t105*t186)*t109*t53
     #+0.321646831778707D2*t31/t233*t200/t236*t53+0.2D1*t92*t110*t122
     #-0.3109D-1*t31*t43*(0.5312872888888889D1*t155*t46
     #-0.6487218133333333D1*t161*t50+0.2064906951111111D1*t166*t119
     #-0.195995648D0*t173*t252)
      v2rhob2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t261 = sigmaaa*t131
      t266 = t14/t5/t164
      v2sigmaaa2(i) = -0.9305257363491D0*t3*(0.278944D-5*t18*t21
     #-0.26497216D-6*t261*t77+0.10152576D-8*t266*t175)-0.3109D-1*t31
     #*t43*(-0.4470272D0*t18*t50+0.22721488D0*t261*t119-0.27561888D-1
     #*t266*t252)
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      v2sigmabb2(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t5 = t4*rhoa
      t6 = rhoa**2
      t7 = t4**2
      t9 = 1/t7/t6
      t10 = sigmaaa*t9
      t12 = 1.D0+0.4D-2*t10
      t13 = 1/t12
      t16 = sigmaaa**2
      t17 = t6**2
      t20 = 1/t4/t17/rhoa
      t21 = t16*t20
      t22 = t12**2
      t23 = 1/t22
      t26 = 0.789518D0+0.229522D-2*t10*t13+0.105756D-4*t21*t23
      t29 = 1/rhoa
      t30 = t29**(1.D0/3.D0)
      t32 = 1.D0+0.1274696188700087D0*t30
      t33 = rhoa*t32
      t34 = t29**(1.D0/6.D0)
      t37 = dsqrt(t29)
      t39 = t30**2
      t41 = 0.1112037486309468D2*t34+0.3844746237447211D1*t30
     #+0.1644733775567609D1*t37+0.2405871291288192D0*t39
      t44 = 1.D0+0.321646831778707D2/t41
      t45 = dlog(t44)
      t47 = 1.D0+0.2D0*t10
      t48 = 1/t47
      t51 = t47**2
      t52 = 1/t51
      t55 = 0.820011D-1+0.543362D0*t10*t48-0.1148412D0*t21*t52
      t56 = t45*t55
      t59 = rhob**(1.D0/3.D0)
      t60 = t59*rhob
      t61 = rhob**2
      t62 = t59**2
      t64 = 1/t62/t61
      t65 = sigmabb*t64
      t67 = 1.D0+0.4D-2*t65
      t68 = 1/t67
      t71 = sigmabb**2
      t72 = t61**2
      t75 = 1/t59/t72/rhob
      t76 = t71*t75
      t77 = t67**2
      t78 = 1/t77
      t81 = 0.789518D0+0.229522D-2*t65*t68+0.105756D-4*t76*t78
      t84 = 1/rhob
      t85 = t84**(1.D0/3.D0)
      t87 = 1.D0+0.1274696188700087D0*t85
      t88 = rhob*t87
      t89 = t84**(1.D0/6.D0)
      t92 = dsqrt(t84)
      t94 = t85**2
      t96 = 0.1112037486309468D2*t89+0.3844746237447211D1*t85
     #+0.1644733775567609D1*t92+0.2405871291288192D0*t94
      t99 = 1.D0+0.321646831778707D2/t96
      t100 = dlog(t99)
      t102 = 1.D0+0.2D0*t65
      t103 = 1/t102
      t106 = t102**2
      t107 = 1/t106
      t110 = 0.820011D-1+0.543362D0*t65*t103-0.1148412D0*t76*t107
      t111 = t100*t110
      t114 = rhoa+rhob
      t115 = 1/t114
      t116 = t115**(1.D0/3.D0)
      t118 = 1.D0+0.1325688999052018D0*t116
      t119 = t115**(1.D0/6.D0)
      t122 = dsqrt(t115)
      t124 = t116**2
      t126 = 0.598255043577108D1*t119+0.2225569421150687D1*t116
     #+0.8004286349993634D0*t122+0.1897004325747559D0*t124
      t129 = 1.D0+0.160818243221511D2/t126
      t130 = dlog(t129)
      t132 = 0.62182D-1*t118*t130
      t134 = 1.D0+0.6901399211255825D-1*t116
      t139 = 0.8157414703487641D1*t119+0.2247591863577616D1*t116
     #+0.4300972471276643D0*t122+0.1911512595127338D0*t124
      t142 = 1.D0+0.2960857464321668D2/t139
      t143 = dlog(t142)
      t144 = t134*t143
      t146 = rhoa-1.D0*rhob
      t147 = t146*t115
      t148 = 1.D0+t147
      t149 = t148**(1.D0/3.D0)
      t152 = 1.D0-1.D0*t147
      t153 = t152**(1.D0/3.D0)
      t155 = t149*t148+t153*t152-2.D0
      t156 = t146**2
      t157 = t156**2
      t158 = t114**2
      t159 = t158**2
      t160 = 1/t159
      t161 = t157*t160
      t163 = 1.D0-1.D0*t161
      t164 = t155*t163
      t166 = 0.3799574853701528D-1*t144*t164
      t168 = 1.D0+0.1274696188700087D0*t116
      t173 = 0.1112037486309468D2*t119+0.3844746237447211D1*t116
     #+0.1644733775567609D1*t122+0.2405871291288192D0*t124
      t176 = 1.D0+0.321646831778707D2/t173
      t177 = dlog(t176)
      t180 = -0.3109D-1*t168*t177+t132
      t181 = t180*t155
      t183 = 0.1923661050931536D1*t181*t161
      t190 = t114*(-t132+t166+t183)+0.3109D-1*t33*t45+0.3109D-1*t88*t100
      t193 = 0.5D0*t10+0.5D0*t65
      t196 = 1.D0+0.3D-2*t10+0.3D-2*t65
      t197 = 1/t196
      t200 = t193**2
      t201 = t196**2
      t202 = 1/t201
      t205 = 0.955689D0+0.4731312D-2*t193*t197-0.19723284D-3*t200*t202
      zk(i) = -0.9305257363491D0*t5*t26-0.3109D-1*t33*t56
     #-0.9305257363491D0*t60*t81-0.3109D-1*t88*t111+t190*t205
      t209 = t6*rhoa
      t211 = 1/t7/t209
      t212 = sigmaaa*t211
      t217 = 1/t4/t17/t6
      t218 = t16*t217
      t221 = t16*sigmaaa
      t222 = t17**2
      t224 = 1/t222/rhoa
      t225 = t221*t224
      t227 = 1/t22/t12
      t230 = -0.6120586666666667D-2*t212*t13-0.3192085333333333D-4
     #*t218*t23+0.2256128D-6*t225*t227
      t233 = t32*t45
      t236 = 1/t39
      t237 = t29*t236
      t240 = t41**2
      t241 = 1/t240
      t242 = t33*t241
      t243 = t34**2
      t244 = t243**2
      t245 = t244*t34
      t246 = 1/t245
      t247 = 1/t6
      t252 = 1/t37
      t255 = 1/t30
      t258 = -0.1853395810515781D1*t246*t247-0.128158207914907D1*t236
     #*t247-0.8223668877838045D0*t252*t247-0.1603914194192128D0*t255
     #*t247
      t259 = 1/t44
      t260 = t258*t259
      t261 = t260*t55
      t269 = 1/t51/t47
      t272 = -0.1448965333333333D1*t212*t48+0.9022794666666667D0*t218
     #*t52-0.12249728D0*t225*t269
      t273 = t45*t272
      t276 = 1/t124
      t277 = 1/t158
      t278 = t276*t277
      t279 = t278*t130
      t280 = 0.2747799777968419D-2*t279
      t281 = t126**2
      t282 = 1/t281
      t283 = t118*t282
      t284 = t119**2
      t285 = t284**2
      t286 = t285*t119
      t287 = 1/t286
      t288 = t287*t277
      t291 = 1/t122
      t292 = t291*t277
      t294 = 1/t116
      t295 = t294*t277
      t297 = -0.99709173929518D0*t288-0.7418564737168958D0*t278
     #-0.4002143174996817D0*t292-0.1264669550498372D0*t295
      t298 = 1/t129
      t300 = t283*t297*t298
      t301 = 0.1D1*t300
      t302 = t143*t155
      t303 = t302*t163
      t304 = t278*t303
      t305 = 0.8740794299481065D-3*t304
      t306 = t139**2
      t307 = 1/t306
      t308 = t134*t307
      t313 = -0.135956911724794D1*t288-0.7491972878592054D0*t278
     #-0.2150486235638321D0*t292-0.1274341730084892D0*t295
      t314 = t308*t313
      t315 = 1/t142
      t316 = t315*t155
      t317 = t316*t163
      t318 = t314*t317
      t319 = 0.1124999956683108D1*t318
      t320 = t146*t277
      t321 = 1.D0*t320
      t322 = t115-t321
      t325 = 1.D0*t115
      t326 = -t325+t320
      t329 = 0.1333333333333333D1*t149*t322+0.1333333333333333D1*t153
     #*t326
      t331 = t144*t329*t163
      t332 = 0.3799574853701528D-1*t331
      t333 = t156*t146
      t334 = t333*t160
      t335 = 4.D0*t334
      t337 = 1/t159/t114
      t338 = t157*t337
      t339 = 4.D0*t338
      t340 = -t335+t339
      t342 = t144*t155*t340
      t343 = 0.3799574853701528D-1*t342
      t346 = t173**2
      t347 = 1/t346
      t348 = t168*t347
      t353 = -0.1853395810515781D1*t288-0.128158207914907D1*t278
     #-0.8223668877838045D0*t292-0.1603914194192128D0*t295
      t354 = 1/t176
      t360 = 0.1321010150222857D-2*t278*t177+0.1D1*t348*t353*t354
     #-0.2747799777968419D-2*t279-0.1D1*t300
      t361 = t360*t155
      t362 = t361*t161
      t363 = 0.1923661050931536D1*t362
      t364 = t180*t329
      t365 = t364*t161
      t366 = 0.1923661050931536D1*t365
      t367 = t181*t334
      t369 = t181*t338
      t370 = 0.7694644203726145D1*t369
      t377 = t241*t258*t259
      t380 = -t132+t166+t183+t114*(t280+t301-t305-t319+t332+t343+t363
     #+t366+0.7694644203726145D1*t367-t370)+0.3109D-1*t233
     #-0.1321010150222857D-2*t237*t45-0.1D1*t33*t377
      t384 = t193*t202
      t388 = 1/t201/t196
      t389 = t200*t388
      t392 = -0.6308416D-2*t212*t197+0.563804736D-3*t384*t212
     #-0.315572544D-5*t389*t212
      vrhoa(i) = -0.12407009817988D1*t4*t26-0.9305257363491D0*t5*t230
     #-0.3109D-1*t233*t55+0.1321010150222857D-2*t237*t56+0.1D1*t242
     #*t261-0.3109D-1*t33*t273+t380*t205+t190*t392
      t396 = t61*rhob
      t398 = 1/t62/t396
      t399 = sigmabb*t398
      t404 = 1/t59/t72/t61
      t405 = t71*t404
      t408 = t71*sigmabb
      t409 = t72**2
      t411 = 1/t409/rhob
      t412 = t408*t411
      t414 = 1/t77/t67
      t417 = -0.6120586666666667D-2*t399*t68-0.3192085333333333D-4
     #*t405*t78+0.2256128D-6*t412*t414
      t420 = t87*t100
      t423 = 1/t94
      t424 = t84*t423
      t427 = t96**2
      t428 = 1/t427
      t429 = t88*t428
      t430 = t89**2
      t431 = t430**2
      t432 = t431*t89
      t433 = 1/t432
      t434 = 1/t61
      t439 = 1/t92
      t442 = 1/t85
      t445 = -0.1853395810515781D1*t433*t434-0.128158207914907D1*t423
     #*t434-0.8223668877838045D0*t439*t434-0.1603914194192128D0*t442
     #*t434
      t446 = 1/t99
      t447 = t445*t446
      t448 = t447*t110
      t456 = 1/t106/t102
      t459 = -0.1448965333333333D1*t399*t103+0.9022794666666667D0*t405
     #*t107-0.12249728D0*t412*t456
      t460 = t100*t459
      t463 = -t325-t321
      t466 = t115+t320
      t469 = 0.1333333333333333D1*t149*t463+0.1333333333333333D1*t153
     #*t466
      t471 = t144*t469*t163
      t472 = 0.3799574853701528D-1*t471
      t473 = t335+t339
      t475 = t144*t155*t473
      t476 = 0.3799574853701528D-1*t475
      t477 = t180*t469
      t478 = t477*t161
      t479 = 0.1923661050931536D1*t478
      t487 = t428*t445*t446
      t490 = -t132+t166+t183+t114*(t280+t301-t305-t319+t472+t476+t363
     #+t479-0.7694644203726145D1*t367-t370)+0.3109D-1*t420
     #-0.1321010150222857D-2*t424*t100-0.1D1*t88*t487
      t498 = -0.6308416D-2*t399*t197+0.563804736D-3*t384*t399
     #-0.315572544D-5*t389*t399
      vrhob(i) = -0.12407009817988D1*t59*t81-0.9305257363491D0*t60
     #*t417-0.3109D-1*t420*t110+0.1321010150222857D-2*t424*t111+0.1D1
     #*t429*t448-0.3109D-1*t88*t460+t490*t205+t190*t498
      t502 = sigmaaa*t20
      t505 = 1/t222
      t506 = t16*t505
      t509 = 0.229522D-2*t9*t13+0.1197032D-4*t502*t23-0.846048D-7*t506
     #*t227
      t518 = 0.543362D0*t9*t48-0.3383548D0*t502*t52+0.4593648D-1*t506
     #*t269
      t519 = t45*t518
      t528 = 0.2365656D-2*t9*t197-0.211426776D-3*t384*t9
     #+0.118339704D-5*t389*t9
      vsigmaaa(i) = -0.9305257363491D0*t5*t509-0.3109D-1*t33*t519+t190
     #*t528
      vsigmaab(i) = 0.D0
      t532 = sigmabb*t75
      t535 = 1/t409
      t536 = t71*t535
      t539 = 0.229522D-2*t64*t68+0.1197032D-4*t532*t78-0.846048D-7
     #*t536*t414
      t548 = 0.543362D0*t64*t103-0.3383548D0*t532*t107+0.4593648D-1
     #*t536*t456
      t549 = t100*t548
      t558 = 0.2365656D-2*t64*t197-0.211426776D-3*t384*t64
     #+0.118339704D-5*t389*t64
      vsigmabb(i) = -0.9305257363491D0*t60*t539-0.3109D-1*t88*t549
     #+t190*t558
      t563 = t297**2
      t565 = t118/t281/t126*t563*t298
      t566 = 0.2D1*t565
      t569 = 1/t286/t115*t160
      t572 = 1/t158/t114
      t573 = t287*t572
      t577 = 1/t124/t115*t160
      t579 = t276*t572
      t583 = 1/t122/t115*t160
      t585 = t291*t572
      t589 = 1/t116/t115*t160
      t591 = t294*t572
      t595 = t283*(-0.8309097827459833D0*t569+0.199418347859036D1*t573
     #-0.4945709824779306D0*t577+0.1483712947433792D1*t579
     #-0.2001071587498409D0*t583+0.8004286349993634D0*t585
     #-0.4215565168327908D-1*t589+0.2529339100996745D0*t591)*t298
      t596 = 0.1D1*t595
      t597 = t281**2
      t600 = t129**2
      t603 = t118/t597*t563/t600
      t604 = 0.160818243221511D2*t603
      t616 = 0.1124999956683108D1*t308*(-0.1132974264373283D1*t569
     #+0.271913823449588D1*t573-0.4994648585728036D0*t577
     #+0.1498394575718411D1*t579-0.1075243117819161D0*t583
     #+0.4300972471276643D0*t585-0.4247805766949639D-1*t589
     #+0.2548683460169784D0*t591)*t317
      t618 = 0.5827196199654043D-3*t577*t303
      t621 = t278*t143*t329*t163
      t623 = t577*t130
      t624 = 0.1831866518645613D-2*t623
      t625 = t579*t130
      t626 = 0.5495599555936838D-2*t625
      t628 = t278*t302*t340
      t633 = t313**2
      t636 = 0.2249999913366216D1*t134/t306/t139*t633*t317
      t638 = 0.1748158859896213D-2*t579*t303
      t643 = 0.5176049209143758D-1*t278*t307*t313*t315*t164
      t646 = t278*t282*t297*t298
      t647 = 0.8837926660346786D-1*t646
      t659 = t353**2
      t675 = t346**2
      t678 = t176**2
      t689 = 0.8806734334819047D-3*t577*t177-0.2642020300445714D-2
     #*t579*t177-0.8497974591333914D-1*t278*t347*t353*t354-0.2D1*t168
     #/t346/t173*t659*t354+0.1D1*t348*(-0.1544496508763151D1*t569
     #+0.3706791621031562D1*t573-0.854388052766047D0*t577
     #+0.2563164158298141D1*t579-0.4111834438919023D0*t583
     #+0.1644733775567609D1*t585-0.5346380647307093D-1*t589
     #+0.3207828388384256D0*t591)*t354+0.321646831778707D2*t168/t675
     #*t659/t678-0.1831866518645613D-2*t623+0.5495599555936838D-2*t625
     #+0.8837926660346786D-1*t646+0.2D1*t565-0.1D1*t595
     #-0.160818243221511D2*t603
      t692 = 0.1923661050931536D1*t689*t155*t161
      t693 = -t566+t596+t604-t616-t618-0.1748158859896213D-2*t621+t624
     #-t626-0.1748158859896213D-2*t628+t636+t638+t643-t647+t692
      t694 = t156*t160
      t695 = 12.D0*t694
      t696 = t333*t337
      t697 = 32.D0*t696
      t700 = t157/t159/t158
      t701 = 20.D0*t700
      t706 = t149**2
      t707 = 1/t706
      t708 = t322**2
      t711 = 2.D0*t277
      t713 = 2.D0*t146*t572
      t714 = -t711+t713
      t717 = t153**2
      t718 = 1/t717
      t719 = t326**2
      t725 = 0.4444444444444444D0*t707*t708+0.1333333333333333D1*t149
     #*t714+0.4444444444444444D0*t718*t719-0.1333333333333333D1*t153
     #*t714
      t734 = t314*t315*t329*t163
      t736 = t181*t694
      t737 = 0.2308393261117844D2*t736
      t738 = t364*t338
      t740 = t181*t696
      t743 = 0.3847322101863073D2*t181*t700
      t744 = t306**2
      t748 = t142**2
      t753 = 0.3330964519106732D2*t134/t744*t633/t748*t155*t163
      t755 = t314*t316*t340
      t757 = t364*t334
      t763 = t360*t329*t161
      t765 = t361*t334
      t768 = 0.1538928840745229D2*t361*t338
      t769 = 0.3799574853701528D-1*t144*t155*(-t695+t697-t701)
     #+0.3799574853701528D-1*t144*t725*t163+0.7599149707403056D-1*t144
     #*t329*t340-0.2249999913366216D1*t734+t737-0.1538928840745229D2
     #*t738-0.6155715362980916D2*t740+t743-t753-0.2249999913366216D1
     #*t755+0.1538928840745229D2*t757+0.1923661050931536D1*t180*t725
     #*t161+0.3847322101863073D1*t763+0.1538928840745229D2*t765-t768
      t772 = 1/t209
      t774 = 1/t39/t29
      t775 = t772*t774
      t780 = t32*t241
      t783 = t240**2
      t784 = 1/t783
      t785 = t258**2
      t787 = t44**2
      t788 = 1/t787
      t794 = 1/t17
      t815 = -0.1544496508763151D1/t245/t29*t794+0.3706791621031562D1
     #*t246*t772-0.854388052766047D0*t774*t794+0.2563164158298141D1
     #*t236*t772-0.4111834438919023D0/t37/t29*t794
     #+0.1644733775567609D1*t252*t772-0.5346380647307093D-1/t30/t29
     #*t794+0.3207828388384256D0*t255*t772
      t821 = 1/t240/t41
      t826 = 0.5495599555936838D-2*t279
      t828 = 0.2D1*t300
      t830 = 0.1538928840745229D2*t369
      t833 = 0.1748158859896213D-2*t304
      t834 = 0.2249999913366216D1*t318
      t835 = 0.3847322101863073D1*t362
      t836 = t114*(t693+t769)-0.8806734334819047D-3*t775*t45
     #+0.8497974591333914D-1*t237*t377-0.2D1*t780*t260
     #-0.321646831778707D2*t33*t784*t785*t788-0.1D1*t33*t241*t815*t259
     #+0.2D1*t33*t821*t785*t259+t826+0.7599149707403056D-1*t331+t828
     #+0.1538928840745229D2*t367-t830+0.3847322101863073D1*t365
     #+0.7599149707403056D-1*t342-t833-t834+t835
      t861 = sigmaaa/t7/t17
      t867 = t16/t4/t17/t209
      t870 = t222*t6
      t872 = t221/t870
      t875 = t16**2
      t879 = t875/t7/t222/t17
      t880 = t22**2
      t881 = 1/t880
      t905 = t51**2
      t906 = 1/t905
      t917 = t193*t388
      t922 = t201**2
      t924 = t200/t922
      s1 = t836*t205+0.2D1*t242*t260*t272+0.1D1*t242*t815*t259*t55
     #+0.8806734334819047D-3*t775*t56-0.8497974591333914D-1*t237*t241
     #*t261-0.2D1*t33*t821*t785*t259*t55+0.2642020300445714D-2*t237
     #*t273+0.2D1*t780*t261
      v2rhoa2(i) = s1-0.9305257363491D0*t5*(0.2244215111111111D-1*t861
     #*t13+0.1368791466666667D-3*t867*t23-0.2711493404444444D-5*t872
     #*t227+0.72196096D-8*t879*t881)-0.6218D-1*t233*t272
     #-0.4135669939329333D0/t7*t26-0.24814019635976D1*t4*t230
     #+0.321646831778707D2*t33*t784*t785*t788*t55-0.3109D-1*t33*t45*
     #(0.5312872888888889D1*t861*t48-0.6487218133333333D1*t867*t52
     #+0.2064906951111111D1*t872*t269-0.195995648D0*t879*t906)+t190*
     #(0.2313085866666667D-1*t861*t197-0.802206976D-3*t867*t202
     #+0.17436143616D-4*t917*t867-0.2067284032D-2*t384*t861
     #-0.7573741056D-7*t924*t867+0.1157099328D-4*t389*t861)+2.D0*t380
     #*t392
      t939 = t314*t315*t469*t163
      t941 = -t566+t596+t604-t616-t618+t624-t626+t636+t638+t643-t647
     #+t692-0.2249999913366216D1*t939+t737
      t952 = t314*t316*t473
      t955 = t360*t469*t161
      t957 = t463**2
      t960 = t711+t713
      t963 = t466**2
      t969 = 0.4444444444444444D0*t707*t957+0.1333333333333333D1*t149
     #*t960+0.4444444444444444D0*t718*t963-0.1333333333333333D1*t153
     #*t960
      t973 = t477*t334
      t975 = t477*t338
      t982 = t278*t143*t469*t163
      t985 = t278*t302*t473
      t987 = 0.6155715362980916D2*t740+t743-t753-0.1538928840745229D2
     #*t765-t768+0.7599149707403056D-1*t144*t469*t473
     #+0.3799574853701528D-1*t144*t155*(-t695-t697-t701)
     #-0.2249999913366216D1*t952+0.3847322101863073D1*t955
     #+0.1923661050931536D1*t180*t969*t161-0.1538928840745229D2*t973
     #-0.1538928840745229D2*t975+0.3799574853701528D-1*t144*t969*t163
     #-0.1748158859896213D-2*t982-0.1748158859896213D-2*t985
      t990 = t87*t428
      t993 = 1/t396
      t995 = 1/t94/t84
      t996 = t993*t995
      t1002 = 1/t427/t96
      t1003 = t445**2
      t1010 = 1/t72
      t1031 = -0.1544496508763151D1/t432/t84*t1010
     #+0.3706791621031562D1*t433*t993-0.854388052766047D0*t995*t1010
     #+0.2563164158298141D1*t423*t993-0.4111834438919023D0/t92/t84
     #*t1010+0.1644733775567609D1*t439*t993-0.5346380647307093D-1/t85
     #/t84*t1010+0.3207828388384256D0*t442*t993
      t1036 = t427**2
      t1037 = 1/t1036
      t1039 = t99**2
      t1040 = 1/t1039
      t1044 = t826+t828-0.1538928840745229D2*t367-t830-t833-t834+t835
     #+0.7599149707403056D-1*t471+0.7599149707403056D-1*t475
     #+0.3847322101863073D1*t478+t114*(t941+t987)-0.2D1*t990*t447
     #-0.8806734334819047D-3*t996*t100+0.8497974591333914D-1*t424*t487
     #+0.2D1*t88*t1002*t1003*t446-0.1D1*t88*t428*t1031*t446
     #-0.321646831778707D2*t88*t1037*t1003*t1040
      t1053 = sigmabb/t62/t72
      t1059 = t71/t59/t72/t396
      t1062 = t409*t61
      t1064 = t408/t1062
      t1067 = t71**2
      t1071 = t1067/t62/t409/t72
      t1072 = t77**2
      t1073 = 1/t1072
      t1101 = t106**2
      t1102 = 1/t1101
      s1 = t1044*t205-0.4135669939329333D0/t62*t81-0.24814019635976D1
     #*t59*t417-0.9305257363491D0*t60*(0.2244215111111111D-1*t1053*t68
     #+0.1368791466666667D-3*t1059*t78-0.2711493404444444D-5*t1064
     #*t414+0.72196096D-8*t1071*t1073)-0.6218D-1*t420*t459+0.2D1*t990
     #*t448+0.2642020300445714D-2*t424*t460+0.8806734334819047D-3*t996
     #*t111
      v2rhob2(i) = s1-0.8497974591333914D-1*t424*t428*t448-0.2D1*t88
     #*t1002*t1003*t446*t110-0.3109D-1*t88*t100*(0.5312872888888889D1
     #*t1053*t103-0.6487218133333333D1*t1059*t107+0.2064906951111111D1
     #*t1064*t456-0.195995648D0*t1071*t1102)+0.1D1*t429*t1031*t446
     #*t110+0.2D1*t429*t447*t459+0.321646831778707D2*t88*t1037*t1003
     #*t1040*t110+2.D0*t490*t498+t190*(0.2313085866666667D-1*t1053
     #*t197-0.802206976D-3*t1059*t202+0.17436143616D-4*t917*t1059
     #-0.2067284032D-2*t384*t1053-0.7573741056D-7*t924*t1059
     #+0.1157099328D-4*t389*t1053)
      t1142 = -t566+t596+t604-t616-t618-0.8740794299481065D-3*t621
     #+t624-t626-0.8740794299481065D-3*t628+t636+t638+t643-t647+t692
     #-0.1124999956683108D1*t939-0.1124999956683108D1*t734
     #-0.2308393261117844D2*t736
      t1166 = 0.4444444444444444D0*t707*t322*t463+0.2666666666666667D1
     #*t149*t146*t572+0.4444444444444444D0*t718*t326*t466
     #-0.2666666666666667D1*t153*t146*t572
      t1182 = -0.7694644203726145D1*t738+t743+0.3799574853701528D-1
     #*t144*t469*t340+0.3799574853701528D-1*t144*t155*(t695-t701)
     #+0.3799574853701528D-1*t144*t329*t473+0.1923661050931536D1*t180
     #*t1166*t161+0.3799574853701528D-1*t144*t1166*t163-t753
     #-0.1124999956683108D1*t755-0.7694644203726145D1*t757
     #+0.1923661050931536D1*t763-t768-0.1124999956683108D1*t952
     #+0.1923661050931536D1*t955+0.7694644203726145D1*t973
     #-0.7694644203726145D1*t975-0.8740794299481065D-3*t982
     #-0.8740794299481065D-3*t985
      t1185 = t826+t828-t833-t834+t472+t476+t835+t479-t830+t332+t343
     #+t366+t114*(t1142+t1182)
      t1195 = t211*sigmabb*t398
      v2rhoab(i) = t1185*t205+t380*t498+t490*t392+t190*(
     #-0.802206976D-3*t212*t202*sigmabb*t398+0.17436143616D-4*t917
     #*sigmaaa*t1195-0.7573741056D-7*t924*sigmaaa*t1195)
      t1207 = sigmaaa*t217
      t1210 = t16*t224
      t1216 = t221/t7/t222/t209
      v2rhoasigmaaa(i) = -0.12407009817988D1*t4*t509-0.9305257363491D0
     #*t5*(-0.6120586666666667D-2*t211*t13-0.3935936D-4*t1207*t23
     #+0.9322052266666667D-6*t1210*t227-0.27073536D-8*t1216*t881)
     #-0.3109D-1*t233*t518+0.1321010150222857D-2*t237*t519+0.1D1*t242
     #*t260*t518-0.3109D-1*t33*t45*(-0.1448965333333333D1*t211*t48
     #+0.2094352D1*t1207*t52-0.7284036266666667D0*t1210*t269
     #+0.73498368D-1*t1216*t906)+t380*t528+t190*(-0.6308416D-2*t211
     #*t197+0.300827616D-3*t1207*t202-0.6538553856D-5*t917*t1207
     #+0.563804736D-3*t384*t211+0.2840152896D-7*t924*t1207
     #-0.315572544D-5*t389*t211)
      v2rhoasigmaab(i) = 0.D0
      t1260 = t212*t64
      v2rhoasigmabb(i) = t380*t558+t190*(0.300827616D-3*t212*t202*t64
     #-0.6538553856D-5*t917*t1260+0.2840152896D-7*t924*t1260)
      t1268 = t202*t9
      t1271 = t399*t9
      v2rhobsigmaaa(i) = t490*t528+t190*(0.300827616D-3*t399*t1268
     #-0.6538553856D-5*t917*t1271+0.2840152896D-7*t924*t1271)
      v2rhobsigmaab(i) = 0.D0
      t1282 = sigmabb*t404
      t1285 = t71*t411
      t1291 = t408/t62/t409/t396
      v2rhobsigmabb(i) = -0.12407009817988D1*t59*t539
     #-0.9305257363491D0*t60*(-0.6120586666666667D-2*t398*t68
     #-0.3935936D-4*t1282*t78+0.9322052266666667D-6*t1285*t414
     #-0.27073536D-8*t1291*t1073)-0.3109D-1*t420*t548
     #+0.1321010150222857D-2*t424*t549+0.1D1*t429*t447*t548-0.3109D-1
     #*t88*t100*(-0.1448965333333333D1*t398*t103+0.2094352D1*t1282
     #*t107-0.7284036266666667D0*t1285*t456+0.73498368D-1*t1291*t1102)
     #+t490*t558+t190*(-0.6308416D-2*t398*t197+0.300827616D-3*t1282
     #*t202-0.6538553856D-5*t917*t1282+0.563804736D-3*t384*t398
     #+0.2840152896D-7*t924*t1282-0.315572544D-5*t389*t398)
      t1333 = sigmaaa*t505
      t1338 = t16/t7/t870
      v2sigmaaa2(i) = -0.9305257363491D0*t5*(0.278944D-5*t20*t23
     #-0.26497216D-6*t1333*t227+0.10152576D-8*t1338*t881)-0.3109D-1
     #*t33*t45*(-0.4470272D0*t20*t52+0.22721488D0*t1333*t269
     #-0.27561888D-1*t1338*t906)+t190*(-0.112810356D-3*t20*t202
     #+0.2451957696D-5*t917*t20-0.1065057336D-7*t924*t20)
      v2sigmaaaab(i) = 0.D0
      t1364 = t9*t64
      v2sigmaaabb(i) = t190*(-0.112810356D-3*t1268*t64+0.2451957696D-5
     #*t917*t1364-0.1065057336D-7*t924*t1364)
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      t1372 = sigmabb*t535
      t1377 = t71/t62/t1062
      v2sigmabb2(i) = -0.9305257363491D0*t60*(0.278944D-5*t75*t78
     #-0.26497216D-6*t1372*t414+0.10152576D-8*t1377*t1073)-0.3109D-1
     #*t88*t100*(-0.4470272D0*t75*t107+0.22721488D0*t1372*t456
     #-0.27561888D-1*t1377*t1102)+t190*(-0.112810356D-3*t75*t202
     #+0.2451957696D-5*t917*t75-0.1065057336D-7*t924*t75)
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      v2rhob2(i) = 0.0d0
      v2rhoab(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2rhoasigmaab(i) = 0.0d0
      v2rhoasigmabb(i) = 0.0d0
      v2rhobsigmaaa(i) = 0.0d0
      v2rhobsigmaab(i) = 0.0d0
      v2rhobsigmabb(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      v2sigmaab2(i) = 0.0d0
      v2sigmabb2(i) = 0.0d0
      v2sigmaaaab(i) = 0.0d0
      v2sigmaaabb(i) = 0.0d0
      v2sigmaabbb(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end
      
      
      subroutine rks_xc_b97_1
     & (ideriv,npt,rhoa1,sigmaaa1,
     &  zk,vrhoa,vsigmaaa,
     &  v2rhoa2,v2rhoasigmaaa,v2sigmaaa2)
c
c     F.A. Hamprecht, A.J. Cohen, D.J. Tozer, and N.C. Handy
c     Development and assessment of new exchange-correlation functionals
c     J. Chem. Phys. 109 (1998) 6264-6271
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt)
      REAL sigmaaa1(npt)
      REAL zk(npt),vrhoa(npt),vsigmaaa(npt)
      REAL v2rhoa2(npt),v2rhoasigmaaa(npt),v2sigmaaa2(npt)
      parameter(tol=1.0d-20)
      
      if(ideriv.eq.0) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t4 = rho**2
      t5 = t2**2
      t8 = sigma/t5/t4
      t10 = 1.D0+0.6349604207872798D-2*t8
      t14 = sigma**2
      t15 = t4**2
      t19 = t14/t2/t15/rho
      t20 = t10**2
      t27 = 1/rho
      t28 = t27**(1.D0/3.D0)
      t31 = rho*(1.D0+0.1606016560364007D0*t28)
      t32 = t27**(1.D0/6.D0)
      t35 = dsqrt(t27)
      t37 = t28**2
      t43 = dlog(1.D0+0.321646831778707D2/(0.1248219874679732D2*t32
     #+0.4844076716063854D1*t28+0.2326004811900819D1*t35
     #+0.3819082618690966D0*t37))
      t45 = 1.D0+0.3174802103936399D0*t8
      t49 = t45**2
      t68 = dlog(1.D0+0.160818243221511D2/(0.598255043577108D1*t32
     #+0.2225569421150687D1*t28+0.8004286349993634D0*t35
     #+0.1897004325747559D0*t37))
      t75 = 1.D0+0.9524406311809197D-2*t8
      t79 = t75**2
      zk(i) = -0.7385587663820224D0*t2*rho*(0.789518D0
     #+0.3643434642498451D-2*t8/t10+0.2664884211053644D-4*t19/t20)
     #-0.3109D-1*t31*t43*(0.820011D-1+0.8625334103995448D0*t8/t45
     #-0.2893816905503742D0*t19/t49)+(-0.62182D-1*rho*(1.D0
     #+0.1325688999052018D0*t28)*t68+0.3109D-1*t31*t43)*(0.955689D0
     #+0.7510489645989766D-2*t8/t75-0.4969956136930951D-3*t19/t79)
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t3 = t2*rho
      t4 = rho**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigma*t7
      t10 = 1.D0+0.6349604207872798D-2*t8
      t11 = 1/t10
      t14 = sigma**2
      t15 = t4**2
      t18 = 1/t2/t15/rho
      t19 = t14*t18
      t20 = t10**2
      t21 = 1/t20
      t24 = 0.789518D0+0.3643434642498451D-2*t8*t11
     #+0.2664884211053644D-4*t19*t21
      t27 = 1/rho
      t28 = t27**(1.D0/3.D0)
      t30 = 1.D0+0.1606016560364007D0*t28
      t31 = rho*t30
      t32 = t27**(1.D0/6.D0)
      t35 = dsqrt(t27)
      t37 = t28**2
      t39 = 0.1248219874679732D2*t32+0.4844076716063854D1*t28
     #+0.2326004811900819D1*t35+0.3819082618690966D0*t37
      t42 = 1.D0+0.321646831778707D2/t39
      t43 = dlog(t42)
      t45 = 1.D0+0.3174802103936399D0*t8
      t46 = 1/t45
      t49 = t45**2
      t50 = 1/t49
      t53 = 0.820011D-1+0.8625334103995448D0*t8*t46
     #-0.2893816905503742D0*t19*t50
      t54 = t43*t53
      t58 = 1.D0+0.1325688999052018D0*t28
      t64 = 0.598255043577108D1*t32+0.2225569421150687D1*t28
     #+0.8004286349993634D0*t35+0.1897004325747559D0*t37
      t67 = 1.D0+0.160818243221511D2/t64
      t68 = dlog(t67)
      t73 = -0.62182D-1*rho*t58*t68+0.3109D-1*t31*t43
      t75 = 1.D0+0.9524406311809197D-2*t8
      t76 = 1/t75
      t79 = t75**2
      t80 = 1/t79
      t83 = 0.955689D0+0.7510489645989766D-2*t8*t76
     #-0.4969956136930951D-3*t19*t80
      zk(i) = -0.7385587663820224D0*t3*t24-0.3109D-1*t31*t54+t73*t83
      t90 = sigma/t5/t4/rho
      t96 = t14/t2/t15/t4
      t100 = t15**2
      t103 = t14*sigma/t100/rho
      t105 = 1/t20/t10
      t111 = t30*t43
      t114 = 1/t37
      t115 = t27*t114
      t118 = t39**2
      t119 = 1/t118
      t121 = t32**2
      t122 = t121**2
      t125 = 1/t4
      t126 = 1/t122/t32*t125
      t128 = t114*t125
      t131 = 1/t35*t125
      t134 = 1/t28*t125
      t136 = -0.4160732915599108D1*t126-0.3229384477375903D1*t128
     #-0.2326004811900819D1*t131-0.5092110158254621D0*t134
      t137 = 1/t42
      t147 = 1/t49/t45
      t158 = t64**2
      t186 = 1/t79/t75
      vrhoa(i) = -0.9847450218426965D0*t2*t24-0.3692793831910112D0*t3*
     #(-0.194316514266584D-1*t90*t11-0.1608710201810944D-3*t96*t21
     #+0.18049024D-5*t103*t105)-0.3109D-1*t111*t53
     #+0.1664368495390566D-2*t115*t54+0.5D0*t31*t119*t136*t137*t53
     #-0.15545D-1*t31*t43*(-0.4600178188797572D1*t90*t46
     #+0.4547203571765012D1*t96*t50-0.97997824D0*t103*t147)+(
     #-0.62182D-1*t58*t68+rho*(0.2747799777968419D-2*t128*t68+0.1D1
     #*t58/t158*(-0.99709173929518D0*t126-0.7418564737168958D0*t128
     #-0.4002143174996817D0*t131-0.1264669550498372D0*t134)/t67)
     #+0.3109D-1*t111-0.1664368495390566D-2*t115*t43-0.5D0*t31*t119
     #*t136*t137)*t83+t73*(-0.2002797238930604D-1*t90*t76
     #+0.2841397819667287D-2*t96*t80-0.2524580352D-4*t103*t186)
      t193 = sigma*t18
      t197 = t14/t100
      vsigmaaa(i) = -0.7385587663820224D0*t3*(0.145737385699938D-1*t7
     #*t11+0.1206532651358208D-3*t193*t21-0.13536768D-5*t197*t105)
     #-0.3109D-1*t31*t43*(0.3450133641598179D1*t7*t46
     #-0.3410402678823759D1*t193*t50+0.73498368D0*t197*t147)+2.D0*t73*
     #(0.1502097929197953D-1*t7*t76-0.2131048364750465D-2*t193*t80
     #+0.1893435264D-4*t197*t186)
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t3 = t2*rho
      t4 = rho**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigma*t7
      t10 = 1.D0+0.6349604207872798D-2*t8
      t11 = 1/t10
      t14 = sigma**2
      t15 = t4**2
      t18 = 1/t2/t15/rho
      t19 = t14*t18
      t20 = t10**2
      t21 = 1/t20
      t24 = 0.789518D0+0.3643434642498451D-2*t8*t11
     #+0.2664884211053644D-4*t19*t21
      t27 = 1/rho
      t28 = t27**(1.D0/3.D0)
      t30 = 1.D0+0.1606016560364007D0*t28
      t31 = rho*t30
      t32 = t27**(1.D0/6.D0)
      t35 = dsqrt(t27)
      t37 = t28**2
      t39 = 0.1248219874679732D2*t32+0.4844076716063854D1*t28
     #+0.2326004811900819D1*t35+0.3819082618690966D0*t37
      t42 = 1.D0+0.321646831778707D2/t39
      t43 = dlog(t42)
      t45 = 1.D0+0.3174802103936399D0*t8
      t46 = 1/t45
      t49 = t45**2
      t50 = 1/t49
      t53 = 0.820011D-1+0.8625334103995448D0*t8*t46
     #-0.2893816905503742D0*t19*t50
      t54 = t43*t53
      t58 = 1.D0+0.1325688999052018D0*t28
      t64 = 0.598255043577108D1*t32+0.2225569421150687D1*t28
     #+0.8004286349993634D0*t35+0.1897004325747559D0*t37
      t67 = 1.D0+0.160818243221511D2/t64
      t68 = dlog(t67)
      t73 = -0.62182D-1*rho*t58*t68+0.3109D-1*t31*t43
      t75 = 1.D0+0.9524406311809197D-2*t8
      t76 = 1/t75
      t79 = t75**2
      t80 = 1/t79
      t83 = 0.955689D0+0.7510489645989766D-2*t8*t76
     #-0.4969956136930951D-3*t19*t80
      zk(i) = -0.7385587663820224D0*t3*t24-0.3109D-1*t31*t54+t73*t83
      t87 = t4*rho
      t89 = 1/t5/t87
      t90 = sigma*t89
      t95 = 1/t2/t15/t4
      t96 = t14*t95
      t99 = t14*sigma
      t100 = t15**2
      t102 = 1/t100/rho
      t103 = t99*t102
      t105 = 1/t20/t10
      t108 = -0.194316514266584D-1*t90*t11-0.1608710201810944D-3*t96
     #*t21+0.18049024D-5*t103*t105
      t111 = t30*t43
      t114 = 1/t37
      t115 = t27*t114
      t118 = t39**2
      t119 = 1/t118
      t120 = t31*t119
      t121 = t32**2
      t122 = t121**2
      t123 = t122*t32
      t124 = 1/t123
      t125 = 1/t4
      t126 = t124*t125
      t128 = t114*t125
      t130 = 1/t35
      t131 = t130*t125
      t133 = 1/t28
      t134 = t133*t125
      t136 = -0.4160732915599108D1*t126-0.3229384477375903D1*t128
     #-0.2326004811900819D1*t131-0.5092110158254621D0*t134
      t137 = 1/t42
      t138 = t136*t137
      t139 = t138*t53
      t147 = 1/t49/t45
      t150 = -0.4600178188797572D1*t90*t46+0.4547203571765012D1*t96
     #*t50-0.97997824D0*t103*t147
      t151 = t43*t150
      t156 = t128*t68
      t158 = t64**2
      t159 = 1/t158
      t160 = t58*t159
      t165 = -0.99709173929518D0*t126-0.7418564737168958D0*t128
     #-0.4002143174996817D0*t131-0.1264669550498372D0*t134
      t166 = 1/t67
      t168 = t160*t165*t166
      t176 = t119*t136*t137
      t179 = -0.62182D-1*t58*t68+rho*(0.2747799777968419D-2*t156+0.1D1
     #*t168)+0.3109D-1*t111-0.1664368495390566D-2*t115*t43-0.5D0*t31
     #*t176
      t186 = 1/t79/t75
      t189 = -0.2002797238930604D-1*t90*t76+0.2841397819667287D-2*t96
     #*t80-0.2524580352D-4*t103*t186
      vrhoa(i) = -0.9847450218426965D0*t2*t24-0.3692793831910112D0*t3
     #*t108-0.3109D-1*t111*t53+0.1664368495390566D-2*t115*t54+0.5D0
     #*t120*t139-0.15545D-1*t31*t151+t179*t83+t73*t189
      t193 = sigma*t18
      t196 = 1/t100
      t197 = t14*t196
      t200 = 0.145737385699938D-1*t7*t11+0.1206532651358208D-3*t193
     #*t21-0.13536768D-5*t197*t105
      t209 = 0.3450133641598179D1*t7*t46-0.3410402678823759D1*t193*t50
     #+0.73498368D0*t197*t147
      t210 = t43*t209
      t219 = 0.1502097929197953D-1*t7*t76-0.2131048364750465D-2*t193
     #*t80+0.1893435264D-4*t197*t186
      vsigmaaa(i) = -0.7385587663820224D0*t3*t200-0.3109D-1*t31*t210
     #+2.D0*t73*t219
      t224 = 1/t15
      t225 = 1/t123/t27*t224
      t227 = 1/t87
      t228 = t124*t227
      t231 = 1/t37/t27
      t232 = t231*t224
      t234 = t114*t227
      t238 = 1/t35/t27*t224
      t240 = t130*t227
      t244 = 1/t28/t27*t224
      t246 = t133*t227
      t248 = -0.6934554859331846D1*t225+0.1664293166239643D2*t228
     #-0.4305845969834537D1*t232+0.1291753790950361D2*t234
     #-0.2326004811900819D1*t238+0.9304019247603276D1*t240
     #-0.3394740105503081D0*t244+0.2036844063301848D1*t246
      t254 = 1/t118/t39
      t256 = t136**2
      t264 = t227*t231
      t269 = t30*t119
      t276 = sigma/t5/t15
      t282 = t14/t2/t15/t87
      t285 = t100*t4
      t287 = t99/t285
      t290 = t14**2
      t294 = t290/t5/t100/t15
      t295 = t20**2
      t296 = 1/t295
      t307 = 0.2D1*t168
      t308 = 0.5495599555936838D-2*t156
      t310 = 0.1831866518645613D-2*t232*t68
      t312 = 0.5495599555936838D-2*t234*t68
      t324 = 0.1D1*t160*(-0.8309097827459833D0*t225
     #+0.199418347859036D1*t228-0.4945709824779306D0*t232
     #+0.1483712947433792D1*t234-0.2001071587498409D0*t238
     #+0.8004286349993634D0*t240-0.4215565168327908D-1*t244
     #+0.2529339100996745D0*t246)*t166
      t325 = t158**2
      t328 = t165**2
      t329 = t67**2
      t333 = 0.160818243221511D2*t58/t325*t328/t329
      t339 = 0.2D1*t58/t158/t64*t328*t166
      t343 = 0.8837926660346786D-1*t128*t159*t165*t166
      t354 = dlog(1.D0+0.2960857464321668D2/(0.8157414703487641D1*t32
     #+0.2247591863577616D1*t28+0.4300972471276643D0*t35
     #+0.1911512595127338D0*t37))
      t356 = (1.D0+0.6901399211255825D-1*t28)*t354*t125
      t374 = t118**2
      t375 = 1/t374
      t377 = t42**2
      t378 = 1/t377
      t395 = t49**2
      t396 = 1/t395
      t408 = t282*t80
      t410 = t287*t186
      t412 = t79**2
      t413 = 1/t412
      t415 = 0.1923610323140663D-5*t294*t413
      s1 = 0.5D0*t120*t248*t137*t53-0.1D1*t31*t254*t256*t137*t53
     #-0.1070677706909338D0*t115*t119*t139+0.2219157993854088D-2*t264
     #*t54+0.3328736990781132D-2*t115*t151+0.2D1*t269*t139-0.6218D-1
     #*t111*t150-0.3692793831910112D0*t3*(0.1424987771288283D0*t276
     #*t11+0.1379655345415848D-2*t282*t21-0.4338389447111111D-4*t287
     #*t105+0.1833666539814354D-6*t294*t296)-0.6564966812284644D0/t5*t24
      s2 = s1-0.1969490043685393D1*t2*t108+(t307+t308+rho*(t310-t312
     #+t324+t333-t339-t343+0.3377399869956914D-1*t356)-0.2D1*t269*t138
     #-0.5D0*t31*t119*t248*t137-0.2219157993854088D-2*t264*t43
     #+0.1070677706909338D0*t115*t176+0.1D1*t31*t254*t256*t137
     #-0.1608234158893535D2*t31*t375*t256*t378)*t83
     #+0.1608234158893535D2*t31*t375*t256*t378*t53-0.15545D-1*t31*t43*
     #(0.337346400511822D2*t276*t46-0.6538706145157114D2*t282*t50
     #+0.3303851121777778D2*t287*t147-0.4977979165062223D1*t294*t396)
      v2rhoa2(i) = s2+0.1D1*t120*t138*t150+t73*(0.1468717975215776D0
     #*t276*t76-0.2892265698770606D-1*t408+0.464114190336D-3*t410-t415
     #)+4.D0*t179*t189+(t308+t307+rho*(t310-t312+t324+t333-t339-t343
     #-0.3377399869956914D-1*t356))*t83+t73*(-0.8085739643479291D-2
     #*t408+0.278978297856D-3*t410-t415)
      t433 = sigma*t95
      t436 = t14*t102
      t442 = t99/t5/t100/t87
      t471 = t433*t80
      t473 = t436*t186
      t476 = 0.1442707742355497D-5*t442*t413
      v2rhoasigmaaa(i) = -0.9847450218426965D0*t2*t200
     #-0.3692793831910112D0*t3*(-0.7772660570663362D-1*t89*t11
     #-0.7934349787902444D-3*t433*t21+0.2983056725333333D-4*t436*t105
     #-0.1375249904860765D-6*t442*t296)-0.3109D-1*t111*t209
     #+0.1664368495390566D-2*t115*t210+0.5D0*t120*t138*t209-0.15545D-1
     #*t31*t43*(-0.1840071275519029D2*t89*t46+0.4221949073103084D2
     #*t433*t50-0.2330891605333333D2*t436*t147+0.3733484373796667D1
     #*t442*t396)+2.D0*t179*t219+t73*(-0.8011188955722417D-1*t89*t76
     #+0.1742989601127862D-1*t471-0.310216937472D-3*t473+t476)+t73*
     #(0.6064304732609468D-2*t471-0.209233723392D-3*t473+t476)
      t485 = sigma*t196
      t490 = t14/t5/t285
      v2sigmaaa2(i) = -0.7385587663820224D0*t3*(0.1124631735494002D-3
     #*t18*t21-0.1695821824D-4*t485*t105+0.1031437428645574D-6*t490
     #*t296)-0.3109D-1*t31*t43*(-0.1802300733297809D2*t18*t50
     #+0.1454175232D2*t485*t147-0.28001132803475D1*t490*t396)+4.D0*t73
     #*(-0.4548228549457101D-2*t18*t80+0.156925292544D-3*t485*t186
     #-0.1082030806766623D-5*t490*t413)
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end

c:XC_B97_1subrend
_ENDIF
_IF(ccpdft,all,xc_b97_2)
c:XC_B97_2subrstart

c    Generated: Thu Jun 19 11:34:14 GMT 2003

      subroutine uks_xc_b97_2
     & (ideriv,npt,rhoa1,rhob1,sigmaaa1,sigmabb1,sigmaab1,
     &  zk,vrhoa,vrhob,vsigmaaa,vsigmabb,vsigmaab,
     &  v2rhoa2,v2rhob2,v2rhoab,
     &  v2rhoasigmaaa,v2rhoasigmaab,v2rhoasigmabb,
     &  v2rhobsigmabb,v2rhobsigmaab,v2rhobsigmaaa,
     &  v2sigmaaa2,v2sigmaaaab,v2sigmaaabb,
     &  v2sigmaab2,v2sigmaabbb,v2sigmabb2)
c
c     P.J. Wilson, T.J. Bradley, and D.J. Tozer
c     Hybrid exchange-correlation functional determined from
c     thermochemical data and ab initio potentials
c     J. Chem. Phys. 115 (2001) 9233-9242
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt),rhob1(npt)
      REAL sigmaaa1(npt),sigmabb1(npt),sigmaab1(npt)
      REAL zk(npt),vrhoa(npt),vrhob(npt)
      REAL vsigmaaa(npt),vsigmabb(npt),vsigmaab(npt)
      REAL v2rhoa2(npt),v2rhob2(npt),v2rhoab(npt)
      REAL v2rhoasigmaaa(npt),v2rhoasigmaab(npt)
      REAL v2rhoasigmabb(npt),v2rhobsigmabb(npt)
      REAL v2rhobsigmaab(npt),v2rhobsigmaaa(npt)
      REAL v2sigmaaa2(npt),v2sigmaaaab(npt),v2sigmaaabb(npt)
      REAL v2sigmaab2(npt),v2sigmaabbb(npt),v2sigmabb2(npt)
      parameter(tol=1.0d-20)
      
      if (ideriv.eq.0) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t4 = rhob**2
      t5 = t2**2
      t8 = sigmabb/t5/t4
      t10 = 1.D0+0.4D-2*t8
      t14 = sigmabb**2
      t15 = t4**2
      t19 = t14/t2/t15/rhob
      t20 = t10**2
      t27 = 1/rhob
      t28 = t27**(1.D0/3.D0)
      t32 = t27**(1.D0/6.D0)
      t35 = dsqrt(t27)
      t37 = t28**2
      t43 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t32
     #+0.3844746237447211D1*t28+0.1644733775567609D1*t35
     #+0.2405871291288192D0*t37))
      t45 = 1.D0+0.2D0*t8
      t49 = t45**2
      zk(i) = -0.9305257363491D0*t2*rhob*(0.827642D0+0.19136D-3*t8/t10
     #+0.2818D-4*t19/t20)-0.3109D-1*rhob*(1.D0+0.1274696188700087D0
     #*t28)*t43*(0.585808D0-0.1383364D0*t8/t45+0.1579184D-1*t19/t49)
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t4 = rhoa**2
      t5 = t2**2
      t8 = sigmaaa/t5/t4
      t10 = 1.D0+0.4D-2*t8
      t14 = sigmaaa**2
      t15 = t4**2
      t19 = t14/t2/t15/rhoa
      t20 = t10**2
      t27 = 1/rhoa
      t28 = t27**(1.D0/3.D0)
      t32 = t27**(1.D0/6.D0)
      t35 = dsqrt(t27)
      t37 = t28**2
      t43 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t32
     #+0.3844746237447211D1*t28+0.1644733775567609D1*t35
     #+0.2405871291288192D0*t37))
      t45 = 1.D0+0.2D0*t8
      t49 = t45**2
      zk(i) = -0.9305257363491D0*t2*rhoa*(0.827642D0+0.19136D-3*t8/t10
     #+0.2818D-4*t19/t20)-0.3109D-1*rhoa*(1.D0+0.1274696188700087D0
     #*t28)*t43*(0.585808D0-0.1383364D0*t8/t45+0.1579184D-1*t19/t49)
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t6 = rhoa**2
      t7 = t4**2
      t10 = sigmaaa/t7/t6
      t12 = 1.D0+0.4D-2*t10
      t16 = sigmaaa**2
      t17 = t6**2
      t21 = t16/t4/t17/rhoa
      t22 = t12**2
      t29 = 1/rhoa
      t30 = t29**(1.D0/3.D0)
      t33 = rhoa*(1.D0+0.1274696188700087D0*t30)
      t34 = t29**(1.D0/6.D0)
      t37 = dsqrt(t29)
      t39 = t30**2
      t45 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t34
     #+0.3844746237447211D1*t30+0.1644733775567609D1*t37
     #+0.2405871291288192D0*t39))
      t47 = 1.D0+0.2D0*t10
      t51 = t47**2
      t59 = rhob**(1.D0/3.D0)
      t61 = rhob**2
      t62 = t59**2
      t65 = sigmabb/t62/t61
      t67 = 1.D0+0.4D-2*t65
      t71 = sigmabb**2
      t72 = t61**2
      t76 = t71/t59/t72/rhob
      t77 = t67**2
      t84 = 1/rhob
      t85 = t84**(1.D0/3.D0)
      t88 = rhob*(1.D0+0.1274696188700087D0*t85)
      t89 = t84**(1.D0/6.D0)
      t92 = dsqrt(t84)
      t94 = t85**2
      t100 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t89
     #+0.3844746237447211D1*t85+0.1644733775567609D1*t92
     #+0.2405871291288192D0*t94))
      t102 = 1.D0+0.2D0*t65
      t106 = t102**2
      t114 = rhoa+rhob
      t115 = 1/t114
      t116 = t115**(1.D0/3.D0)
      t119 = t115**(1.D0/6.D0)
      t122 = dsqrt(t115)
      t124 = t116**2
      t130 = dlog(1.D0+0.160818243221511D2/(0.598255043577108D1*t119
     #+0.2225569421150687D1*t116+0.8004286349993634D0*t122
     #+0.1897004325747559D0*t124))
      t132 = 0.62182D-1*(1.D0+0.1325688999052018D0*t116)*t130
      t143 = dlog(1.D0+0.2960857464321668D2/(0.8157414703487641D1*t119
     #+0.2247591863577616D1*t116+0.4300972471276643D0*t122
     #+0.1911512595127338D0*t124))
      t146 = rhoa-1.D0*rhob
      t147 = t146*t115
      t148 = 1.D0+t147
      t149 = t148**(1.D0/3.D0)
      t152 = 1.D0-1.D0*t147
      t153 = t152**(1.D0/3.D0)
      t155 = t149*t148+t153*t152-2.D0
      t156 = t146**2
      t157 = t156**2
      t158 = t114**2
      t159 = t158**2
      t161 = t157/t159
      t177 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t119
     #+0.3844746237447211D1*t116+0.1644733775567609D1*t122
     #+0.2405871291288192D0*t124))
      t193 = 0.5D0*t10+0.5D0*t65
      t196 = 1.D0+0.3D-2*t10+0.3D-2*t65
      t200 = t193**2
      t201 = t196**2
      zk(i) = -0.9305257363491D0*t4*rhoa*(0.827642D0+0.19136D-3*t10
     #/t12+0.2818D-4*t21/t22)-0.3109D-1*t33*t45*(0.585808D0
     #-0.1383364D0*t10/t47+0.1579184D-1*t21/t51)-0.9305257363491D0*t59
     #*rhob*(0.827642D0+0.19136D-3*t65/t67+0.2818D-4*t76/t77)
     #-0.3109D-1*t88*t100*(0.585808D0-0.1383364D0*t65/t102
     #+0.1579184D-1*t76/t106)+(t114*(-t132+0.3799574853701528D-1*(1.D0
     #+0.6901399211255825D-1*t116)*t143*t155*(1.D0-1.D0*t161)
     #+0.1923661050931536D1*(-0.3109D-1*(1.D0+0.1274696188700087D0
     #*t116)*t177+t132)*t155*t161)+0.3109D-1*t33*t45+0.3109D-1*t88
     #*t100)*(0.999849D0+0.843756D-2*t193/t196-0.2678616D-3*t200/t201)
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t3 = t2*rhob
      t4 = rhob**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigmabb*t7
      t10 = 1.D0+0.4D-2*t8
      t11 = 1/t10
      t14 = sigmabb**2
      t15 = t4**2
      t18 = 1/t2/t15/rhob
      t19 = t14*t18
      t20 = t10**2
      t21 = 1/t20
      t24 = 0.827642D0+0.19136D-3*t8*t11+0.2818D-4*t19*t21
      t27 = 1/rhob
      t28 = t27**(1.D0/3.D0)
      t30 = 1.D0+0.1274696188700087D0*t28
      t31 = rhob*t30
      t32 = t27**(1.D0/6.D0)
      t35 = dsqrt(t27)
      t37 = t28**2
      t39 = 0.1112037486309468D2*t32+0.3844746237447211D1*t28
     #+0.1644733775567609D1*t35+0.2405871291288192D0*t37
      t42 = 1.D0+0.321646831778707D2/t39
      t43 = dlog(t42)
      t45 = 1.D0+0.2D0*t8
      t46 = 1/t45
      t49 = t45**2
      t50 = 1/t49
      t53 = 0.585808D0-0.1383364D0*t8*t46+0.1579184D-1*t19*t50
      t54 = t43*t53
      zk(i) = -0.9305257363491D0*t3*t24-0.3109D-1*t31*t54
      vrhoa(i) = 0.D0
      t62 = sigmabb/t5/t4/rhob
      t68 = t14/t2/t15/t4
      t72 = t15**2
      t75 = t14*sigmabb/t72/rhob
      t77 = 1/t20/t10
      t86 = 1/t37
      t90 = t39**2
      t93 = t32**2
      t94 = t93**2
      t97 = 1/t4
      t119 = 1/t49/t45
      vrhob(i) = -0.12407009817988D1*t2*t24-0.9305257363491D0*t3*(
     #-0.5102933333333333D-3*t62*t11-0.14825216D-3*t68*t21
     #+0.6011733333333333D-6*t75*t77)-0.3109D-1*t30*t43*t53
     #+0.1321010150222857D-2*t27*t86*t54+0.1D1*t31/t90*(
     #-0.1853395810515781D1/t94/t32*t97-0.128158207914907D1*t86*t97
     #-0.8223668877838045D0/t35*t97-0.1603914194192128D0/t28*t97)/t42
     #*t53-0.3109D-1*t31*t43*(0.3688970666666667D0*t62*t46
     #-0.15800256D0*t68*t50+0.1684462933333333D-1*t75*t119)
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      t128 = sigmabb*t18
      t132 = t14/t72
      vsigmabb(i) = -0.9305257363491D0*t3*(0.19136D-3*t7*t11
     #+0.5559456D-4*t128*t21-0.22544D-6*t132*t77)-0.3109D-1*t31*t43*(
     #-0.1383364D0*t7*t46+0.5925096D-1*t128*t50-0.6316736D-2*t132*t119)
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t3 = t2*rhoa
      t4 = rhoa**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigmaaa*t7
      t10 = 1.D0+0.4D-2*t8
      t11 = 1/t10
      t14 = sigmaaa**2
      t15 = t4**2
      t18 = 1/t2/t15/rhoa
      t19 = t14*t18
      t20 = t10**2
      t21 = 1/t20
      t24 = 0.827642D0+0.19136D-3*t8*t11+0.2818D-4*t19*t21
      t27 = 1/rhoa
      t28 = t27**(1.D0/3.D0)
      t30 = 1.D0+0.1274696188700087D0*t28
      t31 = rhoa*t30
      t32 = t27**(1.D0/6.D0)
      t35 = dsqrt(t27)
      t37 = t28**2
      t39 = 0.1112037486309468D2*t32+0.3844746237447211D1*t28
     #+0.1644733775567609D1*t35+0.2405871291288192D0*t37
      t42 = 1.D0+0.321646831778707D2/t39
      t43 = dlog(t42)
      t45 = 1.D0+0.2D0*t8
      t46 = 1/t45
      t49 = t45**2
      t50 = 1/t49
      t53 = 0.585808D0-0.1383364D0*t8*t46+0.1579184D-1*t19*t50
      t54 = t43*t53
      zk(i) = -0.9305257363491D0*t3*t24-0.3109D-1*t31*t54
      t62 = sigmaaa/t5/t4/rhoa
      t68 = t14/t2/t15/t4
      t72 = t15**2
      t75 = t14*sigmaaa/t72/rhoa
      t77 = 1/t20/t10
      t86 = 1/t37
      t90 = t39**2
      t93 = t32**2
      t94 = t93**2
      t97 = 1/t4
      t119 = 1/t49/t45
      vrhoa(i) = -0.12407009817988D1*t2*t24-0.9305257363491D0*t3*(
     #-0.5102933333333333D-3*t62*t11-0.14825216D-3*t68*t21
     #+0.6011733333333333D-6*t75*t77)-0.3109D-1*t30*t43*t53
     #+0.1321010150222857D-2*t27*t86*t54+0.1D1*t31/t90*(
     #-0.1853395810515781D1/t94/t32*t97-0.128158207914907D1*t86*t97
     #-0.8223668877838045D0/t35*t97-0.1603914194192128D0/t28*t97)/t42
     #*t53-0.3109D-1*t31*t43*(0.3688970666666667D0*t62*t46
     #-0.15800256D0*t68*t50+0.1684462933333333D-1*t75*t119)
      vrhob(i) = 0.D0
      t128 = sigmaaa*t18
      t132 = t14/t72
      vsigmaaa(i) = -0.9305257363491D0*t3*(0.19136D-3*t7*t11
     #+0.5559456D-4*t128*t21-0.22544D-6*t132*t77)-0.3109D-1*t31*t43*(
     #-0.1383364D0*t7*t46+0.5925096D-1*t128*t50-0.6316736D-2*t132*t119)
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t5 = t4*rhoa
      t6 = rhoa**2
      t7 = t4**2
      t9 = 1/t7/t6
      t10 = sigmaaa*t9
      t12 = 1.D0+0.4D-2*t10
      t13 = 1/t12
      t16 = sigmaaa**2
      t17 = t6**2
      t20 = 1/t4/t17/rhoa
      t21 = t16*t20
      t22 = t12**2
      t23 = 1/t22
      t26 = 0.827642D0+0.19136D-3*t10*t13+0.2818D-4*t21*t23
      t29 = 1/rhoa
      t30 = t29**(1.D0/3.D0)
      t32 = 1.D0+0.1274696188700087D0*t30
      t33 = rhoa*t32
      t34 = t29**(1.D0/6.D0)
      t37 = dsqrt(t29)
      t39 = t30**2
      t41 = 0.1112037486309468D2*t34+0.3844746237447211D1*t30
     #+0.1644733775567609D1*t37+0.2405871291288192D0*t39
      t44 = 1.D0+0.321646831778707D2/t41
      t45 = dlog(t44)
      t47 = 1.D0+0.2D0*t10
      t48 = 1/t47
      t51 = t47**2
      t52 = 1/t51
      t55 = 0.585808D0-0.1383364D0*t10*t48+0.1579184D-1*t21*t52
      t56 = t45*t55
      t59 = rhob**(1.D0/3.D0)
      t60 = t59*rhob
      t61 = rhob**2
      t62 = t59**2
      t64 = 1/t62/t61
      t65 = sigmabb*t64
      t67 = 1.D0+0.4D-2*t65
      t68 = 1/t67
      t71 = sigmabb**2
      t72 = t61**2
      t75 = 1/t59/t72/rhob
      t76 = t71*t75
      t77 = t67**2
      t78 = 1/t77
      t81 = 0.827642D0+0.19136D-3*t65*t68+0.2818D-4*t76*t78
      t84 = 1/rhob
      t85 = t84**(1.D0/3.D0)
      t87 = 1.D0+0.1274696188700087D0*t85
      t88 = rhob*t87
      t89 = t84**(1.D0/6.D0)
      t92 = dsqrt(t84)
      t94 = t85**2
      t96 = 0.1112037486309468D2*t89+0.3844746237447211D1*t85
     #+0.1644733775567609D1*t92+0.2405871291288192D0*t94
      t99 = 1.D0+0.321646831778707D2/t96
      t100 = dlog(t99)
      t102 = 1.D0+0.2D0*t65
      t103 = 1/t102
      t106 = t102**2
      t107 = 1/t106
      t110 = 0.585808D0-0.1383364D0*t65*t103+0.1579184D-1*t76*t107
      t111 = t100*t110
      t114 = rhoa+rhob
      t115 = 1/t114
      t116 = t115**(1.D0/3.D0)
      t118 = 1.D0+0.1325688999052018D0*t116
      t119 = t115**(1.D0/6.D0)
      t122 = dsqrt(t115)
      t124 = t116**2
      t126 = 0.598255043577108D1*t119+0.2225569421150687D1*t116
     #+0.8004286349993634D0*t122+0.1897004325747559D0*t124
      t129 = 1.D0+0.160818243221511D2/t126
      t130 = dlog(t129)
      t132 = 0.62182D-1*t118*t130
      t134 = 1.D0+0.6901399211255825D-1*t116
      t139 = 0.8157414703487641D1*t119+0.2247591863577616D1*t116
     #+0.4300972471276643D0*t122+0.1911512595127338D0*t124
      t142 = 1.D0+0.2960857464321668D2/t139
      t143 = dlog(t142)
      t144 = t134*t143
      t146 = rhoa-1.D0*rhob
      t147 = t146*t115
      t148 = 1.D0+t147
      t149 = t148**(1.D0/3.D0)
      t152 = 1.D0-1.D0*t147
      t153 = t152**(1.D0/3.D0)
      t155 = t149*t148+t153*t152-2.D0
      t156 = t146**2
      t157 = t156**2
      t158 = t114**2
      t159 = t158**2
      t160 = 1/t159
      t161 = t157*t160
      t163 = 1.D0-1.D0*t161
      t166 = 0.3799574853701528D-1*t144*t155*t163
      t168 = 1.D0+0.1274696188700087D0*t116
      t173 = 0.1112037486309468D2*t119+0.3844746237447211D1*t116
     #+0.1644733775567609D1*t122+0.2405871291288192D0*t124
      t176 = 1.D0+0.321646831778707D2/t173
      t177 = dlog(t176)
      t180 = -0.3109D-1*t168*t177+t132
      t181 = t180*t155
      t183 = 0.1923661050931536D1*t181*t161
      t190 = t114*(-t132+t166+t183)+0.3109D-1*t33*t45+0.3109D-1*t88*t100
      t193 = 0.5D0*t10+0.5D0*t65
      t196 = 1.D0+0.3D-2*t10+0.3D-2*t65
      t197 = 1/t196
      t200 = t193**2
      t201 = t196**2
      t202 = 1/t201
      t205 = 0.999849D0+0.843756D-2*t193*t197-0.2678616D-3*t200*t202
      zk(i) = -0.9305257363491D0*t5*t26-0.3109D-1*t33*t56
     #-0.9305257363491D0*t60*t81-0.3109D-1*t88*t111+t190*t205
      t212 = sigmaaa/t7/t6/rhoa
      t218 = t16/t4/t17/t6
      t222 = t17**2
      t225 = t16*sigmaaa/t222/rhoa
      t227 = 1/t22/t12
      t233 = t32*t45
      t236 = 1/t39
      t237 = t29*t236
      t240 = t41**2
      t241 = 1/t240
      t243 = t34**2
      t244 = t243**2
      t247 = 1/t6
      t258 = -0.1853395810515781D1/t244/t34*t247-0.128158207914907D1
     #*t236*t247-0.8223668877838045D0/t37*t247-0.1603914194192128D0
     #/t30*t247
      t259 = 1/t44
      t269 = 1/t51/t47
      t277 = 1/t158
      t278 = 1/t124*t277
      t279 = t278*t130
      t280 = 0.2747799777968419D-2*t279
      t281 = t126**2
      t284 = t119**2
      t285 = t284**2
      t288 = 1/t285/t119*t277
      t292 = 1/t122*t277
      t295 = 1/t116*t277
      t300 = t118/t281*(-0.99709173929518D0*t288-0.7418564737168958D0
     #*t278-0.4002143174996817D0*t292-0.1264669550498372D0*t295)/t129
      t301 = 0.1D1*t300
      t305 = 0.8740794299481065D-3*t278*t143*t155*t163
      t306 = t139**2
      t319 = 0.1124999956683108D1*t134/t306*(-0.135956911724794D1*t288
     #-0.7491972878592054D0*t278-0.2150486235638321D0*t292
     #-0.1274341730084892D0*t295)/t142*t155*t163
      t320 = t146*t277
      t321 = 1.D0*t320
      t325 = 1.D0*t115
      t329 = 0.1333333333333333D1*t149*(t115-t321)
     #+0.1333333333333333D1*t153*(-t325+t320)
      t334 = t156*t146*t160
      t335 = 4.D0*t334
      t338 = t157/t159/t114
      t339 = 4.D0*t338
      t346 = t173**2
      t363 = 0.1923661050931536D1*(0.1321010150222857D-2*t278*t177
     #+0.1D1*t168/t346*(-0.1853395810515781D1*t288-0.128158207914907D1
     #*t278-0.8223668877838045D0*t292-0.1603914194192128D0*t295)/t176
     #-0.2747799777968419D-2*t279-0.1D1*t300)*t155*t161
      t367 = t181*t334
      t370 = 0.7694644203726145D1*t181*t338
      t384 = t193*t202
      t389 = t200/t201/t196
      s1 = -0.12407009817988D1*t4*t26-0.9305257363491D0*t5*(
     #-0.5102933333333333D-3*t212*t13-0.14825216D-3*t218*t23
     #+0.6011733333333333D-6*t225*t227)-0.3109D-1*t233*t55
     #+0.1321010150222857D-2*t237*t56
      vrhoa(i) = s1+0.1D1*t33*t241*t258*t259*t55-0.3109D-1*t33*t45*
     #(0.3688970666666667D0*t212*t48-0.15800256D0*t218*t52
     #+0.1684462933333333D-1*t225*t269)+(-t132+t166+t183+t114*(t280
     #+t301-t305-t319+0.3799574853701528D-1*t144*t329*t163
     #+0.3799574853701528D-1*t144*t155*(-t335+t339)+t363
     #+0.1923661050931536D1*t180*t329*t161+0.7694644203726145D1*t367
     #-t370)+0.3109D-1*t233-0.1321010150222857D-2*t237*t45-0.1D1*t33
     #*t241*t258*t259)*t205+t190*(-0.1125008D-1*t212*t197
     #+0.78179808D-3*t384*t212-0.42857856D-5*t389*t212)
      t399 = sigmabb/t62/t61/rhob
      t405 = t71/t59/t72/t61
      t409 = t72**2
      t412 = t71*sigmabb/t409/rhob
      t414 = 1/t77/t67
      t420 = t87*t100
      t423 = 1/t94
      t424 = t84*t423
      t427 = t96**2
      t428 = 1/t427
      t430 = t89**2
      t431 = t430**2
      t434 = 1/t61
      t445 = -0.1853395810515781D1/t431/t89*t434-0.128158207914907D1
     #*t423*t434-0.8223668877838045D0/t92*t434-0.1603914194192128D0
     #/t85*t434
      t446 = 1/t99
      t456 = 1/t106/t102
      t469 = 0.1333333333333333D1*t149*(-t325-t321)
     #+0.1333333333333333D1*t153*(t115+t320)
      s1 = -0.12407009817988D1*t59*t81-0.9305257363491D0*t60*(
     #-0.5102933333333333D-3*t399*t68-0.14825216D-3*t405*t78
     #+0.6011733333333333D-6*t412*t414)-0.3109D-1*t420*t110
     #+0.1321010150222857D-2*t424*t111
      vrhob(i) = s1+0.1D1*t88*t428*t445*t446*t110-0.3109D-1*t88*t100*
     #(0.3688970666666667D0*t399*t103-0.15800256D0*t405*t107
     #+0.1684462933333333D-1*t412*t456)+(-t132+t166+t183+t114*(t280
     #+t301-t305-t319+0.3799574853701528D-1*t144*t469*t163
     #+0.3799574853701528D-1*t144*t155*(t335+t339)+t363
     #+0.1923661050931536D1*t180*t469*t161-0.7694644203726145D1*t367
     #-t370)+0.3109D-1*t420-0.1321010150222857D-2*t424*t100-0.1D1*t88
     #*t428*t445*t446)*t205+t190*(-0.1125008D-1*t399*t197
     #+0.78179808D-3*t384*t399-0.42857856D-5*t389*t399)
      t502 = sigmaaa*t20
      t506 = t16/t222
      vsigmaaa(i) = -0.9305257363491D0*t5*(0.19136D-3*t9*t13
     #+0.5559456D-4*t502*t23-0.22544D-6*t506*t227)-0.3109D-1*t33*t45*(
     #-0.1383364D0*t9*t48+0.5925096D-1*t502*t52-0.6316736D-2*t506*t269
     #)+t190*(0.421878D-2*t9*t197-0.29317428D-3*t384*t9+0.16071696D-5
     #*t389*t9)
      vsigmaab(i) = 0.D0
      t532 = sigmabb*t75
      t536 = t71/t409
      vsigmabb(i) = -0.9305257363491D0*t60*(0.19136D-3*t64*t68
     #+0.5559456D-4*t532*t78-0.22544D-6*t536*t414)-0.3109D-1*t88*t100*
     #(-0.1383364D0*t64*t103+0.5925096D-1*t532*t107-0.6316736D-2*t536
     #*t456)+t190*(0.421878D-2*t64*t197-0.29317428D-3*t384*t64
     #+0.16071696D-5*t389*t64)
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t3 = t2*rhob
      t4 = rhob**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigmabb*t7
      t10 = 1.D0+0.4D-2*t8
      t11 = 1/t10
      t14 = sigmabb**2
      t15 = t4**2
      t18 = 1/t2/t15/rhob
      t19 = t14*t18
      t20 = t10**2
      t21 = 1/t20
      t24 = 0.827642D0+0.19136D-3*t8*t11+0.2818D-4*t19*t21
      t27 = 1/rhob
      t28 = t27**(1.D0/3.D0)
      t30 = 1.D0+0.1274696188700087D0*t28
      t31 = rhob*t30
      t32 = t27**(1.D0/6.D0)
      t35 = dsqrt(t27)
      t37 = t28**2
      t39 = 0.1112037486309468D2*t32+0.3844746237447211D1*t28
     #+0.1644733775567609D1*t35+0.2405871291288192D0*t37
      t42 = 1.D0+0.321646831778707D2/t39
      t43 = dlog(t42)
      t45 = 1.D0+0.2D0*t8
      t46 = 1/t45
      t49 = t45**2
      t50 = 1/t49
      t53 = 0.585808D0-0.1383364D0*t8*t46+0.1579184D-1*t19*t50
      t54 = t43*t53
      zk(i) = -0.9305257363491D0*t3*t24-0.3109D-1*t31*t54
      vrhoa(i) = 0.D0
      t59 = t4*rhob
      t62 = sigmabb/t5/t59
      t68 = t14/t2/t15/t4
      t71 = t14*sigmabb
      t72 = t15**2
      t75 = t71/t72/rhob
      t77 = 1/t20/t10
      t80 = -0.5102933333333333D-3*t62*t11-0.14825216D-3*t68*t21
     #+0.6011733333333333D-6*t75*t77
      t83 = t30*t43
      t86 = 1/t37
      t87 = t27*t86
      t90 = t39**2
      t91 = 1/t90
      t92 = t31*t91
      t93 = t32**2
      t94 = t93**2
      t95 = t94*t32
      t96 = 1/t95
      t97 = 1/t4
      t102 = 1/t35
      t105 = 1/t28
      t108 = -0.1853395810515781D1*t96*t97-0.128158207914907D1*t86*t97
     #-0.8223668877838045D0*t102*t97-0.1603914194192128D0*t105*t97
      t109 = 1/t42
      t110 = t108*t109
      t111 = t110*t53
      t119 = 1/t49/t45
      t122 = 0.3688970666666667D0*t62*t46-0.15800256D0*t68*t50
     #+0.1684462933333333D-1*t75*t119
      t123 = t43*t122
      vrhob(i) = -0.12407009817988D1*t2*t24-0.9305257363491D0*t3*t80
     #-0.3109D-1*t83*t53+0.1321010150222857D-2*t87*t54+0.1D1*t92*t111
     #-0.3109D-1*t31*t123
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      t128 = sigmabb*t18
      t131 = 1/t72
      t132 = t14*t131
      vsigmabb(i) = -0.9305257363491D0*t3*(0.19136D-3*t7*t11
     #+0.5559456D-4*t128*t21-0.22544D-6*t132*t77)-0.3109D-1*t31*t43*(
     #-0.1383364D0*t7*t46+0.5925096D-1*t128*t50-0.6316736D-2*t132*t119)
      v2rhoa2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t155 = sigmabb/t5/t15
      t161 = t14/t2/t15/t59
      t164 = t72*t4
      t166 = t71/t164
      t169 = t14**2
      t173 = t169/t5/t72/t15
      t174 = t20**2
      t175 = 1/t174
      t186 = 1/t59
      t188 = 1/t37/t27
      t200 = t108**2
      t207 = 1/t15
      t233 = t90**2
      t236 = t42**2
      t251 = t49**2
      t252 = 1/t251
      s1 = -0.4135669939329333D0/t5*t24-0.24814019635976D1*t2*t80
     #-0.9305257363491D0*t3*(0.1871075555555556D-2*t155*t11
     #+0.9334872177777778D-3*t161*t21-0.8573272746666667D-5*t166*t77
     #+0.1923754666666667D-7*t173*t175)+0.2D1*t30*t91*t111-0.6218D-1
     #*t83*t122+0.8806734334819047D-3*t186*t188*t54
      v2rhob2(i) = s1-0.8497974591333914D-1*t87*t91*t111
     #+0.2642020300445714D-2*t87*t123-0.2D1*t31/t90/t39*t200*t109*t53
     #+0.1D1*t92*(-0.1544496508763151D1/t95/t27*t207
     #+0.3706791621031562D1*t96*t186-0.854388052766047D0*t188*t207
     #+0.2563164158298141D1*t86*t186-0.4111834438919023D0/t35/t27*t207
     #+0.1644733775567609D1*t102*t186-0.5346380647307093D-1/t28/t27
     #*t207+0.3207828388384256D0*t105*t186)*t109*t53
     #+0.321646831778707D2*t31/t233*t200/t236*t53+0.2D1*t92*t110*t122
     #-0.3109D-1*t31*t43*(-0.1352622577777778D1*t155*t46
     #+0.1197427982222222D1*t161*t50-0.320137728D0*t166*t119
     #+0.2695140693333333D-1*t173*t252)
      v2sigmaaa2(i) = 0.D0
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      t261 = sigmabb*t131
      t266 = t14/t5/t164
      v2sigmabb2(i) = -0.9305257363491D0*t3*(0.5482912D-4*t18*t21
     #-0.89563648D-6*t261*t77+0.270528D-8*t266*t175)-0.3109D-1*t31*t43
     #*(0.8691824D-1*t18*t50-0.36333856D-1*t261*t119+0.37900416D-2
     #*t266*t252)
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t3 = t2*rhoa
      t4 = rhoa**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigmaaa*t7
      t10 = 1.D0+0.4D-2*t8
      t11 = 1/t10
      t14 = sigmaaa**2
      t15 = t4**2
      t18 = 1/t2/t15/rhoa
      t19 = t14*t18
      t20 = t10**2
      t21 = 1/t20
      t24 = 0.827642D0+0.19136D-3*t8*t11+0.2818D-4*t19*t21
      t27 = 1/rhoa
      t28 = t27**(1.D0/3.D0)
      t30 = 1.D0+0.1274696188700087D0*t28
      t31 = rhoa*t30
      t32 = t27**(1.D0/6.D0)
      t35 = dsqrt(t27)
      t37 = t28**2
      t39 = 0.1112037486309468D2*t32+0.3844746237447211D1*t28
     #+0.1644733775567609D1*t35+0.2405871291288192D0*t37
      t42 = 1.D0+0.321646831778707D2/t39
      t43 = dlog(t42)
      t45 = 1.D0+0.2D0*t8
      t46 = 1/t45
      t49 = t45**2
      t50 = 1/t49
      t53 = 0.585808D0-0.1383364D0*t8*t46+0.1579184D-1*t19*t50
      t54 = t43*t53
      zk(i) = -0.9305257363491D0*t3*t24-0.3109D-1*t31*t54
      t59 = t4*rhoa
      t62 = sigmaaa/t5/t59
      t68 = t14/t2/t15/t4
      t71 = t14*sigmaaa
      t72 = t15**2
      t75 = t71/t72/rhoa
      t77 = 1/t20/t10
      t80 = -0.5102933333333333D-3*t62*t11-0.14825216D-3*t68*t21
     #+0.6011733333333333D-6*t75*t77
      t83 = t30*t43
      t86 = 1/t37
      t87 = t27*t86
      t90 = t39**2
      t91 = 1/t90
      t92 = t31*t91
      t93 = t32**2
      t94 = t93**2
      t95 = t94*t32
      t96 = 1/t95
      t97 = 1/t4
      t102 = 1/t35
      t105 = 1/t28
      t108 = -0.1853395810515781D1*t96*t97-0.128158207914907D1*t86*t97
     #-0.8223668877838045D0*t102*t97-0.1603914194192128D0*t105*t97
      t109 = 1/t42
      t110 = t108*t109
      t111 = t110*t53
      t119 = 1/t49/t45
      t122 = 0.3688970666666667D0*t62*t46-0.15800256D0*t68*t50
     #+0.1684462933333333D-1*t75*t119
      t123 = t43*t122
      vrhoa(i) = -0.12407009817988D1*t2*t24-0.9305257363491D0*t3*t80
     #-0.3109D-1*t83*t53+0.1321010150222857D-2*t87*t54+0.1D1*t92*t111
     #-0.3109D-1*t31*t123
      vrhob(i) = 0.D0
      t128 = sigmaaa*t18
      t131 = 1/t72
      t132 = t14*t131
      vsigmaaa(i) = -0.9305257363491D0*t3*(0.19136D-3*t7*t11
     #+0.5559456D-4*t128*t21-0.22544D-6*t132*t77)-0.3109D-1*t31*t43*(
     #-0.1383364D0*t7*t46+0.5925096D-1*t128*t50-0.6316736D-2*t132*t119)
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      t155 = sigmaaa/t5/t15
      t161 = t14/t2/t15/t59
      t164 = t72*t4
      t166 = t71/t164
      t169 = t14**2
      t173 = t169/t5/t72/t15
      t174 = t20**2
      t175 = 1/t174
      t186 = 1/t59
      t188 = 1/t37/t27
      t200 = t108**2
      t207 = 1/t15
      t233 = t90**2
      t236 = t42**2
      t251 = t49**2
      t252 = 1/t251
      s1 = -0.4135669939329333D0/t5*t24-0.24814019635976D1*t2*t80
     #-0.9305257363491D0*t3*(0.1871075555555556D-2*t155*t11
     #+0.9334872177777778D-3*t161*t21-0.8573272746666667D-5*t166*t77
     #+0.1923754666666667D-7*t173*t175)+0.2D1*t30*t91*t111-0.6218D-1
     #*t83*t122+0.8806734334819047D-3*t186*t188*t54
      v2rhoa2(i) = s1-0.8497974591333914D-1*t87*t91*t111
     #+0.2642020300445714D-2*t87*t123-0.2D1*t31/t90/t39*t200*t109*t53
     #+0.1D1*t92*(-0.1544496508763151D1/t95/t27*t207
     #+0.3706791621031562D1*t96*t186-0.854388052766047D0*t188*t207
     #+0.2563164158298141D1*t86*t186-0.4111834438919023D0/t35/t27*t207
     #+0.1644733775567609D1*t102*t186-0.5346380647307093D-1/t28/t27
     #*t207+0.3207828388384256D0*t105*t186)*t109*t53
     #+0.321646831778707D2*t31/t233*t200/t236*t53+0.2D1*t92*t110*t122
     #-0.3109D-1*t31*t43*(-0.1352622577777778D1*t155*t46
     #+0.1197427982222222D1*t161*t50-0.320137728D0*t166*t119
     #+0.2695140693333333D-1*t173*t252)
      v2rhob2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t261 = sigmaaa*t131
      t266 = t14/t5/t164
      v2sigmaaa2(i) = -0.9305257363491D0*t3*(0.5482912D-4*t18*t21
     #-0.89563648D-6*t261*t77+0.270528D-8*t266*t175)-0.3109D-1*t31*t43
     #*(0.8691824D-1*t18*t50-0.36333856D-1*t261*t119+0.37900416D-2
     #*t266*t252)
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      v2sigmabb2(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t5 = t4*rhoa
      t6 = rhoa**2
      t7 = t4**2
      t9 = 1/t7/t6
      t10 = sigmaaa*t9
      t12 = 1.D0+0.4D-2*t10
      t13 = 1/t12
      t16 = sigmaaa**2
      t17 = t6**2
      t20 = 1/t4/t17/rhoa
      t21 = t16*t20
      t22 = t12**2
      t23 = 1/t22
      t26 = 0.827642D0+0.19136D-3*t10*t13+0.2818D-4*t21*t23
      t29 = 1/rhoa
      t30 = t29**(1.D0/3.D0)
      t32 = 1.D0+0.1274696188700087D0*t30
      t33 = rhoa*t32
      t34 = t29**(1.D0/6.D0)
      t37 = dsqrt(t29)
      t39 = t30**2
      t41 = 0.1112037486309468D2*t34+0.3844746237447211D1*t30
     #+0.1644733775567609D1*t37+0.2405871291288192D0*t39
      t44 = 1.D0+0.321646831778707D2/t41
      t45 = dlog(t44)
      t47 = 1.D0+0.2D0*t10
      t48 = 1/t47
      t51 = t47**2
      t52 = 1/t51
      t55 = 0.585808D0-0.1383364D0*t10*t48+0.1579184D-1*t21*t52
      t56 = t45*t55
      t59 = rhob**(1.D0/3.D0)
      t60 = t59*rhob
      t61 = rhob**2
      t62 = t59**2
      t64 = 1/t62/t61
      t65 = sigmabb*t64
      t67 = 1.D0+0.4D-2*t65
      t68 = 1/t67
      t71 = sigmabb**2
      t72 = t61**2
      t75 = 1/t59/t72/rhob
      t76 = t71*t75
      t77 = t67**2
      t78 = 1/t77
      t81 = 0.827642D0+0.19136D-3*t65*t68+0.2818D-4*t76*t78
      t84 = 1/rhob
      t85 = t84**(1.D0/3.D0)
      t87 = 1.D0+0.1274696188700087D0*t85
      t88 = rhob*t87
      t89 = t84**(1.D0/6.D0)
      t92 = dsqrt(t84)
      t94 = t85**2
      t96 = 0.1112037486309468D2*t89+0.3844746237447211D1*t85
     #+0.1644733775567609D1*t92+0.2405871291288192D0*t94
      t99 = 1.D0+0.321646831778707D2/t96
      t100 = dlog(t99)
      t102 = 1.D0+0.2D0*t65
      t103 = 1/t102
      t106 = t102**2
      t107 = 1/t106
      t110 = 0.585808D0-0.1383364D0*t65*t103+0.1579184D-1*t76*t107
      t111 = t100*t110
      t114 = rhoa+rhob
      t115 = 1/t114
      t116 = t115**(1.D0/3.D0)
      t118 = 1.D0+0.1325688999052018D0*t116
      t119 = t115**(1.D0/6.D0)
      t122 = dsqrt(t115)
      t124 = t116**2
      t126 = 0.598255043577108D1*t119+0.2225569421150687D1*t116
     #+0.8004286349993634D0*t122+0.1897004325747559D0*t124
      t129 = 1.D0+0.160818243221511D2/t126
      t130 = dlog(t129)
      t132 = 0.62182D-1*t118*t130
      t134 = 1.D0+0.6901399211255825D-1*t116
      t139 = 0.8157414703487641D1*t119+0.2247591863577616D1*t116
     #+0.4300972471276643D0*t122+0.1911512595127338D0*t124
      t142 = 1.D0+0.2960857464321668D2/t139
      t143 = dlog(t142)
      t144 = t134*t143
      t146 = rhoa-1.D0*rhob
      t147 = t146*t115
      t148 = 1.D0+t147
      t149 = t148**(1.D0/3.D0)
      t152 = 1.D0-1.D0*t147
      t153 = t152**(1.D0/3.D0)
      t155 = t149*t148+t153*t152-2.D0
      t156 = t146**2
      t157 = t156**2
      t158 = t114**2
      t159 = t158**2
      t160 = 1/t159
      t161 = t157*t160
      t163 = 1.D0-1.D0*t161
      t164 = t155*t163
      t166 = 0.3799574853701528D-1*t144*t164
      t168 = 1.D0+0.1274696188700087D0*t116
      t173 = 0.1112037486309468D2*t119+0.3844746237447211D1*t116
     #+0.1644733775567609D1*t122+0.2405871291288192D0*t124
      t176 = 1.D0+0.321646831778707D2/t173
      t177 = dlog(t176)
      t180 = -0.3109D-1*t168*t177+t132
      t181 = t180*t155
      t183 = 0.1923661050931536D1*t181*t161
      t190 = t114*(-t132+t166+t183)+0.3109D-1*t33*t45+0.3109D-1*t88*t100
      t193 = 0.5D0*t10+0.5D0*t65
      t196 = 1.D0+0.3D-2*t10+0.3D-2*t65
      t197 = 1/t196
      t200 = t193**2
      t201 = t196**2
      t202 = 1/t201
      t205 = 0.999849D0+0.843756D-2*t193*t197-0.2678616D-3*t200*t202
      zk(i) = -0.9305257363491D0*t5*t26-0.3109D-1*t33*t56
     #-0.9305257363491D0*t60*t81-0.3109D-1*t88*t111+t190*t205
      t209 = t6*rhoa
      t211 = 1/t7/t209
      t212 = sigmaaa*t211
      t217 = 1/t4/t17/t6
      t218 = t16*t217
      t221 = t16*sigmaaa
      t222 = t17**2
      t224 = 1/t222/rhoa
      t225 = t221*t224
      t227 = 1/t22/t12
      t230 = -0.5102933333333333D-3*t212*t13-0.14825216D-3*t218*t23
     #+0.6011733333333333D-6*t225*t227
      t233 = t32*t45
      t236 = 1/t39
      t237 = t29*t236
      t240 = t41**2
      t241 = 1/t240
      t242 = t33*t241
      t243 = t34**2
      t244 = t243**2
      t245 = t244*t34
      t246 = 1/t245
      t247 = 1/t6
      t252 = 1/t37
      t255 = 1/t30
      t258 = -0.1853395810515781D1*t246*t247-0.128158207914907D1*t236
     #*t247-0.8223668877838045D0*t252*t247-0.1603914194192128D0*t255
     #*t247
      t259 = 1/t44
      t260 = t258*t259
      t261 = t260*t55
      t269 = 1/t51/t47
      t272 = 0.3688970666666667D0*t212*t48-0.15800256D0*t218*t52
     #+0.1684462933333333D-1*t225*t269
      t273 = t45*t272
      t276 = 1/t124
      t277 = 1/t158
      t278 = t276*t277
      t279 = t278*t130
      t280 = 0.2747799777968419D-2*t279
      t281 = t126**2
      t282 = 1/t281
      t283 = t118*t282
      t284 = t119**2
      t285 = t284**2
      t286 = t285*t119
      t287 = 1/t286
      t288 = t287*t277
      t291 = 1/t122
      t292 = t291*t277
      t294 = 1/t116
      t295 = t294*t277
      t297 = -0.99709173929518D0*t288-0.7418564737168958D0*t278
     #-0.4002143174996817D0*t292-0.1264669550498372D0*t295
      t298 = 1/t129
      t300 = t283*t297*t298
      t301 = 0.1D1*t300
      t302 = t143*t155
      t303 = t302*t163
      t304 = t278*t303
      t305 = 0.8740794299481065D-3*t304
      t306 = t139**2
      t307 = 1/t306
      t308 = t134*t307
      t313 = -0.135956911724794D1*t288-0.7491972878592054D0*t278
     #-0.2150486235638321D0*t292-0.1274341730084892D0*t295
      t314 = t308*t313
      t315 = 1/t142
      t316 = t315*t155
      t317 = t316*t163
      t318 = t314*t317
      t319 = 0.1124999956683108D1*t318
      t320 = t146*t277
      t321 = 1.D0*t320
      t322 = t115-t321
      t325 = 1.D0*t115
      t326 = -t325+t320
      t329 = 0.1333333333333333D1*t149*t322+0.1333333333333333D1*t153
     #*t326
      t331 = t144*t329*t163
      t332 = 0.3799574853701528D-1*t331
      t333 = t156*t146
      t334 = t333*t160
      t335 = 4.D0*t334
      t337 = 1/t159/t114
      t338 = t157*t337
      t339 = 4.D0*t338
      t340 = -t335+t339
      t342 = t144*t155*t340
      t343 = 0.3799574853701528D-1*t342
      t346 = t173**2
      t347 = 1/t346
      t348 = t168*t347
      t353 = -0.1853395810515781D1*t288-0.128158207914907D1*t278
     #-0.8223668877838045D0*t292-0.1603914194192128D0*t295
      t354 = 1/t176
      t360 = 0.1321010150222857D-2*t278*t177+0.1D1*t348*t353*t354
     #-0.2747799777968419D-2*t279-0.1D1*t300
      t361 = t360*t155
      t362 = t361*t161
      t363 = 0.1923661050931536D1*t362
      t364 = t180*t329
      t365 = t364*t161
      t366 = 0.1923661050931536D1*t365
      t367 = t181*t334
      t369 = t181*t338
      t370 = 0.7694644203726145D1*t369
      t377 = t241*t258*t259
      t380 = -t132+t166+t183+t114*(t280+t301-t305-t319+t332+t343+t363
     #+t366+0.7694644203726145D1*t367-t370)+0.3109D-1*t233
     #-0.1321010150222857D-2*t237*t45-0.1D1*t33*t377
      t384 = t193*t202
      t388 = 1/t201/t196
      t389 = t200*t388
      t392 = -0.1125008D-1*t212*t197+0.78179808D-3*t384*t212
     #-0.42857856D-5*t389*t212
      vrhoa(i) = -0.12407009817988D1*t4*t26-0.9305257363491D0*t5*t230
     #-0.3109D-1*t233*t55+0.1321010150222857D-2*t237*t56+0.1D1*t242
     #*t261-0.3109D-1*t33*t273+t380*t205+t190*t392
      t396 = t61*rhob
      t398 = 1/t62/t396
      t399 = sigmabb*t398
      t404 = 1/t59/t72/t61
      t405 = t71*t404
      t408 = t71*sigmabb
      t409 = t72**2
      t411 = 1/t409/rhob
      t412 = t408*t411
      t414 = 1/t77/t67
      t417 = -0.5102933333333333D-3*t399*t68-0.14825216D-3*t405*t78
     #+0.6011733333333333D-6*t412*t414
      t420 = t87*t100
      t423 = 1/t94
      t424 = t84*t423
      t427 = t96**2
      t428 = 1/t427
      t429 = t88*t428
      t430 = t89**2
      t431 = t430**2
      t432 = t431*t89
      t433 = 1/t432
      t434 = 1/t61
      t439 = 1/t92
      t442 = 1/t85
      t445 = -0.1853395810515781D1*t433*t434-0.128158207914907D1*t423
     #*t434-0.8223668877838045D0*t439*t434-0.1603914194192128D0*t442
     #*t434
      t446 = 1/t99
      t447 = t445*t446
      t448 = t447*t110
      t456 = 1/t106/t102
      t459 = 0.3688970666666667D0*t399*t103-0.15800256D0*t405*t107
     #+0.1684462933333333D-1*t412*t456
      t460 = t100*t459
      t463 = -t325-t321
      t466 = t115+t320
      t469 = 0.1333333333333333D1*t149*t463+0.1333333333333333D1*t153
     #*t466
      t471 = t144*t469*t163
      t472 = 0.3799574853701528D-1*t471
      t473 = t335+t339
      t475 = t144*t155*t473
      t476 = 0.3799574853701528D-1*t475
      t477 = t180*t469
      t478 = t477*t161
      t479 = 0.1923661050931536D1*t478
      t487 = t428*t445*t446
      t490 = -t132+t166+t183+t114*(t280+t301-t305-t319+t472+t476+t363
     #+t479-0.7694644203726145D1*t367-t370)+0.3109D-1*t420
     #-0.1321010150222857D-2*t424*t100-0.1D1*t88*t487
      t498 = -0.1125008D-1*t399*t197+0.78179808D-3*t384*t399
     #-0.42857856D-5*t389*t399
      vrhob(i) = -0.12407009817988D1*t59*t81-0.9305257363491D0*t60
     #*t417-0.3109D-1*t420*t110+0.1321010150222857D-2*t424*t111+0.1D1
     #*t429*t448-0.3109D-1*t88*t460+t490*t205+t190*t498
      t502 = sigmaaa*t20
      t505 = 1/t222
      t506 = t16*t505
      t509 = 0.19136D-3*t9*t13+0.5559456D-4*t502*t23-0.22544D-6*t506
     #*t227
      t518 = -0.1383364D0*t9*t48+0.5925096D-1*t502*t52-0.6316736D-2
     #*t506*t269
      t519 = t45*t518
      t528 = 0.421878D-2*t9*t197-0.29317428D-3*t384*t9+0.16071696D-5
     #*t389*t9
      vsigmaaa(i) = -0.9305257363491D0*t5*t509-0.3109D-1*t33*t519+t190
     #*t528
      vsigmaab(i) = 0.D0
      t532 = sigmabb*t75
      t535 = 1/t409
      t536 = t71*t535
      t539 = 0.19136D-3*t64*t68+0.5559456D-4*t532*t78-0.22544D-6*t536
     #*t414
      t548 = -0.1383364D0*t64*t103+0.5925096D-1*t532*t107-0.6316736D-2
     #*t536*t456
      t549 = t100*t548
      t558 = 0.421878D-2*t64*t197-0.29317428D-3*t384*t64+0.16071696D-5
     #*t389*t64
      vsigmabb(i) = -0.9305257363491D0*t60*t539-0.3109D-1*t88*t549
     #+t190*t558
      t563 = t297**2
      t565 = t118/t281/t126*t563*t298
      t566 = 0.2D1*t565
      t569 = 1/t286/t115*t160
      t572 = 1/t158/t114
      t573 = t287*t572
      t577 = 1/t124/t115*t160
      t579 = t276*t572
      t583 = 1/t122/t115*t160
      t585 = t291*t572
      t589 = 1/t116/t115*t160
      t591 = t294*t572
      t595 = t283*(-0.8309097827459833D0*t569+0.199418347859036D1*t573
     #-0.4945709824779306D0*t577+0.1483712947433792D1*t579
     #-0.2001071587498409D0*t583+0.8004286349993634D0*t585
     #-0.4215565168327908D-1*t589+0.2529339100996745D0*t591)*t298
      t596 = 0.1D1*t595
      t601 = 0.5827196199654043D-3*t577*t303
      t605 = t313**2
      t608 = 0.2249999913366216D1*t134/t306/t139*t605*t317
      t611 = t278*t143*t329*t163
      t613 = t577*t130
      t614 = 0.1831866518645613D-2*t613
      t615 = t579*t130
      t616 = 0.5495599555936838D-2*t615
      t618 = t278*t302*t340
      t621 = 0.1748158859896213D-2*t579*t303
      t626 = 0.5176049209143758D-1*t278*t307*t313*t315*t164
      t627 = t281**2
      t630 = t129**2
      t633 = t118/t627*t563/t630
      t634 = 0.160818243221511D2*t633
      t637 = t278*t282*t297*t298
      t638 = 0.8837926660346786D-1*t637
      t639 = t149**2
      t640 = 1/t639
      t641 = t322**2
      t644 = 2.D0*t277
      t646 = 2.D0*t146*t572
      t647 = -t644+t646
      t650 = t153**2
      t651 = 1/t650
      t652 = t326**2
      t658 = 0.4444444444444444D0*t640*t641+0.1333333333333333D1*t149
     #*t647+0.4444444444444444D0*t651*t652-0.1333333333333333D1*t153
     #*t647
      t662 = -t566+t596+0.7599149707403056D-1*t144*t329*t340-t601+t608
     #-0.1748158859896213D-2*t611+t614-t616-0.1748158859896213D-2*t618
     #+t621+t626+t634-t638+0.3799574853701528D-1*t144*t658*t163
      t663 = t156*t160
      t664 = 12.D0*t663
      t665 = t333*t337
      t666 = 32.D0*t665
      t669 = t157/t159/t158
      t670 = 20.D0*t669
      t675 = t306**2
      t679 = t142**2
      t684 = 0.3330964519106732D2*t134/t675*t605/t679*t155*t163
      t686 = t314*t316*t340
      t699 = t353**2
      t715 = t346**2
      t718 = t176**2
      t729 = 0.8806734334819047D-3*t577*t177-0.2642020300445714D-2
     #*t579*t177-0.8497974591333914D-1*t278*t347*t353*t354-0.2D1*t168
     #/t346/t173*t699*t354+0.1D1*t348*(-0.1544496508763151D1*t569
     #+0.3706791621031562D1*t573-0.854388052766047D0*t577
     #+0.2563164158298141D1*t579-0.4111834438919023D0*t583
     #+0.1644733775567609D1*t585-0.5346380647307093D-1*t589
     #+0.3207828388384256D0*t591)*t354+0.321646831778707D2*t168/t715
     #*t699/t718-0.1831866518645613D-2*t613+0.5495599555936838D-2*t615
     #+0.8837926660346786D-1*t637+0.2D1*t565-0.1D1*t595
     #-0.160818243221511D2*t633
      t732 = 0.1923661050931536D1*t729*t155*t161
      t733 = t181*t663
      t734 = 0.2308393261117844D2*t733
      t735 = t181*t665
      t737 = t364*t334
      t739 = t364*t338
      t743 = t314*t315*t329*t163
      t756 = 0.1124999956683108D1*t308*(-0.1132974264373283D1*t569
     #+0.271913823449588D1*t573-0.4994648585728036D0*t577
     #+0.1498394575718411D1*t579-0.1075243117819161D0*t583
     #+0.4300972471276643D0*t585-0.4247805766949639D-1*t589
     #+0.2548683460169784D0*t591)*t317
      t758 = t360*t329*t161
      t760 = t361*t334
      t763 = 0.1538928840745229D2*t361*t338
      t765 = 0.3847322101863073D2*t181*t669
      t769 = 0.3799574853701528D-1*t144*t155*(-t664+t666-t670)-t684
     #-0.2249999913366216D1*t686+t732+t734-0.6155715362980916D2*t735
     #+0.1538928840745229D2*t737-0.1538928840745229D2*t739
     #-0.2249999913366216D1*t743-t756+0.3847322101863073D1*t758
     #+0.1538928840745229D2*t760-t763+t765+0.1923661050931536D1*t180
     #*t658*t161
      t772 = t32*t241
      t775 = 0.2D1*t300
      t776 = t240**2
      t777 = 1/t776
      t778 = t258**2
      t780 = t44**2
      t781 = 1/t780
      t787 = 1/t17
      t790 = 1/t209
      t794 = 1/t39/t29
      t811 = -0.1544496508763151D1/t245/t29*t787+0.3706791621031562D1
     #*t246*t790-0.854388052766047D0*t794*t787+0.2563164158298141D1
     #*t236*t790-0.4111834438919023D0/t37/t29*t787
     #+0.1644733775567609D1*t252*t790-0.5346380647307093D-1/t30/t29
     #*t787+0.3207828388384256D0*t255*t790
      t816 = t790*t794
      t822 = 1/t240/t41
      t828 = 0.1748158859896213D-2*t304
      t829 = 0.2249999913366216D1*t318
      t830 = 0.3847322101863073D1*t362
      t832 = 0.5495599555936838D-2*t279
      t834 = 0.1538928840745229D2*t369
      t836 = t114*(t662+t769)-0.2D1*t772*t260+t775-0.321646831778707D2
     #*t33*t777*t778*t781-0.1D1*t33*t241*t811*t259
     #-0.8806734334819047D-3*t816*t45+0.8497974591333914D-1*t237*t377
     #+0.2D1*t33*t822*t778*t259+0.7599149707403056D-1*t342-t828-t829
     #+t830+0.7599149707403056D-1*t331+t832+0.1538928840745229D2*t367
     #-t834+0.3847322101863073D1*t365
      t871 = sigmaaa/t7/t17
      t877 = t16/t4/t17/t209
      t880 = t222*t6
      t882 = t221/t880
      t885 = t16**2
      t889 = t885/t7/t222/t17
      t890 = t22**2
      t891 = 1/t890
      t905 = t51**2
      t906 = 1/t905
      t917 = t193*t388
      t922 = t201**2
      t924 = t200/t922
      s1 = t836*t205+0.321646831778707D2*t33*t777*t778*t781*t55+0.1D1
     #*t242*t811*t259*t55-0.8497974591333914D-1*t237*t241*t261-0.2D1
     #*t33*t822*t778*t259*t55+0.2642020300445714D-2*t237*t273+0.2D1
     #*t772*t261+0.8806734334819047D-3*t816*t56
      v2rhoa2(i) = s1+0.2D1*t242*t260*t272-0.4135669939329333D0/t7*t26
     #-0.24814019635976D1*t4*t230-0.9305257363491D0*t5*
     #(0.1871075555555556D-2*t871*t13+0.9334872177777778D-3*t877*t23
     #-0.8573272746666667D-5*t882*t227+0.1923754666666667D-7*t889*t891
     #)-0.6218D-1*t233*t272-0.3109D-1*t33*t45*(-0.1352622577777778D1
     #*t871*t48+0.1197427982222222D1*t877*t52-0.320137728D0*t882*t269
     #+0.2695140693333333D-1*t889*t906)+t190*(0.4125029333333333D-1
     #*t871*t197-0.113239808D-2*t877*t202+0.2393753088D-4*t917*t877
     #-0.286659296D-2*t384*t871-0.1028588544D-6*t924*t877
     #+0.157145472D-4*t389*t871)+2.D0*t380*t392
      t940 = sigmabb/t62/t72
      t946 = t71/t59/t72/t396
      t949 = t409*t61
      t951 = t408/t949
      t954 = t71**2
      t958 = t954/t62/t409/t72
      t959 = t77**2
      t960 = 1/t959
      t968 = t87*t428
      t973 = 1/t396
      t975 = 1/t94/t84
      t976 = t973*t975
      t988 = t106**2
      t989 = 1/t988
      t997 = 1/t427/t96
      t999 = t445**2
      t1009 = t314*t316*t473
      t1011 = t463**2
      t1014 = t644+t646
      t1017 = t466**2
      t1023 = 0.4444444444444444D0*t640*t1011+0.1333333333333333D1
     #*t149*t1014+0.4444444444444444D0*t651*t1017-0.1333333333333333D1
     #*t153*t1014
      t1028 = t278*t302*t473
      t1032 = t278*t143*t469*t163
      t1037 = -0.2249999913366216D1*t1009+0.3799574853701528D-1*t144
     #*t1023*t163-t566+t596-0.1748158859896213D-2*t1028
     #-0.1748158859896213D-2*t1032-t601+t608+t614-t616+t621+t626+t634
     #+0.7599149707403056D-1*t144*t469*t473
      t1048 = t360*t469*t161
      t1050 = t477*t338
      t1052 = t477*t334
      t1056 = t314*t315*t469*t163
      t1058 = -t638-t684+0.3799574853701528D-1*t144*t155*(-t664-t666
     #-t670)+t732+t734+0.6155715362980916D2*t735-t756
     #+0.1923661050931536D1*t180*t1023*t161-0.1538928840745229D2*t760
     #-t763+t765+0.3847322101863073D1*t1048-0.1538928840745229D2*t1050
     #-0.1538928840745229D2*t1052-0.2249999913366216D1*t1056
      t1073 = 1/t72
      t1094 = -0.1544496508763151D1/t432/t84*t1073
     #+0.3706791621031562D1*t433*t973-0.854388052766047D0*t975*t1073
     #+0.2563164158298141D1*t423*t973-0.4111834438919023D0/t92/t84
     #*t1073+0.1644733775567609D1*t439*t973-0.5346380647307093D-1/t85
     #/t84*t1073+0.3207828388384256D0*t442*t973
      t1099 = t427**2
      t1100 = 1/t1099
      t1102 = t99**2
      t1103 = 1/t1102
      t1107 = t775-t828-t829+t830+t832-0.1538928840745229D2*t367-t834
     #+0.7599149707403056D-1*t471+0.7599149707403056D-1*t475
     #+0.3847322101863073D1*t478+t114*(t1037+t1058)-0.2D1*t968*t447
     #-0.8806734334819047D-3*t976*t100+0.8497974591333914D-1*t424*t487
     #+0.2D1*t88*t997*t999*t446-0.1D1*t88*t428*t1094*t446
     #-0.321646831778707D2*t88*t1100*t999*t1103
      s1 = -0.4135669939329333D0/t62*t81-0.24814019635976D1*t59*t417
     #-0.9305257363491D0*t60*(0.1871075555555556D-2*t940*t68
     #+0.9334872177777778D-3*t946*t78-0.8573272746666667D-5*t951*t414
     #+0.1923754666666667D-7*t958*t960)-0.6218D-1*t420*t459+0.2D1*t968
     #*t448+0.2642020300445714D-2*t424*t460+0.8806734334819047D-3*t976
     #*t111-0.8497974591333914D-1*t424*t428*t448
      v2rhob2(i) = s1-0.3109D-1*t88*t100*(-0.1352622577777778D1*t940
     #*t103+0.1197427982222222D1*t946*t107-0.320137728D0*t951*t456
     #+0.2695140693333333D-1*t958*t989)-0.2D1*t88*t997*t999*t446*t110
     #+t1107*t205+0.1D1*t429*t1094*t446*t110+0.2D1*t429*t447*t459
     #+0.321646831778707D2*t88*t1100*t999*t1103*t110+2.D0*t490*t498
     #+t190*(0.4125029333333333D-1*t940*t197-0.113239808D-2*t946*t202
     #+0.2393753088D-4*t917*t946-0.286659296D-2*t384*t940
     #-0.1028588544D-6*t924*t946+0.157145472D-4*t389*t940)
      t1161 = 0.4444444444444444D0*t640*t322*t463+0.2666666666666667D1
     #*t149*t146*t572+0.4444444444444444D0*t651*t326*t466
     #-0.2666666666666667D1*t153*t146*t572
      t1168 = -0.1124999956683108D1*t1009-t566+t596
     #-0.8740794299481065D-3*t1028-0.8740794299481065D-3*t1032-t601
     #+t608-0.8740794299481065D-3*t611+t614-t616-0.8740794299481065D-3
     #*t618+t621+0.3799574853701528D-1*t144*t155*(t664-t670)
     #+0.3799574853701528D-1*t144*t329*t473+0.3799574853701528D-1*t144
     #*t1161*t163+0.1923661050931536D1*t180*t1161*t161+t626
      t1182 = t634-t638-t684-0.1124999956683108D1*t686+t732
     #-0.2308393261117844D2*t733-0.7694644203726145D1*t737
     #-0.7694644203726145D1*t739-0.1124999956683108D1*t743-t756
     #+0.1923661050931536D1*t758-t763+t765+0.3799574853701528D-1*t144
     #*t469*t340+0.1923661050931536D1*t1048-0.7694644203726145D1*t1050
     #+0.7694644203726145D1*t1052-0.1124999956683108D1*t1056
      t1185 = t832+t775-t828-t829+t472+t476+t830+t479-t834+t332+t343
     #+t366+t114*(t1168+t1182)
      t1195 = t211*sigmabb*t398
      v2rhoab(i) = t1185*t205+t380*t498+t490*t392+t190*(
     #-0.113239808D-2*t212*t202*sigmabb*t398+0.2393753088D-4*t917
     #*sigmaaa*t1195-0.1028588544D-6*t924*sigmaaa*t1195)
      t1207 = sigmaaa*t217
      t1210 = t16*t224
      t1216 = t221/t7/t222/t209
      v2rhoasigmaaa(i) = -0.12407009817988D1*t4*t509-0.9305257363491D0
     #*t5*(-0.5102933333333333D-3*t211*t13-0.2944631466666667D-3*t1207
     #*t23+0.298953728D-5*t1210*t227-0.721408D-8*t1216*t891)-0.3109D-1
     #*t233*t518+0.1321010150222857D-2*t237*t519+0.1D1*t242*t260*t518
     #-0.3109D-1*t33*t45*(0.3688970666666667D0*t211*t48
     #-0.3897845333333333D0*t1207*t52+0.113734912D0*t1210*t269
     #-0.101067776D-1*t1216*t906)+t380*t528+t190*(-0.1125008D-1*t211
     #*t197+0.42464928D-3*t1207*t202-0.897657408D-5*t917*t1207
     #+0.78179808D-3*t384*t211+0.385720704D-7*t924*t1207-0.42857856D-5
     #*t389*t211)
      v2rhoasigmaab(i) = 0.D0
      t1260 = t212*t64
      v2rhoasigmabb(i) = t380*t558+t190*(0.42464928D-3*t212*t202*t64
     #-0.897657408D-5*t917*t1260+0.385720704D-7*t924*t1260)
      t1268 = t202*t9
      t1271 = t399*t9
      v2rhobsigmaaa(i) = t490*t528+t190*(0.42464928D-3*t399*t1268
     #-0.897657408D-5*t917*t1271+0.385720704D-7*t924*t1271)
      v2rhobsigmaab(i) = 0.D0
      t1282 = sigmabb*t404
      t1285 = t71*t411
      t1291 = t408/t62/t409/t396
      v2rhobsigmabb(i) = -0.12407009817988D1*t59*t539
     #-0.9305257363491D0*t60*(-0.5102933333333333D-3*t398*t68
     #-0.2944631466666667D-3*t1282*t78+0.298953728D-5*t1285*t414
     #-0.721408D-8*t1291*t960)-0.3109D-1*t420*t548
     #+0.1321010150222857D-2*t424*t549+0.1D1*t429*t447*t548-0.3109D-1
     #*t88*t100*(0.3688970666666667D0*t398*t103-0.3897845333333333D0
     #*t1282*t107+0.113734912D0*t1285*t456-0.101067776D-1*t1291*t989)
     #+t490*t558+t190*(-0.1125008D-1*t398*t197+0.42464928D-3*t1282
     #*t202-0.897657408D-5*t917*t1282+0.78179808D-3*t384*t398
     #+0.385720704D-7*t924*t1282-0.42857856D-5*t389*t398)
      t1333 = sigmaaa*t505
      t1338 = t16/t7/t880
      v2sigmaaa2(i) = -0.9305257363491D0*t5*(0.5482912D-4*t20*t23
     #-0.89563648D-6*t1333*t227+0.270528D-8*t1338*t891)-0.3109D-1*t33
     #*t45*(0.8691824D-1*t20*t52-0.36333856D-1*t1333*t269
     #+0.37900416D-2*t1338*t906)+t190*(-0.15924348D-3*t20*t202
     #+0.336621528D-5*t917*t20-0.144645264D-7*t924*t20)
      v2sigmaaaab(i) = 0.D0
      t1364 = t9*t64
      v2sigmaaabb(i) = t190*(-0.15924348D-3*t1268*t64+0.336621528D-5
     #*t917*t1364-0.144645264D-7*t924*t1364)
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      t1372 = sigmabb*t535
      t1377 = t71/t62/t949
      v2sigmabb2(i) = -0.9305257363491D0*t60*(0.5482912D-4*t75*t78
     #-0.89563648D-6*t1372*t414+0.270528D-8*t1377*t960)-0.3109D-1*t88
     #*t100*(0.8691824D-1*t75*t107-0.36333856D-1*t1372*t456
     #+0.37900416D-2*t1377*t989)+t190*(-0.15924348D-3*t75*t202
     #+0.336621528D-5*t917*t75-0.144645264D-7*t924*t75)
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      v2rhob2(i) = 0.0d0
      v2rhoab(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2rhoasigmaab(i) = 0.0d0
      v2rhoasigmabb(i) = 0.0d0
      v2rhobsigmaaa(i) = 0.0d0
      v2rhobsigmaab(i) = 0.0d0
      v2rhobsigmabb(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      v2sigmaab2(i) = 0.0d0
      v2sigmabb2(i) = 0.0d0
      v2sigmaaaab(i) = 0.0d0
      v2sigmaaabb(i) = 0.0d0
      v2sigmaabbb(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end
      
      
      subroutine rks_xc_b97_2
     & (ideriv,npt,rhoa1,sigmaaa1,
     &  zk,vrhoa,vsigmaaa,
     &  v2rhoa2,v2rhoasigmaaa,v2sigmaaa2)
c
c     P.J. Wilson, T.J. Bradley, and D.J. Tozer
c     Hybrid exchange-correlation functional determined from
c     thermochemical data and ab initio potentials
c     J. Chem. Phys. 115 (2001) 9233-9242
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt)
      REAL sigmaaa1(npt)
      REAL zk(npt),vrhoa(npt),vsigmaaa(npt)
      REAL v2rhoa2(npt),v2rhoasigmaaa(npt),v2sigmaaa2(npt)
      parameter(tol=1.0d-20)
      
      if(ideriv.eq.0) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t4 = rho**2
      t5 = t2**2
      t8 = sigma/t5/t4
      t10 = 1.D0+0.6349604207872798D-2*t8
      t14 = sigma**2
      t15 = t4**2
      t19 = t14/t2/t15/rho
      t20 = t10**2
      t27 = 1/rho
      t28 = t27**(1.D0/3.D0)
      t31 = rho*(1.D0+0.1606016560364007D0*t28)
      t32 = t27**(1.D0/6.D0)
      t35 = dsqrt(t27)
      t37 = t28**2
      t43 = dlog(1.D0+0.321646831778707D2/(0.1248219874679732D2*t32
     #+0.4844076716063854D1*t28+0.2326004811900819D1*t35
     #+0.3819082618690966D0*t37))
      t45 = 1.D0+0.3174802103936399D0*t8
      t49 = t45**2
      t68 = dlog(1.D0+0.160818243221511D2/(0.598255043577108D1*t32
     #+0.2225569421150687D1*t28+0.8004286349993634D0*t35
     #+0.1897004325747559D0*t37))
      t75 = 1.D0+0.9524406311809197D-2*t8
      t79 = t75**2
      zk(i) = -0.7385587663820224D0*t2*rho*(0.827642D0
     #+0.3037650653046347D-3*t8/t10+0.7100915037207505D-4*t19/t20)
     #-0.3109D-1*t31*t43*(0.585808D0-0.2195953468854936D0*t8/t45
     #+0.3979294326514371D-1*t19/t49)+(-0.62182D-1*rho*(1.D0
     #+0.1325688999052018D0*t28)*t68+0.3109D-1*t31*t43)*(0.999849D0
     #+0.133937916200448D-1*t8/t75-0.6749689365970411D-3*t19/t79)
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t3 = t2*rho
      t4 = rho**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigma*t7
      t10 = 1.D0+0.6349604207872798D-2*t8
      t11 = 1/t10
      t14 = sigma**2
      t15 = t4**2
      t18 = 1/t2/t15/rho
      t19 = t14*t18
      t20 = t10**2
      t21 = 1/t20
      t24 = 0.827642D0+0.3037650653046347D-3*t8*t11
     #+0.7100915037207505D-4*t19*t21
      t27 = 1/rho
      t28 = t27**(1.D0/3.D0)
      t30 = 1.D0+0.1606016560364007D0*t28
      t31 = rho*t30
      t32 = t27**(1.D0/6.D0)
      t35 = dsqrt(t27)
      t37 = t28**2
      t39 = 0.1248219874679732D2*t32+0.4844076716063854D1*t28
     #+0.2326004811900819D1*t35+0.3819082618690966D0*t37
      t42 = 1.D0+0.321646831778707D2/t39
      t43 = dlog(t42)
      t45 = 1.D0+0.3174802103936399D0*t8
      t46 = 1/t45
      t49 = t45**2
      t50 = 1/t49
      t53 = 0.585808D0-0.2195953468854936D0*t8*t46
     #+0.3979294326514371D-1*t19*t50
      t54 = t43*t53
      t58 = 1.D0+0.1325688999052018D0*t28
      t64 = 0.598255043577108D1*t32+0.2225569421150687D1*t28
     #+0.8004286349993634D0*t35+0.1897004325747559D0*t37
      t67 = 1.D0+0.160818243221511D2/t64
      t68 = dlog(t67)
      t73 = -0.62182D-1*rho*t58*t68+0.3109D-1*t31*t43
      t75 = 1.D0+0.9524406311809197D-2*t8
      t76 = 1/t75
      t79 = t75**2
      t80 = 1/t79
      t83 = 0.999849D0+0.133937916200448D-1*t8*t76
     #-0.6749689365970411D-3*t19*t80
      zk(i) = -0.7385587663820224D0*t3*t24-0.3109D-1*t31*t54+t73*t83
      t90 = sigma/t5/t4/rho
      t96 = t14/t2/t15/t4
      t100 = t15**2
      t103 = t14*sigma/t100/rho
      t105 = 1/t20/t10
      t111 = t30*t43
      t114 = 1/t37
      t115 = t27*t114
      t118 = t39**2
      t119 = 1/t118
      t121 = t32**2
      t122 = t121**2
      t125 = 1/t4
      t126 = 1/t122/t32*t125
      t128 = t114*t125
      t131 = 1/t35*t125
      t134 = 1/t28*t125
      t136 = -0.4160732915599108D1*t126-0.3229384477375903D1*t128
     #-0.2326004811900819D1*t131-0.5092110158254621D0*t134
      t137 = 1/t42
      t147 = 1/t49/t45
      t158 = t64**2
      t186 = 1/t79/t75
      s1 = -0.9847450218426965D0*t2*t24-0.3692793831910112D0*t3*(
     #-0.1620080348291385D-2*t90*t11-0.7471440683055309D-3*t96*t21
     #+0.4809386666666667D-5*t103*t105)-0.3109D-1*t111*t53
     #+0.1664368495390566D-2*t115*t54
      vrhoa(i) = s1+0.5D0*t31*t119*t136*t137*t53-0.15545D-1*t31*t43*
     #(0.1171175183389299D1*t90*t46-0.7962830051251108D0*t96*t50
     #+0.1347570346666667D0*t103*t147)+(-0.62182D-1*t58*t68+rho*
     #(0.2747799777968419D-2*t128*t68+0.1D1*t58/t158*(
     #-0.99709173929518D0*t126-0.7418564737168958D0*t128
     #-0.4002143174996817D0*t131-0.1264669550498372D0*t134)/t67)
     #+0.3109D-1*t111-0.1664368495390566D-2*t115*t43-0.5D0*t31*t119
     #*t136*t137)*t83+t73*(-0.357167776534528D-1*t90*t76
     #+0.3940015431037584D-2*t96*t80-0.342862848D-4*t103*t186)
      t193 = sigma*t18
      t197 = t14/t100
      vsigmaaa(i) = -0.7385587663820224D0*t3*(0.1215060261218539D-2*t7
     #*t11+0.5603580512291482D-3*t193*t21-0.360704D-5*t197*t105)
     #-0.3109D-1*t31*t43*(-0.8783813875419745D0*t7*t46
     #+0.5972122538438331D0*t193*t50-0.101067776D0*t197*t147)+2.D0*t73
     #*(0.267875832400896D-1*t7*t76-0.2955011573278188D-2*t193*t80
     #+0.257147136D-4*t197*t186)
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t3 = t2*rho
      t4 = rho**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigma*t7
      t10 = 1.D0+0.6349604207872798D-2*t8
      t11 = 1/t10
      t14 = sigma**2
      t15 = t4**2
      t18 = 1/t2/t15/rho
      t19 = t14*t18
      t20 = t10**2
      t21 = 1/t20
      t24 = 0.827642D0+0.3037650653046347D-3*t8*t11
     #+0.7100915037207505D-4*t19*t21
      t27 = 1/rho
      t28 = t27**(1.D0/3.D0)
      t30 = 1.D0+0.1606016560364007D0*t28
      t31 = rho*t30
      t32 = t27**(1.D0/6.D0)
      t35 = dsqrt(t27)
      t37 = t28**2
      t39 = 0.1248219874679732D2*t32+0.4844076716063854D1*t28
     #+0.2326004811900819D1*t35+0.3819082618690966D0*t37
      t42 = 1.D0+0.321646831778707D2/t39
      t43 = dlog(t42)
      t45 = 1.D0+0.3174802103936399D0*t8
      t46 = 1/t45
      t49 = t45**2
      t50 = 1/t49
      t53 = 0.585808D0-0.2195953468854936D0*t8*t46
     #+0.3979294326514371D-1*t19*t50
      t54 = t43*t53
      t58 = 1.D0+0.1325688999052018D0*t28
      t64 = 0.598255043577108D1*t32+0.2225569421150687D1*t28
     #+0.8004286349993634D0*t35+0.1897004325747559D0*t37
      t67 = 1.D0+0.160818243221511D2/t64
      t68 = dlog(t67)
      t73 = -0.62182D-1*rho*t58*t68+0.3109D-1*t31*t43
      t75 = 1.D0+0.9524406311809197D-2*t8
      t76 = 1/t75
      t79 = t75**2
      t80 = 1/t79
      t83 = 0.999849D0+0.133937916200448D-1*t8*t76
     #-0.6749689365970411D-3*t19*t80
      zk(i) = -0.7385587663820224D0*t3*t24-0.3109D-1*t31*t54+t73*t83
      t87 = t4*rho
      t89 = 1/t5/t87
      t90 = sigma*t89
      t95 = 1/t2/t15/t4
      t96 = t14*t95
      t99 = t14*sigma
      t100 = t15**2
      t102 = 1/t100/rho
      t103 = t99*t102
      t105 = 1/t20/t10
      t108 = -0.1620080348291385D-2*t90*t11-0.7471440683055309D-3*t96
     #*t21+0.4809386666666667D-5*t103*t105
      t111 = t30*t43
      t114 = 1/t37
      t115 = t27*t114
      t118 = t39**2
      t119 = 1/t118
      t120 = t31*t119
      t121 = t32**2
      t122 = t121**2
      t123 = t122*t32
      t124 = 1/t123
      t125 = 1/t4
      t126 = t124*t125
      t128 = t114*t125
      t130 = 1/t35
      t131 = t130*t125
      t133 = 1/t28
      t134 = t133*t125
      t136 = -0.4160732915599108D1*t126-0.3229384477375903D1*t128
     #-0.2326004811900819D1*t131-0.5092110158254621D0*t134
      t137 = 1/t42
      t138 = t136*t137
      t139 = t138*t53
      t147 = 1/t49/t45
      t150 = 0.1171175183389299D1*t90*t46-0.7962830051251108D0*t96*t50
     #+0.1347570346666667D0*t103*t147
      t151 = t43*t150
      t156 = t128*t68
      t158 = t64**2
      t159 = 1/t158
      t160 = t58*t159
      t165 = -0.99709173929518D0*t126-0.7418564737168958D0*t128
     #-0.4002143174996817D0*t131-0.1264669550498372D0*t134
      t166 = 1/t67
      t168 = t160*t165*t166
      t176 = t119*t136*t137
      t179 = -0.62182D-1*t58*t68+rho*(0.2747799777968419D-2*t156+0.1D1
     #*t168)+0.3109D-1*t111-0.1664368495390566D-2*t115*t43-0.5D0*t31
     #*t176
      t182 = 0.357167776534528D-1*t90*t76
      t183 = t96*t80
      t186 = 1/t79/t75
      t188 = 0.342862848D-4*t103*t186
      t189 = -t182+0.3940015431037584D-2*t183-t188
      vrhoa(i) = -0.9847450218426965D0*t2*t24-0.3692793831910112D0*t3
     #*t108-0.3109D-1*t111*t53+0.1664368495390566D-2*t115*t54+0.5D0
     #*t120*t139-0.15545D-1*t31*t151+t179*t83+t73*t189
      t193 = sigma*t18
      t196 = 1/t100
      t197 = t14*t196
      t200 = 0.1215060261218539D-2*t7*t11+0.5603580512291482D-3*t193
     #*t21-0.360704D-5*t197*t105
      t209 = -0.8783813875419745D0*t7*t46+0.5972122538438331D0*t193
     #*t50-0.101067776D0*t197*t147
      t210 = t43*t209
      t219 = 0.267875832400896D-1*t7*t76-0.2955011573278188D-2*t193
     #*t80+0.257147136D-4*t197*t186
      vsigmaaa(i) = -0.7385587663820224D0*t3*t200-0.3109D-1*t31*t210
     #+2.D0*t73*t219
      t223 = 1/t118/t39
      t225 = t136**2
      t230 = 1/t87
      t232 = 1/t37/t27
      t233 = t230*t232
      t239 = t30*t119
      t248 = sigma/t5/t15
      t254 = t14/t2/t15/t87
      t257 = t100*t4
      t259 = t99/t257
      t262 = t14**2
      t266 = t262/t5/t100/t15
      t267 = t20**2
      t268 = 1/t267
      t285 = t49**2
      t286 = 1/t285
      t293 = t118**2
      t294 = 1/t293
      t296 = t42**2
      t297 = 1/t296
      t302 = 0.5495599555936838D-2*t156
      t303 = 0.2D1*t168
      t306 = 1/t15
      t307 = 1/t123/t27*t306
      t309 = t124*t230
      t311 = t232*t306
      t313 = t114*t230
      t317 = 1/t35/t27*t306
      t319 = t130*t230
      t323 = 1/t28/t27*t306
      t325 = t133*t230
      t330 = 0.1D1*t160*(-0.8309097827459833D0*t307
     #+0.199418347859036D1*t309-0.4945709824779306D0*t311
     #+0.1483712947433792D1*t313-0.2001071587498409D0*t317
     #+0.8004286349993634D0*t319-0.4215565168327908D-1*t323
     #+0.2529339100996745D0*t325)*t166
      t334 = t165**2
      t337 = 0.2D1*t58/t158/t64*t334*t166
      t338 = t158**2
      t341 = t67**2
      t345 = 0.160818243221511D2*t58/t338*t334/t341
      t347 = 0.1831866518645613D-2*t311*t68
      t349 = 0.5495599555936838D-2*t313*t68
      t360 = dlog(1.D0+0.2960857464321668D2/(0.8157414703487641D1*t32
     #+0.2247591863577616D1*t28+0.4300972471276643D0*t35
     #+0.1911512595127338D0*t37))
      t362 = (1.D0+0.6901399211255825D-1*t28)*t360*t125
      t367 = 0.8837926660346786D-1*t128*t159*t165*t166
      t386 = -0.6934554859331846D1*t307+0.1664293166239643D2*t309
     #-0.4305845969834537D1*t311+0.1291753790950361D2*t313
     #-0.2326004811900819D1*t317+0.9304019247603276D1*t319
     #-0.3394740105503081D0*t323+0.2036844063301848D1*t325
      t410 = t254*t80
      t412 = t259*t186
      t414 = t79**2
      t415 = 1/t414
      t417 = 0.2612452058860862D-5*t266*t415
      s1 = -0.1D1*t31*t223*t225*t137*t53+0.2219157993854088D-2*t233
     #*t54-0.1070677706909338D0*t115*t119*t139+0.2D1*t239*t139
     #+0.3328736990781132D-2*t115*t151-0.6218D-1*t111*t150
     #-0.3692793831910112D0*t3*(0.1188058922080349D-1*t248*t11
     #+0.9408961563888175D-2*t254*t21-0.1371723639466667D-3*t259*t105
     #+0.4886032290552639D-6*t266*t268)-0.6564966812284644D0/t5*t24
     #-0.1969490043685393D1*t2*t108
      s2 = s1-0.15545D-1*t31*t43*(-0.8588618011521529D1*t248*t46
     #+0.1206931776427937D2*t254*t50-0.5122203648D1*t259*t147
     #+0.6845230674879417D0*t266*t286)+0.1608234158893535D2*t31*t294
     #*t225*t297*t53+(t302+t303+rho*(t330-t337+t345+t347-t349
     #+0.3377399869956914D-1*t362-t367)-0.2219157993854088D-2*t233*t43
     #+0.1070677706909338D0*t115*t176+0.1D1*t31*t223*t225*t137-0.5D0
     #*t31*t119*t386*t137-0.2D1*t239*t138-0.1608234158893535D2*t31
     #*t294*t225*t297)*t83+0.1D1*t120*t138*t150
      v2rhoa2(i) = s2+0.5D0*t120*t386*t137*t53+3.D0*t179*t189+t73*
     #(0.2619230361253206D0*t248*t76-0.4030730391709593D-1*t410
     #+0.63443324928D-3*t412-t417)+(t302+t303+rho*(t330-t337+t345+t347
     #-t349-0.3377399869956914D-1*t362-t367))*t83+t179*(-t182
     #+0.3940015431037584D-2*t183-t188)+t73*(-0.1141385742282031D-1
     #*t410+0.38300049408D-3*t412-t417)
      t436 = sigma*t95
      t439 = t14*t102
      t445 = t99/t5/t100/t87
      t474 = t436*t80
      t476 = t439*t186
      t479 = 0.1959339044145646D-5*t445*t415
      v2rhoasigmaaa(i) = -0.9847450218426965D0*t2*t200
     #-0.3692793831910112D0*t3*(-0.6480321393165539D-2*t89*t11
     #-0.5936005070457835D-2*t436*t21+0.9566519296D-4*t439*t105
     #-0.366452421791448D-6*t445*t268)-0.3109D-1*t111*t209
     #+0.1664368495390566D-2*t115*t210+0.5D0*t120*t138*t209-0.15545D-1
     #*t31*t43*(0.4684700733557197D1*t89*t46-0.7857563815521864D1*t436
     #*t50+0.3639517184D1*t439*t147-0.5133923006159563D0*t445*t286)
     #+2.D0*t179*t219+t73*(-0.1428671106138112D0*t89*t76
     #+0.2432045479126557D-1*t474-0.42439550976D-3*t476+t479)+t73*
     #(0.8560393067115231D-2*t474-0.28725037056D-3*t476+t479)
      t488 = sigma*t196
      t493 = t14/t5/t257
      v2sigmaaa2(i) = -0.7385587663820224D0*t3*(0.2210571597926784D-2
     #*t18*t21-0.5732073472D-4*t488*t105+0.274839316343586D-6*t493
     #*t268)-0.3109D-1*t31*t43*(0.3504323846266066D1*t18*t50
     #-0.2325366784D1*t488*t147+0.3850442254619672D0*t493*t286)+4.D0
     #*t73*(-0.6420294800336424D-2*t18*t80+0.21543777792D-3*t488*t186
     #-0.1469504283109235D-5*t493*t415)
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end

c:XC_B97_2subrend
_ENDIF
_IF(ccpdft,all,xc_b97_3)
c:XC_B97_3subrstart

c    Generated: Mon Jul 24 12:12:54 BST 2006

      subroutine uks_xc_b97_3
     & (ideriv,npt,rhoa1,rhob1,sigmaaa1,sigmabb1,sigmaab1,
     &  zk,vrhoa,vrhob,vsigmaaa,vsigmabb,vsigmaab,
     &  v2rhoa2,v2rhob2,v2rhoab,
     &  v2rhoasigmaaa,v2rhoasigmaab,v2rhoasigmabb,
     &  v2rhobsigmabb,v2rhobsigmaab,v2rhobsigmaaa,
     &  v2sigmaaa2,v2sigmaaaab,v2sigmaaabb,
     &  v2sigmaab2,v2sigmaabbb,v2sigmabb2)
c
c     T.W. Keal, and D.J. Tozer
c     Semiempirical hybrid functional with improved performance in 
c     an extensive chemical assessment
c     J. Chem. Phys. 123 (2005) 121103.
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt),rhob1(npt)
      REAL sigmaaa1(npt),sigmabb1(npt),sigmaab1(npt)
      REAL zk(npt),vrhoa(npt),vrhob(npt)
      REAL vsigmaaa(npt),vsigmabb(npt),vsigmaab(npt)
      REAL v2rhoa2(npt),v2rhob2(npt),v2rhoab(npt)
      REAL v2rhoasigmaaa(npt),v2rhoasigmaab(npt)
      REAL v2rhoasigmabb(npt),v2rhobsigmabb(npt)
      REAL v2rhobsigmaab(npt),v2rhobsigmaaa(npt)
      REAL v2sigmaaa2(npt),v2sigmaaaab(npt),v2sigmaaabb(npt)
      REAL v2sigmaab2(npt),v2sigmaabbb(npt),v2sigmabb2(npt)
      parameter(tol=1.0d-20)
      
      if (ideriv.eq.0) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t4 = rhob**2
      t5 = t2**2
      t8 = sigmabb/t5/t4
      t10 = 1.D0+0.4D-2*t8
      t14 = sigmabb**2
      t15 = t4**2
      t19 = t14/t2/t15/rhob
      t20 = t10**2
      t25 = t15**2
      t27 = t14*sigmabb/t25
      t32 = t14**2
      t36 = t32/t5/t25/t4
      t37 = t20**2
      t44 = 1/rhob
      t45 = t44**(1.D0/3.D0)
      t49 = t44**(1.D0/6.D0)
      t52 = dsqrt(t44)
      t54 = t45**2
      t60 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t49
     #+0.3844746237447211D1*t45+0.1644733775567609D1*t52
     #+0.2405871291288192D0*t54))
      t62 = 1.D0+0.2D0*t8
      t66 = t62**2
      t74 = t66**2
      zk(i) = -0.9305257363491D0*t2*rhob*(0.7334648D0+0.1170108D-2*t8
     #/t10+0.53420624D-4*t19/t20-0.67274112D-6*t27/t20/t10
     #+0.271592192D-8*t36/t37)-0.3109D-1*rhob*(1.D0
     #+0.1274696188700087D0*t45)*t60*(0.5623649D0-0.264596D0*t8/t62
     #+0.25436764D0*t19/t66-0.59712016D-1*t27/t66/t62+0.29233312D-2
     #*t36/t74)
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t4 = rhoa**2
      t5 = t2**2
      t8 = sigmaaa/t5/t4
      t10 = 1.D0+0.4D-2*t8
      t14 = sigmaaa**2
      t15 = t4**2
      t19 = t14/t2/t15/rhoa
      t20 = t10**2
      t25 = t15**2
      t27 = t14*sigmaaa/t25
      t32 = t14**2
      t36 = t32/t5/t25/t4
      t37 = t20**2
      t44 = 1/rhoa
      t45 = t44**(1.D0/3.D0)
      t49 = t44**(1.D0/6.D0)
      t52 = dsqrt(t44)
      t54 = t45**2
      t60 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t49
     #+0.3844746237447211D1*t45+0.1644733775567609D1*t52
     #+0.2405871291288192D0*t54))
      t62 = 1.D0+0.2D0*t8
      t66 = t62**2
      t74 = t66**2
      zk(i) = -0.9305257363491D0*t2*rhoa*(0.7334648D0+0.1170108D-2*t8
     #/t10+0.53420624D-4*t19/t20-0.67274112D-6*t27/t20/t10
     #+0.271592192D-8*t36/t37)-0.3109D-1*rhoa*(1.D0
     #+0.1274696188700087D0*t45)*t60*(0.5623649D0-0.264596D0*t8/t62
     #+0.25436764D0*t19/t66-0.59712016D-1*t27/t66/t62+0.29233312D-2
     #*t36/t74)
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t6 = rhoa**2
      t7 = t4**2
      t10 = sigmaaa/t7/t6
      t12 = 1.D0+0.4D-2*t10
      t16 = sigmaaa**2
      t17 = t6**2
      t21 = t16/t4/t17/rhoa
      t22 = t12**2
      t27 = t17**2
      t29 = t16*sigmaaa/t27
      t34 = t16**2
      t38 = t34/t7/t27/t6
      t39 = t22**2
      t46 = 1/rhoa
      t47 = t46**(1.D0/3.D0)
      t50 = rhoa*(1.D0+0.1274696188700087D0*t47)
      t51 = t46**(1.D0/6.D0)
      t54 = dsqrt(t46)
      t56 = t47**2
      t62 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t51
     #+0.3844746237447211D1*t47+0.1644733775567609D1*t54
     #+0.2405871291288192D0*t56))
      t64 = 1.D0+0.2D0*t10
      t68 = t64**2
      t76 = t68**2
      t84 = rhob**(1.D0/3.D0)
      t86 = rhob**2
      t87 = t84**2
      t90 = sigmabb/t87/t86
      t92 = 1.D0+0.4D-2*t90
      t96 = sigmabb**2
      t97 = t86**2
      t101 = t96/t84/t97/rhob
      t102 = t92**2
      t107 = t97**2
      t109 = t96*sigmabb/t107
      t114 = t96**2
      t118 = t114/t87/t107/t86
      t119 = t102**2
      t126 = 1/rhob
      t127 = t126**(1.D0/3.D0)
      t130 = rhob*(1.D0+0.1274696188700087D0*t127)
      t131 = t126**(1.D0/6.D0)
      t134 = dsqrt(t126)
      t136 = t127**2
      t142 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t131
     #+0.3844746237447211D1*t127+0.1644733775567609D1*t134
     #+0.2405871291288192D0*t136))
      t144 = 1.D0+0.2D0*t90
      t148 = t144**2
      t156 = t148**2
      t164 = rhoa+rhob
      t165 = 1/t164
      t166 = t165**(1.D0/3.D0)
      t169 = t165**(1.D0/6.D0)
      t172 = dsqrt(t165)
      t174 = t166**2
      t180 = dlog(1.D0+0.160818243221511D2/(0.598255043577108D1*t169
     #+0.2225569421150687D1*t166+0.8004286349993634D0*t172
     #+0.1897004325747559D0*t174))
      t182 = 0.62182D-1*(1.D0+0.1325688999052018D0*t166)*t180
      t193 = dlog(1.D0+0.2960857464321668D2/(0.8157414703487641D1*t169
     #+0.2247591863577616D1*t166+0.4300972471276643D0*t172
     #+0.1911512595127338D0*t174))
      t196 = rhoa-1.D0*rhob
      t197 = t196*t165
      t198 = 1.D0+t197
      t199 = t198**(1.D0/3.D0)
      t202 = 1.D0-1.D0*t197
      t203 = t202**(1.D0/3.D0)
      t205 = t199*t198+t203*t202-2.D0
      t206 = t196**2
      t207 = t206**2
      t208 = t164**2
      t209 = t208**2
      t211 = t207/t209
      t227 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t169
     #+0.3844746237447211D1*t166+0.1644733775567609D1*t172
     #+0.2405871291288192D0*t174))
      t243 = 0.5D0*t10+0.5D0*t90
      t246 = 1.D0+0.3D-2*t10+0.3D-2*t90
      t250 = t243**2
      t251 = t246**2
      t260 = t250**2
      t261 = t251**2
      s1 = -0.9305257363491D0*t4*rhoa*(0.7334648D0+0.1170108D-2*t10
     #/t12+0.53420624D-4*t21/t22-0.67274112D-6*t29/t22/t12
     #+0.271592192D-8*t38/t39)-0.3109D-1*t50*t62*(0.5623649D0
     #-0.264596D0*t10/t64+0.25436764D0*t21/t68-0.59712016D-1*t29/t68
     #/t64+0.29233312D-2*t38/t76)
      s2 = s1-0.9305257363491D0*t84*rhob*(0.7334648D0+0.1170108D-2*t90
     #/t92+0.53420624D-4*t101/t102-0.67274112D-6*t109/t102/t92
     #+0.271592192D-8*t118/t119)
      zk(i) = s2-0.3109D-1*t130*t142*(0.5623649D0-0.264596D0*t90/t144
     #+0.25436764D0*t101/t148-0.59712016D-1*t109/t148/t144
     #+0.29233312D-2*t118/t156)+(t164*(-t182+0.3799574853701528D-1*
     #(1.D0+0.6901399211255825D-1*t166)*t193*t205*(1.D0-1.D0*t211)
     #+0.1923661050931536D1*(-0.3109D-1*(1.D0+0.1274696188700087D0
     #*t166)*t227+t182)*t205*t211)+0.3109D-1*t50*t62+0.3109D-1*t130
     #*t142)*(0.113383D1-0.16871802D-1*t243/t246+0.267526872D-3*t250
     #/t251-0.425377872D-6*t250*t243/t251/t246-0.1522052208D-7*t260
     #/t261)
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t3 = t2*rhob
      t4 = rhob**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigmabb*t7
      t10 = 1.D0+0.4D-2*t8
      t11 = 1/t10
      t14 = sigmabb**2
      t15 = t4**2
      t16 = t15*rhob
      t18 = 1/t2/t16
      t19 = t14*t18
      t20 = t10**2
      t21 = 1/t20
      t24 = t14*sigmabb
      t25 = t15**2
      t26 = 1/t25
      t27 = t24*t26
      t29 = 1/t20/t10
      t32 = t14**2
      t35 = 1/t5/t25/t4
      t36 = t32*t35
      t37 = t20**2
      t38 = 1/t37
      t41 = 0.7334648D0+0.1170108D-2*t8*t11+0.53420624D-4*t19*t21
     #-0.67274112D-6*t27*t29+0.271592192D-8*t36*t38
      t44 = 1/rhob
      t45 = t44**(1.D0/3.D0)
      t47 = 1.D0+0.1274696188700087D0*t45
      t48 = rhob*t47
      t49 = t44**(1.D0/6.D0)
      t52 = dsqrt(t44)
      t54 = t45**2
      t56 = 0.1112037486309468D2*t49+0.3844746237447211D1*t45
     #+0.1644733775567609D1*t52+0.2405871291288192D0*t54
      t59 = 1.D0+0.321646831778707D2/t56
      t60 = dlog(t59)
      t62 = 1.D0+0.2D0*t8
      t63 = 1/t62
      t66 = t62**2
      t67 = 1/t66
      t71 = 1/t66/t62
      t74 = t66**2
      t75 = 1/t74
      t78 = 0.5623649D0-0.264596D0*t8*t63+0.25436764D0*t19*t67
     #-0.59712016D-1*t27*t71+0.29233312D-2*t36*t75
      t79 = t60*t78
      zk(i) = -0.9305257363491D0*t3*t41-0.3109D-1*t48*t79
      vrhoa(i) = 0.D0
      t84 = t4*rhob
      t87 = sigmabb/t5/t84
      t90 = t15*t4
      t93 = t14/t2/t90
      t98 = t24/t25/rhob
      t104 = t32/t5/t25/t84
      t111 = t32*sigmabb/t2/t25/t90
      t113 = 1/t37/t10
      t122 = 1/t54
      t126 = t56**2
      t129 = t49**2
      t130 = t129**2
      t133 = 1/t4
      t159 = 1/t74/t62
      vrhob(i) = -0.12407009817988D1*t2*t41-0.9305257363491D0*t3*(
     #-0.3120288D-2*t87*t11-0.2724288426666667D-3*t93*t21
     #+0.6521568938666667D-5*t98*t29-0.5049754965333333D-7*t104*t38
     #+0.1158793352533333D-9*t111*t113)-0.3109D-1*t47*t60*t78
     #+0.1321010150222857D-2*t44*t122*t79+0.1D1*t48/t126*(
     #-0.1853395810515781D1/t130/t49*t133-0.128158207914907D1*t122
     #*t133-0.8223668877838045D0/t52*t133-0.1603914194192128D0/t45
     #*t133)/t59*t78-0.3109D-1*t48*t60*(0.7055893333333333D0*t87*t63
     #-0.149774528D1*t93*t67+0.7490216106666667D0*t98*t71
     #-0.1267214250666667D0*t104*t75+0.6236439893333333D-2*t111*t159)
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      t168 = sigmabb*t18
      t171 = t14*t26
      t174 = t24*t35
      t180 = t32/t2/t25/t16
      vsigmabb(i) = -0.9305257363491D0*t3*(0.1170108D-2*t7*t11
     #+0.102160816D-3*t168*t21-0.2445588352D-5*t171*t29
     #+0.1893658112D-7*t174*t38-0.4345475072D-10*t180*t113)-0.3109D-1
     #*t48*t60*(-0.264596D0*t7*t63+0.56165448D0*t168*t67-0.280883104D0
     #*t171*t71+0.475205344D-1*t174*t75-0.233866496D-2*t180*t159)
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t3 = t2*rhoa
      t4 = rhoa**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigmaaa*t7
      t10 = 1.D0+0.4D-2*t8
      t11 = 1/t10
      t14 = sigmaaa**2
      t15 = t4**2
      t16 = t15*rhoa
      t18 = 1/t2/t16
      t19 = t14*t18
      t20 = t10**2
      t21 = 1/t20
      t24 = t14*sigmaaa
      t25 = t15**2
      t26 = 1/t25
      t27 = t24*t26
      t29 = 1/t20/t10
      t32 = t14**2
      t35 = 1/t5/t25/t4
      t36 = t32*t35
      t37 = t20**2
      t38 = 1/t37
      t41 = 0.7334648D0+0.1170108D-2*t8*t11+0.53420624D-4*t19*t21
     #-0.67274112D-6*t27*t29+0.271592192D-8*t36*t38
      t44 = 1/rhoa
      t45 = t44**(1.D0/3.D0)
      t47 = 1.D0+0.1274696188700087D0*t45
      t48 = rhoa*t47
      t49 = t44**(1.D0/6.D0)
      t52 = dsqrt(t44)
      t54 = t45**2
      t56 = 0.1112037486309468D2*t49+0.3844746237447211D1*t45
     #+0.1644733775567609D1*t52+0.2405871291288192D0*t54
      t59 = 1.D0+0.321646831778707D2/t56
      t60 = dlog(t59)
      t62 = 1.D0+0.2D0*t8
      t63 = 1/t62
      t66 = t62**2
      t67 = 1/t66
      t71 = 1/t66/t62
      t74 = t66**2
      t75 = 1/t74
      t78 = 0.5623649D0-0.264596D0*t8*t63+0.25436764D0*t19*t67
     #-0.59712016D-1*t27*t71+0.29233312D-2*t36*t75
      t79 = t60*t78
      zk(i) = -0.9305257363491D0*t3*t41-0.3109D-1*t48*t79
      t84 = t4*rhoa
      t87 = sigmaaa/t5/t84
      t90 = t15*t4
      t93 = t14/t2/t90
      t98 = t24/t25/rhoa
      t104 = t32/t5/t25/t84
      t111 = t32*sigmaaa/t2/t25/t90
      t113 = 1/t37/t10
      t122 = 1/t54
      t126 = t56**2
      t129 = t49**2
      t130 = t129**2
      t133 = 1/t4
      t159 = 1/t74/t62
      vrhoa(i) = -0.12407009817988D1*t2*t41-0.9305257363491D0*t3*(
     #-0.3120288D-2*t87*t11-0.2724288426666667D-3*t93*t21
     #+0.6521568938666667D-5*t98*t29-0.5049754965333333D-7*t104*t38
     #+0.1158793352533333D-9*t111*t113)-0.3109D-1*t47*t60*t78
     #+0.1321010150222857D-2*t44*t122*t79+0.1D1*t48/t126*(
     #-0.1853395810515781D1/t130/t49*t133-0.128158207914907D1*t122
     #*t133-0.8223668877838045D0/t52*t133-0.1603914194192128D0/t45
     #*t133)/t59*t78-0.3109D-1*t48*t60*(0.7055893333333333D0*t87*t63
     #-0.149774528D1*t93*t67+0.7490216106666667D0*t98*t71
     #-0.1267214250666667D0*t104*t75+0.6236439893333333D-2*t111*t159)
      vrhob(i) = 0.D0
      t168 = sigmaaa*t18
      t171 = t14*t26
      t174 = t24*t35
      t180 = t32/t2/t25/t16
      vsigmaaa(i) = -0.9305257363491D0*t3*(0.1170108D-2*t7*t11
     #+0.102160816D-3*t168*t21-0.2445588352D-5*t171*t29
     #+0.1893658112D-7*t174*t38-0.4345475072D-10*t180*t113)-0.3109D-1
     #*t48*t60*(-0.264596D0*t7*t63+0.56165448D0*t168*t67-0.280883104D0
     #*t171*t71+0.475205344D-1*t174*t75-0.233866496D-2*t180*t159)
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t5 = t4*rhoa
      t6 = rhoa**2
      t7 = t4**2
      t9 = 1/t7/t6
      t10 = sigmaaa*t9
      t12 = 1.D0+0.4D-2*t10
      t13 = 1/t12
      t16 = sigmaaa**2
      t17 = t6**2
      t18 = t17*rhoa
      t20 = 1/t4/t18
      t21 = t16*t20
      t22 = t12**2
      t23 = 1/t22
      t26 = t16*sigmaaa
      t27 = t17**2
      t28 = 1/t27
      t29 = t26*t28
      t31 = 1/t22/t12
      t34 = t16**2
      t37 = 1/t7/t27/t6
      t38 = t34*t37
      t39 = t22**2
      t40 = 1/t39
      t43 = 0.7334648D0+0.1170108D-2*t10*t13+0.53420624D-4*t21*t23
     #-0.67274112D-6*t29*t31+0.271592192D-8*t38*t40
      t46 = 1/rhoa
      t47 = t46**(1.D0/3.D0)
      t49 = 1.D0+0.1274696188700087D0*t47
      t50 = rhoa*t49
      t51 = t46**(1.D0/6.D0)
      t54 = dsqrt(t46)
      t56 = t47**2
      t58 = 0.1112037486309468D2*t51+0.3844746237447211D1*t47
     #+0.1644733775567609D1*t54+0.2405871291288192D0*t56
      t61 = 1.D0+0.321646831778707D2/t58
      t62 = dlog(t61)
      t64 = 1.D0+0.2D0*t10
      t65 = 1/t64
      t68 = t64**2
      t69 = 1/t68
      t73 = 1/t68/t64
      t76 = t68**2
      t77 = 1/t76
      t80 = 0.5623649D0-0.264596D0*t10*t65+0.25436764D0*t21*t69
     #-0.59712016D-1*t29*t73+0.29233312D-2*t38*t77
      t81 = t62*t80
      t84 = rhob**(1.D0/3.D0)
      t85 = t84*rhob
      t86 = rhob**2
      t87 = t84**2
      t89 = 1/t87/t86
      t90 = sigmabb*t89
      t92 = 1.D0+0.4D-2*t90
      t93 = 1/t92
      t96 = sigmabb**2
      t97 = t86**2
      t98 = t97*rhob
      t100 = 1/t84/t98
      t101 = t96*t100
      t102 = t92**2
      t103 = 1/t102
      t106 = t96*sigmabb
      t107 = t97**2
      t108 = 1/t107
      t109 = t106*t108
      t111 = 1/t102/t92
      t114 = t96**2
      t117 = 1/t87/t107/t86
      t118 = t114*t117
      t119 = t102**2
      t120 = 1/t119
      t123 = 0.7334648D0+0.1170108D-2*t90*t93+0.53420624D-4*t101*t103
     #-0.67274112D-6*t109*t111+0.271592192D-8*t118*t120
      t126 = 1/rhob
      t127 = t126**(1.D0/3.D0)
      t129 = 1.D0+0.1274696188700087D0*t127
      t130 = rhob*t129
      t131 = t126**(1.D0/6.D0)
      t134 = dsqrt(t126)
      t136 = t127**2
      t138 = 0.1112037486309468D2*t131+0.3844746237447211D1*t127
     #+0.1644733775567609D1*t134+0.2405871291288192D0*t136
      t141 = 1.D0+0.321646831778707D2/t138
      t142 = dlog(t141)
      t144 = 1.D0+0.2D0*t90
      t145 = 1/t144
      t148 = t144**2
      t149 = 1/t148
      t153 = 1/t148/t144
      t156 = t148**2
      t157 = 1/t156
      t160 = 0.5623649D0-0.264596D0*t90*t145+0.25436764D0*t101*t149
     #-0.59712016D-1*t109*t153+0.29233312D-2*t118*t157
      t161 = t142*t160
      t164 = rhoa+rhob
      t165 = 1/t164
      t166 = t165**(1.D0/3.D0)
      t168 = 1.D0+0.1325688999052018D0*t166
      t169 = t165**(1.D0/6.D0)
      t172 = dsqrt(t165)
      t174 = t166**2
      t176 = 0.598255043577108D1*t169+0.2225569421150687D1*t166
     #+0.8004286349993634D0*t172+0.1897004325747559D0*t174
      t179 = 1.D0+0.160818243221511D2/t176
      t180 = dlog(t179)
      t182 = 0.62182D-1*t168*t180
      t184 = 1.D0+0.6901399211255825D-1*t166
      t189 = 0.8157414703487641D1*t169+0.2247591863577616D1*t166
     #+0.4300972471276643D0*t172+0.1911512595127338D0*t174
      t192 = 1.D0+0.2960857464321668D2/t189
      t193 = dlog(t192)
      t194 = t184*t193
      t196 = rhoa-1.D0*rhob
      t197 = t196*t165
      t198 = 1.D0+t197
      t199 = t198**(1.D0/3.D0)
      t202 = 1.D0-1.D0*t197
      t203 = t202**(1.D0/3.D0)
      t205 = t199*t198+t203*t202-2.D0
      t206 = t196**2
      t207 = t206**2
      t208 = t164**2
      t209 = t208**2
      t210 = 1/t209
      t211 = t207*t210
      t213 = 1.D0-1.D0*t211
      t216 = 0.3799574853701528D-1*t194*t205*t213
      t218 = 1.D0+0.1274696188700087D0*t166
      t223 = 0.1112037486309468D2*t169+0.3844746237447211D1*t166
     #+0.1644733775567609D1*t172+0.2405871291288192D0*t174
      t226 = 1.D0+0.321646831778707D2/t223
      t227 = dlog(t226)
      t230 = -0.3109D-1*t218*t227+t182
      t231 = t230*t205
      t233 = 0.1923661050931536D1*t231*t211
      t240 = t164*(-t182+t216+t233)+0.3109D-1*t50*t62+0.3109D-1*t130
     #*t142
      t243 = 0.5D0*t10+0.5D0*t90
      t246 = 1.D0+0.3D-2*t10+0.3D-2*t90
      t247 = 1/t246
      t250 = t243**2
      t251 = t246**2
      t252 = 1/t251
      t255 = t250*t243
      t257 = 1/t251/t246
      t260 = t250**2
      t261 = t251**2
      t262 = 1/t261
      t265 = 0.113383D1-0.16871802D-1*t243*t247+0.267526872D-3*t250
     #*t252-0.425377872D-6*t255*t257-0.1522052208D-7*t260*t262
      zk(i) = -0.9305257363491D0*t5*t43-0.3109D-1*t50*t81
     #-0.9305257363491D0*t85*t123-0.3109D-1*t130*t161+t240*t265
      t269 = t6*rhoa
      t272 = sigmaaa/t7/t269
      t275 = t17*t6
      t278 = t16/t4/t275
      t283 = t26/t27/rhoa
      t289 = t34/t7/t27/t269
      t296 = t34*sigmaaa/t4/t27/t275
      t298 = 1/t39/t12
      t304 = t49*t62
      t307 = 1/t56
      t308 = t46*t307
      t311 = t58**2
      t312 = 1/t311
      t314 = t51**2
      t315 = t314**2
      t318 = 1/t6
      t329 = -0.1853395810515781D1/t315/t51*t318-0.128158207914907D1
     #*t307*t318-0.8223668877838045D0/t54*t318-0.1603914194192128D0
     #/t47*t318
      t330 = 1/t61
      t344 = 1/t76/t64
      t352 = 1/t208
      t353 = 1/t174*t352
      t354 = t353*t180
      t355 = 0.2747799777968419D-2*t354
      t356 = t176**2
      t359 = t169**2
      t360 = t359**2
      t363 = 1/t360/t169*t352
      t367 = 1/t172*t352
      t370 = 1/t166*t352
      t375 = t168/t356*(-0.99709173929518D0*t363-0.7418564737168958D0
     #*t353-0.4002143174996817D0*t367-0.1264669550498372D0*t370)/t179
      t376 = 0.1D1*t375
      t380 = 0.8740794299481065D-3*t353*t193*t205*t213
      t381 = t189**2
      t394 = 0.1124999956683108D1*t184/t381*(-0.135956911724794D1*t363
     #-0.7491972878592054D0*t353-0.2150486235638321D0*t367
     #-0.1274341730084892D0*t370)/t192*t205*t213
      t395 = t196*t352
      t396 = 1.D0*t395
      t400 = 1.D0*t165
      t404 = 0.1333333333333333D1*t199*(t165-t396)
     #+0.1333333333333333D1*t203*(-t400+t395)
      t409 = t206*t196*t210
      t410 = 4.D0*t409
      t413 = t207/t209/t164
      t414 = 4.D0*t413
      t421 = t223**2
      t438 = 0.1923661050931536D1*(0.1321010150222857D-2*t353*t227
     #+0.1D1*t218/t421*(-0.1853395810515781D1*t363-0.128158207914907D1
     #*t353-0.8223668877838045D0*t367-0.1603914194192128D0*t370)/t226
     #-0.2747799777968419D-2*t354-0.1D1*t375)*t205*t211
      t442 = t231*t409
      t445 = 0.7694644203726145D1*t231*t413
      t459 = t243*t252
      t462 = t250*t257
      t465 = t255*t262
      t470 = t260/t261/t246
      s1 = -0.12407009817988D1*t4*t43-0.9305257363491D0*t5*(
     #-0.3120288D-2*t272*t13-0.2724288426666667D-3*t278*t23
     #+0.6521568938666667D-5*t283*t31-0.5049754965333333D-7*t289*t40
     #+0.1158793352533333D-9*t296*t298)-0.3109D-1*t304*t80
     #+0.1321010150222857D-2*t308*t81
      vrhoa(i) = s1+0.1D1*t50*t312*t329*t330*t80-0.3109D-1*t50*t62*
     #(0.7055893333333333D0*t272*t65-0.149774528D1*t278*t69
     #+0.7490216106666667D0*t283*t73-0.1267214250666667D0*t289*t77
     #+0.6236439893333333D-2*t296*t344)+(-t182+t216+t233+t164*(t355
     #+t376-t380-t394+0.3799574853701528D-1*t194*t404*t213
     #+0.3799574853701528D-1*t194*t205*(-t410+t414)+t438
     #+0.1923661050931536D1*t230*t404*t211+0.7694644203726145D1*t442
     #-t445)+0.3109D-1*t304-0.1321010150222857D-2*t308*t62-0.1D1*t50
     #*t312*t329*t330)*t265+t240*(0.22495736D-1*t272*t247
     #-0.848379408D-3*t459*t272+0.598194144D-5*t462*t272
     #+0.70967048832D-7*t465*t272-0.48705670656D-9*t470*t272)
      t477 = t86*rhob
      t480 = sigmabb/t87/t477
      t483 = t97*t86
      t486 = t96/t84/t483
      t491 = t106/t107/rhob
      t497 = t114/t87/t107/t477
      t504 = t114*sigmabb/t84/t107/t483
      t506 = 1/t119/t92
      t512 = t129*t142
      t515 = 1/t136
      t516 = t126*t515
      t519 = t138**2
      t520 = 1/t519
      t522 = t131**2
      t523 = t522**2
      t526 = 1/t86
      t537 = -0.1853395810515781D1/t523/t131*t526-0.128158207914907D1
     #*t515*t526-0.8223668877838045D0/t134*t526-0.1603914194192128D0
     #/t127*t526
      t538 = 1/t141
      t552 = 1/t156/t144
      t565 = 0.1333333333333333D1*t199*(-t400-t396)
     #+0.1333333333333333D1*t203*(t165+t395)
      s1 = -0.12407009817988D1*t84*t123-0.9305257363491D0*t85*(
     #-0.3120288D-2*t480*t93-0.2724288426666667D-3*t486*t103
     #+0.6521568938666667D-5*t491*t111-0.5049754965333333D-7*t497*t120
     #+0.1158793352533333D-9*t504*t506)-0.3109D-1*t512*t160
     #+0.1321010150222857D-2*t516*t161
      vrhob(i) = s1+0.1D1*t130*t520*t537*t538*t160-0.3109D-1*t130*t142
     #*(0.7055893333333333D0*t480*t145-0.149774528D1*t486*t149
     #+0.7490216106666667D0*t491*t153-0.1267214250666667D0*t497*t157
     #+0.6236439893333333D-2*t504*t552)+(-t182+t216+t233+t164*(t355
     #+t376-t380-t394+0.3799574853701528D-1*t194*t565*t213
     #+0.3799574853701528D-1*t194*t205*(t410+t414)+t438
     #+0.1923661050931536D1*t230*t565*t211-0.7694644203726145D1*t442
     #-t445)+0.3109D-1*t512-0.1321010150222857D-2*t516*t142-0.1D1*t130
     #*t520*t537*t538)*t265+t240*(0.22495736D-1*t480*t247
     #-0.848379408D-3*t459*t480+0.598194144D-5*t462*t480
     #+0.70967048832D-7*t465*t480-0.48705670656D-9*t470*t480)
      t602 = sigmaaa*t20
      t605 = t16*t28
      t608 = t26*t37
      t614 = t34/t4/t27/t18
      vsigmaaa(i) = -0.9305257363491D0*t5*(0.1170108D-2*t9*t13
     #+0.102160816D-3*t602*t23-0.2445588352D-5*t605*t31
     #+0.1893658112D-7*t608*t40-0.4345475072D-10*t614*t298)-0.3109D-1
     #*t50*t62*(-0.264596D0*t9*t65+0.56165448D0*t602*t69-0.280883104D0
     #*t605*t73+0.475205344D-1*t608*t77-0.233866496D-2*t614*t344)+t240
     #*(-0.8435901D-2*t9*t247+0.318142278D-3*t459*t9-0.224322804D-5
     #*t462*t9-0.26612643312D-7*t465*t9+0.18264626496D-9*t470*t9)
      vsigmaab(i) = 0.D0
      t648 = sigmabb*t100
      t651 = t96*t108
      t654 = t106*t117
      t660 = t114/t84/t107/t98
      vsigmabb(i) = -0.9305257363491D0*t85*(0.1170108D-2*t89*t93
     #+0.102160816D-3*t648*t103-0.2445588352D-5*t651*t111
     #+0.1893658112D-7*t654*t120-0.4345475072D-10*t660*t506)-0.3109D-1
     #*t130*t142*(-0.264596D0*t89*t145+0.56165448D0*t648*t149
     #-0.280883104D0*t651*t153+0.475205344D-1*t654*t157-0.233866496D-2
     #*t660*t552)+t240*(-0.8435901D-2*t89*t247+0.318142278D-3*t459*t89
     #-0.224322804D-5*t462*t89-0.26612643312D-7*t465*t89
     #+0.18264626496D-9*t470*t89)
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t3 = t2*rhob
      t4 = rhob**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigmabb*t7
      t10 = 1.D0+0.4D-2*t8
      t11 = 1/t10
      t14 = sigmabb**2
      t15 = t4**2
      t16 = t15*rhob
      t18 = 1/t2/t16
      t19 = t14*t18
      t20 = t10**2
      t21 = 1/t20
      t24 = t14*sigmabb
      t25 = t15**2
      t26 = 1/t25
      t27 = t24*t26
      t29 = 1/t20/t10
      t32 = t14**2
      t33 = t25*t4
      t35 = 1/t5/t33
      t36 = t32*t35
      t37 = t20**2
      t38 = 1/t37
      t41 = 0.7334648D0+0.1170108D-2*t8*t11+0.53420624D-4*t19*t21
     #-0.67274112D-6*t27*t29+0.271592192D-8*t36*t38
      t44 = 1/rhob
      t45 = t44**(1.D0/3.D0)
      t47 = 1.D0+0.1274696188700087D0*t45
      t48 = rhob*t47
      t49 = t44**(1.D0/6.D0)
      t52 = dsqrt(t44)
      t54 = t45**2
      t56 = 0.1112037486309468D2*t49+0.3844746237447211D1*t45
     #+0.1644733775567609D1*t52+0.2405871291288192D0*t54
      t59 = 1.D0+0.321646831778707D2/t56
      t60 = dlog(t59)
      t62 = 1.D0+0.2D0*t8
      t63 = 1/t62
      t66 = t62**2
      t67 = 1/t66
      t71 = 1/t66/t62
      t74 = t66**2
      t75 = 1/t74
      t78 = 0.5623649D0-0.264596D0*t8*t63+0.25436764D0*t19*t67
     #-0.59712016D-1*t27*t71+0.29233312D-2*t36*t75
      t79 = t60*t78
      zk(i) = -0.9305257363491D0*t3*t41-0.3109D-1*t48*t79
      vrhoa(i) = 0.D0
      t84 = t4*rhob
      t87 = sigmabb/t5/t84
      t90 = t15*t4
      t93 = t14/t2/t90
      t98 = t24/t25/rhob
      t104 = t32/t5/t25/t84
      t107 = t32*sigmabb
      t111 = t107/t2/t25/t90
      t113 = 1/t37/t10
      t116 = -0.3120288D-2*t87*t11-0.2724288426666667D-3*t93*t21
     #+0.6521568938666667D-5*t98*t29-0.5049754965333333D-7*t104*t38
     #+0.1158793352533333D-9*t111*t113
      t119 = t47*t60
      t122 = 1/t54
      t123 = t44*t122
      t126 = t56**2
      t127 = 1/t126
      t128 = t48*t127
      t129 = t49**2
      t130 = t129**2
      t131 = t130*t49
      t132 = 1/t131
      t133 = 1/t4
      t138 = 1/t52
      t141 = 1/t45
      t144 = -0.1853395810515781D1*t132*t133-0.128158207914907D1*t122
     #*t133-0.8223668877838045D0*t138*t133-0.1603914194192128D0*t141
     #*t133
      t145 = 1/t59
      t146 = t144*t145
      t147 = t146*t78
      t159 = 1/t74/t62
      t162 = 0.7055893333333333D0*t87*t63-0.149774528D1*t93*t67
     #+0.7490216106666667D0*t98*t71-0.1267214250666667D0*t104*t75
     #+0.6236439893333333D-2*t111*t159
      t163 = t60*t162
      vrhob(i) = -0.12407009817988D1*t2*t41-0.9305257363491D0*t3*t116
     #-0.3109D-1*t119*t78+0.1321010150222857D-2*t123*t79+0.1D1*t128
     #*t147-0.3109D-1*t48*t163
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      t168 = sigmabb*t18
      t171 = t14*t26
      t174 = t24*t35
      t179 = 1/t2/t25/t16
      t180 = t32*t179
      vsigmabb(i) = -0.9305257363491D0*t3*(0.1170108D-2*t7*t11
     #+0.102160816D-3*t168*t21-0.2445588352D-5*t171*t29
     #+0.1893658112D-7*t174*t38-0.4345475072D-10*t180*t113)-0.3109D-1
     #*t48*t60*(-0.264596D0*t7*t63+0.56165448D0*t168*t67-0.280883104D0
     #*t171*t71+0.475205344D-1*t174*t75-0.233866496D-2*t180*t159)
      v2rhoa2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t207 = sigmabb/t5/t15
      t210 = t15*t84
      t213 = t14/t2/t210
      t217 = t24/t33
      t223 = t32/t5/t25/t15
      t229 = t107/t2/t25/t210
      t233 = t25**2
      t236 = t32*t14/t233/t4
      t238 = 1/t37/t20
      t249 = 1/t84
      t251 = 1/t54/t44
      t263 = t144**2
      t270 = 1/t15
      t296 = t126**2
      t299 = t59**2
      t319 = 1/t74/t66
      s1 = -0.4135669939329333D0/t5*t41-0.24814019635976D1*t2*t116
     #-0.9305257363491D0*t3*(0.11441056D-1*t207*t11
     #+0.1692099598222222D-2*t213*t21-0.6450593575822222D-4*t217*t29
     #+0.7978282853262222D-6*t223*t38-0.3815499257173333D-8*t229*t113
     #+0.6180231213511111D-11*t236*t238)+0.2D1*t47*t127*t147-0.6218D-1
     #*t119*t162+0.8806734334819047D-3*t249*t251*t79
      v2rhob2(i) = s1-0.8497974591333914D-1*t123*t127*t147
     #+0.2642020300445714D-2*t123*t163-0.2D1*t48/t126/t56*t263*t145
     #*t78+0.1D1*t128*(-0.1544496508763151D1/t131/t44*t270
     #+0.3706791621031562D1*t132*t249-0.854388052766047D0*t251*t270
     #+0.2563164158298141D1*t122*t249-0.4111834438919023D0/t52/t44
     #*t270+0.1644733775567609D1*t138*t249-0.5346380647307093D-1/t45
     #/t44*t270+0.3207828388384256D0*t141*t249)*t145*t78
     #+0.321646831778707D2*t48/t296*t263/t299*t78+0.2D1*t128*t146*t162
     #-0.3109D-1*t48*t60*(-0.2587160888888889D1*t207*t63
     #+0.9862034417777778D1*t213*t67-0.8338789461333333D1*t217*t71
     #+0.2676851202844444D1*t223*t75-0.3597280119466667D0*t229*t159
     #+0.1663050638222222D-1*t236*t319)
      v2sigmaaa2(i) = 0.D0
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      t328 = sigmabb*t26
      t331 = t14*t35
      t334 = t24*t179
      t338 = t32/t233
      v2sigmabb2(i) = -0.9305257363491D0*t3*(0.97480384D-4*t18*t21
     #-0.5708463232D-5*t328*t29+0.86156803584D-7*t331*t38
     #-0.4768043008D-9*t334*t113+0.8690950144D-12*t338*t238)-0.3109D-1
     #*t48*t60*(0.61457368D0*t18*t67-0.786428D0*t328*t71
     #+0.3110914656D0*t331*t75-0.4737108736D-1*t334*t159
     #+0.233866496D-2*t338*t319)
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t3 = t2*rhoa
      t4 = rhoa**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigmaaa*t7
      t10 = 1.D0+0.4D-2*t8
      t11 = 1/t10
      t14 = sigmaaa**2
      t15 = t4**2
      t16 = t15*rhoa
      t18 = 1/t2/t16
      t19 = t14*t18
      t20 = t10**2
      t21 = 1/t20
      t24 = t14*sigmaaa
      t25 = t15**2
      t26 = 1/t25
      t27 = t24*t26
      t29 = 1/t20/t10
      t32 = t14**2
      t33 = t25*t4
      t35 = 1/t5/t33
      t36 = t32*t35
      t37 = t20**2
      t38 = 1/t37
      t41 = 0.7334648D0+0.1170108D-2*t8*t11+0.53420624D-4*t19*t21
     #-0.67274112D-6*t27*t29+0.271592192D-8*t36*t38
      t44 = 1/rhoa
      t45 = t44**(1.D0/3.D0)
      t47 = 1.D0+0.1274696188700087D0*t45
      t48 = rhoa*t47
      t49 = t44**(1.D0/6.D0)
      t52 = dsqrt(t44)
      t54 = t45**2
      t56 = 0.1112037486309468D2*t49+0.3844746237447211D1*t45
     #+0.1644733775567609D1*t52+0.2405871291288192D0*t54
      t59 = 1.D0+0.321646831778707D2/t56
      t60 = dlog(t59)
      t62 = 1.D0+0.2D0*t8
      t63 = 1/t62
      t66 = t62**2
      t67 = 1/t66
      t71 = 1/t66/t62
      t74 = t66**2
      t75 = 1/t74
      t78 = 0.5623649D0-0.264596D0*t8*t63+0.25436764D0*t19*t67
     #-0.59712016D-1*t27*t71+0.29233312D-2*t36*t75
      t79 = t60*t78
      zk(i) = -0.9305257363491D0*t3*t41-0.3109D-1*t48*t79
      t84 = t4*rhoa
      t87 = sigmaaa/t5/t84
      t90 = t15*t4
      t93 = t14/t2/t90
      t98 = t24/t25/rhoa
      t104 = t32/t5/t25/t84
      t107 = t32*sigmaaa
      t111 = t107/t2/t25/t90
      t113 = 1/t37/t10
      t116 = -0.3120288D-2*t87*t11-0.2724288426666667D-3*t93*t21
     #+0.6521568938666667D-5*t98*t29-0.5049754965333333D-7*t104*t38
     #+0.1158793352533333D-9*t111*t113
      t119 = t47*t60
      t122 = 1/t54
      t123 = t44*t122
      t126 = t56**2
      t127 = 1/t126
      t128 = t48*t127
      t129 = t49**2
      t130 = t129**2
      t131 = t130*t49
      t132 = 1/t131
      t133 = 1/t4
      t138 = 1/t52
      t141 = 1/t45
      t144 = -0.1853395810515781D1*t132*t133-0.128158207914907D1*t122
     #*t133-0.8223668877838045D0*t138*t133-0.1603914194192128D0*t141
     #*t133
      t145 = 1/t59
      t146 = t144*t145
      t147 = t146*t78
      t159 = 1/t74/t62
      t162 = 0.7055893333333333D0*t87*t63-0.149774528D1*t93*t67
     #+0.7490216106666667D0*t98*t71-0.1267214250666667D0*t104*t75
     #+0.6236439893333333D-2*t111*t159
      t163 = t60*t162
      vrhoa(i) = -0.12407009817988D1*t2*t41-0.9305257363491D0*t3*t116
     #-0.3109D-1*t119*t78+0.1321010150222857D-2*t123*t79+0.1D1*t128
     #*t147-0.3109D-1*t48*t163
      vrhob(i) = 0.D0
      t168 = sigmaaa*t18
      t171 = t14*t26
      t174 = t24*t35
      t179 = 1/t2/t25/t16
      t180 = t32*t179
      vsigmaaa(i) = -0.9305257363491D0*t3*(0.1170108D-2*t7*t11
     #+0.102160816D-3*t168*t21-0.2445588352D-5*t171*t29
     #+0.1893658112D-7*t174*t38-0.4345475072D-10*t180*t113)-0.3109D-1
     #*t48*t60*(-0.264596D0*t7*t63+0.56165448D0*t168*t67-0.280883104D0
     #*t171*t71+0.475205344D-1*t174*t75-0.233866496D-2*t180*t159)
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      t207 = sigmaaa/t5/t15
      t210 = t15*t84
      t213 = t14/t2/t210
      t217 = t24/t33
      t223 = t32/t5/t25/t15
      t229 = t107/t2/t25/t210
      t233 = t25**2
      t236 = t32*t14/t233/t4
      t238 = 1/t37/t20
      t249 = 1/t84
      t251 = 1/t54/t44
      t263 = t144**2
      t270 = 1/t15
      t296 = t126**2
      t299 = t59**2
      t319 = 1/t74/t66
      s1 = -0.4135669939329333D0/t5*t41-0.24814019635976D1*t2*t116
     #-0.9305257363491D0*t3*(0.11441056D-1*t207*t11
     #+0.1692099598222222D-2*t213*t21-0.6450593575822222D-4*t217*t29
     #+0.7978282853262222D-6*t223*t38-0.3815499257173333D-8*t229*t113
     #+0.6180231213511111D-11*t236*t238)+0.2D1*t47*t127*t147-0.6218D-1
     #*t119*t162+0.8806734334819047D-3*t249*t251*t79
      v2rhoa2(i) = s1-0.8497974591333914D-1*t123*t127*t147
     #+0.2642020300445714D-2*t123*t163-0.2D1*t48/t126/t56*t263*t145
     #*t78+0.1D1*t128*(-0.1544496508763151D1/t131/t44*t270
     #+0.3706791621031562D1*t132*t249-0.854388052766047D0*t251*t270
     #+0.2563164158298141D1*t122*t249-0.4111834438919023D0/t52/t44
     #*t270+0.1644733775567609D1*t138*t249-0.5346380647307093D-1/t45
     #/t44*t270+0.3207828388384256D0*t141*t249)*t145*t78
     #+0.321646831778707D2*t48/t296*t263/t299*t78+0.2D1*t128*t146*t162
     #-0.3109D-1*t48*t60*(-0.2587160888888889D1*t207*t63
     #+0.9862034417777778D1*t213*t67-0.8338789461333333D1*t217*t71
     #+0.2676851202844444D1*t223*t75-0.3597280119466667D0*t229*t159
     #+0.1663050638222222D-1*t236*t319)
      v2rhob2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t328 = sigmaaa*t26
      t331 = t14*t35
      t334 = t24*t179
      t338 = t32/t233
      v2sigmaaa2(i) = -0.9305257363491D0*t3*(0.97480384D-4*t18*t21
     #-0.5708463232D-5*t328*t29+0.86156803584D-7*t331*t38
     #-0.4768043008D-9*t334*t113+0.8690950144D-12*t338*t238)-0.3109D-1
     #*t48*t60*(0.61457368D0*t18*t67-0.786428D0*t328*t71
     #+0.3110914656D0*t331*t75-0.4737108736D-1*t334*t159
     #+0.233866496D-2*t338*t319)
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      v2sigmabb2(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t5 = t4*rhoa
      t6 = rhoa**2
      t7 = t4**2
      t9 = 1/t7/t6
      t10 = sigmaaa*t9
      t12 = 1.D0+0.4D-2*t10
      t13 = 1/t12
      t16 = sigmaaa**2
      t17 = t6**2
      t18 = t17*rhoa
      t20 = 1/t4/t18
      t21 = t16*t20
      t22 = t12**2
      t23 = 1/t22
      t26 = t16*sigmaaa
      t27 = t17**2
      t28 = 1/t27
      t29 = t26*t28
      t31 = 1/t22/t12
      t34 = t16**2
      t35 = t27*t6
      t37 = 1/t7/t35
      t38 = t34*t37
      t39 = t22**2
      t40 = 1/t39
      t43 = 0.7334648D0+0.1170108D-2*t10*t13+0.53420624D-4*t21*t23
     #-0.67274112D-6*t29*t31+0.271592192D-8*t38*t40
      t46 = 1/rhoa
      t47 = t46**(1.D0/3.D0)
      t49 = 1.D0+0.1274696188700087D0*t47
      t50 = rhoa*t49
      t51 = t46**(1.D0/6.D0)
      t54 = dsqrt(t46)
      t56 = t47**2
      t58 = 0.1112037486309468D2*t51+0.3844746237447211D1*t47
     #+0.1644733775567609D1*t54+0.2405871291288192D0*t56
      t61 = 1.D0+0.321646831778707D2/t58
      t62 = dlog(t61)
      t64 = 1.D0+0.2D0*t10
      t65 = 1/t64
      t68 = t64**2
      t69 = 1/t68
      t73 = 1/t68/t64
      t76 = t68**2
      t77 = 1/t76
      t80 = 0.5623649D0-0.264596D0*t10*t65+0.25436764D0*t21*t69
     #-0.59712016D-1*t29*t73+0.29233312D-2*t38*t77
      t81 = t62*t80
      t84 = rhob**(1.D0/3.D0)
      t85 = t84*rhob
      t86 = rhob**2
      t87 = t84**2
      t89 = 1/t87/t86
      t90 = sigmabb*t89
      t92 = 1.D0+0.4D-2*t90
      t93 = 1/t92
      t96 = sigmabb**2
      t97 = t86**2
      t98 = t97*rhob
      t100 = 1/t84/t98
      t101 = t96*t100
      t102 = t92**2
      t103 = 1/t102
      t106 = t96*sigmabb
      t107 = t97**2
      t108 = 1/t107
      t109 = t106*t108
      t111 = 1/t102/t92
      t114 = t96**2
      t115 = t107*t86
      t117 = 1/t87/t115
      t118 = t114*t117
      t119 = t102**2
      t120 = 1/t119
      t123 = 0.7334648D0+0.1170108D-2*t90*t93+0.53420624D-4*t101*t103
     #-0.67274112D-6*t109*t111+0.271592192D-8*t118*t120
      t126 = 1/rhob
      t127 = t126**(1.D0/3.D0)
      t129 = 1.D0+0.1274696188700087D0*t127
      t130 = rhob*t129
      t131 = t126**(1.D0/6.D0)
      t134 = dsqrt(t126)
      t136 = t127**2
      t138 = 0.1112037486309468D2*t131+0.3844746237447211D1*t127
     #+0.1644733775567609D1*t134+0.2405871291288192D0*t136
      t141 = 1.D0+0.321646831778707D2/t138
      t142 = dlog(t141)
      t144 = 1.D0+0.2D0*t90
      t145 = 1/t144
      t148 = t144**2
      t149 = 1/t148
      t153 = 1/t148/t144
      t156 = t148**2
      t157 = 1/t156
      t160 = 0.5623649D0-0.264596D0*t90*t145+0.25436764D0*t101*t149
     #-0.59712016D-1*t109*t153+0.29233312D-2*t118*t157
      t161 = t142*t160
      t164 = rhoa+rhob
      t165 = 1/t164
      t166 = t165**(1.D0/3.D0)
      t168 = 1.D0+0.1325688999052018D0*t166
      t169 = t165**(1.D0/6.D0)
      t172 = dsqrt(t165)
      t174 = t166**2
      t176 = 0.598255043577108D1*t169+0.2225569421150687D1*t166
     #+0.8004286349993634D0*t172+0.1897004325747559D0*t174
      t179 = 1.D0+0.160818243221511D2/t176
      t180 = dlog(t179)
      t182 = 0.62182D-1*t168*t180
      t184 = 1.D0+0.6901399211255825D-1*t166
      t189 = 0.8157414703487641D1*t169+0.2247591863577616D1*t166
     #+0.4300972471276643D0*t172+0.1911512595127338D0*t174
      t192 = 1.D0+0.2960857464321668D2/t189
      t193 = dlog(t192)
      t194 = t184*t193
      t196 = rhoa-1.D0*rhob
      t197 = t196*t165
      t198 = 1.D0+t197
      t199 = t198**(1.D0/3.D0)
      t202 = 1.D0-1.D0*t197
      t203 = t202**(1.D0/3.D0)
      t205 = t199*t198+t203*t202-2.D0
      t206 = t196**2
      t207 = t206**2
      t208 = t164**2
      t209 = t208**2
      t210 = 1/t209
      t211 = t207*t210
      t213 = 1.D0-1.D0*t211
      t214 = t205*t213
      t216 = 0.3799574853701528D-1*t194*t214
      t218 = 1.D0+0.1274696188700087D0*t166
      t223 = 0.1112037486309468D2*t169+0.3844746237447211D1*t166
     #+0.1644733775567609D1*t172+0.2405871291288192D0*t174
      t226 = 1.D0+0.321646831778707D2/t223
      t227 = dlog(t226)
      t230 = -0.3109D-1*t218*t227+t182
      t231 = t230*t205
      t233 = 0.1923661050931536D1*t231*t211
      t240 = t164*(-t182+t216+t233)+0.3109D-1*t50*t62+0.3109D-1*t130
     #*t142
      t243 = 0.5D0*t10+0.5D0*t90
      t246 = 1.D0+0.3D-2*t10+0.3D-2*t90
      t247 = 1/t246
      t250 = t243**2
      t251 = t246**2
      t252 = 1/t251
      t255 = t250*t243
      t257 = 1/t251/t246
      t260 = t250**2
      t261 = t251**2
      t262 = 1/t261
      t265 = 0.113383D1-0.16871802D-1*t243*t247+0.267526872D-3*t250
     #*t252-0.425377872D-6*t255*t257-0.1522052208D-7*t260*t262
      zk(i) = -0.9305257363491D0*t5*t43-0.3109D-1*t50*t81
     #-0.9305257363491D0*t85*t123-0.3109D-1*t130*t161+t240*t265
      t269 = t6*rhoa
      t271 = 1/t7/t269
      t272 = sigmaaa*t271
      t275 = t17*t6
      t277 = 1/t4/t275
      t278 = t16*t277
      t282 = 1/t27/rhoa
      t283 = t26*t282
      t288 = 1/t7/t27/t269
      t289 = t34*t288
      t292 = t34*sigmaaa
      t295 = 1/t4/t27/t275
      t296 = t292*t295
      t298 = 1/t39/t12
      t301 = -0.3120288D-2*t272*t13-0.2724288426666667D-3*t278*t23
     #+0.6521568938666667D-5*t283*t31-0.5049754965333333D-7*t289*t40
     #+0.1158793352533333D-9*t296*t298
      t304 = t49*t62
      t307 = 1/t56
      t308 = t46*t307
      t311 = t58**2
      t312 = 1/t311
      t313 = t50*t312
      t314 = t51**2
      t315 = t314**2
      t316 = t315*t51
      t317 = 1/t316
      t318 = 1/t6
      t323 = 1/t54
      t326 = 1/t47
      t329 = -0.1853395810515781D1*t317*t318-0.128158207914907D1*t307
     #*t318-0.8223668877838045D0*t323*t318-0.1603914194192128D0*t326
     #*t318
      t330 = 1/t61
      t331 = t329*t330
      t332 = t331*t80
      t344 = 1/t76/t64
      t347 = 0.7055893333333333D0*t272*t65-0.149774528D1*t278*t69
     #+0.7490216106666667D0*t283*t73-0.1267214250666667D0*t289*t77
     #+0.6236439893333333D-2*t296*t344
      t348 = t62*t347
      t351 = 1/t174
      t352 = 1/t208
      t353 = t351*t352
      t354 = t353*t180
      t355 = 0.2747799777968419D-2*t354
      t356 = t176**2
      t357 = 1/t356
      t358 = t168*t357
      t359 = t169**2
      t360 = t359**2
      t361 = t360*t169
      t362 = 1/t361
      t363 = t362*t352
      t366 = 1/t172
      t367 = t366*t352
      t369 = 1/t166
      t370 = t369*t352
      t372 = -0.99709173929518D0*t363-0.7418564737168958D0*t353
     #-0.4002143174996817D0*t367-0.1264669550498372D0*t370
      t373 = 1/t179
      t375 = t358*t372*t373
      t376 = 0.1D1*t375
      t377 = t193*t205
      t378 = t377*t213
      t379 = t353*t378
      t380 = 0.8740794299481065D-3*t379
      t381 = t189**2
      t382 = 1/t381
      t383 = t184*t382
      t388 = -0.135956911724794D1*t363-0.7491972878592054D0*t353
     #-0.2150486235638321D0*t367-0.1274341730084892D0*t370
      t389 = t383*t388
      t390 = 1/t192
      t391 = t390*t205
      t392 = t391*t213
      t393 = t389*t392
      t394 = 0.1124999956683108D1*t393
      t395 = t196*t352
      t396 = 1.D0*t395
      t397 = t165-t396
      t400 = 1.D0*t165
      t401 = -t400+t395
      t404 = 0.1333333333333333D1*t199*t397+0.1333333333333333D1*t203
     #*t401
      t406 = t194*t404*t213
      t407 = 0.3799574853701528D-1*t406
      t408 = t206*t196
      t409 = t408*t210
      t410 = 4.D0*t409
      t412 = 1/t209/t164
      t413 = t207*t412
      t414 = 4.D0*t413
      t415 = -t410+t414
      t417 = t194*t205*t415
      t418 = 0.3799574853701528D-1*t417
      t421 = t223**2
      t422 = 1/t421
      t423 = t218*t422
      t428 = -0.1853395810515781D1*t363-0.128158207914907D1*t353
     #-0.8223668877838045D0*t367-0.1603914194192128D0*t370
      t429 = 1/t226
      t435 = 0.1321010150222857D-2*t353*t227+0.1D1*t423*t428*t429
     #-0.2747799777968419D-2*t354-0.1D1*t375
      t436 = t435*t205
      t437 = t436*t211
      t438 = 0.1923661050931536D1*t437
      t439 = t230*t404
      t440 = t439*t211
      t441 = 0.1923661050931536D1*t440
      t442 = t231*t409
      t444 = t231*t413
      t445 = 0.7694644203726145D1*t444
      t452 = t312*t329*t330
      t455 = -t182+t216+t233+t164*(t355+t376-t380-t394+t407+t418+t438
     #+t441+0.7694644203726145D1*t442-t445)+0.3109D-1*t304
     #-0.1321010150222857D-2*t308*t62-0.1D1*t50*t452
      t459 = t243*t252
      t462 = t250*t257
      t465 = t255*t262
      t469 = 1/t261/t246
      t470 = t260*t469
      t473 = 0.22495736D-1*t272*t247-0.848379408D-3*t459*t272
     #+0.598194144D-5*t462*t272+0.70967048832D-7*t465*t272
     #-0.48705670656D-9*t470*t272
      vrhoa(i) = -0.12407009817988D1*t4*t43-0.9305257363491D0*t5*t301
     #-0.3109D-1*t304*t80+0.1321010150222857D-2*t308*t81+0.1D1*t313
     #*t332-0.3109D-1*t50*t348+t455*t265+t240*t473
      t477 = t86*rhob
      t479 = 1/t87/t477
      t480 = sigmabb*t479
      t483 = t97*t86
      t485 = 1/t84/t483
      t486 = t96*t485
      t490 = 1/t107/rhob
      t491 = t106*t490
      t496 = 1/t87/t107/t477
      t497 = t114*t496
      t500 = t114*sigmabb
      t503 = 1/t84/t107/t483
      t504 = t500*t503
      t506 = 1/t119/t92
      t509 = -0.3120288D-2*t480*t93-0.2724288426666667D-3*t486*t103
     #+0.6521568938666667D-5*t491*t111-0.5049754965333333D-7*t497*t120
     #+0.1158793352533333D-9*t504*t506
      t512 = t129*t142
      t515 = 1/t136
      t516 = t126*t515
      t519 = t138**2
      t520 = 1/t519
      t521 = t130*t520
      t522 = t131**2
      t523 = t522**2
      t524 = t523*t131
      t525 = 1/t524
      t526 = 1/t86
      t531 = 1/t134
      t534 = 1/t127
      t537 = -0.1853395810515781D1*t525*t526-0.128158207914907D1*t515
     #*t526-0.8223668877838045D0*t531*t526-0.1603914194192128D0*t534
     #*t526
      t538 = 1/t141
      t539 = t537*t538
      t540 = t539*t160
      t552 = 1/t156/t144
      t555 = 0.7055893333333333D0*t480*t145-0.149774528D1*t486*t149
     #+0.7490216106666667D0*t491*t153-0.1267214250666667D0*t497*t157
     #+0.6236439893333333D-2*t504*t552
      t556 = t142*t555
      t559 = -t400-t396
      t562 = t165+t395
      t565 = 0.1333333333333333D1*t199*t559+0.1333333333333333D1*t203
     #*t562
      t567 = t194*t565*t213
      t568 = 0.3799574853701528D-1*t567
      t569 = t410+t414
      t571 = t194*t205*t569
      t572 = 0.3799574853701528D-1*t571
      t573 = t230*t565
      t574 = t573*t211
      t575 = 0.1923661050931536D1*t574
      t583 = t520*t537*t538
      t586 = -t182+t216+t233+t164*(t355+t376-t380-t394+t568+t572+t438
     #+t575-0.7694644203726145D1*t442-t445)+0.3109D-1*t512
     #-0.1321010150222857D-2*t516*t142-0.1D1*t130*t583
      t598 = 0.22495736D-1*t480*t247-0.848379408D-3*t459*t480
     #+0.598194144D-5*t462*t480+0.70967048832D-7*t465*t480
     #-0.48705670656D-9*t470*t480
      vrhob(i) = -0.12407009817988D1*t84*t123-0.9305257363491D0*t85
     #*t509-0.3109D-1*t512*t160+0.1321010150222857D-2*t516*t161+0.1D1
     #*t521*t540-0.3109D-1*t130*t556+t586*t265+t240*t598
      t602 = sigmaaa*t20
      t605 = t16*t28
      t608 = t26*t37
      t613 = 1/t4/t27/t18
      t614 = t34*t613
      t617 = 0.1170108D-2*t9*t13+0.102160816D-3*t602*t23
     #-0.2445588352D-5*t605*t31+0.1893658112D-7*t608*t40
     #-0.4345475072D-10*t614*t298
      t630 = -0.264596D0*t9*t65+0.56165448D0*t602*t69-0.280883104D0
     #*t605*t73+0.475205344D-1*t608*t77-0.233866496D-2*t614*t344
      t631 = t62*t630
      t644 = -0.8435901D-2*t9*t247+0.318142278D-3*t459*t9
     #-0.224322804D-5*t462*t9-0.26612643312D-7*t465*t9
     #+0.18264626496D-9*t470*t9
      vsigmaaa(i) = -0.9305257363491D0*t5*t617-0.3109D-1*t50*t631+t240
     #*t644
      vsigmaab(i) = 0.D0
      t648 = sigmabb*t100
      t651 = t96*t108
      t654 = t106*t117
      t659 = 1/t84/t107/t98
      t660 = t114*t659
      t663 = 0.1170108D-2*t89*t93+0.102160816D-3*t648*t103
     #-0.2445588352D-5*t651*t111+0.1893658112D-7*t654*t120
     #-0.4345475072D-10*t660*t506
      t676 = -0.264596D0*t89*t145+0.56165448D0*t648*t149-0.280883104D0
     #*t651*t153+0.475205344D-1*t654*t157-0.233866496D-2*t660*t552
      t677 = t142*t676
      t690 = -0.8435901D-2*t89*t247+0.318142278D-3*t459*t89
     #-0.224322804D-5*t462*t89-0.26612643312D-7*t465*t89
     #+0.18264626496D-9*t470*t89
      vsigmabb(i) = -0.9305257363491D0*t85*t663-0.3109D-1*t130*t677
     #+t240*t690
      t694 = sigmaaa/t7/t17
      t697 = t17*t269
      t700 = t16/t4/t697
      t703 = t243*t257
      t708 = t250*t262
      t713 = t255*t469
      t720 = t260/t261/t251
      t739 = t26/t35
      t745 = t34/t7/t27/t17
      t751 = t292/t4/t27/t697
      t755 = t27**2
      t758 = t34*t16/t755/t6
      t760 = 1/t39/t22
      t768 = t49*t312
      t775 = 1/t17
      t778 = 1/t269
      t782 = 1/t56/t46
      t799 = -0.1544496508763151D1/t316/t46*t775+0.3706791621031562D1
     #*t317*t778-0.854388052766047D0*t782*t775+0.2563164158298141D1
     #*t307*t778-0.4111834438919023D0/t54/t46*t775
     #+0.1644733775567609D1*t323*t778-0.5346380647307093D-1/t47/t46
     #*t775+0.3207828388384256D0*t326*t778
      t805 = 1/t311/t58
      t807 = t329**2
      t812 = t778*t782
      t821 = t311**2
      t822 = 1/t821
      t824 = t61**2
      t825 = 1/t824
      t841 = 1/t76/t68
      t848 = 0.2D1*t375
      t849 = 0.5495599555936838D-2*t354
      t850 = 0.3847322101863073D1*t437
      t851 = 0.1748158859896213D-2*t379
      t852 = 0.2249999913366216D1*t393
      t856 = 0.1538928840745229D2*t444
      t878 = 1/t361/t165*t210
      t881 = 1/t208/t164
      t882 = t362*t881
      t886 = 1/t174/t165*t210
      t888 = t351*t881
      t892 = 1/t172/t165*t210
      t894 = t366*t881
      t898 = 1/t166/t165*t210
      t900 = t369*t881
      t904 = t358*(-0.8309097827459833D0*t878+0.199418347859036D1*t882
     #-0.4945709824779306D0*t886+0.1483712947433792D1*t888
     #-0.2001071587498409D0*t892+0.8004286349993634D0*t894
     #-0.4215565168327908D-1*t898+0.2529339100996745D0*t900)*t373
      t905 = 0.1D1*t904
      t906 = t888*t180
      t907 = 0.5495599555936838D-2*t906
      t908 = t886*t180
      t909 = 0.1831866518645613D-2*t908
      t913 = t372**2
      t915 = t168/t356/t176*t913*t373
      t916 = 0.2D1*t915
      t920 = t356**2
      t923 = t179**2
      t926 = t168/t920*t913/t923
      t927 = 0.160818243221511D2*t926
      t930 = t353*t357*t372*t373
      t931 = 0.8837926660346786D-1*t930
      t935 = t388**2
      t938 = 0.2249999913366216D1*t184/t381/t189*t935*t392
      t950 = t428**2
      t966 = t421**2
      t969 = t226**2
      t980 = 0.8806734334819047D-3*t886*t227-0.2642020300445714D-2
     #*t888*t227-0.8497974591333914D-1*t353*t422*t428*t429-0.2D1*t218
     #/t421/t223*t950*t429+0.1D1*t423*(-0.1544496508763151D1*t878
     #+0.3706791621031562D1*t882-0.854388052766047D0*t886
     #+0.2563164158298141D1*t888-0.4111834438919023D0*t892
     #+0.1644733775567609D1*t894-0.5346380647307093D-1*t898
     #+0.3207828388384256D0*t900)*t429+0.321646831778707D2*t218/t966
     #*t950/t969-0.1831866518645613D-2*t908+0.5495599555936838D-2*t906
     #+0.8837926660346786D-1*t930+0.2D1*t915-0.1D1*t904
     #-0.160818243221511D2*t926
      t983 = 0.1923661050931536D1*t980*t205*t211
      t985 = t389*t391*t415
      t987 = t206*t210
      t988 = 12.D0*t987
      t989 = t408*t412
      t990 = 32.D0*t989
      t993 = t207/t209/t208
      t994 = 20.D0*t993
      t999 = t231*t987
      t1000 = 0.2308393261117844D2*t999
      t1002 = 0.3847322101863073D2*t231*t993
      t1004 = t435*t404*t211
      t1006 = t905-t907+t909-t916+0.7599149707403056D-1*t194*t404*t415
     #+t927-t931+t938+t983-0.2249999913366216D1*t985
     #+0.3799574853701528D-1*t194*t205*(-t988+t990-t994)+t1000+t1002
     #+0.3847322101863073D1*t1004
      t1007 = t439*t413
      t1009 = t439*t409
      t1011 = t231*t989
      t1013 = t199**2
      t1014 = 1/t1013
      t1015 = t397**2
      t1018 = 2.D0*t352
      t1020 = 2.D0*t196*t881
      t1021 = -t1018+t1020
      t1024 = t203**2
      t1025 = 1/t1024
      t1026 = t401**2
      t1032 = 0.4444444444444444D0*t1014*t1015+0.1333333333333333D1
     #*t199*t1021+0.4444444444444444D0*t1025*t1026
     #-0.1333333333333333D1*t203*t1021
      t1036 = t381**2
      t1040 = t192**2
      t1045 = 0.3330964519106732D2*t184/t1036*t935/t1040*t205*t213
      t1048 = t389*t390*t404*t213
      t1050 = t436*t409
      t1053 = 0.5827196199654043D-3*t886*t378
      t1055 = t353*t377*t415
      t1061 = 0.5176049209143758D-1*t353*t382*t388*t390*t214
      t1066 = 0.1748158859896213D-2*t888*t378
      t1069 = t353*t193*t404*t213
      t1072 = 0.1538928840745229D2*t436*t413
      t1084 = 0.1124999956683108D1*t383*(-0.1132974264373283D1*t878
     #+0.271913823449588D1*t882-0.4994648585728036D0*t886
     #+0.1498394575718411D1*t888-0.1075243117819161D0*t892
     #+0.4300972471276643D0*t894-0.4247805766949639D-1*t898
     #+0.2548683460169784D0*t900)*t392
      t1085 = -0.1538928840745229D2*t1007+0.1538928840745229D2*t1009
     #-0.6155715362980916D2*t1011+0.1923661050931536D1*t230*t1032*t211
     #-t1045-0.2249999913366216D1*t1048+0.1538928840745229D2*t1050
     #-t1053-0.1748158859896213D-2*t1055+t1061+0.3799574853701528D-1
     #*t194*t1032*t213+t1066-0.1748158859896213D-2*t1069-t1072-t1084
      t1088 = t848+t849+t850-t851-t852+0.7599149707403056D-1*t417
     #+0.7599149707403056D-1*t406+0.1538928840745229D2*t442-t856
     #+0.3847322101863073D1*t440+0.2D1*t50*t805*t807*t330-0.1D1*t50
     #*t312*t799*t330-0.321646831778707D2*t50*t822*t807*t825
     #-0.8806734334819047D-3*t812*t62+0.8497974591333914D-1*t308*t452
     #-0.2D1*t768*t331+t164*(t1006+t1085)
      s1 = t240*(-0.8248436533333333D-1*t694*t247+0.1311138432D-2*t700
     #*t252-0.29525914368D-4*t703*t700+0.3110724496D-2*t459*t694
     #-0.140301600768D-6*t708*t700-0.2193378528D-4*t462*t694
     #+0.4868581330944D-8*t713*t700-0.260212512384D-6*t465*t694
     #-0.194822682624D-10*t720*t700+0.178587459072D-8*t470*t694)+2.D0
     #*t455*t473-0.4135669939329333D0/t7*t43-0.24814019635976D1*t4
     #*t301-0.9305257363491D0*t5*(0.11441056D-1*t694*t13
     #+0.1692099598222222D-2*t700*t23-0.6450593575822222D-4*t739*t31
     #+0.7978282853262222D-6*t745*t40-0.3815499257173333D-8*t751*t298
     #+0.6180231213511111D-11*t758*t760)-0.6218D-1*t304*t347+0.2D1
     #*t768*t332+0.2642020300445714D-2*t308*t348
      v2rhoa2(i) = s1+0.1D1*t313*t799*t330*t80-0.2D1*t50*t805*t807
     #*t330*t80+0.8806734334819047D-3*t812*t81-0.8497974591333914D-1
     #*t308*t312*t332+0.2D1*t313*t331*t347+0.321646831778707D2*t50
     #*t822*t807*t825*t80-0.3109D-1*t50*t62*(-0.2587160888888889D1
     #*t694*t65+0.9862034417777778D1*t700*t69-0.8338789461333333D1
     #*t739*t73+0.2676851202844444D1*t745*t77-0.3597280119466667D0
     #*t751*t344+0.1663050638222222D-1*t758*t841)+t1088*t265
      t1097 = sigmabb/t87/t97
      t1100 = t97*t477
      t1103 = t96/t84/t1100
      t1107 = t106/t115
      t1113 = t114/t87/t107/t97
      t1119 = t500/t84/t107/t1100
      t1123 = t107**2
      t1126 = t114*t96/t1123/t86
      t1128 = 1/t119/t102
      t1138 = 1/t477
      t1140 = 1/t136/t126
      t1141 = t1138*t1140
      t1152 = t559**2
      t1155 = t1018+t1020
      t1158 = t562**2
      t1164 = 0.4444444444444444D0*t1014*t1152+0.1333333333333333D1
     #*t199*t1155+0.4444444444444444D0*t1025*t1158
     #-0.1333333333333333D1*t203*t1155
      t1172 = t905-t907+t909-t916+t927-t931+t938+t983+t1000+t1002
     #+0.6155715362980916D2*t1011-t1045+0.3799574853701528D-1*t194
     #*t1164*t213+0.3799574853701528D-1*t194*t205*(-t988-t990-t994)
      t1178 = t389*t391*t569
      t1180 = t573*t413
      t1185 = t573*t409
      t1188 = t435*t565*t211
      t1191 = t353*t377*t569
      t1195 = t353*t193*t565*t213
      t1199 = t389*t390*t565*t213
      t1201 = 0.1923661050931536D1*t230*t1164*t211
     #-0.1538928840745229D2*t1050-0.2249999913366216D1*t1178
     #-0.1538928840745229D2*t1180+0.7599149707403056D-1*t194*t565*t569
     #-0.1538928840745229D2*t1185+0.3847322101863073D1*t1188-t1053
     #-0.1748158859896213D-2*t1191-0.1748158859896213D-2*t1195
     #-0.2249999913366216D1*t1199+t1061+t1066-t1072-t1084
      t1204 = t129*t520
      t1212 = 1/t519/t138
      t1213 = t537**2
      t1220 = 1/t97
      t1241 = -0.1544496508763151D1/t524/t126*t1220
     #+0.3706791621031562D1*t525*t1138-0.854388052766047D0*t1140*t1220
     #+0.2563164158298141D1*t515*t1138-0.4111834438919023D0/t134/t126
     #*t1220+0.1644733775567609D1*t531*t1138-0.5346380647307093D-1
     #/t127/t126*t1220+0.3207828388384256D0*t534*t1138
      t1246 = t519**2
      t1247 = 1/t1246
      t1249 = t141**2
      t1250 = 1/t1249
      t1254 = t848+t849+t850-t851-t852-0.1538928840745229D2*t442-t856
     #+0.7599149707403056D-1*t567+0.7599149707403056D-1*t571
     #+0.3847322101863073D1*t574+t164*(t1172+t1201)-0.2D1*t1204*t539
     #-0.8806734334819047D-3*t1141*t142+0.8497974591333914D-1*t516
     #*t583+0.2D1*t130*t1212*t1213*t538-0.1D1*t130*t520*t1241*t538
     #-0.321646831778707D2*t130*t1247*t1213*t1250
      t1286 = 1/t156/t148
      s1 = -0.4135669939329333D0/t87*t123-0.24814019635976D1*t84*t509
     #-0.9305257363491D0*t85*(0.11441056D-1*t1097*t93
     #+0.1692099598222222D-2*t1103*t103-0.6450593575822222D-4*t1107
     #*t111+0.7978282853262222D-6*t1113*t120-0.3815499257173333D-8
     #*t1119*t506+0.6180231213511111D-11*t1126*t1128)-0.6218D-1*t512
     #*t555+0.2642020300445714D-2*t516*t556+0.8806734334819047D-3
     #*t1141*t161-0.8497974591333914D-1*t516*t520*t540+t1254*t265
      s2 = s1+0.2D1*t1204*t540-0.2D1*t130*t1212*t1213*t538*t160+0.1D1
     #*t521*t1241*t538*t160
      v2rhob2(i) = s2+0.2D1*t521*t539*t555+0.321646831778707D2*t130
     #*t1247*t1213*t1250*t160-0.3109D-1*t130*t142*(
     #-0.2587160888888889D1*t1097*t145+0.9862034417777778D1*t1103*t149
     #-0.8338789461333333D1*t1107*t153+0.2676851202844444D1*t1113*t157
     #-0.3597280119466667D0*t1119*t552+0.1663050638222222D-1*t1126
     #*t1286)+2.D0*t586*t598+t240*(-0.8248436533333333D-1*t1097*t247
     #+0.1311138432D-2*t1103*t252-0.29525914368D-4*t703*t1103
     #+0.3110724496D-2*t459*t1097-0.140301600768D-6*t708*t1103
     #-0.2193378528D-4*t462*t1097+0.4868581330944D-8*t713*t1103
     #-0.260212512384D-6*t465*t1097-0.194822682624D-10*t720*t1103
     #+0.178587459072D-8*t470*t1097)
      t1326 = t905-t907+t909-t916+t927-t931+t938+t983
     #+0.3799574853701528D-1*t194*t565*t415-0.1124999956683108D1*t985
     #-0.2308393261117844D2*t999+t1002+0.1923661050931536D1*t1004
     #-0.7694644203726145D1*t1007-0.7694644203726145D1*t1009-t1045
     #-0.1124999956683108D1*t1048
      t1350 = 0.4444444444444444D0*t1014*t397*t559
     #+0.2666666666666667D1*t199*t196*t881+0.4444444444444444D0*t1025
     #*t401*t562-0.2666666666666667D1*t203*t196*t881
      t1362 = -0.1124999956683108D1*t1178-0.7694644203726145D1*t1180
     #+0.3799574853701528D-1*t194*t404*t569+0.7694644203726145D1*t1185
     #+0.1923661050931536D1*t1188-t1053-0.8740794299481065D-3*t1055
     #-0.8740794299481065D-3*t1191-0.8740794299481065D-3*t1195
     #-0.1124999956683108D1*t1199+t1061+0.3799574853701528D-1*t194
     #*t1350*t213+0.3799574853701528D-1*t194*t205*(t988-t994)+t1066
     #-0.8740794299481065D-3*t1069-t1072-t1084+0.1923661050931536D1
     #*t230*t1350*t211
      t1365 = t849+t848-t851-t852+t568+t572+t850+t575-t856+t407+t418
     #+t441+t164*(t1326+t1362)
      t1375 = t271*sigmabb*t479
      v2rhoab(i) = t1365*t265+t455*t598+t586*t473+t240*
     #(0.1311138432D-2*t272*t252*sigmabb*t479-0.29525914368D-4*t703
     #*sigmaaa*t1375-0.140301600768D-6*t708*sigmaaa*t1375
     #+0.4868581330944D-8*t713*sigmaaa*t1375-0.194822682624D-10*t720
     #*sigmaaa*t1375)
      t1393 = sigmaaa*t277
      t1396 = t16*t282
      t1399 = t26*t288
      t1402 = t34*t295
      t1407 = t292/t755/rhoa
      s1 = -0.12407009817988D1*t4*t617-0.9305257363491D0*t5*(
     #-0.3120288D-2*t271*t13-0.5323765333333333D-3*t1393*t23
     #+0.2174413755733333D-4*t1396*t31-0.2802490258773333D-6*t1399*t40
     #+0.138735747072D-8*t1402*t298-0.2317586705066667D-11*t1407*t760)
     #-0.3109D-1*t304*t630+0.1321010150222857D-2*t308*t631
      v2rhoasigmaaa(i) = s1+0.1D1*t313*t331*t630-0.3109D-1*t50*t62*
     #(0.7055893333333333D0*t271*t65-0.3136608426666667D1*t1393*t69
     #+0.2846162944D1*t1396*t73-0.9562986666666667D0*t1399*t77
     #+0.13255933952D0*t1402*t344-0.6236439893333333D-2*t1407*t841)
     #+t455*t644+t240*(0.22495736D-1*t271*t247-0.491676912D-3*t1393
     #*t252+0.11072217888D-4*t703*t1393-0.848379408D-3*t459*t271
     #+0.52613100288D-7*t708*t1393+0.598194144D-5*t462*t271
     #-0.1825717999104D-8*t713*t1393+0.70967048832D-7*t465*t271
     #+0.73058505984D-11*t720*t1393-0.48705670656D-9*t470*t271)
      v2rhoasigmaab(i) = 0.D0
      t1463 = t272*t89
      v2rhoasigmabb(i) = t455*t690+t240*(-0.491676912D-3*t272*t252*t89
     #+0.11072217888D-4*t703*t1463+0.52613100288D-7*t708*t1463
     #-0.1825717999104D-8*t713*t1463+0.73058505984D-11*t720*t1463)
      t1475 = t252*t9
      t1478 = t480*t9
      v2rhobsigmaaa(i) = t586*t644+t240*(-0.491676912D-3*t480*t1475
     #+0.11072217888D-4*t703*t1478+0.52613100288D-7*t708*t1478
     #-0.1825717999104D-8*t713*t1478+0.73058505984D-11*t720*t1478)
      v2rhobsigmaab(i) = 0.D0
      t1493 = sigmabb*t485
      t1496 = t96*t490
      t1499 = t106*t496
      t1502 = t114*t503
      t1507 = t500/t1123/rhob
      s1 = -0.12407009817988D1*t84*t663-0.9305257363491D0*t85*(
     #-0.3120288D-2*t479*t93-0.5323765333333333D-3*t1493*t103
     #+0.2174413755733333D-4*t1496*t111-0.2802490258773333D-6*t1499
     #*t120+0.138735747072D-8*t1502*t506-0.2317586705066667D-11*t1507
     #*t1128)-0.3109D-1*t512*t676+0.1321010150222857D-2*t516*t677
      v2rhobsigmabb(i) = s1+0.1D1*t521*t539*t676-0.3109D-1*t130*t142*
     #(0.7055893333333333D0*t479*t145-0.3136608426666667D1*t1493*t149
     #+0.2846162944D1*t1496*t153-0.9562986666666667D0*t1499*t157
     #+0.13255933952D0*t1502*t552-0.6236439893333333D-2*t1507*t1286)
     #+t586*t690+t240*(0.22495736D-1*t479*t247-0.491676912D-3*t1493
     #*t252+0.11072217888D-4*t703*t1493-0.848379408D-3*t459*t479
     #+0.52613100288D-7*t708*t1493+0.598194144D-5*t462*t479
     #-0.1825717999104D-8*t713*t1493+0.70967048832D-7*t465*t479
     #+0.73058505984D-11*t720*t1493-0.48705670656D-9*t470*t479)
      t1561 = sigmaaa*t28
      t1564 = t16*t37
      t1567 = t26*t613
      t1571 = t34/t755
      v2sigmaaa2(i) = -0.9305257363491D0*t5*(0.97480384D-4*t20*t23
     #-0.5708463232D-5*t1561*t31+0.86156803584D-7*t1564*t40
     #-0.4768043008D-9*t1567*t298+0.8690950144D-12*t1571*t760)
     #-0.3109D-1*t50*t62*(0.61457368D0*t20*t69-0.786428D0*t1561*t73
     #+0.3110914656D0*t1564*t77-0.4737108736D-1*t1567*t344
     #+0.233866496D-2*t1571*t841)+t240*(0.184378842D-3*t20*t252
     #-0.4152081708D-5*t703*t20-0.19729912608D-7*t708*t20
     #+0.684644249664D-9*t713*t20-0.27396939744D-11*t720*t20)
      v2sigmaaaab(i) = 0.D0
      t1605 = t9*t89
      v2sigmaaabb(i) = t240*(0.184378842D-3*t1475*t89-0.4152081708D-5
     #*t703*t1605-0.19729912608D-7*t708*t1605+0.684644249664D-9*t713
     #*t1605-0.27396939744D-11*t720*t1605)
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      t1617 = sigmabb*t108
      t1620 = t96*t117
      t1623 = t106*t659
      t1627 = t114/t1123
      v2sigmabb2(i) = -0.9305257363491D0*t85*(0.97480384D-4*t100*t103
     #-0.5708463232D-5*t1617*t111+0.86156803584D-7*t1620*t120
     #-0.4768043008D-9*t1623*t506+0.8690950144D-12*t1627*t1128)
     #-0.3109D-1*t130*t142*(0.61457368D0*t100*t149-0.786428D0*t1617
     #*t153+0.3110914656D0*t1620*t157-0.4737108736D-1*t1623*t552
     #+0.233866496D-2*t1627*t1286)+t240*(0.184378842D-3*t100*t252
     #-0.4152081708D-5*t703*t100-0.19729912608D-7*t708*t100
     #+0.684644249664D-9*t713*t100-0.27396939744D-11*t720*t100)
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      v2rhob2(i) = 0.0d0
      v2rhoab(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2rhoasigmaab(i) = 0.0d0
      v2rhoasigmabb(i) = 0.0d0
      v2rhobsigmaaa(i) = 0.0d0
      v2rhobsigmaab(i) = 0.0d0
      v2rhobsigmabb(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      v2sigmaab2(i) = 0.0d0
      v2sigmabb2(i) = 0.0d0
      v2sigmaaaab(i) = 0.0d0
      v2sigmaaabb(i) = 0.0d0
      v2sigmaabbb(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end
      
      
      subroutine rks_xc_b97_3
     & (ideriv,npt,rhoa1,sigmaaa1,
     &  zk,vrhoa,vsigmaaa,
     &  v2rhoa2,v2rhoasigmaaa,v2sigmaaa2)
c
c     T.W. Keal, and D.J. Tozer
c     Semiempirical hybrid functional with improved performance in 
c     an extensive chemical assessment
c     J. Chem. Phys. 123 (2005) 121103.
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt)
      REAL sigmaaa1(npt)
      REAL zk(npt),vrhoa(npt),vsigmaaa(npt)
      REAL v2rhoa2(npt),v2rhoasigmaaa(npt),v2sigmaaa2(npt)
      parameter(tol=1.0d-20)
      
      if(ideriv.eq.0) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t4 = rho**2
      t5 = t2**2
      t8 = sigma/t5/t4
      t10 = 1.D0+0.6349604207872798D-2*t8
      t14 = sigma**2
      t15 = t4**2
      t19 = t14/t2/t15/rho
      t20 = t10**2
      t25 = t15**2
      t27 = t14*sigma/t25
      t32 = t14**2
      t36 = t32/t5/t25/t4
      t37 = t20**2
      t44 = 1/rho
      t45 = t44**(1.D0/3.D0)
      t48 = rho*(1.D0+0.1606016560364007D0*t45)
      t49 = t44**(1.D0/6.D0)
      t52 = dsqrt(t44)
      t54 = t45**2
      t60 = dlog(1.D0+0.321646831778707D2/(0.1248219874679732D2*t49
     #+0.4844076716063854D1*t45+0.2326004811900819D1*t52
     #+0.3819082618690966D0*t54))
      t62 = 1.D0+0.3174802103936399D0*t8
      t66 = t62**2
      t74 = t66**2
      t93 = dlog(1.D0+0.160818243221511D2/(0.598255043577108D1*t49
     #+0.2225569421150687D1*t45+0.8004286349993634D0*t52
     #+0.1897004325747559D0*t54))
      t100 = 1.D0+0.9524406311809197D-2*t8
      t104 = t100**2
      t112 = t104**2
      zk(i) = -0.7385587663820224D0*t2*rho*(0.7334648D0
     #+0.1857430670116406D-2*t8/t10+0.1346115373522385D-3*t19/t20
     #-0.269096448D-5*t27/t20/t10+0.1724502925148597D-7*t36/t37)
     #-0.3109D-1*t48*t60*(0.5623649D0-0.4200199687465777D0*t8/t62
     #+0.6409662880961623D0*t19/t66-0.238848064D0*t27/t66/t62
     #+0.1856199608852584D-1*t36/t74)+(-0.62182D-1*rho*(1.D0
     #+0.1325688999052018D0*t45)*t93+0.3109D-1*t48*t60)*(0.113383D1
     #-0.2678231624339917D-1*t8/t100+0.6741254748906627D-3*t19/t104
     #-0.1701511488D-5*t27/t104/t100-0.9664429104518883D-7*t36/t112)
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t3 = t2*rho
      t4 = rho**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigma*t7
      t10 = 1.D0+0.6349604207872798D-2*t8
      t11 = 1/t10
      t14 = sigma**2
      t15 = t4**2
      t16 = t15*rho
      t18 = 1/t2/t16
      t19 = t14*t18
      t20 = t10**2
      t21 = 1/t20
      t24 = t14*sigma
      t25 = t15**2
      t26 = 1/t25
      t27 = t24*t26
      t29 = 1/t20/t10
      t32 = t14**2
      t35 = 1/t5/t25/t4
      t36 = t32*t35
      t37 = t20**2
      t38 = 1/t37
      t41 = 0.7334648D0+0.1857430670116406D-2*t8*t11
     #+0.1346115373522385D-3*t19*t21-0.269096448D-5*t27*t29
     #+0.1724502925148597D-7*t36*t38
      t44 = 1/rho
      t45 = t44**(1.D0/3.D0)
      t47 = 1.D0+0.1606016560364007D0*t45
      t48 = rho*t47
      t49 = t44**(1.D0/6.D0)
      t52 = dsqrt(t44)
      t54 = t45**2
      t56 = 0.1248219874679732D2*t49+0.4844076716063854D1*t45
     #+0.2326004811900819D1*t52+0.3819082618690966D0*t54
      t59 = 1.D0+0.321646831778707D2/t56
      t60 = dlog(t59)
      t62 = 1.D0+0.3174802103936399D0*t8
      t63 = 1/t62
      t66 = t62**2
      t67 = 1/t66
      t71 = 1/t66/t62
      t74 = t66**2
      t75 = 1/t74
      t78 = 0.5623649D0-0.4200199687465777D0*t8*t63
     #+0.6409662880961623D0*t19*t67-0.238848064D0*t27*t71
     #+0.1856199608852584D-1*t36*t75
      t79 = t60*t78
      t83 = 1.D0+0.1325688999052018D0*t45
      t89 = 0.598255043577108D1*t49+0.2225569421150687D1*t45
     #+0.8004286349993634D0*t52+0.1897004325747559D0*t54
      t92 = 1.D0+0.160818243221511D2/t89
      t93 = dlog(t92)
      t98 = -0.62182D-1*rho*t83*t93+0.3109D-1*t48*t60
      t100 = 1.D0+0.9524406311809197D-2*t8
      t101 = 1/t100
      t104 = t100**2
      t105 = 1/t104
      t109 = 1/t104/t100
      t112 = t104**2
      t113 = 1/t112
      t116 = 0.113383D1-0.2678231624339917D-1*t8*t101
     #+0.6741254748906627D-3*t19*t105-0.1701511488D-5*t27*t109
     #-0.9664429104518883D-7*t36*t113
      zk(i) = -0.7385587663820224D0*t3*t41-0.3109D-1*t48*t79+t98*t116
      t120 = t4*rho
      t123 = sigma/t5/t120
      t126 = t15*t4
      t129 = t14/t2/t126
      t134 = t24/t25/rho
      t140 = t32/t5/t25/t120
      t147 = t32*sigma/t2/t25/t126
      t149 = 1/t37/t10
      t155 = t47*t60
      t158 = 1/t54
      t159 = t44*t158
      t162 = t56**2
      t163 = 1/t162
      t165 = t49**2
      t166 = t165**2
      t169 = 1/t4
      t170 = 1/t166/t49*t169
      t172 = t158*t169
      t175 = 1/t52*t169
      t178 = 1/t45*t169
      t180 = -0.4160732915599108D1*t170-0.3229384477375903D1*t172
     #-0.2326004811900819D1*t175-0.5092110158254621D0*t178
      t181 = 1/t59
      t195 = 1/t74/t62
      t206 = t89**2
      t238 = 1/t112/t100
      s1 = -0.9847450218426965D0*t2*t41-0.3692793831910112D0*t3*(
     #-0.9906296907287498D-2*t123*t11-0.1372955333896928D-2*t129*t21
     #+0.5217255150933333D-4*t134*t29-0.6412789075321418D-6*t140*t38
     #+0.2335981019735996D-8*t147*t149)-0.3109D-1*t155*t78
     #+0.1664368495390566D-2*t159*t79
      vrhoa(i) = s1+0.5D0*t48*t163*t180*t181*t78-0.15545D-1*t48*t60*
     #(0.2240106499981748D1*t123*t63-0.7548163222610763D1*t129*t67
     #+0.5992172885333333D1*t134*t71-0.1609261787661888D1*t140*t75
     #+0.1257187503682369D0*t147*t195)+(-0.62182D-1*t83*t93+rho*
     #(0.2747799777968419D-2*t172*t93+0.1D1*t83/t206*(
     #-0.99709173929518D0*t170-0.7418564737168958D0*t172
     #-0.4002143174996817D0*t175-0.1264669550498372D0*t178)/t92)
     #+0.3109D-1*t155-0.1664368495390566D-2*t159*t60-0.5D0*t48*t163
     #*t180*t181)*t116+t98*(0.7141950998239779D-1*t123*t101
     #-0.4275564297746204D-2*t129*t105+0.4785553152D-4*t134*t109
     #+0.9012253437679631D-6*t140*t113-0.981844795339863D-8*t147*t238)
      t245 = sigma*t18
      t248 = t14*t26
      t251 = t24*t35
      t257 = t32/t2/t25/t16
      vsigmaaa(i) = -0.7385587663820224D0*t3*(0.7429722680465624D-2*t7
     #*t11+0.1029716500422696D-2*t245*t21-0.39129413632D-4*t248*t29
     #+0.4809591806491063D-6*t251*t38-0.1751985764801997D-8*t257*t149)
     #-0.3109D-1*t48*t60*(-0.1680079874986311D1*t7*t63
     #+0.5661122416958072D1*t245*t67-0.4494129664D1*t248*t71
     #+0.1206946340746416D1*t251*t75-0.9428906277617765D-1*t257*t195)
     #+2.D0*t98*(-0.5356463248679834D-1*t7*t101+0.3206673223309653D-2
     #*t245*t105-0.3589164864D-4*t248*t109-0.6759190078259723D-6*t251
     #*t113+0.7363835965048972D-8*t257*t238)
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t3 = t2*rho
      t4 = rho**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigma*t7
      t10 = 1.D0+0.6349604207872798D-2*t8
      t11 = 1/t10
      t14 = sigma**2
      t15 = t4**2
      t16 = t15*rho
      t18 = 1/t2/t16
      t19 = t14*t18
      t20 = t10**2
      t21 = 1/t20
      t24 = t14*sigma
      t25 = t15**2
      t26 = 1/t25
      t27 = t24*t26
      t29 = 1/t20/t10
      t32 = t14**2
      t33 = t25*t4
      t35 = 1/t5/t33
      t36 = t32*t35
      t37 = t20**2
      t38 = 1/t37
      t41 = 0.7334648D0+0.1857430670116406D-2*t8*t11
     #+0.1346115373522385D-3*t19*t21-0.269096448D-5*t27*t29
     #+0.1724502925148597D-7*t36*t38
      t44 = 1/rho
      t45 = t44**(1.D0/3.D0)
      t47 = 1.D0+0.1606016560364007D0*t45
      t48 = rho*t47
      t49 = t44**(1.D0/6.D0)
      t52 = dsqrt(t44)
      t54 = t45**2
      t56 = 0.1248219874679732D2*t49+0.4844076716063854D1*t45
     #+0.2326004811900819D1*t52+0.3819082618690966D0*t54
      t59 = 1.D0+0.321646831778707D2/t56
      t60 = dlog(t59)
      t62 = 1.D0+0.3174802103936399D0*t8
      t63 = 1/t62
      t66 = t62**2
      t67 = 1/t66
      t71 = 1/t66/t62
      t74 = t66**2
      t75 = 1/t74
      t78 = 0.5623649D0-0.4200199687465777D0*t8*t63
     #+0.6409662880961623D0*t19*t67-0.238848064D0*t27*t71
     #+0.1856199608852584D-1*t36*t75
      t79 = t60*t78
      t83 = 1.D0+0.1325688999052018D0*t45
      t89 = 0.598255043577108D1*t49+0.2225569421150687D1*t45
     #+0.8004286349993634D0*t52+0.1897004325747559D0*t54
      t92 = 1.D0+0.160818243221511D2/t89
      t93 = dlog(t92)
      t98 = -0.62182D-1*rho*t83*t93+0.3109D-1*t48*t60
      t100 = 1.D0+0.9524406311809197D-2*t8
      t101 = 1/t100
      t104 = t100**2
      t105 = 1/t104
      t109 = 1/t104/t100
      t112 = t104**2
      t113 = 1/t112
      t116 = 0.113383D1-0.2678231624339917D-1*t8*t101
     #+0.6741254748906627D-3*t19*t105-0.1701511488D-5*t27*t109
     #-0.9664429104518883D-7*t36*t113
      zk(i) = -0.7385587663820224D0*t3*t41-0.3109D-1*t48*t79+t98*t116
      t120 = t4*rho
      t122 = 1/t5/t120
      t123 = sigma*t122
      t126 = t15*t4
      t128 = 1/t2/t126
      t129 = t14*t128
      t133 = 1/t25/rho
      t134 = t24*t133
      t139 = 1/t5/t25/t120
      t140 = t32*t139
      t143 = t32*sigma
      t146 = 1/t2/t25/t126
      t147 = t143*t146
      t149 = 1/t37/t10
      t152 = -0.9906296907287498D-2*t123*t11-0.1372955333896928D-2
     #*t129*t21+0.5217255150933333D-4*t134*t29-0.6412789075321418D-6
     #*t140*t38+0.2335981019735996D-8*t147*t149
      t155 = t47*t60
      t158 = 1/t54
      t159 = t44*t158
      t162 = t56**2
      t163 = 1/t162
      t164 = t48*t163
      t165 = t49**2
      t166 = t165**2
      t167 = t166*t49
      t168 = 1/t167
      t169 = 1/t4
      t170 = t168*t169
      t172 = t158*t169
      t174 = 1/t52
      t175 = t174*t169
      t177 = 1/t45
      t178 = t177*t169
      t180 = -0.4160732915599108D1*t170-0.3229384477375903D1*t172
     #-0.2326004811900819D1*t175-0.5092110158254621D0*t178
      t181 = 1/t59
      t182 = t180*t181
      t183 = t182*t78
      t195 = 1/t74/t62
      t198 = 0.2240106499981748D1*t123*t63-0.7548163222610763D1*t129
     #*t67+0.5992172885333333D1*t134*t71-0.1609261787661888D1*t140*t75
     #+0.1257187503682369D0*t147*t195
      t199 = t60*t198
      t204 = t172*t93
      t206 = t89**2
      t207 = 1/t206
      t208 = t83*t207
      t213 = -0.99709173929518D0*t170-0.7418564737168958D0*t172
     #-0.4002143174996817D0*t175-0.1264669550498372D0*t178
      t214 = 1/t92
      t216 = t208*t213*t214
      t224 = t163*t180*t181
      t227 = -0.62182D-1*t83*t93+rho*(0.2747799777968419D-2*t204+0.1D1
     #*t216)+0.3109D-1*t155-0.1664368495390566D-2*t159*t60-0.5D0*t48
     #*t224
      t230 = 0.7141950998239779D-1*t123*t101
      t232 = 0.4275564297746204D-2*t129*t105
      t234 = 0.4785553152D-4*t134*t109
      t235 = t140*t113
      t238 = 1/t112/t100
      t240 = 0.981844795339863D-8*t147*t238
      t241 = t230-t232+t234+0.9012253437679631D-6*t235-t240
      vrhoa(i) = -0.9847450218426965D0*t2*t41-0.3692793831910112D0*t3
     #*t152-0.3109D-1*t155*t78+0.1664368495390566D-2*t159*t79+0.5D0
     #*t164*t183-0.15545D-1*t48*t199+t227*t116+t98*t241
      t245 = sigma*t18
      t248 = t14*t26
      t251 = t24*t35
      t256 = 1/t2/t25/t16
      t257 = t32*t256
      t260 = 0.7429722680465624D-2*t7*t11+0.1029716500422696D-2*t245
     #*t21-0.39129413632D-4*t248*t29+0.4809591806491063D-6*t251*t38
     #-0.1751985764801997D-8*t257*t149
      t273 = -0.1680079874986311D1*t7*t63+0.5661122416958072D1*t245
     #*t67-0.4494129664D1*t248*t71+0.1206946340746416D1*t251*t75
     #-0.9428906277617765D-1*t257*t195
      t274 = t60*t273
      t287 = -0.5356463248679834D-1*t7*t101+0.3206673223309653D-2*t245
     #*t105-0.3589164864D-4*t248*t109-0.6759190078259723D-6*t251*t113
     #+0.7363835965048972D-8*t257*t238
      vsigmaaa(i) = -0.7385587663820224D0*t3*t260-0.3109D-1*t48*t274
     #+2.D0*t98*t287
      t294 = sigma/t5/t15
      t297 = t15*t120
      t300 = t14/t2/t297
      t301 = t300*t105
      t304 = t24/t33
      t305 = t304*t109
      t310 = t32/t5/t25/t15
      t311 = t310*t113
      t316 = t143/t2/t25/t297
      t317 = t316*t238
      t320 = t25**2
      t323 = t32*t14/t320/t4
      t325 = 1/t112/t104
      t327 = 0.12468651687936D-8*t323*t325
      t332 = t162**2
      t333 = 1/t332
      t334 = t180**2
      t336 = t59**2
      t337 = 1/t336
      t341 = 0.5495599555936838D-2*t204
      t342 = 0.2D1*t216
      t343 = t47*t163
      t346 = 1/t120
      t348 = 1/t54/t44
      t349 = t346*t348
      t355 = 1/t162/t56
      t360 = 1/t15
      t361 = t348*t360
      t363 = 0.1831866518645613D-2*t361*t93
      t364 = t158*t346
      t366 = 0.5495599555936838D-2*t364*t93
      t377 = dlog(1.D0+0.2960857464321668D2/(0.8157414703487641D1*t49
     #+0.2247591863577616D1*t45+0.4300972471276643D0*t52
     #+0.1911512595127338D0*t54))
      t379 = (1.D0+0.6901399211255825D-1*t45)*t377*t169
      t381 = t206**2
      t384 = t213**2
      t385 = t92**2
      t389 = 0.160818243221511D2*t83/t381*t384/t385
      t395 = 0.2D1*t83/t206/t89*t384*t214
      t398 = 1/t167/t44*t360
      t400 = t168*t346
      t406 = 1/t52/t44*t360
      t408 = t174*t346
      t412 = 1/t45/t44*t360
      t414 = t177*t346
      t419 = 0.1D1*t208*(-0.8309097827459833D0*t398
     #+0.199418347859036D1*t400-0.4945709824779306D0*t361
     #+0.1483712947433792D1*t364-0.2001071587498409D0*t406
     #+0.8004286349993634D0*t408-0.4215565168327908D-1*t412
     #+0.2529339100996745D0*t414)*t214
      t423 = 0.8837926660346786D-1*t172*t207*t213*t214
      t434 = -0.6934554859331846D1*t398+0.1664293166239643D2*t400
     #-0.4305845969834537D1*t361+0.1291753790950361D2*t364
     #-0.2326004811900819D1*t406+0.9304019247603276D1*t408
     #-0.3394740105503081D0*t412+0.2036844063301848D1*t414
      t452 = 1/t37/t20
      t474 = 1/t74/t66
      s2 = 3.D0*t227*t241+t98*(-0.5237430732042505D0*t294*t101
     #+0.4456958546189582D-1*t301-0.823355194368D-3*t305
     #-0.1017242439272952D-4*t311+0.268290850921666D-6*t317-t327)
     #-0.6218D-1*t155*t198+(-0.1608234158893535D2*t48*t333*t334*t337
     #+t341+t342-0.2D1*t343*t182-0.2219157993854088D-2*t349*t60
     #+0.1070677706909338D0*t159*t224+0.1D1*t48*t355*t334*t181+rho*
     #(t363-t366+0.3377399869956914D-1*t379+t389-t395+t419-t423)-0.5D0
     #*t48*t163*t434*t181)*t116
      s1 = s2-0.3692793831910112D0*t3*(0.7264617732010832D-1*t294*t11
     #+0.1705529521855068D-1*t300*t21-0.1032094972131556D-2*t304*t29
     #+0.2026357535066928D-4*t310*t38-0.1538312905590699D-6*t316*t149
     #+0.3955347976647111D-9*t323*t452)-0.6564966812284644D0/t5*t41
     #-0.1969490043685393D1*t2*t152-0.15545D-1*t48*t60*(
     #-0.1642744766653282D2*t294*t63+0.9940307806196762D2*t300*t67
     #-0.1334206313813333D3*t304*t71+0.6798778264572178D2*t310*t75
     #-0.1450332462363007D2*t316*t195+0.1064352408462222D1*t323*t474)
     #+0.2219157993854088D-2*t349*t79
      v2rhoa2(i) = s1-0.1070677706909338D0*t159*t163*t183+0.5D0*t164
     #*t434*t181*t78-0.1D1*t48*t355*t334*t181*t78
     #+0.3328736990781132D-2*t159*t199+0.2D1*t343*t183
     #+0.1608234158893535D2*t48*t333*t334*t337*t78+0.1D1*t164*t182
     #*t198+(t341+t342+rho*(t363-t366-0.3377399869956914D-1*t379+t389
     #-t395+t419-t423))*t116+t227*(t230-t232+t234
     #+0.9012253437679631D-6*t235-t240)+t98*(0.1321544727842366D-1
     #*t301-0.472414629888D-3*t305-0.3563438538431129D-5*t311
     #+0.1962888992634094D-6*t317-t327)
      t525 = sigma*t128
      t528 = t14*t133
      t531 = t24*t139
      t534 = t32*t146
      t539 = t143/t320/rho
      t572 = t525*t105
      t574 = t528*t109
      t576 = t531*t113
      t578 = t534*t238
      t581 = 0.9351488765952D-9*t539*t325
      s1 = -0.9847450218426965D0*t2*t260-0.3692793831910112D0*t3*(
     #-0.3962518762914999D-1*t122*t11-0.1073203841306762D-1*t525*t21
     #+0.6958124018346667D-3*t528*t29-0.1423576315170375D-4*t531*t38
     #+0.1118694963896984D-6*t534*t149-0.2966510982485333D-9*t539*t452
     #)-0.3109D-1*t155*t273+0.1664368495390566D-2*t159*t274
      v2rhoasigmaaa(i) = s1+0.5D0*t164*t182*t273-0.15545D-1*t48*t60*
     #(0.8960425999926991D1*t122*t63-0.6323006371255957D2*t525*t67
     #+0.91077214208D2*t528*t71-0.485769443027985D2*t531*t75
     #+0.106889153421702D2*t534*t195-0.7982643063466667D0*t539*t474)
     #+2.D0*t227*t287+t98*(0.2856780399295912D0*t122*t101
     #-0.2701384264980256D-1*t572+0.545733098496D-3*t574
     #+0.6277480278895199D-5*t576-0.1864904662611516D-6*t578+t581)+t98
     #*(-0.9911585458817747D-2*t572+0.354310972416D-3*t574
     #+0.2672578903823347D-5*t576-0.147216674447557D-6*t578+t581)
      t592 = sigma*t26
      t595 = t14*t35
      t598 = t24*t256
      t602 = t32/t320
      v2sigmaaa2(i) = -0.7385587663820224D0*t3*(0.3930162808109933D-2
     #*t18*t21-0.365341646848D-3*t592*t29+0.8752985641181385D-5*t595
     #*t38-0.7689417923306584D-7*t598*t149+0.2224883236864D-9*t602
     #*t452)-0.3109D-1*t48*t60*(0.2477805811658739D2*t18*t67
     #-0.50331392D2*t592*t71+0.3160492286411321D2*t595*t75
     #-0.7639530255522938D1*t598*t195+0.59869822976D0*t602*t474)+4.D0
     #*t98*(0.743368909411331D-2*t18*t105-0.265733229312D-3*t592*t109
     #-0.200443417786751D-5*t595*t113+0.1104125058356678D-6*t598*t238
     #-0.7013616574464D-9*t602*t325)
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end
c:XC_B97_3subrend
_ENDIF
_IF(ccpdft,all,xc_b97_d)
c:XC_B97_Dsubrstart

c    Generated: Wed Jul 22 13:55:57 BST 2009

      subroutine uks_xc_b97_d
     & (ideriv,npt,rhoa1,rhob1,sigmaaa1,sigmabb1,sigmaab1,
     &  zk,vrhoa,vrhob,vsigmaaa,vsigmabb,vsigmaab,
     &  v2rhoa2,v2rhob2,v2rhoab,
     &  v2rhoasigmaaa,v2rhoasigmaab,v2rhoasigmabb,
     &  v2rhobsigmabb,v2rhobsigmaab,v2rhobsigmaaa,
     &  v2sigmaaa2,v2sigmaaaab,v2sigmaaabb,
     &  v2sigmaab2,v2sigmaabbb,v2sigmabb2)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt),rhob1(npt)
      REAL sigmaaa1(npt),sigmabb1(npt),sigmaab1(npt)
      REAL zk(npt),vrhoa(npt),vrhob(npt)
      REAL vsigmaaa(npt),vsigmabb(npt),vsigmaab(npt)
      REAL v2rhoa2(npt),v2rhob2(npt),v2rhoab(npt)
      REAL v2rhoasigmaaa(npt),v2rhoasigmaab(npt)
      REAL v2rhoasigmabb(npt),v2rhobsigmabb(npt)
      REAL v2rhobsigmaab(npt),v2rhobsigmaaa(npt)
      REAL v2sigmaaa2(npt),v2sigmaaaab(npt),v2sigmaaabb(npt)
      REAL v2sigmaab2(npt),v2sigmaabbb(npt),v2sigmabb2(npt)
      parameter(tol=1.0d-20)
      
      if (ideriv.eq.0) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t4 = rhob**2
      t5 = t2**2
      t8 = sigmabb/t5/t4
      t10 = 1.D0+0.4D-2*t8
      t14 = sigmabb**2
      t15 = t4**2
      t19 = t14/t2/t15/rhob
      t20 = t10**2
      t27 = 1/rhob
      t28 = t27**(1.D0/3.D0)
      t32 = t27**(1.D0/6.D0)
      t35 = dsqrt(t27)
      t37 = t28**2
      t43 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t32
     #+0.3844746237447211D1*t28+0.1644733775567609D1*t35
     #+0.2405871291288192D0*t37))
      t45 = 1.D0+0.2D0*t8
      t49 = t45**2
      zk(i) = -0.9305257363491D0*t2*rhob*(0.108662D1-0.208508D-2*t8
     #/t10+0.5206864D-4*t19/t20)-0.3109D-1*rhob*(1.D0
     #+0.1274696188700087D0*t28)*t43*(0.2234D0-0.312416D0*t8/t45
     #+0.777172D-1*t19/t49)
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t4 = rhoa**2
      t5 = t2**2
      t8 = sigmaaa/t5/t4
      t10 = 1.D0+0.4D-2*t8
      t14 = sigmaaa**2
      t15 = t4**2
      t19 = t14/t2/t15/rhoa
      t20 = t10**2
      t27 = 1/rhoa
      t28 = t27**(1.D0/3.D0)
      t32 = t27**(1.D0/6.D0)
      t35 = dsqrt(t27)
      t37 = t28**2
      t43 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t32
     #+0.3844746237447211D1*t28+0.1644733775567609D1*t35
     #+0.2405871291288192D0*t37))
      t45 = 1.D0+0.2D0*t8
      t49 = t45**2
      zk(i) = -0.9305257363491D0*t2*rhoa*(0.108662D1-0.208508D-2*t8
     #/t10+0.5206864D-4*t19/t20)-0.3109D-1*rhoa*(1.D0
     #+0.1274696188700087D0*t28)*t43*(0.2234D0-0.312416D0*t8/t45
     #+0.777172D-1*t19/t49)
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t6 = rhoa**2
      t7 = t4**2
      t10 = sigmaaa/t7/t6
      t12 = 1.D0+0.4D-2*t10
      t16 = sigmaaa**2
      t17 = t6**2
      t21 = t16/t4/t17/rhoa
      t22 = t12**2
      t29 = 1/rhoa
      t30 = t29**(1.D0/3.D0)
      t33 = rhoa*(1.D0+0.1274696188700087D0*t30)
      t34 = t29**(1.D0/6.D0)
      t37 = dsqrt(t29)
      t39 = t30**2
      t45 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t34
     #+0.3844746237447211D1*t30+0.1644733775567609D1*t37
     #+0.2405871291288192D0*t39))
      t47 = 1.D0+0.2D0*t10
      t51 = t47**2
      t59 = rhob**(1.D0/3.D0)
      t61 = rhob**2
      t62 = t59**2
      t65 = sigmabb/t62/t61
      t67 = 1.D0+0.4D-2*t65
      t71 = sigmabb**2
      t72 = t61**2
      t76 = t71/t59/t72/rhob
      t77 = t67**2
      t84 = 1/rhob
      t85 = t84**(1.D0/3.D0)
      t88 = rhob*(1.D0+0.1274696188700087D0*t85)
      t89 = t84**(1.D0/6.D0)
      t92 = dsqrt(t84)
      t94 = t85**2
      t100 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t89
     #+0.3844746237447211D1*t85+0.1644733775567609D1*t92
     #+0.2405871291288192D0*t94))
      t102 = 1.D0+0.2D0*t65
      t106 = t102**2
      t114 = rhoa+rhob
      t115 = 1/t114
      t116 = t115**(1.D0/3.D0)
      t119 = t115**(1.D0/6.D0)
      t122 = dsqrt(t115)
      t124 = t116**2
      t130 = dlog(1.D0+0.160818243221511D2/(0.598255043577108D1*t119
     #+0.2225569421150687D1*t116+0.8004286349993634D0*t122
     #+0.1897004325747559D0*t124))
      t132 = 0.62182D-1*(1.D0+0.1325688999052018D0*t116)*t130
      t143 = dlog(1.D0+0.2960857464321668D2/(0.8157414703487641D1*t119
     #+0.2247591863577616D1*t116+0.4300972471276643D0*t122
     #+0.1911512595127338D0*t124))
      t146 = rhoa-1.D0*rhob
      t147 = t146*t115
      t148 = 1.D0+t147
      t149 = t148**(1.D0/3.D0)
      t152 = 1.D0-1.D0*t147
      t153 = t152**(1.D0/3.D0)
      t155 = t149*t148+t153*t152-2.D0
      t156 = t146**2
      t157 = t156**2
      t158 = t114**2
      t159 = t158**2
      t161 = t157/t159
      t177 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t119
     #+0.3844746237447211D1*t116+0.1644733775567609D1*t122
     #+0.2405871291288192D0*t124))
      t193 = 0.5D0*t10+0.5D0*t65
      t196 = 1.D0+0.3D-2*t10+0.3D-2*t65
      t200 = t193**2
      t201 = t196**2
      zk(i) = -0.9305257363491D0*t4*rhoa*(0.108662D1-0.208508D-2*t10
     #/t12+0.5206864D-4*t21/t22)-0.3109D-1*t33*t45*(0.2234D0
     #-0.312416D0*t10/t47+0.777172D-1*t21/t51)-0.9305257363491D0*t59
     #*rhob*(0.108662D1-0.208508D-2*t65/t67+0.5206864D-4*t76/t77)
     #-0.3109D-1*t88*t100*(0.2234D0-0.312416D0*t65/t102+0.777172D-1
     #*t76/t106)+(t114*(-t132+0.3799574853701528D-1*(1.D0
     #+0.6901399211255825D-1*t116)*t143*t155*(1.D0-1.D0*t161)
     #+0.1923661050931536D1*(-0.3109D-1*(1.D0+0.1274696188700087D0
     #*t116)*t177+t132)*t155*t161)+0.3109D-1*t33*t45+0.3109D-1*t88
     #*t100)*(0.69041D0+0.378162D-1*t193/t196-0.5389632D-3*t200/t201)
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t3 = t2*rhob
      t4 = rhob**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigmabb*t7
      t10 = 1.D0+0.4D-2*t8
      t11 = 1/t10
      t14 = sigmabb**2
      t15 = t4**2
      t18 = 1/t2/t15/rhob
      t19 = t14*t18
      t20 = t10**2
      t21 = 1/t20
      t24 = 0.108662D1-0.208508D-2*t8*t11+0.5206864D-4*t19*t21
      t27 = 1/rhob
      t28 = t27**(1.D0/3.D0)
      t30 = 1.D0+0.1274696188700087D0*t28
      t31 = rhob*t30
      t32 = t27**(1.D0/6.D0)
      t35 = dsqrt(t27)
      t37 = t28**2
      t39 = 0.1112037486309468D2*t32+0.3844746237447211D1*t28
     #+0.1644733775567609D1*t35+0.2405871291288192D0*t37
      t42 = 1.D0+0.321646831778707D2/t39
      t43 = dlog(t42)
      t45 = 1.D0+0.2D0*t8
      t46 = 1/t45
      t49 = t45**2
      t50 = 1/t49
      t53 = 0.2234D0-0.312416D0*t8*t46+0.777172D-1*t19*t50
      t54 = t43*t53
      zk(i) = -0.9305257363491D0*t3*t24-0.3109D-1*t31*t54
      vrhoa(i) = 0.D0
      t62 = sigmabb/t5/t4/rhob
      t68 = t14/t2/t15/t4
      t72 = t15**2
      t75 = t14*sigmabb/t72/rhob
      t77 = 1/t20/t10
      t86 = 1/t37
      t90 = t39**2
      t93 = t32**2
      t94 = t93**2
      t97 = 1/t4
      t119 = 1/t49/t45
      vrhob(i) = -0.12407009817988D1*t2*t24-0.9305257363491D0*t3*
     #(0.5560213333333333D-2*t62*t11-0.2999402666666667D-3*t68*t21
     #+0.1110797653333333D-5*t75*t77)-0.3109D-1*t30*t43*t53
     #+0.1321010150222857D-2*t27*t86*t54+0.1D1*t31/t90*(
     #-0.1853395810515781D1/t94/t32*t97-0.128158207914907D1*t86*t97
     #-0.8223668877838045D0/t35*t97-0.1603914194192128D0/t28*t97)/t42
     #*t53-0.3109D-1*t31*t43*(0.8331093333333333D0*t62*t46-0.5811136D0
     #*t68*t50+0.8289834666666667D-1*t75*t119)
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      t128 = sigmabb*t18
      t132 = t14/t72
      vsigmabb(i) = -0.9305257363491D0*t3*(-0.208508D-2*t7*t11
     #+0.1124776D-3*t128*t21-0.41654912D-6*t132*t77)-0.3109D-1*t31*t43
     #*(-0.312416D0*t7*t46+0.2179176D0*t128*t50-0.3108688D-1*t132*t119)
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t3 = t2*rhoa
      t4 = rhoa**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigmaaa*t7
      t10 = 1.D0+0.4D-2*t8
      t11 = 1/t10
      t14 = sigmaaa**2
      t15 = t4**2
      t18 = 1/t2/t15/rhoa
      t19 = t14*t18
      t20 = t10**2
      t21 = 1/t20
      t24 = 0.108662D1-0.208508D-2*t8*t11+0.5206864D-4*t19*t21
      t27 = 1/rhoa
      t28 = t27**(1.D0/3.D0)
      t30 = 1.D0+0.1274696188700087D0*t28
      t31 = rhoa*t30
      t32 = t27**(1.D0/6.D0)
      t35 = dsqrt(t27)
      t37 = t28**2
      t39 = 0.1112037486309468D2*t32+0.3844746237447211D1*t28
     #+0.1644733775567609D1*t35+0.2405871291288192D0*t37
      t42 = 1.D0+0.321646831778707D2/t39
      t43 = dlog(t42)
      t45 = 1.D0+0.2D0*t8
      t46 = 1/t45
      t49 = t45**2
      t50 = 1/t49
      t53 = 0.2234D0-0.312416D0*t8*t46+0.777172D-1*t19*t50
      t54 = t43*t53
      zk(i) = -0.9305257363491D0*t3*t24-0.3109D-1*t31*t54
      t62 = sigmaaa/t5/t4/rhoa
      t68 = t14/t2/t15/t4
      t72 = t15**2
      t75 = t14*sigmaaa/t72/rhoa
      t77 = 1/t20/t10
      t86 = 1/t37
      t90 = t39**2
      t93 = t32**2
      t94 = t93**2
      t97 = 1/t4
      t119 = 1/t49/t45
      vrhoa(i) = -0.12407009817988D1*t2*t24-0.9305257363491D0*t3*
     #(0.5560213333333333D-2*t62*t11-0.2999402666666667D-3*t68*t21
     #+0.1110797653333333D-5*t75*t77)-0.3109D-1*t30*t43*t53
     #+0.1321010150222857D-2*t27*t86*t54+0.1D1*t31/t90*(
     #-0.1853395810515781D1/t94/t32*t97-0.128158207914907D1*t86*t97
     #-0.8223668877838045D0/t35*t97-0.1603914194192128D0/t28*t97)/t42
     #*t53-0.3109D-1*t31*t43*(0.8331093333333333D0*t62*t46-0.5811136D0
     #*t68*t50+0.8289834666666667D-1*t75*t119)
      vrhob(i) = 0.D0
      t128 = sigmaaa*t18
      t132 = t14/t72
      vsigmaaa(i) = -0.9305257363491D0*t3*(-0.208508D-2*t7*t11
     #+0.1124776D-3*t128*t21-0.41654912D-6*t132*t77)-0.3109D-1*t31*t43
     #*(-0.312416D0*t7*t46+0.2179176D0*t128*t50-0.3108688D-1*t132*t119)
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t5 = t4*rhoa
      t6 = rhoa**2
      t7 = t4**2
      t9 = 1/t7/t6
      t10 = sigmaaa*t9
      t12 = 1.D0+0.4D-2*t10
      t13 = 1/t12
      t16 = sigmaaa**2
      t17 = t6**2
      t20 = 1/t4/t17/rhoa
      t21 = t16*t20
      t22 = t12**2
      t23 = 1/t22
      t26 = 0.108662D1-0.208508D-2*t10*t13+0.5206864D-4*t21*t23
      t29 = 1/rhoa
      t30 = t29**(1.D0/3.D0)
      t32 = 1.D0+0.1274696188700087D0*t30
      t33 = rhoa*t32
      t34 = t29**(1.D0/6.D0)
      t37 = dsqrt(t29)
      t39 = t30**2
      t41 = 0.1112037486309468D2*t34+0.3844746237447211D1*t30
     #+0.1644733775567609D1*t37+0.2405871291288192D0*t39
      t44 = 1.D0+0.321646831778707D2/t41
      t45 = dlog(t44)
      t47 = 1.D0+0.2D0*t10
      t48 = 1/t47
      t51 = t47**2
      t52 = 1/t51
      t55 = 0.2234D0-0.312416D0*t10*t48+0.777172D-1*t21*t52
      t56 = t45*t55
      t59 = rhob**(1.D0/3.D0)
      t60 = t59*rhob
      t61 = rhob**2
      t62 = t59**2
      t64 = 1/t62/t61
      t65 = sigmabb*t64
      t67 = 1.D0+0.4D-2*t65
      t68 = 1/t67
      t71 = sigmabb**2
      t72 = t61**2
      t75 = 1/t59/t72/rhob
      t76 = t71*t75
      t77 = t67**2
      t78 = 1/t77
      t81 = 0.108662D1-0.208508D-2*t65*t68+0.5206864D-4*t76*t78
      t84 = 1/rhob
      t85 = t84**(1.D0/3.D0)
      t87 = 1.D0+0.1274696188700087D0*t85
      t88 = rhob*t87
      t89 = t84**(1.D0/6.D0)
      t92 = dsqrt(t84)
      t94 = t85**2
      t96 = 0.1112037486309468D2*t89+0.3844746237447211D1*t85
     #+0.1644733775567609D1*t92+0.2405871291288192D0*t94
      t99 = 1.D0+0.321646831778707D2/t96
      t100 = dlog(t99)
      t102 = 1.D0+0.2D0*t65
      t103 = 1/t102
      t106 = t102**2
      t107 = 1/t106
      t110 = 0.2234D0-0.312416D0*t65*t103+0.777172D-1*t76*t107
      t111 = t100*t110
      t114 = rhoa+rhob
      t115 = 1/t114
      t116 = t115**(1.D0/3.D0)
      t118 = 1.D0+0.1325688999052018D0*t116
      t119 = t115**(1.D0/6.D0)
      t122 = dsqrt(t115)
      t124 = t116**2
      t126 = 0.598255043577108D1*t119+0.2225569421150687D1*t116
     #+0.8004286349993634D0*t122+0.1897004325747559D0*t124
      t129 = 1.D0+0.160818243221511D2/t126
      t130 = dlog(t129)
      t132 = 0.62182D-1*t118*t130
      t134 = 1.D0+0.6901399211255825D-1*t116
      t139 = 0.8157414703487641D1*t119+0.2247591863577616D1*t116
     #+0.4300972471276643D0*t122+0.1911512595127338D0*t124
      t142 = 1.D0+0.2960857464321668D2/t139
      t143 = dlog(t142)
      t144 = t134*t143
      t146 = rhoa-1.D0*rhob
      t147 = t146*t115
      t148 = 1.D0+t147
      t149 = t148**(1.D0/3.D0)
      t152 = 1.D0-1.D0*t147
      t153 = t152**(1.D0/3.D0)
      t155 = t149*t148+t153*t152-2.D0
      t156 = t146**2
      t157 = t156**2
      t158 = t114**2
      t159 = t158**2
      t160 = 1/t159
      t161 = t157*t160
      t163 = 1.D0-1.D0*t161
      t166 = 0.3799574853701528D-1*t144*t155*t163
      t168 = 1.D0+0.1274696188700087D0*t116
      t173 = 0.1112037486309468D2*t119+0.3844746237447211D1*t116
     #+0.1644733775567609D1*t122+0.2405871291288192D0*t124
      t176 = 1.D0+0.321646831778707D2/t173
      t177 = dlog(t176)
      t180 = -0.3109D-1*t168*t177+t132
      t181 = t180*t155
      t183 = 0.1923661050931536D1*t181*t161
      t190 = t114*(-t132+t166+t183)+0.3109D-1*t33*t45+0.3109D-1*t88*t100
      t193 = 0.5D0*t10+0.5D0*t65
      t196 = 1.D0+0.3D-2*t10+0.3D-2*t65
      t197 = 1/t196
      t200 = t193**2
      t201 = t196**2
      t202 = 1/t201
      t205 = 0.69041D0+0.378162D-1*t193*t197-0.5389632D-3*t200*t202
      zk(i) = -0.9305257363491D0*t5*t26-0.3109D-1*t33*t56
     #-0.9305257363491D0*t60*t81-0.3109D-1*t88*t111+t190*t205
      t212 = sigmaaa/t7/t6/rhoa
      t218 = t16/t4/t17/t6
      t222 = t17**2
      t225 = t16*sigmaaa/t222/rhoa
      t227 = 1/t22/t12
      t233 = t32*t45
      t236 = 1/t39
      t237 = t29*t236
      t240 = t41**2
      t241 = 1/t240
      t243 = t34**2
      t244 = t243**2
      t247 = 1/t6
      t258 = -0.1853395810515781D1/t244/t34*t247-0.128158207914907D1
     #*t236*t247-0.8223668877838045D0/t37*t247-0.1603914194192128D0
     #/t30*t247
      t259 = 1/t44
      t269 = 1/t51/t47
      t277 = 1/t158
      t278 = 1/t124*t277
      t279 = t278*t130
      t280 = 0.2747799777968419D-2*t279
      t281 = t126**2
      t284 = t119**2
      t285 = t284**2
      t288 = 1/t285/t119*t277
      t292 = 1/t122*t277
      t295 = 1/t116*t277
      t300 = t118/t281*(-0.99709173929518D0*t288-0.7418564737168958D0
     #*t278-0.4002143174996817D0*t292-0.1264669550498372D0*t295)/t129
      t301 = 0.1D1*t300
      t305 = 0.8740794299481065D-3*t278*t143*t155*t163
      t306 = t139**2
      t319 = 0.1124999956683108D1*t134/t306*(-0.135956911724794D1*t288
     #-0.7491972878592054D0*t278-0.2150486235638321D0*t292
     #-0.1274341730084892D0*t295)/t142*t155*t163
      t320 = t146*t277
      t321 = 1.D0*t320
      t325 = 1.D0*t115
      t329 = 0.1333333333333333D1*t149*(t115-t321)
     #+0.1333333333333333D1*t153*(-t325+t320)
      t334 = t156*t146*t160
      t335 = 4.D0*t334
      t338 = t157/t159/t114
      t339 = 4.D0*t338
      t346 = t173**2
      t363 = 0.1923661050931536D1*(0.1321010150222857D-2*t278*t177
     #+0.1D1*t168/t346*(-0.1853395810515781D1*t288-0.128158207914907D1
     #*t278-0.8223668877838045D0*t292-0.1603914194192128D0*t295)/t176
     #-0.2747799777968419D-2*t279-0.1D1*t300)*t155*t161
      t367 = t181*t334
      t370 = 0.7694644203726145D1*t181*t338
      t384 = t193*t202
      t389 = t200/t201/t196
      s1 = -0.12407009817988D1*t4*t26-0.9305257363491D0*t5*
     #(0.5560213333333333D-2*t212*t13-0.2999402666666667D-3*t218*t23
     #+0.1110797653333333D-5*t225*t227)-0.3109D-1*t233*t55
     #+0.1321010150222857D-2*t237*t56
      vrhoa(i) = s1+0.1D1*t33*t241*t258*t259*t55-0.3109D-1*t33*t45*
     #(0.8331093333333333D0*t212*t48-0.5811136D0*t218*t52
     #+0.8289834666666667D-1*t225*t269)+(-t132+t166+t183+t114*(t280
     #+t301-t305-t319+0.3799574853701528D-1*t144*t329*t163
     #+0.3799574853701528D-1*t144*t155*(-t335+t339)+t363
     #+0.1923661050931536D1*t180*t329*t161+0.7694644203726145D1*t367
     #-t370)+0.3109D-1*t233-0.1321010150222857D-2*t237*t45-0.1D1*t33
     #*t241*t258*t259)*t205+t190*(-0.504216D-1*t212*t197+0.17397648D-2
     #*t384*t212-0.86234112D-5*t389*t212)
      t399 = sigmabb/t62/t61/rhob
      t405 = t71/t59/t72/t61
      t409 = t72**2
      t412 = t71*sigmabb/t409/rhob
      t414 = 1/t77/t67
      t420 = t87*t100
      t423 = 1/t94
      t424 = t84*t423
      t427 = t96**2
      t428 = 1/t427
      t430 = t89**2
      t431 = t430**2
      t434 = 1/t61
      t445 = -0.1853395810515781D1/t431/t89*t434-0.128158207914907D1
     #*t423*t434-0.8223668877838045D0/t92*t434-0.1603914194192128D0
     #/t85*t434
      t446 = 1/t99
      t456 = 1/t106/t102
      t469 = 0.1333333333333333D1*t149*(-t325-t321)
     #+0.1333333333333333D1*t153*(t115+t320)
      s1 = -0.12407009817988D1*t59*t81-0.9305257363491D0*t60*
     #(0.5560213333333333D-2*t399*t68-0.2999402666666667D-3*t405*t78
     #+0.1110797653333333D-5*t412*t414)-0.3109D-1*t420*t110
     #+0.1321010150222857D-2*t424*t111
      vrhob(i) = s1+0.1D1*t88*t428*t445*t446*t110-0.3109D-1*t88*t100*
     #(0.8331093333333333D0*t399*t103-0.5811136D0*t405*t107
     #+0.8289834666666667D-1*t412*t456)+(-t132+t166+t183+t114*(t280
     #+t301-t305-t319+0.3799574853701528D-1*t144*t469*t163
     #+0.3799574853701528D-1*t144*t155*(t335+t339)+t363
     #+0.1923661050931536D1*t180*t469*t161-0.7694644203726145D1*t367
     #-t370)+0.3109D-1*t420-0.1321010150222857D-2*t424*t100-0.1D1*t88
     #*t428*t445*t446)*t205+t190*(-0.504216D-1*t399*t197+0.17397648D-2
     #*t384*t399-0.86234112D-5*t389*t399)
      t502 = sigmaaa*t20
      t506 = t16/t222
      vsigmaaa(i) = -0.9305257363491D0*t5*(-0.208508D-2*t9*t13
     #+0.1124776D-3*t502*t23-0.41654912D-6*t506*t227)-0.3109D-1*t33
     #*t45*(-0.312416D0*t9*t48+0.2179176D0*t502*t52-0.3108688D-1*t506
     #*t269)+t190*(0.189081D-1*t9*t197-0.6524118D-3*t384*t9
     #+0.32337792D-5*t389*t9)
      vsigmaab(i) = 0.D0
      t532 = sigmabb*t75
      t536 = t71/t409
      vsigmabb(i) = -0.9305257363491D0*t60*(-0.208508D-2*t64*t68
     #+0.1124776D-3*t532*t78-0.41654912D-6*t536*t414)-0.3109D-1*t88
     #*t100*(-0.312416D0*t64*t103+0.2179176D0*t532*t107-0.3108688D-1
     #*t536*t456)+t190*(0.189081D-1*t64*t197-0.6524118D-3*t384*t64
     #+0.32337792D-5*t389*t64)
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t3 = t2*rhob
      t4 = rhob**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigmabb*t7
      t10 = 1.D0+0.4D-2*t8
      t11 = 1/t10
      t14 = sigmabb**2
      t15 = t4**2
      t18 = 1/t2/t15/rhob
      t19 = t14*t18
      t20 = t10**2
      t21 = 1/t20
      t24 = 0.108662D1-0.208508D-2*t8*t11+0.5206864D-4*t19*t21
      t27 = 1/rhob
      t28 = t27**(1.D0/3.D0)
      t30 = 1.D0+0.1274696188700087D0*t28
      t31 = rhob*t30
      t32 = t27**(1.D0/6.D0)
      t35 = dsqrt(t27)
      t37 = t28**2
      t39 = 0.1112037486309468D2*t32+0.3844746237447211D1*t28
     #+0.1644733775567609D1*t35+0.2405871291288192D0*t37
      t42 = 1.D0+0.321646831778707D2/t39
      t43 = dlog(t42)
      t45 = 1.D0+0.2D0*t8
      t46 = 1/t45
      t49 = t45**2
      t50 = 1/t49
      t53 = 0.2234D0-0.312416D0*t8*t46+0.777172D-1*t19*t50
      t54 = t43*t53
      zk(i) = -0.9305257363491D0*t3*t24-0.3109D-1*t31*t54
      vrhoa(i) = 0.D0
      t59 = t4*rhob
      t62 = sigmabb/t5/t59
      t68 = t14/t2/t15/t4
      t71 = t14*sigmabb
      t72 = t15**2
      t75 = t71/t72/rhob
      t77 = 1/t20/t10
      t80 = 0.5560213333333333D-2*t62*t11-0.2999402666666667D-3*t68
     #*t21+0.1110797653333333D-5*t75*t77
      t83 = t30*t43
      t86 = 1/t37
      t87 = t27*t86
      t90 = t39**2
      t91 = 1/t90
      t92 = t31*t91
      t93 = t32**2
      t94 = t93**2
      t95 = t94*t32
      t96 = 1/t95
      t97 = 1/t4
      t102 = 1/t35
      t105 = 1/t28
      t108 = -0.1853395810515781D1*t96*t97-0.128158207914907D1*t86*t97
     #-0.8223668877838045D0*t102*t97-0.1603914194192128D0*t105*t97
      t109 = 1/t42
      t110 = t108*t109
      t111 = t110*t53
      t119 = 1/t49/t45
      t122 = 0.8331093333333333D0*t62*t46-0.5811136D0*t68*t50
     #+0.8289834666666667D-1*t75*t119
      t123 = t43*t122
      vrhob(i) = -0.12407009817988D1*t2*t24-0.9305257363491D0*t3*t80
     #-0.3109D-1*t83*t53+0.1321010150222857D-2*t87*t54+0.1D1*t92*t111
     #-0.3109D-1*t31*t123
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      t128 = sigmabb*t18
      t131 = 1/t72
      t132 = t14*t131
      vsigmabb(i) = -0.9305257363491D0*t3*(-0.208508D-2*t7*t11
     #+0.1124776D-3*t128*t21-0.41654912D-6*t132*t77)-0.3109D-1*t31*t43
     #*(-0.312416D0*t7*t46+0.2179176D0*t128*t50-0.3108688D-1*t132*t119)
      v2rhoa2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t155 = sigmabb/t5/t15
      t161 = t14/t2/t15/t59
      t164 = t72*t4
      t166 = t71/t164
      t169 = t14**2
      t173 = t169/t5/t72/t15
      t174 = t20**2
      t175 = 1/t174
      t186 = 1/t59
      t188 = 1/t37/t27
      t200 = t108**2
      t207 = 1/t15
      t233 = t90**2
      t236 = t42**2
      t251 = t49**2
      t252 = 1/t251
      s1 = -0.4135669939329333D0/t5*t24-0.24814019635976D1*t2*t80
     #-0.9305257363491D0*t3*(-0.2038744888888889D-1*t155*t11
     #+0.1958930631111111D-2*t161*t21-0.1639590456888889D-4*t166*t77
     #+0.3554552490666667D-7*t173*t175)+0.2D1*t30*t91*t111-0.6218D-1
     #*t83*t122+0.8806734334819047D-3*t186*t188*t54
      v2rhob2(i) = s1-0.8497974591333914D-1*t87*t91*t111
     #+0.2642020300445714D-2*t87*t123-0.2D1*t31/t90/t39*t200*t109*t53
     #+0.1D1*t92*(-0.1544496508763151D1/t95/t27*t207
     #+0.3706791621031562D1*t96*t186-0.854388052766047D0*t188*t207
     #+0.2563164158298141D1*t86*t186-0.4111834438919023D0/t35/t27*t207
     #+0.1644733775567609D1*t102*t186-0.5346380647307093D-1/t28/t27
     #*t207+0.3207828388384256D0*t105*t186)*t109*t53
     #+0.321646831778707D2*t31/t233*t200/t236*t53+0.2D1*t92*t110*t122
     #-0.3109D-1*t31*t43*(-0.3054734222222222D1*t155*t46
     #+0.4124711111111111D1*t161*t50-0.1365939626666667D1*t166*t119
     #+0.1326373546666667D0*t173*t252)
      v2sigmaaa2(i) = 0.D0
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      t261 = sigmabb*t131
      t266 = t14/t5/t164
      v2sigmabb2(i) = -0.9305257363491D0*t3*(0.12081792D-3*t18*t21
     #-0.173291904D-5*t261*t77+0.499858944D-8*t266*t175)-0.3109D-1*t31
     #*t43*(0.2804008D0*t18*t50-0.1493408D0*t261*t119+0.18652128D-1
     #*t266*t252)
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t3 = t2*rhoa
      t4 = rhoa**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigmaaa*t7
      t10 = 1.D0+0.4D-2*t8
      t11 = 1/t10
      t14 = sigmaaa**2
      t15 = t4**2
      t18 = 1/t2/t15/rhoa
      t19 = t14*t18
      t20 = t10**2
      t21 = 1/t20
      t24 = 0.108662D1-0.208508D-2*t8*t11+0.5206864D-4*t19*t21
      t27 = 1/rhoa
      t28 = t27**(1.D0/3.D0)
      t30 = 1.D0+0.1274696188700087D0*t28
      t31 = rhoa*t30
      t32 = t27**(1.D0/6.D0)
      t35 = dsqrt(t27)
      t37 = t28**2
      t39 = 0.1112037486309468D2*t32+0.3844746237447211D1*t28
     #+0.1644733775567609D1*t35+0.2405871291288192D0*t37
      t42 = 1.D0+0.321646831778707D2/t39
      t43 = dlog(t42)
      t45 = 1.D0+0.2D0*t8
      t46 = 1/t45
      t49 = t45**2
      t50 = 1/t49
      t53 = 0.2234D0-0.312416D0*t8*t46+0.777172D-1*t19*t50
      t54 = t43*t53
      zk(i) = -0.9305257363491D0*t3*t24-0.3109D-1*t31*t54
      t59 = t4*rhoa
      t62 = sigmaaa/t5/t59
      t68 = t14/t2/t15/t4
      t71 = t14*sigmaaa
      t72 = t15**2
      t75 = t71/t72/rhoa
      t77 = 1/t20/t10
      t80 = 0.5560213333333333D-2*t62*t11-0.2999402666666667D-3*t68
     #*t21+0.1110797653333333D-5*t75*t77
      t83 = t30*t43
      t86 = 1/t37
      t87 = t27*t86
      t90 = t39**2
      t91 = 1/t90
      t92 = t31*t91
      t93 = t32**2
      t94 = t93**2
      t95 = t94*t32
      t96 = 1/t95
      t97 = 1/t4
      t102 = 1/t35
      t105 = 1/t28
      t108 = -0.1853395810515781D1*t96*t97-0.128158207914907D1*t86*t97
     #-0.8223668877838045D0*t102*t97-0.1603914194192128D0*t105*t97
      t109 = 1/t42
      t110 = t108*t109
      t111 = t110*t53
      t119 = 1/t49/t45
      t122 = 0.8331093333333333D0*t62*t46-0.5811136D0*t68*t50
     #+0.8289834666666667D-1*t75*t119
      t123 = t43*t122
      vrhoa(i) = -0.12407009817988D1*t2*t24-0.9305257363491D0*t3*t80
     #-0.3109D-1*t83*t53+0.1321010150222857D-2*t87*t54+0.1D1*t92*t111
     #-0.3109D-1*t31*t123
      vrhob(i) = 0.D0
      t128 = sigmaaa*t18
      t131 = 1/t72
      t132 = t14*t131
      vsigmaaa(i) = -0.9305257363491D0*t3*(-0.208508D-2*t7*t11
     #+0.1124776D-3*t128*t21-0.41654912D-6*t132*t77)-0.3109D-1*t31*t43
     #*(-0.312416D0*t7*t46+0.2179176D0*t128*t50-0.3108688D-1*t132*t119)
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      t155 = sigmaaa/t5/t15
      t161 = t14/t2/t15/t59
      t164 = t72*t4
      t166 = t71/t164
      t169 = t14**2
      t173 = t169/t5/t72/t15
      t174 = t20**2
      t175 = 1/t174
      t186 = 1/t59
      t188 = 1/t37/t27
      t200 = t108**2
      t207 = 1/t15
      t233 = t90**2
      t236 = t42**2
      t251 = t49**2
      t252 = 1/t251
      s1 = -0.4135669939329333D0/t5*t24-0.24814019635976D1*t2*t80
     #-0.9305257363491D0*t3*(-0.2038744888888889D-1*t155*t11
     #+0.1958930631111111D-2*t161*t21-0.1639590456888889D-4*t166*t77
     #+0.3554552490666667D-7*t173*t175)+0.2D1*t30*t91*t111-0.6218D-1
     #*t83*t122+0.8806734334819047D-3*t186*t188*t54
      v2rhoa2(i) = s1-0.8497974591333914D-1*t87*t91*t111
     #+0.2642020300445714D-2*t87*t123-0.2D1*t31/t90/t39*t200*t109*t53
     #+0.1D1*t92*(-0.1544496508763151D1/t95/t27*t207
     #+0.3706791621031562D1*t96*t186-0.854388052766047D0*t188*t207
     #+0.2563164158298141D1*t86*t186-0.4111834438919023D0/t35/t27*t207
     #+0.1644733775567609D1*t102*t186-0.5346380647307093D-1/t28/t27
     #*t207+0.3207828388384256D0*t105*t186)*t109*t53
     #+0.321646831778707D2*t31/t233*t200/t236*t53+0.2D1*t92*t110*t122
     #-0.3109D-1*t31*t43*(-0.3054734222222222D1*t155*t46
     #+0.4124711111111111D1*t161*t50-0.1365939626666667D1*t166*t119
     #+0.1326373546666667D0*t173*t252)
      v2rhob2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t261 = sigmaaa*t131
      t266 = t14/t5/t164
      v2sigmaaa2(i) = -0.9305257363491D0*t3*(0.12081792D-3*t18*t21
     #-0.173291904D-5*t261*t77+0.499858944D-8*t266*t175)-0.3109D-1*t31
     #*t43*(0.2804008D0*t18*t50-0.1493408D0*t261*t119+0.18652128D-1
     #*t266*t252)
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      v2sigmabb2(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t5 = t4*rhoa
      t6 = rhoa**2
      t7 = t4**2
      t9 = 1/t7/t6
      t10 = sigmaaa*t9
      t12 = 1.D0+0.4D-2*t10
      t13 = 1/t12
      t16 = sigmaaa**2
      t17 = t6**2
      t20 = 1/t4/t17/rhoa
      t21 = t16*t20
      t22 = t12**2
      t23 = 1/t22
      t26 = 0.108662D1-0.208508D-2*t10*t13+0.5206864D-4*t21*t23
      t29 = 1/rhoa
      t30 = t29**(1.D0/3.D0)
      t32 = 1.D0+0.1274696188700087D0*t30
      t33 = rhoa*t32
      t34 = t29**(1.D0/6.D0)
      t37 = dsqrt(t29)
      t39 = t30**2
      t41 = 0.1112037486309468D2*t34+0.3844746237447211D1*t30
     #+0.1644733775567609D1*t37+0.2405871291288192D0*t39
      t44 = 1.D0+0.321646831778707D2/t41
      t45 = dlog(t44)
      t47 = 1.D0+0.2D0*t10
      t48 = 1/t47
      t51 = t47**2
      t52 = 1/t51
      t55 = 0.2234D0-0.312416D0*t10*t48+0.777172D-1*t21*t52
      t56 = t45*t55
      t59 = rhob**(1.D0/3.D0)
      t60 = t59*rhob
      t61 = rhob**2
      t62 = t59**2
      t64 = 1/t62/t61
      t65 = sigmabb*t64
      t67 = 1.D0+0.4D-2*t65
      t68 = 1/t67
      t71 = sigmabb**2
      t72 = t61**2
      t75 = 1/t59/t72/rhob
      t76 = t71*t75
      t77 = t67**2
      t78 = 1/t77
      t81 = 0.108662D1-0.208508D-2*t65*t68+0.5206864D-4*t76*t78
      t84 = 1/rhob
      t85 = t84**(1.D0/3.D0)
      t87 = 1.D0+0.1274696188700087D0*t85
      t88 = rhob*t87
      t89 = t84**(1.D0/6.D0)
      t92 = dsqrt(t84)
      t94 = t85**2
      t96 = 0.1112037486309468D2*t89+0.3844746237447211D1*t85
     #+0.1644733775567609D1*t92+0.2405871291288192D0*t94
      t99 = 1.D0+0.321646831778707D2/t96
      t100 = dlog(t99)
      t102 = 1.D0+0.2D0*t65
      t103 = 1/t102
      t106 = t102**2
      t107 = 1/t106
      t110 = 0.2234D0-0.312416D0*t65*t103+0.777172D-1*t76*t107
      t111 = t100*t110
      t114 = rhoa+rhob
      t115 = 1/t114
      t116 = t115**(1.D0/3.D0)
      t118 = 1.D0+0.1325688999052018D0*t116
      t119 = t115**(1.D0/6.D0)
      t122 = dsqrt(t115)
      t124 = t116**2
      t126 = 0.598255043577108D1*t119+0.2225569421150687D1*t116
     #+0.8004286349993634D0*t122+0.1897004325747559D0*t124
      t129 = 1.D0+0.160818243221511D2/t126
      t130 = dlog(t129)
      t132 = 0.62182D-1*t118*t130
      t134 = 1.D0+0.6901399211255825D-1*t116
      t139 = 0.8157414703487641D1*t119+0.2247591863577616D1*t116
     #+0.4300972471276643D0*t122+0.1911512595127338D0*t124
      t142 = 1.D0+0.2960857464321668D2/t139
      t143 = dlog(t142)
      t144 = t134*t143
      t146 = rhoa-1.D0*rhob
      t147 = t146*t115
      t148 = 1.D0+t147
      t149 = t148**(1.D0/3.D0)
      t152 = 1.D0-1.D0*t147
      t153 = t152**(1.D0/3.D0)
      t155 = t149*t148+t153*t152-2.D0
      t156 = t146**2
      t157 = t156**2
      t158 = t114**2
      t159 = t158**2
      t160 = 1/t159
      t161 = t157*t160
      t163 = 1.D0-1.D0*t161
      t164 = t155*t163
      t166 = 0.3799574853701528D-1*t144*t164
      t168 = 1.D0+0.1274696188700087D0*t116
      t173 = 0.1112037486309468D2*t119+0.3844746237447211D1*t116
     #+0.1644733775567609D1*t122+0.2405871291288192D0*t124
      t176 = 1.D0+0.321646831778707D2/t173
      t177 = dlog(t176)
      t180 = -0.3109D-1*t168*t177+t132
      t181 = t180*t155
      t183 = 0.1923661050931536D1*t181*t161
      t190 = t114*(-t132+t166+t183)+0.3109D-1*t33*t45+0.3109D-1*t88*t100
      t193 = 0.5D0*t10+0.5D0*t65
      t196 = 1.D0+0.3D-2*t10+0.3D-2*t65
      t197 = 1/t196
      t200 = t193**2
      t201 = t196**2
      t202 = 1/t201
      t205 = 0.69041D0+0.378162D-1*t193*t197-0.5389632D-3*t200*t202
      zk(i) = -0.9305257363491D0*t5*t26-0.3109D-1*t33*t56
     #-0.9305257363491D0*t60*t81-0.3109D-1*t88*t111+t190*t205
      t209 = t6*rhoa
      t211 = 1/t7/t209
      t212 = sigmaaa*t211
      t217 = 1/t4/t17/t6
      t218 = t16*t217
      t221 = t16*sigmaaa
      t222 = t17**2
      t224 = 1/t222/rhoa
      t225 = t221*t224
      t227 = 1/t22/t12
      t230 = 0.5560213333333333D-2*t212*t13-0.2999402666666667D-3*t218
     #*t23+0.1110797653333333D-5*t225*t227
      t233 = t32*t45
      t236 = 1/t39
      t237 = t29*t236
      t240 = t41**2
      t241 = 1/t240
      t242 = t33*t241
      t243 = t34**2
      t244 = t243**2
      t245 = t244*t34
      t246 = 1/t245
      t247 = 1/t6
      t252 = 1/t37
      t255 = 1/t30
      t258 = -0.1853395810515781D1*t246*t247-0.128158207914907D1*t236
     #*t247-0.8223668877838045D0*t252*t247-0.1603914194192128D0*t255
     #*t247
      t259 = 1/t44
      t260 = t258*t259
      t261 = t260*t55
      t269 = 1/t51/t47
      t272 = 0.8331093333333333D0*t212*t48-0.5811136D0*t218*t52
     #+0.8289834666666667D-1*t225*t269
      t273 = t45*t272
      t276 = 1/t124
      t277 = 1/t158
      t278 = t276*t277
      t279 = t278*t130
      t280 = 0.2747799777968419D-2*t279
      t281 = t126**2
      t282 = 1/t281
      t283 = t118*t282
      t284 = t119**2
      t285 = t284**2
      t286 = t285*t119
      t287 = 1/t286
      t288 = t287*t277
      t291 = 1/t122
      t292 = t291*t277
      t294 = 1/t116
      t295 = t294*t277
      t297 = -0.99709173929518D0*t288-0.7418564737168958D0*t278
     #-0.4002143174996817D0*t292-0.1264669550498372D0*t295
      t298 = 1/t129
      t300 = t283*t297*t298
      t301 = 0.1D1*t300
      t302 = t143*t155
      t303 = t302*t163
      t304 = t278*t303
      t305 = 0.8740794299481065D-3*t304
      t306 = t139**2
      t307 = 1/t306
      t308 = t134*t307
      t313 = -0.135956911724794D1*t288-0.7491972878592054D0*t278
     #-0.2150486235638321D0*t292-0.1274341730084892D0*t295
      t314 = t308*t313
      t315 = 1/t142
      t316 = t315*t155
      t317 = t316*t163
      t318 = t314*t317
      t319 = 0.1124999956683108D1*t318
      t320 = t146*t277
      t321 = 1.D0*t320
      t322 = t115-t321
      t325 = 1.D0*t115
      t326 = -t325+t320
      t329 = 0.1333333333333333D1*t149*t322+0.1333333333333333D1*t153
     #*t326
      t331 = t144*t329*t163
      t332 = 0.3799574853701528D-1*t331
      t333 = t156*t146
      t334 = t333*t160
      t335 = 4.D0*t334
      t337 = 1/t159/t114
      t338 = t157*t337
      t339 = 4.D0*t338
      t340 = -t335+t339
      t342 = t144*t155*t340
      t343 = 0.3799574853701528D-1*t342
      t346 = t173**2
      t347 = 1/t346
      t348 = t168*t347
      t353 = -0.1853395810515781D1*t288-0.128158207914907D1*t278
     #-0.8223668877838045D0*t292-0.1603914194192128D0*t295
      t354 = 1/t176
      t360 = 0.1321010150222857D-2*t278*t177+0.1D1*t348*t353*t354
     #-0.2747799777968419D-2*t279-0.1D1*t300
      t361 = t360*t155
      t362 = t361*t161
      t363 = 0.1923661050931536D1*t362
      t364 = t180*t329
      t365 = t364*t161
      t366 = 0.1923661050931536D1*t365
      t367 = t181*t334
      t369 = t181*t338
      t370 = 0.7694644203726145D1*t369
      t377 = t241*t258*t259
      t380 = -t132+t166+t183+t114*(t280+t301-t305-t319+t332+t343+t363
     #+t366+0.7694644203726145D1*t367-t370)+0.3109D-1*t233
     #-0.1321010150222857D-2*t237*t45-0.1D1*t33*t377
      t384 = t193*t202
      t388 = 1/t201/t196
      t389 = t200*t388
      t392 = -0.504216D-1*t212*t197+0.17397648D-2*t384*t212
     #-0.86234112D-5*t389*t212
      vrhoa(i) = -0.12407009817988D1*t4*t26-0.9305257363491D0*t5*t230
     #-0.3109D-1*t233*t55+0.1321010150222857D-2*t237*t56+0.1D1*t242
     #*t261-0.3109D-1*t33*t273+t380*t205+t190*t392
      t396 = t61*rhob
      t398 = 1/t62/t396
      t399 = sigmabb*t398
      t404 = 1/t59/t72/t61
      t405 = t71*t404
      t408 = t71*sigmabb
      t409 = t72**2
      t411 = 1/t409/rhob
      t412 = t408*t411
      t414 = 1/t77/t67
      t417 = 0.5560213333333333D-2*t399*t68-0.2999402666666667D-3*t405
     #*t78+0.1110797653333333D-5*t412*t414
      t420 = t87*t100
      t423 = 1/t94
      t424 = t84*t423
      t427 = t96**2
      t428 = 1/t427
      t429 = t88*t428
      t430 = t89**2
      t431 = t430**2
      t432 = t431*t89
      t433 = 1/t432
      t434 = 1/t61
      t439 = 1/t92
      t442 = 1/t85
      t445 = -0.1853395810515781D1*t433*t434-0.128158207914907D1*t423
     #*t434-0.8223668877838045D0*t439*t434-0.1603914194192128D0*t442
     #*t434
      t446 = 1/t99
      t447 = t445*t446
      t448 = t447*t110
      t456 = 1/t106/t102
      t459 = 0.8331093333333333D0*t399*t103-0.5811136D0*t405*t107
     #+0.8289834666666667D-1*t412*t456
      t460 = t100*t459
      t463 = -t325-t321
      t466 = t115+t320
      t469 = 0.1333333333333333D1*t149*t463+0.1333333333333333D1*t153
     #*t466
      t471 = t144*t469*t163
      t472 = 0.3799574853701528D-1*t471
      t473 = t335+t339
      t475 = t144*t155*t473
      t476 = 0.3799574853701528D-1*t475
      t477 = t180*t469
      t478 = t477*t161
      t479 = 0.1923661050931536D1*t478
      t487 = t428*t445*t446
      t490 = -t132+t166+t183+t114*(t280+t301-t305-t319+t472+t476+t363
     #+t479-0.7694644203726145D1*t367-t370)+0.3109D-1*t420
     #-0.1321010150222857D-2*t424*t100-0.1D1*t88*t487
      t498 = -0.504216D-1*t399*t197+0.17397648D-2*t384*t399
     #-0.86234112D-5*t389*t399
      vrhob(i) = -0.12407009817988D1*t59*t81-0.9305257363491D0*t60
     #*t417-0.3109D-1*t420*t110+0.1321010150222857D-2*t424*t111+0.1D1
     #*t429*t448-0.3109D-1*t88*t460+t490*t205+t190*t498
      t502 = sigmaaa*t20
      t505 = 1/t222
      t506 = t16*t505
      t509 = -0.208508D-2*t9*t13+0.1124776D-3*t502*t23-0.41654912D-6
     #*t506*t227
      t518 = -0.312416D0*t9*t48+0.2179176D0*t502*t52-0.3108688D-1*t506
     #*t269
      t519 = t45*t518
      t528 = 0.189081D-1*t9*t197-0.6524118D-3*t384*t9+0.32337792D-5
     #*t389*t9
      vsigmaaa(i) = -0.9305257363491D0*t5*t509-0.3109D-1*t33*t519+t190
     #*t528
      vsigmaab(i) = 0.D0
      t532 = sigmabb*t75
      t535 = 1/t409
      t536 = t71*t535
      t539 = -0.208508D-2*t64*t68+0.1124776D-3*t532*t78-0.41654912D-6
     #*t536*t414
      t548 = -0.312416D0*t64*t103+0.2179176D0*t532*t107-0.3108688D-1
     #*t536*t456
      t549 = t100*t548
      t558 = 0.189081D-1*t64*t197-0.6524118D-3*t384*t64+0.32337792D-5
     #*t389*t64
      vsigmabb(i) = -0.9305257363491D0*t60*t539-0.3109D-1*t88*t549
     #+t190*t558
      t560 = 1/t209
      t562 = 1/t39/t29
      t563 = t560*t562
      t570 = 1/t240/t41
      t572 = t258**2
      t579 = 1/t17
      t600 = -0.1544496508763151D1/t245/t29*t579+0.3706791621031562D1
     #*t246*t560-0.854388052766047D0*t562*t579+0.2563164158298141D1
     #*t236*t560-0.4111834438919023D0/t37/t29*t579
     #+0.1644733775567609D1*t252*t560-0.5346380647307093D-1/t30/t29
     #*t579+0.3207828388384256D0*t255*t560
      t607 = sigmaaa/t7/t17
      t613 = t16/t4/t17/t209
      t616 = t193*t388
      t621 = t201**2
      t623 = t200/t621
      t630 = t240**2
      t631 = 1/t630
      t633 = t44**2
      t634 = 1/t633
      t643 = t222*t6
      t645 = t221/t643
      t648 = t16**2
      t652 = t648/t7/t222/t17
      t653 = t51**2
      t654 = 1/t653
      t663 = t32*t241
      t672 = 0.1748158859896213D-2*t304
      t674 = 0.2249999913366216D1*t318
      t675 = 0.3847322101863073D1*t362
      t676 = 0.2D1*t300
      t678 = 0.1538928840745229D2*t369
      t694 = 1/t286/t115*t160
      t697 = 1/t158/t114
      t698 = t287*t697
      t702 = 1/t124/t115*t160
      t704 = t276*t697
      t708 = 1/t122/t115*t160
      t710 = t291*t697
      t714 = 1/t116/t115*t160
      t716 = t294*t697
      t720 = t283*(-0.8309097827459833D0*t694+0.199418347859036D1*t698
     #-0.4945709824779306D0*t702+0.1483712947433792D1*t704
     #-0.2001071587498409D0*t708+0.8004286349993634D0*t710
     #-0.4215565168327908D-1*t714+0.2529339100996745D0*t716)*t298
      t721 = 0.1D1*t720
      t722 = t281**2
      t725 = t297**2
      t726 = t129**2
      t729 = t118/t722*t725/t726
      t730 = 0.160818243221511D2*t729
      t742 = t353**2
      t758 = t346**2
      t761 = t176**2
      t766 = t702*t130
      t768 = t704*t130
      t772 = t278*t282*t297*t298
      t778 = t118/t281/t126*t725*t298
      t782 = 0.8806734334819047D-3*t702*t177-0.2642020300445714D-2
     #*t704*t177-0.8497974591333914D-1*t278*t347*t353*t354-0.2D1*t168
     #/t346/t173*t742*t354+0.1D1*t348*(-0.1544496508763151D1*t694
     #+0.3706791621031562D1*t698-0.854388052766047D0*t702
     #+0.2563164158298141D1*t704-0.4111834438919023D0*t708
     #+0.1644733775567609D1*t710-0.5346380647307093D-1*t714
     #+0.3207828388384256D0*t716)*t354+0.321646831778707D2*t168/t758
     #*t742/t761-0.1831866518645613D-2*t766+0.5495599555936838D-2*t768
     #+0.8837926660346786D-1*t772+0.2D1*t778-0.1D1*t720
     #-0.160818243221511D2*t729
      t785 = 0.1923661050931536D1*t782*t155*t161
      t786 = 0.5495599555936838D-2*t768
      t787 = 0.8837926660346786D-1*t772
      t799 = 0.1124999956683108D1*t308*(-0.1132974264373283D1*t694
     #+0.271913823449588D1*t698-0.4994648585728036D0*t702
     #+0.1498394575718411D1*t704-0.1075243117819161D0*t708
     #+0.4300972471276643D0*t710-0.4247805766949639D-1*t714
     #+0.2548683460169784D0*t716)*t317
      t800 = 0.1831866518645613D-2*t766
      t801 = t306**2
      t804 = t313**2
      t806 = t142**2
      t811 = 0.3330964519106732D2*t134/t801*t804/t806*t155*t163
      t814 = t278*t143*t329*t163
      t817 = 0.5827196199654043D-3*t702*t303
      t818 = 0.2D1*t778
      t820 = 0.1748158859896213D-2*t704*t303
      t822 = t278*t302*t340
      t828 = 0.5176049209143758D-1*t278*t307*t313*t315*t164
      t829 = t721+t730+t785-t786-t787-t799+t800-t811
     #-0.1748158859896213D-2*t814-t817-t818+t820-0.1748158859896213D-2
     #*t822+t828
      t831 = t314*t316*t340
      t835 = t314*t315*t329*t163
      t838 = t360*t329*t161
      t840 = t156*t160
      t841 = 12.D0*t840
      t842 = t333*t337
      t843 = 32.D0*t842
      t846 = t157/t159/t158
      t847 = 20.D0*t846
      t853 = 0.3847322101863073D2*t181*t846
      t854 = t181*t840
      t855 = 0.2308393261117844D2*t854
      t856 = t181*t842
      t859 = 0.1538928840745229D2*t361*t338
      t860 = t149**2
      t861 = 1/t860
      t862 = t322**2
      t865 = 2.D0*t277
      t867 = 2.D0*t146*t697
      t868 = -t865+t867
      t871 = t153**2
      t872 = 1/t871
      t873 = t326**2
      t879 = 0.4444444444444444D0*t861*t862+0.1333333333333333D1*t149
     #*t868+0.4444444444444444D0*t872*t873-0.1333333333333333D1*t153
     #*t868
      t889 = t364*t334
      t891 = t364*t338
      t893 = t361*t334
      t900 = 0.2249999913366216D1*t134/t306/t139*t804*t317
      t901 = -0.2249999913366216D1*t831-0.2249999913366216D1*t835
     #+0.3847322101863073D1*t838+0.3799574853701528D-1*t144*t155*(
     #-t841+t843-t847)+t853+t855-0.6155715362980916D2*t856-t859
     #+0.3799574853701528D-1*t144*t879*t163+0.7599149707403056D-1*t144
     #*t329*t340+0.1923661050931536D1*t180*t879*t161
     #+0.1538928840745229D2*t889-0.1538928840745229D2*t891
     #+0.1538928840745229D2*t893+t900
      t904 = 0.5495599555936838D-2*t279
      t911 = 0.7599149707403056D-1*t342-t672+0.3847322101863073D1*t365
     #-t674+t675+t676+0.1538928840745229D2*t367-t678
     #+0.7599149707403056D-1*t331-0.321646831778707D2*t33*t631*t572
     #*t634-0.8806734334819047D-3*t563*t45+0.8497974591333914D-1*t237
     #*t377+0.2D1*t33*t570*t572*t259+t114*(t829+t901)+t904-0.2D1*t663
     #*t260-0.1D1*t33*t241*t600*t259
      t924 = t22**2
      t925 = 1/t924
      s1 = 0.8806734334819047D-3*t563*t56-0.8497974591333914D-1*t237
     #*t241*t261-0.2D1*t33*t570*t572*t259*t55+0.1D1*t242*t600*t259*t55
     #+t190*(0.1848792D0*t607*t197-0.27230592D-2*t613*t202+0.50832D-4
     #*t616*t613-0.63791376D-2*t384*t607-0.2069618688D-6*t623*t613
     #+0.316191744D-4*t389*t607)+0.321646831778707D2*t33*t631*t572
     #*t634*t55-0.3109D-1*t33*t45*(-0.3054734222222222D1*t607*t48
     #+0.4124711111111111D1*t613*t52-0.1365939626666667D1*t645*t269
     #+0.1326373546666667D0*t652*t654)+2.D0*t380*t392
      v2rhoa2(i) = s1+0.2D1*t663*t261+0.2642020300445714D-2*t237*t273
     #+0.2D1*t242*t260*t272+t911*t205-0.4135669939329333D0/t7*t26
     #-0.24814019635976D1*t4*t230-0.9305257363491D0*t5*(
     #-0.2038744888888889D-1*t607*t13+0.1958930631111111D-2*t613*t23
     #-0.1639590456888889D-4*t645*t227+0.3554552490666667D-7*t652*t925
     #)-0.6218D-1*t233*t272
      t935 = 1/t427/t96
      t936 = t445**2
      t941 = 1/t396
      t943 = 1/t94/t84
      t944 = t941*t943
      t951 = 1/t72
      t972 = -0.1544496508763151D1/t432/t84*t951+0.3706791621031562D1
     #*t433*t941-0.854388052766047D0*t943*t951+0.2563164158298141D1
     #*t423*t941-0.4111834438919023D0/t92/t84*t951
     #+0.1644733775567609D1*t439*t941-0.5346380647307093D-1/t85/t84
     #*t951+0.3207828388384256D0*t442*t941
      t978 = t87*t428
      t984 = t360*t469*t161
      t990 = t463**2
      t993 = t865+t867
      t996 = t466**2
      t1002 = 0.4444444444444444D0*t861*t990+0.1333333333333333D1*t149
     #*t993+0.4444444444444444D0*t872*t996-0.1333333333333333D1*t153
     #*t993
      t1013 = t314*t316*t473
      t1015 = t721+t730+t785-t786-t787-t799+t800+0.3847322101863073D1
     #*t984+0.3799574853701528D-1*t144*t155*(-t841-t843-t847)
     #+0.1923661050931536D1*t180*t1002*t161+0.3799574853701528D-1*t144
     #*t1002*t163+0.7599149707403056D-1*t144*t469*t473-t811
     #-0.2249999913366216D1*t1013
      t1018 = t278*t143*t469*t163
      t1021 = t278*t302*t473
      t1027 = t314*t315*t469*t163
      t1029 = t477*t338
      t1031 = t477*t334
      t1033 = -t817-t818+t820+t828-0.1748158859896213D-2*t1018
     #-0.1748158859896213D-2*t1021+t853+t855+0.6155715362980916D2*t856
     #-t859-0.1538928840745229D2*t893-0.2249999913366216D1*t1027
     #-0.1538928840745229D2*t1029-0.1538928840745229D2*t1031+t900
      t1036 = t427**2
      t1037 = 1/t1036
      t1039 = t99**2
      t1040 = 1/t1039
      t1044 = -t672-t674+t675+t676-0.1538928840745229D2*t367-t678
     #+0.2D1*t88*t935*t936*t446-0.8806734334819047D-3*t944*t100
     #+0.8497974591333914D-1*t424*t487-0.1D1*t88*t428*t972*t446
     #+0.3847322101863073D1*t478-0.2D1*t978*t447+t904
     #+0.7599149707403056D-1*t471+0.7599149707403056D-1*t475+t114*
     #(t1015+t1033)-0.321646831778707D2*t88*t1037*t936*t1040
      t1053 = sigmabb/t62/t72
      t1059 = t71/t59/t72/t396
      t1062 = t409*t61
      t1064 = t408/t1062
      t1067 = t71**2
      t1071 = t1067/t62/t409/t72
      t1072 = t106**2
      t1073 = 1/t1072
      t1091 = t77**2
      t1092 = 1/t1091
      s1 = t1044*t205+0.321646831778707D2*t88*t1037*t936*t1040*t110
     #-0.3109D-1*t88*t100*(-0.3054734222222222D1*t1053*t103
     #+0.4124711111111111D1*t1059*t107-0.1365939626666667D1*t1064*t456
     #+0.1326373546666667D0*t1071*t1073)-0.4135669939329333D0/t62*t81
     #-0.24814019635976D1*t59*t417-0.9305257363491D0*t60*(
     #-0.2038744888888889D-1*t1053*t68+0.1958930631111111D-2*t1059*t78
     #-0.1639590456888889D-4*t1064*t414+0.3554552490666667D-7*t1071
     #*t1092)+0.1D1*t429*t972*t446*t110+0.2D1*t978*t448
      v2rhob2(i) = s1+2.D0*t490*t498+t190*(0.1848792D0*t1053*t197
     #-0.27230592D-2*t1059*t202+0.50832D-4*t616*t1059-0.63791376D-2
     #*t384*t1053-0.2069618688D-6*t623*t1059+0.316191744D-4*t389*t1053
     #)+0.8806734334819047D-3*t944*t111-0.8497974591333914D-1*t424
     #*t428*t448-0.2D1*t88*t935*t936*t446*t110+0.2D1*t429*t447*t459
     #+0.2642020300445714D-2*t424*t460-0.6218D-1*t420*t459
      t1149 = 0.4444444444444444D0*t861*t322*t463+0.2666666666666667D1
     #*t149*t146*t697+0.4444444444444444D0*t872*t326*t466
     #-0.2666666666666667D1*t153*t146*t697
      t1160 = t721+t730+t785-t786-t787+0.3799574853701528D-1*t144
     #*t1149*t163+0.3799574853701528D-1*t144*t329*t473-t799+t800
     #+0.1923661050931536D1*t984-t811-0.1124999956683108D1*t1013
     #-0.8740794299481065D-3*t814-t817-t818+t820-0.8740794299481065D-3
     #*t822
      t1182 = t828-0.8740794299481065D-3*t1018-0.1124999956683108D1
     #*t831+0.3799574853701528D-1*t144*t469*t340+0.3799574853701528D-1
     #*t144*t155*(t841-t847)-0.8740794299481065D-3*t1021
     #-0.1124999956683108D1*t835+0.1923661050931536D1*t838
     #+0.1923661050931536D1*t180*t1149*t161+t853-0.2308393261117844D2
     #*t854-t859-0.7694644203726145D1*t889-0.7694644203726145D1*t891
     #-0.1124999956683108D1*t1027-0.7694644203726145D1*t1029
     #+0.7694644203726145D1*t1031+t900
      t1185 = t904+t676-t672-t674+t472+t476+t675+t479-t678+t332+t343
     #+t366+t114*(t1160+t1182)
      t1195 = t211*sigmabb*t398
      v2rhoab(i) = t1185*t205+t380*t498+t490*t392+t190*(-0.27230592D-2
     #*t212*t202*sigmabb*t398+0.50832D-4*t616*sigmaaa*t1195
     #-0.2069618688D-6*t623*sigmaaa*t1195)
      t1207 = sigmaaa*t217
      t1210 = t16*t224
      t1216 = t221/t7/t222/t209
      v2rhoasigmaaa(i) = -0.12407009817988D1*t4*t509-0.9305257363491D0
     #*t5*(0.5560213333333333D-2*t211*t13-0.6221213866666667D-3*t1207
     #*t23+0.5731915093333333D-5*t1210*t227-0.1332957184D-7*t1216*t925
     #)-0.3109D-1*t233*t518+0.1321010150222857D-2*t237*t519+0.1D1*t242
     #*t260*t518-0.3109D-1*t33*t45*(0.8331093333333333D0*t211*t48
     #-0.1328849066666667D1*t1207*t52+0.48114048D0*t1210*t269
     #-0.49739008D-1*t1216*t654)+t380*t528+t190*(-0.504216D-1*t211
     #*t197+0.10211472D-2*t1207*t202-0.19062D-4*t616*t1207
     #+0.17397648D-2*t384*t211+0.776107008D-7*t623*t1207-0.86234112D-5
     #*t389*t211)
      v2rhoasigmaab(i) = 0.D0
      t1260 = t212*t64
      v2rhoasigmabb(i) = t380*t558+t190*(0.10211472D-2*t212*t202*t64
     #-0.19062D-4*t616*t1260+0.776107008D-7*t623*t1260)
      t1268 = t202*t9
      t1271 = t399*t9
      v2rhobsigmaaa(i) = t490*t528+t190*(0.10211472D-2*t399*t1268
     #-0.19062D-4*t616*t1271+0.776107008D-7*t623*t1271)
      v2rhobsigmaab(i) = 0.D0
      t1282 = sigmabb*t404
      t1285 = t71*t411
      t1291 = t408/t62/t409/t396
      v2rhobsigmabb(i) = -0.12407009817988D1*t59*t539
     #-0.9305257363491D0*t60*(0.5560213333333333D-2*t398*t68
     #-0.6221213866666667D-3*t1282*t78+0.5731915093333333D-5*t1285
     #*t414-0.1332957184D-7*t1291*t1092)-0.3109D-1*t420*t548
     #+0.1321010150222857D-2*t424*t549+0.1D1*t429*t447*t548-0.3109D-1
     #*t88*t100*(0.8331093333333333D0*t398*t103-0.1328849066666667D1
     #*t1282*t107+0.48114048D0*t1285*t456-0.49739008D-1*t1291*t1073)
     #+t490*t558+t190*(-0.504216D-1*t398*t197+0.10211472D-2*t1282*t202
     #-0.19062D-4*t616*t1282+0.17397648D-2*t384*t398+0.776107008D-7
     #*t623*t1282-0.86234112D-5*t389*t398)
      t1333 = sigmaaa*t505
      t1338 = t16/t7/t643
      v2sigmaaa2(i) = -0.9305257363491D0*t5*(0.12081792D-3*t20*t23
     #-0.173291904D-5*t1333*t227+0.499858944D-8*t1338*t925)-0.3109D-1
     #*t33*t45*(0.2804008D0*t20*t52-0.1493408D0*t1333*t269
     #+0.18652128D-1*t1338*t654)+t190*(-0.3829302D-3*t20*t202
     #+0.714825D-5*t616*t20-0.291040128D-7*t623*t20)
      v2sigmaaaab(i) = 0.D0
      t1364 = t9*t64
      v2sigmaaabb(i) = t190*(-0.3829302D-3*t1268*t64+0.714825D-5*t616
     #*t1364-0.291040128D-7*t623*t1364)
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      t1372 = sigmabb*t535
      t1377 = t71/t62/t1062
      v2sigmabb2(i) = -0.9305257363491D0*t60*(0.12081792D-3*t75*t78
     #-0.173291904D-5*t1372*t414+0.499858944D-8*t1377*t1092)-0.3109D-1
     #*t88*t100*(0.2804008D0*t75*t107-0.1493408D0*t1372*t456
     #+0.18652128D-1*t1377*t1073)+t190*(-0.3829302D-3*t75*t202
     #+0.714825D-5*t616*t75-0.291040128D-7*t623*t75)
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      v2rhob2(i) = 0.0d0
      v2rhoab(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2rhoasigmaab(i) = 0.0d0
      v2rhoasigmabb(i) = 0.0d0
      v2rhobsigmaaa(i) = 0.0d0
      v2rhobsigmaab(i) = 0.0d0
      v2rhobsigmabb(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      v2sigmaab2(i) = 0.0d0
      v2sigmabb2(i) = 0.0d0
      v2sigmaaaab(i) = 0.0d0
      v2sigmaaabb(i) = 0.0d0
      v2sigmaabbb(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end
      
      
      subroutine rks_xc_b97_d
     & (ideriv,npt,rhoa1,sigmaaa1,
     &  zk,vrhoa,vsigmaaa,
     &  v2rhoa2,v2rhoasigmaaa,v2sigmaaa2)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt)
      REAL sigmaaa1(npt)
      REAL zk(npt),vrhoa(npt),vsigmaaa(npt)
      REAL v2rhoa2(npt),v2rhoasigmaaa(npt),v2sigmaaa2(npt)
      parameter(tol=1.0d-20)
      
      if(ideriv.eq.0) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t4 = rho**2
      t5 = t2**2
      t8 = sigma/t5/t4
      t10 = 1.D0+0.6349604207872798D-2*t8
      t14 = sigma**2
      t15 = t4**2
      t19 = t14/t2/t15/rho
      t20 = t10**2
      t27 = 1/rho
      t28 = t27**(1.D0/3.D0)
      t31 = rho*(1.D0+0.1606016560364007D0*t28)
      t32 = t27**(1.D0/6.D0)
      t35 = dsqrt(t27)
      t37 = t28**2
      t43 = dlog(1.D0+0.321646831778707D2/(0.1248219874679732D2*t32
     #+0.4844076716063854D1*t28+0.2326004811900819D1*t35
     #+0.3819082618690966D0*t37))
      t45 = 1.D0+0.3174802103936399D0*t8
      t49 = t45**2
      t68 = dlog(1.D0+0.160818243221511D2/(0.598255043577108D1*t32
     #+0.2225569421150687D1*t28+0.8004286349993634D0*t35
     #+0.1897004325747559D0*t37))
      t75 = 1.D0+0.9524406311809197D-2*t8
      t79 = t75**2
      zk(i) = -0.7385587663820224D0*t2*rho*(0.108662D1
     #-0.3309858185437853D-2*t8/t10+0.1312047511507964D-3*t19/t20)
     #-0.3109D-1*t31*t43*(0.2234D0-0.495929487051697D0*t8/t45
     #+0.1958350724377797D0*t19/t49)+(-0.62182D-1*rho*(1.D0
     #+0.1325688999052018D0*t28)*t68+0.3109D-1*t31*t43)*(0.69041D0
     #+0.6002947566143982D-1*t8/t75-0.1358102161597401D-2*t19/t79)
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t3 = t2*rho
      t4 = rho**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigma*t7
      t10 = 1.D0+0.6349604207872798D-2*t8
      t11 = 1/t10
      t14 = sigma**2
      t15 = t4**2
      t18 = 1/t2/t15/rho
      t19 = t14*t18
      t20 = t10**2
      t21 = 1/t20
      t24 = 0.108662D1-0.3309858185437853D-2*t8*t11
     #+0.1312047511507964D-3*t19*t21
      t27 = 1/rho
      t28 = t27**(1.D0/3.D0)
      t30 = 1.D0+0.1606016560364007D0*t28
      t31 = rho*t30
      t32 = t27**(1.D0/6.D0)
      t35 = dsqrt(t27)
      t37 = t28**2
      t39 = 0.1248219874679732D2*t32+0.4844076716063854D1*t28
     #+0.2326004811900819D1*t35+0.3819082618690966D0*t37
      t42 = 1.D0+0.321646831778707D2/t39
      t43 = dlog(t42)
      t45 = 1.D0+0.3174802103936399D0*t8
      t46 = 1/t45
      t49 = t45**2
      t50 = 1/t49
      t53 = 0.2234D0-0.495929487051697D0*t8*t46+0.1958350724377797D0
     #*t19*t50
      t54 = t43*t53
      t58 = 1.D0+0.1325688999052018D0*t28
      t64 = 0.598255043577108D1*t32+0.2225569421150687D1*t28
     #+0.8004286349993634D0*t35+0.1897004325747559D0*t37
      t67 = 1.D0+0.160818243221511D2/t64
      t68 = dlog(t67)
      t73 = -0.62182D-1*rho*t58*t68+0.3109D-1*t31*t43
      t75 = 1.D0+0.9524406311809197D-2*t8
      t76 = 1/t75
      t79 = t75**2
      t80 = 1/t79
      t83 = 0.69041D0+0.6002947566143982D-1*t8*t76
     #-0.1358102161597401D-2*t19*t80
      zk(i) = -0.7385587663820224D0*t3*t24-0.3109D-1*t31*t54+t73*t83
      t90 = sigma/t5/t4/rho
      t96 = t14/t2/t15/t4
      t100 = t15**2
      t103 = t14*sigma/t100/rho
      t105 = 1/t20/t10
      t111 = t30*t43
      t114 = 1/t37
      t115 = t27*t114
      t118 = t39**2
      t119 = 1/t118
      t121 = t32**2
      t122 = t121**2
      t125 = 1/t4
      t126 = 1/t122/t32*t125
      t128 = t114*t125
      t131 = 1/t35*t125
      t134 = 1/t28*t125
      t136 = -0.4160732915599108D1*t126-0.3229384477375903D1*t128
     #-0.2326004811900819D1*t131-0.5092110158254621D0*t134
      t137 = 1/t42
      t147 = 1/t49/t45
      t158 = t64**2
      t186 = 1/t79/t75
      vrhoa(i) = -0.9847450218426965D0*t2*t24-0.3692793831910112D0*t3*
     #(0.1765257698900188D-1*t90*t11-0.151160422273766D-2*t96*t21
     #+0.8886381226666667D-5*t103*t105)-0.3109D-1*t111*t53
     #+0.1664368495390566D-2*t115*t54+0.5D0*t31*t119*t136*t137*t53
     #-0.15545D-1*t31*t43*(0.2644957264275717D1*t90*t46
     #-0.2928629028080757D1*t96*t50+0.6631867733333333D0*t103*t147)+(
     #-0.62182D-1*t58*t68+rho*(0.2747799777968419D-2*t128*t68+0.1D1
     #*t58/t158*(-0.99709173929518D0*t126-0.7418564737168958D0*t128
     #-0.4002143174996817D0*t131-0.1264669550498372D0*t134)/t67)
     #+0.3109D-1*t111-0.1664368495390566D-2*t115*t43-0.5D0*t31*t119
     #*t136*t137)*t83+t73*(-0.1600786017638395D0*t90*t76
     #+0.8767865173544576D-2*t96*t80-0.689872896D-4*t103*t186)
      t193 = sigma*t18
      t197 = t14/t100
      vsigmaaa(i) = -0.7385587663820224D0*t3*(-0.1323943274175141D-1
     #*t7*t11+0.1133703167053245D-2*t193*t21-0.666478592D-5*t197*t105)
     #-0.3109D-1*t31*t43*(-0.1983717948206788D1*t7*t46
     #+0.2196471771060568D1*t193*t50-0.49739008D0*t197*t147)+2.D0*t73*
     #(0.1200589513228796D0*t7*t76-0.6575898880158432D-2*t193*t80
     #+0.517404672D-4*t197*t186)
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t3 = t2*rho
      t4 = rho**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigma*t7
      t10 = 1.D0+0.6349604207872798D-2*t8
      t11 = 1/t10
      t14 = sigma**2
      t15 = t4**2
      t18 = 1/t2/t15/rho
      t19 = t14*t18
      t20 = t10**2
      t21 = 1/t20
      t24 = 0.108662D1-0.3309858185437853D-2*t8*t11
     #+0.1312047511507964D-3*t19*t21
      t27 = 1/rho
      t28 = t27**(1.D0/3.D0)
      t30 = 1.D0+0.1606016560364007D0*t28
      t31 = rho*t30
      t32 = t27**(1.D0/6.D0)
      t35 = dsqrt(t27)
      t37 = t28**2
      t39 = 0.1248219874679732D2*t32+0.4844076716063854D1*t28
     #+0.2326004811900819D1*t35+0.3819082618690966D0*t37
      t42 = 1.D0+0.321646831778707D2/t39
      t43 = dlog(t42)
      t45 = 1.D0+0.3174802103936399D0*t8
      t46 = 1/t45
      t49 = t45**2
      t50 = 1/t49
      t53 = 0.2234D0-0.495929487051697D0*t8*t46+0.1958350724377797D0
     #*t19*t50
      t54 = t43*t53
      t58 = 1.D0+0.1325688999052018D0*t28
      t64 = 0.598255043577108D1*t32+0.2225569421150687D1*t28
     #+0.8004286349993634D0*t35+0.1897004325747559D0*t37
      t67 = 1.D0+0.160818243221511D2/t64
      t68 = dlog(t67)
      t73 = -0.62182D-1*rho*t58*t68+0.3109D-1*t31*t43
      t75 = 1.D0+0.9524406311809197D-2*t8
      t76 = 1/t75
      t79 = t75**2
      t80 = 1/t79
      t83 = 0.69041D0+0.6002947566143982D-1*t8*t76
     #-0.1358102161597401D-2*t19*t80
      zk(i) = -0.7385587663820224D0*t3*t24-0.3109D-1*t31*t54+t73*t83
      t87 = t4*rho
      t89 = 1/t5/t87
      t90 = sigma*t89
      t95 = 1/t2/t15/t4
      t96 = t14*t95
      t99 = t14*sigma
      t100 = t15**2
      t102 = 1/t100/rho
      t103 = t99*t102
      t105 = 1/t20/t10
      t108 = 0.1765257698900188D-1*t90*t11-0.151160422273766D-2*t96
     #*t21+0.8886381226666667D-5*t103*t105
      t111 = t30*t43
      t114 = 1/t37
      t115 = t27*t114
      t118 = t39**2
      t119 = 1/t118
      t120 = t31*t119
      t121 = t32**2
      t122 = t121**2
      t123 = t122*t32
      t124 = 1/t123
      t125 = 1/t4
      t126 = t124*t125
      t128 = t114*t125
      t130 = 1/t35
      t131 = t130*t125
      t133 = 1/t28
      t134 = t133*t125
      t136 = -0.4160732915599108D1*t126-0.3229384477375903D1*t128
     #-0.2326004811900819D1*t131-0.5092110158254621D0*t134
      t137 = 1/t42
      t138 = t136*t137
      t139 = t138*t53
      t147 = 1/t49/t45
      t150 = 0.2644957264275717D1*t90*t46-0.2928629028080757D1*t96*t50
     #+0.6631867733333333D0*t103*t147
      t151 = t43*t150
      t156 = t128*t68
      t158 = t64**2
      t159 = 1/t158
      t160 = t58*t159
      t165 = -0.99709173929518D0*t126-0.7418564737168958D0*t128
     #-0.4002143174996817D0*t131-0.1264669550498372D0*t134
      t166 = 1/t67
      t168 = t160*t165*t166
      t176 = t119*t136*t137
      t179 = -0.62182D-1*t58*t68+rho*(0.2747799777968419D-2*t156+0.1D1
     #*t168)+0.3109D-1*t111-0.1664368495390566D-2*t115*t43-0.5D0*t31
     #*t176
      t186 = 1/t79/t75
      t189 = -0.1600786017638395D0*t90*t76+0.8767865173544576D-2*t96
     #*t80-0.689872896D-4*t103*t186
      vrhoa(i) = -0.9847450218426965D0*t2*t24-0.3692793831910112D0*t3
     #*t108-0.3109D-1*t111*t53+0.1664368495390566D-2*t115*t54+0.5D0
     #*t120*t139-0.15545D-1*t31*t151+t179*t83+t73*t189
      t193 = sigma*t18
      t196 = 1/t100
      t197 = t14*t196
      t200 = -0.1323943274175141D-1*t7*t11+0.1133703167053245D-2*t193
     #*t21-0.666478592D-5*t197*t105
      t209 = -0.1983717948206788D1*t7*t46+0.2196471771060568D1*t193
     #*t50-0.49739008D0*t197*t147
      t210 = t43*t209
      t219 = 0.1200589513228796D0*t7*t76-0.6575898880158432D-2*t193
     #*t80+0.517404672D-4*t197*t186
      vsigmaaa(i) = -0.7385587663820224D0*t3*t200-0.3109D-1*t31*t210
     #+2.D0*t73*t219
      t232 = 1/t87
      t234 = 1/t37/t27
      t235 = t232*t234
      t241 = t30*t119
      t246 = sigma/t5/t15
      t252 = t14/t2/t15/t87
      t255 = t100*t4
      t257 = t99/t255
      t260 = t14**2
      t264 = t260/t5/t100/t15
      t265 = t49**2
      t266 = 1/t265
      t274 = 1/t118/t39
      t276 = t136**2
      t281 = t118**2
      t282 = 1/t281
      t284 = t42**2
      t285 = 1/t284
      t298 = t20**2
      t299 = 1/t298
      t307 = 1/t15
      t308 = 1/t123/t27*t307
      t310 = t124*t232
      t312 = t234*t307
      t314 = t114*t232
      t318 = 1/t35/t27*t307
      t320 = t130*t232
      t324 = 1/t28/t27*t307
      t326 = t133*t232
      t328 = -0.6934554859331846D1*t308+0.1664293166239643D2*t310
     #-0.4305845969834537D1*t312+0.1291753790950361D2*t314
     #-0.2326004811900819D1*t318+0.9304019247603276D1*t320
     #-0.3394740105503081D0*t324+0.2036844063301848D1*t326
      t335 = t252*t80
      t337 = t257*t186
      t339 = t79**2
      t340 = 1/t339
      t342 = 0.5256503812006792D-5*t264*t340
      t349 = 0.5495599555936838D-2*t156
      t354 = 0.2D1*t168
      t356 = 0.1831866518645613D-2*t312*t68
      t358 = 0.5495599555936838D-2*t314*t68
      t362 = t165**2
      t365 = 0.2D1*t58/t158/t64*t362*t166
      t377 = 0.1D1*t160*(-0.8309097827459833D0*t308
     #+0.199418347859036D1*t310-0.4945709824779306D0*t312
     #+0.1483712947433792D1*t314-0.2001071587498409D0*t318
     #+0.8004286349993634D0*t320-0.4215565168327908D-1*t324
     #+0.2529339100996745D0*t326)*t166
      t378 = t158**2
      t381 = t67**2
      t385 = 0.160818243221511D2*t58/t378*t362/t381
      t389 = 0.8837926660346786D-1*t128*t159*t165*t166
      t400 = dlog(1.D0+0.2960857464321668D2/(0.8157414703487641D1*t32
     #+0.2247591863577616D1*t28+0.4300972471276643D0*t35
     #+0.1911512595127338D0*t37))
      t402 = (1.D0+0.6901399211255825D-1*t28)*t400*t125
      s1 = -0.6218D-1*t111*t150+0.1D1*t120*t138*t150
     #-0.6564966812284644D0/t5*t24-0.1969490043685393D1*t2*t108
     #+0.2219157993854088D-2*t235*t54-0.1070677706909338D0*t115*t119
     #*t139+0.2D1*t241*t139-0.15545D-1*t31*t43*(-0.1939635327135526D2
     #*t246*t46+0.4157448282899328D2*t252*t50-0.2185503402666667D2
     #*t257*t147+0.3368778821250333D1*t264*t266)-0.1D1*t31*t274*t276
     #*t137*t53
      s2 = s1+0.1608234158893535D2*t31*t282*t276*t285*t53
     #+0.3328736990781132D-2*t115*t151-0.3692793831910112D0*t3*(
     #-0.1294522312526805D0*t246*t11+0.197447834993659D-1*t252*t21
     #-0.2623344731022222D-3*t257*t105+0.902800058073672D-6*t264*t299)
     #+0.5D0*t120*t328*t137*t53
      v2rhoa2(i) = s2+t73*(0.1173909746268157D1*t246*t76
     #-0.9174439478884604D-1*t335+0.13192187904D-2*t337-t342)+(0.1D1
     #*t31*t274*t276*t137+t349-0.1608234158893535D2*t31*t282*t276*t285
     #+t354+rho*(t356-t358-t365+t377+t385-t389+0.3377399869956914D-1
     #*t402)-0.2219157993854088D-2*t235*t43+0.1070677706909338D0*t115
     #*t176-0.2D1*t241*t138-0.5D0*t31*t119*t328*t137)*t83+4.D0*t179
     #*t189+(t349+t354+rho*(t356-t358-t365+t377+t385-t389
     #-0.3377399869956914D-1*t402))*t83+t73*(-0.2744671684951915D-1
     #*t335+0.813312D-3*t337-t342)
      t433 = sigma*t95
      t436 = t14*t102
      t442 = t99/t5/t100/t87
      t471 = t433*t80
      t473 = t436*t186
      t476 = 0.3942377859005094D-5*t442*t340
      v2rhoasigmaaa(i) = -0.9847450218426965D0*t2*t200
     #-0.3692793831910112D0*t3*(0.7061030795600754D-1*t89*t11
     #-0.1254118129041794D-1*t433*t21+0.1834212829866667D-3*t436*t105
     #-0.677100043555254D-6*t442*t299)-0.3109D-1*t111*t209
     #+0.1664368495390566D-2*t115*t210+0.5D0*t120*t138*t209-0.15545D-1
     #*t31*t43*(0.1057982905710287D2*t89*t46-0.2678791857962382D2*t433
     #*t50+0.1539649536D2*t436*t147-0.252658411593775D1*t442*t266)
     #+2.D0*t179*t219+t73*(-0.6403144070553581D0*t89*t76
     #+0.5565649833131766D-1*t471-0.8859331584D-3*t473+t476)+t73*
     #(0.2058503763713936D-1*t471-0.609984D-3*t473+t476)
      t485 = sigma*t196
      t490 = t14/t5/t255
      v2sigmaaa2(i) = -0.7385587663820224D0*t3*(0.4871073299600473D-2
     #*t18*t21-0.11090681856D-3*t485*t105+0.5078250326664405D-6*t490
     #*t299)-0.3109D-1*t31*t43*(0.113050518504756D2*t18*t50
     #-0.95578112D1*t485*t147+0.1894938086953313D1*t490*t266)+4.D0*t73
     #*(-0.1543877822785452D-1*t18*t80+0.457488D-3*t485*t186
     #-0.295678339425382D-5*t490*t340)
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end

c:XC_B97_Dsubrend
_ENDIF
_IF(ccpdft,all,xc_hcth)
c:XC_HCTHsubrstart

c    Generated: Fri Feb 14 10:46:20 GMT 2003

      subroutine uks_xc_hcth
     & (ideriv,npt,rhoa1,rhob1,sigmaaa1,sigmabb1,sigmaab1,
     &  zk,vrhoa,vrhob,vsigmaaa,vsigmabb,vsigmaab,
     &  v2rhoa2,v2rhob2,v2rhoab,
     &  v2rhoasigmaaa,v2rhoasigmaab,v2rhoasigmabb,
     &  v2rhobsigmabb,v2rhobsigmaab,v2rhobsigmaaa,
     &  v2sigmaaa2,v2sigmaaaab,v2sigmaaabb,
     &  v2sigmaab2,v2sigmaabbb,v2sigmabb2)
c
c     F.A. Hamprecht, A.J. Cohen, D.J. Tozer, and N.C. Handy
c     Development and assessment of new exchange-correlation functionals
c     J. Chem. Phys. 109 (1998) 6264-6271
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt),rhob1(npt)
      REAL sigmaaa1(npt),sigmabb1(npt),sigmaab1(npt)
      REAL zk(npt),vrhoa(npt),vrhob(npt)
      REAL vsigmaaa(npt),vsigmabb(npt),vsigmaab(npt)
      REAL v2rhoa2(npt),v2rhob2(npt),v2rhoab(npt)
      REAL v2rhoasigmaaa(npt),v2rhoasigmaab(npt)
      REAL v2rhoasigmabb(npt),v2rhobsigmabb(npt)
      REAL v2rhobsigmaab(npt),v2rhobsigmaaa(npt)
      REAL v2sigmaaa2(npt),v2sigmaaaab(npt),v2sigmaaabb(npt)
      REAL v2sigmaab2(npt),v2sigmaabbb(npt),v2sigmabb2(npt)
      parameter(tol=1.0d-20)
      
      if (ideriv.eq.0) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t4 = rhob**2
      t5 = t2**2
      t8 = sigmabb/t5/t4
      t10 = 1.D0+0.4D-2*t8
      t14 = sigmabb**2
      t15 = t4**2
      t19 = t14/t2/t15/rhob
      t20 = t10**2
      t25 = t15**2
      t27 = t14*sigmabb/t25
      t32 = t14**2
      t36 = t32/t5/t25/t4
      t37 = t20**2
      t44 = 1/rhob
      t45 = t44**(1.D0/3.D0)
      t49 = t44**(1.D0/6.D0)
      t52 = dsqrt(t44)
      t54 = t45**2
      t60 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t49
     #+0.3844746237447211D1*t45+0.1644733775567609D1*t52
     #+0.2405871291288192D0*t54))
      t62 = 1.D0+0.2D0*t8
      t66 = t62**2
      t74 = t66**2
      zk(i) = -0.9305257363491D0*t2*rhob*(0.10932D1-0.2976224D-2*t8
     #/t10+0.895872D-4*t19/t20-0.43427136D-6*t27/t20/t10
     #+0.115035392D-8*t36/t37)-0.3109D-1*rhob*(1.D0
     #+0.1274696188700087D0*t45)*t60*(0.222601D0-0.677244D-2*t8/t62
     #-0.50068D-3*t19/t66-0.6419968D-2*t27/t66/t62+0.2486336D-2*t36/t74)
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t4 = rhoa**2
      t5 = t2**2
      t8 = sigmaaa/t5/t4
      t10 = 1.D0+0.4D-2*t8
      t14 = sigmaaa**2
      t15 = t4**2
      t19 = t14/t2/t15/rhoa
      t20 = t10**2
      t25 = t15**2
      t27 = t14*sigmaaa/t25
      t32 = t14**2
      t36 = t32/t5/t25/t4
      t37 = t20**2
      t44 = 1/rhoa
      t45 = t44**(1.D0/3.D0)
      t49 = t44**(1.D0/6.D0)
      t52 = dsqrt(t44)
      t54 = t45**2
      t60 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t49
     #+0.3844746237447211D1*t45+0.1644733775567609D1*t52
     #+0.2405871291288192D0*t54))
      t62 = 1.D0+0.2D0*t8
      t66 = t62**2
      t74 = t66**2
      zk(i) = -0.9305257363491D0*t2*rhoa*(0.10932D1-0.2976224D-2*t8
     #/t10+0.895872D-4*t19/t20-0.43427136D-6*t27/t20/t10
     #+0.115035392D-8*t36/t37)-0.3109D-1*rhoa*(1.D0
     #+0.1274696188700087D0*t45)*t60*(0.222601D0-0.677244D-2*t8/t62
     #-0.50068D-3*t19/t66-0.6419968D-2*t27/t66/t62+0.2486336D-2*t36/t74)
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t6 = rhoa**2
      t7 = t4**2
      t10 = sigmaaa/t7/t6
      t12 = 1.D0+0.4D-2*t10
      t16 = sigmaaa**2
      t17 = t6**2
      t21 = t16/t4/t17/rhoa
      t22 = t12**2
      t27 = t17**2
      t29 = t16*sigmaaa/t27
      t34 = t16**2
      t38 = t34/t7/t27/t6
      t39 = t22**2
      t46 = 1/rhoa
      t47 = t46**(1.D0/3.D0)
      t50 = rhoa*(1.D0+0.1274696188700087D0*t47)
      t51 = t46**(1.D0/6.D0)
      t54 = dsqrt(t46)
      t56 = t47**2
      t62 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t51
     #+0.3844746237447211D1*t47+0.1644733775567609D1*t54
     #+0.2405871291288192D0*t56))
      t64 = 1.D0+0.2D0*t10
      t68 = t64**2
      t76 = t68**2
      t84 = rhob**(1.D0/3.D0)
      t86 = rhob**2
      t87 = t84**2
      t90 = sigmabb/t87/t86
      t92 = 1.D0+0.4D-2*t90
      t96 = sigmabb**2
      t97 = t86**2
      t101 = t96/t84/t97/rhob
      t102 = t92**2
      t107 = t97**2
      t109 = t96*sigmabb/t107
      t114 = t96**2
      t118 = t114/t87/t107/t86
      t119 = t102**2
      t126 = 1/rhob
      t127 = t126**(1.D0/3.D0)
      t130 = rhob*(1.D0+0.1274696188700087D0*t127)
      t131 = t126**(1.D0/6.D0)
      t134 = dsqrt(t126)
      t136 = t127**2
      t142 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t131
     #+0.3844746237447211D1*t127+0.1644733775567609D1*t134
     #+0.2405871291288192D0*t136))
      t144 = 1.D0+0.2D0*t90
      t148 = t144**2
      t156 = t148**2
      t164 = rhoa+rhob
      t165 = 1/t164
      t166 = t165**(1.D0/3.D0)
      t169 = t165**(1.D0/6.D0)
      t172 = dsqrt(t165)
      t174 = t166**2
      t180 = dlog(1.D0+0.160818243221511D2/(0.598255043577108D1*t169
     #+0.2225569421150687D1*t166+0.8004286349993634D0*t172
     #+0.1897004325747559D0*t174))
      t182 = 0.62182D-1*(1.D0+0.1325688999052018D0*t166)*t180
      t193 = dlog(1.D0+0.2960857464321668D2/(0.8157414703487641D1*t169
     #+0.2247591863577616D1*t166+0.4300972471276643D0*t172
     #+0.1911512595127338D0*t174))
      t196 = rhoa-1.D0*rhob
      t197 = t196*t165
      t198 = 1.D0+t197
      t199 = t198**(1.D0/3.D0)
      t202 = 1.D0-1.D0*t197
      t203 = t202**(1.D0/3.D0)
      t205 = t199*t198+t203*t202-2.D0
      t206 = t196**2
      t207 = t206**2
      t208 = t164**2
      t209 = t208**2
      t211 = t207/t209
      t227 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t169
     #+0.3844746237447211D1*t166+0.1644733775567609D1*t172
     #+0.2405871291288192D0*t174))
      t243 = 0.5D0*t10+0.5D0*t90
      t246 = 1.D0+0.3D-2*t10+0.3D-2*t90
      t250 = t243**2
      t251 = t246**2
      t260 = t250**2
      t261 = t251**2
      s1 = -0.9305257363491D0*t4*rhoa*(0.10932D1-0.2976224D-2*t10/t12
     #+0.895872D-4*t21/t22-0.43427136D-6*t29/t22/t12+0.115035392D-8
     #*t38/t39)-0.3109D-1*t50*t62*(0.222601D0-0.677244D-2*t10/t64
     #-0.50068D-3*t21/t68-0.6419968D-2*t29/t68/t64+0.2486336D-2*t38/t76)
      zk(i) = s1-0.9305257363491D0*t84*rhob*(0.10932D1-0.2976224D-2
     #*t90/t92+0.895872D-4*t101/t102-0.43427136D-6*t109/t102/t92
     #+0.115035392D-8*t118/t119)-0.3109D-1*t130*t142*(0.222601D0
     #-0.677244D-2*t90/t144-0.50068D-3*t101/t148-0.6419968D-2*t109
     #/t148/t144+0.2486336D-2*t118/t156)+(t164*(-t182
     #+0.3799574853701528D-1*(1.D0+0.6901399211255825D-1*t166)*t193
     #*t205*(1.D0-1.D0*t211)+0.1923661050931536D1*(-0.3109D-1*(1.D0
     #+0.1274696188700087D0*t166)*t227+t182)*t205*t211)+0.3109D-1*t50
     #*t62+0.3109D-1*t130*t142)*(0.729974D0+0.2011722D-1*t243/t246
     #-0.415548D-3*t250/t251+0.174649824D-5*t250*t243/t251/t246
     #-0.580422672D-8*t260/t261)
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t3 = t2*rhob
      t4 = rhob**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigmabb*t7
      t10 = 1.D0+0.4D-2*t8
      t11 = 1/t10
      t14 = sigmabb**2
      t15 = t4**2
      t16 = t15*rhob
      t18 = 1/t2/t16
      t19 = t14*t18
      t20 = t10**2
      t21 = 1/t20
      t24 = t14*sigmabb
      t25 = t15**2
      t26 = 1/t25
      t27 = t24*t26
      t29 = 1/t20/t10
      t32 = t14**2
      t35 = 1/t5/t25/t4
      t36 = t32*t35
      t37 = t20**2
      t38 = 1/t37
      t41 = 0.10932D1-0.2976224D-2*t8*t11+0.895872D-4*t19*t21
     #-0.43427136D-6*t27*t29+0.115035392D-8*t36*t38
      t44 = 1/rhob
      t45 = t44**(1.D0/3.D0)
      t47 = 1.D0+0.1274696188700087D0*t45
      t48 = rhob*t47
      t49 = t44**(1.D0/6.D0)
      t52 = dsqrt(t44)
      t54 = t45**2
      t56 = 0.1112037486309468D2*t49+0.3844746237447211D1*t45
     #+0.1644733775567609D1*t52+0.2405871291288192D0*t54
      t59 = 1.D0+0.321646831778707D2/t56
      t60 = dlog(t59)
      t62 = 1.D0+0.2D0*t8
      t63 = 1/t62
      t66 = t62**2
      t67 = 1/t66
      t71 = 1/t66/t62
      t74 = t66**2
      t75 = 1/t74
      t78 = 0.222601D0-0.677244D-2*t8*t63-0.50068D-3*t19*t67
     #-0.6419968D-2*t27*t71+0.2486336D-2*t36*t75
      t79 = t60*t78
      zk(i) = -0.9305257363491D0*t3*t41-0.3109D-1*t48*t79
      vrhoa(i) = 0.D0
      t84 = t4*rhob
      t87 = sigmabb/t5/t84
      t90 = t15*t4
      t93 = t14/t2/t90
      t98 = t24/t25/rhob
      t104 = t32/t5/t25/t84
      t111 = t32*sigmabb/t2/t25/t90
      t113 = 1/t37/t10
      t122 = 1/t54
      t126 = t56**2
      t129 = t49**2
      t130 = t129**2
      t133 = 1/t4
      t159 = 1/t74/t62
      vrhob(i) = -0.12407009817988D1*t2*t41-0.9305257363491D0*t3*
     #(0.7936597333333333D-2*t87*t11-0.5095447893333333D-3*t93*t21
     #+0.538536448D-5*t98*t29-0.2616712533333333D-7*t104*t38
     #+0.4908176725333333D-10*t111*t113)-0.3109D-1*t47*t60*t78
     #+0.1321010150222857D-2*t44*t122*t79+0.1D1*t48/t126*(
     #-0.1853395810515781D1/t130/t49*t133-0.128158207914907D1*t122
     #*t133-0.8223668877838045D0/t52*t133-0.1603914194192128D0/t45
     #*t133)/t59*t78-0.3109D-1*t48*t60*(0.1805984D-1*t87*t63
     #-0.9416746666666667D-3*t93*t67+0.5082568533333333D-1*t98*t71
     #-0.3679286613333333D-1*t104*t75+0.5304183466666667D-2*t111*t159)
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      t168 = sigmabb*t18
      t171 = t14*t26
      t174 = t24*t35
      t180 = t32/t2/t25/t16
      vsigmabb(i) = -0.9305257363491D0*t3*(-0.2976224D-2*t7*t11
     #+0.191079296D-3*t168*t21-0.201951168D-5*t171*t29+0.9812672D-8
     #*t174*t38-0.1840566272D-10*t180*t113)-0.3109D-1*t48*t60*(
     #-0.677244D-2*t7*t63+0.353128D-3*t168*t67-0.19059632D-1*t171*t71
     #+0.137973248D-1*t174*t75-0.19890688D-2*t180*t159)
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t3 = t2*rhoa
      t4 = rhoa**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigmaaa*t7
      t10 = 1.D0+0.4D-2*t8
      t11 = 1/t10
      t14 = sigmaaa**2
      t15 = t4**2
      t16 = t15*rhoa
      t18 = 1/t2/t16
      t19 = t14*t18
      t20 = t10**2
      t21 = 1/t20
      t24 = t14*sigmaaa
      t25 = t15**2
      t26 = 1/t25
      t27 = t24*t26
      t29 = 1/t20/t10
      t32 = t14**2
      t35 = 1/t5/t25/t4
      t36 = t32*t35
      t37 = t20**2
      t38 = 1/t37
      t41 = 0.10932D1-0.2976224D-2*t8*t11+0.895872D-4*t19*t21
     #-0.43427136D-6*t27*t29+0.115035392D-8*t36*t38
      t44 = 1/rhoa
      t45 = t44**(1.D0/3.D0)
      t47 = 1.D0+0.1274696188700087D0*t45
      t48 = rhoa*t47
      t49 = t44**(1.D0/6.D0)
      t52 = dsqrt(t44)
      t54 = t45**2
      t56 = 0.1112037486309468D2*t49+0.3844746237447211D1*t45
     #+0.1644733775567609D1*t52+0.2405871291288192D0*t54
      t59 = 1.D0+0.321646831778707D2/t56
      t60 = dlog(t59)
      t62 = 1.D0+0.2D0*t8
      t63 = 1/t62
      t66 = t62**2
      t67 = 1/t66
      t71 = 1/t66/t62
      t74 = t66**2
      t75 = 1/t74
      t78 = 0.222601D0-0.677244D-2*t8*t63-0.50068D-3*t19*t67
     #-0.6419968D-2*t27*t71+0.2486336D-2*t36*t75
      t79 = t60*t78
      zk(i) = -0.9305257363491D0*t3*t41-0.3109D-1*t48*t79
      t84 = t4*rhoa
      t87 = sigmaaa/t5/t84
      t90 = t15*t4
      t93 = t14/t2/t90
      t98 = t24/t25/rhoa
      t104 = t32/t5/t25/t84
      t111 = t32*sigmaaa/t2/t25/t90
      t113 = 1/t37/t10
      t122 = 1/t54
      t126 = t56**2
      t129 = t49**2
      t130 = t129**2
      t133 = 1/t4
      t159 = 1/t74/t62
      vrhoa(i) = -0.12407009817988D1*t2*t41-0.9305257363491D0*t3*
     #(0.7936597333333333D-2*t87*t11-0.5095447893333333D-3*t93*t21
     #+0.538536448D-5*t98*t29-0.2616712533333333D-7*t104*t38
     #+0.4908176725333333D-10*t111*t113)-0.3109D-1*t47*t60*t78
     #+0.1321010150222857D-2*t44*t122*t79+0.1D1*t48/t126*(
     #-0.1853395810515781D1/t130/t49*t133-0.128158207914907D1*t122
     #*t133-0.8223668877838045D0/t52*t133-0.1603914194192128D0/t45
     #*t133)/t59*t78-0.3109D-1*t48*t60*(0.1805984D-1*t87*t63
     #-0.9416746666666667D-3*t93*t67+0.5082568533333333D-1*t98*t71
     #-0.3679286613333333D-1*t104*t75+0.5304183466666667D-2*t111*t159)
      vrhob(i) = 0.D0
      t168 = sigmaaa*t18
      t171 = t14*t26
      t174 = t24*t35
      t180 = t32/t2/t25/t16
      vsigmaaa(i) = -0.9305257363491D0*t3*(-0.2976224D-2*t7*t11
     #+0.191079296D-3*t168*t21-0.201951168D-5*t171*t29+0.9812672D-8
     #*t174*t38-0.1840566272D-10*t180*t113)-0.3109D-1*t48*t60*(
     #-0.677244D-2*t7*t63+0.353128D-3*t168*t67-0.19059632D-1*t171*t71
     #+0.137973248D-1*t174*t75-0.19890688D-2*t180*t159)
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t5 = t4*rhoa
      t6 = rhoa**2
      t7 = t4**2
      t9 = 1/t7/t6
      t10 = sigmaaa*t9
      t12 = 1.D0+0.4D-2*t10
      t13 = 1/t12
      t16 = sigmaaa**2
      t17 = t6**2
      t18 = t17*rhoa
      t20 = 1/t4/t18
      t21 = t16*t20
      t22 = t12**2
      t23 = 1/t22
      t26 = t16*sigmaaa
      t27 = t17**2
      t28 = 1/t27
      t29 = t26*t28
      t31 = 1/t22/t12
      t34 = t16**2
      t37 = 1/t7/t27/t6
      t38 = t34*t37
      t39 = t22**2
      t40 = 1/t39
      t43 = 0.10932D1-0.2976224D-2*t10*t13+0.895872D-4*t21*t23
     #-0.43427136D-6*t29*t31+0.115035392D-8*t38*t40
      t46 = 1/rhoa
      t47 = t46**(1.D0/3.D0)
      t49 = 1.D0+0.1274696188700087D0*t47
      t50 = rhoa*t49
      t51 = t46**(1.D0/6.D0)
      t54 = dsqrt(t46)
      t56 = t47**2
      t58 = 0.1112037486309468D2*t51+0.3844746237447211D1*t47
     #+0.1644733775567609D1*t54+0.2405871291288192D0*t56
      t61 = 1.D0+0.321646831778707D2/t58
      t62 = dlog(t61)
      t64 = 1.D0+0.2D0*t10
      t65 = 1/t64
      t68 = t64**2
      t69 = 1/t68
      t73 = 1/t68/t64
      t76 = t68**2
      t77 = 1/t76
      t80 = 0.222601D0-0.677244D-2*t10*t65-0.50068D-3*t21*t69
     #-0.6419968D-2*t29*t73+0.2486336D-2*t38*t77
      t81 = t62*t80
      t84 = rhob**(1.D0/3.D0)
      t85 = t84*rhob
      t86 = rhob**2
      t87 = t84**2
      t89 = 1/t87/t86
      t90 = sigmabb*t89
      t92 = 1.D0+0.4D-2*t90
      t93 = 1/t92
      t96 = sigmabb**2
      t97 = t86**2
      t98 = t97*rhob
      t100 = 1/t84/t98
      t101 = t96*t100
      t102 = t92**2
      t103 = 1/t102
      t106 = t96*sigmabb
      t107 = t97**2
      t108 = 1/t107
      t109 = t106*t108
      t111 = 1/t102/t92
      t114 = t96**2
      t117 = 1/t87/t107/t86
      t118 = t114*t117
      t119 = t102**2
      t120 = 1/t119
      t123 = 0.10932D1-0.2976224D-2*t90*t93+0.895872D-4*t101*t103
     #-0.43427136D-6*t109*t111+0.115035392D-8*t118*t120
      t126 = 1/rhob
      t127 = t126**(1.D0/3.D0)
      t129 = 1.D0+0.1274696188700087D0*t127
      t130 = rhob*t129
      t131 = t126**(1.D0/6.D0)
      t134 = dsqrt(t126)
      t136 = t127**2
      t138 = 0.1112037486309468D2*t131+0.3844746237447211D1*t127
     #+0.1644733775567609D1*t134+0.2405871291288192D0*t136
      t141 = 1.D0+0.321646831778707D2/t138
      t142 = dlog(t141)
      t144 = 1.D0+0.2D0*t90
      t145 = 1/t144
      t148 = t144**2
      t149 = 1/t148
      t153 = 1/t148/t144
      t156 = t148**2
      t157 = 1/t156
      t160 = 0.222601D0-0.677244D-2*t90*t145-0.50068D-3*t101*t149
     #-0.6419968D-2*t109*t153+0.2486336D-2*t118*t157
      t161 = t142*t160
      t164 = rhoa+rhob
      t165 = 1/t164
      t166 = t165**(1.D0/3.D0)
      t168 = 1.D0+0.1325688999052018D0*t166
      t169 = t165**(1.D0/6.D0)
      t172 = dsqrt(t165)
      t174 = t166**2
      t176 = 0.598255043577108D1*t169+0.2225569421150687D1*t166
     #+0.8004286349993634D0*t172+0.1897004325747559D0*t174
      t179 = 1.D0+0.160818243221511D2/t176
      t180 = dlog(t179)
      t182 = 0.62182D-1*t168*t180
      t184 = 1.D0+0.6901399211255825D-1*t166
      t189 = 0.8157414703487641D1*t169+0.2247591863577616D1*t166
     #+0.4300972471276643D0*t172+0.1911512595127338D0*t174
      t192 = 1.D0+0.2960857464321668D2/t189
      t193 = dlog(t192)
      t194 = t184*t193
      t196 = rhoa-1.D0*rhob
      t197 = t196*t165
      t198 = 1.D0+t197
      t199 = t198**(1.D0/3.D0)
      t202 = 1.D0-1.D0*t197
      t203 = t202**(1.D0/3.D0)
      t205 = t199*t198+t203*t202-2.D0
      t206 = t196**2
      t207 = t206**2
      t208 = t164**2
      t209 = t208**2
      t210 = 1/t209
      t211 = t207*t210
      t213 = 1.D0-1.D0*t211
      t216 = 0.3799574853701528D-1*t194*t205*t213
      t218 = 1.D0+0.1274696188700087D0*t166
      t223 = 0.1112037486309468D2*t169+0.3844746237447211D1*t166
     #+0.1644733775567609D1*t172+0.2405871291288192D0*t174
      t226 = 1.D0+0.321646831778707D2/t223
      t227 = dlog(t226)
      t230 = -0.3109D-1*t218*t227+t182
      t231 = t230*t205
      t233 = 0.1923661050931536D1*t231*t211
      t240 = t164*(-t182+t216+t233)+0.3109D-1*t50*t62+0.3109D-1*t130
     #*t142
      t243 = 0.5D0*t10+0.5D0*t90
      t246 = 1.D0+0.3D-2*t10+0.3D-2*t90
      t247 = 1/t246
      t250 = t243**2
      t251 = t246**2
      t252 = 1/t251
      t255 = t250*t243
      t257 = 1/t251/t246
      t260 = t250**2
      t261 = t251**2
      t262 = 1/t261
      t265 = 0.729974D0+0.2011722D-1*t243*t247-0.415548D-3*t250*t252
     #+0.174649824D-5*t255*t257-0.580422672D-8*t260*t262
      zk(i) = -0.9305257363491D0*t5*t43-0.3109D-1*t50*t81
     #-0.9305257363491D0*t85*t123-0.3109D-1*t130*t161+t240*t265
      t269 = t6*rhoa
      t272 = sigmaaa/t7/t269
      t275 = t17*t6
      t278 = t16/t4/t275
      t283 = t26/t27/rhoa
      t289 = t34/t7/t27/t269
      t296 = t34*sigmaaa/t4/t27/t275
      t298 = 1/t39/t12
      t304 = t49*t62
      t307 = 1/t56
      t308 = t46*t307
      t311 = t58**2
      t312 = 1/t311
      t314 = t51**2
      t315 = t314**2
      t318 = 1/t6
      t329 = -0.1853395810515781D1/t315/t51*t318-0.128158207914907D1
     #*t307*t318-0.8223668877838045D0/t54*t318-0.1603914194192128D0
     #/t47*t318
      t330 = 1/t61
      t344 = 1/t76/t64
      t352 = 1/t208
      t353 = 1/t174*t352
      t354 = t353*t180
      t355 = 0.2747799777968419D-2*t354
      t356 = t176**2
      t359 = t169**2
      t360 = t359**2
      t363 = 1/t360/t169*t352
      t367 = 1/t172*t352
      t370 = 1/t166*t352
      t375 = t168/t356*(-0.99709173929518D0*t363-0.7418564737168958D0
     #*t353-0.4002143174996817D0*t367-0.1264669550498372D0*t370)/t179
      t376 = 0.1D1*t375
      t380 = 0.8740794299481065D-3*t353*t193*t205*t213
      t381 = t189**2
      t394 = 0.1124999956683108D1*t184/t381*(-0.135956911724794D1*t363
     #-0.7491972878592054D0*t353-0.2150486235638321D0*t367
     #-0.1274341730084892D0*t370)/t192*t205*t213
      t395 = t196*t352
      t396 = 1.D0*t395
      t400 = 1.D0*t165
      t404 = 0.1333333333333333D1*t199*(t165-t396)
     #+0.1333333333333333D1*t203*(-t400+t395)
      t409 = t206*t196*t210
      t410 = 4.D0*t409
      t413 = t207/t209/t164
      t414 = 4.D0*t413
      t421 = t223**2
      t438 = 0.1923661050931536D1*(0.1321010150222857D-2*t353*t227
     #+0.1D1*t218/t421*(-0.1853395810515781D1*t363-0.128158207914907D1
     #*t353-0.8223668877838045D0*t367-0.1603914194192128D0*t370)/t226
     #-0.2747799777968419D-2*t354-0.1D1*t375)*t205*t211
      t442 = t231*t409
      t445 = 0.7694644203726145D1*t231*t413
      t459 = t243*t252
      t462 = t250*t257
      t465 = t255*t262
      t470 = t260/t261/t246
      s1 = -0.12407009817988D1*t4*t43-0.9305257363491D0*t5*
     #(0.7936597333333333D-2*t272*t13-0.5095447893333333D-3*t278*t23
     #+0.538536448D-5*t283*t31-0.2616712533333333D-7*t289*t40
     #+0.4908176725333333D-10*t296*t298)-0.3109D-1*t304*t80
     #+0.1321010150222857D-2*t308*t81
      vrhoa(i) = s1+0.1D1*t50*t312*t329*t330*t80-0.3109D-1*t50*t62*
     #(0.1805984D-1*t272*t65-0.9416746666666667D-3*t278*t69
     #+0.5082568533333333D-1*t283*t73-0.3679286613333333D-1*t289*t77
     #+0.5304183466666667D-2*t296*t344)+(-t182+t216+t233+t164*(t355
     #+t376-t380-t394+0.3799574853701528D-1*t194*t404*t213
     #+0.3799574853701528D-1*t194*t205*(-t410+t414)+t438
     #+0.1923661050931536D1*t230*t404*t211+0.7694644203726145D1*t442
     #-t445)+0.3109D-1*t304-0.1321010150222857D-2*t308*t62-0.1D1*t50
     #*t312*t329*t330)*t265+t240*(-0.2682296D-1*t272*t247
     #+0.126906576D-2*t459*t272-0.1363476096D-4*t462*t272
     #+0.728718336D-7*t465*t272-0.18573525504D-9*t470*t272)
      t477 = t86*rhob
      t480 = sigmabb/t87/t477
      t483 = t97*t86
      t486 = t96/t84/t483
      t491 = t106/t107/rhob
      t497 = t114/t87/t107/t477
      t504 = t114*sigmabb/t84/t107/t483
      t506 = 1/t119/t92
      t512 = t129*t142
      t515 = 1/t136
      t516 = t126*t515
      t519 = t138**2
      t520 = 1/t519
      t522 = t131**2
      t523 = t522**2
      t526 = 1/t86
      t537 = -0.1853395810515781D1/t523/t131*t526-0.128158207914907D1
     #*t515*t526-0.8223668877838045D0/t134*t526-0.1603914194192128D0
     #/t127*t526
      t538 = 1/t141
      t552 = 1/t156/t144
      t565 = 0.1333333333333333D1*t199*(-t400-t396)
     #+0.1333333333333333D1*t203*(t165+t395)
      s1 = -0.12407009817988D1*t84*t123-0.9305257363491D0*t85*
     #(0.7936597333333333D-2*t480*t93-0.5095447893333333D-3*t486*t103
     #+0.538536448D-5*t491*t111-0.2616712533333333D-7*t497*t120
     #+0.4908176725333333D-10*t504*t506)-0.3109D-1*t512*t160
     #+0.1321010150222857D-2*t516*t161
      vrhob(i) = s1+0.1D1*t130*t520*t537*t538*t160-0.3109D-1*t130*t142
     #*(0.1805984D-1*t480*t145-0.9416746666666667D-3*t486*t149
     #+0.5082568533333333D-1*t491*t153-0.3679286613333333D-1*t497*t157
     #+0.5304183466666667D-2*t504*t552)+(-t182+t216+t233+t164*(t355
     #+t376-t380-t394+0.3799574853701528D-1*t194*t565*t213
     #+0.3799574853701528D-1*t194*t205*(t410+t414)+t438
     #+0.1923661050931536D1*t230*t565*t211-0.7694644203726145D1*t442
     #-t445)+0.3109D-1*t512-0.1321010150222857D-2*t516*t142-0.1D1*t130
     #*t520*t537*t538)*t265+t240*(-0.2682296D-1*t480*t247
     #+0.126906576D-2*t459*t480-0.1363476096D-4*t462*t480
     #+0.728718336D-7*t465*t480-0.18573525504D-9*t470*t480)
      t602 = sigmaaa*t20
      t605 = t16*t28
      t608 = t26*t37
      t614 = t34/t4/t27/t18
      vsigmaaa(i) = -0.9305257363491D0*t5*(-0.2976224D-2*t9*t13
     #+0.191079296D-3*t602*t23-0.201951168D-5*t605*t31+0.9812672D-8
     #*t608*t40-0.1840566272D-10*t614*t298)-0.3109D-1*t50*t62*(
     #-0.677244D-2*t9*t65+0.353128D-3*t602*t69-0.19059632D-1*t605*t73
     #+0.137973248D-1*t608*t77-0.19890688D-2*t614*t344)+t240*
     #(0.1005861D-1*t9*t247-0.47589966D-3*t459*t9+0.511303536D-5*t462
     #*t9-0.273269376D-7*t465*t9+0.6965072064D-10*t470*t9)
      vsigmaab(i) = 0.D0
      t648 = sigmabb*t100
      t651 = t96*t108
      t654 = t106*t117
      t660 = t114/t84/t107/t98
      vsigmabb(i) = -0.9305257363491D0*t85*(-0.2976224D-2*t89*t93
     #+0.191079296D-3*t648*t103-0.201951168D-5*t651*t111+0.9812672D-8
     #*t654*t120-0.1840566272D-10*t660*t506)-0.3109D-1*t130*t142*(
     #-0.677244D-2*t89*t145+0.353128D-3*t648*t149-0.19059632D-1*t651
     #*t153+0.137973248D-1*t654*t157-0.19890688D-2*t660*t552)+t240*
     #(0.1005861D-1*t89*t247-0.47589966D-3*t459*t89+0.511303536D-5
     #*t462*t89-0.273269376D-7*t465*t89+0.6965072064D-10*t470*t89)
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t3 = t2*rhob
      t4 = rhob**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigmabb*t7
      t10 = 1.D0+0.4D-2*t8
      t11 = 1/t10
      t14 = sigmabb**2
      t15 = t4**2
      t16 = t15*rhob
      t18 = 1/t2/t16
      t19 = t14*t18
      t20 = t10**2
      t21 = 1/t20
      t24 = t14*sigmabb
      t25 = t15**2
      t26 = 1/t25
      t27 = t24*t26
      t29 = 1/t20/t10
      t32 = t14**2
      t33 = t25*t4
      t35 = 1/t5/t33
      t36 = t32*t35
      t37 = t20**2
      t38 = 1/t37
      t41 = 0.10932D1-0.2976224D-2*t8*t11+0.895872D-4*t19*t21
     #-0.43427136D-6*t27*t29+0.115035392D-8*t36*t38
      t44 = 1/rhob
      t45 = t44**(1.D0/3.D0)
      t47 = 1.D0+0.1274696188700087D0*t45
      t48 = rhob*t47
      t49 = t44**(1.D0/6.D0)
      t52 = dsqrt(t44)
      t54 = t45**2
      t56 = 0.1112037486309468D2*t49+0.3844746237447211D1*t45
     #+0.1644733775567609D1*t52+0.2405871291288192D0*t54
      t59 = 1.D0+0.321646831778707D2/t56
      t60 = dlog(t59)
      t62 = 1.D0+0.2D0*t8
      t63 = 1/t62
      t66 = t62**2
      t67 = 1/t66
      t71 = 1/t66/t62
      t74 = t66**2
      t75 = 1/t74
      t78 = 0.222601D0-0.677244D-2*t8*t63-0.50068D-3*t19*t67
     #-0.6419968D-2*t27*t71+0.2486336D-2*t36*t75
      t79 = t60*t78
      zk(i) = -0.9305257363491D0*t3*t41-0.3109D-1*t48*t79
      vrhoa(i) = 0.D0
      t84 = t4*rhob
      t87 = sigmabb/t5/t84
      t90 = t15*t4
      t93 = t14/t2/t90
      t98 = t24/t25/rhob
      t104 = t32/t5/t25/t84
      t107 = t32*sigmabb
      t111 = t107/t2/t25/t90
      t113 = 1/t37/t10
      t116 = 0.7936597333333333D-2*t87*t11-0.5095447893333333D-3*t93
     #*t21+0.538536448D-5*t98*t29-0.2616712533333333D-7*t104*t38
     #+0.4908176725333333D-10*t111*t113
      t119 = t47*t60
      t122 = 1/t54
      t123 = t44*t122
      t126 = t56**2
      t127 = 1/t126
      t128 = t48*t127
      t129 = t49**2
      t130 = t129**2
      t131 = t130*t49
      t132 = 1/t131
      t133 = 1/t4
      t138 = 1/t52
      t141 = 1/t45
      t144 = -0.1853395810515781D1*t132*t133-0.128158207914907D1*t122
     #*t133-0.8223668877838045D0*t138*t133-0.1603914194192128D0*t141
     #*t133
      t145 = 1/t59
      t146 = t144*t145
      t147 = t146*t78
      t159 = 1/t74/t62
      t162 = 0.1805984D-1*t87*t63-0.9416746666666667D-3*t93*t67
     #+0.5082568533333333D-1*t98*t71-0.3679286613333333D-1*t104*t75
     #+0.5304183466666667D-2*t111*t159
      t163 = t60*t162
      vrhob(i) = -0.12407009817988D1*t2*t41-0.9305257363491D0*t3*t116
     #-0.3109D-1*t119*t78+0.1321010150222857D-2*t123*t79+0.1D1*t128
     #*t147-0.3109D-1*t48*t163
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      t168 = sigmabb*t18
      t171 = t14*t26
      t174 = t24*t35
      t179 = 1/t2/t25/t16
      t180 = t32*t179
      vsigmabb(i) = -0.9305257363491D0*t3*(-0.2976224D-2*t7*t11
     #+0.191079296D-3*t168*t21-0.201951168D-5*t171*t29+0.9812672D-8
     #*t174*t38-0.1840566272D-10*t180*t113)-0.3109D-1*t48*t60*(
     #-0.677244D-2*t7*t63+0.353128D-3*t168*t67-0.19059632D-1*t171*t71
     #+0.137973248D-1*t174*t75-0.19890688D-2*t180*t159)
      v2rhoa2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t207 = sigmabb/t5/t15
      t210 = t15*t84
      t213 = t14/t2/t210
      t217 = t24/t33
      t223 = t32/t5/t25/t15
      t229 = t107/t2/t25/t210
      t233 = t25**2
      t236 = t32*t14/t233/t4
      t238 = 1/t37/t20
      t249 = 1/t84
      t251 = 1/t54/t44
      t263 = t144**2
      t270 = 1/t15
      t296 = t126**2
      t299 = t59**2
      t319 = 1/t74/t66
      s1 = -0.4135669939329333D0/t5*t41-0.24814019635976D1*t2*t116
     #-0.9305257363491D0*t3*(-0.2910085688888889D-1*t207*t11
     #+0.3311774037333333D-2*t213*t21-0.5933856915911111D-4*t217*t29
     #+0.4776147922488889D-6*t223*t38-0.1819969344853333D-8*t229*t113
     #+0.2617694253511111D-11*t236*t238)+0.2D1*t47*t127*t147-0.6218D-1
     #*t119*t162+0.8806734334819047D-3*t249*t251*t79
      v2rhob2(i) = s1-0.8497974591333914D-1*t123*t127*t147
     #+0.2642020300445714D-2*t123*t163-0.2D1*t48/t126/t56*t263*t145
     #*t78+0.1D1*t128*(-0.1544496508763151D1/t131/t44*t270
     #+0.3706791621031562D1*t132*t249-0.854388052766047D0*t251*t270
     #+0.2563164158298141D1*t122*t249-0.4111834438919023D0/t52/t44
     #*t270+0.1644733775567609D1*t138*t249-0.5346380647307093D-1/t45
     #/t44*t270+0.3207828388384256D0*t141*t249)*t145*t78
     #+0.321646831778707D2*t48/t296*t263/t299*t78+0.2D1*t128*t146*t162
     #-0.3109D-1*t48*t60*(-0.6621941333333333D-1*t207*t63
     #+0.1559585422222222D-1*t213*t67-0.4584356209777778D0*t217*t71
     #+0.5105712014222222D0*t223*t75-0.15451807744D0*t229*t159
     #+0.1414448924444444D-1*t236*t319)
      v2sigmaaa2(i) = 0.D0
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      t328 = sigmabb*t26
      t331 = t14*t35
      t334 = t24*t179
      t338 = t32/t233
      v2sigmabb2(i) = -0.9305257363491D0*t3*(0.202984192D-3*t18*t21
     #-0.5567657728D-5*t328*t29+0.5367215616D-7*t331*t38
     #-0.23062540288D-9*t334*t113+0.3681132544D-12*t338*t238)
     #-0.3109D-1*t48*t60*(0.1707616D-2*t18*t67-0.382605152D-1*t328*t71
     #+0.528277536D-1*t331*t75-0.1899413504D-1*t334*t159+0.19890688D-2
     #*t338*t319)
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t3 = t2*rhoa
      t4 = rhoa**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigmaaa*t7
      t10 = 1.D0+0.4D-2*t8
      t11 = 1/t10
      t14 = sigmaaa**2
      t15 = t4**2
      t16 = t15*rhoa
      t18 = 1/t2/t16
      t19 = t14*t18
      t20 = t10**2
      t21 = 1/t20
      t24 = t14*sigmaaa
      t25 = t15**2
      t26 = 1/t25
      t27 = t24*t26
      t29 = 1/t20/t10
      t32 = t14**2
      t33 = t25*t4
      t35 = 1/t5/t33
      t36 = t32*t35
      t37 = t20**2
      t38 = 1/t37
      t41 = 0.10932D1-0.2976224D-2*t8*t11+0.895872D-4*t19*t21
     #-0.43427136D-6*t27*t29+0.115035392D-8*t36*t38
      t44 = 1/rhoa
      t45 = t44**(1.D0/3.D0)
      t47 = 1.D0+0.1274696188700087D0*t45
      t48 = rhoa*t47
      t49 = t44**(1.D0/6.D0)
      t52 = dsqrt(t44)
      t54 = t45**2
      t56 = 0.1112037486309468D2*t49+0.3844746237447211D1*t45
     #+0.1644733775567609D1*t52+0.2405871291288192D0*t54
      t59 = 1.D0+0.321646831778707D2/t56
      t60 = dlog(t59)
      t62 = 1.D0+0.2D0*t8
      t63 = 1/t62
      t66 = t62**2
      t67 = 1/t66
      t71 = 1/t66/t62
      t74 = t66**2
      t75 = 1/t74
      t78 = 0.222601D0-0.677244D-2*t8*t63-0.50068D-3*t19*t67
     #-0.6419968D-2*t27*t71+0.2486336D-2*t36*t75
      t79 = t60*t78
      zk(i) = -0.9305257363491D0*t3*t41-0.3109D-1*t48*t79
      t84 = t4*rhoa
      t87 = sigmaaa/t5/t84
      t90 = t15*t4
      t93 = t14/t2/t90
      t98 = t24/t25/rhoa
      t104 = t32/t5/t25/t84
      t107 = t32*sigmaaa
      t111 = t107/t2/t25/t90
      t113 = 1/t37/t10
      t116 = 0.7936597333333333D-2*t87*t11-0.5095447893333333D-3*t93
     #*t21+0.538536448D-5*t98*t29-0.2616712533333333D-7*t104*t38
     #+0.4908176725333333D-10*t111*t113
      t119 = t47*t60
      t122 = 1/t54
      t123 = t44*t122
      t126 = t56**2
      t127 = 1/t126
      t128 = t48*t127
      t129 = t49**2
      t130 = t129**2
      t131 = t130*t49
      t132 = 1/t131
      t133 = 1/t4
      t138 = 1/t52
      t141 = 1/t45
      t144 = -0.1853395810515781D1*t132*t133-0.128158207914907D1*t122
     #*t133-0.8223668877838045D0*t138*t133-0.1603914194192128D0*t141
     #*t133
      t145 = 1/t59
      t146 = t144*t145
      t147 = t146*t78
      t159 = 1/t74/t62
      t162 = 0.1805984D-1*t87*t63-0.9416746666666667D-3*t93*t67
     #+0.5082568533333333D-1*t98*t71-0.3679286613333333D-1*t104*t75
     #+0.5304183466666667D-2*t111*t159
      t163 = t60*t162
      vrhoa(i) = -0.12407009817988D1*t2*t41-0.9305257363491D0*t3*t116
     #-0.3109D-1*t119*t78+0.1321010150222857D-2*t123*t79+0.1D1*t128
     #*t147-0.3109D-1*t48*t163
      vrhob(i) = 0.D0
      t168 = sigmaaa*t18
      t171 = t14*t26
      t174 = t24*t35
      t179 = 1/t2/t25/t16
      t180 = t32*t179
      vsigmaaa(i) = -0.9305257363491D0*t3*(-0.2976224D-2*t7*t11
     #+0.191079296D-3*t168*t21-0.201951168D-5*t171*t29+0.9812672D-8
     #*t174*t38-0.1840566272D-10*t180*t113)-0.3109D-1*t48*t60*(
     #-0.677244D-2*t7*t63+0.353128D-3*t168*t67-0.19059632D-1*t171*t71
     #+0.137973248D-1*t174*t75-0.19890688D-2*t180*t159)
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      t207 = sigmaaa/t5/t15
      t210 = t15*t84
      t213 = t14/t2/t210
      t217 = t24/t33
      t223 = t32/t5/t25/t15
      t229 = t107/t2/t25/t210
      t233 = t25**2
      t236 = t32*t14/t233/t4
      t238 = 1/t37/t20
      t249 = 1/t84
      t251 = 1/t54/t44
      t263 = t144**2
      t270 = 1/t15
      t296 = t126**2
      t299 = t59**2
      t319 = 1/t74/t66
      s1 = -0.4135669939329333D0/t5*t41-0.24814019635976D1*t2*t116
     #-0.9305257363491D0*t3*(-0.2910085688888889D-1*t207*t11
     #+0.3311774037333333D-2*t213*t21-0.5933856915911111D-4*t217*t29
     #+0.4776147922488889D-6*t223*t38-0.1819969344853333D-8*t229*t113
     #+0.2617694253511111D-11*t236*t238)+0.2D1*t47*t127*t147-0.6218D-1
     #*t119*t162+0.8806734334819047D-3*t249*t251*t79
      v2rhoa2(i) = s1-0.8497974591333914D-1*t123*t127*t147
     #+0.2642020300445714D-2*t123*t163-0.2D1*t48/t126/t56*t263*t145
     #*t78+0.1D1*t128*(-0.1544496508763151D1/t131/t44*t270
     #+0.3706791621031562D1*t132*t249-0.854388052766047D0*t251*t270
     #+0.2563164158298141D1*t122*t249-0.4111834438919023D0/t52/t44
     #*t270+0.1644733775567609D1*t138*t249-0.5346380647307093D-1/t45
     #/t44*t270+0.3207828388384256D0*t141*t249)*t145*t78
     #+0.321646831778707D2*t48/t296*t263/t299*t78+0.2D1*t128*t146*t162
     #-0.3109D-1*t48*t60*(-0.6621941333333333D-1*t207*t63
     #+0.1559585422222222D-1*t213*t67-0.4584356209777778D0*t217*t71
     #+0.5105712014222222D0*t223*t75-0.15451807744D0*t229*t159
     #+0.1414448924444444D-1*t236*t319)
      v2rhob2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t328 = sigmaaa*t26
      t331 = t14*t35
      t334 = t24*t179
      t338 = t32/t233
      v2sigmaaa2(i) = -0.9305257363491D0*t3*(0.202984192D-3*t18*t21
     #-0.5567657728D-5*t328*t29+0.5367215616D-7*t331*t38
     #-0.23062540288D-9*t334*t113+0.3681132544D-12*t338*t238)
     #-0.3109D-1*t48*t60*(0.1707616D-2*t18*t67-0.382605152D-1*t328*t71
     #+0.528277536D-1*t331*t75-0.1899413504D-1*t334*t159+0.19890688D-2
     #*t338*t319)
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      v2sigmabb2(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t5 = t4*rhoa
      t6 = rhoa**2
      t7 = t4**2
      t9 = 1/t7/t6
      t10 = sigmaaa*t9
      t12 = 1.D0+0.4D-2*t10
      t13 = 1/t12
      t16 = sigmaaa**2
      t17 = t6**2
      t18 = t17*rhoa
      t20 = 1/t4/t18
      t21 = t16*t20
      t22 = t12**2
      t23 = 1/t22
      t26 = t16*sigmaaa
      t27 = t17**2
      t28 = 1/t27
      t29 = t26*t28
      t31 = 1/t22/t12
      t34 = t16**2
      t35 = t27*t6
      t37 = 1/t7/t35
      t38 = t34*t37
      t39 = t22**2
      t40 = 1/t39
      t43 = 0.10932D1-0.2976224D-2*t10*t13+0.895872D-4*t21*t23
     #-0.43427136D-6*t29*t31+0.115035392D-8*t38*t40
      t46 = 1/rhoa
      t47 = t46**(1.D0/3.D0)
      t49 = 1.D0+0.1274696188700087D0*t47
      t50 = rhoa*t49
      t51 = t46**(1.D0/6.D0)
      t54 = dsqrt(t46)
      t56 = t47**2
      t58 = 0.1112037486309468D2*t51+0.3844746237447211D1*t47
     #+0.1644733775567609D1*t54+0.2405871291288192D0*t56
      t61 = 1.D0+0.321646831778707D2/t58
      t62 = dlog(t61)
      t64 = 1.D0+0.2D0*t10
      t65 = 1/t64
      t68 = t64**2
      t69 = 1/t68
      t73 = 1/t68/t64
      t76 = t68**2
      t77 = 1/t76
      t80 = 0.222601D0-0.677244D-2*t10*t65-0.50068D-3*t21*t69
     #-0.6419968D-2*t29*t73+0.2486336D-2*t38*t77
      t81 = t62*t80
      t84 = rhob**(1.D0/3.D0)
      t85 = t84*rhob
      t86 = rhob**2
      t87 = t84**2
      t89 = 1/t87/t86
      t90 = sigmabb*t89
      t92 = 1.D0+0.4D-2*t90
      t93 = 1/t92
      t96 = sigmabb**2
      t97 = t86**2
      t98 = t97*rhob
      t100 = 1/t84/t98
      t101 = t96*t100
      t102 = t92**2
      t103 = 1/t102
      t106 = t96*sigmabb
      t107 = t97**2
      t108 = 1/t107
      t109 = t106*t108
      t111 = 1/t102/t92
      t114 = t96**2
      t115 = t107*t86
      t117 = 1/t87/t115
      t118 = t114*t117
      t119 = t102**2
      t120 = 1/t119
      t123 = 0.10932D1-0.2976224D-2*t90*t93+0.895872D-4*t101*t103
     #-0.43427136D-6*t109*t111+0.115035392D-8*t118*t120
      t126 = 1/rhob
      t127 = t126**(1.D0/3.D0)
      t129 = 1.D0+0.1274696188700087D0*t127
      t130 = rhob*t129
      t131 = t126**(1.D0/6.D0)
      t134 = dsqrt(t126)
      t136 = t127**2
      t138 = 0.1112037486309468D2*t131+0.3844746237447211D1*t127
     #+0.1644733775567609D1*t134+0.2405871291288192D0*t136
      t141 = 1.D0+0.321646831778707D2/t138
      t142 = dlog(t141)
      t144 = 1.D0+0.2D0*t90
      t145 = 1/t144
      t148 = t144**2
      t149 = 1/t148
      t153 = 1/t148/t144
      t156 = t148**2
      t157 = 1/t156
      t160 = 0.222601D0-0.677244D-2*t90*t145-0.50068D-3*t101*t149
     #-0.6419968D-2*t109*t153+0.2486336D-2*t118*t157
      t161 = t142*t160
      t164 = rhoa+rhob
      t165 = 1/t164
      t166 = t165**(1.D0/3.D0)
      t168 = 1.D0+0.1325688999052018D0*t166
      t169 = t165**(1.D0/6.D0)
      t172 = dsqrt(t165)
      t174 = t166**2
      t176 = 0.598255043577108D1*t169+0.2225569421150687D1*t166
     #+0.8004286349993634D0*t172+0.1897004325747559D0*t174
      t179 = 1.D0+0.160818243221511D2/t176
      t180 = dlog(t179)
      t182 = 0.62182D-1*t168*t180
      t184 = 1.D0+0.6901399211255825D-1*t166
      t189 = 0.8157414703487641D1*t169+0.2247591863577616D1*t166
     #+0.4300972471276643D0*t172+0.1911512595127338D0*t174
      t192 = 1.D0+0.2960857464321668D2/t189
      t193 = dlog(t192)
      t194 = t184*t193
      t196 = rhoa-1.D0*rhob
      t197 = t196*t165
      t198 = 1.D0+t197
      t199 = t198**(1.D0/3.D0)
      t202 = 1.D0-1.D0*t197
      t203 = t202**(1.D0/3.D0)
      t205 = t199*t198+t203*t202-2.D0
      t206 = t196**2
      t207 = t206**2
      t208 = t164**2
      t209 = t208**2
      t210 = 1/t209
      t211 = t207*t210
      t213 = 1.D0-1.D0*t211
      t214 = t205*t213
      t216 = 0.3799574853701528D-1*t194*t214
      t218 = 1.D0+0.1274696188700087D0*t166
      t223 = 0.1112037486309468D2*t169+0.3844746237447211D1*t166
     #+0.1644733775567609D1*t172+0.2405871291288192D0*t174
      t226 = 1.D0+0.321646831778707D2/t223
      t227 = dlog(t226)
      t230 = -0.3109D-1*t218*t227+t182
      t231 = t230*t205
      t233 = 0.1923661050931536D1*t231*t211
      t240 = t164*(-t182+t216+t233)+0.3109D-1*t50*t62+0.3109D-1*t130
     #*t142
      t243 = 0.5D0*t10+0.5D0*t90
      t246 = 1.D0+0.3D-2*t10+0.3D-2*t90
      t247 = 1/t246
      t250 = t243**2
      t251 = t246**2
      t252 = 1/t251
      t255 = t250*t243
      t257 = 1/t251/t246
      t260 = t250**2
      t261 = t251**2
      t262 = 1/t261
      t265 = 0.729974D0+0.2011722D-1*t243*t247-0.415548D-3*t250*t252
     #+0.174649824D-5*t255*t257-0.580422672D-8*t260*t262
      zk(i) = -0.9305257363491D0*t5*t43-0.3109D-1*t50*t81
     #-0.9305257363491D0*t85*t123-0.3109D-1*t130*t161+t240*t265
      t269 = t6*rhoa
      t271 = 1/t7/t269
      t272 = sigmaaa*t271
      t275 = t17*t6
      t277 = 1/t4/t275
      t278 = t16*t277
      t282 = 1/t27/rhoa
      t283 = t26*t282
      t288 = 1/t7/t27/t269
      t289 = t34*t288
      t292 = t34*sigmaaa
      t295 = 1/t4/t27/t275
      t296 = t292*t295
      t298 = 1/t39/t12
      t301 = 0.7936597333333333D-2*t272*t13-0.5095447893333333D-3*t278
     #*t23+0.538536448D-5*t283*t31-0.2616712533333333D-7*t289*t40
     #+0.4908176725333333D-10*t296*t298
      t304 = t49*t62
      t307 = 1/t56
      t308 = t46*t307
      t311 = t58**2
      t312 = 1/t311
      t313 = t50*t312
      t314 = t51**2
      t315 = t314**2
      t316 = t315*t51
      t317 = 1/t316
      t318 = 1/t6
      t323 = 1/t54
      t326 = 1/t47
      t329 = -0.1853395810515781D1*t317*t318-0.128158207914907D1*t307
     #*t318-0.8223668877838045D0*t323*t318-0.1603914194192128D0*t326
     #*t318
      t330 = 1/t61
      t331 = t329*t330
      t332 = t331*t80
      t344 = 1/t76/t64
      t347 = 0.1805984D-1*t272*t65-0.9416746666666667D-3*t278*t69
     #+0.5082568533333333D-1*t283*t73-0.3679286613333333D-1*t289*t77
     #+0.5304183466666667D-2*t296*t344
      t348 = t62*t347
      t351 = 1/t174
      t352 = 1/t208
      t353 = t351*t352
      t354 = t353*t180
      t355 = 0.2747799777968419D-2*t354
      t356 = t176**2
      t357 = 1/t356
      t358 = t168*t357
      t359 = t169**2
      t360 = t359**2
      t361 = t360*t169
      t362 = 1/t361
      t363 = t362*t352
      t366 = 1/t172
      t367 = t366*t352
      t369 = 1/t166
      t370 = t369*t352
      t372 = -0.99709173929518D0*t363-0.7418564737168958D0*t353
     #-0.4002143174996817D0*t367-0.1264669550498372D0*t370
      t373 = 1/t179
      t375 = t358*t372*t373
      t376 = 0.1D1*t375
      t377 = t193*t205
      t378 = t377*t213
      t379 = t353*t378
      t380 = 0.8740794299481065D-3*t379
      t381 = t189**2
      t382 = 1/t381
      t383 = t184*t382
      t388 = -0.135956911724794D1*t363-0.7491972878592054D0*t353
     #-0.2150486235638321D0*t367-0.1274341730084892D0*t370
      t389 = t383*t388
      t390 = 1/t192
      t391 = t390*t205
      t392 = t391*t213
      t393 = t389*t392
      t394 = 0.1124999956683108D1*t393
      t395 = t196*t352
      t396 = 1.D0*t395
      t397 = t165-t396
      t400 = 1.D0*t165
      t401 = -t400+t395
      t404 = 0.1333333333333333D1*t199*t397+0.1333333333333333D1*t203
     #*t401
      t406 = t194*t404*t213
      t407 = 0.3799574853701528D-1*t406
      t408 = t206*t196
      t409 = t408*t210
      t410 = 4.D0*t409
      t412 = 1/t209/t164
      t413 = t207*t412
      t414 = 4.D0*t413
      t415 = -t410+t414
      t417 = t194*t205*t415
      t418 = 0.3799574853701528D-1*t417
      t421 = t223**2
      t422 = 1/t421
      t423 = t218*t422
      t428 = -0.1853395810515781D1*t363-0.128158207914907D1*t353
     #-0.8223668877838045D0*t367-0.1603914194192128D0*t370
      t429 = 1/t226
      t435 = 0.1321010150222857D-2*t353*t227+0.1D1*t423*t428*t429
     #-0.2747799777968419D-2*t354-0.1D1*t375
      t436 = t435*t205
      t437 = t436*t211
      t438 = 0.1923661050931536D1*t437
      t439 = t230*t404
      t440 = t439*t211
      t441 = 0.1923661050931536D1*t440
      t442 = t231*t409
      t444 = t231*t413
      t445 = 0.7694644203726145D1*t444
      t452 = t312*t329*t330
      t455 = -t182+t216+t233+t164*(t355+t376-t380-t394+t407+t418+t438
     #+t441+0.7694644203726145D1*t442-t445)+0.3109D-1*t304
     #-0.1321010150222857D-2*t308*t62-0.1D1*t50*t452
      t459 = t243*t252
      t462 = t250*t257
      t465 = t255*t262
      t469 = 1/t261/t246
      t470 = t260*t469
      t473 = -0.2682296D-1*t272*t247+0.126906576D-2*t459*t272
     #-0.1363476096D-4*t462*t272+0.728718336D-7*t465*t272
     #-0.18573525504D-9*t470*t272
      vrhoa(i) = -0.12407009817988D1*t4*t43-0.9305257363491D0*t5*t301
     #-0.3109D-1*t304*t80+0.1321010150222857D-2*t308*t81+0.1D1*t313
     #*t332-0.3109D-1*t50*t348+t455*t265+t240*t473
      t477 = t86*rhob
      t479 = 1/t87/t477
      t480 = sigmabb*t479
      t483 = t97*t86
      t485 = 1/t84/t483
      t486 = t96*t485
      t490 = 1/t107/rhob
      t491 = t106*t490
      t496 = 1/t87/t107/t477
      t497 = t114*t496
      t500 = t114*sigmabb
      t503 = 1/t84/t107/t483
      t504 = t500*t503
      t506 = 1/t119/t92
      t509 = 0.7936597333333333D-2*t480*t93-0.5095447893333333D-3*t486
     #*t103+0.538536448D-5*t491*t111-0.2616712533333333D-7*t497*t120
     #+0.4908176725333333D-10*t504*t506
      t512 = t129*t142
      t515 = 1/t136
      t516 = t126*t515
      t519 = t138**2
      t520 = 1/t519
      t521 = t130*t520
      t522 = t131**2
      t523 = t522**2
      t524 = t523*t131
      t525 = 1/t524
      t526 = 1/t86
      t531 = 1/t134
      t534 = 1/t127
      t537 = -0.1853395810515781D1*t525*t526-0.128158207914907D1*t515
     #*t526-0.8223668877838045D0*t531*t526-0.1603914194192128D0*t534
     #*t526
      t538 = 1/t141
      t539 = t537*t538
      t540 = t539*t160
      t552 = 1/t156/t144
      t555 = 0.1805984D-1*t480*t145-0.9416746666666667D-3*t486*t149
     #+0.5082568533333333D-1*t491*t153-0.3679286613333333D-1*t497*t157
     #+0.5304183466666667D-2*t504*t552
      t556 = t142*t555
      t559 = -t400-t396
      t562 = t165+t395
      t565 = 0.1333333333333333D1*t199*t559+0.1333333333333333D1*t203
     #*t562
      t567 = t194*t565*t213
      t568 = 0.3799574853701528D-1*t567
      t569 = t410+t414
      t571 = t194*t205*t569
      t572 = 0.3799574853701528D-1*t571
      t573 = t230*t565
      t574 = t573*t211
      t575 = 0.1923661050931536D1*t574
      t583 = t520*t537*t538
      t586 = -t182+t216+t233+t164*(t355+t376-t380-t394+t568+t572+t438
     #+t575-0.7694644203726145D1*t442-t445)+0.3109D-1*t512
     #-0.1321010150222857D-2*t516*t142-0.1D1*t130*t583
      t598 = -0.2682296D-1*t480*t247+0.126906576D-2*t459*t480
     #-0.1363476096D-4*t462*t480+0.728718336D-7*t465*t480
     #-0.18573525504D-9*t470*t480
      vrhob(i) = -0.12407009817988D1*t84*t123-0.9305257363491D0*t85
     #*t509-0.3109D-1*t512*t160+0.1321010150222857D-2*t516*t161+0.1D1
     #*t521*t540-0.3109D-1*t130*t556+t586*t265+t240*t598
      t602 = sigmaaa*t20
      t605 = t16*t28
      t608 = t26*t37
      t613 = 1/t4/t27/t18
      t614 = t34*t613
      t617 = -0.2976224D-2*t9*t13+0.191079296D-3*t602*t23
     #-0.201951168D-5*t605*t31+0.9812672D-8*t608*t40-0.1840566272D-10
     #*t614*t298
      t630 = -0.677244D-2*t9*t65+0.353128D-3*t602*t69-0.19059632D-1
     #*t605*t73+0.137973248D-1*t608*t77-0.19890688D-2*t614*t344
      t631 = t62*t630
      t644 = 0.1005861D-1*t9*t247-0.47589966D-3*t459*t9+0.511303536D-5
     #*t462*t9-0.273269376D-7*t465*t9+0.6965072064D-10*t470*t9
      vsigmaaa(i) = -0.9305257363491D0*t5*t617-0.3109D-1*t50*t631+t240
     #*t644
      vsigmaab(i) = 0.D0
      t648 = sigmabb*t100
      t651 = t96*t108
      t654 = t106*t117
      t659 = 1/t84/t107/t98
      t660 = t114*t659
      t663 = -0.2976224D-2*t89*t93+0.191079296D-3*t648*t103
     #-0.201951168D-5*t651*t111+0.9812672D-8*t654*t120
     #-0.1840566272D-10*t660*t506
      t676 = -0.677244D-2*t89*t145+0.353128D-3*t648*t149-0.19059632D-1
     #*t651*t153+0.137973248D-1*t654*t157-0.19890688D-2*t660*t552
      t677 = t142*t676
      t690 = 0.1005861D-1*t89*t247-0.47589966D-3*t459*t89
     #+0.511303536D-5*t462*t89-0.273269376D-7*t465*t89
     #+0.6965072064D-10*t470*t89
      vsigmabb(i) = -0.9305257363491D0*t85*t663-0.3109D-1*t130*t677
     #+t240*t690
      t694 = sigmaaa/t7/t17
      t697 = t17*t269
      t700 = t16/t4/t697
      t704 = t26/t35
      t710 = t34/t7/t27/t17
      t716 = t292/t4/t27/t697
      t720 = t27**2
      t723 = t34*t16/t720/t6
      t725 = 1/t39/t22
      t736 = 0.2D1*t375
      t739 = 0.1538928840745229D2*t444
      t740 = 0.3847322101863073D1*t437
      t741 = 0.1748158859896213D-2*t379
      t742 = 0.2249999913366216D1*t393
      t744 = 0.5495599555936838D-2*t354
      t751 = 1/t361/t165*t210
      t754 = 1/t208/t164
      t755 = t362*t754
      t759 = 1/t174/t165*t210
      t761 = t351*t754
      t765 = 1/t172/t165*t210
      t767 = t366*t754
      t771 = 1/t166/t165*t210
      t773 = t369*t754
      t777 = t358*(-0.8309097827459833D0*t751+0.199418347859036D1*t755
     #-0.4945709824779306D0*t759+0.1483712947433792D1*t761
     #-0.2001071587498409D0*t765+0.8004286349993634D0*t767
     #-0.4215565168327908D-1*t771+0.2529339100996745D0*t773)*t373
      t778 = 0.1D1*t777
      t782 = t372**2
      t784 = t168/t356/t176*t782*t373
      t785 = 0.2D1*t784
      t787 = 0.1748158859896213D-2*t761*t378
      t788 = t759*t180
      t789 = 0.1831866518645613D-2*t788
      t790 = t761*t180
      t791 = 0.5495599555936838D-2*t790
      t794 = t353*t357*t372*t373
      t795 = 0.8837926660346786D-1*t794
      t796 = t356**2
      t799 = t179**2
      t802 = t168/t796*t782/t799
      t803 = 0.160818243221511D2*t802
      t815 = t428**2
      t831 = t421**2
      t834 = t226**2
      t845 = 0.8806734334819047D-3*t759*t227-0.2642020300445714D-2
     #*t761*t227-0.8497974591333914D-1*t353*t422*t428*t429-0.2D1*t218
     #/t421/t223*t815*t429+0.1D1*t423*(-0.1544496508763151D1*t751
     #+0.3706791621031562D1*t755-0.854388052766047D0*t759
     #+0.2563164158298141D1*t761-0.4111834438919023D0*t765
     #+0.1644733775567609D1*t767-0.5346380647307093D-1*t771
     #+0.3207828388384256D0*t773)*t429+0.321646831778707D2*t218/t831
     #*t815/t834-0.1831866518645613D-2*t788+0.5495599555936838D-2*t790
     #+0.8837926660346786D-1*t794+0.2D1*t784-0.1D1*t777
     #-0.160818243221511D2*t802
      t848 = 0.1923661050931536D1*t845*t205*t211
      t849 = t199**2
      t850 = 1/t849
      t851 = t397**2
      t854 = 2.D0*t352
      t856 = 2.D0*t196*t754
      t857 = -t854+t856
      t860 = t203**2
      t861 = 1/t860
      t862 = t401**2
      t868 = 0.4444444444444444D0*t850*t851+0.1333333333333333D1*t199
     #*t857+0.4444444444444444D0*t861*t862-0.1333333333333333D1*t203
     #*t857
      t872 = t381**2
      t875 = t388**2
      t877 = t192**2
      t882 = 0.3330964519106732D2*t184/t872*t875/t877*t205*t213
      t884 = t389*t391*t415
      t888 = t389*t390*t404*t213
      t895 = 0.2249999913366216D1*t184/t381/t189*t875*t392
      t896 = 0.7599149707403056D-1*t194*t404*t415+t778-t785+t787+t789
     #-t791-t795+t803+t848+0.3799574853701528D-1*t194*t868*t213-t882
     #-0.2249999913366216D1*t884-0.2249999913366216D1*t888+t895
      t908 = 0.1124999956683108D1*t383*(-0.1132974264373283D1*t751
     #+0.271913823449588D1*t755-0.4994648585728036D0*t759
     #+0.1498394575718411D1*t761-0.1075243117819161D0*t765
     #+0.4300972471276643D0*t767-0.4247805766949639D-1*t771
     #+0.2548683460169784D0*t773)*t392
      t910 = 0.5827196199654043D-3*t759*t378
      t913 = t353*t193*t404*t213
      t916 = t353*t377*t415
      t922 = 0.5176049209143758D-1*t353*t382*t388*t390*t214
      t923 = t436*t409
      t926 = 0.1538928840745229D2*t436*t413
      t928 = t435*t404*t211
      t930 = t206*t210
      t931 = t231*t930
      t932 = 0.2308393261117844D2*t931
      t933 = t408*t412
      t934 = t231*t933
      t936 = 12.D0*t930
      t937 = 32.D0*t933
      t940 = t207/t209/t208
      t941 = 20.D0*t940
      t946 = t439*t413
      t948 = t439*t409
      t954 = 0.3847322101863073D2*t231*t940
      t955 = -t908-t910-0.1748158859896213D-2*t913
     #-0.1748158859896213D-2*t916+t922+0.1538928840745229D2*t923-t926
     #+0.3847322101863073D1*t928+t932-0.6155715362980916D2*t934
     #+0.3799574853701528D-1*t194*t205*(-t936+t937-t941)
     #-0.1538928840745229D2*t946+0.1538928840745229D2*t948
     #+0.1923661050931536D1*t230*t868*t211+t954
      t960 = 1/t17
      t963 = 1/t269
      t967 = 1/t56/t46
      t984 = -0.1544496508763151D1/t316/t46*t960+0.3706791621031562D1
     #*t317*t963-0.854388052766047D0*t967*t960+0.2563164158298141D1
     #*t307*t963-0.4111834438919023D0/t54/t46*t960
     #+0.1644733775567609D1*t323*t963-0.5346380647307093D-1/t47/t46
     #*t960+0.3207828388384256D0*t326*t963
      t990 = 1/t311/t58
      t991 = t329**2
      t996 = t963*t967
      t1001 = t49*t312
      t1004 = t311**2
      t1005 = 1/t1004
      t1007 = t61**2
      t1008 = 1/t1007
      t1012 = t736+0.3847322101863073D1*t440+0.1538928840745229D2*t442
     #-t739+t740-t741-t742+0.7599149707403056D-1*t406+t744
     #+0.7599149707403056D-1*t417+t164*(t896+t955)-0.1D1*t50*t312*t984
     #*t330+0.2D1*t50*t990*t991*t330-0.8806734334819047D-3*t996*t62
     #+0.8497974591333914D-1*t308*t452-0.2D1*t1001*t331
     #-0.321646831778707D2*t50*t1005*t991*t1008
      t1031 = 1/t76/t68
      t1066 = t243*t257
      t1071 = t250*t262
      t1076 = t255*t469
      t1083 = t260/t261/t251
      s1 = -0.9305257363491D0*t5*(-0.2910085688888889D-1*t694*t13
     #+0.3311774037333333D-2*t700*t23-0.5933856915911111D-4*t704*t31
     #+0.4776147922488889D-6*t710*t40-0.1819969344853333D-8*t716*t298
     #+0.2617694253511111D-11*t723*t725)-0.4135669939329333D0/t7*t43
     #-0.24814019635976D1*t4*t301+t1012*t265+0.2642020300445714D-2
     #*t308*t348+0.2D1*t1001*t332-0.6218D-1*t304*t347-0.3109D-1*t50
     #*t62*(-0.6621941333333333D-1*t694*t65+0.1559585422222222D-1*t700
     #*t69-0.4584356209777778D0*t704*t73+0.5105712014222222D0*t710*t77
     #-0.15451807744D0*t716*t344+0.1414448924444444D-1*t723*t1031)
      v2rhoa2(i) = s1+0.1D1*t313*t984*t330*t80-0.2D1*t50*t990*t991
     #*t330*t80-0.8497974591333914D-1*t308*t312*t332
     #+0.8806734334819047D-3*t996*t81+0.321646831778707D2*t50*t1005
     #*t991*t1008*t80+0.2D1*t313*t331*t347+2.D0*t455*t473+t240*
     #(0.9835085333333333D-1*t694*t247-0.190667136D-2*t700*t252
     #+0.5666441472D-4*t1066*t700-0.465324112D-2*t459*t694
     #-0.61872159744D-6*t1071*t700+0.4999412352D-4*t462*t694
     #+0.332248670208D-8*t1076*t700-0.2671967232D-6*t465*t694
     #-0.74294102016D-11*t1083*t700+0.68102926848D-9*t470*t694)
      t1092 = sigmabb/t87/t97
      t1095 = t97*t477
      t1098 = t96/t84/t1095
      t1102 = t106/t115
      t1108 = t114/t87/t107/t97
      t1114 = t500/t84/t107/t1095
      t1118 = t107**2
      t1121 = t114*t96/t1118/t86
      t1123 = 1/t119/t102
      t1134 = t519**2
      t1135 = 1/t1134
      t1137 = t537**2
      t1138 = t141**2
      t1139 = 1/t1138
      t1146 = 1/t97
      t1149 = 1/t477
      t1153 = 1/t136/t126
      t1170 = -0.1544496508763151D1/t524/t126*t1146
     #+0.3706791621031562D1*t525*t1149-0.854388052766047D0*t1153*t1146
     #+0.2563164158298141D1*t515*t1149-0.4111834438919023D0/t134/t126
     #*t1146+0.1644733775567609D1*t531*t1149-0.5346380647307093D-1
     #/t127/t126*t1146+0.3207828388384256D0*t534*t1149
      t1176 = 1/t519/t138
      t1184 = t1149*t1153
      t1190 = t129*t520
      t1206 = t559**2
      t1209 = t854+t856
      t1212 = t562**2
      t1218 = 0.4444444444444444D0*t850*t1206+0.1333333333333333D1
     #*t199*t1209+0.4444444444444444D0*t861*t1212-0.1333333333333333D1
     #*t203*t1209
      t1227 = t353*t193*t565*t213
      t1230 = t353*t377*t569
      t1232 = t573*t409
      t1234 = t573*t413
      t1240 = t435*t565*t211
      t1242 = 0.3799574853701528D-1*t194*t205*(-t936-t937-t941)
     #+0.3799574853701528D-1*t194*t1218*t213+0.7599149707403056D-1
     #*t194*t565*t569-0.1748158859896213D-2*t1227
     #-0.1748158859896213D-2*t1230-0.1538928840745229D2*t1232
     #-0.1538928840745229D2*t1234+0.1923661050931536D1*t230*t1218*t211
     #+0.3847322101863073D1*t1240+t778-t785+t787+t789-t791
      t1245 = t389*t390*t565*t213
      t1248 = t389*t391*t569
      t1252 = -t795+t803+t848-0.2249999913366216D1*t1245-t882+t895
     #-t908-t910-0.2249999913366216D1*t1248+t922-0.1538928840745229D2
     #*t923-t926+t932+0.6155715362980916D2*t934+t954
      t1273 = t736-0.1538928840745229D2*t442-t739+t740-t741-t742+t744
     #+0.3847322101863073D1*t574+0.7599149707403056D-1*t571
     #+0.7599149707403056D-1*t567+t164*(t1242+t1252)-0.2D1*t1190*t539
     #-0.321646831778707D2*t130*t1135*t1137*t1139-0.1D1*t130*t520
     #*t1170*t538+0.2D1*t130*t1176*t1137*t538-0.8806734334819047D-3
     #*t1184*t142+0.8497974591333914D-1*t516*t583
      t1286 = 1/t156/t148
      s1 = -0.9305257363491D0*t85*(-0.2910085688888889D-1*t1092*t93
     #+0.3311774037333333D-2*t1098*t103-0.5933856915911111D-4*t1102
     #*t111+0.4776147922488889D-6*t1108*t120-0.1819969344853333D-8
     #*t1114*t506+0.2617694253511111D-11*t1121*t1123)
     #-0.4135669939329333D0/t87*t123-0.24814019635976D1*t84*t509
     #+0.321646831778707D2*t130*t1135*t1137*t1139*t160+0.1D1*t521
     #*t1170*t538*t160-0.2D1*t130*t1176*t1137*t538*t160
     #+0.2642020300445714D-2*t516*t556+0.8806734334819047D-3*t1184*t161
      v2rhob2(i) = s1-0.8497974591333914D-1*t516*t520*t540+0.2D1*t1190
     #*t540+0.2D1*t521*t539*t555-0.6218D-1*t512*t555+t1273*t265
     #-0.3109D-1*t130*t142*(-0.6621941333333333D-1*t1092*t145
     #+0.1559585422222222D-1*t1098*t149-0.4584356209777778D0*t1102
     #*t153+0.5105712014222222D0*t1108*t157-0.15451807744D0*t1114*t552
     #+0.1414448924444444D-1*t1121*t1286)+t240*(0.9835085333333333D-1
     #*t1092*t247-0.190667136D-2*t1098*t252+0.5666441472D-4*t1066
     #*t1098-0.465324112D-2*t459*t1092-0.61872159744D-6*t1071*t1098
     #+0.4999412352D-4*t462*t1092+0.332248670208D-8*t1076*t1098
     #-0.2671967232D-6*t465*t1092-0.74294102016D-11*t1083*t1098
     #+0.68102926848D-9*t470*t1092)+2.D0*t586*t598
      t1325 = -0.8740794299481065D-3*t1227-0.8740794299481065D-3*t1230
     #+0.7694644203726145D1*t1232-0.7694644203726145D1*t1234
     #+0.1923661050931536D1*t1240+t778-t785+t787+t789-t791-t795+t803
     #+t848-0.1124999956683108D1*t1245-t882-0.1124999956683108D1*t884
     #-0.1124999956683108D1*t888
      t1355 = 0.4444444444444444D0*t850*t397*t559+0.2666666666666667D1
     #*t199*t196*t754+0.4444444444444444D0*t861*t401*t562
     #-0.2666666666666667D1*t203*t196*t754
      t1362 = t895-t908-t910-0.1124999956683108D1*t1248
     #-0.8740794299481065D-3*t913-0.8740794299481065D-3*t916+t922-t926
     #+0.1923661050931536D1*t928-0.2308393261117844D2*t931
     #-0.7694644203726145D1*t946-0.7694644203726145D1*t948+t954
     #+0.3799574853701528D-1*t194*t404*t569+0.3799574853701528D-1*t194
     #*t205*(t936-t941)+0.3799574853701528D-1*t194*t565*t415
     #+0.3799574853701528D-1*t194*t1355*t213+0.1923661050931536D1*t230
     #*t1355*t211
      t1365 = t744+t736-t741-t742+t568+t572+t740+t575-t739+t407+t418
     #+t441+t164*(t1325+t1362)
      t1378 = t271*sigmabb*t479
      v2rhoab(i) = 0.1D1*t1365*t265+0.1D1*t455*t598+0.1D1*t586*t473
     #+0.1D1*t240*(-0.190667136D-2*t272*t252*sigmabb*t479
     #+0.5666441472D-4*t1066*sigmaaa*t1378-0.61872159744D-6*t1071
     #*sigmaaa*t1378+0.332248670208D-8*t1076*sigmaaa*t1378
     #-0.74294102016D-11*t1083*sigmaaa*t1378)
      t1397 = sigmaaa*t277
      t1400 = t16*t282
      t1403 = t26*t288
      t1406 = t34*t295
      t1411 = t292/t720/rhoa
      s1 = -0.12407009817988D1*t4*t617-0.9305257363491D0*t5*
     #(0.7936597333333333D-2*t271*t13-0.1050835968D-2*t1397*t23
     #+0.2023245175466667D-4*t1400*t31-0.1692928750933333D-6*t1403*t40
     #+0.6640828416D-9*t1406*t298-0.9816353450666667D-12*t1411*t725)
     #-0.3109D-1*t304*t630+0.1321010150222857D-2*t308*t631
      v2rhoasigmaaa(i) = s1+0.1D1*t313*t331*t630-0.3109D-1*t50*t62*
     #(0.1805984D-1*t271*t65-0.5495317333333333D-2*t1397*t69
     #+0.1528537258666667D0*t1400*t73-0.1776668757333333D0*t1403*t77
     #+0.5595521024D-1*t1406*t344-0.5304183466666667D-2*t1411*t1031)
     #+t455*t644+t240*(-0.2682296D-1*t271*t247+0.71500176D-3*t1397
     #*t252-0.2124915552D-4*t1066*t1397+0.126906576D-2*t459*t271
     #+0.23202059904D-6*t1071*t1397-0.1363476096D-4*t462*t271
     #-0.124593251328D-8*t1076*t1397+0.728718336D-7*t465*t271
     #+0.27860288256D-11*t1083*t1397-0.18573525504D-9*t470*t271)
      v2rhoasigmaab(i) = 0.D0
      t1467 = t272*t89
      v2rhoasigmabb(i) = t455*t690+t240*(0.71500176D-3*t272*t252*t89
     #-0.2124915552D-4*t1066*t1467+0.23202059904D-6*t1071*t1467
     #-0.124593251328D-8*t1076*t1467+0.27860288256D-11*t1083*t1467)
      t1479 = t252*t9
      t1482 = t480*t9
      v2rhobsigmaaa(i) = t586*t644+t240*(0.71500176D-3*t480*t1479
     #-0.2124915552D-4*t1066*t1482+0.23202059904D-6*t1071*t1482
     #-0.124593251328D-8*t1076*t1482+0.27860288256D-11*t1083*t1482)
      v2rhobsigmaab(i) = 0.D0
      t1497 = sigmabb*t485
      t1500 = t96*t490
      t1503 = t106*t496
      t1506 = t114*t503
      t1511 = t500/t1118/rhob
      s1 = -0.12407009817988D1*t84*t663-0.9305257363491D0*t85*
     #(0.7936597333333333D-2*t479*t93-0.1050835968D-2*t1497*t103
     #+0.2023245175466667D-4*t1500*t111-0.1692928750933333D-6*t1503
     #*t120+0.6640828416D-9*t1506*t506-0.9816353450666667D-12*t1511
     #*t1123)-0.3109D-1*t512*t676+0.1321010150222857D-2*t516*t677
      v2rhobsigmabb(i) = s1+0.1D1*t521*t539*t676-0.3109D-1*t130*t142*
     #(0.1805984D-1*t479*t145-0.5495317333333333D-2*t1497*t149
     #+0.1528537258666667D0*t1500*t153-0.1776668757333333D0*t1503*t157
     #+0.5595521024D-1*t1506*t552-0.5304183466666667D-2*t1511*t1286)
     #+t586*t690+t240*(-0.2682296D-1*t479*t247+0.71500176D-3*t1497
     #*t252-0.2124915552D-4*t1066*t1497+0.126906576D-2*t459*t479
     #+0.23202059904D-6*t1071*t1497-0.1363476096D-4*t462*t479
     #-0.124593251328D-8*t1076*t1497+0.728718336D-7*t465*t479
     #+0.27860288256D-11*t1083*t1497-0.18573525504D-9*t470*t479)
      t1565 = sigmaaa*t28
      t1568 = t16*t37
      t1571 = t26*t613
      t1575 = t34/t720
      v2sigmaaa2(i) = -0.9305257363491D0*t5*(0.202984192D-3*t20*t23
     #-0.5567657728D-5*t1565*t31+0.5367215616D-7*t1568*t40
     #-0.23062540288D-9*t1571*t298+0.3681132544D-12*t1575*t725)
     #-0.3109D-1*t50*t62*(0.1707616D-2*t20*t69-0.382605152D-1*t1565
     #*t73+0.528277536D-1*t1568*t77-0.1899413504D-1*t1571*t344
     #+0.19890688D-2*t1575*t1031)+t240*(-0.26812566D-3*t20*t252
     #+0.796843332D-5*t1066*t20-0.8700772464D-7*t1071*t20
     #+0.46722469248D-9*t1076*t20-0.10447608096D-11*t1083*t20)
      v2sigmaaaab(i) = 0.D0
      t1609 = t9*t89
      v2sigmaaabb(i) = t240*(-0.26812566D-3*t1479*t89+0.796843332D-5
     #*t1066*t1609-0.8700772464D-7*t1071*t1609+0.46722469248D-9*t1076
     #*t1609-0.10447608096D-11*t1083*t1609)
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      t1621 = sigmabb*t108
      t1624 = t96*t117
      t1627 = t106*t659
      t1631 = t114/t1118
      v2sigmabb2(i) = -0.9305257363491D0*t85*(0.202984192D-3*t100*t103
     #-0.5567657728D-5*t1621*t111+0.5367215616D-7*t1624*t120
     #-0.23062540288D-9*t1627*t506+0.3681132544D-12*t1631*t1123)
     #-0.3109D-1*t130*t142*(0.1707616D-2*t100*t149-0.382605152D-1
     #*t1621*t153+0.528277536D-1*t1624*t157-0.1899413504D-1*t1627*t552
     #+0.19890688D-2*t1631*t1286)+t240*(-0.26812566D-3*t100*t252
     #+0.796843332D-5*t1066*t100-0.8700772464D-7*t1071*t100
     #+0.46722469248D-9*t1076*t100-0.10447608096D-11*t1083*t100)
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      v2rhob2(i) = 0.0d0
      v2rhoab(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2rhoasigmaab(i) = 0.0d0
      v2rhoasigmabb(i) = 0.0d0
      v2rhobsigmaaa(i) = 0.0d0
      v2rhobsigmaab(i) = 0.0d0
      v2rhobsigmabb(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      v2sigmaab2(i) = 0.0d0
      v2sigmabb2(i) = 0.0d0
      v2sigmaaaab(i) = 0.0d0
      v2sigmaaabb(i) = 0.0d0
      v2sigmaabbb(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end
      
      
      subroutine rks_xc_hcth
     & (ideriv,npt,rhoa1,sigmaaa1,
     &  zk,vrhoa,vsigmaaa,
     &  v2rhoa2,v2rhoasigmaaa,v2sigmaaa2)
c
c     F.A. Hamprecht, A.J. Cohen, D.J. Tozer, and N.C. Handy
c     Development and assessment of new exchange-correlation functionals
c     J. Chem. Phys. 109 (1998) 6264-6271
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt)
      REAL sigmaaa1(npt)
      REAL zk(npt),vrhoa(npt),vsigmaaa(npt)
      REAL v2rhoa2(npt),v2rhoasigmaaa(npt),v2sigmaaa2(npt)
      parameter(tol=1.0d-20)
      
      if(ideriv.eq.0) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t4 = rho**2
      t5 = t2**2
      t8 = sigma/t5/t4
      t10 = 1.D0+0.6349604207872798D-2*t8
      t14 = sigma**2
      t15 = t4**2
      t19 = t14/t2/t15/rho
      t20 = t10**2
      t25 = t15**2
      t27 = t14*sigma/t25
      t32 = t14**2
      t36 = t32/t5/t25/t4
      t37 = t20**2
      t44 = 1/rho
      t45 = t44**(1.D0/3.D0)
      t48 = rho*(1.D0+0.1606016560364007D0*t45)
      t49 = t44**(1.D0/6.D0)
      t52 = dsqrt(t44)
      t54 = t45**2
      t60 = dlog(1.D0+0.321646831778707D2/(0.1248219874679732D2*t49
     #+0.4844076716063854D1*t45+0.2326004811900819D1*t52
     #+0.3819082618690966D0*t54))
      t62 = 1.D0+0.3174802103936399D0*t8
      t66 = t62**2
      t74 = t66**2
      t93 = dlog(1.D0+0.160818243221511D2/(0.598255043577108D1*t49
     #+0.2225569421150687D1*t45+0.8004286349993634D0*t52
     #+0.1897004325747559D0*t54))
      t100 = 1.D0+0.9524406311809197D-2*t8
      t104 = t100**2
      t112 = t104**2
      zk(i) = -0.7385587663820224D0*t2*rho*(0.10932D1
     #-0.4724461108493003D-2*t8/t10+0.225745598162284D-3*t19/t20
     #-0.173708544D-5*t27/t20/t10+0.7304292090974968D-8*t36/t37)
     #-0.3109D-1*t48*t60*(0.222601D0-0.1075057838039151D-1*t8/t62
     #-0.126163454252273D-2*t19/t66-0.25679872D-1*t27/t66/t62
     #+0.1578724952778562D-1*t36/t74)+(-0.62182D-1*rho*(1.D0
     #+0.1325688999052018D0*t45)*t93+0.3109D-1*t48*t60)*(0.729974D0
     #+0.319340961906757D-1*t8/t100-0.104711534488343D-2*t19/t104
     #+0.698599296D-5*t27/t104/t100-0.3685454240475973D-7*t36/t112)
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t3 = t2*rho
      t4 = rho**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigma*t7
      t10 = 1.D0+0.6349604207872798D-2*t8
      t11 = 1/t10
      t14 = sigma**2
      t15 = t4**2
      t16 = t15*rho
      t18 = 1/t2/t16
      t19 = t14*t18
      t20 = t10**2
      t21 = 1/t20
      t24 = t14*sigma
      t25 = t15**2
      t26 = 1/t25
      t27 = t24*t26
      t29 = 1/t20/t10
      t32 = t14**2
      t35 = 1/t5/t25/t4
      t36 = t32*t35
      t37 = t20**2
      t38 = 1/t37
      t41 = 0.10932D1-0.4724461108493003D-2*t8*t11
     #+0.225745598162284D-3*t19*t21-0.173708544D-5*t27*t29
     #+0.7304292090974968D-8*t36*t38
      t44 = 1/rho
      t45 = t44**(1.D0/3.D0)
      t47 = 1.D0+0.1606016560364007D0*t45
      t48 = rho*t47
      t49 = t44**(1.D0/6.D0)
      t52 = dsqrt(t44)
      t54 = t45**2
      t56 = 0.1248219874679732D2*t49+0.4844076716063854D1*t45
     #+0.2326004811900819D1*t52+0.3819082618690966D0*t54
      t59 = 1.D0+0.321646831778707D2/t56
      t60 = dlog(t59)
      t62 = 1.D0+0.3174802103936399D0*t8
      t63 = 1/t62
      t66 = t62**2
      t67 = 1/t66
      t71 = 1/t66/t62
      t74 = t66**2
      t75 = 1/t74
      t78 = 0.222601D0-0.1075057838039151D-1*t8*t63
     #-0.126163454252273D-2*t19*t67-0.25679872D-1*t27*t71
     #+0.1578724952778562D-1*t36*t75
      t79 = t60*t78
      t83 = 1.D0+0.1325688999052018D0*t45
      t89 = 0.598255043577108D1*t49+0.2225569421150687D1*t45
     #+0.8004286349993634D0*t52+0.1897004325747559D0*t54
      t92 = 1.D0+0.160818243221511D2/t89
      t93 = dlog(t92)
      t98 = -0.62182D-1*rho*t83*t93+0.3109D-1*t48*t60
      t100 = 1.D0+0.9524406311809197D-2*t8
      t101 = 1/t100
      t104 = t100**2
      t105 = 1/t104
      t109 = 1/t104/t100
      t112 = t104**2
      t113 = 1/t112
      t116 = 0.729974D0+0.319340961906757D-1*t8*t101
     #-0.104711534488343D-2*t19*t105+0.698599296D-5*t27*t109
     #-0.3685454240475973D-7*t36*t113
      zk(i) = -0.7385587663820224D0*t3*t41-0.3109D-1*t48*t79+t98*t116
      t120 = t4*rho
      t123 = sigma/t5/t120
      t126 = t15*t4
      t129 = t14/t2/t126
      t134 = t24/t25/rho
      t140 = t32/t5/t25/t120
      t147 = t32*sigma/t2/t25/t126
      t149 = 1/t37/t10
      t155 = t47*t60
      t158 = 1/t54
      t159 = t44*t158
      t162 = t56**2
      t163 = 1/t162
      t165 = t49**2
      t166 = t165**2
      t169 = 1/t4
      t170 = 1/t166/t49*t169
      t172 = t158*t169
      t175 = 1/t52*t169
      t178 = 1/t45*t169
      t180 = -0.4160732915599108D1*t170-0.3229384477375903D1*t172
     #-0.2326004811900819D1*t175-0.5092110158254621D0*t178
      t181 = 1/t59
      t195 = 1/t74/t62
      t206 = t89**2
      t238 = 1/t112/t100
      s1 = -0.9847450218426965D0*t2*t41-0.3692793831910112D0*t3*
     #(0.2519712591196268D-1*t123*t11-0.2567944823781261D-2*t129*t21
     #+0.4308291584D-4*t134*t29-0.3323017782489364D-6*t140*t38
     #+0.9894264276562486D-9*t147*t149)-0.3109D-1*t155*t78
     #+0.1664368495390566D-2*t159*t79
      vrhoa(i) = s1+0.5D0*t48*t163*t180*t181*t78-0.15545D-1*t48*t60*
     #(0.5733641802875474D-1*t123*t63-0.4745742938744286D-2*t129*t67
     #+0.4066054826666667D0*t134*t71-0.4672402752398278D0*t140*t75
     #+0.1069256384345231D0*t147*t195)+(-0.62182D-1*t83*t93+rho*
     #(0.2747799777968419D-2*t172*t93+0.1D1*t83/t206*(
     #-0.99709173929518D0*t170-0.7418564737168958D0*t172
     #-0.4002143174996817D0*t175-0.1264669550498372D0*t178)/t92)
     #+0.3109D-1*t155-0.1664368495390566D-2*t159*t60-0.5D0*t48*t163
     #*t180*t181)*t116+t98*(-0.8515758984180187D-1*t123*t101
     #+0.6395690658899341D-2*t129*t105-0.10907808768D-3*t134*t109
     #+0.9254146025239327D-6*t140*t113-0.3744188120519821D-8*t147*t238)
      t245 = sigma*t18
      t248 = t14*t26
      t251 = t24*t35
      t257 = t32/t2/t25/t16
      vsigmaaa(i) = -0.7385587663820224D0*t3*(-0.1889784443397201D-1
     #*t7*t11+0.1925958617835946D-2*t245*t21-0.3231218688D-4*t248*t29
     #+0.2492263336867023D-6*t251*t38-0.7420698207421865D-9*t257*t149)
     #-0.3109D-1*t48*t60*(-0.4300231352156605D-1*t7*t63
     #+0.3559307204058214D-2*t245*t67-0.304954112D0*t248*t71
     #+0.3504302064298708D0*t251*t75-0.8019422882589234D-1*t257*t195)
     #+2.D0*t98*(0.638681923813514D-1*t7*t101-0.4796767994174505D-2
     #*t245*t105+0.8180856576D-4*t248*t109-0.6940609518929495D-6*t251
     #*t113+0.2808141090389866D-8*t257*t238)
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t3 = t2*rho
      t4 = rho**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigma*t7
      t10 = 1.D0+0.6349604207872798D-2*t8
      t11 = 1/t10
      t14 = sigma**2
      t15 = t4**2
      t16 = t15*rho
      t18 = 1/t2/t16
      t19 = t14*t18
      t20 = t10**2
      t21 = 1/t20
      t24 = t14*sigma
      t25 = t15**2
      t26 = 1/t25
      t27 = t24*t26
      t29 = 1/t20/t10
      t32 = t14**2
      t33 = t25*t4
      t35 = 1/t5/t33
      t36 = t32*t35
      t37 = t20**2
      t38 = 1/t37
      t41 = 0.10932D1-0.4724461108493003D-2*t8*t11
     #+0.225745598162284D-3*t19*t21-0.173708544D-5*t27*t29
     #+0.7304292090974968D-8*t36*t38
      t44 = 1/rho
      t45 = t44**(1.D0/3.D0)
      t47 = 1.D0+0.1606016560364007D0*t45
      t48 = rho*t47
      t49 = t44**(1.D0/6.D0)
      t52 = dsqrt(t44)
      t54 = t45**2
      t56 = 0.1248219874679732D2*t49+0.4844076716063854D1*t45
     #+0.2326004811900819D1*t52+0.3819082618690966D0*t54
      t59 = 1.D0+0.321646831778707D2/t56
      t60 = dlog(t59)
      t62 = 1.D0+0.3174802103936399D0*t8
      t63 = 1/t62
      t66 = t62**2
      t67 = 1/t66
      t71 = 1/t66/t62
      t74 = t66**2
      t75 = 1/t74
      t78 = 0.222601D0-0.1075057838039151D-1*t8*t63
     #-0.126163454252273D-2*t19*t67-0.25679872D-1*t27*t71
     #+0.1578724952778562D-1*t36*t75
      t79 = t60*t78
      t83 = 1.D0+0.1325688999052018D0*t45
      t89 = 0.598255043577108D1*t49+0.2225569421150687D1*t45
     #+0.8004286349993634D0*t52+0.1897004325747559D0*t54
      t92 = 1.D0+0.160818243221511D2/t89
      t93 = dlog(t92)
      t98 = -0.62182D-1*rho*t83*t93+0.3109D-1*t48*t60
      t100 = 1.D0+0.9524406311809197D-2*t8
      t101 = 1/t100
      t104 = t100**2
      t105 = 1/t104
      t109 = 1/t104/t100
      t112 = t104**2
      t113 = 1/t112
      t116 = 0.729974D0+0.319340961906757D-1*t8*t101
     #-0.104711534488343D-2*t19*t105+0.698599296D-5*t27*t109
     #-0.3685454240475973D-7*t36*t113
      zk(i) = -0.7385587663820224D0*t3*t41-0.3109D-1*t48*t79+t98*t116
      t120 = t4*rho
      t122 = 1/t5/t120
      t123 = sigma*t122
      t126 = t15*t4
      t128 = 1/t2/t126
      t129 = t14*t128
      t133 = 1/t25/rho
      t134 = t24*t133
      t139 = 1/t5/t25/t120
      t140 = t32*t139
      t143 = t32*sigma
      t146 = 1/t2/t25/t126
      t147 = t143*t146
      t149 = 1/t37/t10
      t152 = 0.2519712591196268D-1*t123*t11-0.2567944823781261D-2*t129
     #*t21+0.4308291584D-4*t134*t29-0.3323017782489364D-6*t140*t38
     #+0.9894264276562486D-9*t147*t149
      t155 = t47*t60
      t158 = 1/t54
      t159 = t44*t158
      t162 = t56**2
      t163 = 1/t162
      t164 = t48*t163
      t165 = t49**2
      t166 = t165**2
      t167 = t166*t49
      t168 = 1/t167
      t169 = 1/t4
      t170 = t168*t169
      t172 = t158*t169
      t174 = 1/t52
      t175 = t174*t169
      t177 = 1/t45
      t178 = t177*t169
      t180 = -0.4160732915599108D1*t170-0.3229384477375903D1*t172
     #-0.2326004811900819D1*t175-0.5092110158254621D0*t178
      t181 = 1/t59
      t182 = t180*t181
      t183 = t182*t78
      t195 = 1/t74/t62
      t198 = 0.5733641802875474D-1*t123*t63-0.4745742938744286D-2*t129
     #*t67+0.4066054826666667D0*t134*t71-0.4672402752398278D0*t140*t75
     #+0.1069256384345231D0*t147*t195
      t199 = t60*t198
      t204 = t172*t93
      t206 = t89**2
      t207 = 1/t206
      t208 = t83*t207
      t213 = -0.99709173929518D0*t170-0.7418564737168958D0*t172
     #-0.4002143174996817D0*t175-0.1264669550498372D0*t178
      t214 = 1/t92
      t216 = t208*t213*t214
      t224 = t163*t180*t181
      t227 = -0.62182D-1*t83*t93+rho*(0.2747799777968419D-2*t204+0.1D1
     #*t216)+0.3109D-1*t155-0.1664368495390566D-2*t159*t60-0.5D0*t48
     #*t224
      t230 = 0.8515758984180187D-1*t123*t101
      t232 = 0.6395690658899341D-2*t129*t105
      t234 = 0.10907808768D-3*t134*t109
      t235 = t140*t113
      t238 = 1/t112/t100
      t240 = 0.3744188120519821D-8*t147*t238
      t241 = -t230+t232-t234+0.9254146025239327D-6*t235-t240
      vrhoa(i) = -0.9847450218426965D0*t2*t41-0.3692793831910112D0*t3
     #*t152-0.3109D-1*t155*t78+0.1664368495390566D-2*t159*t79+0.5D0
     #*t164*t183-0.15545D-1*t48*t199+t227*t116+t98*t241
      t245 = sigma*t18
      t248 = t14*t26
      t251 = t24*t35
      t256 = 1/t2/t25/t16
      t257 = t32*t256
      t260 = -0.1889784443397201D-1*t7*t11+0.1925958617835946D-2*t245
     #*t21-0.3231218688D-4*t248*t29+0.2492263336867023D-6*t251*t38
     #-0.7420698207421865D-9*t257*t149
      t273 = -0.4300231352156605D-1*t7*t63+0.3559307204058214D-2*t245
     #*t67-0.304954112D0*t248*t71+0.3504302064298708D0*t251*t75
     #-0.8019422882589234D-1*t257*t195
      t274 = t60*t273
      t287 = 0.638681923813514D-1*t7*t101-0.4796767994174505D-2*t245
     #*t105+0.8180856576D-4*t248*t109-0.6940609518929495D-6*t251*t113
     #+0.2808141090389866D-8*t257*t238
      vsigmaaa(i) = -0.7385587663820224D0*t3*t260-0.3109D-1*t48*t274
     #+2.D0*t98*t287
      t292 = sigma/t5/t15
      t295 = t15*t120
      t298 = t14/t2/t295
      t299 = t298*t105
      t302 = t24/t33
      t303 = t302*t109
      t308 = t32/t5/t25/t15
      t309 = t308*t113
      t314 = t143/t2/t25/t295
      t315 = t314*t238
      t318 = t25**2
      t321 = t32*t14/t318/t4
      t323 = 1/t112/t104
      t325 = 0.4754822529024D-9*t321*t323
      t348 = 1/t37/t20
      t356 = t47*t163
      t370 = 1/t74/t66
      t377 = t162**2
      t378 = 1/t377
      t380 = t180**2
      t381 = t59**2
      t382 = 1/t381
      t389 = 1/t15
      t390 = 1/t167/t44*t389
      t392 = 1/t120
      t393 = t168*t392
      t396 = 1/t54/t44
      t397 = t396*t389
      t399 = t158*t392
      t403 = 1/t52/t44*t389
      t405 = t174*t392
      t409 = 1/t45/t44*t389
      t411 = t177*t392
      t413 = -0.6934554859331846D1*t390+0.1664293166239643D2*t393
     #-0.4305845969834537D1*t397+0.1291753790950361D2*t399
     #-0.2326004811900819D1*t403+0.9304019247603276D1*t405
     #-0.3394740105503081D0*t409+0.2036844063301848D1*t411
      t423 = 0.1831866518645613D-2*t397*t93
      t425 = 0.5495599555936838D-2*t399*t93
      t429 = 0.8837926660346786D-1*t172*t207*t213*t214
      t433 = t213**2
      t436 = 0.2D1*t83/t206/t89*t433*t214
      t448 = 0.1D1*t208*(-0.8309097827459833D0*t390
     #+0.199418347859036D1*t393-0.4945709824779306D0*t397
     #+0.1483712947433792D1*t399-0.2001071587498409D0*t403
     #+0.8004286349993634D0*t405-0.4215565168327908D-1*t409
     #+0.2529339100996745D0*t411)*t214
      t449 = t206**2
      t452 = t92**2
      t456 = 0.160818243221511D2*t83/t449*t433/t452
      t467 = dlog(1.D0+0.2960857464321668D2/(0.8157414703487641D1*t49
     #+0.2247591863577616D1*t45+0.4300972471276643D0*t52
     #+0.1911512595127338D0*t54))
      t469 = (1.D0+0.6901399211255825D-1*t45)*t467*t169
      t473 = 0.2D1*t216
      t474 = 0.5495599555936838D-2*t204
      t477 = t392*t396
      t481 = 1/t162/t56
      s1 = t98*(0.6244889921732137D0*t292*t101-0.6611977455216065D-1
     #*t299+0.170653661184D-2*t303-0.2250092278626939D-4*t309
     #+0.1614116494367631D-6*t315-t325)+3.D0*t227*t241
     #+0.3328736990781132D-2*t159*t199-0.6564966812284644D0/t5*t41
     #-0.1969490043685393D1*t2*t152-0.3692793831910112D0*t3*(
     #-0.184778923354393D0*t292*t11+0.3338059057705277D-1*t298*t21
     #-0.9494171065457778D-3*t302*t29+0.1213065957842335D-4*t308*t38
     #-0.7337656600781108D-7*t314*t149+0.1675324322247111D-9*t321*t348
     #)-0.6218D-1*t155*t198+0.2D1*t356*t183-0.15545D-1*t48*t60*(
     #-0.4204670655442014D0*t292*t63+0.1571963602053569D0*t298*t67
     #-0.7334969935644444D1*t302*t71+0.1296770019587685D2*t308*t75
     #-0.6229778507390148D1*t314*t195+0.9052473116444444D0*t321*t370)
      s2 = s1+0.1608234158893535D2*t48*t378*t380*t382*t78+(-0.5D0*t48
     #*t163*t413*t181-0.1608234158893535D2*t48*t378*t380*t382+rho*
     #(t423-t425-t429-t436+t448+t456+0.3377399869956914D-1*t469)+t473
     #+t474-0.2D1*t356*t182-0.2219157993854088D-2*t477*t60+0.1D1*t48
     #*t481*t380*t181+0.1070677706909338D0*t159*t224)*t116+0.1D1*t164
     #*t182*t198+0.2219157993854088D-2*t477*t79
      v2rhoa2(i) = s2-0.1070677706909338D0*t159*t163*t183-0.1D1*t48
     #*t481*t380*t181*t78+0.5D0*t164*t413*t181*t78+(t474+t473+rho*
     #(t423-t425-t429-t436+t448+t456-0.3377399869956914D-1*t469))*t116
     #+t227*(-t230+t232-t234+0.9254146025239327D-6*t235-t240)+t98*(
     #-0.1921804305356549D-1*t299+0.90663063552D-3*t303
     #-0.1571454903442721D-4*t309+0.1339542698862844D-6*t315-t325)
      t525 = sigma*t128
      t528 = t14*t133
      t531 = t24*t139
      t534 = t32*t146
      t539 = t143/t318/rho
      t572 = t525*t105
      t574 = t528*t109
      t576 = t531*t113
      t578 = t534*t238
      t581 = 0.3566116896768D-9*t539*t323
      s1 = -0.9847450218426965D0*t2*t260-0.3692793831910112D0*t3*
     #(0.1007885036478507D0*t122*t11-0.2118352569711769D-1*t525*t21
     #+0.6474384561493333D-3*t528*t29-0.8599542016444107D-5*t531*t38
     #+0.5354828486437394D-7*t534*t149-0.1256493241685333D-9*t539*t348
     #)-0.3109D-1*t155*t273+0.1664368495390566D-2*t159*t274
      v2rhoasigmaaa(i) = s1+0.5D0*t164*t182*t273-0.15545D-1*t48*t60*
     #(0.2293456721150189D0*t122*t63-0.1107786557459012D0*t525*t67
     #+0.4891319227733333D1*t528*t71-0.9024914734047895D1*t531*t75
     #+0.4511945422890826D1*t534*t195-0.6789354837333333D0*t539*t370)
     #+2.D0*t227*t287+t98*(-0.3406303593672075D0*t122*t101
     #+0.3999629492577148D-1*t572-0.111628532736D-2*t574
     #+0.1548757018591614D-4*t576-0.1154424548967926D-6*t578+t581)+t98
     #*(0.1441353229017411D-1*t572-0.67997297664D-3*t574
     #+0.1178591177582041D-4*t576-0.1004657024147133D-6*t578+t581)
      t592 = sigma*t26
      t595 = t14*t35
      t598 = t24*t256
      t602 = t32/t318
      v2sigmaaa2(i) = -0.7385587663820224D0*t3*(0.818380980149448D-2
     #*t18*t21-0.356330094592D-3*t592*t29+0.5452751177586271D-5*t595
     #*t38-0.3719293436531171D-7*t598*t149+0.942369931264D-10*t602
     #*t348)-0.3109D-1*t48*t60*(0.6884676299319308D-1*t18*t67
     #-0.24486729728D1*t592*t71+0.5366965224816438D1*t595*t75
     #-0.306318215186455D1*t598*t195+0.5092016128D0*t602*t370)+4.D0
     #*t98*(-0.1081014921763059D-1*t18*t105+0.50997973248D-3*t592*t109
     #-0.8839433831865308D-5*t595*t113+0.7534927681103499D-7*t598*t238
     #-0.2674587672576D-9*t602*t323)
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end

c:XC_HCTHsubrend
_ENDIF
_IF(ccpdft,all,xc_hcth120)
c:XC_HCTH120subrstart

c    Generated: Sat May  8 18:39:42 GMT 2004

      subroutine uks_xc_hcth120
     & (ideriv,npt,rhoa1,rhob1,sigmaaa1,sigmabb1,sigmaab1,
     &  zk,vrhoa,vrhob,vsigmaaa,vsigmabb,vsigmaab,
     &  v2rhoa2,v2rhob2,v2rhoab,
     &  v2rhoasigmaaa,v2rhoasigmaab,v2rhoasigmabb,
     &  v2rhobsigmabb,v2rhobsigmaab,v2rhobsigmaaa,
     &  v2sigmaaa2,v2sigmaaaab,v2sigmaaabb,
     &  v2sigmaab2,v2sigmaabbb,v2sigmabb2)
c
c     A.D. Boese, N.L. Doltsinis, N.C. Handy, M. Sprik
c     New generalized gradient approximation functionals
c     J. Chem. Phys. 112 (2000) 1670-1678.
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt),rhob1(npt)
      REAL sigmaaa1(npt),sigmabb1(npt),sigmaab1(npt)
      REAL zk(npt),vrhoa(npt),vrhob(npt)
      REAL vsigmaaa(npt),vsigmabb(npt),vsigmaab(npt)
      REAL v2rhoa2(npt),v2rhob2(npt),v2rhoab(npt)
      REAL v2rhoasigmaaa(npt),v2rhoasigmaab(npt)
      REAL v2rhoasigmabb(npt),v2rhobsigmabb(npt)
      REAL v2rhobsigmaab(npt),v2rhobsigmaaa(npt)
      REAL v2sigmaaa2(npt),v2sigmaaaab(npt),v2sigmaaabb(npt)
      REAL v2sigmaab2(npt),v2sigmaabbb(npt),v2sigmabb2(npt)
      parameter(tol=1.0d-20)
      
      if (ideriv.eq.0) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t4 = rhob**2
      t5 = t2**2
      t8 = sigmabb/t5/t4
      t10 = 1.D0+0.4D-2*t8
      t14 = sigmabb**2
      t15 = t4**2
      t19 = t14/t2/t15/rhob
      t20 = t10**2
      t25 = t15**2
      t27 = t14*sigmabb/t25
      t32 = t14**2
      t36 = t32/t5/t25/t4
      t37 = t20**2
      t44 = 1/rhob
      t45 = t44**(1.D0/3.D0)
      t49 = t44**(1.D0/6.D0)
      t52 = dsqrt(t44)
      t54 = t45**2
      t60 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t49
     #+0.3844746237447211D1*t45+0.1644733775567609D1*t52
     #+0.2405871291288192D0*t54))
      t62 = 1.D0+0.2D0*t8
      t66 = t62**2
      t74 = t66**2
      zk(i) = -0.9305257363491D0*t2*rhob*(0.109163D1-0.298886D-2*t8
     #/t10+0.8125328D-4*t19/t20-0.26287744D-6*t27/t20/t10
     #+0.29996288D-9*t36/t37)-0.3109D-1*rhob*(1.D0
     #+0.1274696188700087D0*t45)*t60*(0.489508D0-0.521398D-1*t8/t62
     #+0.1731668D-1*t19/t66-0.1593976D-1*t27/t66/t62+0.3976496D-2*t36
     #/t74)
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t4 = rhoa**2
      t5 = t2**2
      t8 = sigmaaa/t5/t4
      t10 = 1.D0+0.4D-2*t8
      t14 = sigmaaa**2
      t15 = t4**2
      t19 = t14/t2/t15/rhoa
      t20 = t10**2
      t25 = t15**2
      t27 = t14*sigmaaa/t25
      t32 = t14**2
      t36 = t32/t5/t25/t4
      t37 = t20**2
      t44 = 1/rhoa
      t45 = t44**(1.D0/3.D0)
      t49 = t44**(1.D0/6.D0)
      t52 = dsqrt(t44)
      t54 = t45**2
      t60 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t49
     #+0.3844746237447211D1*t45+0.1644733775567609D1*t52
     #+0.2405871291288192D0*t54))
      t62 = 1.D0+0.2D0*t8
      t66 = t62**2
      t74 = t66**2
      zk(i) = -0.9305257363491D0*t2*rhoa*(0.109163D1-0.298886D-2*t8
     #/t10+0.8125328D-4*t19/t20-0.26287744D-6*t27/t20/t10
     #+0.29996288D-9*t36/t37)-0.3109D-1*rhoa*(1.D0
     #+0.1274696188700087D0*t45)*t60*(0.489508D0-0.521398D-1*t8/t62
     #+0.1731668D-1*t19/t66-0.1593976D-1*t27/t66/t62+0.3976496D-2*t36
     #/t74)
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t6 = rhoa**2
      t7 = t4**2
      t10 = sigmaaa/t7/t6
      t12 = 1.D0+0.4D-2*t10
      t16 = sigmaaa**2
      t17 = t6**2
      t21 = t16/t4/t17/rhoa
      t22 = t12**2
      t27 = t17**2
      t29 = t16*sigmaaa/t27
      t34 = t16**2
      t38 = t34/t7/t27/t6
      t39 = t22**2
      t46 = 1/rhoa
      t47 = t46**(1.D0/3.D0)
      t50 = rhoa*(1.D0+0.1274696188700087D0*t47)
      t51 = t46**(1.D0/6.D0)
      t54 = dsqrt(t46)
      t56 = t47**2
      t62 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t51
     #+0.3844746237447211D1*t47+0.1644733775567609D1*t54
     #+0.2405871291288192D0*t56))
      t64 = 1.D0+0.2D0*t10
      t68 = t64**2
      t76 = t68**2
      t84 = rhob**(1.D0/3.D0)
      t86 = rhob**2
      t87 = t84**2
      t90 = sigmabb/t87/t86
      t92 = 1.D0+0.4D-2*t90
      t96 = sigmabb**2
      t97 = t86**2
      t101 = t96/t84/t97/rhob
      t102 = t92**2
      t107 = t97**2
      t109 = t96*sigmabb/t107
      t114 = t96**2
      t118 = t114/t87/t107/t86
      t119 = t102**2
      t126 = 1/rhob
      t127 = t126**(1.D0/3.D0)
      t130 = rhob*(1.D0+0.1274696188700087D0*t127)
      t131 = t126**(1.D0/6.D0)
      t134 = dsqrt(t126)
      t136 = t127**2
      t142 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t131
     #+0.3844746237447211D1*t127+0.1644733775567609D1*t134
     #+0.2405871291288192D0*t136))
      t144 = 1.D0+0.2D0*t90
      t148 = t144**2
      t156 = t148**2
      t164 = rhoa+rhob
      t165 = 1/t164
      t166 = t165**(1.D0/3.D0)
      t169 = t165**(1.D0/6.D0)
      t172 = dsqrt(t165)
      t174 = t166**2
      t180 = dlog(1.D0+0.160818243221511D2/(0.598255043577108D1*t169
     #+0.2225569421150687D1*t166+0.8004286349993634D0*t172
     #+0.1897004325747559D0*t174))
      t182 = 0.62182D-1*(1.D0+0.1325688999052018D0*t166)*t180
      t193 = dlog(1.D0+0.2960857464321668D2/(0.8157414703487641D1*t169
     #+0.2247591863577616D1*t166+0.4300972471276643D0*t172
     #+0.1911512595127338D0*t174))
      t196 = rhoa-1.D0*rhob
      t197 = t196*t165
      t198 = 1.D0+t197
      t199 = t198**(1.D0/3.D0)
      t202 = 1.D0-1.D0*t197
      t203 = t202**(1.D0/3.D0)
      t205 = t199*t198+t203*t202-2.D0
      t206 = t196**2
      t207 = t206**2
      t208 = t164**2
      t209 = t208**2
      t211 = t207/t209
      t227 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t169
     #+0.3844746237447211D1*t166+0.1644733775567609D1*t172
     #+0.2405871291288192D0*t174))
      t243 = 0.5D0*t10+0.5D0*t90
      t246 = 1.D0+0.3D-2*t10+0.3D-2*t90
      t250 = t243**2
      t251 = t246**2
      t260 = t250**2
      t261 = t251**2
      s1 = -0.9305257363491D0*t4*rhoa*(0.109163D1-0.298886D-2*t10/t12
     #+0.8125328D-4*t21/t22-0.26287744D-6*t29/t22/t12+0.29996288D-9
     #*t38/t39)-0.3109D-1*t50*t62*(0.489508D0-0.521398D-1*t10/t64
     #+0.1731668D-1*t21/t68-0.1593976D-1*t29/t68/t64+0.3976496D-2*t38
     #/t76)
      s2 = s1-0.9305257363491D0*t84*rhob*(0.109163D1-0.298886D-2*t90
     #/t92+0.8125328D-4*t101/t102-0.26287744D-6*t109/t102/t92
     #+0.29996288D-9*t118/t119)
      zk(i) = s2-0.3109D-1*t130*t142*(0.489508D0-0.521398D-1*t90/t144
     #+0.1731668D-1*t101/t148-0.1593976D-1*t109/t148/t144+0.3976496D-2
     #*t118/t156)+(t164*(-t182+0.3799574853701528D-1*(1.D0
     #+0.6901399211255825D-1*t166)*t193*t205*(1.D0-1.D0*t211)
     #+0.1923661050931536D1*(-0.3109D-1*(1.D0+0.1274696188700087D0
     #*t166)*t227+t182)*t205*t211)+0.3109D-1*t50*t62+0.3109D-1*t130
     #*t142)*(0.51473D0+0.4157892D-1*t243/t246-0.8894628D-3*t250/t251
     #+0.49917168D-5*t250*t243/t251/t246-0.146751264D-7*t260/t261)
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t3 = t2*rhob
      t4 = rhob**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigmabb*t7
      t10 = 1.D0+0.4D-2*t8
      t11 = 1/t10
      t14 = sigmabb**2
      t15 = t4**2
      t16 = t15*rhob
      t18 = 1/t2/t16
      t19 = t14*t18
      t20 = t10**2
      t21 = 1/t20
      t24 = t14*sigmabb
      t25 = t15**2
      t26 = 1/t25
      t27 = t24*t26
      t29 = 1/t20/t10
      t32 = t14**2
      t35 = 1/t5/t25/t4
      t36 = t32*t35
      t37 = t20**2
      t38 = 1/t37
      t41 = 0.109163D1-0.298886D-2*t8*t11+0.8125328D-4*t19*t21
     #-0.26287744D-6*t27*t29+0.29996288D-9*t36*t38
      t44 = 1/rhob
      t45 = t44**(1.D0/3.D0)
      t47 = 1.D0+0.1274696188700087D0*t45
      t48 = rhob*t47
      t49 = t44**(1.D0/6.D0)
      t52 = dsqrt(t44)
      t54 = t45**2
      t56 = 0.1112037486309468D2*t49+0.3844746237447211D1*t45
     #+0.1644733775567609D1*t52+0.2405871291288192D0*t54
      t59 = 1.D0+0.321646831778707D2/t56
      t60 = dlog(t59)
      t62 = 1.D0+0.2D0*t8
      t63 = 1/t62
      t66 = t62**2
      t67 = 1/t66
      t71 = 1/t66/t62
      t74 = t66**2
      t75 = 1/t74
      t78 = 0.489508D0-0.521398D-1*t8*t63+0.1731668D-1*t19*t67
     #-0.1593976D-1*t27*t71+0.3976496D-2*t36*t75
      t79 = t60*t78
      zk(i) = -0.9305257363491D0*t3*t41-0.3109D-1*t48*t79
      vrhoa(i) = 0.D0
      t84 = t4*rhob
      t87 = sigmabb/t5/t84
      t90 = t15*t4
      t93 = t14/t2/t90
      t98 = t24/t25/rhob
      t104 = t32/t5/t25/t84
      t111 = t32*sigmabb/t2/t25/t90
      t113 = 1/t37/t10
      t122 = 1/t54
      t126 = t56**2
      t129 = t49**2
      t130 = t129**2
      t133 = 1/t4
      t159 = 1/t74/t62
      vrhob(i) = -0.12407009817988D1*t2*t41-0.9305257363491D0*t3*
     #(0.7970293333333333D-2*t87*t11-0.465232D-3*t93*t21
     #+0.3836422826666667D-5*t98*t29-0.1161168213333333D-7*t104*t38
     #+0.1279841621333333D-10*t111*t113)-0.3109D-1*t47*t60*t78
     #+0.1321010150222857D-2*t44*t122*t79+0.1D1*t48/t126*(
     #-0.1853395810515781D1/t130/t49*t133-0.128158207914907D1*t122
     #*t133-0.8223668877838045D0/t52*t133-0.1603914194192128D0/t45
     #*t133)/t59*t78-0.3109D-1*t48*t60*(0.1390394666666667D0*t87*t63
     #-0.12016352D0*t93*t67+0.1459892053333333D0*t98*t71
     #-0.6791957333333333D-1*t104*t75+0.8483191466666667D-2*t111*t159)
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      t168 = sigmabb*t18
      t171 = t14*t26
      t174 = t24*t35
      t180 = t32/t2/t25/t16
      vsigmabb(i) = -0.9305257363491D0*t3*(-0.298886D-2*t7*t11
     #+0.174462D-3*t168*t21-0.143865856D-5*t171*t29+0.43543808D-8*t174
     #*t38-0.479940608D-11*t180*t113)-0.3109D-1*t48*t60*(-0.521398D-1
     #*t7*t63+0.4506132D-1*t168*t67-0.54745952D-1*t171*t71
     #+0.2546984D-1*t174*t75-0.31811968D-2*t180*t159)
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t3 = t2*rhoa
      t4 = rhoa**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigmaaa*t7
      t10 = 1.D0+0.4D-2*t8
      t11 = 1/t10
      t14 = sigmaaa**2
      t15 = t4**2
      t16 = t15*rhoa
      t18 = 1/t2/t16
      t19 = t14*t18
      t20 = t10**2
      t21 = 1/t20
      t24 = t14*sigmaaa
      t25 = t15**2
      t26 = 1/t25
      t27 = t24*t26
      t29 = 1/t20/t10
      t32 = t14**2
      t35 = 1/t5/t25/t4
      t36 = t32*t35
      t37 = t20**2
      t38 = 1/t37
      t41 = 0.109163D1-0.298886D-2*t8*t11+0.8125328D-4*t19*t21
     #-0.26287744D-6*t27*t29+0.29996288D-9*t36*t38
      t44 = 1/rhoa
      t45 = t44**(1.D0/3.D0)
      t47 = 1.D0+0.1274696188700087D0*t45
      t48 = rhoa*t47
      t49 = t44**(1.D0/6.D0)
      t52 = dsqrt(t44)
      t54 = t45**2
      t56 = 0.1112037486309468D2*t49+0.3844746237447211D1*t45
     #+0.1644733775567609D1*t52+0.2405871291288192D0*t54
      t59 = 1.D0+0.321646831778707D2/t56
      t60 = dlog(t59)
      t62 = 1.D0+0.2D0*t8
      t63 = 1/t62
      t66 = t62**2
      t67 = 1/t66
      t71 = 1/t66/t62
      t74 = t66**2
      t75 = 1/t74
      t78 = 0.489508D0-0.521398D-1*t8*t63+0.1731668D-1*t19*t67
     #-0.1593976D-1*t27*t71+0.3976496D-2*t36*t75
      t79 = t60*t78
      zk(i) = -0.9305257363491D0*t3*t41-0.3109D-1*t48*t79
      t84 = t4*rhoa
      t87 = sigmaaa/t5/t84
      t90 = t15*t4
      t93 = t14/t2/t90
      t98 = t24/t25/rhoa
      t104 = t32/t5/t25/t84
      t111 = t32*sigmaaa/t2/t25/t90
      t113 = 1/t37/t10
      t122 = 1/t54
      t126 = t56**2
      t129 = t49**2
      t130 = t129**2
      t133 = 1/t4
      t159 = 1/t74/t62
      vrhoa(i) = -0.12407009817988D1*t2*t41-0.9305257363491D0*t3*
     #(0.7970293333333333D-2*t87*t11-0.465232D-3*t93*t21
     #+0.3836422826666667D-5*t98*t29-0.1161168213333333D-7*t104*t38
     #+0.1279841621333333D-10*t111*t113)-0.3109D-1*t47*t60*t78
     #+0.1321010150222857D-2*t44*t122*t79+0.1D1*t48/t126*(
     #-0.1853395810515781D1/t130/t49*t133-0.128158207914907D1*t122
     #*t133-0.8223668877838045D0/t52*t133-0.1603914194192128D0/t45
     #*t133)/t59*t78-0.3109D-1*t48*t60*(0.1390394666666667D0*t87*t63
     #-0.12016352D0*t93*t67+0.1459892053333333D0*t98*t71
     #-0.6791957333333333D-1*t104*t75+0.8483191466666667D-2*t111*t159)
      vrhob(i) = 0.D0
      t168 = sigmaaa*t18
      t171 = t14*t26
      t174 = t24*t35
      t180 = t32/t2/t25/t16
      vsigmaaa(i) = -0.9305257363491D0*t3*(-0.298886D-2*t7*t11
     #+0.174462D-3*t168*t21-0.143865856D-5*t171*t29+0.43543808D-8*t174
     #*t38-0.479940608D-11*t180*t113)-0.3109D-1*t48*t60*(-0.521398D-1
     #*t7*t63+0.4506132D-1*t168*t67-0.54745952D-1*t171*t71
     #+0.2546984D-1*t174*t75-0.31811968D-2*t180*t159)
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t5 = t4*rhoa
      t6 = rhoa**2
      t7 = t4**2
      t9 = 1/t7/t6
      t10 = sigmaaa*t9
      t12 = 1.D0+0.4D-2*t10
      t13 = 1/t12
      t16 = sigmaaa**2
      t17 = t6**2
      t18 = t17*rhoa
      t20 = 1/t4/t18
      t21 = t16*t20
      t22 = t12**2
      t23 = 1/t22
      t26 = t16*sigmaaa
      t27 = t17**2
      t28 = 1/t27
      t29 = t26*t28
      t31 = 1/t22/t12
      t34 = t16**2
      t37 = 1/t7/t27/t6
      t38 = t34*t37
      t39 = t22**2
      t40 = 1/t39
      t43 = 0.109163D1-0.298886D-2*t10*t13+0.8125328D-4*t21*t23
     #-0.26287744D-6*t29*t31+0.29996288D-9*t38*t40
      t46 = 1/rhoa
      t47 = t46**(1.D0/3.D0)
      t49 = 1.D0+0.1274696188700087D0*t47
      t50 = rhoa*t49
      t51 = t46**(1.D0/6.D0)
      t54 = dsqrt(t46)
      t56 = t47**2
      t58 = 0.1112037486309468D2*t51+0.3844746237447211D1*t47
     #+0.1644733775567609D1*t54+0.2405871291288192D0*t56
      t61 = 1.D0+0.321646831778707D2/t58
      t62 = dlog(t61)
      t64 = 1.D0+0.2D0*t10
      t65 = 1/t64
      t68 = t64**2
      t69 = 1/t68
      t73 = 1/t68/t64
      t76 = t68**2
      t77 = 1/t76
      t80 = 0.489508D0-0.521398D-1*t10*t65+0.1731668D-1*t21*t69
     #-0.1593976D-1*t29*t73+0.3976496D-2*t38*t77
      t81 = t62*t80
      t84 = rhob**(1.D0/3.D0)
      t85 = t84*rhob
      t86 = rhob**2
      t87 = t84**2
      t89 = 1/t87/t86
      t90 = sigmabb*t89
      t92 = 1.D0+0.4D-2*t90
      t93 = 1/t92
      t96 = sigmabb**2
      t97 = t86**2
      t98 = t97*rhob
      t100 = 1/t84/t98
      t101 = t96*t100
      t102 = t92**2
      t103 = 1/t102
      t106 = t96*sigmabb
      t107 = t97**2
      t108 = 1/t107
      t109 = t106*t108
      t111 = 1/t102/t92
      t114 = t96**2
      t117 = 1/t87/t107/t86
      t118 = t114*t117
      t119 = t102**2
      t120 = 1/t119
      t123 = 0.109163D1-0.298886D-2*t90*t93+0.8125328D-4*t101*t103
     #-0.26287744D-6*t109*t111+0.29996288D-9*t118*t120
      t126 = 1/rhob
      t127 = t126**(1.D0/3.D0)
      t129 = 1.D0+0.1274696188700087D0*t127
      t130 = rhob*t129
      t131 = t126**(1.D0/6.D0)
      t134 = dsqrt(t126)
      t136 = t127**2
      t138 = 0.1112037486309468D2*t131+0.3844746237447211D1*t127
     #+0.1644733775567609D1*t134+0.2405871291288192D0*t136
      t141 = 1.D0+0.321646831778707D2/t138
      t142 = dlog(t141)
      t144 = 1.D0+0.2D0*t90
      t145 = 1/t144
      t148 = t144**2
      t149 = 1/t148
      t153 = 1/t148/t144
      t156 = t148**2
      t157 = 1/t156
      t160 = 0.489508D0-0.521398D-1*t90*t145+0.1731668D-1*t101*t149
     #-0.1593976D-1*t109*t153+0.3976496D-2*t118*t157
      t161 = t142*t160
      t164 = rhoa+rhob
      t165 = 1/t164
      t166 = t165**(1.D0/3.D0)
      t168 = 1.D0+0.1325688999052018D0*t166
      t169 = t165**(1.D0/6.D0)
      t172 = dsqrt(t165)
      t174 = t166**2
      t176 = 0.598255043577108D1*t169+0.2225569421150687D1*t166
     #+0.8004286349993634D0*t172+0.1897004325747559D0*t174
      t179 = 1.D0+0.160818243221511D2/t176
      t180 = dlog(t179)
      t182 = 0.62182D-1*t168*t180
      t184 = 1.D0+0.6901399211255825D-1*t166
      t189 = 0.8157414703487641D1*t169+0.2247591863577616D1*t166
     #+0.4300972471276643D0*t172+0.1911512595127338D0*t174
      t192 = 1.D0+0.2960857464321668D2/t189
      t193 = dlog(t192)
      t194 = t184*t193
      t196 = rhoa-1.D0*rhob
      t197 = t196*t165
      t198 = 1.D0+t197
      t199 = t198**(1.D0/3.D0)
      t202 = 1.D0-1.D0*t197
      t203 = t202**(1.D0/3.D0)
      t205 = t199*t198+t203*t202-2.D0
      t206 = t196**2
      t207 = t206**2
      t208 = t164**2
      t209 = t208**2
      t210 = 1/t209
      t211 = t207*t210
      t213 = 1.D0-1.D0*t211
      t216 = 0.3799574853701528D-1*t194*t205*t213
      t218 = 1.D0+0.1274696188700087D0*t166
      t223 = 0.1112037486309468D2*t169+0.3844746237447211D1*t166
     #+0.1644733775567609D1*t172+0.2405871291288192D0*t174
      t226 = 1.D0+0.321646831778707D2/t223
      t227 = dlog(t226)
      t230 = -0.3109D-1*t218*t227+t182
      t231 = t230*t205
      t233 = 0.1923661050931536D1*t231*t211
      t240 = t164*(-t182+t216+t233)+0.3109D-1*t50*t62+0.3109D-1*t130
     #*t142
      t243 = 0.5D0*t10+0.5D0*t90
      t246 = 1.D0+0.3D-2*t10+0.3D-2*t90
      t247 = 1/t246
      t250 = t243**2
      t251 = t246**2
      t252 = 1/t251
      t255 = t250*t243
      t257 = 1/t251/t246
      t260 = t250**2
      t261 = t251**2
      t262 = 1/t261
      t265 = 0.51473D0+0.4157892D-1*t243*t247-0.8894628D-3*t250*t252
     #+0.49917168D-5*t255*t257-0.146751264D-7*t260*t262
      zk(i) = -0.9305257363491D0*t5*t43-0.3109D-1*t50*t81
     #-0.9305257363491D0*t85*t123-0.3109D-1*t130*t161+t240*t265
      t269 = t6*rhoa
      t272 = sigmaaa/t7/t269
      t275 = t17*t6
      t278 = t16/t4/t275
      t283 = t26/t27/rhoa
      t289 = t34/t7/t27/t269
      t296 = t34*sigmaaa/t4/t27/t275
      t298 = 1/t39/t12
      t304 = t49*t62
      t307 = 1/t56
      t308 = t46*t307
      t311 = t58**2
      t312 = 1/t311
      t314 = t51**2
      t315 = t314**2
      t318 = 1/t6
      t329 = -0.1853395810515781D1/t315/t51*t318-0.128158207914907D1
     #*t307*t318-0.8223668877838045D0/t54*t318-0.1603914194192128D0
     #/t47*t318
      t330 = 1/t61
      t344 = 1/t76/t64
      t352 = 1/t208
      t353 = 1/t174*t352
      t354 = t353*t180
      t355 = 0.2747799777968419D-2*t354
      t356 = t176**2
      t359 = t169**2
      t360 = t359**2
      t363 = 1/t360/t169*t352
      t367 = 1/t172*t352
      t370 = 1/t166*t352
      t375 = t168/t356*(-0.99709173929518D0*t363-0.7418564737168958D0
     #*t353-0.4002143174996817D0*t367-0.1264669550498372D0*t370)/t179
      t376 = 0.1D1*t375
      t380 = 0.8740794299481065D-3*t353*t193*t205*t213
      t381 = t189**2
      t394 = 0.1124999956683108D1*t184/t381*(-0.135956911724794D1*t363
     #-0.7491972878592054D0*t353-0.2150486235638321D0*t367
     #-0.1274341730084892D0*t370)/t192*t205*t213
      t395 = t196*t352
      t396 = 1.D0*t395
      t400 = 1.D0*t165
      t404 = 0.1333333333333333D1*t199*(t165-t396)
     #+0.1333333333333333D1*t203*(-t400+t395)
      t409 = t206*t196*t210
      t410 = 4.D0*t409
      t413 = t207/t209/t164
      t414 = 4.D0*t413
      t421 = t223**2
      t438 = 0.1923661050931536D1*(0.1321010150222857D-2*t353*t227
     #+0.1D1*t218/t421*(-0.1853395810515781D1*t363-0.128158207914907D1
     #*t353-0.8223668877838045D0*t367-0.1603914194192128D0*t370)/t226
     #-0.2747799777968419D-2*t354-0.1D1*t375)*t205*t211
      t442 = t231*t409
      t445 = 0.7694644203726145D1*t231*t413
      t459 = t243*t252
      t462 = t250*t257
      t465 = t255*t262
      t470 = t260/t261/t246
      s1 = -0.12407009817988D1*t4*t43-0.9305257363491D0*t5*
     #(0.7970293333333333D-2*t272*t13-0.465232D-3*t278*t23
     #+0.3836422826666667D-5*t283*t31-0.1161168213333333D-7*t289*t40
     #+0.1279841621333333D-10*t296*t298)-0.3109D-1*t304*t80
     #+0.1321010150222857D-2*t308*t81
      vrhoa(i) = s1+0.1D1*t50*t312*t329*t330*t80-0.3109D-1*t50*t62*
     #(0.1390394666666667D0*t272*t65-0.12016352D0*t278*t69
     #+0.1459892053333333D0*t283*t73-0.6791957333333333D-1*t289*t77
     #+0.8483191466666667D-2*t296*t344)+(-t182+t216+t233+t164*(t355
     #+t376-t380-t394+0.3799574853701528D-1*t194*t404*t213
     #+0.3799574853701528D-1*t194*t205*(-t410+t414)+t438
     #+0.1923661050931536D1*t230*t404*t211+0.7694644203726145D1*t442
     #-t445)+0.3109D-1*t304-0.1321010150222857D-2*t308*t62-0.1D1*t50
     #*t312*t329*t330)*t265+t240*(-0.5543856D-1*t272*t247
     #+0.270453216D-2*t459*t272-0.34198272D-4*t462*t272+0.198068544D-6
     #*t465*t272-0.4696040448D-9*t470*t272)
      t477 = t86*rhob
      t480 = sigmabb/t87/t477
      t483 = t97*t86
      t486 = t96/t84/t483
      t491 = t106/t107/rhob
      t497 = t114/t87/t107/t477
      t504 = t114*sigmabb/t84/t107/t483
      t506 = 1/t119/t92
      t512 = t129*t142
      t515 = 1/t136
      t516 = t126*t515
      t519 = t138**2
      t520 = 1/t519
      t522 = t131**2
      t523 = t522**2
      t526 = 1/t86
      t537 = -0.1853395810515781D1/t523/t131*t526-0.128158207914907D1
     #*t515*t526-0.8223668877838045D0/t134*t526-0.1603914194192128D0
     #/t127*t526
      t538 = 1/t141
      t552 = 1/t156/t144
      t565 = 0.1333333333333333D1*t199*(-t400-t396)
     #+0.1333333333333333D1*t203*(t165+t395)
      s1 = -0.12407009817988D1*t84*t123-0.9305257363491D0*t85*
     #(0.7970293333333333D-2*t480*t93-0.465232D-3*t486*t103
     #+0.3836422826666667D-5*t491*t111-0.1161168213333333D-7*t497*t120
     #+0.1279841621333333D-10*t504*t506)-0.3109D-1*t512*t160
     #+0.1321010150222857D-2*t516*t161
      vrhob(i) = s1+0.1D1*t130*t520*t537*t538*t160-0.3109D-1*t130*t142
     #*(0.1390394666666667D0*t480*t145-0.12016352D0*t486*t149
     #+0.1459892053333333D0*t491*t153-0.6791957333333333D-1*t497*t157
     #+0.8483191466666667D-2*t504*t552)+(-t182+t216+t233+t164*(t355
     #+t376-t380-t394+0.3799574853701528D-1*t194*t565*t213
     #+0.3799574853701528D-1*t194*t205*(t410+t414)+t438
     #+0.1923661050931536D1*t230*t565*t211-0.7694644203726145D1*t442
     #-t445)+0.3109D-1*t512-0.1321010150222857D-2*t516*t142-0.1D1*t130
     #*t520*t537*t538)*t265+t240*(-0.5543856D-1*t480*t247
     #+0.270453216D-2*t459*t480-0.34198272D-4*t462*t480+0.198068544D-6
     #*t465*t480-0.4696040448D-9*t470*t480)
      t602 = sigmaaa*t20
      t605 = t16*t28
      t608 = t26*t37
      t614 = t34/t4/t27/t18
      vsigmaaa(i) = -0.9305257363491D0*t5*(-0.298886D-2*t9*t13
     #+0.174462D-3*t602*t23-0.143865856D-5*t605*t31+0.43543808D-8*t608
     #*t40-0.479940608D-11*t614*t298)-0.3109D-1*t50*t62*(-0.521398D-1
     #*t9*t65+0.4506132D-1*t602*t69-0.54745952D-1*t605*t73
     #+0.2546984D-1*t608*t77-0.31811968D-2*t614*t344)+t240*
     #(0.2078946D-1*t9*t247-0.101419956D-2*t459*t9+0.12824352D-4*t462
     #*t9-0.74275704D-7*t465*t9+0.1761015168D-9*t470*t9)
      vsigmaab(i) = 0.D0
      t648 = sigmabb*t100
      t651 = t96*t108
      t654 = t106*t117
      t660 = t114/t84/t107/t98
      vsigmabb(i) = -0.9305257363491D0*t85*(-0.298886D-2*t89*t93
     #+0.174462D-3*t648*t103-0.143865856D-5*t651*t111+0.43543808D-8
     #*t654*t120-0.479940608D-11*t660*t506)-0.3109D-1*t130*t142*(
     #-0.521398D-1*t89*t145+0.4506132D-1*t648*t149-0.54745952D-1*t651
     #*t153+0.2546984D-1*t654*t157-0.31811968D-2*t660*t552)+t240*
     #(0.2078946D-1*t89*t247-0.101419956D-2*t459*t89+0.12824352D-4
     #*t462*t89-0.74275704D-7*t465*t89+0.1761015168D-9*t470*t89)
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t3 = t2*rhob
      t4 = rhob**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigmabb*t7
      t10 = 1.D0+0.4D-2*t8
      t11 = 1/t10
      t14 = sigmabb**2
      t15 = t4**2
      t16 = t15*rhob
      t18 = 1/t2/t16
      t19 = t14*t18
      t20 = t10**2
      t21 = 1/t20
      t24 = t14*sigmabb
      t25 = t15**2
      t26 = 1/t25
      t27 = t24*t26
      t29 = 1/t20/t10
      t32 = t14**2
      t33 = t25*t4
      t35 = 1/t5/t33
      t36 = t32*t35
      t37 = t20**2
      t38 = 1/t37
      t41 = 0.109163D1-0.298886D-2*t8*t11+0.8125328D-4*t19*t21
     #-0.26287744D-6*t27*t29+0.29996288D-9*t36*t38
      t44 = 1/rhob
      t45 = t44**(1.D0/3.D0)
      t47 = 1.D0+0.1274696188700087D0*t45
      t48 = rhob*t47
      t49 = t44**(1.D0/6.D0)
      t52 = dsqrt(t44)
      t54 = t45**2
      t56 = 0.1112037486309468D2*t49+0.3844746237447211D1*t45
     #+0.1644733775567609D1*t52+0.2405871291288192D0*t54
      t59 = 1.D0+0.321646831778707D2/t56
      t60 = dlog(t59)
      t62 = 1.D0+0.2D0*t8
      t63 = 1/t62
      t66 = t62**2
      t67 = 1/t66
      t71 = 1/t66/t62
      t74 = t66**2
      t75 = 1/t74
      t78 = 0.489508D0-0.521398D-1*t8*t63+0.1731668D-1*t19*t67
     #-0.1593976D-1*t27*t71+0.3976496D-2*t36*t75
      t79 = t60*t78
      zk(i) = -0.9305257363491D0*t3*t41-0.3109D-1*t48*t79
      vrhoa(i) = 0.D0
      t84 = t4*rhob
      t87 = sigmabb/t5/t84
      t90 = t15*t4
      t93 = t14/t2/t90
      t98 = t24/t25/rhob
      t104 = t32/t5/t25/t84
      t107 = t32*sigmabb
      t111 = t107/t2/t25/t90
      t113 = 1/t37/t10
      t116 = 0.7970293333333333D-2*t87*t11-0.465232D-3*t93*t21
     #+0.3836422826666667D-5*t98*t29-0.1161168213333333D-7*t104*t38
     #+0.1279841621333333D-10*t111*t113
      t119 = t47*t60
      t122 = 1/t54
      t123 = t44*t122
      t126 = t56**2
      t127 = 1/t126
      t128 = t48*t127
      t129 = t49**2
      t130 = t129**2
      t131 = t130*t49
      t132 = 1/t131
      t133 = 1/t4
      t138 = 1/t52
      t141 = 1/t45
      t144 = -0.1853395810515781D1*t132*t133-0.128158207914907D1*t122
     #*t133-0.8223668877838045D0*t138*t133-0.1603914194192128D0*t141
     #*t133
      t145 = 1/t59
      t146 = t144*t145
      t147 = t146*t78
      t159 = 1/t74/t62
      t162 = 0.1390394666666667D0*t87*t63-0.12016352D0*t93*t67
     #+0.1459892053333333D0*t98*t71-0.6791957333333333D-1*t104*t75
     #+0.8483191466666667D-2*t111*t159
      t163 = t60*t162
      vrhob(i) = -0.12407009817988D1*t2*t41-0.9305257363491D0*t3*t116
     #-0.3109D-1*t119*t78+0.1321010150222857D-2*t123*t79+0.1D1*t128
     #*t147-0.3109D-1*t48*t163
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      t168 = sigmabb*t18
      t171 = t14*t26
      t174 = t24*t35
      t179 = 1/t2/t25/t16
      t180 = t32*t179
      vsigmabb(i) = -0.9305257363491D0*t3*(-0.298886D-2*t7*t11
     #+0.174462D-3*t168*t21-0.143865856D-5*t171*t29+0.43543808D-8*t174
     #*t38-0.479940608D-11*t180*t113)-0.3109D-1*t48*t60*(-0.521398D-1
     #*t7*t63+0.4506132D-1*t168*t67-0.54745952D-1*t171*t71
     #+0.2546984D-1*t174*t75-0.31811968D-2*t180*t159)
      v2rhoa2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t207 = sigmabb/t5/t15
      t210 = t15*t84
      t213 = t14/t2/t210
      t217 = t24/t33
      t223 = t32/t5/t25/t15
      t229 = t107/t2/t25/t210
      t233 = t25**2
      t236 = t32*t14/t233/t4
      t238 = 1/t37/t20
      t249 = 1/t84
      t251 = 1/t54/t44
      t263 = t144**2
      t270 = 1/t15
      t296 = t126**2
      t299 = t59**2
      t319 = 1/t74/t66
      s1 = -0.4135669939329333D0/t5*t41-0.24814019635976D1*t2*t116
     #-0.9305257363491D0*t3*(-0.2922440888888889D-1*t207*t11
     #+0.3031485795555556D-2*t213*t21-0.4445275477333333D-4*t217*t29
     #+0.2582351553422222D-6*t223*t38-0.6788757367466667D-9*t229*t113
     #+0.6825821980444444D-12*t236*t238)+0.2D1*t47*t127*t147-0.6218D-1
     #*t119*t162+0.8806734334819047D-3*t249*t251*t79
      v2rhob2(i) = s1-0.8497974591333914D-1*t123*t127*t147
     #+0.2642020300445714D-2*t123*t163-0.2D1*t48/t126/t56*t263*t145
     #*t78+0.1D1*t128*(-0.1544496508763151D1/t131/t44*t270
     #+0.3706791621031562D1*t132*t249-0.854388052766047D0*t251*t270
     #+0.2563164158298141D1*t122*t249-0.4111834438919023D0/t52/t44
     #*t270+0.1644733775567609D1*t138*t249-0.5346380647307093D-1/t45
     #/t44*t270+0.3207828388384256D0*t141*t249)*t145*t78
     #+0.321646831778707D2*t48/t296*t263/t299*t78+0.2D1*t128*t146*t162
     #-0.3109D-1*t48*t60*(-0.5098113777777778D0*t207*t63
     #+0.8351900088888889D0*t213*t67-0.1442077269333333D1*t217*t71
     #+0.1025977750755556D1*t223*t75-0.2664875008D0*t229*t159
     #+0.2262184391111111D-1*t236*t319)
      v2sigmaaa2(i) = 0.D0
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      t328 = sigmabb*t26
      t331 = t14*t35
      t334 = t24*t179
      t338 = t32/t233
      v2sigmabb2(i) = -0.9305257363491D0*t3*(0.18641744D-3*t18*t21
     #-0.427301312D-5*t328*t29+0.3032704512D-7*t331*t38
     #-0.8886771712D-10*t334*t113+0.959881216D-13*t338*t238)-0.3109D-1
     #*t48*t60*(0.5548928D-1*t18*t67-0.127516432D0*t328*t71
     #+0.1092570912D0*t331*t75-0.331006592D-1*t334*t159+0.31811968D-2
     #*t338*t319)
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t3 = t2*rhoa
      t4 = rhoa**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigmaaa*t7
      t10 = 1.D0+0.4D-2*t8
      t11 = 1/t10
      t14 = sigmaaa**2
      t15 = t4**2
      t16 = t15*rhoa
      t18 = 1/t2/t16
      t19 = t14*t18
      t20 = t10**2
      t21 = 1/t20
      t24 = t14*sigmaaa
      t25 = t15**2
      t26 = 1/t25
      t27 = t24*t26
      t29 = 1/t20/t10
      t32 = t14**2
      t33 = t25*t4
      t35 = 1/t5/t33
      t36 = t32*t35
      t37 = t20**2
      t38 = 1/t37
      t41 = 0.109163D1-0.298886D-2*t8*t11+0.8125328D-4*t19*t21
     #-0.26287744D-6*t27*t29+0.29996288D-9*t36*t38
      t44 = 1/rhoa
      t45 = t44**(1.D0/3.D0)
      t47 = 1.D0+0.1274696188700087D0*t45
      t48 = rhoa*t47
      t49 = t44**(1.D0/6.D0)
      t52 = dsqrt(t44)
      t54 = t45**2
      t56 = 0.1112037486309468D2*t49+0.3844746237447211D1*t45
     #+0.1644733775567609D1*t52+0.2405871291288192D0*t54
      t59 = 1.D0+0.321646831778707D2/t56
      t60 = dlog(t59)
      t62 = 1.D0+0.2D0*t8
      t63 = 1/t62
      t66 = t62**2
      t67 = 1/t66
      t71 = 1/t66/t62
      t74 = t66**2
      t75 = 1/t74
      t78 = 0.489508D0-0.521398D-1*t8*t63+0.1731668D-1*t19*t67
     #-0.1593976D-1*t27*t71+0.3976496D-2*t36*t75
      t79 = t60*t78
      zk(i) = -0.9305257363491D0*t3*t41-0.3109D-1*t48*t79
      t84 = t4*rhoa
      t87 = sigmaaa/t5/t84
      t90 = t15*t4
      t93 = t14/t2/t90
      t98 = t24/t25/rhoa
      t104 = t32/t5/t25/t84
      t107 = t32*sigmaaa
      t111 = t107/t2/t25/t90
      t113 = 1/t37/t10
      t116 = 0.7970293333333333D-2*t87*t11-0.465232D-3*t93*t21
     #+0.3836422826666667D-5*t98*t29-0.1161168213333333D-7*t104*t38
     #+0.1279841621333333D-10*t111*t113
      t119 = t47*t60
      t122 = 1/t54
      t123 = t44*t122
      t126 = t56**2
      t127 = 1/t126
      t128 = t48*t127
      t129 = t49**2
      t130 = t129**2
      t131 = t130*t49
      t132 = 1/t131
      t133 = 1/t4
      t138 = 1/t52
      t141 = 1/t45
      t144 = -0.1853395810515781D1*t132*t133-0.128158207914907D1*t122
     #*t133-0.8223668877838045D0*t138*t133-0.1603914194192128D0*t141
     #*t133
      t145 = 1/t59
      t146 = t144*t145
      t147 = t146*t78
      t159 = 1/t74/t62
      t162 = 0.1390394666666667D0*t87*t63-0.12016352D0*t93*t67
     #+0.1459892053333333D0*t98*t71-0.6791957333333333D-1*t104*t75
     #+0.8483191466666667D-2*t111*t159
      t163 = t60*t162
      vrhoa(i) = -0.12407009817988D1*t2*t41-0.9305257363491D0*t3*t116
     #-0.3109D-1*t119*t78+0.1321010150222857D-2*t123*t79+0.1D1*t128
     #*t147-0.3109D-1*t48*t163
      vrhob(i) = 0.D0
      t168 = sigmaaa*t18
      t171 = t14*t26
      t174 = t24*t35
      t179 = 1/t2/t25/t16
      t180 = t32*t179
      vsigmaaa(i) = -0.9305257363491D0*t3*(-0.298886D-2*t7*t11
     #+0.174462D-3*t168*t21-0.143865856D-5*t171*t29+0.43543808D-8*t174
     #*t38-0.479940608D-11*t180*t113)-0.3109D-1*t48*t60*(-0.521398D-1
     #*t7*t63+0.4506132D-1*t168*t67-0.54745952D-1*t171*t71
     #+0.2546984D-1*t174*t75-0.31811968D-2*t180*t159)
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      t207 = sigmaaa/t5/t15
      t210 = t15*t84
      t213 = t14/t2/t210
      t217 = t24/t33
      t223 = t32/t5/t25/t15
      t229 = t107/t2/t25/t210
      t233 = t25**2
      t236 = t32*t14/t233/t4
      t238 = 1/t37/t20
      t249 = 1/t84
      t251 = 1/t54/t44
      t263 = t144**2
      t270 = 1/t15
      t296 = t126**2
      t299 = t59**2
      t319 = 1/t74/t66
      s1 = -0.4135669939329333D0/t5*t41-0.24814019635976D1*t2*t116
     #-0.9305257363491D0*t3*(-0.2922440888888889D-1*t207*t11
     #+0.3031485795555556D-2*t213*t21-0.4445275477333333D-4*t217*t29
     #+0.2582351553422222D-6*t223*t38-0.6788757367466667D-9*t229*t113
     #+0.6825821980444444D-12*t236*t238)+0.2D1*t47*t127*t147-0.6218D-1
     #*t119*t162+0.8806734334819047D-3*t249*t251*t79
      v2rhoa2(i) = s1-0.8497974591333914D-1*t123*t127*t147
     #+0.2642020300445714D-2*t123*t163-0.2D1*t48/t126/t56*t263*t145
     #*t78+0.1D1*t128*(-0.1544496508763151D1/t131/t44*t270
     #+0.3706791621031562D1*t132*t249-0.854388052766047D0*t251*t270
     #+0.2563164158298141D1*t122*t249-0.4111834438919023D0/t52/t44
     #*t270+0.1644733775567609D1*t138*t249-0.5346380647307093D-1/t45
     #/t44*t270+0.3207828388384256D0*t141*t249)*t145*t78
     #+0.321646831778707D2*t48/t296*t263/t299*t78+0.2D1*t128*t146*t162
     #-0.3109D-1*t48*t60*(-0.5098113777777778D0*t207*t63
     #+0.8351900088888889D0*t213*t67-0.1442077269333333D1*t217*t71
     #+0.1025977750755556D1*t223*t75-0.2664875008D0*t229*t159
     #+0.2262184391111111D-1*t236*t319)
      v2rhob2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t328 = sigmaaa*t26
      t331 = t14*t35
      t334 = t24*t179
      t338 = t32/t233
      v2sigmaaa2(i) = -0.9305257363491D0*t3*(0.18641744D-3*t18*t21
     #-0.427301312D-5*t328*t29+0.3032704512D-7*t331*t38
     #-0.8886771712D-10*t334*t113+0.959881216D-13*t338*t238)-0.3109D-1
     #*t48*t60*(0.5548928D-1*t18*t67-0.127516432D0*t328*t71
     #+0.1092570912D0*t331*t75-0.331006592D-1*t334*t159+0.31811968D-2
     #*t338*t319)
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      v2sigmabb2(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t5 = t4*rhoa
      t6 = rhoa**2
      t7 = t4**2
      t9 = 1/t7/t6
      t10 = sigmaaa*t9
      t12 = 1.D0+0.4D-2*t10
      t13 = 1/t12
      t16 = sigmaaa**2
      t17 = t6**2
      t18 = t17*rhoa
      t20 = 1/t4/t18
      t21 = t16*t20
      t22 = t12**2
      t23 = 1/t22
      t26 = t16*sigmaaa
      t27 = t17**2
      t28 = 1/t27
      t29 = t26*t28
      t31 = 1/t22/t12
      t34 = t16**2
      t35 = t27*t6
      t37 = 1/t7/t35
      t38 = t34*t37
      t39 = t22**2
      t40 = 1/t39
      t43 = 0.109163D1-0.298886D-2*t10*t13+0.8125328D-4*t21*t23
     #-0.26287744D-6*t29*t31+0.29996288D-9*t38*t40
      t46 = 1/rhoa
      t47 = t46**(1.D0/3.D0)
      t49 = 1.D0+0.1274696188700087D0*t47
      t50 = rhoa*t49
      t51 = t46**(1.D0/6.D0)
      t54 = dsqrt(t46)
      t56 = t47**2
      t58 = 0.1112037486309468D2*t51+0.3844746237447211D1*t47
     #+0.1644733775567609D1*t54+0.2405871291288192D0*t56
      t61 = 1.D0+0.321646831778707D2/t58
      t62 = dlog(t61)
      t64 = 1.D0+0.2D0*t10
      t65 = 1/t64
      t68 = t64**2
      t69 = 1/t68
      t73 = 1/t68/t64
      t76 = t68**2
      t77 = 1/t76
      t80 = 0.489508D0-0.521398D-1*t10*t65+0.1731668D-1*t21*t69
     #-0.1593976D-1*t29*t73+0.3976496D-2*t38*t77
      t81 = t62*t80
      t84 = rhob**(1.D0/3.D0)
      t85 = t84*rhob
      t86 = rhob**2
      t87 = t84**2
      t89 = 1/t87/t86
      t90 = sigmabb*t89
      t92 = 1.D0+0.4D-2*t90
      t93 = 1/t92
      t96 = sigmabb**2
      t97 = t86**2
      t98 = t97*rhob
      t100 = 1/t84/t98
      t101 = t96*t100
      t102 = t92**2
      t103 = 1/t102
      t106 = t96*sigmabb
      t107 = t97**2
      t108 = 1/t107
      t109 = t106*t108
      t111 = 1/t102/t92
      t114 = t96**2
      t115 = t107*t86
      t117 = 1/t87/t115
      t118 = t114*t117
      t119 = t102**2
      t120 = 1/t119
      t123 = 0.109163D1-0.298886D-2*t90*t93+0.8125328D-4*t101*t103
     #-0.26287744D-6*t109*t111+0.29996288D-9*t118*t120
      t126 = 1/rhob
      t127 = t126**(1.D0/3.D0)
      t129 = 1.D0+0.1274696188700087D0*t127
      t130 = rhob*t129
      t131 = t126**(1.D0/6.D0)
      t134 = dsqrt(t126)
      t136 = t127**2
      t138 = 0.1112037486309468D2*t131+0.3844746237447211D1*t127
     #+0.1644733775567609D1*t134+0.2405871291288192D0*t136
      t141 = 1.D0+0.321646831778707D2/t138
      t142 = dlog(t141)
      t144 = 1.D0+0.2D0*t90
      t145 = 1/t144
      t148 = t144**2
      t149 = 1/t148
      t153 = 1/t148/t144
      t156 = t148**2
      t157 = 1/t156
      t160 = 0.489508D0-0.521398D-1*t90*t145+0.1731668D-1*t101*t149
     #-0.1593976D-1*t109*t153+0.3976496D-2*t118*t157
      t161 = t142*t160
      t164 = rhoa+rhob
      t165 = 1/t164
      t166 = t165**(1.D0/3.D0)
      t168 = 1.D0+0.1325688999052018D0*t166
      t169 = t165**(1.D0/6.D0)
      t172 = dsqrt(t165)
      t174 = t166**2
      t176 = 0.598255043577108D1*t169+0.2225569421150687D1*t166
     #+0.8004286349993634D0*t172+0.1897004325747559D0*t174
      t179 = 1.D0+0.160818243221511D2/t176
      t180 = dlog(t179)
      t182 = 0.62182D-1*t168*t180
      t184 = 1.D0+0.6901399211255825D-1*t166
      t189 = 0.8157414703487641D1*t169+0.2247591863577616D1*t166
     #+0.4300972471276643D0*t172+0.1911512595127338D0*t174
      t192 = 1.D0+0.2960857464321668D2/t189
      t193 = dlog(t192)
      t194 = t184*t193
      t196 = rhoa-1.D0*rhob
      t197 = t196*t165
      t198 = 1.D0+t197
      t199 = t198**(1.D0/3.D0)
      t202 = 1.D0-1.D0*t197
      t203 = t202**(1.D0/3.D0)
      t205 = t199*t198+t203*t202-2.D0
      t206 = t196**2
      t207 = t206**2
      t208 = t164**2
      t209 = t208**2
      t210 = 1/t209
      t211 = t207*t210
      t213 = 1.D0-1.D0*t211
      t214 = t205*t213
      t216 = 0.3799574853701528D-1*t194*t214
      t218 = 1.D0+0.1274696188700087D0*t166
      t223 = 0.1112037486309468D2*t169+0.3844746237447211D1*t166
     #+0.1644733775567609D1*t172+0.2405871291288192D0*t174
      t226 = 1.D0+0.321646831778707D2/t223
      t227 = dlog(t226)
      t230 = -0.3109D-1*t218*t227+t182
      t231 = t230*t205
      t233 = 0.1923661050931536D1*t231*t211
      t240 = t164*(-t182+t216+t233)+0.3109D-1*t50*t62+0.3109D-1*t130
     #*t142
      t243 = 0.5D0*t10+0.5D0*t90
      t246 = 1.D0+0.3D-2*t10+0.3D-2*t90
      t247 = 1/t246
      t250 = t243**2
      t251 = t246**2
      t252 = 1/t251
      t255 = t250*t243
      t257 = 1/t251/t246
      t260 = t250**2
      t261 = t251**2
      t262 = 1/t261
      t265 = 0.51473D0+0.4157892D-1*t243*t247-0.8894628D-3*t250*t252
     #+0.49917168D-5*t255*t257-0.146751264D-7*t260*t262
      zk(i) = -0.9305257363491D0*t5*t43-0.3109D-1*t50*t81
     #-0.9305257363491D0*t85*t123-0.3109D-1*t130*t161+t240*t265
      t269 = t6*rhoa
      t271 = 1/t7/t269
      t272 = sigmaaa*t271
      t275 = t17*t6
      t277 = 1/t4/t275
      t278 = t16*t277
      t282 = 1/t27/rhoa
      t283 = t26*t282
      t288 = 1/t7/t27/t269
      t289 = t34*t288
      t292 = t34*sigmaaa
      t295 = 1/t4/t27/t275
      t296 = t292*t295
      t298 = 1/t39/t12
      t301 = 0.7970293333333333D-2*t272*t13-0.465232D-3*t278*t23
     #+0.3836422826666667D-5*t283*t31-0.1161168213333333D-7*t289*t40
     #+0.1279841621333333D-10*t296*t298
      t304 = t49*t62
      t307 = 1/t56
      t308 = t46*t307
      t311 = t58**2
      t312 = 1/t311
      t313 = t50*t312
      t314 = t51**2
      t315 = t314**2
      t316 = t315*t51
      t317 = 1/t316
      t318 = 1/t6
      t323 = 1/t54
      t326 = 1/t47
      t329 = -0.1853395810515781D1*t317*t318-0.128158207914907D1*t307
     #*t318-0.8223668877838045D0*t323*t318-0.1603914194192128D0*t326
     #*t318
      t330 = 1/t61
      t331 = t329*t330
      t332 = t331*t80
      t344 = 1/t76/t64
      t347 = 0.1390394666666667D0*t272*t65-0.12016352D0*t278*t69
     #+0.1459892053333333D0*t283*t73-0.6791957333333333D-1*t289*t77
     #+0.8483191466666667D-2*t296*t344
      t348 = t62*t347
      t351 = 1/t174
      t352 = 1/t208
      t353 = t351*t352
      t354 = t353*t180
      t355 = 0.2747799777968419D-2*t354
      t356 = t176**2
      t357 = 1/t356
      t358 = t168*t357
      t359 = t169**2
      t360 = t359**2
      t361 = t360*t169
      t362 = 1/t361
      t363 = t362*t352
      t366 = 1/t172
      t367 = t366*t352
      t369 = 1/t166
      t370 = t369*t352
      t372 = -0.99709173929518D0*t363-0.7418564737168958D0*t353
     #-0.4002143174996817D0*t367-0.1264669550498372D0*t370
      t373 = 1/t179
      t375 = t358*t372*t373
      t376 = 0.1D1*t375
      t377 = t193*t205
      t378 = t377*t213
      t379 = t353*t378
      t380 = 0.8740794299481065D-3*t379
      t381 = t189**2
      t382 = 1/t381
      t383 = t184*t382
      t388 = -0.135956911724794D1*t363-0.7491972878592054D0*t353
     #-0.2150486235638321D0*t367-0.1274341730084892D0*t370
      t389 = t383*t388
      t390 = 1/t192
      t391 = t390*t205
      t392 = t391*t213
      t393 = t389*t392
      t394 = 0.1124999956683108D1*t393
      t395 = t196*t352
      t396 = 1.D0*t395
      t397 = t165-t396
      t400 = 1.D0*t165
      t401 = -t400+t395
      t404 = 0.1333333333333333D1*t199*t397+0.1333333333333333D1*t203
     #*t401
      t406 = t194*t404*t213
      t407 = 0.3799574853701528D-1*t406
      t408 = t206*t196
      t409 = t408*t210
      t410 = 4.D0*t409
      t412 = 1/t209/t164
      t413 = t207*t412
      t414 = 4.D0*t413
      t415 = -t410+t414
      t417 = t194*t205*t415
      t418 = 0.3799574853701528D-1*t417
      t421 = t223**2
      t422 = 1/t421
      t423 = t218*t422
      t428 = -0.1853395810515781D1*t363-0.128158207914907D1*t353
     #-0.8223668877838045D0*t367-0.1603914194192128D0*t370
      t429 = 1/t226
      t435 = 0.1321010150222857D-2*t353*t227+0.1D1*t423*t428*t429
     #-0.2747799777968419D-2*t354-0.1D1*t375
      t436 = t435*t205
      t437 = t436*t211
      t438 = 0.1923661050931536D1*t437
      t439 = t230*t404
      t440 = t439*t211
      t441 = 0.1923661050931536D1*t440
      t442 = t231*t409
      t444 = t231*t413
      t445 = 0.7694644203726145D1*t444
      t452 = t312*t329*t330
      t455 = -t182+t216+t233+t164*(t355+t376-t380-t394+t407+t418+t438
     #+t441+0.7694644203726145D1*t442-t445)+0.3109D-1*t304
     #-0.1321010150222857D-2*t308*t62-0.1D1*t50*t452
      t459 = t243*t252
      t462 = t250*t257
      t465 = t255*t262
      t469 = 1/t261/t246
      t470 = t260*t469
      t473 = -0.5543856D-1*t272*t247+0.270453216D-2*t459*t272
     #-0.34198272D-4*t462*t272+0.198068544D-6*t465*t272
     #-0.4696040448D-9*t470*t272
      vrhoa(i) = -0.12407009817988D1*t4*t43-0.9305257363491D0*t5*t301
     #-0.3109D-1*t304*t80+0.1321010150222857D-2*t308*t81+0.1D1*t313
     #*t332-0.3109D-1*t50*t348+t455*t265+t240*t473
      t477 = t86*rhob
      t479 = 1/t87/t477
      t480 = sigmabb*t479
      t483 = t97*t86
      t485 = 1/t84/t483
      t486 = t96*t485
      t490 = 1/t107/rhob
      t491 = t106*t490
      t496 = 1/t87/t107/t477
      t497 = t114*t496
      t500 = t114*sigmabb
      t503 = 1/t84/t107/t483
      t504 = t500*t503
      t506 = 1/t119/t92
      t509 = 0.7970293333333333D-2*t480*t93-0.465232D-3*t486*t103
     #+0.3836422826666667D-5*t491*t111-0.1161168213333333D-7*t497*t120
     #+0.1279841621333333D-10*t504*t506
      t512 = t129*t142
      t515 = 1/t136
      t516 = t126*t515
      t519 = t138**2
      t520 = 1/t519
      t521 = t130*t520
      t522 = t131**2
      t523 = t522**2
      t524 = t523*t131
      t525 = 1/t524
      t526 = 1/t86
      t531 = 1/t134
      t534 = 1/t127
      t537 = -0.1853395810515781D1*t525*t526-0.128158207914907D1*t515
     #*t526-0.8223668877838045D0*t531*t526-0.1603914194192128D0*t534
     #*t526
      t538 = 1/t141
      t539 = t537*t538
      t540 = t539*t160
      t552 = 1/t156/t144
      t555 = 0.1390394666666667D0*t480*t145-0.12016352D0*t486*t149
     #+0.1459892053333333D0*t491*t153-0.6791957333333333D-1*t497*t157
     #+0.8483191466666667D-2*t504*t552
      t556 = t142*t555
      t559 = -t400-t396
      t562 = t165+t395
      t565 = 0.1333333333333333D1*t199*t559+0.1333333333333333D1*t203
     #*t562
      t567 = t194*t565*t213
      t568 = 0.3799574853701528D-1*t567
      t569 = t410+t414
      t571 = t194*t205*t569
      t572 = 0.3799574853701528D-1*t571
      t573 = t230*t565
      t574 = t573*t211
      t575 = 0.1923661050931536D1*t574
      t583 = t520*t537*t538
      t586 = -t182+t216+t233+t164*(t355+t376-t380-t394+t568+t572+t438
     #+t575-0.7694644203726145D1*t442-t445)+0.3109D-1*t512
     #-0.1321010150222857D-2*t516*t142-0.1D1*t130*t583
      t598 = -0.5543856D-1*t480*t247+0.270453216D-2*t459*t480
     #-0.34198272D-4*t462*t480+0.198068544D-6*t465*t480
     #-0.4696040448D-9*t470*t480
      vrhob(i) = -0.12407009817988D1*t84*t123-0.9305257363491D0*t85
     #*t509-0.3109D-1*t512*t160+0.1321010150222857D-2*t516*t161+0.1D1
     #*t521*t540-0.3109D-1*t130*t556+t586*t265+t240*t598
      t602 = sigmaaa*t20
      t605 = t16*t28
      t608 = t26*t37
      t613 = 1/t4/t27/t18
      t614 = t34*t613
      t617 = -0.298886D-2*t9*t13+0.174462D-3*t602*t23-0.143865856D-5
     #*t605*t31+0.43543808D-8*t608*t40-0.479940608D-11*t614*t298
      t630 = -0.521398D-1*t9*t65+0.4506132D-1*t602*t69-0.54745952D-1
     #*t605*t73+0.2546984D-1*t608*t77-0.31811968D-2*t614*t344
      t631 = t62*t630
      t644 = 0.2078946D-1*t9*t247-0.101419956D-2*t459*t9+0.12824352D-4
     #*t462*t9-0.74275704D-7*t465*t9+0.1761015168D-9*t470*t9
      vsigmaaa(i) = -0.9305257363491D0*t5*t617-0.3109D-1*t50*t631+t240
     #*t644
      vsigmaab(i) = 0.D0
      t648 = sigmabb*t100
      t651 = t96*t108
      t654 = t106*t117
      t659 = 1/t84/t107/t98
      t660 = t114*t659
      t663 = -0.298886D-2*t89*t93+0.174462D-3*t648*t103-0.143865856D-5
     #*t651*t111+0.43543808D-8*t654*t120-0.479940608D-11*t660*t506
      t676 = -0.521398D-1*t89*t145+0.4506132D-1*t648*t149
     #-0.54745952D-1*t651*t153+0.2546984D-1*t654*t157-0.31811968D-2
     #*t660*t552
      t677 = t142*t676
      t690 = 0.2078946D-1*t89*t247-0.101419956D-2*t459*t89
     #+0.12824352D-4*t462*t89-0.74275704D-7*t465*t89+0.1761015168D-9
     #*t470*t89
      vsigmabb(i) = -0.9305257363491D0*t85*t663-0.3109D-1*t130*t677
     #+t240*t690
      t696 = sigmaaa/t7/t17
      t699 = t17*t269
      t702 = t16/t4/t699
      t705 = t243*t257
      t710 = t250*t262
      t715 = t255*t469
      t722 = t260/t261/t251
      t739 = t26/t35
      t745 = t34/t7/t27/t17
      t751 = t292/t4/t27/t699
      t755 = t27**2
      t758 = t34*t16/t755/t6
      t760 = 1/t39/t22
      t766 = t49*t312
      t774 = 1/t311/t58
      t776 = t329**2
      t784 = 1/t269
      t786 = 1/t56/t46
      t787 = t784*t786
      t792 = 1/t17
      t813 = -0.1544496508763151D1/t316/t46*t792+0.3706791621031562D1
     #*t317*t784-0.854388052766047D0*t786*t792+0.2563164158298141D1
     #*t307*t784-0.4111834438919023D0/t54/t46*t792
     #+0.1644733775567609D1*t323*t784-0.5346380647307093D-1/t47/t46
     #*t792+0.3207828388384256D0*t326*t784
      t821 = t311**2
      t822 = 1/t821
      t824 = t61**2
      t825 = 1/t824
      t841 = 1/t76/t68
      t848 = 0.2D1*t375
      t850 = 0.5495599555936838D-2*t354
      t852 = 0.1748158859896213D-2*t379
      t853 = 0.2249999913366216D1*t393
      t854 = 0.3847322101863073D1*t437
      t856 = 0.1538928840745229D2*t444
      t876 = t408*t412
      t877 = t231*t876
      t879 = t436*t409
      t883 = 1/t174/t165*t210
      t884 = t883*t180
      t885 = 0.1831866518645613D-2*t884
      t889 = t388**2
      t892 = 0.2249999913366216D1*t184/t381/t189*t889*t392
      t894 = 1/t208/t164
      t895 = t351*t894
      t896 = t895*t180
      t897 = 0.5495599555936838D-2*t896
      t898 = t439*t413
      t901 = 0.1538928840745229D2*t436*t413
      t902 = t206*t210
      t903 = t231*t902
      t904 = 0.2308393261117844D2*t903
      t905 = t199**2
      t906 = 1/t905
      t907 = t397**2
      t910 = 2.D0*t352
      t912 = 2.D0*t196*t894
      t913 = -t910+t912
      t916 = t203**2
      t917 = 1/t916
      t918 = t401**2
      t924 = 0.4444444444444444D0*t906*t907+0.1333333333333333D1*t199
     #*t913+0.4444444444444444D0*t917*t918-0.1333333333333333D1*t203
     #*t913
      t928 = 12.D0*t902
      t929 = 32.D0*t876
      t932 = t207/t209/t208
      t933 = 20.D0*t932
      t940 = t389*t390*t404*t213
      t943 = t389*t391*t415
      t945 = t381**2
      t949 = t192**2
      t954 = 0.3330964519106732D2*t184/t945*t889/t949*t205*t213
      t955 = t439*t409
      t957 = -0.6155715362980916D2*t877+0.1538928840745229D2*t879+t885
     #+t892-t897-0.1538928840745229D2*t898-t901+t904
     #+0.3799574853701528D-1*t194*t924*t213+0.3799574853701528D-1*t194
     #*t205*(-t928+t929-t933)-0.2249999913366216D1*t940
     #-0.2249999913366216D1*t943-t954+0.1538928840745229D2*t955
      t959 = t435*t404*t211
      t963 = 1/t361/t165*t210
      t965 = t362*t894
      t971 = 1/t172/t165*t210
      t973 = t366*t894
      t977 = 1/t166/t165*t210
      t979 = t369*t894
      t984 = 0.1124999956683108D1*t383*(-0.1132974264373283D1*t963
     #+0.271913823449588D1*t965-0.4994648585728036D0*t883
     #+0.1498394575718411D1*t895-0.1075243117819161D0*t971
     #+0.4300972471276643D0*t973-0.4247805766949639D-1*t977
     #+0.2548683460169784D0*t979)*t392
      t991 = t372**2
      t993 = t168/t356/t176*t991*t373
      t994 = 0.2D1*t993
      t1005 = t358*(-0.8309097827459833D0*t963+0.199418347859036D1
     #*t965-0.4945709824779306D0*t883+0.1483712947433792D1*t895
     #-0.2001071587498409D0*t971+0.8004286349993634D0*t973
     #-0.4215565168327908D-1*t977+0.2529339100996745D0*t979)*t373
      t1006 = 0.1D1*t1005
      t1009 = t353*t357*t372*t373
      t1010 = 0.8837926660346786D-1*t1009
      t1011 = t356**2
      t1014 = t179**2
      t1017 = t168/t1011*t991/t1014
      t1018 = 0.160818243221511D2*t1017
      t1030 = t428**2
      t1046 = t421**2
      t1049 = t226**2
      t1060 = 0.8806734334819047D-3*t883*t227-0.2642020300445714D-2
     #*t895*t227-0.8497974591333914D-1*t353*t422*t428*t429-0.2D1*t218
     #/t421/t223*t1030*t429+0.1D1*t423*(-0.1544496508763151D1*t963
     #+0.3706791621031562D1*t965-0.854388052766047D0*t883
     #+0.2563164158298141D1*t895-0.4111834438919023D0*t971
     #+0.1644733775567609D1*t973-0.5346380647307093D-1*t977
     #+0.3207828388384256D0*t979)*t429+0.321646831778707D2*t218/t1046
     #*t1030/t1049-0.1831866518645613D-2*t884+0.5495599555936838D-2
     #*t896+0.8837926660346786D-1*t1009+0.2D1*t993-0.1D1*t1005
     #-0.160818243221511D2*t1017
      t1063 = 0.1923661050931536D1*t1060*t205*t211
      t1065 = 0.3847322101863073D2*t231*t932
      t1068 = t353*t193*t404*t213
      t1071 = t353*t377*t415
      t1074 = 0.5827196199654043D-3*t883*t378
      t1082 = 0.5176049209143758D-1*t353*t382*t388*t390*t214
      t1084 = 0.1748158859896213D-2*t895*t378
      t1085 = 0.3847322101863073D1*t959-t984+0.7599149707403056D-1
     #*t194*t404*t415-t994+t1006-t1010+t1018+t1063+t1065
     #-0.1748158859896213D-2*t1068-0.1748158859896213D-2*t1071-t1074
     #+0.1923661050931536D1*t230*t924*t211+t1082+t1084
      t1088 = t848+0.7599149707403056D-1*t406+t850
     #+0.7599149707403056D-1*t417-t852-t853+t854+0.1538928840745229D2
     #*t442-t856+0.3847322101863073D1*t440-0.321646831778707D2*t50
     #*t822*t776*t825-0.1D1*t50*t312*t813*t330-0.8806734334819047D-3
     #*t787*t62+0.8497974591333914D-1*t308*t452+0.2D1*t50*t774*t776
     #*t330-0.2D1*t766*t331+t164*(t957+t1085)
      s1 = 2.D0*t455*t473+t240*(0.20327472D0*t696*t247-0.404955136D-2
     #*t702*t252+0.13446790656D-3*t705*t702-0.991661792D-2*t459*t696
     #-0.1613032704D-5*t710*t702+0.125393664D-3*t462*t696
     #+0.88427483136D-8*t715*t702-0.726251328D-6*t465*t696
     #-0.18784161792D-10*t722*t702+0.17218814976D-8*t470*t696)
     #-0.4135669939329333D0/t7*t43-0.24814019635976D1*t4*t301
     #-0.9305257363491D0*t5*(-0.2922440888888889D-1*t696*t13
     #+0.3031485795555556D-2*t702*t23-0.4445275477333333D-4*t739*t31
     #+0.2582351553422222D-6*t745*t40-0.6788757367466667D-9*t751*t298
     #+0.6825821980444444D-12*t758*t760)+0.2D1*t766*t332-0.6218D-1
     #*t304*t347+0.2642020300445714D-2*t308*t348
      v2rhoa2(i) = s1-0.2D1*t50*t774*t776*t330*t80
     #-0.8497974591333914D-1*t308*t312*t332+0.8806734334819047D-3*t787
     #*t81+0.1D1*t313*t813*t330*t80+0.2D1*t313*t331*t347
     #+0.321646831778707D2*t50*t822*t776*t825*t80-0.3109D-1*t50*t62*(
     #-0.5098113777777778D0*t696*t65+0.8351900088888889D0*t702*t69
     #-0.1442077269333333D1*t739*t73+0.1025977750755556D1*t745*t77
     #-0.2664875008D0*t751*t344+0.2262184391111111D-1*t758*t841)+t1088
     #*t265
      t1090 = t129*t520
      t1104 = sigmabb/t87/t97
      t1107 = t97*t477
      t1110 = t96/t84/t1107
      t1114 = t106/t115
      t1120 = t114/t87/t107/t97
      t1126 = t500/t84/t107/t1107
      t1130 = t107**2
      t1133 = t114*t96/t1130/t86
      t1135 = 1/t119/t102
      t1141 = 1/t477
      t1143 = 1/t136/t126
      t1144 = t1141*t1143
      t1151 = 1/t519/t138
      t1153 = t537**2
      t1169 = 1/t156/t148
      t1178 = 1/t97
      t1199 = -0.1544496508763151D1/t524/t126*t1178
     #+0.3706791621031562D1*t525*t1141-0.854388052766047D0*t1143*t1178
     #+0.2563164158298141D1*t515*t1141-0.4111834438919023D0/t134/t126
     #*t1178+0.1644733775567609D1*t531*t1141-0.5346380647307093D-1
     #/t127/t126*t1178+0.3207828388384256D0*t534*t1141
      t1207 = t519**2
      t1208 = 1/t1207
      t1210 = t141**2
      t1211 = 1/t1210
      t1222 = t559**2
      t1225 = t910+t912
      t1228 = t562**2
      t1234 = 0.4444444444444444D0*t906*t1222+0.1333333333333333D1
     #*t199*t1225+0.4444444444444444D0*t917*t1228-0.1333333333333333D1
     #*t203*t1225
      t1245 = 0.6155715362980916D2*t877-0.1538928840745229D2*t879+t885
     #+t892-t897-t901+t904-t954-t984-t994+t1006+0.3799574853701528D-1
     #*t194*t1234*t213+0.7599149707403056D-1*t194*t565*t569
     #+0.3799574853701528D-1*t194*t205*(-t928-t929-t933)
      t1247 = t353*t377*t569
      t1251 = t353*t193*t565*t213
      t1255 = t389*t390*t565*t213
      t1258 = t389*t391*t569
      t1261 = t435*t565*t211
      t1266 = t573*t413
      t1268 = t573*t409
      t1270 = -t1010-0.1748158859896213D-2*t1247+t1018
     #-0.1748158859896213D-2*t1251-0.2249999913366216D1*t1255
     #-0.2249999913366216D1*t1258+t1063+t1065+0.3847322101863073D1
     #*t1261+0.1923661050931536D1*t230*t1234*t211-0.1538928840745229D2
     #*t1266-0.1538928840745229D2*t1268-t1074+t1082+t1084
      t1291 = t848+t850-t852-t853+t854-0.1538928840745229D2*t442-t856
     #+0.3847322101863073D1*t574+0.7599149707403056D-1*t567
     #+0.7599149707403056D-1*t571+t164*(t1245+t1270)-0.2D1*t1090*t539
     #-0.8806734334819047D-3*t1144*t142+0.8497974591333914D-1*t516
     #*t583+0.2D1*t130*t1151*t1153*t538-0.1D1*t130*t520*t1199*t538
     #-0.321646831778707D2*t130*t1208*t1153*t1211
      s1 = 0.2D1*t1090*t540+0.2642020300445714D-2*t516*t556
     #-0.4135669939329333D0/t87*t123-0.24814019635976D1*t84*t509
     #-0.6218D-1*t512*t555-0.9305257363491D0*t85*(
     #-0.2922440888888889D-1*t1104*t93+0.3031485795555556D-2*t1110
     #*t103-0.4445275477333333D-4*t1114*t111+0.2582351553422222D-6
     #*t1120*t120-0.6788757367466667D-9*t1126*t506
     #+0.6825821980444444D-12*t1133*t1135)+0.8806734334819047D-3*t1144
     #*t161-0.8497974591333914D-1*t516*t520*t540
      s2 = s1-0.2D1*t130*t1151*t1153*t538*t160-0.3109D-1*t130*t142*(
     #-0.5098113777777778D0*t1104*t145+0.8351900088888889D0*t1110*t149
     #-0.1442077269333333D1*t1114*t153+0.1025977750755556D1*t1120*t157
     #-0.2664875008D0*t1126*t552+0.2262184391111111D-1*t1133*t1169)
     #+0.1D1*t521*t1199*t538*t160
      v2rhob2(i) = s2+0.2D1*t521*t539*t555+0.321646831778707D2*t130
     #*t1208*t1153*t1211*t160+t1291*t265+2.D0*t586*t598+t240*
     #(0.20327472D0*t1104*t247-0.404955136D-2*t1110*t252
     #+0.13446790656D-3*t705*t1110-0.991661792D-2*t459*t1104
     #-0.1613032704D-5*t710*t1110+0.125393664D-3*t462*t1104
     #+0.88427483136D-8*t715*t1110-0.726251328D-6*t465*t1104
     #-0.18784161792D-10*t722*t1110+0.17218814976D-8*t470*t1104)
      t1330 = 0.4444444444444444D0*t906*t397*t559+0.2666666666666667D1
     #*t199*t196*t894+0.4444444444444444D0*t917*t401*t562
     #-0.2666666666666667D1*t203*t196*t894
      t1346 = t885+t892-t897-0.7694644203726145D1*t898-t901
     #+0.3799574853701528D-1*t194*t1330*t213+0.3799574853701528D-1
     #*t194*t205*(t928-t933)-0.2308393261117844D2*t903
     #-0.1124999956683108D1*t940-0.1124999956683108D1*t943
     #+0.3799574853701528D-1*t194*t404*t569-t954-0.7694644203726145D1
     #*t955+0.1923661050931536D1*t959-t984-t994+t1006
      t1362 = -t1010-0.8740794299481065D-3*t1247+t1018
     #-0.8740794299481065D-3*t1251-0.1124999956683108D1*t1255
     #-0.1124999956683108D1*t1258+t1063+t1065+0.1923661050931536D1
     #*t1261-0.7694644203726145D1*t1266-0.8740794299481065D-3*t1068
     #-0.8740794299481065D-3*t1071+0.7694644203726145D1*t1268-t1074
     #+t1082+t1084+0.3799574853701528D-1*t194*t565*t415
     #+0.1923661050931536D1*t230*t1330*t211
      t1365 = t850+t848-t852-t853+t568+t572+t854+t575-t856+t407+t418
     #+t441+t164*(t1346+t1362)
      t1375 = t271*sigmabb*t479
      v2rhoab(i) = t1365*t265+t455*t598+t586*t473+t240*(
     #-0.404955136D-2*t272*t252*sigmabb*t479+0.13446790656D-3*t705
     #*sigmaaa*t1375-0.1613032704D-5*t710*sigmaaa*t1375
     #+0.88427483136D-8*t715*sigmaaa*t1375-0.18784161792D-10*t722
     #*sigmaaa*t1375)
      t1393 = sigmaaa*t277
      t1396 = t16*t282
      t1399 = t26*t288
      t1402 = t34*t295
      t1407 = t292/t755/rhoa
      s1 = -0.12407009817988D1*t4*t617-0.9305257363491D0*t5*
     #(0.7970293333333333D-2*t271*t13-0.9623451733333333D-3*t1393*t23
     #+0.1523112448D-4*t1396*t31-0.9248380245333333D-7*t1399*t40
     #+0.2497789952D-9*t1402*t298-0.2559683242666667D-12*t1407*t760)
     #-0.3109D-1*t304*t630+0.1321010150222857D-2*t308*t631
      v2rhoasigmaaa(i) = s1+0.1D1*t313*t331*t630-0.3109D-1*t50*t62*
     #(0.1390394666666667D0*t271*t65-0.2681349333333333D0*t1393*t69
     #+0.486033024D0*t1396*t73-0.3592718165333333D0*t1399*t77
     #+0.96751616D-1*t1402*t344-0.8483191466666667D-2*t1407*t841)+t455
     #*t644+t240*(-0.5543856D-1*t271*t247+0.151858176D-2*t1393*t252
     #-0.5042546496D-4*t705*t1393+0.270453216D-2*t459*t271
     #+0.604887264D-6*t710*t1393-0.34198272D-4*t462*t271
     #-0.33160306176D-8*t715*t1393+0.198068544D-6*t465*t271
     #+0.7044060672D-11*t722*t1393-0.4696040448D-9*t470*t271)
      v2rhoasigmaab(i) = 0.D0
      t1463 = t272*t89
      v2rhoasigmabb(i) = t455*t690+t240*(0.151858176D-2*t272*t252*t89
     #-0.5042546496D-4*t705*t1463+0.604887264D-6*t710*t1463
     #-0.33160306176D-8*t715*t1463+0.7044060672D-11*t722*t1463)
      t1475 = t252*t9
      t1478 = t480*t9
      v2rhobsigmaaa(i) = t586*t644+t240*(0.151858176D-2*t480*t1475
     #-0.5042546496D-4*t705*t1478+0.604887264D-6*t710*t1478
     #-0.33160306176D-8*t715*t1478+0.7044060672D-11*t722*t1478)
      v2rhobsigmaab(i) = 0.D0
      t1493 = sigmabb*t485
      t1496 = t96*t490
      t1499 = t106*t496
      t1502 = t114*t503
      t1507 = t500/t1130/rhob
      s1 = -0.12407009817988D1*t84*t663-0.9305257363491D0*t85*
     #(0.7970293333333333D-2*t479*t93-0.9623451733333333D-3*t1493*t103
     #+0.1523112448D-4*t1496*t111-0.9248380245333333D-7*t1499*t120
     #+0.2497789952D-9*t1502*t506-0.2559683242666667D-12*t1507*t1135)
     #-0.3109D-1*t512*t676+0.1321010150222857D-2*t516*t677
      v2rhobsigmabb(i) = s1+0.1D1*t521*t539*t676-0.3109D-1*t130*t142*
     #(0.1390394666666667D0*t479*t145-0.2681349333333333D0*t1493*t149
     #+0.486033024D0*t1496*t153-0.3592718165333333D0*t1499*t157
     #+0.96751616D-1*t1502*t552-0.8483191466666667D-2*t1507*t1169)
     #+t586*t690+t240*(-0.5543856D-1*t479*t247+0.151858176D-2*t1493
     #*t252-0.5042546496D-4*t705*t1493+0.270453216D-2*t459*t479
     #+0.604887264D-6*t710*t1493-0.34198272D-4*t462*t479
     #-0.33160306176D-8*t715*t1493+0.198068544D-6*t465*t479
     #+0.7044060672D-11*t722*t1493-0.4696040448D-9*t470*t479)
      t1561 = sigmaaa*t28
      t1564 = t16*t37
      t1567 = t26*t613
      t1571 = t34/t755
      v2sigmaaa2(i) = -0.9305257363491D0*t5*(0.18641744D-3*t20*t23
     #-0.427301312D-5*t1561*t31+0.3032704512D-7*t1564*t40
     #-0.8886771712D-10*t1567*t298+0.959881216D-13*t1571*t760)
     #-0.3109D-1*t50*t62*(0.5548928D-1*t20*t69-0.127516432D0*t1561*t73
     #+0.1092570912D0*t1564*t77-0.331006592D-1*t1567*t344
     #+0.31811968D-2*t1571*t841)+t240*(-0.56946816D-3*t20*t252
     #+0.1890954936D-4*t705*t20-0.226832724D-6*t710*t20
     #+0.12435114816D-8*t715*t20-0.2641522752D-11*t722*t20)
      v2sigmaaaab(i) = 0.D0
      t1605 = t9*t89
      v2sigmaaabb(i) = t240*(-0.56946816D-3*t1475*t89+0.1890954936D-4
     #*t705*t1605-0.226832724D-6*t710*t1605+0.12435114816D-8*t715
     #*t1605-0.2641522752D-11*t722*t1605)
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      t1617 = sigmabb*t108
      t1620 = t96*t117
      t1623 = t106*t659
      t1627 = t114/t1130
      v2sigmabb2(i) = -0.9305257363491D0*t85*(0.18641744D-3*t100*t103
     #-0.427301312D-5*t1617*t111+0.3032704512D-7*t1620*t120
     #-0.8886771712D-10*t1623*t506+0.959881216D-13*t1627*t1135)
     #-0.3109D-1*t130*t142*(0.5548928D-1*t100*t149-0.127516432D0*t1617
     #*t153+0.1092570912D0*t1620*t157-0.331006592D-1*t1623*t552
     #+0.31811968D-2*t1627*t1169)+t240*(-0.56946816D-3*t100*t252
     #+0.1890954936D-4*t705*t100-0.226832724D-6*t710*t100
     #+0.12435114816D-8*t715*t100-0.2641522752D-11*t722*t100)
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      v2rhob2(i) = 0.0d0
      v2rhoab(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2rhoasigmaab(i) = 0.0d0
      v2rhoasigmabb(i) = 0.0d0
      v2rhobsigmaaa(i) = 0.0d0
      v2rhobsigmaab(i) = 0.0d0
      v2rhobsigmabb(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      v2sigmaab2(i) = 0.0d0
      v2sigmabb2(i) = 0.0d0
      v2sigmaaaab(i) = 0.0d0
      v2sigmaaabb(i) = 0.0d0
      v2sigmaabbb(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end
      
      
      subroutine rks_xc_hcth120
     & (ideriv,npt,rhoa1,sigmaaa1,
     &  zk,vrhoa,vsigmaaa,
     &  v2rhoa2,v2rhoasigmaaa,v2sigmaaa2)
c
c     A.D. Boese, N.L. Doltsinis, N.C. Handy, M. Sprik
c     New generalized gradient approximation functionals
c     J. Chem. Phys. 112 (2000) 1670-1678.
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt)
      REAL sigmaaa1(npt)
      REAL zk(npt),vrhoa(npt),vsigmaaa(npt)
      REAL v2rhoa2(npt),v2rhoasigmaaa(npt),v2sigmaaa2(npt)
      parameter(tol=1.0d-20)
      
      if(ideriv.eq.0) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t4 = rho**2
      t5 = t2**2
      t8 = sigma/t5/t4
      t10 = 1.D0+0.6349604207872798D-2*t8
      t14 = sigma**2
      t15 = t4**2
      t19 = t14/t2/t15/rho
      t20 = t10**2
      t25 = t15**2
      t27 = t14*sigma/t25
      t32 = t14**2
      t36 = t32/t5/t25/t4
      t37 = t20**2
      t44 = 1/rho
      t45 = t44**(1.D0/3.D0)
      t48 = rho*(1.D0+0.1606016560364007D0*t45)
      t49 = t44**(1.D0/6.D0)
      t52 = dsqrt(t44)
      t54 = t45**2
      t60 = dlog(1.D0+0.321646831778707D2/(0.1248219874679732D2*t49
     #+0.4844076716063854D1*t45+0.2326004811900819D1*t52
     #+0.3819082618690966D0*t54))
      t62 = 1.D0+0.3174802103936399D0*t8
      t66 = t62**2
      t74 = t66**2
      t93 = dlog(1.D0+0.160818243221511D2/(0.598255043577108D1*t49
     #+0.2225569421150687D1*t45+0.8004286349993634D0*t52
     #+0.1897004325747559D0*t54))
      t100 = 1.D0+0.9524406311809197D-2*t8
      t104 = t100**2
      t112 = t104**2
      zk(i) = -0.7385587663820224D0*t2*rho*(0.109163D1
     #-0.4744519508185673D-2*t8/t10+0.2047454356900042D-3*t19/t20
     #-0.105150976D-5*t27/t20/t10+0.1904645565053643D-8*t36/t37)
     #-0.3109D-1*t48*t60*(0.489508D0-0.8276677336941153D-1*t8/t62
     #+0.436352992925871D-1*t19/t66-0.6375904D-1*t27/t66/t62
     #+0.2524917573418935D-1*t36/t74)+(-0.62182D-1*rho*(1.D0
     #+0.1325688999052018D0*t45)*t93+0.3109D-1*t48*t60)*(0.51473D0
     #+0.6600242134770161D-1*t8/t100-0.2241305809636867D-2*t19/t104
     #+0.199668672D-4*t27/t104/t100-0.9318124434050518D-7*t36/t112)
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t3 = t2*rho
      t4 = rho**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigma*t7
      t10 = 1.D0+0.6349604207872798D-2*t8
      t11 = 1/t10
      t14 = sigma**2
      t15 = t4**2
      t16 = t15*rho
      t18 = 1/t2/t16
      t19 = t14*t18
      t20 = t10**2
      t21 = 1/t20
      t24 = t14*sigma
      t25 = t15**2
      t26 = 1/t25
      t27 = t24*t26
      t29 = 1/t20/t10
      t32 = t14**2
      t35 = 1/t5/t25/t4
      t36 = t32*t35
      t37 = t20**2
      t38 = 1/t37
      t41 = 0.109163D1-0.4744519508185673D-2*t8*t11
     #+0.2047454356900042D-3*t19*t21-0.105150976D-5*t27*t29
     #+0.1904645565053643D-8*t36*t38
      t44 = 1/rho
      t45 = t44**(1.D0/3.D0)
      t47 = 1.D0+0.1606016560364007D0*t45
      t48 = rho*t47
      t49 = t44**(1.D0/6.D0)
      t52 = dsqrt(t44)
      t54 = t45**2
      t56 = 0.1248219874679732D2*t49+0.4844076716063854D1*t45
     #+0.2326004811900819D1*t52+0.3819082618690966D0*t54
      t59 = 1.D0+0.321646831778707D2/t56
      t60 = dlog(t59)
      t62 = 1.D0+0.3174802103936399D0*t8
      t63 = 1/t62
      t66 = t62**2
      t67 = 1/t66
      t71 = 1/t66/t62
      t74 = t66**2
      t75 = 1/t74
      t78 = 0.489508D0-0.8276677336941153D-1*t8*t63
     #+0.436352992925871D-1*t19*t67-0.6375904D-1*t27*t71
     #+0.2524917573418935D-1*t36*t75
      t79 = t60*t78
      t83 = 1.D0+0.1325688999052018D0*t45
      t89 = 0.598255043577108D1*t49+0.2225569421150687D1*t45
     #+0.8004286349993634D0*t52+0.1897004325747559D0*t54
      t92 = 1.D0+0.160818243221511D2/t89
      t93 = dlog(t92)
      t98 = -0.62182D-1*rho*t83*t93+0.3109D-1*t48*t60
      t100 = 1.D0+0.9524406311809197D-2*t8
      t101 = 1/t100
      t104 = t100**2
      t105 = 1/t104
      t109 = 1/t104/t100
      t112 = t104**2
      t113 = 1/t112
      t116 = 0.51473D0+0.6600242134770161D-1*t8*t101
     #-0.2241305809636867D-2*t19*t105+0.199668672D-4*t27*t109
     #-0.9318124434050518D-7*t36*t113
      zk(i) = -0.7385587663820224D0*t3*t41-0.3109D-1*t48*t79+t98*t116
      t120 = t4*rho
      t123 = sigma/t5/t120
      t126 = t15*t4
      t129 = t14/t2/t126
      t134 = t24/t25/rho
      t140 = t32/t5/t25/t120
      t147 = t32*sigma/t2/t25/t126
      t149 = 1/t37/t10
      t155 = t47*t60
      t158 = 1/t54
      t159 = t44*t158
      t162 = t56**2
      t163 = 1/t162
      t165 = t49**2
      t166 = t165**2
      t169 = 1/t4
      t170 = 1/t166/t49*t169
      t172 = t158*t169
      t175 = 1/t52*t169
      t178 = 1/t45*t169
      t180 = -0.4160732915599108D1*t170-0.3229384477375903D1*t172
     #-0.2326004811900819D1*t175-0.5092110158254621D0*t178
      t181 = 1/t59
      t195 = 1/t74/t62
      t206 = t89**2
      t238 = 1/t112/t100
      s1 = -0.9847450218426965D0*t2*t41-0.3692793831910112D0*t3*
     #(0.2530410404365692D-1*t123*t11-0.2344622359538767D-2*t129*t21
     #+0.3069138261333333D-4*t134*t29-0.1474591714685894D-6*t140*t38
     #+0.257999903879912D-9*t147*t149)-0.3109D-1*t155*t78
     #+0.1664368495390566D-2*t159*t79
      vrhoa(i) = s1+0.5D0*t48*t163*t180*t181*t78-0.15545D-1*t48*t60*
     #(0.4414227913035281D0*t123*t63-0.6055861931098544D0*t129*t67
     #+0.1167913642666667D1*t134*t71-0.8625248172685168D0*t140*t75
     #+0.1710104239862703D0*t147*t195)+(-0.62182D-1*t83*t93+rho*
     #(0.2747799777968419D-2*t172*t93+0.1D1*t83/t206*(
     #-0.99709173929518D0*t170-0.7418564737168958D0*t172
     #-0.4002143174996817D0*t175-0.1264669550498372D0*t178)/t92)
     #+0.3109D-1*t155-0.1664368495390566D-2*t159*t60-0.5D0*t48*t163
     #*t180*t181)*t116+t98*(-0.1760064569272043D0*t123*t101
     #+0.136299879940066D-1*t129*t105-0.273586176D-3*t134*t109
     #+0.2515313720859277D-5*t140*t113-0.9466624338548721D-8*t147*t238)
      t245 = sigma*t18
      t248 = t14*t26
      t251 = t24*t35
      t257 = t32/t2/t25/t16
      vsigmaaa(i) = -0.7385587663820224D0*t3*(-0.1897807803274269D-1
     #*t7*t11+0.1758466769654075D-2*t245*t21-0.2301853696D-4*t248*t29
     #+0.1105943786014421D-6*t251*t38-0.193499927909934D-9*t257*t149)
     #-0.3109D-1*t48*t60*(-0.3310670934776461D0*t7*t63
     #+0.4541896448323908D0*t245*t67-0.875935232D0*t248*t71
     #+0.6468936129513876D0*t251*t75-0.1282578179897027D0*t257*t195)
     #+2.D0*t98*(0.1320048426954032D0*t7*t101-0.1022249099550495D-1
     #*t245*t105+0.205189632D-3*t248*t109-0.1886485290644458D-5*t251
     #*t113+0.7099968253911541D-8*t257*t238)
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t3 = t2*rho
      t4 = rho**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigma*t7
      t10 = 1.D0+0.6349604207872798D-2*t8
      t11 = 1/t10
      t14 = sigma**2
      t15 = t4**2
      t16 = t15*rho
      t18 = 1/t2/t16
      t19 = t14*t18
      t20 = t10**2
      t21 = 1/t20
      t24 = t14*sigma
      t25 = t15**2
      t26 = 1/t25
      t27 = t24*t26
      t29 = 1/t20/t10
      t32 = t14**2
      t33 = t25*t4
      t35 = 1/t5/t33
      t36 = t32*t35
      t37 = t20**2
      t38 = 1/t37
      t41 = 0.109163D1-0.4744519508185673D-2*t8*t11
     #+0.2047454356900042D-3*t19*t21-0.105150976D-5*t27*t29
     #+0.1904645565053643D-8*t36*t38
      t44 = 1/rho
      t45 = t44**(1.D0/3.D0)
      t47 = 1.D0+0.1606016560364007D0*t45
      t48 = rho*t47
      t49 = t44**(1.D0/6.D0)
      t52 = dsqrt(t44)
      t54 = t45**2
      t56 = 0.1248219874679732D2*t49+0.4844076716063854D1*t45
     #+0.2326004811900819D1*t52+0.3819082618690966D0*t54
      t59 = 1.D0+0.321646831778707D2/t56
      t60 = dlog(t59)
      t62 = 1.D0+0.3174802103936399D0*t8
      t63 = 1/t62
      t66 = t62**2
      t67 = 1/t66
      t71 = 1/t66/t62
      t74 = t66**2
      t75 = 1/t74
      t78 = 0.489508D0-0.8276677336941153D-1*t8*t63
     #+0.436352992925871D-1*t19*t67-0.6375904D-1*t27*t71
     #+0.2524917573418935D-1*t36*t75
      t79 = t60*t78
      t83 = 1.D0+0.1325688999052018D0*t45
      t89 = 0.598255043577108D1*t49+0.2225569421150687D1*t45
     #+0.8004286349993634D0*t52+0.1897004325747559D0*t54
      t92 = 1.D0+0.160818243221511D2/t89
      t93 = dlog(t92)
      t98 = -0.62182D-1*rho*t83*t93+0.3109D-1*t48*t60
      t100 = 1.D0+0.9524406311809197D-2*t8
      t101 = 1/t100
      t104 = t100**2
      t105 = 1/t104
      t109 = 1/t104/t100
      t112 = t104**2
      t113 = 1/t112
      t116 = 0.51473D0+0.6600242134770161D-1*t8*t101
     #-0.2241305809636867D-2*t19*t105+0.199668672D-4*t27*t109
     #-0.9318124434050518D-7*t36*t113
      zk(i) = -0.7385587663820224D0*t3*t41-0.3109D-1*t48*t79+t98*t116
      t120 = t4*rho
      t122 = 1/t5/t120
      t123 = sigma*t122
      t126 = t15*t4
      t128 = 1/t2/t126
      t129 = t14*t128
      t133 = 1/t25/rho
      t134 = t24*t133
      t139 = 1/t5/t25/t120
      t140 = t32*t139
      t143 = t32*sigma
      t146 = 1/t2/t25/t126
      t147 = t143*t146
      t149 = 1/t37/t10
      t152 = 0.2530410404365692D-1*t123*t11-0.2344622359538767D-2*t129
     #*t21+0.3069138261333333D-4*t134*t29-0.1474591714685894D-6*t140
     #*t38+0.257999903879912D-9*t147*t149
      t155 = t47*t60
      t158 = 1/t54
      t159 = t44*t158
      t162 = t56**2
      t163 = 1/t162
      t164 = t48*t163
      t165 = t49**2
      t166 = t165**2
      t167 = t166*t49
      t168 = 1/t167
      t169 = 1/t4
      t170 = t168*t169
      t172 = t158*t169
      t174 = 1/t52
      t175 = t174*t169
      t177 = 1/t45
      t178 = t177*t169
      t180 = -0.4160732915599108D1*t170-0.3229384477375903D1*t172
     #-0.2326004811900819D1*t175-0.5092110158254621D0*t178
      t181 = 1/t59
      t182 = t180*t181
      t183 = t182*t78
      t195 = 1/t74/t62
      t198 = 0.4414227913035281D0*t123*t63-0.6055861931098544D0*t129
     #*t67+0.1167913642666667D1*t134*t71-0.8625248172685168D0*t140*t75
     #+0.1710104239862703D0*t147*t195
      t199 = t60*t198
      t204 = t172*t93
      t206 = t89**2
      t207 = 1/t206
      t208 = t83*t207
      t213 = -0.99709173929518D0*t170-0.7418564737168958D0*t172
     #-0.4002143174996817D0*t175-0.1264669550498372D0*t178
      t214 = 1/t92
      t216 = t208*t213*t214
      t224 = t163*t180*t181
      t227 = -0.62182D-1*t83*t93+rho*(0.2747799777968419D-2*t204+0.1D1
     #*t216)+0.3109D-1*t155-0.1664368495390566D-2*t159*t60-0.5D0*t48
     #*t224
      t238 = 1/t112/t100
      t241 = -0.1760064569272043D0*t123*t101+0.136299879940066D-1*t129
     #*t105-0.273586176D-3*t134*t109+0.2515313720859277D-5*t140*t113
     #-0.9466624338548721D-8*t147*t238
      vrhoa(i) = -0.9847450218426965D0*t2*t41-0.3692793831910112D0*t3
     #*t152-0.3109D-1*t155*t78+0.1664368495390566D-2*t159*t79+0.5D0
     #*t164*t183-0.15545D-1*t48*t199+t227*t116+t98*t241
      t245 = sigma*t18
      t248 = t14*t26
      t251 = t24*t35
      t256 = 1/t2/t25/t16
      t257 = t32*t256
      t260 = -0.1897807803274269D-1*t7*t11+0.1758466769654075D-2*t245
     #*t21-0.2301853696D-4*t248*t29+0.1105943786014421D-6*t251*t38
     #-0.193499927909934D-9*t257*t149
      t273 = -0.3310670934776461D0*t7*t63+0.4541896448323908D0*t245
     #*t67-0.875935232D0*t248*t71+0.6468936129513876D0*t251*t75
     #-0.1282578179897027D0*t257*t195
      t274 = t60*t273
      t287 = 0.1320048426954032D0*t7*t101-0.1022249099550495D-1*t245
     #*t105+0.205189632D-3*t248*t109-0.1886485290644458D-5*t251*t113
     #+0.7099968253911541D-8*t257*t238
      vsigmaaa(i) = -0.7385587663820224D0*t3*t260-0.3109D-1*t48*t274
     #+2.D0*t98*t287
      t294 = sigma/t5/t15
      t297 = t15*t120
      t300 = t14/t2/t297
      t301 = t300*t105
      t304 = t24/t33
      t305 = t304*t109
      t310 = t32/t5/t25/t15
      t311 = t310*t113
      t316 = t143/t2/t25/t297
      t317 = t316*t238
      t320 = t25**2
      t323 = t32*t14/t320/t4
      t325 = 1/t112/t104
      t327 = 0.1202186354688D-8*t323*t325
      t334 = t47*t163
      t348 = 1/t37/t20
      t361 = 1/t15
      t362 = 1/t167/t44*t361
      t364 = 1/t120
      t365 = t168*t364
      t368 = 1/t54/t44
      t369 = t368*t361
      t371 = t158*t364
      t375 = 1/t52/t44*t361
      t377 = t174*t364
      t381 = 1/t45/t44*t361
      t383 = t177*t364
      t385 = -0.6934554859331846D1*t362+0.1664293166239643D2*t365
     #-0.4305845969834537D1*t369+0.1291753790950361D2*t371
     #-0.2326004811900819D1*t375+0.9304019247603276D1*t377
     #-0.3394740105503081D0*t381+0.2036844063301848D1*t383
      t390 = t364*t368
      t397 = 1/t162/t56
      t399 = t180**2
      t416 = t162**2
      t417 = 1/t416
      t419 = t59**2
      t420 = 1/t419
      t424 = 0.2D1*t216
      t425 = 0.5495599555936838D-2*t204
      t427 = 0.1831866518645613D-2*t369*t93
      t429 = 0.5495599555936838D-2*t371*t93
      t440 = dlog(1.D0+0.2960857464321668D2/(0.8157414703487641D1*t49
     #+0.2247591863577616D1*t45+0.4300972471276643D0*t52
     #+0.1911512595127338D0*t54))
      t442 = (1.D0+0.6901399211255825D-1*t45)*t440*t169
      t447 = t213**2
      t450 = 0.2D1*t83/t206/t89*t447*t214
      t462 = 0.1D1*t208*(-0.8309097827459833D0*t362
     #+0.199418347859036D1*t365-0.4945709824779306D0*t369
     #+0.1483712947433792D1*t371-0.2001071587498409D0*t375
     #+0.8004286349993634D0*t377-0.4215565168327908D-1*t381
     #+0.2529339100996745D0*t383)*t214
      t463 = t206**2
      t466 = t92**2
      t470 = 0.160818243221511D2*t83/t463*t447/t466
      t474 = 0.8837926660346786D-1*t172*t207*t213*t214
      t492 = 1/t74/t66
      s1 = 4.D0*t227*t241+t98*(0.1290714017466165D1*t294*t101
     #-0.140770165298137D0*t301+0.415778512896D-2*t305
     #-0.5941411093198738D-4*t311+0.4259391834712889D-6*t317-t327)
     #+0.3328736990781132D-2*t159*t199-0.6218D-1*t155*t198+0.2D1*t334
     #*t183-0.3692793831910112D0*t3*(-0.1855634296534841D0*t294*t11
     #+0.30555462130222D-1*t300*t21-0.7112440763733333D-3*t304*t29
     #+0.6558764115926639D-5*t310*t38-0.2737055459168051D-7*t316*t149
     #+0.4368526067484444D-10*t323*t348)-0.6564966812284644D0/t5*t41
     #-0.1969490043685393D1*t2*t152+0.5D0*t164*t385*t181*t78
      s2 = s1+0.2219157993854088D-2*t390*t79-0.1070677706909338D0*t159
     #*t163*t183-0.1D1*t48*t397*t399*t181*t78+(-0.2219157993854088D-2
     #*t390*t60+0.1070677706909338D0*t159*t224-0.5D0*t48*t163*t385
     #*t181+0.1D1*t48*t397*t399*t181-0.1608234158893535D2*t48*t417
     #*t399*t420+t424+t425+rho*(t427-t429+0.3377399869956914D-1*t442
     #-t450+t462+t470-t474)-0.2D1*t334*t182)*t116
      v2rhoa2(i) = s2-0.15545D-1*t48*t60*(-0.3237100469559206D1*t294
     #*t63+0.8418187782887979D1*t300*t67-0.2307323630933333D2*t304*t71
     #+0.2605821057352538D2*t310*t75-0.107441027773375D2*t316*t195
     #+0.1447798010311111D1*t323*t492)+0.1608234158893535D2*t48*t417
     #*t399*t420*t78+0.1D1*t164*t182*t198+(t425+t424+rho*(t427-t429
     #-0.3377399869956914D-1*t442-t450+t462+t470-t474))*t116+t98*(
     #-0.4081692000875529D-1*t301+0.215148650496D-2*t305
     #-0.4096847697901935D-4*t311+0.356517271655265D-6*t317-t327)
      t522 = sigma*t128
      t525 = t14*t133
      t528 = t24*t139
      t531 = t32*t146
      t536 = t143/t320/rho
      t569 = t522*t105
      t571 = t525*t109
      t573 = t528*t113
      t575 = t531*t238
      t578 = 0.901639766016D-9*t536*t325
      s1 = -0.9847450218426965D0*t2*t260-0.3692793831910112D0*t3*
     #(0.1012164161746277D0*t122*t11-0.1939966305835835D-1*t522*t21
     #+0.48739598336D-3*t525*t29-0.4697884329742095D-5*t528*t38
     #+0.2014091608794051D-7*t531*t149-0.3276394550613333D-10*t536
     #*t348)-0.3109D-1*t155*t273+0.1664368495390566D-2*t159*t274
      v2rhoasigmaaa(i) = s1+0.5D0*t164*t182*t273-0.15545D-1*t48*t60*
     #(0.1765691165214113D1*t122*t63-0.5405261547501203D1*t522*t67
     #+0.15553056768D2*t525*t71-0.1824987070424126D2*t528*t75
     #+0.7801561447023719D1*t531*t195-0.1085848507733333D1*t536*t492)
     #+2.D0*t227*t287+t98*(-0.7040258277088172D0*t122*t101
     #+0.8513264198259285D-1*t569-0.270795958272D-2*t571
     #+0.4078761261770162D-4*t573-0.3052544510956436D-6*t575+t578)+t98
     #*(0.3061269000656647D-1*t569-0.161361487872D-2*t571
     #+0.3072635773426451D-4*t573-0.2673879537414487D-6*t575+t578)
      t589 = sigma*t26
      t592 = t14*t35
      t595 = t24*t256
      t599 = t32/t320
      v2sigmaaa2(i) = -0.7385587663820224D0*t3*(0.7515880215152465D-2
     #*t18*t21-0.27347283968D-3*t589*t29+0.3081035732900803D-5*t592
     #*t38-0.1433168735431565D-7*t595*t149+0.245729591296D-10*t599
     #*t348)-0.3109D-1*t48*t60*(0.2237187581296339D1*t18*t67
     #-0.8161051648D1*t589*t71+0.1109982857637539D2*t592*t75
     #-0.5338139813308978D1*t595*t195+0.8143863808D0*t599*t492)+4.D0
     #*t98*(-0.2295951750492485D-1*t18*t105+0.121021115904D-2*t589
     #*t109-0.2304476830069838D-4*t592*t113+0.2005409653060866D-6*t595
     #*t238-0.676229824512D-9*t599*t325)
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end

c:XC_HCTH120subrend
_ENDIF
_IF(ccpdft,all,xc_hcth147)
c:XC_HCTH147subrstart

c    Generated: Sat May  8 19:27:08 GMT 2004

      subroutine uks_xc_hcth147
     & (ideriv,npt,rhoa1,rhob1,sigmaaa1,sigmabb1,sigmaab1,
     &  zk,vrhoa,vrhob,vsigmaaa,vsigmabb,vsigmaab,
     &  v2rhoa2,v2rhob2,v2rhoab,
     &  v2rhoasigmaaa,v2rhoasigmaab,v2rhoasigmabb,
     &  v2rhobsigmabb,v2rhobsigmaab,v2rhobsigmaaa,
     &  v2sigmaaa2,v2sigmaaaab,v2sigmaaabb,
     &  v2sigmaab2,v2sigmaabbb,v2sigmabb2)
c
c     A.D. Boese, N.L. Doltsinis, N.C. Handy, M. Sprik
c     New generalized gradient approximation functionals
c     J. Chem. Phys. 112 (2000) 1670-1678.
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt),rhob1(npt)
      REAL sigmaaa1(npt),sigmabb1(npt),sigmaab1(npt)
      REAL zk(npt),vrhoa(npt),vrhob(npt)
      REAL vsigmaaa(npt),vsigmabb(npt),vsigmaab(npt)
      REAL v2rhoa2(npt),v2rhob2(npt),v2rhoab(npt)
      REAL v2rhoasigmaaa(npt),v2rhoasigmaab(npt)
      REAL v2rhoasigmabb(npt),v2rhobsigmabb(npt)
      REAL v2rhobsigmaab(npt),v2rhobsigmaaa(npt)
      REAL v2sigmaaa2(npt),v2sigmaaaab(npt),v2sigmaaabb(npt)
      REAL v2sigmaab2(npt),v2sigmaabbb(npt),v2sigmabb2(npt)
      parameter(tol=1.0d-20)
      
      if (ideriv.eq.0) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t4 = rhob**2
      t5 = t2**2
      t8 = sigmabb/t5/t4
      t10 = 1.D0+0.4D-2*t8
      t14 = sigmabb**2
      t15 = t4**2
      t19 = t14/t2/t15/rhob
      t20 = t10**2
      t25 = t15**2
      t27 = t14*sigmabb/t25
      t32 = t14**2
      t36 = t32/t5/t25/t4
      t37 = t20**2
      t44 = 1/rhob
      t45 = t44**(1.D0/3.D0)
      t49 = t44**(1.D0/6.D0)
      t52 = dsqrt(t44)
      t54 = t45**2
      t60 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t49
     #+0.3844746237447211D1*t45+0.1644733775567609D1*t52
     #+0.2405871291288192D0*t54))
      t62 = 1.D0+0.2D0*t8
      t66 = t62**2
      t74 = t66**2
      zk(i) = -0.9305257363491D0*t2*rhob*(0.109025D1-0.3196776D-2*t8
     #/t10+0.8915392D-4*t19/t20-0.3755264D-6*t27/t20/t10+0.77963264D-9
     #*t36/t37)-0.3109D-1*rhob*(1.D0+0.1274696188700087D0*t45)*t60*
     #(0.562576D0+0.342872D-2*t8/t62-0.522544D-1*t19/t66+0.845976D-2
     #*t27/t66/t62+0.14166864D-2*t36/t74)
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t4 = rhoa**2
      t5 = t2**2
      t8 = sigmaaa/t5/t4
      t10 = 1.D0+0.4D-2*t8
      t14 = sigmaaa**2
      t15 = t4**2
      t19 = t14/t2/t15/rhoa
      t20 = t10**2
      t25 = t15**2
      t27 = t14*sigmaaa/t25
      t32 = t14**2
      t36 = t32/t5/t25/t4
      t37 = t20**2
      t44 = 1/rhoa
      t45 = t44**(1.D0/3.D0)
      t49 = t44**(1.D0/6.D0)
      t52 = dsqrt(t44)
      t54 = t45**2
      t60 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t49
     #+0.3844746237447211D1*t45+0.1644733775567609D1*t52
     #+0.2405871291288192D0*t54))
      t62 = 1.D0+0.2D0*t8
      t66 = t62**2
      t74 = t66**2
      zk(i) = -0.9305257363491D0*t2*rhoa*(0.109025D1-0.3196776D-2*t8
     #/t10+0.8915392D-4*t19/t20-0.3755264D-6*t27/t20/t10+0.77963264D-9
     #*t36/t37)-0.3109D-1*rhoa*(1.D0+0.1274696188700087D0*t45)*t60*
     #(0.562576D0+0.342872D-2*t8/t62-0.522544D-1*t19/t66+0.845976D-2
     #*t27/t66/t62+0.14166864D-2*t36/t74)
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t6 = rhoa**2
      t7 = t4**2
      t10 = sigmaaa/t7/t6
      t12 = 1.D0+0.4D-2*t10
      t16 = sigmaaa**2
      t17 = t6**2
      t21 = t16/t4/t17/rhoa
      t22 = t12**2
      t27 = t17**2
      t29 = t16*sigmaaa/t27
      t34 = t16**2
      t38 = t34/t7/t27/t6
      t39 = t22**2
      t46 = 1/rhoa
      t47 = t46**(1.D0/3.D0)
      t50 = rhoa*(1.D0+0.1274696188700087D0*t47)
      t51 = t46**(1.D0/6.D0)
      t54 = dsqrt(t46)
      t56 = t47**2
      t62 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t51
     #+0.3844746237447211D1*t47+0.1644733775567609D1*t54
     #+0.2405871291288192D0*t56))
      t64 = 1.D0+0.2D0*t10
      t68 = t64**2
      t76 = t68**2
      t84 = rhob**(1.D0/3.D0)
      t86 = rhob**2
      t87 = t84**2
      t90 = sigmabb/t87/t86
      t92 = 1.D0+0.4D-2*t90
      t96 = sigmabb**2
      t97 = t86**2
      t101 = t96/t84/t97/rhob
      t102 = t92**2
      t107 = t97**2
      t109 = t96*sigmabb/t107
      t114 = t96**2
      t118 = t114/t87/t107/t86
      t119 = t102**2
      t126 = 1/rhob
      t127 = t126**(1.D0/3.D0)
      t130 = rhob*(1.D0+0.1274696188700087D0*t127)
      t131 = t126**(1.D0/6.D0)
      t134 = dsqrt(t126)
      t136 = t127**2
      t142 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t131
     #+0.3844746237447211D1*t127+0.1644733775567609D1*t134
     #+0.2405871291288192D0*t136))
      t144 = 1.D0+0.2D0*t90
      t148 = t144**2
      t156 = t148**2
      t164 = rhoa+rhob
      t165 = 1/t164
      t166 = t165**(1.D0/3.D0)
      t169 = t165**(1.D0/6.D0)
      t172 = dsqrt(t165)
      t174 = t166**2
      t180 = dlog(1.D0+0.160818243221511D2/(0.598255043577108D1*t169
     #+0.2225569421150687D1*t166+0.8004286349993634D0*t172
     #+0.1897004325747559D0*t174))
      t182 = 0.62182D-1*(1.D0+0.1325688999052018D0*t166)*t180
      t193 = dlog(1.D0+0.2960857464321668D2/(0.8157414703487641D1*t169
     #+0.2247591863577616D1*t166+0.4300972471276643D0*t172
     #+0.1911512595127338D0*t174))
      t196 = rhoa-1.D0*rhob
      t197 = t196*t165
      t198 = 1.D0+t197
      t199 = t198**(1.D0/3.D0)
      t202 = 1.D0-1.D0*t197
      t203 = t202**(1.D0/3.D0)
      t205 = t199*t198+t203*t202-2.D0
      t206 = t196**2
      t207 = t206**2
      t208 = t164**2
      t209 = t208**2
      t211 = t207/t209
      t227 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t169
     #+0.3844746237447211D1*t166+0.1644733775567609D1*t172
     #+0.2405871291288192D0*t174))
      t243 = 0.5D0*t10+0.5D0*t90
      t246 = 1.D0+0.3D-2*t10+0.3D-2*t90
      t250 = t243**2
      t251 = t246**2
      t260 = t250**2
      t261 = t251**2
      s1 = -0.9305257363491D0*t4*rhoa*(0.109025D1-0.3196776D-2*t10/t12
     #+0.8915392D-4*t21/t22-0.3755264D-6*t29/t22/t12+0.77963264D-9*t38
     #/t39)-0.3109D-1*t50*t62*(0.562576D0+0.342872D-2*t10/t64
     #-0.522544D-1*t21/t68+0.845976D-2*t29/t68/t64+0.14166864D-2*t38
     #/t76)
      s2 = s1-0.9305257363491D0*t84*rhob*(0.109025D1-0.3196776D-2*t90
     #/t92+0.8915392D-4*t101/t102-0.3755264D-6*t109/t102/t92
     #+0.77963264D-9*t118/t119)
      zk(i) = s2-0.3109D-1*t130*t142*(0.562576D0+0.342872D-2*t90/t144
     #-0.522544D-1*t101/t148+0.845976D-2*t109/t148/t144+0.14166864D-2
     #*t118/t156)+(t164*(-t182+0.3799574853701528D-1*(1.D0
     #+0.6901399211255825D-1*t166)*t193*t205*(1.D0-1.D0*t211)
     #+0.1923661050931536D1*(-0.3109D-1*(1.D0+0.1274696188700087D0
     #*t166)*t227+t182)*t205*t211)+0.3109D-1*t50*t62+0.3109D-1*t130
     #*t142)*(0.542352D0+0.4208784D-1*t243/t246-0.10217592D-2*t250
     #/t251+0.75671064D-5*t250*t243/t251/t246-0.264752064D-7*t260/t261)
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t3 = t2*rhob
      t4 = rhob**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigmabb*t7
      t10 = 1.D0+0.4D-2*t8
      t11 = 1/t10
      t14 = sigmabb**2
      t15 = t4**2
      t16 = t15*rhob
      t18 = 1/t2/t16
      t19 = t14*t18
      t20 = t10**2
      t21 = 1/t20
      t24 = t14*sigmabb
      t25 = t15**2
      t26 = 1/t25
      t27 = t24*t26
      t29 = 1/t20/t10
      t32 = t14**2
      t35 = 1/t5/t25/t4
      t36 = t32*t35
      t37 = t20**2
      t38 = 1/t37
      t41 = 0.109025D1-0.3196776D-2*t8*t11+0.8915392D-4*t19*t21
     #-0.3755264D-6*t27*t29+0.77963264D-9*t36*t38
      t44 = 1/rhob
      t45 = t44**(1.D0/3.D0)
      t47 = 1.D0+0.1274696188700087D0*t45
      t48 = rhob*t47
      t49 = t44**(1.D0/6.D0)
      t52 = dsqrt(t44)
      t54 = t45**2
      t56 = 0.1112037486309468D2*t49+0.3844746237447211D1*t45
     #+0.1644733775567609D1*t52+0.2405871291288192D0*t54
      t59 = 1.D0+0.321646831778707D2/t56
      t60 = dlog(t59)
      t62 = 1.D0+0.2D0*t8
      t63 = 1/t62
      t66 = t62**2
      t67 = 1/t66
      t71 = 1/t66/t62
      t74 = t66**2
      t75 = 1/t74
      t78 = 0.562576D0+0.342872D-2*t8*t63-0.522544D-1*t19*t67
     #+0.845976D-2*t27*t71+0.14166864D-2*t36*t75
      t79 = t60*t78
      zk(i) = -0.9305257363491D0*t3*t41-0.3109D-1*t48*t79
      vrhoa(i) = 0.D0
      t84 = t4*rhob
      t87 = sigmabb/t5/t84
      t90 = t15*t4
      t93 = t14/t2/t90
      t98 = t24/t25/rhob
      t104 = t32/t5/t25/t84
      t111 = t32*sigmabb/t2/t25/t90
      t113 = 1/t37/t10
      t122 = 1/t54
      t126 = t56**2
      t129 = t49**2
      t130 = t129**2
      t133 = 1/t4
      t159 = 1/t74/t62
      vrhob(i) = -0.12407009817988D1*t2*t41-0.9305257363491D0*t3*
     #(0.8524736D-2*t87*t11-0.5095865173333333D-3*t93*t21
     #+0.4906161493333333D-5*t98*t29-0.2033292629333333D-7*t104*t38
     #+0.3326432597333333D-10*t111*t113)-0.3109D-1*t47*t60*t78
     #+0.1321010150222857D-2*t44*t122*t79+0.1D1*t48/t126*(
     #-0.1853395810515781D1/t130/t49*t133-0.128158207914907D1*t122
     #*t133-0.8223668877838045D0/t52*t133-0.1603914194192128D0/t45
     #*t133)/t59*t78-0.3109D-1*t48*t60*(-0.9143253333333333D-2*t87*t63
     #+0.280518784D0*t93*t67-0.1234161066666667D0*t98*t71
     #-0.15757056D-2*t104*t75+0.302226432D-2*t111*t159)
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      t168 = sigmabb*t18
      t171 = t14*t26
      t174 = t24*t35
      t180 = t32/t2/t25/t16
      vsigmabb(i) = -0.9305257363491D0*t3*(-0.3196776D-2*t7*t11
     #+0.191094944D-3*t168*t21-0.183981056D-5*t171*t29+0.762484736D-8
     #*t174*t38-0.1247412224D-10*t180*t113)-0.3109D-1*t48*t60*
     #(0.342872D-2*t7*t63-0.105194544D0*t168*t67+0.4628104D-1*t171*t71
     #+0.5908896D-3*t174*t75-0.113334912D-2*t180*t159)
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t3 = t2*rhoa
      t4 = rhoa**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigmaaa*t7
      t10 = 1.D0+0.4D-2*t8
      t11 = 1/t10
      t14 = sigmaaa**2
      t15 = t4**2
      t16 = t15*rhoa
      t18 = 1/t2/t16
      t19 = t14*t18
      t20 = t10**2
      t21 = 1/t20
      t24 = t14*sigmaaa
      t25 = t15**2
      t26 = 1/t25
      t27 = t24*t26
      t29 = 1/t20/t10
      t32 = t14**2
      t35 = 1/t5/t25/t4
      t36 = t32*t35
      t37 = t20**2
      t38 = 1/t37
      t41 = 0.109025D1-0.3196776D-2*t8*t11+0.8915392D-4*t19*t21
     #-0.3755264D-6*t27*t29+0.77963264D-9*t36*t38
      t44 = 1/rhoa
      t45 = t44**(1.D0/3.D0)
      t47 = 1.D0+0.1274696188700087D0*t45
      t48 = rhoa*t47
      t49 = t44**(1.D0/6.D0)
      t52 = dsqrt(t44)
      t54 = t45**2
      t56 = 0.1112037486309468D2*t49+0.3844746237447211D1*t45
     #+0.1644733775567609D1*t52+0.2405871291288192D0*t54
      t59 = 1.D0+0.321646831778707D2/t56
      t60 = dlog(t59)
      t62 = 1.D0+0.2D0*t8
      t63 = 1/t62
      t66 = t62**2
      t67 = 1/t66
      t71 = 1/t66/t62
      t74 = t66**2
      t75 = 1/t74
      t78 = 0.562576D0+0.342872D-2*t8*t63-0.522544D-1*t19*t67
     #+0.845976D-2*t27*t71+0.14166864D-2*t36*t75
      t79 = t60*t78
      zk(i) = -0.9305257363491D0*t3*t41-0.3109D-1*t48*t79
      t84 = t4*rhoa
      t87 = sigmaaa/t5/t84
      t90 = t15*t4
      t93 = t14/t2/t90
      t98 = t24/t25/rhoa
      t104 = t32/t5/t25/t84
      t111 = t32*sigmaaa/t2/t25/t90
      t113 = 1/t37/t10
      t122 = 1/t54
      t126 = t56**2
      t129 = t49**2
      t130 = t129**2
      t133 = 1/t4
      t159 = 1/t74/t62
      vrhoa(i) = -0.12407009817988D1*t2*t41-0.9305257363491D0*t3*
     #(0.8524736D-2*t87*t11-0.5095865173333333D-3*t93*t21
     #+0.4906161493333333D-5*t98*t29-0.2033292629333333D-7*t104*t38
     #+0.3326432597333333D-10*t111*t113)-0.3109D-1*t47*t60*t78
     #+0.1321010150222857D-2*t44*t122*t79+0.1D1*t48/t126*(
     #-0.1853395810515781D1/t130/t49*t133-0.128158207914907D1*t122
     #*t133-0.8223668877838045D0/t52*t133-0.1603914194192128D0/t45
     #*t133)/t59*t78-0.3109D-1*t48*t60*(-0.9143253333333333D-2*t87*t63
     #+0.280518784D0*t93*t67-0.1234161066666667D0*t98*t71
     #-0.15757056D-2*t104*t75+0.302226432D-2*t111*t159)
      vrhob(i) = 0.D0
      t168 = sigmaaa*t18
      t171 = t14*t26
      t174 = t24*t35
      t180 = t32/t2/t25/t16
      vsigmaaa(i) = -0.9305257363491D0*t3*(-0.3196776D-2*t7*t11
     #+0.191094944D-3*t168*t21-0.183981056D-5*t171*t29+0.762484736D-8
     #*t174*t38-0.1247412224D-10*t180*t113)-0.3109D-1*t48*t60*
     #(0.342872D-2*t7*t63-0.105194544D0*t168*t67+0.4628104D-1*t171*t71
     #+0.5908896D-3*t174*t75-0.113334912D-2*t180*t159)
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t5 = t4*rhoa
      t6 = rhoa**2
      t7 = t4**2
      t9 = 1/t7/t6
      t10 = sigmaaa*t9
      t12 = 1.D0+0.4D-2*t10
      t13 = 1/t12
      t16 = sigmaaa**2
      t17 = t6**2
      t18 = t17*rhoa
      t20 = 1/t4/t18
      t21 = t16*t20
      t22 = t12**2
      t23 = 1/t22
      t26 = t16*sigmaaa
      t27 = t17**2
      t28 = 1/t27
      t29 = t26*t28
      t31 = 1/t22/t12
      t34 = t16**2
      t37 = 1/t7/t27/t6
      t38 = t34*t37
      t39 = t22**2
      t40 = 1/t39
      t43 = 0.109025D1-0.3196776D-2*t10*t13+0.8915392D-4*t21*t23
     #-0.3755264D-6*t29*t31+0.77963264D-9*t38*t40
      t46 = 1/rhoa
      t47 = t46**(1.D0/3.D0)
      t49 = 1.D0+0.1274696188700087D0*t47
      t50 = rhoa*t49
      t51 = t46**(1.D0/6.D0)
      t54 = dsqrt(t46)
      t56 = t47**2
      t58 = 0.1112037486309468D2*t51+0.3844746237447211D1*t47
     #+0.1644733775567609D1*t54+0.2405871291288192D0*t56
      t61 = 1.D0+0.321646831778707D2/t58
      t62 = dlog(t61)
      t64 = 1.D0+0.2D0*t10
      t65 = 1/t64
      t68 = t64**2
      t69 = 1/t68
      t73 = 1/t68/t64
      t76 = t68**2
      t77 = 1/t76
      t80 = 0.562576D0+0.342872D-2*t10*t65-0.522544D-1*t21*t69
     #+0.845976D-2*t29*t73+0.14166864D-2*t38*t77
      t81 = t62*t80
      t84 = rhob**(1.D0/3.D0)
      t85 = t84*rhob
      t86 = rhob**2
      t87 = t84**2
      t89 = 1/t87/t86
      t90 = sigmabb*t89
      t92 = 1.D0+0.4D-2*t90
      t93 = 1/t92
      t96 = sigmabb**2
      t97 = t86**2
      t98 = t97*rhob
      t100 = 1/t84/t98
      t101 = t96*t100
      t102 = t92**2
      t103 = 1/t102
      t106 = t96*sigmabb
      t107 = t97**2
      t108 = 1/t107
      t109 = t106*t108
      t111 = 1/t102/t92
      t114 = t96**2
      t117 = 1/t87/t107/t86
      t118 = t114*t117
      t119 = t102**2
      t120 = 1/t119
      t123 = 0.109025D1-0.3196776D-2*t90*t93+0.8915392D-4*t101*t103
     #-0.3755264D-6*t109*t111+0.77963264D-9*t118*t120
      t126 = 1/rhob
      t127 = t126**(1.D0/3.D0)
      t129 = 1.D0+0.1274696188700087D0*t127
      t130 = rhob*t129
      t131 = t126**(1.D0/6.D0)
      t134 = dsqrt(t126)
      t136 = t127**2
      t138 = 0.1112037486309468D2*t131+0.3844746237447211D1*t127
     #+0.1644733775567609D1*t134+0.2405871291288192D0*t136
      t141 = 1.D0+0.321646831778707D2/t138
      t142 = dlog(t141)
      t144 = 1.D0+0.2D0*t90
      t145 = 1/t144
      t148 = t144**2
      t149 = 1/t148
      t153 = 1/t148/t144
      t156 = t148**2
      t157 = 1/t156
      t160 = 0.562576D0+0.342872D-2*t90*t145-0.522544D-1*t101*t149
     #+0.845976D-2*t109*t153+0.14166864D-2*t118*t157
      t161 = t142*t160
      t164 = rhoa+rhob
      t165 = 1/t164
      t166 = t165**(1.D0/3.D0)
      t168 = 1.D0+0.1325688999052018D0*t166
      t169 = t165**(1.D0/6.D0)
      t172 = dsqrt(t165)
      t174 = t166**2
      t176 = 0.598255043577108D1*t169+0.2225569421150687D1*t166
     #+0.8004286349993634D0*t172+0.1897004325747559D0*t174
      t179 = 1.D0+0.160818243221511D2/t176
      t180 = dlog(t179)
      t182 = 0.62182D-1*t168*t180
      t184 = 1.D0+0.6901399211255825D-1*t166
      t189 = 0.8157414703487641D1*t169+0.2247591863577616D1*t166
     #+0.4300972471276643D0*t172+0.1911512595127338D0*t174
      t192 = 1.D0+0.2960857464321668D2/t189
      t193 = dlog(t192)
      t194 = t184*t193
      t196 = rhoa-1.D0*rhob
      t197 = t196*t165
      t198 = 1.D0+t197
      t199 = t198**(1.D0/3.D0)
      t202 = 1.D0-1.D0*t197
      t203 = t202**(1.D0/3.D0)
      t205 = t199*t198+t203*t202-2.D0
      t206 = t196**2
      t207 = t206**2
      t208 = t164**2
      t209 = t208**2
      t210 = 1/t209
      t211 = t207*t210
      t213 = 1.D0-1.D0*t211
      t216 = 0.3799574853701528D-1*t194*t205*t213
      t218 = 1.D0+0.1274696188700087D0*t166
      t223 = 0.1112037486309468D2*t169+0.3844746237447211D1*t166
     #+0.1644733775567609D1*t172+0.2405871291288192D0*t174
      t226 = 1.D0+0.321646831778707D2/t223
      t227 = dlog(t226)
      t230 = -0.3109D-1*t218*t227+t182
      t231 = t230*t205
      t233 = 0.1923661050931536D1*t231*t211
      t240 = t164*(-t182+t216+t233)+0.3109D-1*t50*t62+0.3109D-1*t130
     #*t142
      t243 = 0.5D0*t10+0.5D0*t90
      t246 = 1.D0+0.3D-2*t10+0.3D-2*t90
      t247 = 1/t246
      t250 = t243**2
      t251 = t246**2
      t252 = 1/t251
      t255 = t250*t243
      t257 = 1/t251/t246
      t260 = t250**2
      t261 = t251**2
      t262 = 1/t261
      t265 = 0.542352D0+0.4208784D-1*t243*t247-0.10217592D-2*t250*t252
     #+0.75671064D-5*t255*t257-0.264752064D-7*t260*t262
      zk(i) = -0.9305257363491D0*t5*t43-0.3109D-1*t50*t81
     #-0.9305257363491D0*t85*t123-0.3109D-1*t130*t161+t240*t265
      t269 = t6*rhoa
      t272 = sigmaaa/t7/t269
      t275 = t17*t6
      t278 = t16/t4/t275
      t283 = t26/t27/rhoa
      t289 = t34/t7/t27/t269
      t296 = t34*sigmaaa/t4/t27/t275
      t298 = 1/t39/t12
      t304 = t49*t62
      t307 = 1/t56
      t308 = t46*t307
      t311 = t58**2
      t312 = 1/t311
      t314 = t51**2
      t315 = t314**2
      t318 = 1/t6
      t329 = -0.1853395810515781D1/t315/t51*t318-0.128158207914907D1
     #*t307*t318-0.8223668877838045D0/t54*t318-0.1603914194192128D0
     #/t47*t318
      t330 = 1/t61
      t344 = 1/t76/t64
      t352 = 1/t208
      t353 = 1/t174*t352
      t354 = t353*t180
      t355 = 0.2747799777968419D-2*t354
      t356 = t176**2
      t359 = t169**2
      t360 = t359**2
      t363 = 1/t360/t169*t352
      t367 = 1/t172*t352
      t370 = 1/t166*t352
      t375 = t168/t356*(-0.99709173929518D0*t363-0.7418564737168958D0
     #*t353-0.4002143174996817D0*t367-0.1264669550498372D0*t370)/t179
      t376 = 0.1D1*t375
      t380 = 0.8740794299481065D-3*t353*t193*t205*t213
      t381 = t189**2
      t394 = 0.1124999956683108D1*t184/t381*(-0.135956911724794D1*t363
     #-0.7491972878592054D0*t353-0.2150486235638321D0*t367
     #-0.1274341730084892D0*t370)/t192*t205*t213
      t395 = t196*t352
      t396 = 1.D0*t395
      t400 = 1.D0*t165
      t404 = 0.1333333333333333D1*t199*(t165-t396)
     #+0.1333333333333333D1*t203*(-t400+t395)
      t409 = t206*t196*t210
      t410 = 4.D0*t409
      t413 = t207/t209/t164
      t414 = 4.D0*t413
      t421 = t223**2
      t438 = 0.1923661050931536D1*(0.1321010150222857D-2*t353*t227
     #+0.1D1*t218/t421*(-0.1853395810515781D1*t363-0.128158207914907D1
     #*t353-0.8223668877838045D0*t367-0.1603914194192128D0*t370)/t226
     #-0.2747799777968419D-2*t354-0.1D1*t375)*t205*t211
      t442 = t231*t409
      t445 = 0.7694644203726145D1*t231*t413
      t459 = t243*t252
      t462 = t250*t257
      t465 = t255*t262
      t470 = t260/t261/t246
      s1 = -0.12407009817988D1*t4*t43-0.9305257363491D0*t5*
     #(0.8524736D-2*t272*t13-0.5095865173333333D-3*t278*t23
     #+0.4906161493333333D-5*t283*t31-0.2033292629333333D-7*t289*t40
     #+0.3326432597333333D-10*t296*t298)-0.3109D-1*t304*t80
     #+0.1321010150222857D-2*t308*t81
      vrhoa(i) = s1+0.1D1*t50*t312*t329*t330*t80-0.3109D-1*t50*t62*(
     #-0.9143253333333333D-2*t272*t65+0.280518784D0*t278*t69
     #-0.1234161066666667D0*t283*t73-0.15757056D-2*t289*t77
     #+0.302226432D-2*t296*t344)+(-t182+t216+t233+t164*(t355+t376-t380
     #-t394+0.3799574853701528D-1*t194*t404*t213+0.3799574853701528D-1
     #*t194*t205*(-t410+t414)+t438+0.1923661050931536D1*t230*t404*t211
     #+0.7694644203726145D1*t442-t445)+0.3109D-1*t304
     #-0.1321010150222857D-2*t308*t62-0.1D1*t50*t312*t329*t330)*t265
     #+t240*(-0.5611712D-1*t272*t247+0.306139392D-2*t459*t272
     #-0.466165728D-4*t462*t272+0.3228116544D-6*t465*t272
     #-0.8472066048D-9*t470*t272)
      t477 = t86*rhob
      t480 = sigmabb/t87/t477
      t483 = t97*t86
      t486 = t96/t84/t483
      t491 = t106/t107/rhob
      t497 = t114/t87/t107/t477
      t504 = t114*sigmabb/t84/t107/t483
      t506 = 1/t119/t92
      t512 = t129*t142
      t515 = 1/t136
      t516 = t126*t515
      t519 = t138**2
      t520 = 1/t519
      t522 = t131**2
      t523 = t522**2
      t526 = 1/t86
      t537 = -0.1853395810515781D1/t523/t131*t526-0.128158207914907D1
     #*t515*t526-0.8223668877838045D0/t134*t526-0.1603914194192128D0
     #/t127*t526
      t538 = 1/t141
      t552 = 1/t156/t144
      t565 = 0.1333333333333333D1*t199*(-t400-t396)
     #+0.1333333333333333D1*t203*(t165+t395)
      s1 = -0.12407009817988D1*t84*t123-0.9305257363491D0*t85*
     #(0.8524736D-2*t480*t93-0.5095865173333333D-3*t486*t103
     #+0.4906161493333333D-5*t491*t111-0.2033292629333333D-7*t497*t120
     #+0.3326432597333333D-10*t504*t506)-0.3109D-1*t512*t160
     #+0.1321010150222857D-2*t516*t161
      vrhob(i) = s1+0.1D1*t130*t520*t537*t538*t160-0.3109D-1*t130*t142
     #*(-0.9143253333333333D-2*t480*t145+0.280518784D0*t486*t149
     #-0.1234161066666667D0*t491*t153-0.15757056D-2*t497*t157
     #+0.302226432D-2*t504*t552)+(-t182+t216+t233+t164*(t355+t376-t380
     #-t394+0.3799574853701528D-1*t194*t565*t213+0.3799574853701528D-1
     #*t194*t205*(t410+t414)+t438+0.1923661050931536D1*t230*t565*t211
     #-0.7694644203726145D1*t442-t445)+0.3109D-1*t512
     #-0.1321010150222857D-2*t516*t142-0.1D1*t130*t520*t537*t538)*t265
     #+t240*(-0.5611712D-1*t480*t247+0.306139392D-2*t459*t480
     #-0.466165728D-4*t462*t480+0.3228116544D-6*t465*t480
     #-0.8472066048D-9*t470*t480)
      t602 = sigmaaa*t20
      t605 = t16*t28
      t608 = t26*t37
      t614 = t34/t4/t27/t18
      vsigmaaa(i) = -0.9305257363491D0*t5*(-0.3196776D-2*t9*t13
     #+0.191094944D-3*t602*t23-0.183981056D-5*t605*t31+0.762484736D-8
     #*t608*t40-0.1247412224D-10*t614*t298)-0.3109D-1*t50*t62*
     #(0.342872D-2*t9*t65-0.105194544D0*t602*t69+0.4628104D-1*t605*t73
     #+0.5908896D-3*t608*t77-0.113334912D-2*t614*t344)+t240*
     #(0.2104392D-1*t9*t247-0.114802272D-2*t459*t9+0.174812148D-4*t462
     #*t9-0.1210543704D-6*t465*t9+0.3177024768D-9*t470*t9)
      vsigmaab(i) = 0.D0
      t648 = sigmabb*t100
      t651 = t96*t108
      t654 = t106*t117
      t660 = t114/t84/t107/t98
      vsigmabb(i) = -0.9305257363491D0*t85*(-0.3196776D-2*t89*t93
     #+0.191094944D-3*t648*t103-0.183981056D-5*t651*t111
     #+0.762484736D-8*t654*t120-0.1247412224D-10*t660*t506)-0.3109D-1
     #*t130*t142*(0.342872D-2*t89*t145-0.105194544D0*t648*t149
     #+0.4628104D-1*t651*t153+0.5908896D-3*t654*t157-0.113334912D-2
     #*t660*t552)+t240*(0.2104392D-1*t89*t247-0.114802272D-2*t459*t89
     #+0.174812148D-4*t462*t89-0.1210543704D-6*t465*t89
     #+0.3177024768D-9*t470*t89)
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t3 = t2*rhob
      t4 = rhob**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigmabb*t7
      t10 = 1.D0+0.4D-2*t8
      t11 = 1/t10
      t14 = sigmabb**2
      t15 = t4**2
      t16 = t15*rhob
      t18 = 1/t2/t16
      t19 = t14*t18
      t20 = t10**2
      t21 = 1/t20
      t24 = t14*sigmabb
      t25 = t15**2
      t26 = 1/t25
      t27 = t24*t26
      t29 = 1/t20/t10
      t32 = t14**2
      t33 = t25*t4
      t35 = 1/t5/t33
      t36 = t32*t35
      t37 = t20**2
      t38 = 1/t37
      t41 = 0.109025D1-0.3196776D-2*t8*t11+0.8915392D-4*t19*t21
     #-0.3755264D-6*t27*t29+0.77963264D-9*t36*t38
      t44 = 1/rhob
      t45 = t44**(1.D0/3.D0)
      t47 = 1.D0+0.1274696188700087D0*t45
      t48 = rhob*t47
      t49 = t44**(1.D0/6.D0)
      t52 = dsqrt(t44)
      t54 = t45**2
      t56 = 0.1112037486309468D2*t49+0.3844746237447211D1*t45
     #+0.1644733775567609D1*t52+0.2405871291288192D0*t54
      t59 = 1.D0+0.321646831778707D2/t56
      t60 = dlog(t59)
      t62 = 1.D0+0.2D0*t8
      t63 = 1/t62
      t66 = t62**2
      t67 = 1/t66
      t71 = 1/t66/t62
      t74 = t66**2
      t75 = 1/t74
      t78 = 0.562576D0+0.342872D-2*t8*t63-0.522544D-1*t19*t67
     #+0.845976D-2*t27*t71+0.14166864D-2*t36*t75
      t79 = t60*t78
      zk(i) = -0.9305257363491D0*t3*t41-0.3109D-1*t48*t79
      vrhoa(i) = 0.D0
      t84 = t4*rhob
      t87 = sigmabb/t5/t84
      t90 = t15*t4
      t93 = t14/t2/t90
      t98 = t24/t25/rhob
      t104 = t32/t5/t25/t84
      t107 = t32*sigmabb
      t111 = t107/t2/t25/t90
      t113 = 1/t37/t10
      t116 = 0.8524736D-2*t87*t11-0.5095865173333333D-3*t93*t21
     #+0.4906161493333333D-5*t98*t29-0.2033292629333333D-7*t104*t38
     #+0.3326432597333333D-10*t111*t113
      t119 = t47*t60
      t122 = 1/t54
      t123 = t44*t122
      t126 = t56**2
      t127 = 1/t126
      t128 = t48*t127
      t129 = t49**2
      t130 = t129**2
      t131 = t130*t49
      t132 = 1/t131
      t133 = 1/t4
      t138 = 1/t52
      t141 = 1/t45
      t144 = -0.1853395810515781D1*t132*t133-0.128158207914907D1*t122
     #*t133-0.8223668877838045D0*t138*t133-0.1603914194192128D0*t141
     #*t133
      t145 = 1/t59
      t146 = t144*t145
      t147 = t146*t78
      t159 = 1/t74/t62
      t162 = -0.9143253333333333D-2*t87*t63+0.280518784D0*t93*t67
     #-0.1234161066666667D0*t98*t71-0.15757056D-2*t104*t75
     #+0.302226432D-2*t111*t159
      t163 = t60*t162
      vrhob(i) = -0.12407009817988D1*t2*t41-0.9305257363491D0*t3*t116
     #-0.3109D-1*t119*t78+0.1321010150222857D-2*t123*t79+0.1D1*t128
     #*t147-0.3109D-1*t48*t163
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      t168 = sigmabb*t18
      t171 = t14*t26
      t174 = t24*t35
      t179 = 1/t2/t25/t16
      t180 = t32*t179
      vsigmabb(i) = -0.9305257363491D0*t3*(-0.3196776D-2*t7*t11
     #+0.191094944D-3*t168*t21-0.183981056D-5*t171*t29+0.762484736D-8
     #*t174*t38-0.1247412224D-10*t180*t113)-0.3109D-1*t48*t60*
     #(0.342872D-2*t7*t63-0.105194544D0*t168*t67+0.4628104D-1*t171*t71
     #+0.5908896D-3*t174*t75-0.113334912D-2*t180*t159)
      v2rhoa2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t207 = sigmabb/t5/t15
      t210 = t15*t84
      t213 = t14/t2/t210
      t217 = t24/t33
      t223 = t32/t5/t25/t15
      t229 = t107/t2/t25/t210
      t233 = t25**2
      t236 = t32*t14/t233/t4
      t238 = 1/t37/t20
      t249 = 1/t84
      t251 = 1/t54/t44
      t263 = t144**2
      t270 = 1/t15
      t296 = t126**2
      t299 = t59**2
      t319 = 1/t74/t66
      s1 = -0.4135669939329333D0/t5*t41-0.24814019635976D1*t2*t116
     #-0.9305257363491D0*t3*(-0.3125736533333333D-1*t207*t11
     #+0.3318311793777778D-2*t213*t21-0.5502663247644444D-4*t217*t29
     #+0.3942146412088889D-6*t223*t38-0.13443268608D-8*t229*t113
     #+0.1774097385244444D-11*t236*t238)+0.2D1*t47*t127*t147-0.6218D-1
     #*t119*t162+0.8806734334819047D-3*t249*t251*t79
      v2rhob2(i) = s1-0.8497974591333914D-1*t123*t127*t147
     #+0.2642020300445714D-2*t123*t163-0.2D1*t48/t126/t56*t263*t145
     #*t78+0.1D1*t128*(-0.1544496508763151D1/t131/t44*t270
     #+0.3706791621031562D1*t132*t249-0.854388052766047D0*t251*t270
     #+0.2563164158298141D1*t122*t249-0.4111834438919023D0/t52/t44
     #*t270+0.1644733775567609D1*t138*t249-0.5346380647307093D-1/t45
     #/t44*t270+0.3207828388384256D0*t141*t249)*t145*t78
     #+0.321646831778707D2*t48/t296*t263/t299*t78+0.2D1*t128*t146*t162
     #-0.3109D-1*t48*t60*(0.3352526222222222D-1*t207*t63
     #-0.1781495367111111D1*t213*t67+0.1409964996266667D1*t217*t71
     #-0.1790825386666667D0*t223*t75-0.466806272D-1*t229*t159
     #+0.805937152D-2*t236*t319)
      v2sigmaaa2(i) = 0.D0
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      t328 = sigmabb*t26
      t331 = t14*t35
      t334 = t24*t179
      t338 = t32/t233
      v2sigmabb2(i) = -0.9305257363491D0*t3*(0.203882048D-3*t18*t21
     #-0.5208380672D-5*t328*t29+0.449522688D-7*t331*t38
     #-0.17189404672D-9*t334*t113+0.2494824448D-12*t338*t238)
     #-0.3109D-1*t48*t60*(-0.105880288D0*t18*t67+0.1346398976D0*t328
     #*t71-0.259959552D-1*t331*t75-0.500610816D-2*t334*t159
     #+0.113334912D-2*t338*t319)
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t3 = t2*rhoa
      t4 = rhoa**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigmaaa*t7
      t10 = 1.D0+0.4D-2*t8
      t11 = 1/t10
      t14 = sigmaaa**2
      t15 = t4**2
      t16 = t15*rhoa
      t18 = 1/t2/t16
      t19 = t14*t18
      t20 = t10**2
      t21 = 1/t20
      t24 = t14*sigmaaa
      t25 = t15**2
      t26 = 1/t25
      t27 = t24*t26
      t29 = 1/t20/t10
      t32 = t14**2
      t33 = t25*t4
      t35 = 1/t5/t33
      t36 = t32*t35
      t37 = t20**2
      t38 = 1/t37
      t41 = 0.109025D1-0.3196776D-2*t8*t11+0.8915392D-4*t19*t21
     #-0.3755264D-6*t27*t29+0.77963264D-9*t36*t38
      t44 = 1/rhoa
      t45 = t44**(1.D0/3.D0)
      t47 = 1.D0+0.1274696188700087D0*t45
      t48 = rhoa*t47
      t49 = t44**(1.D0/6.D0)
      t52 = dsqrt(t44)
      t54 = t45**2
      t56 = 0.1112037486309468D2*t49+0.3844746237447211D1*t45
     #+0.1644733775567609D1*t52+0.2405871291288192D0*t54
      t59 = 1.D0+0.321646831778707D2/t56
      t60 = dlog(t59)
      t62 = 1.D0+0.2D0*t8
      t63 = 1/t62
      t66 = t62**2
      t67 = 1/t66
      t71 = 1/t66/t62
      t74 = t66**2
      t75 = 1/t74
      t78 = 0.562576D0+0.342872D-2*t8*t63-0.522544D-1*t19*t67
     #+0.845976D-2*t27*t71+0.14166864D-2*t36*t75
      t79 = t60*t78
      zk(i) = -0.9305257363491D0*t3*t41-0.3109D-1*t48*t79
      t84 = t4*rhoa
      t87 = sigmaaa/t5/t84
      t90 = t15*t4
      t93 = t14/t2/t90
      t98 = t24/t25/rhoa
      t104 = t32/t5/t25/t84
      t107 = t32*sigmaaa
      t111 = t107/t2/t25/t90
      t113 = 1/t37/t10
      t116 = 0.8524736D-2*t87*t11-0.5095865173333333D-3*t93*t21
     #+0.4906161493333333D-5*t98*t29-0.2033292629333333D-7*t104*t38
     #+0.3326432597333333D-10*t111*t113
      t119 = t47*t60
      t122 = 1/t54
      t123 = t44*t122
      t126 = t56**2
      t127 = 1/t126
      t128 = t48*t127
      t129 = t49**2
      t130 = t129**2
      t131 = t130*t49
      t132 = 1/t131
      t133 = 1/t4
      t138 = 1/t52
      t141 = 1/t45
      t144 = -0.1853395810515781D1*t132*t133-0.128158207914907D1*t122
     #*t133-0.8223668877838045D0*t138*t133-0.1603914194192128D0*t141
     #*t133
      t145 = 1/t59
      t146 = t144*t145
      t147 = t146*t78
      t159 = 1/t74/t62
      t162 = -0.9143253333333333D-2*t87*t63+0.280518784D0*t93*t67
     #-0.1234161066666667D0*t98*t71-0.15757056D-2*t104*t75
     #+0.302226432D-2*t111*t159
      t163 = t60*t162
      vrhoa(i) = -0.12407009817988D1*t2*t41-0.9305257363491D0*t3*t116
     #-0.3109D-1*t119*t78+0.1321010150222857D-2*t123*t79+0.1D1*t128
     #*t147-0.3109D-1*t48*t163
      vrhob(i) = 0.D0
      t168 = sigmaaa*t18
      t171 = t14*t26
      t174 = t24*t35
      t179 = 1/t2/t25/t16
      t180 = t32*t179
      vsigmaaa(i) = -0.9305257363491D0*t3*(-0.3196776D-2*t7*t11
     #+0.191094944D-3*t168*t21-0.183981056D-5*t171*t29+0.762484736D-8
     #*t174*t38-0.1247412224D-10*t180*t113)-0.3109D-1*t48*t60*
     #(0.342872D-2*t7*t63-0.105194544D0*t168*t67+0.4628104D-1*t171*t71
     #+0.5908896D-3*t174*t75-0.113334912D-2*t180*t159)
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      t207 = sigmaaa/t5/t15
      t210 = t15*t84
      t213 = t14/t2/t210
      t217 = t24/t33
      t223 = t32/t5/t25/t15
      t229 = t107/t2/t25/t210
      t233 = t25**2
      t236 = t32*t14/t233/t4
      t238 = 1/t37/t20
      t249 = 1/t84
      t251 = 1/t54/t44
      t263 = t144**2
      t270 = 1/t15
      t296 = t126**2
      t299 = t59**2
      t319 = 1/t74/t66
      s1 = -0.4135669939329333D0/t5*t41-0.24814019635976D1*t2*t116
     #-0.9305257363491D0*t3*(-0.3125736533333333D-1*t207*t11
     #+0.3318311793777778D-2*t213*t21-0.5502663247644444D-4*t217*t29
     #+0.3942146412088889D-6*t223*t38-0.13443268608D-8*t229*t113
     #+0.1774097385244444D-11*t236*t238)+0.2D1*t47*t127*t147-0.6218D-1
     #*t119*t162+0.8806734334819047D-3*t249*t251*t79
      v2rhoa2(i) = s1-0.8497974591333914D-1*t123*t127*t147
     #+0.2642020300445714D-2*t123*t163-0.2D1*t48/t126/t56*t263*t145
     #*t78+0.1D1*t128*(-0.1544496508763151D1/t131/t44*t270
     #+0.3706791621031562D1*t132*t249-0.854388052766047D0*t251*t270
     #+0.2563164158298141D1*t122*t249-0.4111834438919023D0/t52/t44
     #*t270+0.1644733775567609D1*t138*t249-0.5346380647307093D-1/t45
     #/t44*t270+0.3207828388384256D0*t141*t249)*t145*t78
     #+0.321646831778707D2*t48/t296*t263/t299*t78+0.2D1*t128*t146*t162
     #-0.3109D-1*t48*t60*(0.3352526222222222D-1*t207*t63
     #-0.1781495367111111D1*t213*t67+0.1409964996266667D1*t217*t71
     #-0.1790825386666667D0*t223*t75-0.466806272D-1*t229*t159
     #+0.805937152D-2*t236*t319)
      v2rhob2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t328 = sigmaaa*t26
      t331 = t14*t35
      t334 = t24*t179
      t338 = t32/t233
      v2sigmaaa2(i) = -0.9305257363491D0*t3*(0.203882048D-3*t18*t21
     #-0.5208380672D-5*t328*t29+0.449522688D-7*t331*t38
     #-0.17189404672D-9*t334*t113+0.2494824448D-12*t338*t238)
     #-0.3109D-1*t48*t60*(-0.105880288D0*t18*t67+0.1346398976D0*t328
     #*t71-0.259959552D-1*t331*t75-0.500610816D-2*t334*t159
     #+0.113334912D-2*t338*t319)
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      v2sigmabb2(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t5 = t4*rhoa
      t6 = rhoa**2
      t7 = t4**2
      t9 = 1/t7/t6
      t10 = sigmaaa*t9
      t12 = 1.D0+0.4D-2*t10
      t13 = 1/t12
      t16 = sigmaaa**2
      t17 = t6**2
      t18 = t17*rhoa
      t20 = 1/t4/t18
      t21 = t16*t20
      t22 = t12**2
      t23 = 1/t22
      t26 = t16*sigmaaa
      t27 = t17**2
      t28 = 1/t27
      t29 = t26*t28
      t31 = 1/t22/t12
      t34 = t16**2
      t35 = t27*t6
      t37 = 1/t7/t35
      t38 = t34*t37
      t39 = t22**2
      t40 = 1/t39
      t43 = 0.109025D1-0.3196776D-2*t10*t13+0.8915392D-4*t21*t23
     #-0.3755264D-6*t29*t31+0.77963264D-9*t38*t40
      t46 = 1/rhoa
      t47 = t46**(1.D0/3.D0)
      t49 = 1.D0+0.1274696188700087D0*t47
      t50 = rhoa*t49
      t51 = t46**(1.D0/6.D0)
      t54 = dsqrt(t46)
      t56 = t47**2
      t58 = 0.1112037486309468D2*t51+0.3844746237447211D1*t47
     #+0.1644733775567609D1*t54+0.2405871291288192D0*t56
      t61 = 1.D0+0.321646831778707D2/t58
      t62 = dlog(t61)
      t64 = 1.D0+0.2D0*t10
      t65 = 1/t64
      t68 = t64**2
      t69 = 1/t68
      t73 = 1/t68/t64
      t76 = t68**2
      t77 = 1/t76
      t80 = 0.562576D0+0.342872D-2*t10*t65-0.522544D-1*t21*t69
     #+0.845976D-2*t29*t73+0.14166864D-2*t38*t77
      t81 = t62*t80
      t84 = rhob**(1.D0/3.D0)
      t85 = t84*rhob
      t86 = rhob**2
      t87 = t84**2
      t89 = 1/t87/t86
      t90 = sigmabb*t89
      t92 = 1.D0+0.4D-2*t90
      t93 = 1/t92
      t96 = sigmabb**2
      t97 = t86**2
      t98 = t97*rhob
      t100 = 1/t84/t98
      t101 = t96*t100
      t102 = t92**2
      t103 = 1/t102
      t106 = t96*sigmabb
      t107 = t97**2
      t108 = 1/t107
      t109 = t106*t108
      t111 = 1/t102/t92
      t114 = t96**2
      t115 = t107*t86
      t117 = 1/t87/t115
      t118 = t114*t117
      t119 = t102**2
      t120 = 1/t119
      t123 = 0.109025D1-0.3196776D-2*t90*t93+0.8915392D-4*t101*t103
     #-0.3755264D-6*t109*t111+0.77963264D-9*t118*t120
      t126 = 1/rhob
      t127 = t126**(1.D0/3.D0)
      t129 = 1.D0+0.1274696188700087D0*t127
      t130 = rhob*t129
      t131 = t126**(1.D0/6.D0)
      t134 = dsqrt(t126)
      t136 = t127**2
      t138 = 0.1112037486309468D2*t131+0.3844746237447211D1*t127
     #+0.1644733775567609D1*t134+0.2405871291288192D0*t136
      t141 = 1.D0+0.321646831778707D2/t138
      t142 = dlog(t141)
      t144 = 1.D0+0.2D0*t90
      t145 = 1/t144
      t148 = t144**2
      t149 = 1/t148
      t153 = 1/t148/t144
      t156 = t148**2
      t157 = 1/t156
      t160 = 0.562576D0+0.342872D-2*t90*t145-0.522544D-1*t101*t149
     #+0.845976D-2*t109*t153+0.14166864D-2*t118*t157
      t161 = t142*t160
      t164 = rhoa+rhob
      t165 = 1/t164
      t166 = t165**(1.D0/3.D0)
      t168 = 1.D0+0.1325688999052018D0*t166
      t169 = t165**(1.D0/6.D0)
      t172 = dsqrt(t165)
      t174 = t166**2
      t176 = 0.598255043577108D1*t169+0.2225569421150687D1*t166
     #+0.8004286349993634D0*t172+0.1897004325747559D0*t174
      t179 = 1.D0+0.160818243221511D2/t176
      t180 = dlog(t179)
      t182 = 0.62182D-1*t168*t180
      t184 = 1.D0+0.6901399211255825D-1*t166
      t189 = 0.8157414703487641D1*t169+0.2247591863577616D1*t166
     #+0.4300972471276643D0*t172+0.1911512595127338D0*t174
      t192 = 1.D0+0.2960857464321668D2/t189
      t193 = dlog(t192)
      t194 = t184*t193
      t196 = rhoa-1.D0*rhob
      t197 = t196*t165
      t198 = 1.D0+t197
      t199 = t198**(1.D0/3.D0)
      t202 = 1.D0-1.D0*t197
      t203 = t202**(1.D0/3.D0)
      t205 = t199*t198+t203*t202-2.D0
      t206 = t196**2
      t207 = t206**2
      t208 = t164**2
      t209 = t208**2
      t210 = 1/t209
      t211 = t207*t210
      t213 = 1.D0-1.D0*t211
      t214 = t205*t213
      t216 = 0.3799574853701528D-1*t194*t214
      t218 = 1.D0+0.1274696188700087D0*t166
      t223 = 0.1112037486309468D2*t169+0.3844746237447211D1*t166
     #+0.1644733775567609D1*t172+0.2405871291288192D0*t174
      t226 = 1.D0+0.321646831778707D2/t223
      t227 = dlog(t226)
      t230 = -0.3109D-1*t218*t227+t182
      t231 = t230*t205
      t233 = 0.1923661050931536D1*t231*t211
      t240 = t164*(-t182+t216+t233)+0.3109D-1*t50*t62+0.3109D-1*t130
     #*t142
      t243 = 0.5D0*t10+0.5D0*t90
      t246 = 1.D0+0.3D-2*t10+0.3D-2*t90
      t247 = 1/t246
      t250 = t243**2
      t251 = t246**2
      t252 = 1/t251
      t255 = t250*t243
      t257 = 1/t251/t246
      t260 = t250**2
      t261 = t251**2
      t262 = 1/t261
      t265 = 0.542352D0+0.4208784D-1*t243*t247-0.10217592D-2*t250*t252
     #+0.75671064D-5*t255*t257-0.264752064D-7*t260*t262
      zk(i) = -0.9305257363491D0*t5*t43-0.3109D-1*t50*t81
     #-0.9305257363491D0*t85*t123-0.3109D-1*t130*t161+t240*t265
      t269 = t6*rhoa
      t271 = 1/t7/t269
      t272 = sigmaaa*t271
      t275 = t17*t6
      t277 = 1/t4/t275
      t278 = t16*t277
      t282 = 1/t27/rhoa
      t283 = t26*t282
      t288 = 1/t7/t27/t269
      t289 = t34*t288
      t292 = t34*sigmaaa
      t295 = 1/t4/t27/t275
      t296 = t292*t295
      t298 = 1/t39/t12
      t301 = 0.8524736D-2*t272*t13-0.5095865173333333D-3*t278*t23
     #+0.4906161493333333D-5*t283*t31-0.2033292629333333D-7*t289*t40
     #+0.3326432597333333D-10*t296*t298
      t304 = t49*t62
      t307 = 1/t56
      t308 = t46*t307
      t311 = t58**2
      t312 = 1/t311
      t313 = t50*t312
      t314 = t51**2
      t315 = t314**2
      t316 = t315*t51
      t317 = 1/t316
      t318 = 1/t6
      t323 = 1/t54
      t326 = 1/t47
      t329 = -0.1853395810515781D1*t317*t318-0.128158207914907D1*t307
     #*t318-0.8223668877838045D0*t323*t318-0.1603914194192128D0*t326
     #*t318
      t330 = 1/t61
      t331 = t329*t330
      t332 = t331*t80
      t344 = 1/t76/t64
      t347 = -0.9143253333333333D-2*t272*t65+0.280518784D0*t278*t69
     #-0.1234161066666667D0*t283*t73-0.15757056D-2*t289*t77
     #+0.302226432D-2*t296*t344
      t348 = t62*t347
      t351 = 1/t174
      t352 = 1/t208
      t353 = t351*t352
      t354 = t353*t180
      t355 = 0.2747799777968419D-2*t354
      t356 = t176**2
      t357 = 1/t356
      t358 = t168*t357
      t359 = t169**2
      t360 = t359**2
      t361 = t360*t169
      t362 = 1/t361
      t363 = t362*t352
      t366 = 1/t172
      t367 = t366*t352
      t369 = 1/t166
      t370 = t369*t352
      t372 = -0.99709173929518D0*t363-0.7418564737168958D0*t353
     #-0.4002143174996817D0*t367-0.1264669550498372D0*t370
      t373 = 1/t179
      t375 = t358*t372*t373
      t376 = 0.1D1*t375
      t377 = t193*t205
      t378 = t377*t213
      t379 = t353*t378
      t380 = 0.8740794299481065D-3*t379
      t381 = t189**2
      t382 = 1/t381
      t383 = t184*t382
      t388 = -0.135956911724794D1*t363-0.7491972878592054D0*t353
     #-0.2150486235638321D0*t367-0.1274341730084892D0*t370
      t389 = t383*t388
      t390 = 1/t192
      t391 = t390*t205
      t392 = t391*t213
      t393 = t389*t392
      t394 = 0.1124999956683108D1*t393
      t395 = t196*t352
      t396 = 1.D0*t395
      t397 = t165-t396
      t400 = 1.D0*t165
      t401 = -t400+t395
      t404 = 0.1333333333333333D1*t199*t397+0.1333333333333333D1*t203
     #*t401
      t406 = t194*t404*t213
      t407 = 0.3799574853701528D-1*t406
      t408 = t206*t196
      t409 = t408*t210
      t410 = 4.D0*t409
      t412 = 1/t209/t164
      t413 = t207*t412
      t414 = 4.D0*t413
      t415 = -t410+t414
      t417 = t194*t205*t415
      t418 = 0.3799574853701528D-1*t417
      t421 = t223**2
      t422 = 1/t421
      t423 = t218*t422
      t428 = -0.1853395810515781D1*t363-0.128158207914907D1*t353
     #-0.8223668877838045D0*t367-0.1603914194192128D0*t370
      t429 = 1/t226
      t435 = 0.1321010150222857D-2*t353*t227+0.1D1*t423*t428*t429
     #-0.2747799777968419D-2*t354-0.1D1*t375
      t436 = t435*t205
      t437 = t436*t211
      t438 = 0.1923661050931536D1*t437
      t439 = t230*t404
      t440 = t439*t211
      t441 = 0.1923661050931536D1*t440
      t442 = t231*t409
      t444 = t231*t413
      t445 = 0.7694644203726145D1*t444
      t452 = t312*t329*t330
      t455 = -t182+t216+t233+t164*(t355+t376-t380-t394+t407+t418+t438
     #+t441+0.7694644203726145D1*t442-t445)+0.3109D-1*t304
     #-0.1321010150222857D-2*t308*t62-0.1D1*t50*t452
      t459 = t243*t252
      t462 = t250*t257
      t465 = t255*t262
      t469 = 1/t261/t246
      t470 = t260*t469
      t473 = -0.5611712D-1*t272*t247+0.306139392D-2*t459*t272
     #-0.466165728D-4*t462*t272+0.3228116544D-6*t465*t272
     #-0.8472066048D-9*t470*t272
      vrhoa(i) = -0.12407009817988D1*t4*t43-0.9305257363491D0*t5*t301
     #-0.3109D-1*t304*t80+0.1321010150222857D-2*t308*t81+0.1D1*t313
     #*t332-0.3109D-1*t50*t348+t455*t265+t240*t473
      t477 = t86*rhob
      t479 = 1/t87/t477
      t480 = sigmabb*t479
      t483 = t97*t86
      t485 = 1/t84/t483
      t486 = t96*t485
      t490 = 1/t107/rhob
      t491 = t106*t490
      t496 = 1/t87/t107/t477
      t497 = t114*t496
      t500 = t114*sigmabb
      t503 = 1/t84/t107/t483
      t504 = t500*t503
      t506 = 1/t119/t92
      t509 = 0.8524736D-2*t480*t93-0.5095865173333333D-3*t486*t103
     #+0.4906161493333333D-5*t491*t111-0.2033292629333333D-7*t497*t120
     #+0.3326432597333333D-10*t504*t506
      t512 = t129*t142
      t515 = 1/t136
      t516 = t126*t515
      t519 = t138**2
      t520 = 1/t519
      t521 = t130*t520
      t522 = t131**2
      t523 = t522**2
      t524 = t523*t131
      t525 = 1/t524
      t526 = 1/t86
      t531 = 1/t134
      t534 = 1/t127
      t537 = -0.1853395810515781D1*t525*t526-0.128158207914907D1*t515
     #*t526-0.8223668877838045D0*t531*t526-0.1603914194192128D0*t534
     #*t526
      t538 = 1/t141
      t539 = t537*t538
      t540 = t539*t160
      t552 = 1/t156/t144
      t555 = -0.9143253333333333D-2*t480*t145+0.280518784D0*t486*t149
     #-0.1234161066666667D0*t491*t153-0.15757056D-2*t497*t157
     #+0.302226432D-2*t504*t552
      t556 = t142*t555
      t559 = -t400-t396
      t562 = t165+t395
      t565 = 0.1333333333333333D1*t199*t559+0.1333333333333333D1*t203
     #*t562
      t567 = t194*t565*t213
      t568 = 0.3799574853701528D-1*t567
      t569 = t410+t414
      t571 = t194*t205*t569
      t572 = 0.3799574853701528D-1*t571
      t573 = t230*t565
      t574 = t573*t211
      t575 = 0.1923661050931536D1*t574
      t583 = t520*t537*t538
      t586 = -t182+t216+t233+t164*(t355+t376-t380-t394+t568+t572+t438
     #+t575-0.7694644203726145D1*t442-t445)+0.3109D-1*t512
     #-0.1321010150222857D-2*t516*t142-0.1D1*t130*t583
      t598 = -0.5611712D-1*t480*t247+0.306139392D-2*t459*t480
     #-0.466165728D-4*t462*t480+0.3228116544D-6*t465*t480
     #-0.8472066048D-9*t470*t480
      vrhob(i) = -0.12407009817988D1*t84*t123-0.9305257363491D0*t85
     #*t509-0.3109D-1*t512*t160+0.1321010150222857D-2*t516*t161+0.1D1
     #*t521*t540-0.3109D-1*t130*t556+t586*t265+t240*t598
      t602 = sigmaaa*t20
      t605 = t16*t28
      t608 = t26*t37
      t613 = 1/t4/t27/t18
      t614 = t34*t613
      t617 = -0.3196776D-2*t9*t13+0.191094944D-3*t602*t23
     #-0.183981056D-5*t605*t31+0.762484736D-8*t608*t40
     #-0.1247412224D-10*t614*t298
      t630 = 0.342872D-2*t9*t65-0.105194544D0*t602*t69+0.4628104D-1
     #*t605*t73+0.5908896D-3*t608*t77-0.113334912D-2*t614*t344
      t631 = t62*t630
      t644 = 0.2104392D-1*t9*t247-0.114802272D-2*t459*t9
     #+0.174812148D-4*t462*t9-0.1210543704D-6*t465*t9+0.3177024768D-9
     #*t470*t9
      vsigmaaa(i) = -0.9305257363491D0*t5*t617-0.3109D-1*t50*t631+t240
     #*t644
      vsigmaab(i) = 0.D0
      t648 = sigmabb*t100
      t651 = t96*t108
      t654 = t106*t117
      t659 = 1/t84/t107/t98
      t660 = t114*t659
      t663 = -0.3196776D-2*t89*t93+0.191094944D-3*t648*t103
     #-0.183981056D-5*t651*t111+0.762484736D-8*t654*t120
     #-0.1247412224D-10*t660*t506
      t676 = 0.342872D-2*t89*t145-0.105194544D0*t648*t149+0.4628104D-1
     #*t651*t153+0.5908896D-3*t654*t157-0.113334912D-2*t660*t552
      t677 = t142*t676
      t690 = 0.2104392D-1*t89*t247-0.114802272D-2*t459*t89
     #+0.174812148D-4*t462*t89-0.1210543704D-6*t465*t89
     #+0.3177024768D-9*t470*t89
      vsigmabb(i) = -0.9305257363491D0*t85*t663-0.3109D-1*t130*t677
     #+t240*t690
      t696 = sigmaaa/t7/t17
      t699 = t17*t269
      t702 = t16/t4/t699
      t705 = t243*t257
      t710 = t250*t262
      t715 = t255*t469
      t722 = t260/t261/t251
      t739 = t26/t35
      t745 = t34/t7/t27/t17
      t751 = t292/t4/t27/t699
      t755 = t27**2
      t758 = t34*t16/t755/t6
      t760 = 1/t39/t22
      t768 = t49*t312
      t771 = 1/t269
      t773 = 1/t56/t46
      t774 = t771*t773
      t780 = 1/t311/t58
      t782 = t329**2
      t792 = 1/t17
      t813 = -0.1544496508763151D1/t316/t46*t792+0.3706791621031562D1
     #*t317*t771-0.854388052766047D0*t773*t792+0.2563164158298141D1
     #*t307*t771-0.4111834438919023D0/t54/t46*t792
     #+0.1644733775567609D1*t323*t771-0.5346380647307093D-1/t47/t46
     #*t792+0.3207828388384256D0*t326*t771
      t821 = t311**2
      t822 = 1/t821
      t824 = t61**2
      t825 = 1/t824
      t841 = 1/t76/t68
      t848 = 0.2D1*t375
      t850 = 0.5495599555936838D-2*t354
      t852 = 0.1748158859896213D-2*t379
      t853 = 0.2249999913366216D1*t393
      t854 = 0.3847322101863073D1*t437
      t875 = 0.1538928840745229D2*t444
      t877 = 0.1538928840745229D2*t436*t413
      t880 = t207/t209/t208
      t882 = 0.3847322101863073D2*t231*t880
      t885 = 1/t174/t165*t210
      t889 = 1/t208/t164
      t890 = t351*t889
      t900 = t428**2
      t906 = 1/t361/t165*t210
      t908 = t362*t889
      t914 = 1/t172/t165*t210
      t916 = t366*t889
      t920 = 1/t166/t165*t210
      t922 = t369*t889
      t928 = t421**2
      t931 = t226**2
      t936 = t885*t180
      t938 = t890*t180
      t942 = t353*t357*t372*t373
      t947 = t372**2
      t949 = t168/t356/t176*t947*t373
      t961 = t358*(-0.8309097827459833D0*t906+0.199418347859036D1*t908
     #-0.4945709824779306D0*t885+0.1483712947433792D1*t890
     #-0.2001071587498409D0*t914+0.8004286349993634D0*t916
     #-0.4215565168327908D-1*t920+0.2529339100996745D0*t922)*t373
      t963 = t356**2
      t966 = t179**2
      t969 = t168/t963*t947/t966
      t971 = 0.8806734334819047D-3*t885*t227-0.2642020300445714D-2
     #*t890*t227-0.8497974591333914D-1*t353*t422*t428*t429-0.2D1*t218
     #/t421/t223*t900*t429+0.1D1*t423*(-0.1544496508763151D1*t906
     #+0.3706791621031562D1*t908-0.854388052766047D0*t885
     #+0.2563164158298141D1*t890-0.4111834438919023D0*t914
     #+0.1644733775567609D1*t916-0.5346380647307093D-1*t920
     #+0.3207828388384256D0*t922)*t429+0.321646831778707D2*t218/t928
     #*t900/t931-0.1831866518645613D-2*t936+0.5495599555936838D-2*t938
     #+0.8837926660346786D-1*t942+0.2D1*t949-0.1D1*t961
     #-0.160818243221511D2*t969
      t974 = 0.1923661050931536D1*t971*t205*t211
      t975 = t439*t409
      t977 = 0.1831866518645613D-2*t936
      t979 = t353*t377*t415
      t981 = 0.5495599555936838D-2*t938
      t984 = t353*t193*t404*t213
      t987 = 0.1748158859896213D-2*t890*t378
      t988 = t206*t210
      t989 = t231*t988
      t990 = 0.2308393261117844D2*t989
      t994 = t388**2
      t997 = 0.2249999913366216D1*t184/t381/t189*t994*t392
      t999 = t435*t404*t211
      t1008 = 0.5176049209143758D-1*t353*t382*t388*t390*t214
      t1009 = -t877+t882+t974+0.1538928840745229D2*t975+t977
     #-0.1748158859896213D-2*t979-t981-0.1748158859896213D-2*t984+t987
     #+t990+t997+0.3847322101863073D1*t999+0.7599149707403056D-1*t194
     #*t404*t415+t1008
      t1010 = t408*t412
      t1011 = t231*t1010
      t1014 = 0.5827196199654043D-3*t885*t378
      t1015 = t199**2
      t1016 = 1/t1015
      t1017 = t397**2
      t1020 = 2.D0*t352
      t1022 = 2.D0*t196*t889
      t1023 = -t1020+t1022
      t1026 = t203**2
      t1027 = 1/t1026
      t1028 = t401**2
      t1034 = 0.4444444444444444D0*t1016*t1017+0.1333333333333333D1
     #*t199*t1023+0.4444444444444444D0*t1027*t1028
     #-0.1333333333333333D1*t203*t1023
      t1038 = 12.D0*t988
      t1039 = 32.D0*t1010
      t1040 = 20.D0*t880
      t1048 = t439*t413
      t1050 = 0.2D1*t949
      t1052 = t389*t391*t415
      t1054 = t381**2
      t1058 = t192**2
      t1063 = 0.3330964519106732D2*t184/t1054*t994/t1058*t205*t213
      t1066 = t389*t390*t404*t213
      t1068 = 0.1D1*t961
      t1069 = 0.160818243221511D2*t969
      t1081 = 0.1124999956683108D1*t383*(-0.1132974264373283D1*t906
     #+0.271913823449588D1*t908-0.4994648585728036D0*t885
     #+0.1498394575718411D1*t890-0.1075243117819161D0*t914
     #+0.4300972471276643D0*t916-0.4247805766949639D-1*t920
     #+0.2548683460169784D0*t922)*t392
      t1082 = 0.8837926660346786D-1*t942
      t1083 = t436*t409
      t1085 = -0.6155715362980916D2*t1011-t1014+0.3799574853701528D-1
     #*t194*t1034*t213+0.3799574853701528D-1*t194*t205*(-t1038+t1039
     #-t1040)+0.1923661050931536D1*t230*t1034*t211
     #-0.1538928840745229D2*t1048-t1050-0.2249999913366216D1*t1052
     #-t1063-0.2249999913366216D1*t1066+t1068+t1069-t1081-t1082
     #+0.1538928840745229D2*t1083
      t1088 = t848+0.7599149707403056D-1*t406+t850
     #+0.7599149707403056D-1*t417-t852-t853+t854-0.2D1*t768*t331
     #-0.8806734334819047D-3*t774*t62+0.8497974591333914D-1*t308*t452
     #+0.2D1*t50*t780*t782*t330-0.321646831778707D2*t50*t822*t782*t825
     #-0.1D1*t50*t312*t813*t330+0.3847322101863073D1*t440
     #+0.1538928840745229D2*t442-t875+t164*(t1009+t1085)
      s1 = 2.D0*t455*t473+t240*(0.2057627733333333D0*t696*t247
     #-0.453079552D-2*t702*t252+0.17329316352D-3*t705*t702
     #-0.1122511104D-1*t459*t696-0.24100443648D-5*t710*t702
     #+0.1709274336D-3*t462*t696+0.148484081664D-7*t715*t702
     #-0.11836427328D-5*t465*t696-0.33888264192D-10*t722*t702
     #+0.31064242176D-8*t470*t696)-0.4135669939329333D0/t7*t43
     #-0.24814019635976D1*t4*t301-0.9305257363491D0*t5*(
     #-0.3125736533333333D-1*t696*t13+0.3318311793777778D-2*t702*t23
     #-0.5502663247644444D-4*t739*t31+0.3942146412088889D-6*t745*t40
     #-0.13443268608D-8*t751*t298+0.1774097385244444D-11*t758*t760)
     #-0.6218D-1*t304*t347+0.2D1*t768*t332+0.8806734334819047D-3*t774
     #*t81
      v2rhoa2(i) = s1+0.2642020300445714D-2*t308*t348-0.2D1*t50*t780
     #*t782*t330*t80-0.8497974591333914D-1*t308*t312*t332+0.1D1*t313
     #*t813*t330*t80+0.2D1*t313*t331*t347+0.321646831778707D2*t50*t822
     #*t782*t825*t80-0.3109D-1*t50*t62*(0.3352526222222222D-1*t696*t65
     #-0.1781495367111111D1*t702*t69+0.1409964996266667D1*t739*t73
     #-0.1790825386666667D0*t745*t77-0.466806272D-1*t751*t344
     #+0.805937152D-2*t758*t841)+t1088*t265
      t1095 = t129*t520
      t1100 = sigmabb/t87/t97
      t1103 = t97*t477
      t1106 = t96/t84/t1103
      t1110 = t106/t115
      t1116 = t114/t87/t107/t97
      t1122 = t500/t84/t107/t1103
      t1126 = t107**2
      t1129 = t114*t96/t1126/t86
      t1131 = 1/t119/t102
      t1150 = 1/t156/t148
      t1159 = 1/t97
      t1162 = 1/t477
      t1166 = 1/t136/t126
      t1183 = -0.1544496508763151D1/t524/t126*t1159
     #+0.3706791621031562D1*t525*t1162-0.854388052766047D0*t1166*t1159
     #+0.2563164158298141D1*t515*t1162-0.4111834438919023D0/t134/t126
     #*t1159+0.1644733775567609D1*t531*t1162-0.5346380647307093D-1
     #/t127/t126*t1159+0.3207828388384256D0*t534*t1162
      t1189 = 1/t519/t138
      t1191 = t537**2
      t1196 = t1162*t1166
      t1204 = t519**2
      t1205 = 1/t1204
      t1207 = t141**2
      t1208 = 1/t1207
      t1222 = t353*t377*t569
      t1224 = -t877+t882+t974+t977-t981+t987+t990+t997+t1008
     #+0.6155715362980916D2*t1011-t1014-t1050-t1063
     #-0.1748158859896213D-2*t1222
      t1227 = t353*t193*t565*t213
      t1229 = t559**2
      t1232 = t1020+t1022
      t1235 = t562**2
      t1241 = 0.4444444444444444D0*t1016*t1229+0.1333333333333333D1
     #*t199*t1232+0.4444444444444444D0*t1027*t1235
     #-0.1333333333333333D1*t203*t1232
      t1246 = t435*t565*t211
      t1250 = t389*t390*t565*t213
      t1256 = t389*t391*t569
      t1261 = t573*t413
      t1263 = t573*t409
      t1270 = -0.1748158859896213D-2*t1227+0.3799574853701528D-1*t194
     #*t1241*t213+0.3847322101863073D1*t1246+t1068
     #-0.2249999913366216D1*t1250+0.7599149707403056D-1*t194*t565*t569
     #-0.2249999913366216D1*t1256+t1069-t1081+0.1923661050931536D1
     #*t230*t1241*t211-0.1538928840745229D2*t1261-0.1538928840745229D2
     #*t1263+0.3799574853701528D-1*t194*t205*(-t1038-t1039-t1040)
     #-t1082-0.1538928840745229D2*t1083
      t1291 = t848+t850-t852-t853+t854-0.1538928840745229D2*t442-t875
     #+0.7599149707403056D-1*t571+0.7599149707403056D-1*t567
     #+0.3847322101863073D1*t574+t164*(t1224+t1270)-0.2D1*t1095*t539
     #-0.8806734334819047D-3*t1196*t142+0.8497974591333914D-1*t516
     #*t583+0.2D1*t130*t1189*t1191*t538-0.1D1*t130*t520*t1183*t538
     #-0.321646831778707D2*t130*t1205*t1191*t1208
      s1 = -0.4135669939329333D0/t87*t123-0.24814019635976D1*t84*t509
     #+0.2D1*t1095*t540-0.9305257363491D0*t85*(-0.3125736533333333D-1
     #*t1100*t93+0.3318311793777778D-2*t1106*t103
     #-0.5502663247644444D-4*t1110*t111+0.3942146412088889D-6*t1116
     #*t120-0.13443268608D-8*t1122*t506+0.1774097385244444D-11*t1129
     #*t1131)-0.6218D-1*t512*t555-0.3109D-1*t130*t142*
     #(0.3352526222222222D-1*t1100*t145-0.1781495367111111D1*t1106
     #*t149+0.1409964996266667D1*t1110*t153-0.1790825386666667D0*t1116
     #*t157-0.466806272D-1*t1122*t552+0.805937152D-2*t1129*t1150)
     #+0.1D1*t521*t1183*t538*t160-0.2D1*t130*t1189*t1191*t538*t160
      v2rhob2(i) = s1+0.8806734334819047D-3*t1196*t161
     #-0.8497974591333914D-1*t516*t520*t540+0.2642020300445714D-2*t516
     #*t556+0.321646831778707D2*t130*t1205*t1191*t1208*t160+0.2D1*t521
     #*t539*t555+t1291*t265+2.D0*t586*t598+t240*(0.2057627733333333D0
     #*t1100*t247-0.453079552D-2*t1106*t252+0.17329316352D-3*t705
     #*t1106-0.1122511104D-1*t459*t1100-0.24100443648D-5*t710*t1106
     #+0.1709274336D-3*t462*t1100+0.148484081664D-7*t715*t1106
     #-0.11836427328D-5*t465*t1100-0.33888264192D-10*t722*t1106
     #+0.31064242176D-8*t470*t1100)
      t1329 = 0.4444444444444444D0*t1016*t397*t559
     #+0.2666666666666667D1*t199*t196*t889+0.4444444444444444D0*t1027
     #*t401*t562-0.2666666666666667D1*t203*t196*t889
      t1339 = -t877+0.1923661050931536D1*t230*t1329*t211+t882+t974
     #-0.7694644203726145D1*t975+t977-0.8740794299481065D-3*t979-t981
     #-0.8740794299481065D-3*t984+t987-0.2308393261117844D2*t989+t997
     #+0.1923661050931536D1*t999+t1008-t1014-0.7694644203726145D1
     #*t1048-t1050
      t1362 = -0.1124999956683108D1*t1052-t1063-0.8740794299481065D-3
     #*t1222-0.8740794299481065D-3*t1227-0.1124999956683108D1*t1066
     #+0.1923661050931536D1*t1246+t1068-0.1124999956683108D1*t1250
     #-0.1124999956683108D1*t1256+t1069+0.3799574853701528D-1*t194
     #*t404*t569-t1081-0.7694644203726145D1*t1261+0.7694644203726145D1
     #*t1263-t1082+0.3799574853701528D-1*t194*t565*t415
     #+0.3799574853701528D-1*t194*t1329*t213+0.3799574853701528D-1
     #*t194*t205*(t1038-t1040)
      t1365 = t850+t848-t852-t853+t568+t572+t854+t575-t875+t407+t418
     #+t441+t164*(t1339+t1362)
      t1375 = t271*sigmabb*t479
      v2rhoab(i) = t1365*t265+t455*t598+t586*t473+t240*(
     #-0.453079552D-2*t272*t252*sigmabb*t479+0.17329316352D-3*t705
     #*sigmaaa*t1375-0.24100443648D-5*t710*sigmaaa*t1375
     #+0.148484081664D-7*t715*sigmaaa*t1375-0.33888264192D-10*t722
     #*sigmaaa*t1375)
      t1393 = sigmaaa*t277
      t1396 = t16*t282
      t1399 = t26*t288
      t1402 = t34*t295
      t1407 = t292/t755/rhoa
      s1 = -0.12407009817988D1*t4*t617-0.9305257363491D0*t5*
     #(0.8524736D-2*t271*t13-0.1053271978666667D-2*t1393*t23
     #+0.1879517661866667D-4*t1396*t31-0.1402056430933333D-6*t1399*t40
     #+0.49164845056D-9*t1402*t298-0.6652865194666667D-12*t1407*t760)
     #-0.3109D-1*t304*t630+0.1321010150222857D-2*t308*t631
      v2rhoasigmaaa(i) = s1+0.1D1*t313*t331*t630-0.3109D-1*t50*t62*(
     #-0.9143253333333333D-2*t271*t65+0.5628662186666667D0*t1393*t69
     #-0.4824558336D0*t1396*t73+0.677468416D-1*t1399*t77
     #+0.1637188608D-1*t1402*t344-0.302226432D-2*t1407*t841)+t455*t644
     #+t240*(-0.5611712D-1*t271*t247+0.169904832D-2*t1393*t252
     #-0.6498493632D-4*t705*t1393+0.306139392D-2*t459*t271
     #+0.9037666368D-6*t710*t1393-0.466165728D-4*t462*t271
     #-0.55681530624D-8*t715*t1393+0.3228116544D-6*t465*t271
     #+0.12708099072D-10*t722*t1393-0.8472066048D-9*t470*t271)
      v2rhoasigmaab(i) = 0.D0
      t1463 = t272*t89
      v2rhoasigmabb(i) = t455*t690+t240*(0.169904832D-2*t272*t252*t89
     #-0.6498493632D-4*t705*t1463+0.9037666368D-6*t710*t1463
     #-0.55681530624D-8*t715*t1463+0.12708099072D-10*t722*t1463)
      t1475 = t252*t9
      t1478 = t480*t9
      v2rhobsigmaaa(i) = t586*t644+t240*(0.169904832D-2*t480*t1475
     #-0.6498493632D-4*t705*t1478+0.9037666368D-6*t710*t1478
     #-0.55681530624D-8*t715*t1478+0.12708099072D-10*t722*t1478)
      v2rhobsigmaab(i) = 0.D0
      t1493 = sigmabb*t485
      t1496 = t96*t490
      t1499 = t106*t496
      t1502 = t114*t503
      t1507 = t500/t1126/rhob
      s1 = -0.12407009817988D1*t84*t663-0.9305257363491D0*t85*
     #(0.8524736D-2*t479*t93-0.1053271978666667D-2*t1493*t103
     #+0.1879517661866667D-4*t1496*t111-0.1402056430933333D-6*t1499
     #*t120+0.49164845056D-9*t1502*t506-0.6652865194666667D-12*t1507
     #*t1131)-0.3109D-1*t512*t676+0.1321010150222857D-2*t516*t677
      v2rhobsigmabb(i) = s1+0.1D1*t521*t539*t676-0.3109D-1*t130*t142*(
     #-0.9143253333333333D-2*t479*t145+0.5628662186666667D0*t1493*t149
     #-0.4824558336D0*t1496*t153+0.677468416D-1*t1499*t157
     #+0.1637188608D-1*t1502*t552-0.302226432D-2*t1507*t1150)+t586
     #*t690+t240*(-0.5611712D-1*t479*t247+0.169904832D-2*t1493*t252
     #-0.6498493632D-4*t705*t1493+0.306139392D-2*t459*t479
     #+0.9037666368D-6*t710*t1493-0.466165728D-4*t462*t479
     #-0.55681530624D-8*t715*t1493+0.3228116544D-6*t465*t479
     #+0.12708099072D-10*t722*t1493-0.8472066048D-9*t470*t479)
      t1561 = sigmaaa*t28
      t1564 = t16*t37
      t1567 = t26*t613
      t1571 = t34/t755
      v2sigmaaa2(i) = -0.9305257363491D0*t5*(0.203882048D-3*t20*t23
     #-0.5208380672D-5*t1561*t31+0.449522688D-7*t1564*t40
     #-0.17189404672D-9*t1567*t298+0.2494824448D-12*t1571*t760)
     #-0.3109D-1*t50*t62*(-0.105880288D0*t20*t69+0.1346398976D0*t1561
     #*t73-0.259959552D-1*t1564*t77-0.500610816D-2*t1567*t344
     #+0.113334912D-2*t1571*t841)+t240*(-0.63714312D-3*t20*t252
     #+0.2436935112D-4*t705*t20-0.3389124888D-6*t710*t20
     #+0.20880573984D-8*t715*t20-0.4765537152D-11*t722*t20)
      v2sigmaaaab(i) = 0.D0
      t1605 = t9*t89
      v2sigmaaabb(i) = t240*(-0.63714312D-3*t1475*t89+0.2436935112D-4
     #*t705*t1605-0.3389124888D-6*t710*t1605+0.20880573984D-8*t715
     #*t1605-0.4765537152D-11*t722*t1605)
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      t1617 = sigmabb*t108
      t1620 = t96*t117
      t1623 = t106*t659
      t1627 = t114/t1126
      v2sigmabb2(i) = -0.9305257363491D0*t85*(0.203882048D-3*t100*t103
     #-0.5208380672D-5*t1617*t111+0.449522688D-7*t1620*t120
     #-0.17189404672D-9*t1623*t506+0.2494824448D-12*t1627*t1131)
     #-0.3109D-1*t130*t142*(-0.105880288D0*t100*t149+0.1346398976D0
     #*t1617*t153-0.259959552D-1*t1620*t157-0.500610816D-2*t1623*t552
     #+0.113334912D-2*t1627*t1150)+t240*(-0.63714312D-3*t100*t252
     #+0.2436935112D-4*t705*t100-0.3389124888D-6*t710*t100
     #+0.20880573984D-8*t715*t100-0.4765537152D-11*t722*t100)
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      v2rhob2(i) = 0.0d0
      v2rhoab(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2rhoasigmaab(i) = 0.0d0
      v2rhoasigmabb(i) = 0.0d0
      v2rhobsigmaaa(i) = 0.0d0
      v2rhobsigmaab(i) = 0.0d0
      v2rhobsigmabb(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      v2sigmaab2(i) = 0.0d0
      v2sigmabb2(i) = 0.0d0
      v2sigmaaaab(i) = 0.0d0
      v2sigmaaabb(i) = 0.0d0
      v2sigmaabbb(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end
      
      
      subroutine rks_xc_hcth147
     & (ideriv,npt,rhoa1,sigmaaa1,
     &  zk,vrhoa,vsigmaaa,
     &  v2rhoa2,v2rhoasigmaaa,v2sigmaaa2)
c
c     A.D. Boese, N.L. Doltsinis, N.C. Handy, M. Sprik
c     New generalized gradient approximation functionals
c     J. Chem. Phys. 112 (2000) 1670-1678.
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt)
      REAL sigmaaa1(npt)
      REAL zk(npt),vrhoa(npt),vsigmaaa(npt)
      REAL v2rhoa2(npt),v2rhoasigmaaa(npt),v2sigmaaa2(npt)
      parameter(tol=1.0d-20)
      
      if(ideriv.eq.0) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t4 = rho**2
      t5 = t2**2
      t8 = sigma/t5/t4
      t10 = 1.D0+0.6349604207872798D-2*t8
      t14 = sigma**2
      t15 = t4**2
      t19 = t14/t2/t15/rho
      t20 = t10**2
      t25 = t15**2
      t27 = t14*sigma/t25
      t32 = t14**2
      t36 = t32/t5/t25/t4
      t37 = t20**2
      t44 = 1/rho
      t45 = t44**(1.D0/3.D0)
      t48 = rho*(1.D0+0.1606016560364007D0*t45)
      t49 = t44**(1.D0/6.D0)
      t52 = dsqrt(t44)
      t54 = t45**2
      t60 = dlog(1.D0+0.321646831778707D2/(0.1248219874679732D2*t49
     #+0.4844076716063854D1*t45+0.2326004811900819D1*t52
     #+0.3819082618690966D0*t54))
      t62 = 1.D0+0.3174802103936399D0*t8
      t66 = t62**2
      t74 = t66**2
      t93 = dlog(1.D0+0.160818243221511D2/(0.598255043577108D1*t49
     #+0.2225569421150687D1*t45+0.8004286349993634D0*t52
     #+0.1897004325747559D0*t54))
      t100 = 1.D0+0.9524406311809197D-2*t8
      t104 = t100**2
      t112 = t104**2
      zk(i) = -0.7385587663820224D0*t2*rho*(0.109025D1
     #-0.5074565585306693D-2*t8/t10+0.2246538009772871D-3*t19/t20
     #-0.15021056D-5*t27/t20/t10+0.4950358691538978D-8*t36/t37)
     #-0.3109D-1*t48*t60*(0.562576D0+0.5442753734904405D-2*t8/t62
     #-0.1316728370192533D0*t19/t66+0.3383904D-1*t27/t66/t62
     #+0.8995397926676166D-2*t36/t74)+(-0.62182D-1*rho*(1.D0
     #+0.1325688999052018D0*t45)*t93+0.3109D-1*t48*t60)*(0.542352D0
     #+0.6681028149106926D-1*t8/t100-0.2574671848007491D-2*t19/t104
     #+0.302684256D-4*t27/t104/t100-0.1681070819617408D-6*t36/t112)
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t3 = t2*rho
      t4 = rho**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigma*t7
      t10 = 1.D0+0.6349604207872798D-2*t8
      t11 = 1/t10
      t14 = sigma**2
      t15 = t4**2
      t16 = t15*rho
      t18 = 1/t2/t16
      t19 = t14*t18
      t20 = t10**2
      t21 = 1/t20
      t24 = t14*sigma
      t25 = t15**2
      t26 = 1/t25
      t27 = t24*t26
      t29 = 1/t20/t10
      t32 = t14**2
      t35 = 1/t5/t25/t4
      t36 = t32*t35
      t37 = t20**2
      t38 = 1/t37
      t41 = 0.109025D1-0.5074565585306693D-2*t8*t11
     #+0.2246538009772871D-3*t19*t21-0.15021056D-5*t27*t29
     #+0.4950358691538978D-8*t36*t38
      t44 = 1/rho
      t45 = t44**(1.D0/3.D0)
      t47 = 1.D0+0.1606016560364007D0*t45
      t48 = rho*t47
      t49 = t44**(1.D0/6.D0)
      t52 = dsqrt(t44)
      t54 = t45**2
      t56 = 0.1248219874679732D2*t49+0.4844076716063854D1*t45
     #+0.2326004811900819D1*t52+0.3819082618690966D0*t54
      t59 = 1.D0+0.321646831778707D2/t56
      t60 = dlog(t59)
      t62 = 1.D0+0.3174802103936399D0*t8
      t63 = 1/t62
      t66 = t62**2
      t67 = 1/t66
      t71 = 1/t66/t62
      t74 = t66**2
      t75 = 1/t74
      t78 = 0.562576D0+0.5442753734904405D-2*t8*t63
     #-0.1316728370192533D0*t19*t67+0.3383904D-1*t27*t71
     #+0.8995397926676166D-2*t36*t75
      t79 = t60*t78
      t83 = 1.D0+0.1325688999052018D0*t45
      t89 = 0.598255043577108D1*t49+0.2225569421150687D1*t45
     #+0.8004286349993634D0*t52+0.1897004325747559D0*t54
      t92 = 1.D0+0.160818243221511D2/t89
      t93 = dlog(t92)
      t98 = -0.62182D-1*rho*t83*t93+0.3109D-1*t48*t60
      t100 = 1.D0+0.9524406311809197D-2*t8
      t101 = 1/t100
      t104 = t100**2
      t105 = 1/t104
      t109 = 1/t104/t100
      t112 = t104**2
      t113 = 1/t112
      t116 = 0.542352D0+0.6681028149106926D-1*t8*t101
     #-0.2574671848007491D-2*t19*t105+0.302684256D-4*t27*t109
     #-0.1681070819617408D-6*t36*t113
      zk(i) = -0.7385587663820224D0*t3*t41-0.3109D-1*t48*t79+t98*t116
      t120 = t4*rho
      t123 = sigma/t5/t120
      t126 = t15*t4
      t129 = t14/t2/t126
      t134 = t24/t25/rho
      t140 = t32/t5/t25/t120
      t147 = t32*sigma/t2/t25/t126
      t149 = 1/t37/t10
      t155 = t47*t60
      t158 = 1/t54
      t159 = t44*t158
      t162 = t56**2
      t163 = 1/t162
      t165 = t49**2
      t166 = t165**2
      t169 = 1/t4
      t170 = 1/t166/t49*t169
      t172 = t158*t169
      t175 = 1/t52*t169
      t178 = 1/t45*t169
      t180 = -0.4160732915599108D1*t170-0.3229384477375903D1*t172
     #-0.2326004811900819D1*t175-0.5092110158254621D0*t178
      t181 = 1/t59
      t195 = 1/t74/t62
      t206 = t89**2
      t238 = 1/t112/t100
      s1 = -0.9847450218426965D0*t2*t41-0.3692793831910112D0*t3*
     #(0.2706434978830236D-1*t123*t11-0.2568155119723541D-2*t129*t21
     #+0.3924929194666667D-4*t134*t29-0.2582120687010336D-6*t140*t38
     #+0.6705667920698789D-9*t147*t149)-0.3109D-1*t155*t78
     #+0.1664368495390566D-2*t159*t79
      vrhoa(i) = s1+0.5D0*t48*t163*t180*t181*t78-0.15545D-1*t48*t60*(
     #-0.2902801991949016D-1*t123*t63+0.1413726083410053D1*t129*t67
     #-0.9873288533333333D0*t134*t71-0.2001021381625746D-1*t140*t75
     #+0.6092503096182744D-1*t147*t195)+(-0.62182D-1*t83*t93+rho*
     #(0.2747799777968419D-2*t172*t93+0.1D1*t83/t206*(
     #-0.99709173929518D0*t170-0.7418564737168958D0*t172
     #-0.4002143174996817D0*t175-0.1264669550498372D0*t178)/t92)
     #+0.3109D-1*t155-0.1664368495390566D-2*t159*t60-0.5D0*t48*t163
     #*t180*t181)*t116+t98*(-0.1781607506428514D0*t123*t101
     #+0.1542845856731273D-1*t129*t105-0.3729325824D-3*t134*t109
     #+0.4099452478257239D-5*t140*t113-0.1707861495995979D-7*t147*t238)
      t245 = sigma*t18
      t248 = t14*t26
      t251 = t24*t35
      t257 = t32/t2/t25/t16
      vsigmaaa(i) = -0.7385587663820224D0*t3*(-0.2029826234122677D-1
     #*t7*t11+0.1926116339792656D-2*t245*t21-0.2943696896D-4*t248*t29
     #+0.1936590515257752D-6*t251*t38-0.5029250940524092D-9*t257*t149)
     #-0.3109D-1*t48*t60*(0.2177101493961762D-1*t7*t63
     #-0.1060294562557539D1*t245*t67+0.74049664D0*t248*t71
     #+0.150076603621931D-1*t251*t75-0.4569377322137058D-1*t257*t195)
     #+2.D0*t98*(0.1336205629821385D0*t7*t101-0.1157134392548454D-1
     #*t245*t105+0.2796994368D-3*t248*t109-0.3074589358692929D-5*t251
     #*t113+0.1280896121996984D-7*t257*t238)
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t3 = t2*rho
      t4 = rho**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigma*t7
      t10 = 1.D0+0.6349604207872798D-2*t8
      t11 = 1/t10
      t14 = sigma**2
      t15 = t4**2
      t16 = t15*rho
      t18 = 1/t2/t16
      t19 = t14*t18
      t20 = t10**2
      t21 = 1/t20
      t24 = t14*sigma
      t25 = t15**2
      t26 = 1/t25
      t27 = t24*t26
      t29 = 1/t20/t10
      t32 = t14**2
      t33 = t25*t4
      t35 = 1/t5/t33
      t36 = t32*t35
      t37 = t20**2
      t38 = 1/t37
      t41 = 0.109025D1-0.5074565585306693D-2*t8*t11
     #+0.2246538009772871D-3*t19*t21-0.15021056D-5*t27*t29
     #+0.4950358691538978D-8*t36*t38
      t44 = 1/rho
      t45 = t44**(1.D0/3.D0)
      t47 = 1.D0+0.1606016560364007D0*t45
      t48 = rho*t47
      t49 = t44**(1.D0/6.D0)
      t52 = dsqrt(t44)
      t54 = t45**2
      t56 = 0.1248219874679732D2*t49+0.4844076716063854D1*t45
     #+0.2326004811900819D1*t52+0.3819082618690966D0*t54
      t59 = 1.D0+0.321646831778707D2/t56
      t60 = dlog(t59)
      t62 = 1.D0+0.3174802103936399D0*t8
      t63 = 1/t62
      t66 = t62**2
      t67 = 1/t66
      t71 = 1/t66/t62
      t74 = t66**2
      t75 = 1/t74
      t78 = 0.562576D0+0.5442753734904405D-2*t8*t63
     #-0.1316728370192533D0*t19*t67+0.3383904D-1*t27*t71
     #+0.8995397926676166D-2*t36*t75
      t79 = t60*t78
      t83 = 1.D0+0.1325688999052018D0*t45
      t89 = 0.598255043577108D1*t49+0.2225569421150687D1*t45
     #+0.8004286349993634D0*t52+0.1897004325747559D0*t54
      t92 = 1.D0+0.160818243221511D2/t89
      t93 = dlog(t92)
      t98 = -0.62182D-1*rho*t83*t93+0.3109D-1*t48*t60
      t100 = 1.D0+0.9524406311809197D-2*t8
      t101 = 1/t100
      t104 = t100**2
      t105 = 1/t104
      t109 = 1/t104/t100
      t112 = t104**2
      t113 = 1/t112
      t116 = 0.542352D0+0.6681028149106926D-1*t8*t101
     #-0.2574671848007491D-2*t19*t105+0.302684256D-4*t27*t109
     #-0.1681070819617408D-6*t36*t113
      zk(i) = -0.7385587663820224D0*t3*t41-0.3109D-1*t48*t79+t98*t116
      t120 = t4*rho
      t122 = 1/t5/t120
      t123 = sigma*t122
      t126 = t15*t4
      t128 = 1/t2/t126
      t129 = t14*t128
      t133 = 1/t25/rho
      t134 = t24*t133
      t139 = 1/t5/t25/t120
      t140 = t32*t139
      t143 = t32*sigma
      t146 = 1/t2/t25/t126
      t147 = t143*t146
      t149 = 1/t37/t10
      t152 = 0.2706434978830236D-1*t123*t11-0.2568155119723541D-2*t129
     #*t21+0.3924929194666667D-4*t134*t29-0.2582120687010336D-6*t140
     #*t38+0.6705667920698789D-9*t147*t149
      t155 = t47*t60
      t158 = 1/t54
      t159 = t44*t158
      t162 = t56**2
      t163 = 1/t162
      t164 = t48*t163
      t165 = t49**2
      t166 = t165**2
      t167 = t166*t49
      t168 = 1/t167
      t169 = 1/t4
      t170 = t168*t169
      t172 = t158*t169
      t174 = 1/t52
      t175 = t174*t169
      t177 = 1/t45
      t178 = t177*t169
      t180 = -0.4160732915599108D1*t170-0.3229384477375903D1*t172
     #-0.2326004811900819D1*t175-0.5092110158254621D0*t178
      t181 = 1/t59
      t182 = t180*t181
      t183 = t182*t78
      t195 = 1/t74/t62
      t198 = -0.2902801991949016D-1*t123*t63+0.1413726083410053D1*t129
     #*t67-0.9873288533333333D0*t134*t71-0.2001021381625746D-1*t140
     #*t75+0.6092503096182744D-1*t147*t195
      t199 = t60*t198
      t204 = t172*t93
      t206 = t89**2
      t207 = 1/t206
      t208 = t83*t207
      t213 = -0.99709173929518D0*t170-0.7418564737168958D0*t172
     #-0.4002143174996817D0*t175-0.1264669550498372D0*t178
      t214 = 1/t92
      t216 = t208*t213*t214
      t224 = t163*t180*t181
      t227 = -0.62182D-1*t83*t93+rho*(0.2747799777968419D-2*t204+0.1D1
     #*t216)+0.3109D-1*t155-0.1664368495390566D-2*t159*t60-0.5D0*t48
     #*t224
      t238 = 1/t112/t100
      t241 = -0.1781607506428514D0*t123*t101+0.1542845856731273D-1
     #*t129*t105-0.3729325824D-3*t134*t109+0.4099452478257239D-5*t140
     #*t113-0.1707861495995979D-7*t147*t238
      vrhoa(i) = -0.9847450218426965D0*t2*t41-0.3692793831910112D0*t3
     #*t152-0.3109D-1*t155*t78+0.1664368495390566D-2*t159*t79+0.5D0
     #*t164*t183-0.15545D-1*t48*t199+t227*t116+t98*t241
      t245 = sigma*t18
      t248 = t14*t26
      t251 = t24*t35
      t256 = 1/t2/t25/t16
      t257 = t32*t256
      t260 = -0.2029826234122677D-1*t7*t11+0.1926116339792656D-2*t245
     #*t21-0.2943696896D-4*t248*t29+0.1936590515257752D-6*t251*t38
     #-0.5029250940524092D-9*t257*t149
      t273 = 0.2177101493961762D-1*t7*t63-0.1060294562557539D1*t245
     #*t67+0.74049664D0*t248*t71+0.150076603621931D-1*t251*t75
     #-0.4569377322137058D-1*t257*t195
      t274 = t60*t273
      t287 = 0.1336205629821385D0*t7*t101-0.1157134392548454D-1*t245
     #*t105+0.2796994368D-3*t248*t109-0.3074589358692929D-5*t251*t113
     #+0.1280896121996984D-7*t257*t238
      vsigmaaa(i) = -0.7385587663820224D0*t3*t260-0.3109D-1*t48*t274
     #+2.D0*t98*t287
      t294 = sigma/t5/t15
      t297 = t15*t120
      t300 = t14/t2/t297
      t301 = t300*t105
      t304 = t24/t33
      t305 = t304*t109
      t310 = t32/t5/t25/t15
      t311 = t310*t113
      t316 = t143/t2/t25/t297
      t317 = t316*t238
      t320 = t25**2
      t323 = t32*t14/t320/t4
      t325 = 1/t112/t104
      t327 = 0.2168848908288D-8*t323*t325
      t337 = t47*t163
      t351 = 1/t37/t20
      t360 = t162**2
      t361 = 1/t360
      t363 = t180**2
      t364 = t59**2
      t365 = 1/t364
      t372 = 1/t15
      t373 = 1/t167/t44*t372
      t375 = 1/t120
      t376 = t168*t375
      t379 = 1/t54/t44
      t380 = t379*t372
      t382 = t158*t375
      t386 = 1/t52/t44*t372
      t388 = t174*t375
      t392 = 1/t45/t44*t372
      t394 = t177*t375
      t396 = -0.6934554859331846D1*t373+0.1664293166239643D2*t376
     #-0.4305845969834537D1*t380+0.1291753790950361D2*t382
     #-0.2326004811900819D1*t386+0.9304019247603276D1*t388
     #-0.3394740105503081D0*t392+0.2036844063301848D1*t394
      t402 = 1/t162/t56
      t408 = t375*t379
      t424 = 0.5495599555936838D-2*t204
      t425 = 0.2D1*t216
      t431 = t213**2
      t434 = 0.2D1*t83/t206/t89*t431*t214
      t446 = 0.1D1*t208*(-0.8309097827459833D0*t373
     #+0.199418347859036D1*t376-0.4945709824779306D0*t380
     #+0.1483712947433792D1*t382-0.2001071587498409D0*t386
     #+0.8004286349993634D0*t388-0.4215565168327908D-1*t392
     #+0.2529339100996745D0*t394)*t214
      t447 = t206**2
      t450 = t92**2
      t454 = 0.160818243221511D2*t83/t447*t431/t450
      t456 = 0.1831866518645613D-2*t380*t93
      t458 = 0.5495599555936838D-2*t382*t93
      t469 = dlog(1.D0+0.2960857464321668D2/(0.8157414703487641D1*t49
     #+0.2247591863577616D1*t45+0.4300972471276643D0*t52
     #+0.1911512595127338D0*t54))
      t471 = (1.D0+0.6901399211255825D-1*t45)*t469*t169
      t476 = 0.8837926660346786D-1*t172*t207*t213*t214
      t500 = 1/t74/t66
      s1 = 4.D0*t227*t241+t98*(0.130651217138091D1*t294*t101
     #-0.1588095866809658D0*t301+0.550752955392D-2*t305
     #-0.9127396286679657D-4*t311+0.723893480573944D-6*t317-t327)
     #-0.6564966812284644D0/t5*t41-0.1969490043685393D1*t2*t152
     #-0.6218D-1*t155*t198+0.2D1*t337*t183-0.3692793831910112D0*t3*(
     #-0.1984718984475507D0*t294*t11+0.334464870327603D-1*t300*t21
     #-0.8804261196231111D-3*t304*t29+0.100124277785001D-4*t310*t38
     #-0.5419986271555248D-7*t316*t149+0.1135422326556444D-9*t323*t351
     #)+0.1D1*t164*t182*t198+0.1608234158893535D2*t48*t361*t363*t365*t78
      s2 = s1+0.5D0*t164*t396*t181*t78-0.1D1*t48*t402*t363*t181*t78
     #+0.2219157993854088D-2*t408*t79-0.1070677706909338D0*t159*t163
     #*t183
      v2rhoa2(i) = s2+0.3328736990781132D-2*t159*t199+(-0.5D0*t48*t163
     #*t396*t181-0.1608234158893535D2*t48*t361*t363*t365+t424+t425
     #-0.2D1*t337*t182+rho*(-t434+t446+t454+t456-t458
     #+0.3377399869956914D-1*t471-t476)+0.1070677706909338D0*t159*t224
     #+0.1D1*t48*t402*t363*t181-0.2219157993854088D-2*t408*t60)*t116
     #-0.15545D-1*t48*t60*(0.2128721460762612D0*t294*t63
     #-0.1795634810650787D2*t300*t67+0.2255943994026667D2*t304*t71
     #-0.4548412964297639D1*t310*t75-0.1882044954610406D1*t316*t195
     #+0.51579977728D0*t323*t500)+(t424+t425+rho*(-t434+t446+t454+t456
     #-t458-0.3377399869956914D-1*t471-t476))*t116+t98*(
     #-0.456675571873391D-1*t301+0.277269061632D-2*t305
     #-0.6121131135957682D-4*t311+0.5986503042009055D-6*t317-t327)
      t522 = sigma*t128
      t525 = t14*t133
      t528 = t24*t139
      t531 = t32*t146
      t536 = t143/t320/rho
      t569 = t522*t105
      t571 = t525*t109
      t573 = t528*t113
      t575 = t531*t238
      t578 = 0.1626636681216D-8*t536*t325
      s1 = -0.9847450218426965D0*t2*t260-0.3692793831910112D0*t3*
     #(0.1082573991532094D0*t122*t11-0.2123263259498491D-1*t522*t21
     #+0.6014456517973333D-3*t525*t29-0.7122002730823528D-5*t528*t38
     #+0.3964404684855954D-7*t531*t149-0.8515667449173333D-10*t536
     #*t351)-0.3109D-1*t155*t273+0.1664368495390566D-2*t159*t274
      v2rhoasigmaaa(i) = s1+0.5D0*t164*t182*t273-0.15545D-1*t48*t60*(
     #-0.1161120796779606D0*t122*t63+0.1134667195476582D2*t522*t67
     #-0.154385866752D2*t525*t71+0.3441325043947615D1*t528*t75
     #+0.1320146169515063D1*t531*t195-0.38684983296D0*t536*t500)+2.D0
     #*t227*t287+t98*(-0.7126430025714055D0*t122*t101
     #+0.9596450215975523D-1*t569-0.357124829184D-2*t571
     #+0.6230629343271157D-4*t573-0.5173021879905183D-6*t575+t578)+t98
     #*(0.3425066789050433D-1*t569-0.207951796224D-2*t571
     #+0.4590848351968261D-4*t573-0.4489877281506791D-6*t575+t578)
      t589 = sigma*t26
      t592 = t14*t35
      t595 = t24*t256
      t599 = t32/t320
      v2sigmaaa2(i) = -0.7385587663820224D0*t3*(0.8220009087068062D-2
     #*t18*t21-0.333336363008D-3*t589*t29+0.4566865842014545D-5*t592
     #*t38-0.2772133476021002D-7*t595*t149+0.638675058688D-10*t599
     #*t351)-0.3109D-1*t48*t60*(-0.4268825715844209D1*t18*t67
     #+0.86169534464D1*t589*t71-0.2641024424409484D1*t592*t75
     #-0.8073345342508149D0*t595*t195+0.29013737472D0*t599*t500)+4.D0
     #*t98*(-0.2568800091787825D-1*t18*t105+0.155963847168D-2*t589
     #*t109-0.3443136263976196D-4*t592*t113+0.3367407961130093D-6*t595
     #*t238-0.1219977510912D-8*t599*t325)
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end

c:XC_HCTH147subrend
_ENDIF
_IF(ccpdft,all,xc_hcth407)
c:XC_HCTH407subrstart

c    Generated: Sat May  8 18:40:30 GMT 2004

      subroutine uks_xc_hcth407
     & (ideriv,npt,rhoa1,rhob1,sigmaaa1,sigmabb1,sigmaab1,
     &  zk,vrhoa,vrhob,vsigmaaa,vsigmabb,vsigmaab,
     &  v2rhoa2,v2rhob2,v2rhoab,
     &  v2rhoasigmaaa,v2rhoasigmaab,v2rhoasigmabb,
     &  v2rhobsigmabb,v2rhobsigmaab,v2rhobsigmaaa,
     &  v2sigmaaa2,v2sigmaaaab,v2sigmaaabb,
     &  v2sigmaab2,v2sigmaabbb,v2sigmabb2)
c
c     A.D. Boese, N.C. Handy
c     A new parametriztion of exchange-correlation generalized gradient
c     approximation functionals
c     J. Chem. Phys. 114 (2001) 5497-5503.
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt),rhob1(npt)
      REAL sigmaaa1(npt),sigmabb1(npt),sigmaab1(npt)
      REAL zk(npt),vrhoa(npt),vrhob(npt)
      REAL vsigmaaa(npt),vsigmabb(npt),vsigmaab(npt)
      REAL v2rhoa2(npt),v2rhob2(npt),v2rhoab(npt)
      REAL v2rhoasigmaaa(npt),v2rhoasigmaab(npt)
      REAL v2rhoasigmabb(npt),v2rhobsigmabb(npt)
      REAL v2rhobsigmaab(npt),v2rhobsigmaaa(npt)
      REAL v2sigmaaa2(npt),v2sigmaaaab(npt),v2sigmaaabb(npt)
      REAL v2sigmaab2(npt),v2sigmaabbb(npt),v2sigmabb2(npt)
      parameter(tol=1.0d-20)
      
      if (ideriv.eq.0) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t4 = rhob**2
      t5 = t2**2
      t8 = sigmabb/t5/t4
      t10 = 1.D0+0.4D-2*t8
      t14 = sigmabb**2
      t15 = t4**2
      t19 = t14/t2/t15/rhob
      t20 = t10**2
      t25 = t15**2
      t27 = t14*sigmabb/t25
      t32 = t14**2
      t36 = t32/t5/t25/t4
      t37 = t20**2
      t44 = 1/rhob
      t45 = t44**(1.D0/3.D0)
      t49 = t44**(1.D0/6.D0)
      t52 = dsqrt(t44)
      t54 = t45**2
      t60 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t49
     #+0.3844746237447211D1*t45+0.1644733775567609D1*t52
     #+0.2405871291288192D0*t54))
      t62 = 1.D0+0.2D0*t8
      t66 = t62**2
      t74 = t66**2
      zk(i) = -0.9305257363491D0*t2*rhob*(0.108184D1-0.2073356D-2*t8
     #/t10+0.5480992D-4*t19/t20-0.16825664D-6*t27/t20/t10+0.5858688D-9
     #*t36/t37)-0.3109D-1*rhob*(1.D0+0.1274696188700087D0*t45)*t60*
     #(0.118777D1-0.480584D0*t8/t62+0.2246964D0*t19/t66-0.7343384D-1
     #*t27/t66/t62+0.9996768D-2*t36/t74)
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t4 = rhoa**2
      t5 = t2**2
      t8 = sigmaaa/t5/t4
      t10 = 1.D0+0.4D-2*t8
      t14 = sigmaaa**2
      t15 = t4**2
      t19 = t14/t2/t15/rhoa
      t20 = t10**2
      t25 = t15**2
      t27 = t14*sigmaaa/t25
      t32 = t14**2
      t36 = t32/t5/t25/t4
      t37 = t20**2
      t44 = 1/rhoa
      t45 = t44**(1.D0/3.D0)
      t49 = t44**(1.D0/6.D0)
      t52 = dsqrt(t44)
      t54 = t45**2
      t60 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t49
     #+0.3844746237447211D1*t45+0.1644733775567609D1*t52
     #+0.2405871291288192D0*t54))
      t62 = 1.D0+0.2D0*t8
      t66 = t62**2
      t74 = t66**2
      zk(i) = -0.9305257363491D0*t2*rhoa*(0.108184D1-0.2073356D-2*t8
     #/t10+0.5480992D-4*t19/t20-0.16825664D-6*t27/t20/t10+0.5858688D-9
     #*t36/t37)-0.3109D-1*rhoa*(1.D0+0.1274696188700087D0*t45)*t60*
     #(0.118777D1-0.480584D0*t8/t62+0.2246964D0*t19/t66-0.7343384D-1
     #*t27/t66/t62+0.9996768D-2*t36/t74)
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t6 = rhoa**2
      t7 = t4**2
      t10 = sigmaaa/t7/t6
      t12 = 1.D0+0.4D-2*t10
      t16 = sigmaaa**2
      t17 = t6**2
      t21 = t16/t4/t17/rhoa
      t22 = t12**2
      t27 = t17**2
      t29 = t16*sigmaaa/t27
      t34 = t16**2
      t38 = t34/t7/t27/t6
      t39 = t22**2
      t46 = 1/rhoa
      t47 = t46**(1.D0/3.D0)
      t50 = rhoa*(1.D0+0.1274696188700087D0*t47)
      t51 = t46**(1.D0/6.D0)
      t54 = dsqrt(t46)
      t56 = t47**2
      t62 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t51
     #+0.3844746237447211D1*t47+0.1644733775567609D1*t54
     #+0.2405871291288192D0*t56))
      t64 = 1.D0+0.2D0*t10
      t68 = t64**2
      t76 = t68**2
      t84 = rhob**(1.D0/3.D0)
      t86 = rhob**2
      t87 = t84**2
      t90 = sigmabb/t87/t86
      t92 = 1.D0+0.4D-2*t90
      t96 = sigmabb**2
      t97 = t86**2
      t101 = t96/t84/t97/rhob
      t102 = t92**2
      t107 = t97**2
      t109 = t96*sigmabb/t107
      t114 = t96**2
      t118 = t114/t87/t107/t86
      t119 = t102**2
      t126 = 1/rhob
      t127 = t126**(1.D0/3.D0)
      t130 = rhob*(1.D0+0.1274696188700087D0*t127)
      t131 = t126**(1.D0/6.D0)
      t134 = dsqrt(t126)
      t136 = t127**2
      t142 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t131
     #+0.3844746237447211D1*t127+0.1644733775567609D1*t134
     #+0.2405871291288192D0*t136))
      t144 = 1.D0+0.2D0*t90
      t148 = t144**2
      t156 = t148**2
      t164 = rhoa+rhob
      t165 = 1/t164
      t166 = t165**(1.D0/3.D0)
      t169 = t165**(1.D0/6.D0)
      t172 = dsqrt(t165)
      t174 = t166**2
      t180 = dlog(1.D0+0.160818243221511D2/(0.598255043577108D1*t169
     #+0.2225569421150687D1*t166+0.8004286349993634D0*t172
     #+0.1897004325747559D0*t174))
      t182 = 0.62182D-1*(1.D0+0.1325688999052018D0*t166)*t180
      t193 = dlog(1.D0+0.2960857464321668D2/(0.8157414703487641D1*t169
     #+0.2247591863577616D1*t166+0.4300972471276643D0*t172
     #+0.1911512595127338D0*t174))
      t196 = rhoa-1.D0*rhob
      t197 = t196*t165
      t198 = 1.D0+t197
      t199 = t198**(1.D0/3.D0)
      t202 = 1.D0-1.D0*t197
      t203 = t202**(1.D0/3.D0)
      t205 = t199*t198+t203*t202-2.D0
      t206 = t196**2
      t207 = t206**2
      t208 = t164**2
      t209 = t208**2
      t211 = t207/t209
      t227 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t169
     #+0.3844746237447211D1*t166+0.1644733775567609D1*t172
     #+0.2405871291288192D0*t174))
      t243 = 0.5D0*t10+0.5D0*t90
      t246 = 1.D0+0.3D-2*t10+0.3D-2*t90
      t250 = t243**2
      t251 = t246**2
      t260 = t250**2
      t261 = t251**2
      s1 = -0.9305257363491D0*t4*rhoa*(0.108184D1-0.2073356D-2*t10/t12
     #+0.5480992D-4*t21/t22-0.16825664D-6*t29/t22/t12+0.5858688D-9*t38
     #/t39)-0.3109D-1*t50*t62*(0.118777D1-0.480584D0*t10/t64
     #+0.2246964D0*t21/t68-0.7343384D-1*t29/t68/t64+0.9996768D-2*t38
     #/t76)
      s2 = s1-0.9305257363491D0*t84*rhob*(0.108184D1-0.2073356D-2*t90
     #/t92+0.5480992D-4*t101/t102-0.16825664D-6*t109/t102/t92
     #+0.5858688D-9*t118/t119)
      zk(i) = s2-0.3109D-1*t130*t142*(0.118777D1-0.480584D0*t90/t144
     #+0.2246964D0*t101/t148-0.7343384D-1*t109/t148/t144+0.9996768D-2
     #*t118/t156)+(t164*(-t182+0.3799574853701528D-1*(1.D0
     #+0.6901399211255825D-1*t166)*t193*t205*(1.D0-1.D0*t211)
     #+0.1923661050931536D1*(-0.3109D-1*(1.D0+0.1274696188700087D0
     #*t166)*t227+t182)*t205*t211)+0.3109D-1*t50*t62+0.3109D-1*t130
     #*t142)*(0.589076D0+0.2654244D-1*t243/t246-0.6919848D-3*t250/t251
     #+0.91955736D-5*t250*t243/t251/t246-0.544387392D-7*t260/t261)
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t3 = t2*rhob
      t4 = rhob**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigmabb*t7
      t10 = 1.D0+0.4D-2*t8
      t11 = 1/t10
      t14 = sigmabb**2
      t15 = t4**2
      t16 = t15*rhob
      t18 = 1/t2/t16
      t19 = t14*t18
      t20 = t10**2
      t21 = 1/t20
      t24 = t14*sigmabb
      t25 = t15**2
      t26 = 1/t25
      t27 = t24*t26
      t29 = 1/t20/t10
      t32 = t14**2
      t35 = 1/t5/t25/t4
      t36 = t32*t35
      t37 = t20**2
      t38 = 1/t37
      t41 = 0.108184D1-0.2073356D-2*t8*t11+0.5480992D-4*t19*t21
     #-0.16825664D-6*t27*t29+0.5858688D-9*t36*t38
      t44 = 1/rhob
      t45 = t44**(1.D0/3.D0)
      t47 = 1.D0+0.1274696188700087D0*t45
      t48 = rhob*t47
      t49 = t44**(1.D0/6.D0)
      t52 = dsqrt(t44)
      t54 = t45**2
      t56 = 0.1112037486309468D2*t49+0.3844746237447211D1*t45
     #+0.1644733775567609D1*t52+0.2405871291288192D0*t54
      t59 = 1.D0+0.321646831778707D2/t56
      t60 = dlog(t59)
      t62 = 1.D0+0.2D0*t8
      t63 = 1/t62
      t66 = t62**2
      t67 = 1/t66
      t71 = 1/t66/t62
      t74 = t66**2
      t75 = 1/t74
      t78 = 0.118777D1-0.480584D0*t8*t63+0.2246964D0*t19*t67
     #-0.7343384D-1*t27*t71+0.9996768D-2*t36*t75
      t79 = t60*t78
      zk(i) = -0.9305257363491D0*t3*t41-0.3109D-1*t48*t79
      vrhoa(i) = 0.D0
      t84 = t4*rhob
      t87 = sigmabb/t5/t84
      t90 = t15*t4
      t93 = t14/t2/t90
      t98 = t24/t25/rhob
      t104 = t32/t5/t25/t84
      t111 = t32*sigmabb/t2/t25/t90
      t113 = 1/t37/t10
      t122 = 1/t54
      t126 = t56**2
      t129 = t49**2
      t130 = t129**2
      t133 = 1/t4
      t159 = 1/t74/t62
      vrhob(i) = -0.12407009817988D1*t2*t41-0.9305257363491D0*t3*
     #(0.5528949333333333D-2*t87*t11-0.3144353706666667D-3*t93*t21
     #+0.2515331413333333D-5*t98*t29-0.1163347968D-7*t104*t38
     #+0.249970688D-10*t111*t113)-0.3109D-1*t47*t60*t78
     #+0.1321010150222857D-2*t44*t122*t79+0.1D1*t48/t126*(
     #-0.1853395810515781D1/t130/t49*t133-0.128158207914907D1*t122
     #*t133-0.8223668877838045D0/t52*t133-0.1603914194192128D0/t45
     #*t133)/t59*t78-0.3109D-1*t48*t60*(0.1281557333333333D1*t87*t63
     #-0.1454692266666667D1*t93*t67+0.82714688D0*t98*t71-0.224126336D0
     #*t104*t75+0.213264384D-1*t111*t159)
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      t168 = sigmabb*t18
      t171 = t14*t26
      t174 = t24*t35
      t180 = t32/t2/t25/t16
      vsigmabb(i) = -0.9305257363491D0*t3*(-0.2073356D-2*t7*t11
     #+0.117913264D-3*t168*t21-0.94324928D-6*t171*t29+0.436255488D-8
     #*t174*t38-0.93739008D-11*t180*t113)-0.3109D-1*t48*t60*(
     #-0.480584D0*t7*t63+0.5455096D0*t168*t67-0.31018008D0*t171*t71
     #+0.84047376D-1*t174*t75-0.79974144D-2*t180*t159)
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t3 = t2*rhoa
      t4 = rhoa**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigmaaa*t7
      t10 = 1.D0+0.4D-2*t8
      t11 = 1/t10
      t14 = sigmaaa**2
      t15 = t4**2
      t16 = t15*rhoa
      t18 = 1/t2/t16
      t19 = t14*t18
      t20 = t10**2
      t21 = 1/t20
      t24 = t14*sigmaaa
      t25 = t15**2
      t26 = 1/t25
      t27 = t24*t26
      t29 = 1/t20/t10
      t32 = t14**2
      t35 = 1/t5/t25/t4
      t36 = t32*t35
      t37 = t20**2
      t38 = 1/t37
      t41 = 0.108184D1-0.2073356D-2*t8*t11+0.5480992D-4*t19*t21
     #-0.16825664D-6*t27*t29+0.5858688D-9*t36*t38
      t44 = 1/rhoa
      t45 = t44**(1.D0/3.D0)
      t47 = 1.D0+0.1274696188700087D0*t45
      t48 = rhoa*t47
      t49 = t44**(1.D0/6.D0)
      t52 = dsqrt(t44)
      t54 = t45**2
      t56 = 0.1112037486309468D2*t49+0.3844746237447211D1*t45
     #+0.1644733775567609D1*t52+0.2405871291288192D0*t54
      t59 = 1.D0+0.321646831778707D2/t56
      t60 = dlog(t59)
      t62 = 1.D0+0.2D0*t8
      t63 = 1/t62
      t66 = t62**2
      t67 = 1/t66
      t71 = 1/t66/t62
      t74 = t66**2
      t75 = 1/t74
      t78 = 0.118777D1-0.480584D0*t8*t63+0.2246964D0*t19*t67
     #-0.7343384D-1*t27*t71+0.9996768D-2*t36*t75
      t79 = t60*t78
      zk(i) = -0.9305257363491D0*t3*t41-0.3109D-1*t48*t79
      t84 = t4*rhoa
      t87 = sigmaaa/t5/t84
      t90 = t15*t4
      t93 = t14/t2/t90
      t98 = t24/t25/rhoa
      t104 = t32/t5/t25/t84
      t111 = t32*sigmaaa/t2/t25/t90
      t113 = 1/t37/t10
      t122 = 1/t54
      t126 = t56**2
      t129 = t49**2
      t130 = t129**2
      t133 = 1/t4
      t159 = 1/t74/t62
      vrhoa(i) = -0.12407009817988D1*t2*t41-0.9305257363491D0*t3*
     #(0.5528949333333333D-2*t87*t11-0.3144353706666667D-3*t93*t21
     #+0.2515331413333333D-5*t98*t29-0.1163347968D-7*t104*t38
     #+0.249970688D-10*t111*t113)-0.3109D-1*t47*t60*t78
     #+0.1321010150222857D-2*t44*t122*t79+0.1D1*t48/t126*(
     #-0.1853395810515781D1/t130/t49*t133-0.128158207914907D1*t122
     #*t133-0.8223668877838045D0/t52*t133-0.1603914194192128D0/t45
     #*t133)/t59*t78-0.3109D-1*t48*t60*(0.1281557333333333D1*t87*t63
     #-0.1454692266666667D1*t93*t67+0.82714688D0*t98*t71-0.224126336D0
     #*t104*t75+0.213264384D-1*t111*t159)
      vrhob(i) = 0.D0
      t168 = sigmaaa*t18
      t171 = t14*t26
      t174 = t24*t35
      t180 = t32/t2/t25/t16
      vsigmaaa(i) = -0.9305257363491D0*t3*(-0.2073356D-2*t7*t11
     #+0.117913264D-3*t168*t21-0.94324928D-6*t171*t29+0.436255488D-8
     #*t174*t38-0.93739008D-11*t180*t113)-0.3109D-1*t48*t60*(
     #-0.480584D0*t7*t63+0.5455096D0*t168*t67-0.31018008D0*t171*t71
     #+0.84047376D-1*t174*t75-0.79974144D-2*t180*t159)
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t5 = t4*rhoa
      t6 = rhoa**2
      t7 = t4**2
      t9 = 1/t7/t6
      t10 = sigmaaa*t9
      t12 = 1.D0+0.4D-2*t10
      t13 = 1/t12
      t16 = sigmaaa**2
      t17 = t6**2
      t18 = t17*rhoa
      t20 = 1/t4/t18
      t21 = t16*t20
      t22 = t12**2
      t23 = 1/t22
      t26 = t16*sigmaaa
      t27 = t17**2
      t28 = 1/t27
      t29 = t26*t28
      t31 = 1/t22/t12
      t34 = t16**2
      t37 = 1/t7/t27/t6
      t38 = t34*t37
      t39 = t22**2
      t40 = 1/t39
      t43 = 0.108184D1-0.2073356D-2*t10*t13+0.5480992D-4*t21*t23
     #-0.16825664D-6*t29*t31+0.5858688D-9*t38*t40
      t46 = 1/rhoa
      t47 = t46**(1.D0/3.D0)
      t49 = 1.D0+0.1274696188700087D0*t47
      t50 = rhoa*t49
      t51 = t46**(1.D0/6.D0)
      t54 = dsqrt(t46)
      t56 = t47**2
      t58 = 0.1112037486309468D2*t51+0.3844746237447211D1*t47
     #+0.1644733775567609D1*t54+0.2405871291288192D0*t56
      t61 = 1.D0+0.321646831778707D2/t58
      t62 = dlog(t61)
      t64 = 1.D0+0.2D0*t10
      t65 = 1/t64
      t68 = t64**2
      t69 = 1/t68
      t73 = 1/t68/t64
      t76 = t68**2
      t77 = 1/t76
      t80 = 0.118777D1-0.480584D0*t10*t65+0.2246964D0*t21*t69
     #-0.7343384D-1*t29*t73+0.9996768D-2*t38*t77
      t81 = t62*t80
      t84 = rhob**(1.D0/3.D0)
      t85 = t84*rhob
      t86 = rhob**2
      t87 = t84**2
      t89 = 1/t87/t86
      t90 = sigmabb*t89
      t92 = 1.D0+0.4D-2*t90
      t93 = 1/t92
      t96 = sigmabb**2
      t97 = t86**2
      t98 = t97*rhob
      t100 = 1/t84/t98
      t101 = t96*t100
      t102 = t92**2
      t103 = 1/t102
      t106 = t96*sigmabb
      t107 = t97**2
      t108 = 1/t107
      t109 = t106*t108
      t111 = 1/t102/t92
      t114 = t96**2
      t117 = 1/t87/t107/t86
      t118 = t114*t117
      t119 = t102**2
      t120 = 1/t119
      t123 = 0.108184D1-0.2073356D-2*t90*t93+0.5480992D-4*t101*t103
     #-0.16825664D-6*t109*t111+0.5858688D-9*t118*t120
      t126 = 1/rhob
      t127 = t126**(1.D0/3.D0)
      t129 = 1.D0+0.1274696188700087D0*t127
      t130 = rhob*t129
      t131 = t126**(1.D0/6.D0)
      t134 = dsqrt(t126)
      t136 = t127**2
      t138 = 0.1112037486309468D2*t131+0.3844746237447211D1*t127
     #+0.1644733775567609D1*t134+0.2405871291288192D0*t136
      t141 = 1.D0+0.321646831778707D2/t138
      t142 = dlog(t141)
      t144 = 1.D0+0.2D0*t90
      t145 = 1/t144
      t148 = t144**2
      t149 = 1/t148
      t153 = 1/t148/t144
      t156 = t148**2
      t157 = 1/t156
      t160 = 0.118777D1-0.480584D0*t90*t145+0.2246964D0*t101*t149
     #-0.7343384D-1*t109*t153+0.9996768D-2*t118*t157
      t161 = t142*t160
      t164 = rhoa+rhob
      t165 = 1/t164
      t166 = t165**(1.D0/3.D0)
      t168 = 1.D0+0.1325688999052018D0*t166
      t169 = t165**(1.D0/6.D0)
      t172 = dsqrt(t165)
      t174 = t166**2
      t176 = 0.598255043577108D1*t169+0.2225569421150687D1*t166
     #+0.8004286349993634D0*t172+0.1897004325747559D0*t174
      t179 = 1.D0+0.160818243221511D2/t176
      t180 = dlog(t179)
      t182 = 0.62182D-1*t168*t180
      t184 = 1.D0+0.6901399211255825D-1*t166
      t189 = 0.8157414703487641D1*t169+0.2247591863577616D1*t166
     #+0.4300972471276643D0*t172+0.1911512595127338D0*t174
      t192 = 1.D0+0.2960857464321668D2/t189
      t193 = dlog(t192)
      t194 = t184*t193
      t196 = rhoa-1.D0*rhob
      t197 = t196*t165
      t198 = 1.D0+t197
      t199 = t198**(1.D0/3.D0)
      t202 = 1.D0-1.D0*t197
      t203 = t202**(1.D0/3.D0)
      t205 = t199*t198+t203*t202-2.D0
      t206 = t196**2
      t207 = t206**2
      t208 = t164**2
      t209 = t208**2
      t210 = 1/t209
      t211 = t207*t210
      t213 = 1.D0-1.D0*t211
      t216 = 0.3799574853701528D-1*t194*t205*t213
      t218 = 1.D0+0.1274696188700087D0*t166
      t223 = 0.1112037486309468D2*t169+0.3844746237447211D1*t166
     #+0.1644733775567609D1*t172+0.2405871291288192D0*t174
      t226 = 1.D0+0.321646831778707D2/t223
      t227 = dlog(t226)
      t230 = -0.3109D-1*t218*t227+t182
      t231 = t230*t205
      t233 = 0.1923661050931536D1*t231*t211
      t240 = t164*(-t182+t216+t233)+0.3109D-1*t50*t62+0.3109D-1*t130
     #*t142
      t243 = 0.5D0*t10+0.5D0*t90
      t246 = 1.D0+0.3D-2*t10+0.3D-2*t90
      t247 = 1/t246
      t250 = t243**2
      t251 = t246**2
      t252 = 1/t251
      t255 = t250*t243
      t257 = 1/t251/t246
      t260 = t250**2
      t261 = t251**2
      t262 = 1/t261
      t265 = 0.589076D0+0.2654244D-1*t243*t247-0.6919848D-3*t250*t252
     #+0.91955736D-5*t255*t257-0.544387392D-7*t260*t262
      zk(i) = -0.9305257363491D0*t5*t43-0.3109D-1*t50*t81
     #-0.9305257363491D0*t85*t123-0.3109D-1*t130*t161+t240*t265
      t269 = t6*rhoa
      t272 = sigmaaa/t7/t269
      t275 = t17*t6
      t278 = t16/t4/t275
      t283 = t26/t27/rhoa
      t289 = t34/t7/t27/t269
      t296 = t34*sigmaaa/t4/t27/t275
      t298 = 1/t39/t12
      t304 = t49*t62
      t307 = 1/t56
      t308 = t46*t307
      t311 = t58**2
      t312 = 1/t311
      t314 = t51**2
      t315 = t314**2
      t318 = 1/t6
      t329 = -0.1853395810515781D1/t315/t51*t318-0.128158207914907D1
     #*t307*t318-0.8223668877838045D0/t54*t318-0.1603914194192128D0
     #/t47*t318
      t330 = 1/t61
      t344 = 1/t76/t64
      t352 = 1/t208
      t353 = 1/t174*t352
      t354 = t353*t180
      t355 = 0.2747799777968419D-2*t354
      t356 = t176**2
      t359 = t169**2
      t360 = t359**2
      t363 = 1/t360/t169*t352
      t367 = 1/t172*t352
      t370 = 1/t166*t352
      t375 = t168/t356*(-0.99709173929518D0*t363-0.7418564737168958D0
     #*t353-0.4002143174996817D0*t367-0.1264669550498372D0*t370)/t179
      t376 = 0.1D1*t375
      t380 = 0.8740794299481065D-3*t353*t193*t205*t213
      t381 = t189**2
      t394 = 0.1124999956683108D1*t184/t381*(-0.135956911724794D1*t363
     #-0.7491972878592054D0*t353-0.2150486235638321D0*t367
     #-0.1274341730084892D0*t370)/t192*t205*t213
      t395 = t196*t352
      t396 = 1.D0*t395
      t400 = 1.D0*t165
      t404 = 0.1333333333333333D1*t199*(t165-t396)
     #+0.1333333333333333D1*t203*(-t400+t395)
      t409 = t206*t196*t210
      t410 = 4.D0*t409
      t413 = t207/t209/t164
      t414 = 4.D0*t413
      t421 = t223**2
      t438 = 0.1923661050931536D1*(0.1321010150222857D-2*t353*t227
     #+0.1D1*t218/t421*(-0.1853395810515781D1*t363-0.128158207914907D1
     #*t353-0.8223668877838045D0*t367-0.1603914194192128D0*t370)/t226
     #-0.2747799777968419D-2*t354-0.1D1*t375)*t205*t211
      t442 = t231*t409
      t445 = 0.7694644203726145D1*t231*t413
      t459 = t243*t252
      t462 = t250*t257
      t465 = t255*t262
      t470 = t260/t261/t246
      s1 = -0.12407009817988D1*t4*t43-0.9305257363491D0*t5*
     #(0.5528949333333333D-2*t272*t13-0.3144353706666667D-3*t278*t23
     #+0.2515331413333333D-5*t283*t31-0.1163347968D-7*t289*t40
     #+0.249970688D-10*t296*t298)-0.3109D-1*t304*t80
     #+0.1321010150222857D-2*t308*t81
      vrhoa(i) = s1+0.1D1*t50*t312*t329*t330*t80-0.3109D-1*t50*t62*
     #(0.1281557333333333D1*t272*t65-0.1454692266666667D1*t278*t69
     #+0.82714688D0*t283*t73-0.224126336D0*t289*t77+0.213264384D-1
     #*t296*t344)+(-t182+t216+t233+t164*(t355+t376-t380-t394
     #+0.3799574853701528D-1*t194*t404*t213+0.3799574853701528D-1*t194
     #*t205*(-t410+t414)+t438+0.1923661050931536D1*t230*t404*t211
     #+0.7694644203726145D1*t442-t445)+0.3109D-1*t304
     #-0.1321010150222857D-2*t308*t62-0.1D1*t50*t312*t329*t330)*t265
     #+t240*(-0.3538992D-1*t272*t247+0.205763232D-2*t459*t272
     #-0.478540512D-4*t462*t272+0.5110337088D-6*t465*t272
     #-0.17420396544D-8*t470*t272)
      t477 = t86*rhob
      t480 = sigmabb/t87/t477
      t483 = t97*t86
      t486 = t96/t84/t483
      t491 = t106/t107/rhob
      t497 = t114/t87/t107/t477
      t504 = t114*sigmabb/t84/t107/t483
      t506 = 1/t119/t92
      t512 = t129*t142
      t515 = 1/t136
      t516 = t126*t515
      t519 = t138**2
      t520 = 1/t519
      t522 = t131**2
      t523 = t522**2
      t526 = 1/t86
      t537 = -0.1853395810515781D1/t523/t131*t526-0.128158207914907D1
     #*t515*t526-0.8223668877838045D0/t134*t526-0.1603914194192128D0
     #/t127*t526
      t538 = 1/t141
      t552 = 1/t156/t144
      t565 = 0.1333333333333333D1*t199*(-t400-t396)
     #+0.1333333333333333D1*t203*(t165+t395)
      s1 = -0.12407009817988D1*t84*t123-0.9305257363491D0*t85*
     #(0.5528949333333333D-2*t480*t93-0.3144353706666667D-3*t486*t103
     #+0.2515331413333333D-5*t491*t111-0.1163347968D-7*t497*t120
     #+0.249970688D-10*t504*t506)-0.3109D-1*t512*t160
     #+0.1321010150222857D-2*t516*t161
      vrhob(i) = s1+0.1D1*t130*t520*t537*t538*t160-0.3109D-1*t130*t142
     #*(0.1281557333333333D1*t480*t145-0.1454692266666667D1*t486*t149
     #+0.82714688D0*t491*t153-0.224126336D0*t497*t157+0.213264384D-1
     #*t504*t552)+(-t182+t216+t233+t164*(t355+t376-t380-t394
     #+0.3799574853701528D-1*t194*t565*t213+0.3799574853701528D-1*t194
     #*t205*(t410+t414)+t438+0.1923661050931536D1*t230*t565*t211
     #-0.7694644203726145D1*t442-t445)+0.3109D-1*t512
     #-0.1321010150222857D-2*t516*t142-0.1D1*t130*t520*t537*t538)*t265
     #+t240*(-0.3538992D-1*t480*t247+0.205763232D-2*t459*t480
     #-0.478540512D-4*t462*t480+0.5110337088D-6*t465*t480
     #-0.17420396544D-8*t470*t480)
      t602 = sigmaaa*t20
      t605 = t16*t28
      t608 = t26*t37
      t614 = t34/t4/t27/t18
      vsigmaaa(i) = -0.9305257363491D0*t5*(-0.2073356D-2*t9*t13
     #+0.117913264D-3*t602*t23-0.94324928D-6*t605*t31+0.436255488D-8
     #*t608*t40-0.93739008D-11*t614*t298)-0.3109D-1*t50*t62*(
     #-0.480584D0*t9*t65+0.5455096D0*t602*t69-0.31018008D0*t605*t73
     #+0.84047376D-1*t608*t77-0.79974144D-2*t614*t344)+t240*
     #(0.1327122D-1*t9*t247-0.77161212D-3*t459*t9+0.179452692D-4*t462
     #*t9-0.1916376408D-6*t465*t9+0.6532648704D-9*t470*t9)
      vsigmaab(i) = 0.D0
      t648 = sigmabb*t100
      t651 = t96*t108
      t654 = t106*t117
      t660 = t114/t84/t107/t98
      vsigmabb(i) = -0.9305257363491D0*t85*(-0.2073356D-2*t89*t93
     #+0.117913264D-3*t648*t103-0.94324928D-6*t651*t111+0.436255488D-8
     #*t654*t120-0.93739008D-11*t660*t506)-0.3109D-1*t130*t142*(
     #-0.480584D0*t89*t145+0.5455096D0*t648*t149-0.31018008D0*t651
     #*t153+0.84047376D-1*t654*t157-0.79974144D-2*t660*t552)+t240*
     #(0.1327122D-1*t89*t247-0.77161212D-3*t459*t89+0.179452692D-4
     #*t462*t89-0.1916376408D-6*t465*t89+0.6532648704D-9*t470*t89)
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t3 = t2*rhob
      t4 = rhob**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigmabb*t7
      t10 = 1.D0+0.4D-2*t8
      t11 = 1/t10
      t14 = sigmabb**2
      t15 = t4**2
      t16 = t15*rhob
      t18 = 1/t2/t16
      t19 = t14*t18
      t20 = t10**2
      t21 = 1/t20
      t24 = t14*sigmabb
      t25 = t15**2
      t26 = 1/t25
      t27 = t24*t26
      t29 = 1/t20/t10
      t32 = t14**2
      t33 = t25*t4
      t35 = 1/t5/t33
      t36 = t32*t35
      t37 = t20**2
      t38 = 1/t37
      t41 = 0.108184D1-0.2073356D-2*t8*t11+0.5480992D-4*t19*t21
     #-0.16825664D-6*t27*t29+0.5858688D-9*t36*t38
      t44 = 1/rhob
      t45 = t44**(1.D0/3.D0)
      t47 = 1.D0+0.1274696188700087D0*t45
      t48 = rhob*t47
      t49 = t44**(1.D0/6.D0)
      t52 = dsqrt(t44)
      t54 = t45**2
      t56 = 0.1112037486309468D2*t49+0.3844746237447211D1*t45
     #+0.1644733775567609D1*t52+0.2405871291288192D0*t54
      t59 = 1.D0+0.321646831778707D2/t56
      t60 = dlog(t59)
      t62 = 1.D0+0.2D0*t8
      t63 = 1/t62
      t66 = t62**2
      t67 = 1/t66
      t71 = 1/t66/t62
      t74 = t66**2
      t75 = 1/t74
      t78 = 0.118777D1-0.480584D0*t8*t63+0.2246964D0*t19*t67
     #-0.7343384D-1*t27*t71+0.9996768D-2*t36*t75
      t79 = t60*t78
      zk(i) = -0.9305257363491D0*t3*t41-0.3109D-1*t48*t79
      vrhoa(i) = 0.D0
      t84 = t4*rhob
      t87 = sigmabb/t5/t84
      t90 = t15*t4
      t93 = t14/t2/t90
      t98 = t24/t25/rhob
      t104 = t32/t5/t25/t84
      t107 = t32*sigmabb
      t111 = t107/t2/t25/t90
      t113 = 1/t37/t10
      t116 = 0.5528949333333333D-2*t87*t11-0.3144353706666667D-3*t93
     #*t21+0.2515331413333333D-5*t98*t29-0.1163347968D-7*t104*t38
     #+0.249970688D-10*t111*t113
      t119 = t47*t60
      t122 = 1/t54
      t123 = t44*t122
      t126 = t56**2
      t127 = 1/t126
      t128 = t48*t127
      t129 = t49**2
      t130 = t129**2
      t131 = t130*t49
      t132 = 1/t131
      t133 = 1/t4
      t138 = 1/t52
      t141 = 1/t45
      t144 = -0.1853395810515781D1*t132*t133-0.128158207914907D1*t122
     #*t133-0.8223668877838045D0*t138*t133-0.1603914194192128D0*t141
     #*t133
      t145 = 1/t59
      t146 = t144*t145
      t147 = t146*t78
      t159 = 1/t74/t62
      t162 = 0.1281557333333333D1*t87*t63-0.1454692266666667D1*t93*t67
     #+0.82714688D0*t98*t71-0.224126336D0*t104*t75+0.213264384D-1*t111
     #*t159
      t163 = t60*t162
      vrhob(i) = -0.12407009817988D1*t2*t41-0.9305257363491D0*t3*t116
     #-0.3109D-1*t119*t78+0.1321010150222857D-2*t123*t79+0.1D1*t128
     #*t147-0.3109D-1*t48*t163
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      t168 = sigmabb*t18
      t171 = t14*t26
      t174 = t24*t35
      t179 = 1/t2/t25/t16
      t180 = t32*t179
      vsigmabb(i) = -0.9305257363491D0*t3*(-0.2073356D-2*t7*t11
     #+0.117913264D-3*t168*t21-0.94324928D-6*t171*t29+0.436255488D-8
     #*t174*t38-0.93739008D-11*t180*t113)-0.3109D-1*t48*t60*(
     #-0.480584D0*t7*t63+0.5455096D0*t168*t67-0.31018008D0*t171*t71
     #+0.84047376D-1*t174*t75-0.79974144D-2*t180*t159)
      v2rhoa2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t207 = sigmabb/t5/t15
      t210 = t15*t84
      t213 = t14/t2/t210
      t217 = t24/t33
      t223 = t32/t5/t25/t15
      t229 = t107/t2/t25/t210
      t233 = t25**2
      t236 = t32*t14/t233/t4
      t238 = 1/t37/t20
      t249 = 1/t84
      t251 = 1/t54/t44
      t263 = t144**2
      t270 = 1/t15
      t296 = t126**2
      t299 = t59**2
      t319 = 1/t74/t66
      s1 = -0.4135669939329333D0/t5*t41-0.24814019635976D1*t2*t116
     #-0.9305257363491D0*t3*(-0.2027281422222222D-1*t207*t11
     #+0.2050399473777778D-2*t213*t21-0.2934593729422222D-4*t217*t29
     #+0.2162145348266667D-6*t223*t38-0.8546531191466667D-9*t229*t113
     #+0.1333177002666667D-11*t236*t238)+0.2D1*t47*t127*t147-0.6218D-1
     #*t119*t162+0.8806734334819047D-3*t249*t251*t79
      v2rhob2(i) = s1-0.8497974591333914D-1*t123*t127*t147
     #+0.2642020300445714D-2*t123*t163-0.2D1*t48/t126/t56*t263*t145
     #*t78+0.1D1*t128*(-0.1544496508763151D1/t131/t44*t270
     #+0.3706791621031562D1*t132*t249-0.854388052766047D0*t251*t270
     #+0.2563164158298141D1*t122*t249-0.4111834438919023D0/t52/t44
     #*t270+0.1644733775567609D1*t138*t249-0.5346380647307093D-1/t45
     #/t44*t270+0.3207828388384256D0*t141*t249)*t145*t78
     #+0.321646831778707D2*t48/t296*t263/t299*t78+0.2D1*t128*t146*t162
     #-0.3109D-1*t48*t60*(-0.4699043555555556D1*t207*t63
     #+0.9896548266666667D1*t213*t67-0.8995993671111111D1*t217*t71
     #+0.3938242261333333D1*t223*t75-0.7838151338666667D0*t229*t159
     #+0.568705024D-1*t236*t319)
      v2sigmaaa2(i) = 0.D0
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      t328 = sigmabb*t26
      t331 = t14*t35
      t334 = t24*t179
      t338 = t32/t233
      v2sigmabb2(i) = -0.9305257363491D0*t3*(0.126206688D-3*t18*t21
     #-0.2829804672D-5*t328*t29+0.24406656D-7*t331*t38
     #-0.10729648128D-9*t334*t113+0.187478016D-12*t338*t238)-0.3109D-1
     #*t48*t60*(0.6416264D0*t18*t67-0.838564D0*t328*t71+0.438250176D0
     #*t331*t75-0.992275584D-1*t334*t159+0.79974144D-2*t338*t319)
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t3 = t2*rhoa
      t4 = rhoa**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigmaaa*t7
      t10 = 1.D0+0.4D-2*t8
      t11 = 1/t10
      t14 = sigmaaa**2
      t15 = t4**2
      t16 = t15*rhoa
      t18 = 1/t2/t16
      t19 = t14*t18
      t20 = t10**2
      t21 = 1/t20
      t24 = t14*sigmaaa
      t25 = t15**2
      t26 = 1/t25
      t27 = t24*t26
      t29 = 1/t20/t10
      t32 = t14**2
      t33 = t25*t4
      t35 = 1/t5/t33
      t36 = t32*t35
      t37 = t20**2
      t38 = 1/t37
      t41 = 0.108184D1-0.2073356D-2*t8*t11+0.5480992D-4*t19*t21
     #-0.16825664D-6*t27*t29+0.5858688D-9*t36*t38
      t44 = 1/rhoa
      t45 = t44**(1.D0/3.D0)
      t47 = 1.D0+0.1274696188700087D0*t45
      t48 = rhoa*t47
      t49 = t44**(1.D0/6.D0)
      t52 = dsqrt(t44)
      t54 = t45**2
      t56 = 0.1112037486309468D2*t49+0.3844746237447211D1*t45
     #+0.1644733775567609D1*t52+0.2405871291288192D0*t54
      t59 = 1.D0+0.321646831778707D2/t56
      t60 = dlog(t59)
      t62 = 1.D0+0.2D0*t8
      t63 = 1/t62
      t66 = t62**2
      t67 = 1/t66
      t71 = 1/t66/t62
      t74 = t66**2
      t75 = 1/t74
      t78 = 0.118777D1-0.480584D0*t8*t63+0.2246964D0*t19*t67
     #-0.7343384D-1*t27*t71+0.9996768D-2*t36*t75
      t79 = t60*t78
      zk(i) = -0.9305257363491D0*t3*t41-0.3109D-1*t48*t79
      t84 = t4*rhoa
      t87 = sigmaaa/t5/t84
      t90 = t15*t4
      t93 = t14/t2/t90
      t98 = t24/t25/rhoa
      t104 = t32/t5/t25/t84
      t107 = t32*sigmaaa
      t111 = t107/t2/t25/t90
      t113 = 1/t37/t10
      t116 = 0.5528949333333333D-2*t87*t11-0.3144353706666667D-3*t93
     #*t21+0.2515331413333333D-5*t98*t29-0.1163347968D-7*t104*t38
     #+0.249970688D-10*t111*t113
      t119 = t47*t60
      t122 = 1/t54
      t123 = t44*t122
      t126 = t56**2
      t127 = 1/t126
      t128 = t48*t127
      t129 = t49**2
      t130 = t129**2
      t131 = t130*t49
      t132 = 1/t131
      t133 = 1/t4
      t138 = 1/t52
      t141 = 1/t45
      t144 = -0.1853395810515781D1*t132*t133-0.128158207914907D1*t122
     #*t133-0.8223668877838045D0*t138*t133-0.1603914194192128D0*t141
     #*t133
      t145 = 1/t59
      t146 = t144*t145
      t147 = t146*t78
      t159 = 1/t74/t62
      t162 = 0.1281557333333333D1*t87*t63-0.1454692266666667D1*t93*t67
     #+0.82714688D0*t98*t71-0.224126336D0*t104*t75+0.213264384D-1*t111
     #*t159
      t163 = t60*t162
      vrhoa(i) = -0.12407009817988D1*t2*t41-0.9305257363491D0*t3*t116
     #-0.3109D-1*t119*t78+0.1321010150222857D-2*t123*t79+0.1D1*t128
     #*t147-0.3109D-1*t48*t163
      vrhob(i) = 0.D0
      t168 = sigmaaa*t18
      t171 = t14*t26
      t174 = t24*t35
      t179 = 1/t2/t25/t16
      t180 = t32*t179
      vsigmaaa(i) = -0.9305257363491D0*t3*(-0.2073356D-2*t7*t11
     #+0.117913264D-3*t168*t21-0.94324928D-6*t171*t29+0.436255488D-8
     #*t174*t38-0.93739008D-11*t180*t113)-0.3109D-1*t48*t60*(
     #-0.480584D0*t7*t63+0.5455096D0*t168*t67-0.31018008D0*t171*t71
     #+0.84047376D-1*t174*t75-0.79974144D-2*t180*t159)
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      t207 = sigmaaa/t5/t15
      t210 = t15*t84
      t213 = t14/t2/t210
      t217 = t24/t33
      t223 = t32/t5/t25/t15
      t229 = t107/t2/t25/t210
      t233 = t25**2
      t236 = t32*t14/t233/t4
      t238 = 1/t37/t20
      t249 = 1/t84
      t251 = 1/t54/t44
      t263 = t144**2
      t270 = 1/t15
      t296 = t126**2
      t299 = t59**2
      t319 = 1/t74/t66
      s1 = -0.4135669939329333D0/t5*t41-0.24814019635976D1*t2*t116
     #-0.9305257363491D0*t3*(-0.2027281422222222D-1*t207*t11
     #+0.2050399473777778D-2*t213*t21-0.2934593729422222D-4*t217*t29
     #+0.2162145348266667D-6*t223*t38-0.8546531191466667D-9*t229*t113
     #+0.1333177002666667D-11*t236*t238)+0.2D1*t47*t127*t147-0.6218D-1
     #*t119*t162+0.8806734334819047D-3*t249*t251*t79
      v2rhoa2(i) = s1-0.8497974591333914D-1*t123*t127*t147
     #+0.2642020300445714D-2*t123*t163-0.2D1*t48/t126/t56*t263*t145
     #*t78+0.1D1*t128*(-0.1544496508763151D1/t131/t44*t270
     #+0.3706791621031562D1*t132*t249-0.854388052766047D0*t251*t270
     #+0.2563164158298141D1*t122*t249-0.4111834438919023D0/t52/t44
     #*t270+0.1644733775567609D1*t138*t249-0.5346380647307093D-1/t45
     #/t44*t270+0.3207828388384256D0*t141*t249)*t145*t78
     #+0.321646831778707D2*t48/t296*t263/t299*t78+0.2D1*t128*t146*t162
     #-0.3109D-1*t48*t60*(-0.4699043555555556D1*t207*t63
     #+0.9896548266666667D1*t213*t67-0.8995993671111111D1*t217*t71
     #+0.3938242261333333D1*t223*t75-0.7838151338666667D0*t229*t159
     #+0.568705024D-1*t236*t319)
      v2rhob2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t328 = sigmaaa*t26
      t331 = t14*t35
      t334 = t24*t179
      t338 = t32/t233
      v2sigmaaa2(i) = -0.9305257363491D0*t3*(0.126206688D-3*t18*t21
     #-0.2829804672D-5*t328*t29+0.24406656D-7*t331*t38
     #-0.10729648128D-9*t334*t113+0.187478016D-12*t338*t238)-0.3109D-1
     #*t48*t60*(0.6416264D0*t18*t67-0.838564D0*t328*t71+0.438250176D0
     #*t331*t75-0.992275584D-1*t334*t159+0.79974144D-2*t338*t319)
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      v2sigmabb2(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t5 = t4*rhoa
      t6 = rhoa**2
      t7 = t4**2
      t9 = 1/t7/t6
      t10 = sigmaaa*t9
      t12 = 1.D0+0.4D-2*t10
      t13 = 1/t12
      t16 = sigmaaa**2
      t17 = t6**2
      t18 = t17*rhoa
      t20 = 1/t4/t18
      t21 = t16*t20
      t22 = t12**2
      t23 = 1/t22
      t26 = t16*sigmaaa
      t27 = t17**2
      t28 = 1/t27
      t29 = t26*t28
      t31 = 1/t22/t12
      t34 = t16**2
      t35 = t27*t6
      t37 = 1/t7/t35
      t38 = t34*t37
      t39 = t22**2
      t40 = 1/t39
      t43 = 0.108184D1-0.2073356D-2*t10*t13+0.5480992D-4*t21*t23
     #-0.16825664D-6*t29*t31+0.5858688D-9*t38*t40
      t46 = 1/rhoa
      t47 = t46**(1.D0/3.D0)
      t49 = 1.D0+0.1274696188700087D0*t47
      t50 = rhoa*t49
      t51 = t46**(1.D0/6.D0)
      t54 = dsqrt(t46)
      t56 = t47**2
      t58 = 0.1112037486309468D2*t51+0.3844746237447211D1*t47
     #+0.1644733775567609D1*t54+0.2405871291288192D0*t56
      t61 = 1.D0+0.321646831778707D2/t58
      t62 = dlog(t61)
      t64 = 1.D0+0.2D0*t10
      t65 = 1/t64
      t68 = t64**2
      t69 = 1/t68
      t73 = 1/t68/t64
      t76 = t68**2
      t77 = 1/t76
      t80 = 0.118777D1-0.480584D0*t10*t65+0.2246964D0*t21*t69
     #-0.7343384D-1*t29*t73+0.9996768D-2*t38*t77
      t81 = t62*t80
      t84 = rhob**(1.D0/3.D0)
      t85 = t84*rhob
      t86 = rhob**2
      t87 = t84**2
      t89 = 1/t87/t86
      t90 = sigmabb*t89
      t92 = 1.D0+0.4D-2*t90
      t93 = 1/t92
      t96 = sigmabb**2
      t97 = t86**2
      t98 = t97*rhob
      t100 = 1/t84/t98
      t101 = t96*t100
      t102 = t92**2
      t103 = 1/t102
      t106 = t96*sigmabb
      t107 = t97**2
      t108 = 1/t107
      t109 = t106*t108
      t111 = 1/t102/t92
      t114 = t96**2
      t115 = t107*t86
      t117 = 1/t87/t115
      t118 = t114*t117
      t119 = t102**2
      t120 = 1/t119
      t123 = 0.108184D1-0.2073356D-2*t90*t93+0.5480992D-4*t101*t103
     #-0.16825664D-6*t109*t111+0.5858688D-9*t118*t120
      t126 = 1/rhob
      t127 = t126**(1.D0/3.D0)
      t129 = 1.D0+0.1274696188700087D0*t127
      t130 = rhob*t129
      t131 = t126**(1.D0/6.D0)
      t134 = dsqrt(t126)
      t136 = t127**2
      t138 = 0.1112037486309468D2*t131+0.3844746237447211D1*t127
     #+0.1644733775567609D1*t134+0.2405871291288192D0*t136
      t141 = 1.D0+0.321646831778707D2/t138
      t142 = dlog(t141)
      t144 = 1.D0+0.2D0*t90
      t145 = 1/t144
      t148 = t144**2
      t149 = 1/t148
      t153 = 1/t148/t144
      t156 = t148**2
      t157 = 1/t156
      t160 = 0.118777D1-0.480584D0*t90*t145+0.2246964D0*t101*t149
     #-0.7343384D-1*t109*t153+0.9996768D-2*t118*t157
      t161 = t142*t160
      t164 = rhoa+rhob
      t165 = 1/t164
      t166 = t165**(1.D0/3.D0)
      t168 = 1.D0+0.1325688999052018D0*t166
      t169 = t165**(1.D0/6.D0)
      t172 = dsqrt(t165)
      t174 = t166**2
      t176 = 0.598255043577108D1*t169+0.2225569421150687D1*t166
     #+0.8004286349993634D0*t172+0.1897004325747559D0*t174
      t179 = 1.D0+0.160818243221511D2/t176
      t180 = dlog(t179)
      t182 = 0.62182D-1*t168*t180
      t184 = 1.D0+0.6901399211255825D-1*t166
      t189 = 0.8157414703487641D1*t169+0.2247591863577616D1*t166
     #+0.4300972471276643D0*t172+0.1911512595127338D0*t174
      t192 = 1.D0+0.2960857464321668D2/t189
      t193 = dlog(t192)
      t194 = t184*t193
      t196 = rhoa-1.D0*rhob
      t197 = t196*t165
      t198 = 1.D0+t197
      t199 = t198**(1.D0/3.D0)
      t202 = 1.D0-1.D0*t197
      t203 = t202**(1.D0/3.D0)
      t205 = t199*t198+t203*t202-2.D0
      t206 = t196**2
      t207 = t206**2
      t208 = t164**2
      t209 = t208**2
      t210 = 1/t209
      t211 = t207*t210
      t213 = 1.D0-1.D0*t211
      t214 = t205*t213
      t216 = 0.3799574853701528D-1*t194*t214
      t218 = 1.D0+0.1274696188700087D0*t166
      t223 = 0.1112037486309468D2*t169+0.3844746237447211D1*t166
     #+0.1644733775567609D1*t172+0.2405871291288192D0*t174
      t226 = 1.D0+0.321646831778707D2/t223
      t227 = dlog(t226)
      t230 = -0.3109D-1*t218*t227+t182
      t231 = t230*t205
      t233 = 0.1923661050931536D1*t231*t211
      t240 = t164*(-t182+t216+t233)+0.3109D-1*t50*t62+0.3109D-1*t130
     #*t142
      t243 = 0.5D0*t10+0.5D0*t90
      t246 = 1.D0+0.3D-2*t10+0.3D-2*t90
      t247 = 1/t246
      t250 = t243**2
      t251 = t246**2
      t252 = 1/t251
      t255 = t250*t243
      t257 = 1/t251/t246
      t260 = t250**2
      t261 = t251**2
      t262 = 1/t261
      t265 = 0.589076D0+0.2654244D-1*t243*t247-0.6919848D-3*t250*t252
     #+0.91955736D-5*t255*t257-0.544387392D-7*t260*t262
      zk(i) = -0.9305257363491D0*t5*t43-0.3109D-1*t50*t81
     #-0.9305257363491D0*t85*t123-0.3109D-1*t130*t161+t240*t265
      t269 = t6*rhoa
      t271 = 1/t7/t269
      t272 = sigmaaa*t271
      t275 = t17*t6
      t277 = 1/t4/t275
      t278 = t16*t277
      t282 = 1/t27/rhoa
      t283 = t26*t282
      t288 = 1/t7/t27/t269
      t289 = t34*t288
      t292 = t34*sigmaaa
      t295 = 1/t4/t27/t275
      t296 = t292*t295
      t298 = 1/t39/t12
      t301 = 0.5528949333333333D-2*t272*t13-0.3144353706666667D-3*t278
     #*t23+0.2515331413333333D-5*t283*t31-0.1163347968D-7*t289*t40
     #+0.249970688D-10*t296*t298
      t304 = t49*t62
      t307 = 1/t56
      t308 = t46*t307
      t311 = t58**2
      t312 = 1/t311
      t313 = t50*t312
      t314 = t51**2
      t315 = t314**2
      t316 = t315*t51
      t317 = 1/t316
      t318 = 1/t6
      t323 = 1/t54
      t326 = 1/t47
      t329 = -0.1853395810515781D1*t317*t318-0.128158207914907D1*t307
     #*t318-0.8223668877838045D0*t323*t318-0.1603914194192128D0*t326
     #*t318
      t330 = 1/t61
      t331 = t329*t330
      t332 = t331*t80
      t344 = 1/t76/t64
      t347 = 0.1281557333333333D1*t272*t65-0.1454692266666667D1*t278
     #*t69+0.82714688D0*t283*t73-0.224126336D0*t289*t77+0.213264384D-1
     #*t296*t344
      t348 = t62*t347
      t351 = 1/t174
      t352 = 1/t208
      t353 = t351*t352
      t354 = t353*t180
      t355 = 0.2747799777968419D-2*t354
      t356 = t176**2
      t357 = 1/t356
      t358 = t168*t357
      t359 = t169**2
      t360 = t359**2
      t361 = t360*t169
      t362 = 1/t361
      t363 = t362*t352
      t366 = 1/t172
      t367 = t366*t352
      t369 = 1/t166
      t370 = t369*t352
      t372 = -0.99709173929518D0*t363-0.7418564737168958D0*t353
     #-0.4002143174996817D0*t367-0.1264669550498372D0*t370
      t373 = 1/t179
      t375 = t358*t372*t373
      t376 = 0.1D1*t375
      t377 = t193*t205
      t378 = t377*t213
      t379 = t353*t378
      t380 = 0.8740794299481065D-3*t379
      t381 = t189**2
      t382 = 1/t381
      t383 = t184*t382
      t388 = -0.135956911724794D1*t363-0.7491972878592054D0*t353
     #-0.2150486235638321D0*t367-0.1274341730084892D0*t370
      t389 = t383*t388
      t390 = 1/t192
      t391 = t390*t205
      t392 = t391*t213
      t393 = t389*t392
      t394 = 0.1124999956683108D1*t393
      t395 = t196*t352
      t396 = 1.D0*t395
      t397 = t165-t396
      t400 = 1.D0*t165
      t401 = -t400+t395
      t404 = 0.1333333333333333D1*t199*t397+0.1333333333333333D1*t203
     #*t401
      t406 = t194*t404*t213
      t407 = 0.3799574853701528D-1*t406
      t408 = t206*t196
      t409 = t408*t210
      t410 = 4.D0*t409
      t412 = 1/t209/t164
      t413 = t207*t412
      t414 = 4.D0*t413
      t415 = -t410+t414
      t417 = t194*t205*t415
      t418 = 0.3799574853701528D-1*t417
      t421 = t223**2
      t422 = 1/t421
      t423 = t218*t422
      t428 = -0.1853395810515781D1*t363-0.128158207914907D1*t353
     #-0.8223668877838045D0*t367-0.1603914194192128D0*t370
      t429 = 1/t226
      t435 = 0.1321010150222857D-2*t353*t227+0.1D1*t423*t428*t429
     #-0.2747799777968419D-2*t354-0.1D1*t375
      t436 = t435*t205
      t437 = t436*t211
      t438 = 0.1923661050931536D1*t437
      t439 = t230*t404
      t440 = t439*t211
      t441 = 0.1923661050931536D1*t440
      t442 = t231*t409
      t444 = t231*t413
      t445 = 0.7694644203726145D1*t444
      t452 = t312*t329*t330
      t455 = -t182+t216+t233+t164*(t355+t376-t380-t394+t407+t418+t438
     #+t441+0.7694644203726145D1*t442-t445)+0.3109D-1*t304
     #-0.1321010150222857D-2*t308*t62-0.1D1*t50*t452
      t459 = t243*t252
      t462 = t250*t257
      t465 = t255*t262
      t469 = 1/t261/t246
      t470 = t260*t469
      t473 = -0.3538992D-1*t272*t247+0.205763232D-2*t459*t272
     #-0.478540512D-4*t462*t272+0.5110337088D-6*t465*t272
     #-0.17420396544D-8*t470*t272
      vrhoa(i) = -0.12407009817988D1*t4*t43-0.9305257363491D0*t5*t301
     #-0.3109D-1*t304*t80+0.1321010150222857D-2*t308*t81+0.1D1*t313
     #*t332-0.3109D-1*t50*t348+t455*t265+t240*t473
      t477 = t86*rhob
      t479 = 1/t87/t477
      t480 = sigmabb*t479
      t483 = t97*t86
      t485 = 1/t84/t483
      t486 = t96*t485
      t490 = 1/t107/rhob
      t491 = t106*t490
      t496 = 1/t87/t107/t477
      t497 = t114*t496
      t500 = t114*sigmabb
      t503 = 1/t84/t107/t483
      t504 = t500*t503
      t506 = 1/t119/t92
      t509 = 0.5528949333333333D-2*t480*t93-0.3144353706666667D-3*t486
     #*t103+0.2515331413333333D-5*t491*t111-0.1163347968D-7*t497*t120
     #+0.249970688D-10*t504*t506
      t512 = t129*t142
      t515 = 1/t136
      t516 = t126*t515
      t519 = t138**2
      t520 = 1/t519
      t521 = t130*t520
      t522 = t131**2
      t523 = t522**2
      t524 = t523*t131
      t525 = 1/t524
      t526 = 1/t86
      t531 = 1/t134
      t534 = 1/t127
      t537 = -0.1853395810515781D1*t525*t526-0.128158207914907D1*t515
     #*t526-0.8223668877838045D0*t531*t526-0.1603914194192128D0*t534
     #*t526
      t538 = 1/t141
      t539 = t537*t538
      t540 = t539*t160
      t552 = 1/t156/t144
      t555 = 0.1281557333333333D1*t480*t145-0.1454692266666667D1*t486
     #*t149+0.82714688D0*t491*t153-0.224126336D0*t497*t157
     #+0.213264384D-1*t504*t552
      t556 = t142*t555
      t559 = -t400-t396
      t562 = t165+t395
      t565 = 0.1333333333333333D1*t199*t559+0.1333333333333333D1*t203
     #*t562
      t567 = t194*t565*t213
      t568 = 0.3799574853701528D-1*t567
      t569 = t410+t414
      t571 = t194*t205*t569
      t572 = 0.3799574853701528D-1*t571
      t573 = t230*t565
      t574 = t573*t211
      t575 = 0.1923661050931536D1*t574
      t583 = t520*t537*t538
      t586 = -t182+t216+t233+t164*(t355+t376-t380-t394+t568+t572+t438
     #+t575-0.7694644203726145D1*t442-t445)+0.3109D-1*t512
     #-0.1321010150222857D-2*t516*t142-0.1D1*t130*t583
      t598 = -0.3538992D-1*t480*t247+0.205763232D-2*t459*t480
     #-0.478540512D-4*t462*t480+0.5110337088D-6*t465*t480
     #-0.17420396544D-8*t470*t480
      vrhob(i) = -0.12407009817988D1*t84*t123-0.9305257363491D0*t85
     #*t509-0.3109D-1*t512*t160+0.1321010150222857D-2*t516*t161+0.1D1
     #*t521*t540-0.3109D-1*t130*t556+t586*t265+t240*t598
      t602 = sigmaaa*t20
      t605 = t16*t28
      t608 = t26*t37
      t613 = 1/t4/t27/t18
      t614 = t34*t613
      t617 = -0.2073356D-2*t9*t13+0.117913264D-3*t602*t23
     #-0.94324928D-6*t605*t31+0.436255488D-8*t608*t40-0.93739008D-11
     #*t614*t298
      t630 = -0.480584D0*t9*t65+0.5455096D0*t602*t69-0.31018008D0*t605
     #*t73+0.84047376D-1*t608*t77-0.79974144D-2*t614*t344
      t631 = t62*t630
      t644 = 0.1327122D-1*t9*t247-0.77161212D-3*t459*t9+0.179452692D-4
     #*t462*t9-0.1916376408D-6*t465*t9+0.6532648704D-9*t470*t9
      vsigmaaa(i) = -0.9305257363491D0*t5*t617-0.3109D-1*t50*t631+t240
     #*t644
      vsigmaab(i) = 0.D0
      t648 = sigmabb*t100
      t651 = t96*t108
      t654 = t106*t117
      t659 = 1/t84/t107/t98
      t660 = t114*t659
      t663 = -0.2073356D-2*t89*t93+0.117913264D-3*t648*t103
     #-0.94324928D-6*t651*t111+0.436255488D-8*t654*t120-0.93739008D-11
     #*t660*t506
      t676 = -0.480584D0*t89*t145+0.5455096D0*t648*t149-0.31018008D0
     #*t651*t153+0.84047376D-1*t654*t157-0.79974144D-2*t660*t552
      t677 = t142*t676
      t690 = 0.1327122D-1*t89*t247-0.77161212D-3*t459*t89
     #+0.179452692D-4*t462*t89-0.1916376408D-6*t465*t89
     #+0.6532648704D-9*t470*t89
      vsigmabb(i) = -0.9305257363491D0*t85*t663-0.3109D-1*t130*t677
     #+t240*t690
      t696 = sigmaaa/t7/t17
      t699 = t17*t269
      t702 = t16/t4/t699
      t705 = t243*t257
      t710 = t250*t262
      t715 = t255*t469
      t722 = t260/t261/t251
      t739 = t26/t35
      t745 = t34/t7/t27/t17
      t751 = t292/t4/t27/t699
      t755 = t27**2
      t758 = t34*t16/t755/t6
      t760 = 1/t39/t22
      t768 = t49*t312
      t774 = 1/t311/t58
      t776 = t329**2
      t781 = 1/t269
      t783 = 1/t56/t46
      t784 = t781*t783
      t792 = 1/t17
      t813 = -0.1544496508763151D1/t316/t46*t792+0.3706791621031562D1
     #*t317*t781-0.854388052766047D0*t783*t792+0.2563164158298141D1
     #*t307*t781-0.4111834438919023D0/t54/t46*t792
     #+0.1644733775567609D1*t323*t781-0.5346380647307093D-1/t47/t46
     #*t792+0.3207828388384256D0*t326*t781
      t821 = t311**2
      t822 = 1/t821
      t824 = t61**2
      t825 = 1/t824
      t841 = 1/t76/t68
      t848 = 0.2D1*t375
      t849 = 0.5495599555936838D-2*t354
      t851 = 0.1748158859896213D-2*t379
      t852 = 0.2249999913366216D1*t393
      t853 = 0.3847322101863073D1*t437
      t856 = 0.1538928840745229D2*t444
      t877 = 1/t208/t164
      t878 = t351*t877
      t879 = t878*t180
      t880 = 0.5495599555936838D-2*t879
      t883 = 1/t174/t165*t210
      t885 = 0.5827196199654043D-3*t883*t378
      t886 = t883*t180
      t887 = 0.1831866518645613D-2*t886
      t888 = t408*t412
      t889 = t231*t888
      t892 = t435*t404*t211
      t895 = t353*t377*t415
      t898 = 0.1748158859896213D-2*t878*t378
      t901 = t353*t193*t404*t213
      t903 = t199**2
      t904 = 1/t903
      t905 = t397**2
      t908 = 2.D0*t352
      t910 = 2.D0*t196*t877
      t911 = -t908+t910
      t914 = t203**2
      t915 = 1/t914
      t916 = t401**2
      t922 = 0.4444444444444444D0*t904*t905+0.1333333333333333D1*t199
     #*t911+0.4444444444444444D0*t915*t916-0.1333333333333333D1*t203
     #*t911
      t928 = t389*t390*t404*t213
      t932 = t353*t357*t372*t373
      t933 = 0.8837926660346786D-1*t932
      t935 = t389*t391*t415
      t937 = t381**2
      t940 = t388**2
      t942 = t192**2
      t947 = 0.3330964519106732D2*t184/t937*t940/t942*t205*t213
      t950 = 1/t361/t165*t210
      t952 = t362*t877
      t958 = 1/t172/t165*t210
      t960 = t366*t877
      t964 = 1/t166/t165*t210
      t966 = t369*t877
      t971 = 0.1124999956683108D1*t383*(-0.1132974264373283D1*t950
     #+0.271913823449588D1*t952-0.4994648585728036D0*t883
     #+0.1498394575718411D1*t878-0.1075243117819161D0*t958
     #+0.4300972471276643D0*t960-0.4247805766949639D-1*t964
     #+0.2548683460169784D0*t966)*t392
      t972 = -t880-t885+t887-0.6155715362980916D2*t889
     #+0.3847322101863073D1*t892-0.1748158859896213D-2*t895+t898
     #-0.1748158859896213D-2*t901+0.3799574853701528D-1*t194*t922*t213
     #-0.2249999913366216D1*t928-t933-0.2249999913366216D1*t935-t947
     #-t971
      t977 = 0.5176049209143758D-1*t353*t382*t388*t390*t214
      t983 = 0.2249999913366216D1*t184/t381/t189*t940*t392
      t987 = t372**2
      t989 = t168/t356/t176*t987*t373
      t990 = 0.2D1*t989
      t1001 = t358*(-0.8309097827459833D0*t950+0.199418347859036D1
     #*t952-0.4945709824779306D0*t883+0.1483712947433792D1*t878
     #-0.2001071587498409D0*t958+0.8004286349993634D0*t960
     #-0.4215565168327908D-1*t964+0.2529339100996745D0*t966)*t373
      t1002 = 0.1D1*t1001
      t1003 = t356**2
      t1006 = t179**2
      t1009 = t168/t1003*t987/t1006
      t1010 = 0.160818243221511D2*t1009
      t1022 = t428**2
      t1038 = t421**2
      t1041 = t226**2
      t1052 = 0.8806734334819047D-3*t883*t227-0.2642020300445714D-2
     #*t878*t227-0.8497974591333914D-1*t353*t422*t428*t429-0.2D1*t218
     #/t421/t223*t1022*t429+0.1D1*t423*(-0.1544496508763151D1*t950
     #+0.3706791621031562D1*t952-0.854388052766047D0*t883
     #+0.2563164158298141D1*t878-0.4111834438919023D0*t958
     #+0.1644733775567609D1*t960-0.5346380647307093D-1*t964
     #+0.3207828388384256D0*t966)*t429+0.321646831778707D2*t218/t1038
     #*t1022/t1041-0.1831866518645613D-2*t886+0.5495599555936838D-2
     #*t879+0.8837926660346786D-1*t932+0.2D1*t989-0.1D1*t1001
     #-0.160818243221511D2*t1009
      t1055 = 0.1923661050931536D1*t1052*t205*t211
      t1056 = t436*t409
      t1061 = t439*t409
      t1063 = t206*t210
      t1064 = 12.D0*t1063
      t1065 = 32.D0*t888
      t1068 = t207/t209/t208
      t1069 = 20.D0*t1068
      t1075 = 0.3847322101863073D2*t231*t1068
      t1076 = t439*t413
      t1078 = t231*t1063
      t1079 = 0.2308393261117844D2*t1078
      t1084 = 0.1538928840745229D2*t436*t413
      t1085 = t977+t983-t990+t1002+t1010+t1055+0.1538928840745229D2
     #*t1056+0.1923661050931536D1*t230*t922*t211+0.1538928840745229D2
     #*t1061+0.3799574853701528D-1*t194*t205*(-t1064+t1065-t1069)
     #+t1075-0.1538928840745229D2*t1076+t1079+0.7599149707403056D-1
     #*t194*t404*t415-t1084
      t1088 = t848+t849+0.7599149707403056D-1*t417-t851-t852+t853
     #+0.7599149707403056D-1*t406+0.1538928840745229D2*t442-t856
     #+0.3847322101863073D1*t440-0.2D1*t768*t331-0.321646831778707D2
     #*t50*t822*t776*t825-0.1D1*t50*t312*t813*t330
     #-0.8806734334819047D-3*t784*t62+0.8497974591333914D-1*t308*t452
     #+0.2D1*t50*t774*t776*t330+t164*(t972+t1085)
      s1 = 2.D0*t455*t473+t240*(0.12976304D0*t696*t247-0.302662912D-2
     #*t702*t252+0.16053292032D-3*t705*t702-0.754465184D-2*t459*t696
     #-0.3192632064D-5*t710*t702+0.1754648544D-3*t462*t696
     #+0.256439568384D-7*t715*t702-0.18737902656D-5*t465*t696
     #-0.69681586176D-10*t722*t702+0.63874787328D-8*t470*t696)
     #-0.4135669939329333D0/t7*t43-0.24814019635976D1*t4*t301
     #-0.9305257363491D0*t5*(-0.2027281422222222D-1*t696*t13
     #+0.2050399473777778D-2*t702*t23-0.2934593729422222D-4*t739*t31
     #+0.2162145348266667D-6*t745*t40-0.8546531191466667D-9*t751*t298
     #+0.1333177002666667D-11*t758*t760)-0.6218D-1*t304*t347+0.2D1
     #*t768*t332+0.2642020300445714D-2*t308*t348
      v2rhoa2(i) = s1-0.2D1*t50*t774*t776*t330*t80
     #+0.8806734334819047D-3*t784*t81-0.8497974591333914D-1*t308*t312
     #*t332+0.1D1*t313*t813*t330*t80+0.2D1*t313*t331*t347
     #+0.321646831778707D2*t50*t822*t776*t825*t80-0.3109D-1*t50*t62*(
     #-0.4699043555555556D1*t696*t65+0.9896548266666667D1*t702*t69
     #-0.8995993671111111D1*t739*t73+0.3938242261333333D1*t745*t77
     #-0.7838151338666667D0*t751*t344+0.568705024D-1*t758*t841)+t1088
     #*t265
      t1097 = sigmabb/t87/t97
      t1100 = t97*t477
      t1103 = t96/t84/t1100
      t1107 = t106/t115
      t1113 = t114/t87/t107/t97
      t1119 = t500/t84/t107/t1100
      t1123 = t107**2
      t1126 = t114*t96/t1123/t86
      t1128 = 1/t119/t102
      t1139 = t519**2
      t1140 = 1/t1139
      t1142 = t537**2
      t1143 = t141**2
      t1144 = 1/t1143
      t1154 = t559**2
      t1157 = t908+t910
      t1160 = t562**2
      t1166 = 0.4444444444444444D0*t904*t1154+0.1333333333333333D1
     #*t199*t1157+0.4444444444444444D0*t915*t1160-0.1333333333333333D1
     #*t203*t1157
      t1171 = t435*t565*t211
      t1173 = -t880-t885+t887+0.6155715362980916D2*t889+t898-t933-t947
     #-t971+t977+t983-t990+t1002+0.3799574853701528D-1*t194*t1166*t213
     #+0.3847322101863073D1*t1171
      t1184 = t573*t413
      t1186 = t573*t409
      t1189 = t389*t391*t569
      t1194 = t353*t193*t565*t213
      t1197 = t353*t377*t569
      t1201 = t389*t390*t565*t213
      t1203 = 0.7599149707403056D-1*t194*t565*t569
     #+0.1923661050931536D1*t230*t1166*t211+0.3799574853701528D-1*t194
     #*t205*(-t1064-t1065-t1069)-0.1538928840745229D2*t1184+t1010
     #+t1055-0.1538928840745229D2*t1186-0.2249999913366216D1*t1189
     #-0.1538928840745229D2*t1056-0.1748158859896213D-2*t1194
     #-0.1748158859896213D-2*t1197-0.2249999913366216D1*t1201+t1075
     #+t1079-t1084
      t1206 = t129*t520
      t1209 = 1/t477
      t1211 = 1/t136/t126
      t1212 = t1209*t1211
      t1218 = 1/t519/t138
      t1225 = 1/t97
      t1246 = -0.1544496508763151D1/t524/t126*t1225
     #+0.3706791621031562D1*t525*t1209-0.854388052766047D0*t1211*t1225
     #+0.2563164158298141D1*t515*t1209-0.4111834438919023D0/t134/t126
     #*t1225+0.1644733775567609D1*t531*t1209-0.5346380647307093D-1
     #/t127/t126*t1225+0.3207828388384256D0*t534*t1209
      t1255 = t848+t849-t851-t852+t853-0.1538928840745229D2*t442-t856
     #+0.7599149707403056D-1*t567+0.7599149707403056D-1*t571
     #+0.3847322101863073D1*t574+t164*(t1173+t1203)-0.2D1*t1206*t539
     #-0.8806734334819047D-3*t1212*t142+0.8497974591333914D-1*t516
     #*t583+0.2D1*t130*t1218*t1142*t538-0.1D1*t130*t520*t1246*t538
     #-0.321646831778707D2*t130*t1140*t1142*t1144
      t1272 = 1/t156/t148
      s1 = -0.4135669939329333D0/t87*t123-0.24814019635976D1*t84*t509
     #-0.9305257363491D0*t85*(-0.2027281422222222D-1*t1097*t93
     #+0.2050399473777778D-2*t1103*t103-0.2934593729422222D-4*t1107
     #*t111+0.2162145348266667D-6*t1113*t120-0.8546531191466667D-9
     #*t1119*t506+0.1333177002666667D-11*t1126*t1128)-0.6218D-1*t512
     #*t555+0.2D1*t521*t539*t555+0.321646831778707D2*t130*t1140*t1142
     #*t1144*t160+t1255*t265+0.2D1*t1206*t540
      s2 = s1+0.2642020300445714D-2*t516*t556-0.3109D-1*t130*t142*(
     #-0.4699043555555556D1*t1097*t145+0.9896548266666667D1*t1103*t149
     #-0.8995993671111111D1*t1107*t153+0.3938242261333333D1*t1113*t157
     #-0.7838151338666667D0*t1119*t552+0.568705024D-1*t1126*t1272)
     #+0.8806734334819047D-3*t1212*t161
      v2rhob2(i) = s2-0.8497974591333914D-1*t516*t520*t540-0.2D1*t130
     #*t1218*t1142*t538*t160+0.1D1*t521*t1246*t538*t160+2.D0*t586*t598
     #+t240*(0.12976304D0*t1097*t247-0.302662912D-2*t1103*t252
     #+0.16053292032D-3*t705*t1103-0.754465184D-2*t459*t1097
     #-0.3192632064D-5*t710*t1103+0.1754648544D-3*t462*t1097
     #+0.256439568384D-7*t715*t1103-0.18737902656D-5*t465*t1097
     #-0.69681586176D-10*t722*t1103+0.63874787328D-8*t470*t1097)
      t1323 = -t880-t885+t887+0.1923661050931536D1*t892
     #-0.8740794299481065D-3*t895+t898-0.8740794299481065D-3*t901
     #-0.1124999956683108D1*t928-t933-0.1124999956683108D1*t935-t947
     #-t971+t977+t983-t990+t1002+0.1923661050931536D1*t1171
      t1352 = 0.4444444444444444D0*t904*t397*t559+0.2666666666666667D1
     #*t199*t196*t877+0.4444444444444444D0*t915*t401*t562
     #-0.2666666666666667D1*t203*t196*t877
      t1362 = -0.7694644203726145D1*t1184+t1010+t1055
     #+0.7694644203726145D1*t1186-0.1124999956683108D1*t1189
     #+0.3799574853701528D-1*t194*t205*(t1064-t1069)
     #-0.7694644203726145D1*t1061-0.8740794299481065D-3*t1194
     #-0.8740794299481065D-3*t1197-0.1124999956683108D1*t1201
     #+0.3799574853701528D-1*t194*t404*t569+t1075-0.7694644203726145D1
     #*t1076-0.2308393261117844D2*t1078-t1084+0.3799574853701528D-1
     #*t194*t1352*t213+0.3799574853701528D-1*t194*t565*t415
     #+0.1923661050931536D1*t230*t1352*t211
      t1365 = t849+t848-t851-t852+t568+t572+t853+t575-t856+t407+t418
     #+t441+t164*(t1323+t1362)
      t1375 = t271*sigmabb*t479
      v2rhoab(i) = t1365*t265+t455*t598+t586*t473+t240*(
     #-0.302662912D-2*t272*t252*sigmabb*t479+0.16053292032D-3*t705
     #*sigmaaa*t1375-0.3192632064D-5*t710*sigmaaa*t1375
     #+0.256439568384D-7*t715*sigmaaa*t1375-0.69681586176D-10*t722
     #*sigmaaa*t1375)
      t1393 = sigmaaa*t277
      t1396 = t16*t282
      t1399 = t26*t288
      t1402 = t34*t295
      t1407 = t292/t755/rhoa
      s1 = -0.12407009817988D1*t4*t617-0.9305257363491D0*t5*
     #(0.5528949333333333D-2*t271*t13-0.6509865386666667D-3*t1393*t23
     #+0.1006147720533333D-4*t1396*t31-0.7671789568D-7*t1399*t40
     #+0.31112101888D-9*t1402*t298-0.499941376D-12*t1407*t760)
     #-0.3109D-1*t304*t630+0.1321010150222857D-2*t308*t631
      v2rhoasigmaaa(i) = s1+0.1D1*t313*t331*t630-0.3109D-1*t50*t62*
     #(0.1281557333333333D1*t271*t65-0.3165696D1*t1393*t69
     #+0.3063317546666667D1*t1396*t73-0.1392793472D1*t1399*t77
     #+0.2859332608D0*t1402*t344-0.213264384D-1*t1407*t841)+t455*t644
     #+t240*(-0.3538992D-1*t271*t247+0.113498592D-2*t1393*t252
     #-0.6019984512D-4*t705*t1393+0.205763232D-2*t459*t271
     #+0.1197237024D-5*t710*t1393-0.478540512D-4*t462*t271
     #-0.96164838144D-8*t715*t1393+0.5110337088D-6*t465*t271
     #+0.26130594816D-10*t722*t1393-0.17420396544D-8*t470*t271)
      v2rhoasigmaab(i) = 0.D0
      t1463 = t272*t89
      v2rhoasigmabb(i) = t455*t690+t240*(0.113498592D-2*t272*t252*t89
     #-0.6019984512D-4*t705*t1463+0.1197237024D-5*t710*t1463
     #-0.96164838144D-8*t715*t1463+0.26130594816D-10*t722*t1463)
      t1475 = t252*t9
      t1478 = t480*t9
      v2rhobsigmaaa(i) = t586*t644+t240*(0.113498592D-2*t480*t1475
     #-0.6019984512D-4*t705*t1478+0.1197237024D-5*t710*t1478
     #-0.96164838144D-8*t715*t1478+0.26130594816D-10*t722*t1478)
      v2rhobsigmaab(i) = 0.D0
      t1493 = sigmabb*t485
      t1496 = t96*t490
      t1499 = t106*t496
      t1502 = t114*t503
      t1507 = t500/t1123/rhob
      s1 = -0.12407009817988D1*t84*t663-0.9305257363491D0*t85*
     #(0.5528949333333333D-2*t479*t93-0.6509865386666667D-3*t1493*t103
     #+0.1006147720533333D-4*t1496*t111-0.7671789568D-7*t1499*t120
     #+0.31112101888D-9*t1502*t506-0.499941376D-12*t1507*t1128)
     #-0.3109D-1*t512*t676+0.1321010150222857D-2*t516*t677
      v2rhobsigmabb(i) = s1+0.1D1*t521*t539*t676-0.3109D-1*t130*t142*
     #(0.1281557333333333D1*t479*t145-0.3165696D1*t1493*t149
     #+0.3063317546666667D1*t1496*t153-0.1392793472D1*t1499*t157
     #+0.2859332608D0*t1502*t552-0.213264384D-1*t1507*t1272)+t586*t690
     #+t240*(-0.3538992D-1*t479*t247+0.113498592D-2*t1493*t252
     #-0.6019984512D-4*t705*t1493+0.205763232D-2*t459*t479
     #+0.1197237024D-5*t710*t1493-0.478540512D-4*t462*t479
     #-0.96164838144D-8*t715*t1493+0.5110337088D-6*t465*t479
     #+0.26130594816D-10*t722*t1493-0.17420396544D-8*t470*t479)
      t1561 = sigmaaa*t28
      t1564 = t16*t37
      t1567 = t26*t613
      t1571 = t34/t755
      v2sigmaaa2(i) = -0.9305257363491D0*t5*(0.126206688D-3*t20*t23
     #-0.2829804672D-5*t1561*t31+0.24406656D-7*t1564*t40
     #-0.10729648128D-9*t1567*t298+0.187478016D-12*t1571*t760)
     #-0.3109D-1*t50*t62*(0.6416264D0*t20*t69-0.838564D0*t1561*t73
     #+0.438250176D0*t1564*t77-0.992275584D-1*t1567*t344+0.79974144D-2
     #*t1571*t841)+t240*(-0.42561972D-3*t20*t252+0.2257494192D-4*t705
     #*t20-0.448963884D-6*t710*t20+0.36061814304D-8*t715*t20
     #-0.9798973056D-11*t722*t20)
      v2sigmaaaab(i) = 0.D0
      t1605 = t9*t89
      v2sigmaaabb(i) = t240*(-0.42561972D-3*t1475*t89+0.2257494192D-4
     #*t705*t1605-0.448963884D-6*t710*t1605+0.36061814304D-8*t715
     #*t1605-0.9798973056D-11*t722*t1605)
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      t1617 = sigmabb*t108
      t1620 = t96*t117
      t1623 = t106*t659
      t1627 = t114/t1123
      v2sigmabb2(i) = -0.9305257363491D0*t85*(0.126206688D-3*t100*t103
     #-0.2829804672D-5*t1617*t111+0.24406656D-7*t1620*t120
     #-0.10729648128D-9*t1623*t506+0.187478016D-12*t1627*t1128)
     #-0.3109D-1*t130*t142*(0.6416264D0*t100*t149-0.838564D0*t1617
     #*t153+0.438250176D0*t1620*t157-0.992275584D-1*t1623*t552
     #+0.79974144D-2*t1627*t1272)+t240*(-0.42561972D-3*t100*t252
     #+0.2257494192D-4*t705*t100-0.448963884D-6*t710*t100
     #+0.36061814304D-8*t715*t100-0.9798973056D-11*t722*t100)
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      v2rhob2(i) = 0.0d0
      v2rhoab(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2rhoasigmaab(i) = 0.0d0
      v2rhoasigmabb(i) = 0.0d0
      v2rhobsigmaaa(i) = 0.0d0
      v2rhobsigmaab(i) = 0.0d0
      v2rhobsigmabb(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      v2sigmaab2(i) = 0.0d0
      v2sigmabb2(i) = 0.0d0
      v2sigmaaaab(i) = 0.0d0
      v2sigmaaabb(i) = 0.0d0
      v2sigmaabbb(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end
      
      
      subroutine rks_xc_hcth407
     & (ideriv,npt,rhoa1,sigmaaa1,
     &  zk,vrhoa,vsigmaaa,
     &  v2rhoa2,v2rhoasigmaaa,v2sigmaaa2)
c
c     A.D. Boese, N.C. Handy
c     A new parametriztion of exchange-correlation generalized gradient
c     approximation functionals
c     J. Chem. Phys. 114 (2001) 5497-5503.
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt)
      REAL sigmaaa1(npt)
      REAL zk(npt),vrhoa(npt),vsigmaaa(npt)
      REAL v2rhoa2(npt),v2rhoasigmaaa(npt),v2sigmaaa2(npt)
      parameter(tol=1.0d-20)
      
      if(ideriv.eq.0) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t4 = rho**2
      t5 = t2**2
      t8 = sigma/t5/t4
      t10 = 1.D0+0.6349604207872798D-2*t8
      t14 = sigma**2
      t15 = t4**2
      t19 = t14/t2/t15/rho
      t20 = t10**2
      t25 = t15**2
      t27 = t14*sigma/t25
      t32 = t14**2
      t36 = t32/t5/t25/t4
      t37 = t20**2
      t44 = 1/rho
      t45 = t44**(1.D0/3.D0)
      t48 = rho*(1.D0+0.1606016560364007D0*t45)
      t49 = t44**(1.D0/6.D0)
      t52 = dsqrt(t44)
      t54 = t45**2
      t60 = dlog(1.D0+0.321646831778707D2/(0.1248219874679732D2*t49
     #+0.4844076716063854D1*t45+0.2326004811900819D1*t52
     #+0.3819082618690966D0*t54))
      t62 = 1.D0+0.3174802103936399D0*t8
      t66 = t62**2
      t74 = t66**2
      t93 = dlog(1.D0+0.160818243221511D2/(0.598255043577108D1*t49
     #+0.2225569421150687D1*t45+0.8004286349993634D0*t52
     #+0.1897004325747559D0*t54))
      t100 = 1.D0+0.9524406311809197D-2*t8
      t104 = t100**2
      t112 = t104**2
      zk(i) = -0.7385587663820224D0*t2*rho*(0.108184D1
     #-0.3291247495504578D-2*t8/t10+0.138112343902108D-3*t19/t20
     #-0.67302656D-6*t27/t20/t10+0.3720034997741387D-8*t36/t37)
     #-0.3109D-1*t48*t60*(0.118777D1-0.7628795471590852D0*t8/t62
     #+0.5661994483911968D0*t19/t66-0.29373536D0*t27/t66/t62
     #+0.6347552015792813D-1*t36/t74)+(-0.62182D-1*rho*(1.D0
     #+0.1325688999052018D0*t45)*t93+0.3109D-1*t48*t60)*(0.589076D0
     #+0.4213349717780282D-1*t8/t100-0.1743692431454588D-2*t19/t104
     #+0.367822944D-4*t27/t104/t100-0.3456644474956098D-6*t36/t112)
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t3 = t2*rho
      t4 = rho**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigma*t7
      t10 = 1.D0+0.6349604207872798D-2*t8
      t11 = 1/t10
      t14 = sigma**2
      t15 = t4**2
      t16 = t15*rho
      t18 = 1/t2/t16
      t19 = t14*t18
      t20 = t10**2
      t21 = 1/t20
      t24 = t14*sigma
      t25 = t15**2
      t26 = 1/t25
      t27 = t24*t26
      t29 = 1/t20/t10
      t32 = t14**2
      t35 = 1/t5/t25/t4
      t36 = t32*t35
      t37 = t20**2
      t38 = 1/t37
      t41 = 0.108184D1-0.3291247495504578D-2*t8*t11
     #+0.138112343902108D-3*t19*t21-0.67302656D-6*t27*t29
     #+0.3720034997741387D-8*t36*t38
      t44 = 1/rho
      t45 = t44**(1.D0/3.D0)
      t47 = 1.D0+0.1606016560364007D0*t45
      t48 = rho*t47
      t49 = t44**(1.D0/6.D0)
      t52 = dsqrt(t44)
      t54 = t45**2
      t56 = 0.1248219874679732D2*t49+0.4844076716063854D1*t45
     #+0.2326004811900819D1*t52+0.3819082618690966D0*t54
      t59 = 1.D0+0.321646831778707D2/t56
      t60 = dlog(t59)
      t62 = 1.D0+0.3174802103936399D0*t8
      t63 = 1/t62
      t66 = t62**2
      t67 = 1/t66
      t71 = 1/t66/t62
      t74 = t66**2
      t75 = 1/t74
      t78 = 0.118777D1-0.7628795471590852D0*t8*t63
     #+0.5661994483911968D0*t19*t67-0.29373536D0*t27*t71
     #+0.6347552015792813D-1*t36*t75
      t79 = t60*t78
      t83 = 1.D0+0.1325688999052018D0*t45
      t89 = 0.598255043577108D1*t49+0.2225569421150687D1*t45
     #+0.8004286349993634D0*t52+0.1897004325747559D0*t54
      t92 = 1.D0+0.160818243221511D2/t89
      t93 = dlog(t92)
      t98 = -0.62182D-1*rho*t83*t93+0.3109D-1*t48*t60
      t100 = 1.D0+0.9524406311809197D-2*t8
      t101 = 1/t100
      t104 = t100**2
      t105 = 1/t104
      t109 = 1/t104/t100
      t112 = t104**2
      t113 = 1/t112
      t116 = 0.589076D0+0.4213349717780282D-1*t8*t101
     #-0.1743692431454588D-2*t19*t105+0.367822944D-4*t27*t109
     #-0.3456644474956098D-6*t36*t113
      zk(i) = -0.7385587663820224D0*t3*t41-0.3109D-1*t48*t79+t98*t116
      t120 = t4*rho
      t123 = sigma/t5/t120
      t126 = t15*t4
      t129 = t14/t2/t126
      t134 = t24/t25/rho
      t140 = t32/t5/t25/t120
      t147 = t32*sigma/t2/t25/t126
      t149 = 1/t37/t10
      t155 = t47*t60
      t158 = 1/t54
      t159 = t44*t158
      t162 = t56**2
      t163 = 1/t162
      t165 = t49**2
      t166 = t165**2
      t169 = 1/t4
      t170 = 1/t166/t49*t169
      t172 = t158*t169
      t175 = 1/t52*t169
      t178 = 1/t45*t169
      t180 = -0.4160732915599108D1*t170-0.3229384477375903D1*t172
     #-0.2326004811900819D1*t175-0.5092110158254621D0*t178
      t181 = 1/t59
      t195 = 1/t74/t62
      t206 = t89**2
      t238 = 1/t112/t100
      s1 = -0.9847450218426965D0*t2*t41-0.3692793831910112D0*t3*
     #(0.1755331997602442D-1*t123*t11-0.1584654969337721D-2*t129*t21
     #+0.2012265130666667D-4*t134*t29-0.1477359830566614D-6*t140*t38
     #+0.503909330668646D-9*t147*t149)-0.3109D-1*t155*t78
     #+0.1664368495390566D-2*t159*t79
      vrhoa(i) = s1+0.5D0*t48*t163*t180*t181*t78-0.15545D-1*t48*t60*
     #(0.4068690918181788D1*t123*t63-0.7331189631570478D1*t129*t67
     #+0.661717504D1*t134*t71-0.2846227052321425D1*t140*t75
     #+0.4299140585511414D0*t147*t195)+(-0.62182D-1*t83*t93+rho*
     #(0.2747799777968419D-2*t172*t93+0.1D1*t83/t206*(
     #-0.99709173929518D0*t170-0.7418564737168958D0*t172
     #-0.4002143174996817D0*t175-0.1264669550498372D0*t178)/t92)
     #+0.3109D-1*t155-0.1664368495390566D-2*t159*t60-0.5D0*t48*t163
     #*t180*t181)*t116+t98*(-0.1123559924741408D0*t123*t101
     #+0.1036981709164809D-1*t129*t105-0.3828324096D-3*t134*t109
     #+0.6489723575522644D-5*t140*t113-0.351173188852824D-7*t147*t238)
      t245 = sigma*t18
      t248 = t14*t26
      t251 = t24*t35
      t257 = t32/t2/t25/t16
      vsigmaaa(i) = -0.7385587663820224D0*t3*(-0.1316498998201831D-1
     #*t7*t11+0.1188491227003291D-2*t245*t21-0.1509198848D-4*t248*t29
     #+0.110801987292496D-6*t251*t38-0.3779319980014845D-9*t257*t149)
     #-0.3109D-1*t48*t60*(-0.3051518188636341D1*t7*t63
     #+0.5498392223677858D1*t245*t67-0.496288128D1*t248*t71
     #+0.2134670289241069D1*t251*t75-0.3224355439133561D0*t257*t195)
     #+2.D0*t98*(0.8426699435560563D-1*t7*t101-0.7777362818736071D-2
     #*t245*t105+0.2871243072D-3*t248*t109-0.4867292681641983D-5*t251
     #*t113+0.263379891639618D-7*t257*t238)
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t3 = t2*rho
      t4 = rho**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigma*t7
      t10 = 1.D0+0.6349604207872798D-2*t8
      t11 = 1/t10
      t14 = sigma**2
      t15 = t4**2
      t16 = t15*rho
      t18 = 1/t2/t16
      t19 = t14*t18
      t20 = t10**2
      t21 = 1/t20
      t24 = t14*sigma
      t25 = t15**2
      t26 = 1/t25
      t27 = t24*t26
      t29 = 1/t20/t10
      t32 = t14**2
      t33 = t25*t4
      t35 = 1/t5/t33
      t36 = t32*t35
      t37 = t20**2
      t38 = 1/t37
      t41 = 0.108184D1-0.3291247495504578D-2*t8*t11
     #+0.138112343902108D-3*t19*t21-0.67302656D-6*t27*t29
     #+0.3720034997741387D-8*t36*t38
      t44 = 1/rho
      t45 = t44**(1.D0/3.D0)
      t47 = 1.D0+0.1606016560364007D0*t45
      t48 = rho*t47
      t49 = t44**(1.D0/6.D0)
      t52 = dsqrt(t44)
      t54 = t45**2
      t56 = 0.1248219874679732D2*t49+0.4844076716063854D1*t45
     #+0.2326004811900819D1*t52+0.3819082618690966D0*t54
      t59 = 1.D0+0.321646831778707D2/t56
      t60 = dlog(t59)
      t62 = 1.D0+0.3174802103936399D0*t8
      t63 = 1/t62
      t66 = t62**2
      t67 = 1/t66
      t71 = 1/t66/t62
      t74 = t66**2
      t75 = 1/t74
      t78 = 0.118777D1-0.7628795471590852D0*t8*t63
     #+0.5661994483911968D0*t19*t67-0.29373536D0*t27*t71
     #+0.6347552015792813D-1*t36*t75
      t79 = t60*t78
      t83 = 1.D0+0.1325688999052018D0*t45
      t89 = 0.598255043577108D1*t49+0.2225569421150687D1*t45
     #+0.8004286349993634D0*t52+0.1897004325747559D0*t54
      t92 = 1.D0+0.160818243221511D2/t89
      t93 = dlog(t92)
      t98 = -0.62182D-1*rho*t83*t93+0.3109D-1*t48*t60
      t100 = 1.D0+0.9524406311809197D-2*t8
      t101 = 1/t100
      t104 = t100**2
      t105 = 1/t104
      t109 = 1/t104/t100
      t112 = t104**2
      t113 = 1/t112
      t116 = 0.589076D0+0.4213349717780282D-1*t8*t101
     #-0.1743692431454588D-2*t19*t105+0.367822944D-4*t27*t109
     #-0.3456644474956098D-6*t36*t113
      zk(i) = -0.7385587663820224D0*t3*t41-0.3109D-1*t48*t79+t98*t116
      t120 = t4*rho
      t122 = 1/t5/t120
      t123 = sigma*t122
      t126 = t15*t4
      t128 = 1/t2/t126
      t129 = t14*t128
      t133 = 1/t25/rho
      t134 = t24*t133
      t139 = 1/t5/t25/t120
      t140 = t32*t139
      t143 = t32*sigma
      t146 = 1/t2/t25/t126
      t147 = t143*t146
      t149 = 1/t37/t10
      t152 = 0.1755331997602442D-1*t123*t11-0.1584654969337721D-2*t129
     #*t21+0.2012265130666667D-4*t134*t29-0.1477359830566614D-6*t140
     #*t38+0.503909330668646D-9*t147*t149
      t155 = t47*t60
      t158 = 1/t54
      t159 = t44*t158
      t162 = t56**2
      t163 = 1/t162
      t164 = t48*t163
      t165 = t49**2
      t166 = t165**2
      t167 = t166*t49
      t168 = 1/t167
      t169 = 1/t4
      t170 = t168*t169
      t172 = t158*t169
      t174 = 1/t52
      t175 = t174*t169
      t177 = 1/t45
      t178 = t177*t169
      t180 = -0.4160732915599108D1*t170-0.3229384477375903D1*t172
     #-0.2326004811900819D1*t175-0.5092110158254621D0*t178
      t181 = 1/t59
      t182 = t180*t181
      t183 = t182*t78
      t195 = 1/t74/t62
      t198 = 0.4068690918181788D1*t123*t63-0.7331189631570478D1*t129
     #*t67+0.661717504D1*t134*t71-0.2846227052321425D1*t140*t75
     #+0.4299140585511414D0*t147*t195
      t199 = t60*t198
      t204 = t172*t93
      t206 = t89**2
      t207 = 1/t206
      t208 = t83*t207
      t213 = -0.99709173929518D0*t170-0.7418564737168958D0*t172
     #-0.4002143174996817D0*t175-0.1264669550498372D0*t178
      t214 = 1/t92
      t216 = t208*t213*t214
      t224 = t163*t180*t181
      t227 = -0.62182D-1*t83*t93+rho*(0.2747799777968419D-2*t204+0.1D1
     #*t216)+0.3109D-1*t155-0.1664368495390566D-2*t159*t60-0.5D0*t48
     #*t224
      t230 = 0.1123559924741408D0*t123*t101
      t232 = 0.1036981709164809D-1*t129*t105
      t234 = 0.3828324096D-3*t134*t109
      t235 = t140*t113
      t238 = 1/t112/t100
      t240 = 0.351173188852824D-7*t147*t238
      t241 = -t230+t232-t234+0.6489723575522644D-5*t235-t240
      vrhoa(i) = -0.9847450218426965D0*t2*t41-0.3692793831910112D0*t3
     #*t152-0.3109D-1*t155*t78+0.1664368495390566D-2*t159*t79+0.5D0
     #*t164*t183-0.15545D-1*t48*t199+t227*t116+t98*t241
      t245 = sigma*t18
      t248 = t14*t26
      t251 = t24*t35
      t256 = 1/t2/t25/t16
      t257 = t32*t256
      t260 = -0.1316498998201831D-1*t7*t11+0.1188491227003291D-2*t245
     #*t21-0.1509198848D-4*t248*t29+0.110801987292496D-6*t251*t38
     #-0.3779319980014845D-9*t257*t149
      t273 = -0.3051518188636341D1*t7*t63+0.5498392223677858D1*t245
     #*t67-0.496288128D1*t248*t71+0.2134670289241069D1*t251*t75
     #-0.3224355439133561D0*t257*t195
      t274 = t60*t273
      t287 = 0.8426699435560563D-1*t7*t101-0.7777362818736071D-2*t245
     #*t105+0.2871243072D-3*t248*t109-0.4867292681641983D-5*t251*t113
     #+0.263379891639618D-7*t257*t238
      vsigmaaa(i) = -0.7385587663820224D0*t3*t260-0.3109D-1*t48*t274
     #+2.D0*t98*t287
      t294 = sigma/t5/t15
      t297 = t15*t120
      t300 = t14/t2/t297
      t301 = t300*t105
      t304 = t24/t33
      t305 = t304*t109
      t310 = t32/t5/t25/t15
      t311 = t310*t113
      t316 = t143/t2/t25/t297
      t317 = t316*t238
      t320 = t25**2
      t323 = t32*t14/t320/t4
      t325 = 1/t112/t104
      t327 = 0.4459621515264D-8*t323*t325
      t330 = t47*t163
      t346 = 1/t37/t20
      t357 = t162**2
      t358 = 1/t357
      t360 = t180**2
      t361 = t59**2
      t362 = 1/t361
      t381 = 1/t74/t66
      t390 = 1/t15
      t391 = 1/t167/t44*t390
      t393 = 1/t120
      t394 = t168*t393
      t397 = 1/t54/t44
      t398 = t397*t390
      t400 = t158*t393
      t404 = 1/t52/t44*t390
      t406 = t174*t393
      t410 = 1/t45/t44*t390
      t412 = t177*t393
      t414 = -0.6934554859331846D1*t391+0.1664293166239643D2*t394
     #-0.4305845969834537D1*t398+0.1291753790950361D2*t400
     #-0.2326004811900819D1*t404+0.9304019247603276D1*t406
     #-0.3394740105503081D0*t410+0.2036844063301848D1*t412
      t419 = t393*t397
      t426 = 1/t162/t56
      t452 = 0.5495599555936838D-2*t204
      t453 = 0.2D1*t216
      t457 = t213**2
      t460 = 0.2D1*t83/t206/t89*t457*t214
      t472 = 0.1D1*t208*(-0.8309097827459833D0*t391
     #+0.199418347859036D1*t394-0.4945709824779306D0*t398
     #+0.1483712947433792D1*t400-0.2001071587498409D0*t404
     #+0.8004286349993634D0*t406-0.4215565168327908D-1*t410
     #+0.2529339100996745D0*t412)*t214
      t473 = t206**2
      t476 = t92**2
      t480 = 0.160818243221511D2*t83/t473*t457/t476
      t482 = 0.1831866518645613D-2*t398*t93
      t484 = 0.5495599555936838D-2*t400*t93
      t495 = dlog(1.D0+0.2960857464321668D2/(0.8157414703487641D1*t49
     #+0.2247591863577616D1*t45+0.4300972471276643D0*t52
     #+0.1911512595127338D0*t54))
      t497 = (1.D0+0.6901399211255825D-1*t45)*t495*t169
      t502 = 0.8837926660346786D-1*t172*t207*t213*t214
      s1 = 3.D0*t227*t241+t98*(0.8239439448103662D0*t294*t101
     #-0.1065518352468551D0*t301+0.537596439552D-2*t305
     #-0.1286791061715555D-3*t311+0.1291426557904201D-5*t317-t327)
     #+0.2D1*t330*t183-0.6218D-1*t155*t198-0.3692793831910112D0*t3*(
     #-0.1287243464908457D0*t294*t11+0.2066673166164795D-1*t300*t21
     #-0.4695349967075556D-3*t304*t29+0.5491506880554649D-5*t310*t38
     #-0.3445745456547828D-7*t316*t149+0.8532332817066667D-10*t323
     #*t346)-0.6564966812284644D0/t5*t41-0.1969490043685393D1*t2*t152
     #+0.1608234158893535D2*t48*t358*t360*t362*t78+0.1D1*t164*t182*t198
      s2 = s1-0.15545D-1*t48*t60*(-0.2983706673333311D2*t294*t63
     #+0.9975095585979163D2*t300*t67-0.1439358987377778D3*t304*t71
     #+0.1000251185367385D3*t310*t75-0.31601445964313D2*t316*t195
     #+0.36397121536D1*t323*t381)+0.5D0*t164*t414*t181*t78
     #+0.2219157993854088D-2*t419*t79-0.1070677706909338D0*t159*t163
     #*t183
      v2rhoa2(i) = s2-0.1D1*t48*t426*t360*t181*t78
     #+0.3328736990781132D-2*t159*t199+(-0.2D1*t330*t182+0.1D1*t48
     #*t426*t360*t181-0.2219157993854088D-2*t419*t60
     #+0.1070677706909338D0*t159*t224-0.1608234158893535D2*t48*t358
     #*t360*t362-0.5D0*t48*t163*t414*t181+t452+t453+rho*(-t460+t472
     #+t480+t482-t484+0.3377399869956914D-1*t497-t502))*t116+(t452
     #+t453+rho*(-t460+t472+t480+t482-t484-0.3377399869956914D-1*t497
     #-t502))*t116+t227*(-t230+t232-t234+0.6489723575522644D-5*t235
     #-t240)+t98*(-0.3050650990810237D-1*t301+0.256852672512D-2*t305
     #-0.8108779995105606D-4*t311+0.1033899552745464D-5*t317-t327)
      t525 = sigma*t128
      t528 = t14*t133
      t531 = t24*t139
      t534 = t32*t146
      t539 = t143/t320/rho
      t572 = t525*t105
      t574 = t528*t109
      t576 = t531*t113
      t578 = t534*t238
      t581 = 0.3344716136448D-8*t539*t325
      s1 = -0.9847450218426965D0*t2*t260-0.3692793831910112D0*t3*
     #(0.7021327990409767D-1*t122*t11-0.1312306629222938D-1*t525*t21
     #+0.3219672705706667D-3*t528*t29-0.3897026185830995D-5*t531*t38
     #+0.2508722692810574D-7*t534*t149-0.63992496128D-10*t539*t346)
     #-0.3109D-1*t155*t273+0.1664368495390566D-2*t159*t274
      v2rhoasigmaaa(i) = s1+0.5D0*t164*t182*t273-0.15545D-1*t48*t60*
     #(0.1627476367272715D2*t122*t63-0.6381643244748801D2*t525*t67
     #+0.9802616149333333D2*t528*t71-0.7074949832407171D2*t531*t75
     #+0.2305621338540804D2*t534*t195-0.27297841152D1*t539*t381)+2.D0
     #*t227*t287+t98*(-0.4494239698965634D0*t122*t101
     #+0.6435915079766915D-1*t572-0.345772468224D-2*t574
     #+0.8677474426538262D-4*t576-0.9158939401002274D-6*t578+t581)+t98
     #*(0.2287988243107678D-1*t572-0.192639504384D-2*t574
     #+0.6081584996329205D-4*t576-0.7754246645590978D-6*t578+t581)
      t592 = sigma*t26
      t595 = t14*t35
      t598 = t24*t256
      t602 = t32/t320
      v2sigmaaa2(i) = -0.7385587663820224D0*t3*(0.508833481115887D-2
     #*t18*t21-0.181107499008D-3*t592*t29+0.2479561690203262D-5*t595
     #*t38-0.1730369220407337D-7*t598*t149+0.47994372096D-10*t602*t346
     #)-0.3109D-1*t48*t60*(0.2586875544090457D2*t18*t67-0.53668096D2
     #*t592*t71+0.4452344258608951D2*t595*t75-0.160024178634026D2*t598
     #*t195+0.20473380864D1*t602*t381)+4.D0*t98*(
     #-0.1715991182330758D-1*t18*t105+0.144479628288D-2*t592*t109
     #-0.4561188747246904D-4*t595*t113+0.5815684984193233D-6*t598*t238
     #-0.2508537102336D-8*t602*t325)
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end

c:XC_HCTH407subrend
_ENDIF
_IF(ccpdft,all,c_b95)
c:C_B95subrstart

c    Generated: Mon Oct 18 16:01:25 BST 2004

      subroutine uks_c_b95
     & (ideriv,npt,rhoa1,rhob1,sigmaaa1,sigmabb1,sigmaab1,
     &  taua1,taub1,
     &  zk,vrhoa,vrhob,vsigmaaa,vsigmabb,vsigmaab,
     &  vtaua,vtaub,
     &  v2rhoa2,v2rhob2,v2rhoab,
     &  v2rhoasigmaaa,v2rhoasigmaab,v2rhoasigmabb,
     &  v2rhobsigmabb,v2rhobsigmaab,v2rhobsigmaaa,
     &  v2sigmaaa2,v2sigmaaaab,v2sigmaaabb,
     &  v2sigmaab2,v2sigmaabbb,v2sigmabb2,
     &  v2rhoataua,v2rhoataub,v2rhobtaua,v2rhobtaub,
     &  v2sigmaaataua,v2sigmaaataub,
     &  v2sigmaabtaua,v2sigmaabtaub,
     &  v2sigmabbtaua,v2sigmabbtaub,
     &  v2taua2,v2taub2,v2tauab)
c
c     A.D. Becke
c     Density-functional thermochemistry. IV.
c     A new dynamical correlation functional and implications
c     for exact-exchange mixing
c     J. Chem. Phys. 104 (1996) 1040-1046
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt),rhob1(npt)
      REAL sigmaaa1(npt),sigmabb1(npt),sigmaab1(npt)
      REAL taua1(npt),taub1(npt)
      REAL zk(npt),vrhoa(npt),vrhob(npt)
      REAL vsigmaaa(npt),vsigmabb(npt),vsigmaab(npt)
      REAL vtaua(npt),vtaub(npt)
      REAL v2rhoa2(npt),v2rhob2(npt),v2rhoab(npt)
      REAL v2rhoasigmaaa(npt),v2rhoasigmaab(npt)
      REAL v2rhoasigmabb(npt),v2rhobsigmabb(npt)
      REAL v2rhobsigmaab(npt),v2rhobsigmaaa(npt)
      REAL v2sigmaaa2(npt),v2sigmaaaab(npt),v2sigmaaabb(npt)
      REAL v2sigmaab2(npt),v2sigmaabbb(npt),v2sigmabb2(npt)
      REAL v2rhoataua(npt),v2rhoataub(npt)
      REAL v2rhobtaua(npt),v2rhobtaub(npt)
      REAL v2sigmaaataua(npt),v2sigmaaataub(npt)
      REAL v2sigmaabtaua(npt),v2sigmaabtaub(npt)
      REAL v2sigmabbtaua(npt),v2sigmabbtaub(npt)
      REAL v2taua2(npt),v2taub2(npt),v2tauab(npt)
      parameter(tol=1.0d-20)
      
      if (ideriv.eq.0) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      taub = dmax1(0.D0,taub1(i))
      tau = taub
      t3 = rhob**2
      t4 = rhob**(1.D0/3.D0)
      t5 = t4**2
      t11 = (1.D0+0.38D-1*sigmabb/t5/t3)**2
      t13 = 1/rhob
      t19 = t13**(1.D0/3.D0)
      t23 = t13**(1.D0/6.D0)
      t26 = dsqrt(t13)
      t28 = t19**2
      t34 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t23
     #+0.3844746237447211D1*t19+0.1644733775567609D1*t26
     #+0.2405871291288192D0*t28))
      zk(i) = -0.3410636806218528D-2/t11*(taub-0.25D0*sigmabb*t13)/t5*
     #(1.D0+0.1274696188700087D0*t19)*t34
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      taua = dmax1(0.D0,taua1(i))
      tau = taua
      t3 = rhoa**2
      t4 = rhoa**(1.D0/3.D0)
      t5 = t4**2
      t11 = (1.D0+0.38D-1*sigmaaa/t5/t3)**2
      t13 = 1/rhoa
      t19 = t13**(1.D0/3.D0)
      t23 = t13**(1.D0/6.D0)
      t26 = dsqrt(t13)
      t28 = t19**2
      t34 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t23
     #+0.3844746237447211D1*t19+0.1644733775567609D1*t26
     #+0.2405871291288192D0*t28))
      zk(i) = -0.3410636806218528D-2/t11*(taua-0.25D0*sigmaaa*t13)/t5*
     #(1.D0+0.1274696188700087D0*t19)*t34
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      taua = dmax1(0.D0,taua1(i))
      taub = dmax1(0.D0,taub1(i))
      tau = taua+taub
      t6 = rhoa**2
      t7 = rhoa**(1.D0/3.D0)
      t8 = t7**2
      t11 = sigmaaa/t8/t6
      t14 = (1.D0+0.38D-1*t11)**2
      t16 = 1/rhoa
      t22 = t16**(1.D0/3.D0)
      t24 = 1.D0+0.1274696188700087D0*t22
      t26 = t16**(1.D0/6.D0)
      t29 = dsqrt(t16)
      t31 = t22**2
      t37 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t26
     #+0.3844746237447211D1*t22+0.1644733775567609D1*t29
     #+0.2405871291288192D0*t31))
      t41 = rhob**2
      t42 = rhob**(1.D0/3.D0)
      t43 = t42**2
      t46 = sigmabb/t43/t41
      t49 = (1.D0+0.38D-1*t46)**2
      t51 = 1/rhob
      t57 = t51**(1.D0/3.D0)
      t59 = 1.D0+0.1274696188700087D0*t57
      t61 = t51**(1.D0/6.D0)
      t64 = dsqrt(t51)
      t66 = t57**2
      t72 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t61
     #+0.3844746237447211D1*t57+0.1644733775567609D1*t64
     #+0.2405871291288192D0*t66))
      t80 = rhoa+rhob
      t81 = 1/t80
      t82 = t81**(1.D0/3.D0)
      t85 = t81**(1.D0/6.D0)
      t88 = dsqrt(t81)
      t90 = t82**2
      t96 = dlog(1.D0+0.160818243221511D2/(0.598255043577108D1*t85
     #+0.2225569421150687D1*t82+0.8004286349993634D0*t88
     #+0.1897004325747559D0*t90))
      t98 = 0.62182D-1*(1.D0+0.1325688999052018D0*t82)*t96
      t109 = dlog(1.D0+0.2960857464321668D2/(0.8157414703487641D1*t85
     #+0.2247591863577616D1*t82+0.4300972471276643D0*t88
     #+0.1911512595127338D0*t90))
      t112 = rhoa-1.D0*rhob
      t113 = t112*t81
      t114 = 1.D0+t113
      t115 = t114**(1.D0/3.D0)
      t118 = 1.D0-1.D0*t113
      t119 = t118**(1.D0/3.D0)
      t121 = t115*t114+t119*t118-2.D0
      t122 = t112**2
      t123 = t122**2
      t124 = t80**2
      t125 = t124**2
      t127 = t123/t125
      t143 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t85
     #+0.3844746237447211D1*t82+0.1644733775567609D1*t88
     #+0.2405871291288192D0*t90))
      zk(i) = -0.3410636806218528D-2/t14*(taua-0.25D0*sigmaaa*t16)/t8
     #*t24*t37-0.3410636806218528D-2/t49*(taub-0.25D0*sigmabb*t51)/t43
     #*t59*t72+1/(1.D0+0.31D-2*t11+0.31D-2*t46)*(t80*(-t98
     #+0.3799574853701528D-1*(1.D0+0.6901399211255825D-1*t82)*t109
     #*t121*(1.D0-1.D0*t127)+0.1923661050931536D1*(-0.3109D-1*(1.D0
     #+0.1274696188700087D0*t82)*t143+t98)*t121*t127)+0.3109D-1*rhoa
     #*t24*t37+0.3109D-1*rhob*t59*t72)
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      taub = dmax1(0.D0,taub1(i))
      tau = taub
      t3 = rhob**2
      t4 = rhob**(1.D0/3.D0)
      t5 = t4**2
      t7 = 1/t5/t3
      t10 = 1.D0+0.38D-1*sigmabb*t7
      t11 = t10**2
      t12 = 1/t11
      t13 = 1/rhob
      t16 = taub-0.25D0*sigmabb*t13
      t17 = t12*t16
      t18 = 1/t5
      t19 = t13**(1.D0/3.D0)
      t21 = 1.D0+0.1274696188700087D0*t19
      t23 = t13**(1.D0/6.D0)
      t26 = dsqrt(t13)
      t28 = t19**2
      t30 = 0.1112037486309468D2*t23+0.3844746237447211D1*t19
     #+0.1644733775567609D1*t26+0.2405871291288192D0*t28
      t33 = 1.D0+0.321646831778707D2/t30
      t34 = dlog(t33)
      zk(i) = -0.3410636806218528D-2*t17*t18*t21*t34
      vrhoa(i) = 0.D0
      t40 = 1/t11/t10*t16
      t41 = t3**2
      t45 = t21*t34
      t55 = 1/t5/rhob
      t60 = 1/t28
      t66 = t30**2
      t69 = t23**2
      t70 = t69**2
      t73 = 1/t3
      vrhob(i) = -0.6912223927269549D-3*t40/t4/t41*t45*sigmabb
     #-0.8526592015546319D-3*t12*sigmabb*t7*t21*t34
     #+0.2273757870812352D-2*t17*t55*t21*t34+0.1449175245975665D-3*t17
     #*t7*t60*t34+0.1097020523068037D0*t17*t18*t21/t66*(
     #-0.1853395810515781D1/t70/t23*t73-0.128158207914907D1*t60*t73
     #-0.8223668877838045D0/t26*t73-0.1603914194192128D0/t19*t73)/t33
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.2592083972726081D-3*t40/t4/t3/rhob*t21*t34
     #+0.8526592015546319D-3*t12*t55*t45
      vtaub(i) = -0.3410636806218528D-2*t12*t18*t45
      vtaua(i) =  0.0d0
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      taua = dmax1(0.D0,taua1(i))
      tau = taua
      t3 = rhoa**2
      t4 = rhoa**(1.D0/3.D0)
      t5 = t4**2
      t7 = 1/t5/t3
      t10 = 1.D0+0.38D-1*sigmaaa*t7
      t11 = t10**2
      t12 = 1/t11
      t13 = 1/rhoa
      t16 = taua-0.25D0*sigmaaa*t13
      t17 = t12*t16
      t18 = 1/t5
      t19 = t13**(1.D0/3.D0)
      t21 = 1.D0+0.1274696188700087D0*t19
      t23 = t13**(1.D0/6.D0)
      t26 = dsqrt(t13)
      t28 = t19**2
      t30 = 0.1112037486309468D2*t23+0.3844746237447211D1*t19
     #+0.1644733775567609D1*t26+0.2405871291288192D0*t28
      t33 = 1.D0+0.321646831778707D2/t30
      t34 = dlog(t33)
      zk(i) = -0.3410636806218528D-2*t17*t18*t21*t34
      t40 = 1/t11/t10*t16
      t41 = t3**2
      t45 = t21*t34
      t55 = 1/t5/rhoa
      t60 = 1/t28
      t66 = t30**2
      t69 = t23**2
      t70 = t69**2
      t73 = 1/t3
      vrhoa(i) = -0.6912223927269549D-3*t40/t4/t41*t45*sigmaaa
     #-0.8526592015546319D-3*t12*sigmaaa*t7*t21*t34
     #+0.2273757870812352D-2*t17*t55*t21*t34+0.1449175245975665D-3*t17
     #*t7*t60*t34+0.1097020523068037D0*t17*t18*t21/t66*(
     #-0.1853395810515781D1/t70/t23*t73-0.128158207914907D1*t60*t73
     #-0.8223668877838045D0/t26*t73-0.1603914194192128D0/t19*t73)/t33
      vrhob(i) = 0.D0
      vsigmaaa(i) = 0.2592083972726081D-3*t40/t4/t3/rhoa*t21*t34
     #+0.8526592015546319D-3*t12*t55*t45
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      vtaua(i) = -0.3410636806218528D-2*t12*t18*t45
      vtaub(i) = 0.0D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      taua = dmax1(0.D0,taua1(i))
      taub = dmax1(0.D0,taub1(i))
      tau = taua+taub
      t6 = rhoa**2
      t7 = rhoa**(1.D0/3.D0)
      t8 = t7**2
      t10 = 1/t8/t6
      t11 = sigmaaa*t10
      t13 = 1.D0+0.38D-1*t11
      t14 = t13**2
      t15 = 1/t14
      t16 = 1/rhoa
      t19 = taua-0.25D0*sigmaaa*t16
      t20 = t15*t19
      t21 = 1/t8
      t22 = t16**(1.D0/3.D0)
      t24 = 1.D0+0.1274696188700087D0*t22
      t26 = t16**(1.D0/6.D0)
      t29 = dsqrt(t16)
      t31 = t22**2
      t33 = 0.1112037486309468D2*t26+0.3844746237447211D1*t22
     #+0.1644733775567609D1*t29+0.2405871291288192D0*t31
      t36 = 1.D0+0.321646831778707D2/t33
      t37 = dlog(t36)
      t41 = rhob**2
      t42 = rhob**(1.D0/3.D0)
      t43 = t42**2
      t45 = 1/t43/t41
      t46 = sigmabb*t45
      t48 = 1.D0+0.38D-1*t46
      t49 = t48**2
      t50 = 1/t49
      t51 = 1/rhob
      t54 = taub-0.25D0*sigmabb*t51
      t55 = t50*t54
      t56 = 1/t43
      t57 = t51**(1.D0/3.D0)
      t59 = 1.D0+0.1274696188700087D0*t57
      t61 = t51**(1.D0/6.D0)
      t64 = dsqrt(t51)
      t66 = t57**2
      t68 = 0.1112037486309468D2*t61+0.3844746237447211D1*t57
     #+0.1644733775567609D1*t64+0.2405871291288192D0*t66
      t71 = 1.D0+0.321646831778707D2/t68
      t72 = dlog(t71)
      t78 = 1.D0+0.31D-2*t11+0.31D-2*t46
      t79 = 1/t78
      t80 = rhoa+rhob
      t81 = 1/t80
      t82 = t81**(1.D0/3.D0)
      t84 = 1.D0+0.1325688999052018D0*t82
      t85 = t81**(1.D0/6.D0)
      t88 = dsqrt(t81)
      t90 = t82**2
      t92 = 0.598255043577108D1*t85+0.2225569421150687D1*t82
     #+0.8004286349993634D0*t88+0.1897004325747559D0*t90
      t95 = 1.D0+0.160818243221511D2/t92
      t96 = dlog(t95)
      t98 = 0.62182D-1*t84*t96
      t100 = 1.D0+0.6901399211255825D-1*t82
      t105 = 0.8157414703487641D1*t85+0.2247591863577616D1*t82
     #+0.4300972471276643D0*t88+0.1911512595127338D0*t90
      t108 = 1.D0+0.2960857464321668D2/t105
      t109 = dlog(t108)
      t110 = t100*t109
      t112 = rhoa-1.D0*rhob
      t113 = t112*t81
      t114 = 1.D0+t113
      t115 = t114**(1.D0/3.D0)
      t118 = 1.D0-1.D0*t113
      t119 = t118**(1.D0/3.D0)
      t121 = t115*t114+t119*t118-2.D0
      t122 = t112**2
      t123 = t122**2
      t124 = t80**2
      t125 = t124**2
      t126 = 1/t125
      t127 = t123*t126
      t129 = 1.D0-1.D0*t127
      t132 = 0.3799574853701528D-1*t110*t121*t129
      t134 = 1.D0+0.1274696188700087D0*t82
      t139 = 0.1112037486309468D2*t85+0.3844746237447211D1*t82
     #+0.1644733775567609D1*t88+0.2405871291288192D0*t90
      t142 = 1.D0+0.321646831778707D2/t139
      t143 = dlog(t142)
      t146 = -0.3109D-1*t134*t143+t98
      t147 = t146*t121
      t149 = 0.1923661050931536D1*t147*t127
      t152 = rhoa*t24
      t155 = rhob*t59
      t158 = t80*(-t98+t132+t149)+0.3109D-1*t152*t37+0.3109D-1*t155*t72
      zk(i) = -0.3410636806218528D-2*t20*t21*t24*t37
     #-0.3410636806218528D-2*t55*t56*t59*t72+t79*t158
      t162 = 1/t14/t13*t19
      t163 = t6**2
      t167 = t24*t37
      t177 = 1/t8/rhoa
      t182 = 1/t31
      t188 = t33**2
      t189 = 1/t188
      t191 = t26**2
      t192 = t191**2
      t195 = 1/t6
      t206 = -0.1853395810515781D1/t192/t26*t195-0.128158207914907D1
     #*t182*t195-0.8223668877838045D0/t29*t195-0.1603914194192128D0
     #/t22*t195
      t207 = 1/t36
      t212 = t78**2
      t214 = 1/t212*t158
      t215 = t6*rhoa
      t222 = 1/t124
      t223 = 1/t90*t222
      t224 = t223*t96
      t225 = 0.2747799777968419D-2*t224
      t226 = t92**2
      t229 = t85**2
      t230 = t229**2
      t233 = 1/t230/t85*t222
      t237 = 1/t88*t222
      t240 = 1/t82*t222
      t245 = t84/t226*(-0.99709173929518D0*t233-0.7418564737168958D0
     #*t223-0.4002143174996817D0*t237-0.1264669550498372D0*t240)/t95
      t246 = 0.1D1*t245
      t250 = 0.8740794299481065D-3*t223*t109*t121*t129
      t251 = t105**2
      t264 = 0.1124999956683108D1*t100/t251*(-0.135956911724794D1*t233
     #-0.7491972878592054D0*t223-0.2150486235638321D0*t237
     #-0.1274341730084892D0*t240)/t108*t121*t129
      t265 = t112*t222
      t266 = 1.D0*t265
      t270 = 1.D0*t81
      t274 = 0.1333333333333333D1*t115*(t81-t266)+0.1333333333333333D1
     #*t119*(-t270+t265)
      t279 = t122*t112*t126
      t280 = 4.D0*t279
      t283 = t123/t125/t80
      t284 = 4.D0*t283
      t291 = t139**2
      t308 = 0.1923661050931536D1*(0.1321010150222857D-2*t223*t143
     #+0.1D1*t134/t291*(-0.1853395810515781D1*t233-0.128158207914907D1
     #*t223-0.8223668877838045D0*t237-0.1603914194192128D0*t240)/t142
     #-0.2747799777968419D-2*t224-0.1D1*t245)*t121*t127
      t312 = t147*t279
      t315 = 0.7694644203726145D1*t147*t283
      vrhoa(i) = -0.6912223927269549D-3*t162/t7/t163*t167*sigmaaa
     #-0.8526592015546319D-3*t15*sigmaaa*t10*t24*t37
     #+0.2273757870812352D-2*t20*t177*t24*t37+0.1449175245975665D-3
     #*t20*t10*t182*t37+0.1097020523068037D0*t20*t21*t24*t189*t206
     #*t207+0.8266666666666667D-2*t214*sigmaaa/t8/t215+t79*(-t98+t132
     #+t149+t80*(t225+t246-t250-t264+0.3799574853701528D-1*t110*t274
     #*t129+0.3799574853701528D-1*t110*t121*(-t280+t284)+t308
     #+0.1923661050931536D1*t146*t274*t127+0.7694644203726145D1*t312
     #-t315)+0.3109D-1*t167-0.1321010150222857D-2*t16*t182*t37-0.1D1
     #*t152*t189*t206*t207)
      t330 = 1/t49/t48*t54
      t331 = t41**2
      t335 = t59*t72
      t345 = 1/t43/rhob
      t350 = 1/t66
      t356 = t68**2
      t357 = 1/t356
      t359 = t61**2
      t360 = t359**2
      t363 = 1/t41
      t374 = -0.1853395810515781D1/t360/t61*t363-0.128158207914907D1
     #*t350*t363-0.8223668877838045D0/t64*t363-0.1603914194192128D0
     #/t57*t363
      t375 = 1/t71
      t380 = t41*rhob
      t392 = 0.1333333333333333D1*t115*(-t270-t266)
     #+0.1333333333333333D1*t119*(t81+t265)
      vrhob(i) = -0.6912223927269549D-3*t330/t42/t331*t335*sigmabb
     #-0.8526592015546319D-3*t50*sigmabb*t45*t59*t72
     #+0.2273757870812352D-2*t55*t345*t59*t72+0.1449175245975665D-3
     #*t55*t45*t350*t72+0.1097020523068037D0*t55*t56*t59*t357*t374
     #*t375+0.8266666666666667D-2*t214*sigmabb/t43/t380+t79*(-t98+t132
     #+t149+t80*(t225+t246-t250-t264+0.3799574853701528D-1*t110*t392
     #*t129+0.3799574853701528D-1*t110*t121*(t280+t284)+t308
     #+0.1923661050931536D1*t146*t392*t127-0.7694644203726145D1*t312
     #-t315)+0.3109D-1*t335-0.1321010150222857D-2*t51*t350*t72-0.1D1
     #*t155*t357*t374*t375)
      vsigmaaa(i) = 0.2592083972726081D-3*t162/t7/t215*t24*t37
     #+0.8526592015546319D-3*t15*t177*t167-0.31D-2*t214*t10
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.2592083972726081D-3*t330/t42/t380*t59*t72
     #+0.8526592015546319D-3*t50*t345*t335-0.31D-2*t214*t45
      vtaua(i) = -0.3410636806218528D-2*t15*t21*t167
      vtaub(i) = -0.3410636806218528D-2*t50*t56*t335
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      vtaua(i) = 0.0d0
      vtaub(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      taub = dmax1(0.D0,taub1(i))
      tau = taub
      t3 = rhob**2
      t4 = rhob**(1.D0/3.D0)
      t5 = t4**2
      t7 = 1/t5/t3
      t10 = 1.D0+0.38D-1*sigmabb*t7
      t11 = t10**2
      t12 = 1/t11
      t13 = 1/rhob
      t16 = taub-0.25D0*sigmabb*t13
      t17 = t12*t16
      t18 = 1/t5
      t19 = t13**(1.D0/3.D0)
      t21 = 1.D0+0.1274696188700087D0*t19
      t23 = t13**(1.D0/6.D0)
      t26 = dsqrt(t13)
      t28 = t19**2
      t30 = 0.1112037486309468D2*t23+0.3844746237447211D1*t19
     #+0.1644733775567609D1*t26+0.2405871291288192D0*t28
      t33 = 1.D0+0.321646831778707D2/t30
      t34 = dlog(t33)
      zk(i) = -0.3410636806218528D-2*t17*t18*t21*t34
      vrhoa(i) = 0.D0
      t39 = 1/t11/t10
      t40 = t39*t16
      t41 = t3**2
      t43 = 1/t4/t41
      t45 = t21*t34
      t46 = t45*sigmabb
      t49 = t12*sigmabb
      t51 = t7*t21*t34
      t55 = 1/t5/rhob
      t60 = 1/t28
      t65 = t17*t18
      t66 = t30**2
      t67 = 1/t66
      t68 = t21*t67
      t69 = t23**2
      t70 = t69**2
      t71 = t70*t23
      t72 = 1/t71
      t73 = 1/t3
      t78 = 1/t26
      t81 = 1/t19
      t84 = -0.1853395810515781D1*t72*t73-0.128158207914907D1*t60*t73
     #-0.8223668877838045D0*t78*t73-0.1603914194192128D0*t81*t73
      t85 = 1/t33
      t86 = t84*t85
      t87 = t68*t86
      vrhob(i) = -0.6912223927269549D-3*t40*t43*t46
     #-0.8526592015546319D-3*t49*t51+0.2273757870812352D-2*t17*t55*t21
     #*t34+0.1449175245975665D-3*t17*t7*t60*t34+0.1097020523068037D0
     #*t65*t87
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      t90 = t3*rhob
      t92 = 1/t4/t90
      t98 = t12*t55*t45
      vsigmabb(i) = 0.2592083972726081D-3*t40*t92*t21*t34
     #+0.8526592015546319D-3*t98
      t100 = t12*t18
      vtaub(i) = -0.3410636806218528D-2*t100*t45
      vtaua(i) =  0.0d0
      v2rhoa2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t104 = 1/t5/t41
      t106 = 1/t28/t13
      t117 = 1/t5/t90
      t134 = t11**2
      t136 = 1/t134*t16
      t137 = t41**2
      t140 = sigmabb**2
      t145 = t41*t3
      t147 = 1/t4/t145
      t153 = t60*t34
      t159 = t67*t84
      t174 = t66**2
      t177 = t84**2
      t178 = t33**2
      t186 = 1/t41
      t189 = 1/t90
      s1 = 0.9661168306504433D-4*t17*t104*t106*t34
     #-0.932245253120402D-2*t17*t7*t60*t67*t86-0.4830584153252216D-3
     #*t17*t117*t60*t34-0.1462694030757383D0*t17*t55*t87
     #+0.7245876229878325D-4*t49*t104*t60*t34+0.5485102615340186D-1
     #*t49*t7*t87-0.378959645135392D-2*t17*t51-0.2101316073889943D-3
     #*t136/t137*t45*t140
      v2rhob2(i) = s1-0.3456111963634775D-3*t39*t140*t147*t21*t34
     #+0.5873990330354695D-4*t40*t147*t153*sigmabb
     #+0.4446589853502444D-1*t40*t43*t21*t159*t85*sigmabb
     #+0.284219733851544D-2*t49*t117*t21*t34+0.3456111963634775D-2*t40
     #/t4/t41/rhob*t46+0.3528531756410541D1*t65*t21/t174*t177/t178
     #+0.1097020523068037D0*t65*t68*(-0.1544496508763151D1/t71/t13
     #*t186+0.3706791621031562D1*t72*t189-0.854388052766047D0*t106
     #*t186+0.2563164158298141D1*t60*t189-0.4111834438919023D0/t26/t13
     #*t186+0.1644733775567609D1*t78*t189-0.5346380647307093D-1/t19
     #/t13*t186+0.3207828388384256D0*t81*t189)*t85
     #-0.2194041046136074D0*t65*t21/t66/t30*t177*t85
      v2sigmaaa2(i) = 0.D0
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      t225 = t39*t43
      v2sigmabb2(i) = -0.2954975728907732D-4*t136/t145*t21*t34
     #-0.129604198636304D-3*t225*t45
      v2taua2(i) = 0.D0
      v2taub2(i) = 0.D0
      v2tauab(i) = 0.D0
      v2rhoataua(i) = 0.D0
      v2rhoataub(i) = 0.D0
      v2rhobtaua(i) = 0.D0
      v2rhobtaub(i) = -0.6912223927269549D-3*t225*t46
     #+0.2273757870812352D-2*t98+0.1449175245975665D-3*t12*t7*t153
     #+0.1097020523068037D0*t100*t21*t159*t85
      v2sigmaaataua(i) = 0.D0
      v2sigmaaataub(i) = 0.D0
      v2sigmaabtaua(i) = 0.D0
      v2sigmaabtaub(i) = 0.D0
      v2sigmabbtaua(i) = 0.D0
      v2sigmabbtaub(i) = 0.2592083972726081D-3*t39*t92*t45
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      taua = dmax1(0.D0,taua1(i))
      tau = taua
      t3 = rhoa**2
      t4 = rhoa**(1.D0/3.D0)
      t5 = t4**2
      t7 = 1/t5/t3
      t10 = 1.D0+0.38D-1*sigmaaa*t7
      t11 = t10**2
      t12 = 1/t11
      t13 = 1/rhoa
      t16 = taua-0.25D0*sigmaaa*t13
      t17 = t12*t16
      t18 = 1/t5
      t19 = t13**(1.D0/3.D0)
      t21 = 1.D0+0.1274696188700087D0*t19
      t23 = t13**(1.D0/6.D0)
      t26 = dsqrt(t13)
      t28 = t19**2
      t30 = 0.1112037486309468D2*t23+0.3844746237447211D1*t19
     #+0.1644733775567609D1*t26+0.2405871291288192D0*t28
      t33 = 1.D0+0.321646831778707D2/t30
      t34 = dlog(t33)
      zk(i) = -0.3410636806218528D-2*t17*t18*t21*t34
      t39 = 1/t11/t10
      t40 = t39*t16
      t41 = t3**2
      t43 = 1/t4/t41
      t45 = t21*t34
      t46 = t45*sigmaaa
      t49 = t12*sigmaaa
      t51 = t7*t21*t34
      t55 = 1/t5/rhoa
      t60 = 1/t28
      t65 = t17*t18
      t66 = t30**2
      t67 = 1/t66
      t68 = t21*t67
      t69 = t23**2
      t70 = t69**2
      t71 = t70*t23
      t72 = 1/t71
      t73 = 1/t3
      t78 = 1/t26
      t81 = 1/t19
      t84 = -0.1853395810515781D1*t72*t73-0.128158207914907D1*t60*t73
     #-0.8223668877838045D0*t78*t73-0.1603914194192128D0*t81*t73
      t85 = 1/t33
      t86 = t84*t85
      t87 = t68*t86
      vrhoa(i) = -0.6912223927269549D-3*t40*t43*t46
     #-0.8526592015546319D-3*t49*t51+0.2273757870812352D-2*t17*t55*t21
     #*t34+0.1449175245975665D-3*t17*t7*t60*t34+0.1097020523068037D0
     #*t65*t87
      vrhob(i) = 0.D0
      t90 = t3*rhoa
      t92 = 1/t4/t90
      t98 = t12*t55*t45
      vsigmaaa(i) = 0.2592083972726081D-3*t40*t92*t21*t34
     #+0.8526592015546319D-3*t98
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      t100 = t12*t18
      vtaua(i) = -0.3410636806218528D-2*t100*t45
      vtaub(i) = 0.0d0
      t104 = 1/t5/t41
      t114 = sigmaaa**2
      t116 = t41*t3
      t118 = 1/t4/t116
      t124 = t60*t34
      t130 = t67*t84
      t135 = t11**2
      t137 = 1/t135*t16
      t138 = t41**2
      t145 = 1/t5/t90
      t156 = t66**2
      t159 = t84**2
      t160 = t33**2
      t174 = 1/t28/t13
      t186 = 1/t41
      t189 = 1/t90
      s1 = 0.7245876229878325D-4*t49*t104*t60*t34
     #+0.5485102615340186D-1*t49*t7*t87-0.378959645135392D-2*t17*t51
     #-0.3456111963634775D-3*t39*t114*t118*t21*t34
     #+0.5873990330354695D-4*t40*t118*t124*sigmaaa
     #+0.4446589853502444D-1*t40*t43*t21*t130*t85*sigmaaa
     #-0.2101316073889943D-3*t137/t138*t45*t114+0.284219733851544D-2
     #*t49*t145*t21*t34
      v2rhoa2(i) = s1+0.3456111963634775D-2*t40/t4/t41/rhoa*t46
     #+0.3528531756410541D1*t65*t21/t156*t159/t160
     #-0.2194041046136074D0*t65*t21/t66/t30*t159*t85
     #+0.9661168306504433D-4*t17*t104*t174*t34-0.932245253120402D-2
     #*t17*t7*t60*t67*t86+0.1097020523068037D0*t65*t68*(
     #-0.1544496508763151D1/t71/t13*t186+0.3706791621031562D1*t72*t189
     #-0.854388052766047D0*t174*t186+0.2563164158298141D1*t60*t189
     #-0.4111834438919023D0/t26/t13*t186+0.1644733775567609D1*t78*t189
     #-0.5346380647307093D-1/t19/t13*t186+0.3207828388384256D0*t81
     #*t189)*t85-0.1462694030757383D0*t17*t55*t87
     #-0.4830584153252216D-3*t17*t145*t60*t34
      v2rhob2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t225 = t39*t43
      v2sigmaaa2(i) = -0.2954975728907732D-4*t137/t116*t21*t34
     #-0.129604198636304D-3*t225*t45
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      v2sigmabb2(i) = 0.D0
      v2taua2(i) = 0.D0
      v2taub2(i) = 0.D0
      v2tauab(i) = 0.D0
      v2rhoataua(i) = -0.6912223927269549D-3*t225*t46
     #+0.2273757870812352D-2*t98+0.1449175245975665D-3*t12*t7*t124
     #+0.1097020523068037D0*t100*t21*t130*t85
      v2rhoataub(i) = 0.D0
      v2rhobtaua(i) = 0.D0
      v2rhobtaub(i) = 0.D0
      v2sigmaaataua(i) = 0.2592083972726081D-3*t39*t92*t45
      v2sigmaaataub(i) = 0.D0
      v2sigmaabtaua(i) = 0.D0
      v2sigmaabtaub(i) = 0.D0
      v2sigmabbtaua(i) = 0.D0
      v2sigmabbtaub(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      taua = dmax1(0.D0,taua1(i))
      taub = dmax1(0.D0,taub1(i))
      tau = taua+taub
      t6 = rhoa**2
      t7 = rhoa**(1.D0/3.D0)
      t8 = t7**2
      t10 = 1/t8/t6
      t11 = sigmaaa*t10
      t13 = 1.D0+0.38D-1*t11
      t14 = t13**2
      t15 = 1/t14
      t16 = 1/rhoa
      t19 = taua-0.25D0*sigmaaa*t16
      t20 = t15*t19
      t21 = 1/t8
      t22 = t16**(1.D0/3.D0)
      t24 = 1.D0+0.1274696188700087D0*t22
      t26 = t16**(1.D0/6.D0)
      t29 = dsqrt(t16)
      t31 = t22**2
      t33 = 0.1112037486309468D2*t26+0.3844746237447211D1*t22
     #+0.1644733775567609D1*t29+0.2405871291288192D0*t31
      t36 = 1.D0+0.321646831778707D2/t33
      t37 = dlog(t36)
      t41 = rhob**2
      t42 = rhob**(1.D0/3.D0)
      t43 = t42**2
      t45 = 1/t43/t41
      t46 = sigmabb*t45
      t48 = 1.D0+0.38D-1*t46
      t49 = t48**2
      t50 = 1/t49
      t51 = 1/rhob
      t54 = taub-0.25D0*sigmabb*t51
      t55 = t50*t54
      t56 = 1/t43
      t57 = t51**(1.D0/3.D0)
      t59 = 1.D0+0.1274696188700087D0*t57
      t61 = t51**(1.D0/6.D0)
      t64 = dsqrt(t51)
      t66 = t57**2
      t68 = 0.1112037486309468D2*t61+0.3844746237447211D1*t57
     #+0.1644733775567609D1*t64+0.2405871291288192D0*t66
      t71 = 1.D0+0.321646831778707D2/t68
      t72 = dlog(t71)
      t78 = 1.D0+0.31D-2*t11+0.31D-2*t46
      t79 = 1/t78
      t80 = rhoa+rhob
      t81 = 1/t80
      t82 = t81**(1.D0/3.D0)
      t84 = 1.D0+0.1325688999052018D0*t82
      t85 = t81**(1.D0/6.D0)
      t88 = dsqrt(t81)
      t90 = t82**2
      t92 = 0.598255043577108D1*t85+0.2225569421150687D1*t82
     #+0.8004286349993634D0*t88+0.1897004325747559D0*t90
      t95 = 1.D0+0.160818243221511D2/t92
      t96 = dlog(t95)
      t98 = 0.62182D-1*t84*t96
      t100 = 1.D0+0.6901399211255825D-1*t82
      t105 = 0.8157414703487641D1*t85+0.2247591863577616D1*t82
     #+0.4300972471276643D0*t88+0.1911512595127338D0*t90
      t108 = 1.D0+0.2960857464321668D2/t105
      t109 = dlog(t108)
      t110 = t100*t109
      t112 = rhoa-1.D0*rhob
      t113 = t112*t81
      t114 = 1.D0+t113
      t115 = t114**(1.D0/3.D0)
      t118 = 1.D0-1.D0*t113
      t119 = t118**(1.D0/3.D0)
      t121 = t115*t114+t119*t118-2.D0
      t122 = t112**2
      t123 = t122**2
      t124 = t80**2
      t125 = t124**2
      t126 = 1/t125
      t127 = t123*t126
      t129 = 1.D0-1.D0*t127
      t130 = t121*t129
      t132 = 0.3799574853701528D-1*t110*t130
      t134 = 1.D0+0.1274696188700087D0*t82
      t139 = 0.1112037486309468D2*t85+0.3844746237447211D1*t82
     #+0.1644733775567609D1*t88+0.2405871291288192D0*t90
      t142 = 1.D0+0.321646831778707D2/t139
      t143 = dlog(t142)
      t146 = -0.3109D-1*t134*t143+t98
      t147 = t146*t121
      t149 = 0.1923661050931536D1*t147*t127
      t152 = rhoa*t24
      t155 = rhob*t59
      t158 = t80*(-t98+t132+t149)+0.3109D-1*t152*t37+0.3109D-1*t155*t72
      zk(i) = -0.3410636806218528D-2*t20*t21*t24*t37
     #-0.3410636806218528D-2*t55*t56*t59*t72+t79*t158
      t161 = 1/t14/t13
      t162 = t161*t19
      t163 = t6**2
      t165 = 1/t7/t163
      t167 = t24*t37
      t168 = t167*sigmaaa
      t171 = t15*sigmaaa
      t173 = t10*t24*t37
      t177 = 1/t8/rhoa
      t182 = 1/t31
      t187 = t20*t21
      t188 = t33**2
      t189 = 1/t188
      t190 = t24*t189
      t191 = t26**2
      t192 = t191**2
      t193 = t192*t26
      t194 = 1/t193
      t195 = 1/t6
      t200 = 1/t29
      t203 = 1/t22
      t206 = -0.1853395810515781D1*t194*t195-0.128158207914907D1*t182
     #*t195-0.8223668877838045D0*t200*t195-0.1603914194192128D0*t203
     #*t195
      t207 = 1/t36
      t208 = t206*t207
      t209 = t190*t208
      t212 = t78**2
      t213 = 1/t212
      t214 = t213*t158
      t215 = t6*rhoa
      t217 = 1/t8/t215
      t218 = sigmaaa*t217
      t221 = 1/t90
      t222 = 1/t124
      t223 = t221*t222
      t224 = t223*t96
      t225 = 0.2747799777968419D-2*t224
      t226 = t92**2
      t227 = 1/t226
      t228 = t84*t227
      t229 = t85**2
      t230 = t229**2
      t231 = t230*t85
      t232 = 1/t231
      t233 = t232*t222
      t236 = 1/t88
      t237 = t236*t222
      t239 = 1/t82
      t240 = t239*t222
      t242 = -0.99709173929518D0*t233-0.7418564737168958D0*t223
     #-0.4002143174996817D0*t237-0.1264669550498372D0*t240
      t243 = 1/t95
      t245 = t228*t242*t243
      t246 = 0.1D1*t245
      t247 = t109*t121
      t248 = t247*t129
      t249 = t223*t248
      t250 = 0.8740794299481065D-3*t249
      t251 = t105**2
      t252 = 1/t251
      t253 = t100*t252
      t258 = -0.135956911724794D1*t233-0.7491972878592054D0*t223
     #-0.2150486235638321D0*t237-0.1274341730084892D0*t240
      t259 = t253*t258
      t260 = 1/t108
      t261 = t260*t121
      t262 = t261*t129
      t263 = t259*t262
      t264 = 0.1124999956683108D1*t263
      t265 = t112*t222
      t266 = 1.D0*t265
      t267 = t81-t266
      t270 = 1.D0*t81
      t271 = -t270+t265
      t274 = 0.1333333333333333D1*t115*t267+0.1333333333333333D1*t119
     #*t271
      t276 = t110*t274*t129
      t277 = 0.3799574853701528D-1*t276
      t278 = t122*t112
      t279 = t278*t126
      t280 = 4.D0*t279
      t282 = 1/t125/t80
      t283 = t123*t282
      t284 = 4.D0*t283
      t285 = -t280+t284
      t287 = t110*t121*t285
      t288 = 0.3799574853701528D-1*t287
      t291 = t139**2
      t292 = 1/t291
      t293 = t134*t292
      t298 = -0.1853395810515781D1*t233-0.128158207914907D1*t223
     #-0.8223668877838045D0*t237-0.1603914194192128D0*t240
      t299 = 1/t142
      t305 = 0.1321010150222857D-2*t223*t143+0.1D1*t293*t298*t299
     #-0.2747799777968419D-2*t224-0.1D1*t245
      t306 = t305*t121
      t307 = t306*t127
      t308 = 0.1923661050931536D1*t307
      t309 = t146*t274
      t310 = t309*t127
      t311 = 0.1923661050931536D1*t310
      t312 = t147*t279
      t314 = t147*t283
      t315 = 0.7694644203726145D1*t314
      t319 = t16*t182
      t322 = t189*t206
      t323 = t322*t207
      t326 = -t98+t132+t149+t80*(t225+t246-t250-t264+t277+t288+t308
     #+t311+0.7694644203726145D1*t312-t315)+0.3109D-1*t167
     #-0.1321010150222857D-2*t319*t37-0.1D1*t152*t323
      vrhoa(i) = -0.6912223927269549D-3*t162*t165*t168
     #-0.8526592015546319D-3*t171*t173+0.2273757870812352D-2*t20*t177
     #*t24*t37+0.1449175245975665D-3*t20*t10*t182*t37
     #+0.1097020523068037D0*t187*t209+0.8266666666666667D-2*t214*t218
     #+t79*t326
      t329 = 1/t49/t48
      t330 = t329*t54
      t331 = t41**2
      t333 = 1/t42/t331
      t335 = t59*t72
      t336 = t335*sigmabb
      t339 = t50*sigmabb
      t341 = t45*t59*t72
      t345 = 1/t43/rhob
      t350 = 1/t66
      t355 = t55*t56
      t356 = t68**2
      t357 = 1/t356
      t358 = t59*t357
      t359 = t61**2
      t360 = t359**2
      t361 = t360*t61
      t362 = 1/t361
      t363 = 1/t41
      t368 = 1/t64
      t371 = 1/t57
      t374 = -0.1853395810515781D1*t362*t363-0.128158207914907D1*t350
     #*t363-0.8223668877838045D0*t368*t363-0.1603914194192128D0*t371
     #*t363
      t375 = 1/t71
      t376 = t374*t375
      t377 = t358*t376
      t380 = t41*rhob
      t382 = 1/t43/t380
      t383 = sigmabb*t382
      t386 = -t270-t266
      t389 = t81+t265
      t392 = 0.1333333333333333D1*t115*t386+0.1333333333333333D1*t119
     #*t389
      t394 = t110*t392*t129
      t395 = 0.3799574853701528D-1*t394
      t396 = t280+t284
      t398 = t110*t121*t396
      t399 = 0.3799574853701528D-1*t398
      t400 = t146*t392
      t401 = t400*t127
      t402 = 0.1923661050931536D1*t401
      t407 = t51*t350
      t410 = t357*t374
      t411 = t410*t375
      t414 = -t98+t132+t149+t80*(t225+t246-t250-t264+t395+t399+t308
     #+t402-0.7694644203726145D1*t312-t315)+0.3109D-1*t335
     #-0.1321010150222857D-2*t407*t72-0.1D1*t155*t411
      vrhob(i) = -0.6912223927269549D-3*t330*t333*t336
     #-0.8526592015546319D-3*t339*t341+0.2273757870812352D-2*t55*t345
     #*t59*t72+0.1449175245975665D-3*t55*t45*t350*t72
     #+0.1097020523068037D0*t355*t377+0.8266666666666667D-2*t214*t383
     #+t79*t414
      t417 = 1/t7/t215
      t422 = t15*t177
      t423 = t422*t167
      vsigmaaa(i) = 0.2592083972726081D-3*t162*t417*t24*t37
     #+0.8526592015546319D-3*t423-0.31D-2*t214*t10
      vsigmaab(i) = 0.D0
      t428 = 1/t42/t380
      t433 = t50*t345
      t434 = t433*t335
      vsigmabb(i) = 0.2592083972726081D-3*t330*t428*t59*t72
     #+0.8526592015546319D-3*t434-0.31D-2*t214*t45
      t438 = t15*t21
      vtaua(i) = -0.3410636806218528D-2*t438*t167
      t441 = t50*t56
      vtaub(i) = -0.3410636806218528D-2*t441*t335
      t447 = 1/t8/t163
      t455 = t163*t6
      t457 = 1/t7/t455
      t459 = t182*t37
      t463 = t165*t24
      t473 = t14**2
      t475 = 1/t473*t19
      t476 = t163**2
      t479 = sigmaaa**2
      t490 = 1/t7/t163/rhoa
      t494 = t213*t326
      t499 = 1/t163
      t502 = 1/t215
      t506 = 1/t31/t16
      t523 = -0.1544496508763151D1/t193/t16*t499+0.3706791621031562D1
     #*t194*t502-0.854388052766047D0*t506*t499+0.2563164158298141D1
     #*t182*t502-0.4111834438919023D0/t29/t16*t499
     #+0.1644733775567609D1*t200*t502-0.5346380647307093D-1/t22/t16
     #*t499+0.3207828388384256D0*t203*t502
      t538 = 1/t188/t33
      t540 = t206**2
      t555 = 0.3847322101863073D1*t307
      t557 = 0.2249999913366216D1*t263
      t559 = 0.1748158859896213D-2*t249
      t561 = 0.5495599555936838D-2*t224
      t562 = 0.2D1*t245
      t564 = 0.1538928840745229D2*t314
      t565 = t278*t282
      t566 = t147*t565
      t568 = t309*t283
      t572 = t123/t125/t124
      t574 = 0.3847322101863073D2*t147*t572
      t575 = t309*t279
      t577 = t122*t126
      t578 = t147*t577
      t579 = 0.2308393261117844D2*t578
      t580 = t115**2
      t581 = 1/t580
      t582 = t267**2
      t585 = 2.D0*t222
      t587 = 1/t124/t80
      t589 = 2.D0*t112*t587
      t590 = -t585+t589
      t593 = t119**2
      t594 = 1/t593
      t595 = t271**2
      t601 = 0.4444444444444444D0*t581*t582+0.1333333333333333D1*t115
     #*t590+0.4444444444444444D0*t594*t595-0.1333333333333333D1*t119
     #*t590
      t608 = t242**2
      t610 = t84/t226/t92*t608*t243
      t611 = 0.2D1*t610
      t612 = t226**2
      t615 = t95**2
      t618 = t84/t612*t608/t615
      t619 = 0.160818243221511D2*t618
      t620 = t221*t587
      t621 = t620*t96
      t622 = 0.5495599555936838D-2*t621
      t625 = 1/t90/t81*t126
      t626 = t625*t96
      t627 = 0.1831866518645613D-2*t626
      t630 = t223*t227*t242*t243
      t631 = 0.8837926660346786D-1*t630
      t634 = 1/t231/t81*t126
      t636 = t232*t587
      t642 = 1/t88/t81*t126
      t644 = t236*t587
      t648 = 1/t82/t81*t126
      t650 = t239*t587
      t654 = t228*(-0.8309097827459833D0*t634+0.199418347859036D1*t636
     #-0.4945709824779306D0*t625+0.1483712947433792D1*t620
     #-0.2001071587498409D0*t642+0.8004286349993634D0*t644
     #-0.4215565168327908D-1*t648+0.2529339100996745D0*t650)*t243
      t655 = 0.1D1*t654
      t657 = t259*t261*t285
      t660 = 0.1748158859896213D-2*t620*t248
      t661 = -0.6155715362980916D2*t566-0.1538928840745229D2*t568+t574
     #+0.1538928840745229D2*t575+t579+0.1923661050931536D1*t146*t601
     #*t127-t611+t619-t622+t627-t631+t655-0.2249999913366216D1*t657+t660
      t673 = 0.1124999956683108D1*t253*(-0.1132974264373283D1*t634
     #+0.271913823449588D1*t636-0.4994648585728036D0*t625
     #+0.1498394575718411D1*t620-0.1075243117819161D0*t642
     #+0.4300972471276643D0*t644-0.4247805766949639D-1*t648
     #+0.2548683460169784D0*t650)*t262
      t676 = t223*t109*t274*t129
      t682 = 0.5176049209143758D-1*t223*t252*t258*t260*t130
      t684 = 0.5827196199654043D-3*t625*t248
      t687 = t259*t260*t274*t129
      t690 = t223*t247*t285
      t695 = t258**2
      t698 = 0.2249999913366216D1*t100/t251/t105*t695*t262
      t710 = t298**2
      t726 = t291**2
      t729 = t142**2
      t740 = 0.8806734334819047D-3*t625*t143-0.2642020300445714D-2
     #*t620*t143-0.8497974591333914D-1*t223*t292*t298*t299-0.2D1*t134
     #/t291/t139*t710*t299+0.1D1*t293*(-0.1544496508763151D1*t634
     #+0.3706791621031562D1*t636-0.854388052766047D0*t625
     #+0.2563164158298141D1*t620-0.4111834438919023D0*t642
     #+0.1644733775567609D1*t644-0.5346380647307093D-1*t648
     #+0.3207828388384256D0*t650)*t299+0.321646831778707D2*t134/t726
     #*t710/t729-0.1831866518645613D-2*t626+0.5495599555936838D-2*t621
     #+0.8837926660346786D-1*t630+0.2D1*t610-0.1D1*t654
     #-0.160818243221511D2*t618
      t743 = 0.1923661050931536D1*t740*t121*t127
      t750 = t306*t279
      t753 = t305*t274*t127
      t755 = 12.D0*t577
      t756 = 32.D0*t565
      t757 = 20.D0*t572
      t762 = t251**2
      t766 = t108**2
      t771 = 0.3330964519106732D2*t100/t762*t695/t766*t121*t129
      t773 = 0.1538928840745229D2*t306*t283
      t774 = -t673-0.1748158859896213D-2*t676+t682-t684
     #-0.2249999913366216D1*t687-0.1748158859896213D-2*t690+t698+t743
     #+0.3799574853701528D-1*t110*t601*t129+0.7599149707403056D-1*t110
     #*t274*t285+0.1538928840745229D2*t750+0.3847322101863073D1*t753
     #+0.3799574853701528D-1*t110*t121*(-t755+t756-t757)-t771-t773
      t790 = t188**2
      t791 = 1/t790
      t793 = t36**2
      t794 = 1/t793
      t799 = t555+0.3847322101863073D1*t310-t557+0.7599149707403056D-1
     #*t276-t559+0.7599149707403056D-1*t287+t561+t562
     #+0.1538928840745229D2*t312-t564+t80*(t661+t774)
     #-0.8806734334819047D-3*t502*t506*t37+0.8497974591333914D-1*t319
     #*t323+0.2D1*t152*t538*t540*t207-0.1D1*t152*t189*t523*t207
     #-0.321646831778707D2*t152*t791*t540*t794-0.2D1*t209
      t803 = 1/t212/t78*t158
      t804 = t163*t215
      s1 = -0.378959645135392D-2*t20*t173+0.7245876229878325D-4*t171
     #*t447*t182*t37+0.5485102615340186D-1*t171*t10*t209
     #+0.5873990330354695D-4*t162*t457*t459*sigmaaa
     #+0.4446589853502444D-1*t162*t463*t322*t207*sigmaaa
     #+0.284219733851544D-2*t171*t217*t24*t37-0.2101316073889943D-3
     #*t475/t476*t167*t479-0.3456111963634775D-3*t161*t479*t457*t24
     #*t37+0.3456111963634775D-2*t162*t490*t168+0.1653333333333333D-1
     #*t494*t218
      v2rhoa2(i) = s1+0.1097020523068037D0*t187*t190*t523*t207
     #-0.932245253120402D-2*t20*t10*t182*t189*t208
     #+0.9661168306504433D-4*t20*t447*t506*t37-0.2194041046136074D0
     #*t187*t24*t538*t540*t207-0.4830584153252216D-3*t20*t217*t182*t37
     #-0.1462694030757383D0*t20*t177*t209-0.3031111111111111D-1*t214
     #*sigmaaa*t447+t79*t799+0.1366755555555556D-3*t803*t479/t7/t804
     #+0.3528531756410541D1*t187*t24*t791*t540*t794
      t815 = t331*t41
      t817 = 1/t42/t815
      t819 = t350*t72
      t825 = 1/t42/t331/rhob
      t830 = 1/t43/t331
      t841 = t333*t59
      t847 = sigmabb**2
      t859 = 1/t66/t51
      t864 = t356**2
      t865 = 1/t864
      t867 = t374**2
      t868 = t71**2
      t869 = 1/t868
      t876 = 1/t331
      t879 = 1/t380
      t898 = -0.1544496508763151D1/t361/t51*t876+0.3706791621031562D1
     #*t362*t879-0.854388052766047D0*t859*t876+0.2563164158298141D1
     #*t350*t879-0.4111834438919023D0/t64/t51*t876
     #+0.1644733775567609D1*t368*t879-0.5346380647307093D-1/t57/t51
     #*t876+0.3207828388384256D0*t371*t879
      t908 = 1/t356/t68
      t918 = t49**2
      t920 = 1/t918*t54
      t921 = t331**2
      t929 = t331*t380
      t958 = t223*t247*t396
      t962 = t223*t109*t392*t129
      t965 = t259*t261*t396
      t969 = t259*t260*t392*t129
      t974 = t386**2
      t977 = t585+t589
      t980 = t389**2
      t986 = 0.4444444444444444D0*t581*t974+0.1333333333333333D1*t115
     #*t977+0.4444444444444444D0*t594*t980-0.1333333333333333D1*t119
     #*t977
      t994 = t400*t283
      t999 = t400*t279
      t1002 = t305*t392*t127
      t1004 = 0.6155715362980916D2*t566+t574-0.1748158859896213D-2
     #*t958-0.1748158859896213D-2*t962-0.2249999913366216D1*t965
     #-0.2249999913366216D1*t969+0.7599149707403056D-1*t110*t392*t396
     #+t579+0.3799574853701528D-1*t110*t986*t129+0.3799574853701528D-1
     #*t110*t121*(-t755-t756-t757)-0.1538928840745229D2*t994
     #+0.1923661050931536D1*t146*t986*t127-0.1538928840745229D2*t999
     #+0.3847322101863073D1*t1002
      t1006 = -t611+t619-t622+t627-t631+t655+t660-t673+t682-t684+t698
     #+t743-0.1538928840745229D2*t750-t771-t773
      t1013 = t555-0.2D1*t377-0.8806734334819047D-3*t879*t859*t72
     #+0.8497974591333914D-1*t407*t411-0.1D1*t155*t357*t898*t375+0.2D1
     #*t155*t908*t867*t375-0.321646831778707D2*t155*t865*t867*t869
     #-t557+t80*(t1004+t1006)-t559+t561+t562-0.1538928840745229D2*t312
     #-t564+0.7599149707403056D-1*t394+0.7599149707403056D-1*t398
     #+0.3847322101863073D1*t401
      t1015 = t213*t414
      s1 = 0.5873990330354695D-4*t330*t817*t819*sigmabb
     #+0.3456111963634775D-2*t330*t825*t336+0.7245876229878325D-4*t339
     #*t830*t350*t72-0.1462694030757383D0*t55*t345*t377
     #+0.5485102615340186D-1*t339*t45*t377+0.4446589853502444D-1*t330
     #*t841*t410*t375*sigmabb-0.3456111963634775D-3*t329*t847*t817*t59
     #*t72-0.932245253120402D-2*t55*t45*t350*t357*t376
     #+0.9661168306504433D-4*t55*t830*t859*t72+0.3528531756410541D1
     #*t355*t59*t865*t867*t869
      v2rhob2(i) = s1+0.1097020523068037D0*t355*t358*t898*t375
     #-0.4830584153252216D-3*t55*t382*t350*t72-0.2194041046136074D0
     #*t355*t59*t908*t867*t375+0.284219733851544D-2*t339*t382*t59*t72
     #-0.2101316073889943D-3*t920/t921*t335*t847-0.378959645135392D-2
     #*t55*t341+0.1366755555555556D-3*t803*t847/t42/t929
     #-0.3031111111111111D-1*t214*sigmabb*t830+t79*t1013
     #+0.1653333333333333D-1*t1015*t383
      t1037 = -0.7694644203726145D1*t568+t574-0.8740794299481065D-3
     #*t958-0.8740794299481065D-3*t962-0.1124999956683108D1*t965
     #-0.7694644203726145D1*t575-0.1124999956683108D1*t969
     #-0.2308393261117844D2*t578-0.7694644203726145D1*t994
     #+0.7694644203726145D1*t999+0.1923661050931536D1*t1002-t611+t619
     #-t622+t627-t631+t655
      t1055 = 0.4444444444444444D0*t581*t267*t386+0.2666666666666667D1
     #*t115*t112*t587+0.4444444444444444D0*t594*t271*t389
     #-0.2666666666666667D1*t119*t112*t587
      t1072 = -0.1124999956683108D1*t657+t660-t673
     #-0.8740794299481065D-3*t676+t682-t684-0.1124999956683108D1*t687
     #-0.8740794299481065D-3*t690+t698+t743+0.1923661050931536D1*t753
     #-t771+0.3799574853701528D-1*t110*t1055*t129
     #+0.3799574853701528D-1*t110*t274*t396+0.3799574853701528D-1*t110
     #*t121*(t755-t757)+0.3799574853701528D-1*t110*t392*t285
     #+0.1923661050931536D1*t146*t1055*t127-t773
      t1075 = t561+t562-t559-t557+t395+t399+t555+t402-t564+t277+t288
     #+t311+t80*(t1037+t1072)
      v2rhoab(i) = 0.1366755555555556D-3*t803*sigmaaa*t217*sigmabb
     #*t382+0.8266666666666667D-2*t1015*t218+0.8266666666666667D-2
     #*t494*t383+t79*t1075
      t1087 = t15*t10
      v2rhoasigmaaa(i) = 0.7879935277087286D-4*t475/t804*t168
     #+0.2376076974998908D-3*t161*t490*t168-0.8640279909086936D-3*t162
     #*t463*t37-0.142109866925772D-2*t1087*t167-0.1101373186941505D-4
     #*t162*t490*t182*t37-0.3622938114939162D-4*t15*t217*t459
     #-0.8337355975317082D-2*t162*t417*t209-0.2742551307670093D-1*t422
     #*t24*t323-0.5125333333333333D-4*t803*sigmaaa*t457
     #+0.8266666666666667D-2*t214*t217-0.31D-2*t494*t10
      v2rhoasigmaab(i) = 0.D0
      v2rhoasigmabb(i) = -0.5125333333333333D-4*t803*t218*t45-0.31D-2
     #*t494*t45
      v2rhobsigmaaa(i) = -0.5125333333333333D-4*t803*t383*t10-0.31D-2
     #*t1015*t10
      v2rhobsigmaab(i) = 0.D0
      t1130 = t50*t45
      v2rhobsigmabb(i) = 0.7879935277087286D-4*t920/t929*t336
     #+0.2376076974998908D-3*t329*t825*t336-0.8640279909086936D-3*t330
     #*t841*t72-0.142109866925772D-2*t1130*t335-0.1101373186941505D-4
     #*t330*t825*t350*t72-0.3622938114939162D-4*t50*t382*t819
     #-0.8337355975317082D-2*t330*t428*t377-0.2742551307670093D-1*t433
     #*t59*t411-0.5125333333333333D-4*t803*sigmabb*t817
     #+0.8266666666666667D-2*t214*t382-0.31D-2*t1015*t45
      t1158 = t161*t165
      v2sigmaaa2(i) = -0.2954975728907732D-4*t475/t455*t24*t37
     #-0.129604198636304D-3*t1158*t167+0.1922D-4*t803*t490
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.1922D-4*t803*t10*t45
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      t1170 = t329*t333
      v2sigmabb2(i) = -0.2954975728907732D-4*t920/t815*t59*t72
     #-0.129604198636304D-3*t1170*t335+0.1922D-4*t803*t825
      v2taua2(i) = 0.D0
      v2taub2(i) = 0.D0
      v2tauab(i) = 0.D0
      v2rhoataua(i) = -0.6912223927269549D-3*t1158*t168
     #+0.2273757870812352D-2*t423+0.1449175245975665D-3*t1087*t459
     #+0.1097020523068037D0*t438*t24*t323
      v2rhoataub(i) = 0.D0
      v2rhobtaua(i) = 0.D0
      v2rhobtaub(i) = -0.6912223927269549D-3*t1170*t336
     #+0.2273757870812352D-2*t434+0.1449175245975665D-3*t1130*t819
     #+0.1097020523068037D0*t441*t59*t411
      v2sigmaaataua(i) = 0.2592083972726081D-3*t161*t417*t167
      v2sigmaabtaua(i) = 0.D0
      v2sigmabbtaua(i) = 0.D0
      v2sigmaaataub(i) = 0.D0
      v2sigmaabtaub(i) = 0.D0
      v2sigmabbtaub(i) = 0.2592083972726081D-3*t329*t428*t335
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      v2rhob2(i) = 0.0d0
      v2rhoab(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2rhoasigmaab(i) = 0.0d0
      v2rhoasigmabb(i) = 0.0d0
      v2rhobsigmaaa(i) = 0.0d0
      v2rhobsigmaab(i) = 0.0d0
      v2rhobsigmabb(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      v2sigmaab2(i) = 0.0d0
      v2sigmabb2(i) = 0.0d0
      v2sigmaaaab(i) = 0.0d0
      v2sigmaaabb(i) = 0.0d0
      v2sigmaabbb(i) = 0.0d0
      vtaua(i) = 0.0d0
      vtaub(i) = 0.0d0
      v2rhoataua(i) = 0.0d0
      v2rhoataub(i) = 0.0d0
      v2rhobtaua(i) = 0.0d0
      v2rhobtaub(i) = 0.0d0
      v2taua2(i) = 0.0d0
      v2taub2(i) = 0.0d0
      v2tauab(i) = 0.0d0
      v2sigmaaataua(i) = 0.0d0
      v2sigmaaataub(i) = 0.0d0
      v2sigmaabtaua(i) = 0.0d0
      v2sigmaabtaub(i) = 0.0d0
      v2sigmabbtaua(i) = 0.0d0
      v2sigmabbtaub(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end
      
      
      subroutine rks_c_b95
     & (ideriv,npt,rhoa1,sigmaaa1,taua1,
     &  zk,vrhoa,vsigmaaa,vtaua,
     &  v2rhoa2,v2rhoasigmaaa,v2sigmaaa2,
     &  v2rhoataua,v2sigmaaataua,v2taua2)
c
c     A.D. Becke
c     Density-functional thermochemistry. IV.
c     A new dynamical correlation functional and implications
c     for exact-exchange mixing
c     J. Chem. Phys. 104 (1996) 1040-1046
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt)
      REAL sigmaaa1(npt)
      REAL taua1(npt)
      REAL zk(npt),vrhoa(npt),vsigmaaa(npt),vtaua(npt)
      REAL v2rhoa2(npt),v2rhoasigmaaa(npt),v2sigmaaa2(npt)
      REAL v2rhoataua(npt),v2sigmaaataua(npt),v2taua2(npt)
      parameter(tol=1.0d-20)
      
      if(ideriv.eq.0) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      tau = dmax1(0.D0,taua1(i))
      t3 = rho**2
      t4 = rho**(1.D0/3.D0)
      t5 = t4**2
      t8 = sigma/t5/t3
      t11 = (1.D0+0.6032123997479158D-1*t8)**2
      t14 = 1/rho
      t20 = t14**(1.D0/3.D0)
      t22 = 1.D0+0.1606016560364007D0*t20
      t24 = t14**(1.D0/6.D0)
      t27 = dsqrt(t14)
      t29 = t20**2
      t35 = dlog(1.D0+0.321646831778707D2/(0.1248219874679732D2*t24
     #+0.4844076716063854D1*t20+0.2326004811900819D1*t27
     #+0.3819082618690966D0*t29))
      t53 = dlog(1.D0+0.160818243221511D2/(0.598255043577108D1*t24
     #+0.2225569421150687D1*t20+0.8004286349993634D0*t27
     #+0.1897004325747559D0*t29))
      zk(i) = -0.108280969081455D-1/t11*(0.5D0*tau-0.125D0*sigma*t14)
     #/t5*t22*t35+1/(1.D0+0.9841886522202837D-2*t8)*(-0.62182D-1*rho*
     #(1.D0+0.1325688999052018D0*t20)*t53+0.3109D-1*rho*t22*t35)
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      tau = dmax1(0.D0,taua1(i))
      t3 = rho**2
      t4 = rho**(1.D0/3.D0)
      t5 = t4**2
      t7 = 1/t5/t3
      t8 = sigma*t7
      t10 = 1.D0+0.6032123997479158D-1*t8
      t11 = t10**2
      t12 = 1/t11
      t14 = 1/rho
      t17 = 0.5D0*tau-0.125D0*sigma*t14
      t18 = t12*t17
      t19 = 1/t5
      t20 = t14**(1.D0/3.D0)
      t22 = 1.D0+0.1606016560364007D0*t20
      t24 = t14**(1.D0/6.D0)
      t27 = dsqrt(t14)
      t29 = t20**2
      t31 = 0.1248219874679732D2*t24+0.4844076716063854D1*t20
     #+0.2326004811900819D1*t27+0.3819082618690966D0*t29
      t34 = 1.D0+0.321646831778707D2/t31
      t35 = dlog(t34)
      t40 = 1.D0+0.9841886522202837D-2*t8
      t41 = 1/t40
      t43 = 1.D0+0.1325688999052018D0*t20
      t49 = 0.598255043577108D1*t24+0.2225569421150687D1*t20
     #+0.8004286349993634D0*t27+0.1897004325747559D0*t29
      t52 = 1.D0+0.160818243221511D2/t49
      t53 = dlog(t52)
      t56 = rho*t22
      t59 = -0.62182D-1*rho*t43*t53+0.3109D-1*t56*t35
      zk(i) = -0.108280969081455D-1*t18*t19*t22*t35+t41*t59
      t63 = 1/t11/t10*t17
      t64 = t3**2
      t68 = t22*t35
      t78 = 1/t5/rho
      t83 = 1/t29
      t89 = t31**2
      t90 = 1/t89
      t92 = t24**2
      t93 = t92**2
      t96 = 1/t3
      t97 = 1/t93/t24*t96
      t99 = t83*t96
      t102 = 1/t27*t96
      t105 = 1/t20*t96
      t107 = -0.4160732915599108D1*t97-0.3229384477375903D1*t99
     #-0.2326004811900819D1*t102-0.5092110158254621D0*t105
      t108 = 1/t34
      t113 = t40**2
      t115 = 1/t113*t59
      t116 = t3*rho
      t126 = t49**2
      vrhoa(i) = -0.3483542571021566D-2*t63/t4/t64*t68*sigma
     #-0.1353512113518188D-2*t12*sigma*t7*t22*t35
     #+0.7218731272097001D-2*t18*t78*t22*t35+0.579670098390266D-3*t18
     #*t7*t83*t35+0.1741411532348907D0*t18*t19*t22*t90*t107*t108
     #+0.2624503072587423D-1*t115*sigma/t5/t116+t41*(-0.62182D-1*t43
     #*t53+rho*(0.2747799777968419D-2*t99*t53+0.1D1*t43/t126*(
     #-0.99709173929518D0*t97-0.7418564737168958D0*t99
     #-0.4002143174996817D0*t102-0.1264669550498372D0*t105)/t52)
     #+0.3109D-1*t68-0.1664368495390566D-2*t14*t83*t35-0.5D0*t56*t90
     #*t107*t108)
      vsigmaaa(i) = 0.5225313856532348D-2*t63/t4/t116*t22*t35
     #+0.5414048454072751D-2*t12*t78*t68-0.3936754608881135D-1*t115*t7
      vtaua(i) = -0.5414048454072751D-2*t12*t19*t68
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vtaua(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      tau = dmax1(0.D0,taua1(i))
      t3 = rho**2
      t4 = rho**(1.D0/3.D0)
      t5 = t4**2
      t7 = 1/t5/t3
      t8 = sigma*t7
      t10 = 1.D0+0.6032123997479158D-1*t8
      t11 = t10**2
      t12 = 1/t11
      t14 = 1/rho
      t17 = 0.5D0*tau-0.125D0*sigma*t14
      t18 = t12*t17
      t19 = 1/t5
      t20 = t14**(1.D0/3.D0)
      t22 = 1.D0+0.1606016560364007D0*t20
      t24 = t14**(1.D0/6.D0)
      t27 = dsqrt(t14)
      t29 = t20**2
      t31 = 0.1248219874679732D2*t24+0.4844076716063854D1*t20
     #+0.2326004811900819D1*t27+0.3819082618690966D0*t29
      t34 = 1.D0+0.321646831778707D2/t31
      t35 = dlog(t34)
      t40 = 1.D0+0.9841886522202837D-2*t8
      t41 = 1/t40
      t43 = 1.D0+0.1325688999052018D0*t20
      t49 = 0.598255043577108D1*t24+0.2225569421150687D1*t20
     #+0.8004286349993634D0*t27+0.1897004325747559D0*t29
      t52 = 1.D0+0.160818243221511D2/t49
      t53 = dlog(t52)
      t56 = rho*t22
      t59 = -0.62182D-1*rho*t43*t53+0.3109D-1*t56*t35
      zk(i) = -0.108280969081455D-1*t18*t19*t22*t35+t41*t59
      t62 = 1/t11/t10
      t63 = t62*t17
      t64 = t3**2
      t66 = 1/t4/t64
      t68 = t22*t35
      t69 = t68*sigma
      t72 = t12*sigma
      t74 = t7*t22*t35
      t78 = 1/t5/rho
      t83 = 1/t29
      t88 = t18*t19
      t89 = t31**2
      t90 = 1/t89
      t91 = t22*t90
      t92 = t24**2
      t93 = t92**2
      t94 = t93*t24
      t95 = 1/t94
      t96 = 1/t3
      t97 = t95*t96
      t99 = t83*t96
      t101 = 1/t27
      t102 = t101*t96
      t104 = 1/t20
      t105 = t104*t96
      t107 = -0.4160732915599108D1*t97-0.3229384477375903D1*t99
     #-0.2326004811900819D1*t102-0.5092110158254621D0*t105
      t108 = 1/t34
      t109 = t107*t108
      t110 = t91*t109
      t113 = t40**2
      t114 = 1/t113
      t115 = t114*t59
      t116 = t3*rho
      t118 = 1/t5/t116
      t119 = sigma*t118
      t124 = t99*t53
      t126 = t49**2
      t127 = 1/t126
      t128 = t43*t127
      t133 = -0.99709173929518D0*t97-0.7418564737168958D0*t99
     #-0.4002143174996817D0*t102-0.1264669550498372D0*t105
      t134 = 1/t52
      t136 = t128*t133*t134
      t141 = t14*t83
      t144 = t90*t107
      t145 = t144*t108
      t148 = -0.62182D-1*t43*t53+rho*(0.2747799777968419D-2*t124+0.1D1
     #*t136)+0.3109D-1*t68-0.1664368495390566D-2*t141*t35-0.5D0*t56*t145
      vrhoa(i) = -0.3483542571021566D-2*t63*t66*t69
     #-0.1353512113518188D-2*t72*t74+0.7218731272097001D-2*t18*t78*t22
     #*t35+0.579670098390266D-3*t18*t7*t83*t35+0.1741411532348907D0
     #*t88*t110+0.2624503072587423D-1*t115*t119+t41*t148
      t151 = 1/t4/t116
      t156 = t12*t78
      t157 = t156*t68
      vsigmaaa(i) = 0.5225313856532348D-2*t63*t151*t22*t35
     #+0.5414048454072751D-2*t157-0.3936754608881135D-1*t115*t7
      t161 = t12*t19
      vtaua(i) = -0.5414048454072751D-2*t161*t68
      t166 = 1/t64
      t167 = 1/t94/t14*t166
      t169 = 1/t116
      t170 = t95*t169
      t173 = 1/t29/t14
      t174 = t173*t166
      t176 = t83*t169
      t180 = 1/t27/t14*t166
      t182 = t101*t169
      t186 = 1/t20/t14*t166
      t188 = t104*t169
      t190 = -0.6934554859331846D1*t167+0.1664293166239643D2*t170
     #-0.4305845969834537D1*t174+0.1291753790950361D2*t176
     #-0.2326004811900819D1*t180+0.9304019247603276D1*t182
     #-0.3394740105503081D0*t186+0.2036844063301848D1*t188
      t196 = 1/t89/t31
      t198 = t107**2
      t204 = 1/t5/t64
      t230 = t64*t3
      t232 = 1/t4/t230
      t234 = t83*t35
      t239 = t66*t22
      t251 = 1/t4/t64/rho
      t255 = t11**2
      t257 = 1/t255*t17
      t258 = t64**2
      t261 = sigma**2
      t272 = 1/t113/t40*t59
      t273 = t64*t116
      t279 = 0.5495599555936838D-2*t124
      t280 = 0.2D1*t136
      t284 = t133**2
      t287 = 0.2D1*t43/t126/t49*t284*t134
      t299 = 0.1D1*t128*(-0.8309097827459833D0*t167
     #+0.199418347859036D1*t170-0.4945709824779306D0*t174
     #+0.1483712947433792D1*t176-0.2001071587498409D0*t180
     #+0.8004286349993634D0*t182-0.4215565168327908D-1*t186
     #+0.2529339100996745D0*t188)*t134
      t301 = 0.1831866518645613D-2*t174*t53
      t303 = 0.5495599555936838D-2*t176*t53
      t314 = dlog(1.D0+0.2960857464321668D2/(0.8157414703487641D1*t24
     #+0.2247591863577616D1*t20+0.4300972471276643D0*t27
     #+0.1911512595127338D0*t29))
      t316 = (1.D0+0.6901399211255825D-1*t20)*t314*t96
      t318 = t126**2
      t321 = t52**2
      t325 = 0.160818243221511D2*t43/t318*t284/t321
      t329 = 0.8837926660346786D-1*t99*t127*t133*t134
      t333 = t89**2
      t334 = 1/t333
      t336 = t34**2
      t337 = 1/t336
      t361 = t114*t148
      t372 = 0.2240940862670676D0*t63*t239*t144*t108*sigma
     #+0.9023414090121251D-2*t72*t118*t22*t35+0.3483542571021566D-1
     #*t63*t251*t69-0.3362105718223909D-2*t257/t258*t68*t261
     #-0.1741771285510783D-2*t62*t261*t232*t22*t35
     #+0.275520655120833D-2*t272*t261/t4/t273+t41*(t279+t280+rho*(
     #-t287+t299+t301-t303+0.3377399869956914D-1*t316+t325-t329)-0.2D1
     #*t110-0.1608234158893535D2*t56*t334*t198*t337-0.5D0*t56*t90*t190
     #*t108+0.1D1*t56*t196*t198*t108-0.2219157993854088D-2*t169*t173
     #*t35+0.1070677706909338D0*t141*t145)+0.5601195022029291D1*t88
     #*t22*t334*t198*t337+0.1049801229034969D0*t361*t119
     #-0.192463558656411D0*t115*sigma*t204+t41*(t279+t280+rho*(-t287
     #+t299+t301-t303-0.3377399869956914D-1*t316+t325-t329))
      v2rhoa2(i) = 0.1741411532348907D0*t88*t91*t190*t108
     #-0.3482823064697813D0*t88*t22*t196*t198*t108
     #+0.7728934645203546D-3*t18*t204*t173*t35-0.3728981012481608D-1
     #*t18*t7*t83*t90*t109-0.3864467322601773D-2*t18*t118*t83*t35
     #-0.4643764086263751D0*t18*t78*t110-0.2406243757365667D-1*t18*t74
     #+0.289835049195133D-3*t72*t204*t83*t35+0.8707057661744533D-1*t72
     #*t7*t110+0.745950274372486D-3*t63*t232*t234*sigma+t372
      t383 = t12*t7
      v2rhoasigmaaa(i) = 0.2521579288667932D-2*t257/t273*t69
     #+0.2394935517577326D-2*t62*t251*t69-0.1741771285510783D-1*t63
     #*t239*t35-0.9023414090121251D-2*t383*t68-0.2797313528896822D-3
     #*t63*t251*t83*t35-0.289835049195133D-3*t12*t118*t234
     #-0.8403528235015034D-1*t63*t151*t110-0.8707057661744533D-1*t156
     #*t22*t145-0.2066404913406247D-2*t272*sigma*t232
     #+0.1049801229034969D0*t115*t118-0.3936754608881135D-1*t361*t7
      t411 = t62*t66
      v2sigmaaa2(i) = -0.3782368933001897D-2*t257/t230*t22*t35
     #-0.5225313856532348D-2*t411*t68+0.3099607370109371D-2*t272*t251
      v2taua2(i) = 0.D0
      v2rhoataua(i) = -0.3483542571021566D-2*t411*t69
     #+0.7218731272097001D-2*t157+0.579670098390266D-3*t383*t234
     #+0.1741411532348907D0*t161*t22*t145
      v2sigmaaataua(i) = 0.2612656928266174D-2*t62*t151*t68
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      vtaua(i) = 0.0d0
      v2rhoataua(i) = 0.0d0
      v2taua2(i) = 0.0d0
      v2sigmaaataua(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end

c:C_B95subrend
_ENDIF
_IF(ccpdft,all,c_edf1)
c:C_EDF1subrstart

c    Generated: Fri Feb 14 11:41:26 GMT 2003

      subroutine uks_c_edf1
     & (ideriv,npt,rhoa1,rhob1,sigmaaa1,sigmabb1,sigmaab1,
     &  zk,vrhoa,vrhob,vsigmaaa,vsigmabb,vsigmaab,
     &  v2rhoa2,v2rhob2,v2rhoab,
     &  v2rhoasigmaaa,v2rhoasigmaab,v2rhoasigmabb,
     &  v2rhobsigmabb,v2rhobsigmaab,v2rhobsigmaaa,
     &  v2sigmaaa2,v2sigmaaaab,v2sigmaaabb,
     &  v2sigmaab2,v2sigmaabbb,v2sigmabb2)
c
c     R.D. Adamson, P.M.W. Gill, and J.A. Pople
c     Empirical density functionals
c     Chem. Phys. Lett. 284 (1998) 6-11
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt),rhob1(npt)
      REAL sigmaaa1(npt),sigmabb1(npt),sigmaab1(npt)
      REAL zk(npt),vrhoa(npt),vrhob(npt)
      REAL vsigmaaa(npt),vsigmabb(npt),vsigmaab(npt)
      REAL v2rhoa2(npt),v2rhob2(npt),v2rhoab(npt)
      REAL v2rhoasigmaaa(npt),v2rhoasigmaab(npt)
      REAL v2rhoasigmabb(npt),v2rhobsigmabb(npt)
      REAL v2rhobsigmaab(npt),v2rhobsigmaaa(npt)
      REAL v2sigmaaa2(npt),v2sigmaaaab(npt),v2sigmaaabb(npt)
      REAL v2sigmaab2(npt),v2sigmaabbb(npt),v2sigmabb2(npt)
      parameter(tol=1.0d-20)
      
      if (ideriv.eq.0) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rho**(1.D0/3.D0)
      t5 = 1/t4
      t8 = 1/(1.D0+0.3505D0*t5)
      t10 = 1/rho
      t11 = rhob*t10
      t14 = 0.25D0*t5
      t15 = dexp(-t14)
      t17 = rho**2
      t19 = t4**2
      t23 = rhoa**2
      t24 = rhoa**(1.D0/3.D0)
      t25 = t24**2
      t28 = rhob**2
      t29 = rhob**(1.D0/3.D0)
      t30 = t29**2
      t34 = t5*t8
      t56 = 0.6666666666666667D0*t17
      zk(i) = -0.22D0*t8*rhoa*t11-0.869D-2*t15*t8/t19/t17/rho*(rhoa
     #*rhob*(0.3646239897876478D2*t25*t23+0.3646239897876478D2*t30*t28
     #+(0.2611111111111111D1-0.9722222222222222D-1*t5
     #-0.1363055555555556D0*t34)*sigma-1.D0*(0.25D1
     #-0.1388888888888889D-1*t5-0.1947222222222222D-1*t34)*(sigmaaa
     #+sigmabb)-0.1111111111111111D0*(t14+0.3505D0*t34-11.D0)*(rhoa
     #*t10*sigmaaa+t11*sigmabb))-0.6666666666666667D0*t17*sigma+(t56
     #-1.D0*t23)*sigmabb+(t56-1.D0*t28)*sigmaaa)
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rho**(1.D0/3.D0)
      t5 = 1/t4
      t7 = 1.D0+0.3505D0*t5
      t8 = 1/t7
      t9 = t8*rhoa
      t10 = 1/rho
      t11 = rhob*t10
      t14 = 0.25D0*t5
      t15 = dexp(-t14)
      t16 = t15*t8
      t17 = rho**2
      t19 = t4**2
      t21 = 1/t19/t17/rho
      t22 = rhoa*rhob
      t23 = rhoa**2
      t24 = rhoa**(1.D0/3.D0)
      t25 = t24**2
      t28 = rhob**2
      t29 = rhob**(1.D0/3.D0)
      t30 = t29**2
      t34 = t5*t8
      t36 = 0.2611111111111111D1-0.9722222222222222D-1*t5
     #-0.1363055555555556D0*t34
      t41 = sigmaaa+sigmabb
      t45 = t14+0.3505D0*t34-11.D0
      t49 = rhoa*t10*sigmaaa+t11*sigmabb
      t52 = 0.3646239897876478D2*t25*t23+0.3646239897876478D2*t30*t28
     #+t36*sigma-1.D0*(0.25D1-0.1388888888888889D-1*t5
     #-0.1947222222222222D-1*t34)*t41-0.1111111111111111D0*t45*t49
      t56 = 0.6666666666666667D0*t17
      t57 = 1.D0*t23
      t60 = 1.D0*t28
      t63 = t22*t52-0.6666666666666667D0*t17*sigma+(t56-t57)*sigmabb+
     #(t56-t60)*sigmaaa
      zk(i) = -0.22D0*t9*t11-0.869D-2*t16*t21*t63
      t73 = t45*t10
      t84 = t7**2
      t85 = 1/t84
      t91 = 0.2570333333333333D-1*t85*rhoa*rhob/t4/t17
      t92 = 1/t17
      t93 = rhob*t92
      t95 = 0.22D0*t9*t93
      t96 = t17**2
      t98 = 1/t96/rho
      t102 = 0.7241666666666667D-3*t98*t15*t8*t63
      t106 = 0.1015281666666667D-2*t15*t85*t98*t63
      t111 = 0.3186333333333333D-1*t16/t19/t96*t63
      t113 = 1/t4/rho
      t115 = t113*t8
      t119 = 1/t19/rho*t85
      t154 = 0.869D-2*t16*t21*(t22*((0.3240740740740741D-1*t113
     #+0.4543518518518519D-1*t115-0.1592503240740741D-1*t119)*sigma
     #-1.D0*(0.462962962962963D-2*t113+0.6490740740740741D-2*t115
     #-0.227500462962963D-2*t119)*t41-0.1111111111111111D0*(
     #-0.8333333333333333D-1*t113-0.1168333333333333D0*t115
     #+0.4095008333333333D-1*t119)*t49-0.1111111111111111D0*t45*(-1.D0
     #*rhoa*t92*sigmaaa-1.D0*t93*sigmabb))-0.1333333333333333D1*rho
     #*sigma+0.1333333333333333D1*rho*sigmabb+0.1333333333333333D1*rho
     #*sigmaaa)
      vrhoa(i) = -0.22D0*t8*rhob*t10-0.869D-2*t16*t21*(rhob*t52+t22*
     #(0.9723306394337274D2*t25*rhoa-0.1111111111111111D0*t73*sigmaaa)
     #-2.D0*rhoa*sigmabb)-t91+t95-t102-t106+t111-t154
      vrhob(i) = -0.22D0*t9*t10-0.869D-2*t16*t21*(rhoa*t52+t22*
     #(0.9723306394337274D2*t30*rhob-0.1111111111111111D0*t73*sigmabb)
     #-2.D0*rhob*sigmaaa)-t91+t95-t102-t106+t111-t154
      t170 = 0.1388888888888889D-1*t5
      t171 = 0.1947222222222222D-1*t34
      t185 = t16*t21*(t22*t36-0.6666666666666667D0*t17)
      t186 = 0.869D-2*t185
      vsigmaaa(i) = -0.869D-2*t16*t21*(t22*(-0.25D1+t170+t171
     #-0.1111111111111111D0*t45*rhoa*t10)+t56-t60)-t186
      vsigmaab(i) = -0.1738D-1*t185
      vsigmabb(i) = -0.869D-2*t16*t21*(t22*(-0.25D1+t170+t171
     #-0.1111111111111111D0*t45*rhob*t10)+t56-t57)-t186
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      zk(i) = 0.D0
      vrhoa(i) = 0.D0
      vrhob(i) = 0.D0
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      v2rhoa2(i) = 0.D0
      v2rhoab(i) = 0.D0
      v2rhob2(i) = 0.D0
      v2sigmaaa2(i) = 0.D0
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      v2sigmabb2(i) = 0.D0
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      zk(i) = 0.D0
      vrhoa(i) = 0.D0
      vrhob(i) = 0.D0
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      v2rhoa2(i) = 0.D0
      v2rhob2(i) = 0.D0
      v2rhoab(i) = 0.D0
      v2sigmaaa2(i) = 0.D0
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      v2sigmabb2(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rho**(1.D0/3.D0)
      t5 = 1/t4
      t7 = 1.D0+0.3505D0*t5
      t8 = 1/t7
      t9 = t8*rhoa
      t10 = 1/rho
      t11 = rhob*t10
      t14 = 0.25D0*t5
      t15 = dexp(-t14)
      t16 = t15*t8
      t17 = rho**2
      t18 = t17*rho
      t19 = t4**2
      t21 = 1/t19/t18
      t22 = rhoa*rhob
      t23 = rhoa**2
      t24 = rhoa**(1.D0/3.D0)
      t25 = t24**2
      t27 = 0.3646239897876478D2*t25*t23
      t28 = rhob**2
      t29 = rhob**(1.D0/3.D0)
      t30 = t29**2
      t32 = 0.3646239897876478D2*t30*t28
      t34 = t5*t8
      t36 = 0.2611111111111111D1-0.9722222222222222D-1*t5
     #-0.1363055555555556D0*t34
      t37 = t36*sigma
      t41 = sigmaaa+sigmabb
      t43 = 1.D0*(0.25D1-0.1388888888888889D-1*t5
     #-0.1947222222222222D-1*t34)*t41
      t45 = t14+0.3505D0*t34-11.D0
      t49 = rhoa*t10*sigmaaa+t11*sigmabb
      t51 = 0.1111111111111111D0*t45*t49
      t52 = t27+t32+t37-t43-t51
      t56 = 0.6666666666666667D0*t17
      t57 = 1.D0*t23
      t60 = 1.D0*t28
      t63 = t22*t52-0.6666666666666667D0*t17*sigma+(t56-t57)*sigmabb+
     #(t56-t60)*sigmaaa
      zk(i) = -0.22D0*t9*t11-0.869D-2*t16*t21*t63
      t67 = t8*rhob
      t71 = t25*rhoa
      t73 = t45*t10
      t76 = 0.9723306394337274D2*t71-0.1111111111111111D0*t73*sigmaaa
      t80 = rhob*t52+t22*t76-2.D0*rhoa*sigmabb
      t84 = t7**2
      t85 = 1/t84
      t86 = t85*rhoa
      t88 = 1/t4/t17
      t91 = 0.2570333333333333D-1*t86*rhob*t88
      t92 = 1/t17
      t93 = rhob*t92
      t95 = 0.22D0*t9*t93
      t96 = t17**2
      t97 = t96*rho
      t98 = 1/t97
      t99 = t98*t15
      t100 = t8*t63
      t102 = 0.7241666666666667D-3*t99*t100
      t103 = t15*t85
      t106 = 0.1015281666666667D-2*t103*t98*t63
      t108 = 1/t19/t96
      t111 = 0.3186333333333333D-1*t16*t108*t63
      t113 = 1/t4/rho
      t115 = t113*t8
      t119 = 1/t19/rho*t85
      t121 = 0.3240740740740741D-1*t113+0.4543518518518519D-1*t115
     #-0.1592503240740741D-1*t119
      t132 = -0.8333333333333333D-1*t113-0.1168333333333333D0*t115
     #+0.4095008333333333D-1*t119
      t140 = -1.D0*rhoa*t92*sigmaaa-1.D0*t93*sigmabb
      t143 = t121*sigma-1.D0*(0.462962962962963D-2*t113
     #+0.6490740740740741D-2*t115-0.227500462962963D-2*t119)*t41
     #-0.1111111111111111D0*t132*t49-0.1111111111111111D0*t45*t140
      t151 = t22*t143-0.1333333333333333D1*rho*sigma
     #+0.1333333333333333D1*rho*sigmabb+0.1333333333333333D1*rho*sigmaaa
      t154 = 0.869D-2*t16*t21*t151
      vrhoa(i) = -0.22D0*t67*t10-0.869D-2*t16*t21*t80-t91+t95-t102
     #-t106+t111-t154
      t158 = t30*rhob
      t162 = 0.9723306394337274D2*t158-0.1111111111111111D0*t73*sigmabb
      t166 = rhoa*t52+t22*t162-2.D0*rhob*sigmaaa
      vrhob(i) = -0.22D0*t9*t10-0.869D-2*t16*t21*t166-t91+t95-t102
     #-t106+t111-t154
      t170 = 0.1388888888888889D-1*t5
      t171 = 0.1947222222222222D-1*t34
      t172 = t45*rhoa
      t175 = -0.25D1+t170+t171-0.1111111111111111D0*t172*t10
      t177 = t22*t175+t56-t60
      t183 = t22*t36-0.6666666666666667D0*t17
      t185 = t16*t21*t183
      t186 = 0.869D-2*t185
      vsigmaaa(i) = -0.869D-2*t16*t21*t177-t186
      vsigmaab(i) = -0.1738D-1*t185
      t188 = t45*rhob
      t191 = -0.25D1+t170+t171-0.1111111111111111D0*t188*t10
      t193 = t22*t191+t56-t57
      vsigmabb(i) = -0.869D-2*t16*t21*t193-t186
      t197 = t96*t17
      t198 = 1/t197
      t201 = 0.6276111111111111D-2*t198*t15*t100
      t206 = 0.8567777777777778D-1*t86*rhob/t4/t18
      t207 = 1/t18
      t208 = rhob*t207
      t209 = t9*t208
      t210 = 0.44D0*t209
      t212 = 1/t84/t7
      t214 = rhob*t21
      t216 = 0.6006012222222222D-2*t212*rhoa*t214
      t219 = 0.1448333333333333D-2*t99*t8*t151
      t221 = 1/t4/t197
      t222 = t221*t15
      t224 = 0.6034722222222222D-4*t222*t100
      t227 = 0.1692136111111111D-3*t222*t85*t63
      t230 = 0.2030563333333333D-2*t103*t98*t151
      t234 = 0.2372374827777778D-3*t15*t212*t221*t63
      t237 = 0.6372666666666667D-1*t16*t108*t151
      t239 = t88*t8
      t243 = 1/t19/t17*t85
      t245 = t207*t212
      t280 = t16*t21*(t22*((-0.4320987654320988D-1*t88
     #-0.6058024691358025D-1*t239+0.3185006481481481D-1*t243
     #-0.3721149239197531D-2*t245)*sigma-1.D0*(-0.617283950617284D-2
     #*t88-0.8654320987654321D-2*t239+0.4550009259259259D-2*t243
     #-0.5315927484567901D-3*t245)*t41-0.1111111111111111D0*
     #(0.1111111111111111D0*t88+0.1557777777777778D0*t239
     #-0.8190016666666667D-1*t243+0.9568669472222222D-2*t245)*t49
     #-0.2222222222222222D0*t132*t140-0.1111111111111111D0*t45*(2.D0
     #*rhoa*t207*sigmaaa+2.D0*t208*sigmabb))-0.1333333333333333D1
     #*sigma+0.1333333333333333D1*sigmabb+0.1333333333333333D1*sigmaaa)
      t281 = 0.869D-2*t280
      t284 = 0.8799107777777778D-2*t103*t198*t63
      t289 = 0.1486955555555556D0*t16/t19/t97*t63
      t291 = t132*t10
      t294 = t45*t92
      t301 = t16*t21*(rhob*t143+t22*(-0.1111111111111111D0*t291
     #*sigmaaa+0.1111111111111111D0*t294*sigmaaa))
      t313 = t99*t8*t80
      t316 = t85*rhob*t88
      t318 = t67*t92
      t321 = t16*t108*t80
      t324 = t103*t98*t80
      v2rhoa2(i) = t201+t206-t210-t216-t219-t224-t227-t230-t234+t237
     #-t281+t284-t289-0.1738D-1*t301-0.869D-2*t16*t21*(2.D0*rhob*t76
     #+0.1620551065722879D3*t71*rhob-2.D0*sigmabb)
     #-0.1448333333333333D-2*t313-0.5140666666666667D-1*t316+0.44D0
     #*t318+0.6372666666666667D-1*t321-0.2030563333333333D-2*t324
      t344 = t16*t21*(rhoa*t143+t22*(-0.1111111111111111D0*t291
     #*sigmabb+0.1111111111111111D0*t294*sigmabb))
      t346 = t86*t88
      t348 = t9*t92
      t351 = t99*t8*t166
      t354 = t103*t98*t166
      t357 = t16*t108*t166
      v2rhob2(i) = t201+t206-t210-t216-t219-t224-t227-t230-t234+t237
     #-t281-0.869D-2*t16*t21*(2.D0*rhoa*t162+0.1620551065722879D3*rhoa
     #*t158-2.D0*sigmaaa)+t284-t289-0.1738D-1*t344
     #-0.5140666666666667D-1*t346+0.44D0*t348-0.1448333333333333D-2
     #*t351-0.2030563333333333D-2*t354+0.6372666666666667D-1*t357
      t362 = 0.22D0*t318+t201+t206-0.44D0*t209-t216-t219-t224-t230
     #-t234+t237-0.869D-2*t280+t284-t289
      t382 = -0.869D-2*t301-0.7241666666666667D-3*t313
     #+0.3186333333333333D-1*t321-0.1015281666666667D-2*t324-t227
     #-0.2570333333333333D-1*t316-0.2570333333333333D-1*t346+0.22D0
     #*t348-0.869D-2*t344-0.7241666666666667D-3*t351
     #-0.1015281666666667D-2*t354+0.3186333333333333D-1*t357-0.869D-2
     #*t16*t21*(t27+t32+t37-t43-t51+rhob*t162+rhoa*t76)-0.22D0*t8*t10
      v2rhoab(i) = t362+t382
      t385 = 0.1111111111111111D0*t22*t73
      t392 = 0.7241666666666667D-3*t99*t8*t177
      t395 = 0.1015281666666667D-2*t103*t98*t177
      t398 = 0.3186333333333333D-1*t16*t108*t177
      t399 = 0.462962962962963D-2*t113
      t400 = 0.6490740740740741D-2*t115
      t401 = 0.227500462962963D-2*t119
      t409 = 0.1333333333333333D1*rho
      t413 = 0.869D-2*t16*t21*(t22*(-t399-t400+t401
     #-0.1111111111111111D0*t132*rhoa*t10+0.1111111111111111D0*t172
     #*t92)+t409)
      t415 = t16*t214*t36
      t416 = 0.869D-2*t415
      t418 = t99*t8*t183
      t419 = 0.7241666666666667D-3*t418
      t421 = t103*t98*t183
      t422 = 0.1015281666666667D-2*t421
      t424 = t16*t108*t183
      t425 = 0.3186333333333333D-1*t424
      t430 = t16*t21*(t22*t121-0.1333333333333333D1*rho)
      t431 = 0.869D-2*t430
      v2rhoasigmaaa(i) = -0.869D-2*t16*t21*(rhob*t175-t385)-t392-t395
     #+t398-t413-t416-t419-t422+t425-t431
      t433 = 0.1448333333333333D-2*t418
      t434 = 0.2030563333333333D-2*t421
      t435 = 0.6372666666666667D-1*t424
      t436 = 0.1738D-1*t430
      v2rhoasigmaab(i) = -0.1738D-1*t415-t433-t434+t435-t436
      t445 = 0.7241666666666667D-3*t99*t8*t193
      t448 = 0.1015281666666667D-2*t103*t98*t193
      t451 = 0.3186333333333333D-1*t16*t108*t193
      t462 = 0.869D-2*t16*t21*(t22*(-t399-t400+t401
     #-0.1111111111111111D0*t132*rhob*t10+0.1111111111111111D0*t188
     #*t92)+t409)
      v2rhoasigmabb(i) = -0.869D-2*t16*t21*(rhob*t191-2.D0*rhoa)-t445
     #-t448+t451-t462-t416-t419-t422+t425-t431
      t471 = t16*t21*rhoa*t36
      t472 = 0.869D-2*t471
      v2rhobsigmaaa(i) = -0.869D-2*t16*t21*(rhoa*t175-2.D0*rhob)-t392
     #-t395+t398-t413-t472-t419-t422+t425-t431
      v2rhobsigmaab(i) = -0.1738D-1*t471-t433-t434+t435-t436
      v2rhobsigmabb(i) = -0.869D-2*t16*t21*(rhoa*t191-t385)-t445-t448
     #+t451-t462-t472-t419-t422+t425-t431
      v2sigmaaa2(i) = 0.D0
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      v2sigmabb2(i) = 0.D0
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      v2rhob2(i) = 0.0d0
      v2rhoab(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2rhoasigmaab(i) = 0.0d0
      v2rhoasigmabb(i) = 0.0d0
      v2rhobsigmaaa(i) = 0.0d0
      v2rhobsigmaab(i) = 0.0d0
      v2rhobsigmabb(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      v2sigmaab2(i) = 0.0d0
      v2sigmabb2(i) = 0.0d0
      v2sigmaaaab(i) = 0.0d0
      v2sigmaaabb(i) = 0.0d0
      v2sigmaabbb(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end
      
      
      subroutine rks_c_edf1
     & (ideriv,npt,rhoa1,sigmaaa1,
     &  zk,vrhoa,vsigmaaa,
     &  v2rhoa2,v2rhoasigmaaa,v2sigmaaa2)
c
c     R.D. Adamson, P.M.W. Gill, and J.A. Pople
c     Empirical density functionals
c     Chem. Phys. Lett. 284 (1998) 6-11
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt)
      REAL sigmaaa1(npt)
      REAL zk(npt),vrhoa(npt),vsigmaaa(npt)
      REAL v2rhoa2(npt),v2rhoasigmaaa(npt),v2sigmaaa2(npt)
      parameter(tol=1.0d-20)
      
      if(ideriv.eq.0) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t3 = 1/t2
      t6 = 1/(1.D0+0.3505D0*t3)
      t9 = 0.25D0*t3
      t10 = dexp(-t9)
      t12 = rho**2
      t14 = t2**2
      t20 = t3*t6
      zk(i) = -0.55D-1*t6*rho-0.869D-2*t10*t6/t14/t12/rho*(0.25D0*t12*
     #(0.1148493600075277D2*t14*t12+(0.2611111111111111D1
     #-0.9722222222222222D-1*t3-0.1363055555555556D0*t20)*sigma-0.5D0*
     #(0.25D1-0.1388888888888889D-1*t3-0.1947222222222222D-1*t20)
     #*sigma-0.2777777777777778D-1*(t9+0.3505D0*t20-11.D0)*sigma)
     #-0.4583333333333333D0*t12*sigma)
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t3 = 1/t2
      t5 = 1.D0+0.3505D0*t3
      t6 = 1/t5
      t9 = 0.25D0*t3
      t10 = dexp(-t9)
      t11 = t10*t6
      t12 = rho**2
      t14 = t2**2
      t16 = 1/t14/t12/rho
      t20 = t3*t6
      t22 = 0.2611111111111111D1-0.9722222222222222D-1*t3
     #-0.1363055555555556D0*t20
      t30 = t9+0.3505D0*t20-11.D0
      t33 = 0.1148493600075277D2*t14*t12+t22*sigma-0.5D0*(0.25D1
     #-0.1388888888888889D-1*t3-0.1947222222222222D-1*t20)*sigma
     #-0.2777777777777778D-1*t30*sigma
      t38 = 0.25D0*t12*t33-0.4583333333333333D0*t12*sigma
      zk(i) = -0.55D-1*t6*rho-0.869D-2*t11*t16*t38
      t45 = t14*rho
      t49 = t30/rho*sigma
      t54 = rho*sigma
      t60 = t5**2
      t61 = 1/t60
      t64 = t12**2
      t66 = 1/t64/rho
      t81 = 1/t2/rho
      t83 = t81*t6
      t85 = 1/t45
      t86 = t85*t61
      vrhoa(i) = -0.55D-1*t6-0.869D-2*t11*t16*(0.5D0*rho*t33+0.25D0
     #*t12*(0.3062649600200738D2*t45-0.2777777777777778D-1*t49)-0.25D0
     #*t54)-0.6425833333333333D-2*t61*t3-0.7241666666666667D-3*t66*t10
     #*t6*t38-0.1015281666666667D-2*t10*t61*t66*t38
     #+0.3186333333333333D-1*t11/t14/t64*t38-0.869D-2*t11*t16*(0.25D0
     #*t12*((0.3240740740740741D-1*t81+0.4543518518518519D-1*t83
     #-0.1592503240740741D-1*t86)*sigma-0.5D0*(0.462962962962963D-2
     #*t81+0.6490740740740741D-2*t83-0.227500462962963D-2*t86)*sigma
     #-0.2777777777777778D-1*(-0.8333333333333333D-1*t81
     #-0.1168333333333333D0*t83+0.4095008333333333D-1*t86)*sigma
     #+0.2777777777777778D-1*t49)-0.6666666666666667D0*t54)
      vsigmaaa(i) = 0.9655555555555556D-3*t11*t85-0.3476D-1*t11*t16*
     #(0.25D0*t12*t22-0.6666666666666667D0*t12)
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t3 = 1/t2
      t5 = 1.D0+0.3505D0*t3
      t6 = 1/t5
      t9 = 0.25D0*t3
      t10 = dexp(-t9)
      t11 = t10*t6
      t12 = rho**2
      t13 = t12*rho
      t14 = t2**2
      t16 = 1/t14/t13
      t17 = t14*t12
      t18 = 0.1148493600075277D2*t17
      t20 = t3*t6
      t22 = 0.2611111111111111D1-0.9722222222222222D-1*t3
     #-0.1363055555555556D0*t20
      t23 = t22*sigma
      t28 = 0.5D0*(0.25D1-0.1388888888888889D-1*t3
     #-0.1947222222222222D-1*t20)*sigma
      t30 = t9+0.3505D0*t20-11.D0
      t32 = 0.2777777777777778D-1*t30*sigma
      t33 = t18+t23-t28-t32
      t38 = 0.25D0*t12*t33-0.4583333333333333D0*t12*sigma
      zk(i) = -0.55D-1*t6*rho-0.869D-2*t11*t16*t38
      t45 = t14*rho
      t47 = 1/rho
      t48 = t30*t47
      t49 = t48*sigma
      t51 = 0.3062649600200738D2*t45-0.2777777777777778D-1*t49
      t54 = rho*sigma
      t56 = 0.5D0*rho*t33+0.25D0*t12*t51-0.25D0*t54
      t60 = t5**2
      t61 = 1/t60
      t64 = t12**2
      t65 = t64*rho
      t66 = 1/t65
      t67 = t66*t10
      t68 = t6*t38
      t71 = t10*t61
      t76 = 1/t14/t64
      t81 = 1/t2/rho
      t83 = t81*t6
      t85 = 1/t45
      t86 = t85*t61
      t88 = 0.3240740740740741D-1*t81+0.4543518518518519D-1*t83
     #-0.1592503240740741D-1*t86
      t99 = -0.8333333333333333D-1*t81-0.1168333333333333D0*t83
     #+0.4095008333333333D-1*t86
      t103 = t88*sigma-0.5D0*(0.462962962962963D-2*t81
     #+0.6490740740740741D-2*t83-0.227500462962963D-2*t86)*sigma
     #-0.2777777777777778D-1*t99*sigma+0.2777777777777778D-1*t49
      t107 = 0.25D0*t12*t103-0.6666666666666667D0*t54
      vrhoa(i) = -0.55D-1*t6-0.869D-2*t11*t16*t56
     #-0.6425833333333333D-2*t61*t3-0.7241666666666667D-3*t67*t68
     #-0.1015281666666667D-2*t71*t66*t38+0.3186333333333333D-1*t11*t76
     #*t38-0.869D-2*t11*t16*t107
      t116 = 0.25D0*t12*t22-0.6666666666666667D0*t12
      vsigmaaa(i) = 0.9655555555555556D-3*t11*t85-0.3476D-1*t11*t16*t116
      t121 = 1/t60/t5
      t124 = t64*t12
      t125 = 1/t124
      t133 = 1/t2/t124
      t134 = t133*t10
      t151 = 1/t2/t12
      t153 = t151*t6
      t155 = 1/t17
      t156 = t155*t61
      t158 = 1/t13
      t159 = t158*t121
      t178 = t99*t47*sigma
      t182 = t30/t12*sigma
      t214 = rho*t51
      s1 = -0.3003006111111111D-2*t121*t85+0.1255222222222222D-1*t125
     #*t10*t68-0.2896666666666667D-2*t67*t6*t107-0.1206944444444444D-3
     #*t134*t68-0.3384272222222222D-3*t134*t61*t38
     #-0.4061126666666667D-2*t71*t66*t107-0.4744749655555556D-3*t10
     #*t121*t133*t38+0.1274533333333333D0*t11*t76*t107-0.1738D-1*t11
     #*t16*(0.25D0*t12*((-0.4320987654320988D-1*t151
     #-0.6058024691358025D-1*t153+0.3185006481481481D-1*t156
     #-0.3721149239197531D-2*t159)*sigma-0.5D0*(-0.617283950617284D-2
     #*t151-0.8654320987654321D-2*t153+0.4550009259259259D-2*t156
     #-0.5315927484567901D-3*t159)*sigma-0.2777777777777778D-1*
     #(0.1111111111111111D0*t151+0.1557777777777778D0*t153
     #-0.8190016666666667D-1*t156+0.9568669472222222D-2*t159)*sigma
     #+0.5555555555555556D-1*t178-0.5555555555555556D-1*t182)
     #-0.6666666666666667D0*sigma)
      v2rhoa2(i) = s1+0.1759821555555556D-1*t71*t125*t38
     #-0.2973911111111111D0*t11/t14/t65*t38-0.3476D-1*t11*t16*(0.5D0
     #*rho*t103+0.25D0*t12*(-0.2777777777777778D-1*t178
     #+0.2777777777777778D-1*t182))-0.2896666666666667D-2*t67*t6*t56
     #-0.869D-2*t11*t16*(t18+t23-t28-t32+t214)-0.869D-2*t11*t16*(t214
     #+0.2552208000167282D2*t17-0.5D0*sigma)-0.4061126666666667D-2*t71
     #*t66*t56+0.1274533333333333D0*t11*t76*t56-0.8567777777777778D-2
     #*t61*t81
      v2rhoasigmaaa(i) = -0.869D-2*t11*t16*(-0.9444444444444444D0*rho
     #-0.2777777777777778D-1*rho*t30)+0.8046296296296296D-4*t158*t10
     #*t6+0.1128090740740741D-3*t71*t158+0.1335685185185185D-1*t11
     #*t155-0.1738D-1*t11*t16*(0.25D0*t12*(-0.1D-22*t81-0.1D-22*t83
     #+0.5555555555555556D-1*t48)+0.1333333333333333D1*rho)-0.1738D-1
     #*t11*t155*t22-0.2896666666666667D-2*t67*t6*t116
     #-0.4061126666666667D-2*t71*t66*t116+0.1274533333333333D0*t11*t76
     #*t116-0.3476D-1*t11*t16*(0.25D0*t12*t88-0.1333333333333333D1*rho)
      v2sigmaaa2(i) = 0.D0
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end

c:C_EDF1subrend
_ENDIF
_IF(ccpdft,all,xc_bb95)
c:XC_BB95subrstart

c    Generated: Tue Oct 19 14:17:39 BST 2004

      subroutine uks_xc_bb95
     & (ideriv,npt,rhoa1,rhob1,sigmaaa1,sigmabb1,sigmaab1,
     &  taua1,taub1,
     &  zk,vrhoa,vrhob,vsigmaaa,vsigmabb,vsigmaab,
     &  vtaua,vtaub,
     &  v2rhoa2,v2rhob2,v2rhoab,
     &  v2rhoasigmaaa,v2rhoasigmaab,v2rhoasigmabb,
     &  v2rhobsigmabb,v2rhobsigmaab,v2rhobsigmaaa,
     &  v2sigmaaa2,v2sigmaaaab,v2sigmaaabb,
     &  v2sigmaab2,v2sigmaabbb,v2sigmabb2,
     &  v2rhoataua,v2rhoataub,v2rhobtaua,v2rhobtaub,
     &  v2sigmaaataua,v2sigmaaataub,
     &  v2sigmaabtaua,v2sigmaabtaub,
     &  v2sigmabbtaua,v2sigmabbtaub,
     &  v2taua2,v2taub2,v2tauab)
c
c     A.D. Becke
c     Density-functional thermochemistry. IV.
c     A new dynamical correlation functional and implications
c     for exact-exchange mixing
c     J. Chem. Phys. 104 (1996) 1040-1046
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt),rhob1(npt)
      REAL sigmaaa1(npt),sigmabb1(npt),sigmaab1(npt)
      REAL taua1(npt),taub1(npt)
      REAL zk(npt),vrhoa(npt),vrhob(npt)
      REAL vsigmaaa(npt),vsigmabb(npt),vsigmaab(npt)
      REAL vtaua(npt),vtaub(npt)
      REAL v2rhoa2(npt),v2rhob2(npt),v2rhoab(npt)
      REAL v2rhoasigmaaa(npt),v2rhoasigmaab(npt)
      REAL v2rhoasigmabb(npt),v2rhobsigmabb(npt)
      REAL v2rhobsigmaab(npt),v2rhobsigmaaa(npt)
      REAL v2sigmaaa2(npt),v2sigmaaaab(npt),v2sigmaaabb(npt)
      REAL v2sigmaab2(npt),v2sigmaabbb(npt),v2sigmabb2(npt)
      REAL v2rhoataua(npt),v2rhoataub(npt)
      REAL v2rhobtaua(npt),v2rhobtaub(npt)
      REAL v2sigmaaataua(npt),v2sigmaaataub(npt)
      REAL v2sigmaabtaua(npt),v2sigmaabtaub(npt)
      REAL v2sigmabbtaua(npt),v2sigmabbtaub(npt)
      REAL v2taua2(npt),v2taub2(npt),v2tauab(npt)
      parameter(tol=1.0d-20)
      
      if (ideriv.eq.0) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      taub = dmax1(0.D0,taub1(i))
      tau = taub
      t3 = rhob**(1.D0/3.D0)
      t4 = t3*rhob
      t6 = 1/t4
      t8 = dsqrt(sigmabb)
      t9 = t8*t6
      t10 = dlog(t9+dsqrt(1+t9**2))
      t17 = rhob**2
      t18 = t3**2
      t24 = (1.D0+0.38D-1*sigmabb/t18/t17)**2
      t26 = 1/rhob
      t32 = t26**(1.D0/3.D0)
      t36 = t26**(1.D0/6.D0)
      t39 = dsqrt(t26)
      t41 = t32**2
      t47 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t36
     #+0.3844746237447211D1*t32+0.1644733775567609D1*t39
     #+0.2405871291288192D0*t41))
      zk(i) = -0.9305257363491D0*t4-0.42D-2*t6*sigmabb/(1.D0+0.252D-1
     #*t9*t10)-0.3410636806218528D-2/t24*(taub-0.25D0*sigmabb*t26)/t18
     #*(1.D0+0.1274696188700087D0*t32)*t47
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      taua = dmax1(0.D0,taua1(i))
      tau = taua
      t3 = rhoa**(1.D0/3.D0)
      t4 = t3*rhoa
      t6 = 1/t4
      t8 = dsqrt(sigmaaa)
      t9 = t8*t6
      t10 = dlog(t9+dsqrt(1+t9**2))
      t17 = rhoa**2
      t18 = t3**2
      t24 = (1.D0+0.38D-1*sigmaaa/t18/t17)**2
      t26 = 1/rhoa
      t32 = t26**(1.D0/3.D0)
      t36 = t26**(1.D0/6.D0)
      t39 = dsqrt(t26)
      t41 = t32**2
      t47 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t36
     #+0.3844746237447211D1*t32+0.1644733775567609D1*t39
     #+0.2405871291288192D0*t41))
      zk(i) = -0.9305257363491D0*t4-0.42D-2*t6*sigmaaa/(1.D0+0.252D-1
     #*t9*t10)-0.3410636806218528D-2/t24*(taua-0.25D0*sigmaaa*t26)/t18
     #*(1.D0+0.1274696188700087D0*t32)*t47
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      taua = dmax1(0.D0,taua1(i))
      taub = dmax1(0.D0,taub1(i))
      tau = taua+taub
      t6 = rhoa**(1.D0/3.D0)
      t7 = t6*rhoa
      t9 = 1/t7
      t11 = dsqrt(sigmaaa)
      t12 = t11*t9
      t13 = dlog(t12+dsqrt(1+t12**2))
      t20 = rhoa**2
      t21 = t6**2
      t24 = sigmaaa/t21/t20
      t27 = (1.D0+0.38D-1*t24)**2
      t29 = 1/rhoa
      t35 = t29**(1.D0/3.D0)
      t37 = 1.D0+0.1274696188700087D0*t35
      t39 = t29**(1.D0/6.D0)
      t42 = dsqrt(t29)
      t44 = t35**2
      t50 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t39
     #+0.3844746237447211D1*t35+0.1644733775567609D1*t42
     #+0.2405871291288192D0*t44))
      t54 = rhob**(1.D0/3.D0)
      t55 = t54*rhob
      t57 = 1/t55
      t59 = dsqrt(sigmabb)
      t60 = t59*t57
      t61 = dlog(t60+dsqrt(1+t60**2))
      t68 = rhob**2
      t69 = t54**2
      t72 = sigmabb/t69/t68
      t75 = (1.D0+0.38D-1*t72)**2
      t77 = 1/rhob
      t83 = t77**(1.D0/3.D0)
      t85 = 1.D0+0.1274696188700087D0*t83
      t87 = t77**(1.D0/6.D0)
      t90 = dsqrt(t77)
      t92 = t83**2
      t98 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t87
     #+0.3844746237447211D1*t83+0.1644733775567609D1*t90
     #+0.2405871291288192D0*t92))
      t106 = rhoa+rhob
      t107 = 1/t106
      t108 = t107**(1.D0/3.D0)
      t111 = t107**(1.D0/6.D0)
      t114 = dsqrt(t107)
      t116 = t108**2
      t122 = dlog(1.D0+0.160818243221511D2/(0.598255043577108D1*t111
     #+0.2225569421150687D1*t108+0.8004286349993634D0*t114
     #+0.1897004325747559D0*t116))
      t124 = 0.62182D-1*(1.D0+0.1325688999052018D0*t108)*t122
      t135 = dlog(1.D0+0.2960857464321668D2/(0.8157414703487641D1*t111
     #+0.2247591863577616D1*t108+0.4300972471276643D0*t114
     #+0.1911512595127338D0*t116))
      t138 = rhoa-1.D0*rhob
      t139 = t138*t107
      t140 = 1.D0+t139
      t141 = t140**(1.D0/3.D0)
      t144 = 1.D0-1.D0*t139
      t145 = t144**(1.D0/3.D0)
      t147 = t141*t140+t145*t144-2.D0
      t148 = t138**2
      t149 = t148**2
      t150 = t106**2
      t151 = t150**2
      t153 = t149/t151
      t169 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t111
     #+0.3844746237447211D1*t108+0.1644733775567609D1*t114
     #+0.2405871291288192D0*t116))
      zk(i) = -0.9305257363491D0*t7-0.42D-2*t9*sigmaaa/(1.D0+0.252D-1
     #*t12*t13)-0.3410636806218528D-2/t27*(taua-0.25D0*sigmaaa*t29)
     #/t21*t37*t50-0.9305257363491D0*t55-0.42D-2*t57*sigmabb/(1.D0
     #+0.252D-1*t60*t61)-0.3410636806218528D-2/t75*(taub-0.25D0
     #*sigmabb*t77)/t69*t85*t98+1/(1.D0+0.31D-2*t24+0.31D-2*t72)*(t106
     #*(-t124+0.3799574853701528D-1*(1.D0+0.6901399211255825D-1*t108)
     #*t135*t147*(1.D0-1.D0*t153)+0.1923661050931536D1*(-0.3109D-1*
     #(1.D0+0.1274696188700087D0*t108)*t169+t124)*t147*t153)+0.3109D-1
     #*rhoa*t37*t50+0.3109D-1*rhob*t85*t98)
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      taub = dmax1(0.D0,taub1(i))
      tau = taub
      t3 = rhob**(1.D0/3.D0)
      t4 = t3*rhob
      t6 = 1/t4
      t7 = t6*sigmabb
      t8 = dsqrt(sigmabb)
      t9 = t8*t6
      t10 = dlog(t9+dsqrt(1+t9**2))
      t13 = 1.D0+0.252D-1*t9*t10
      t14 = 1/t13
      t17 = rhob**2
      t18 = t3**2
      t20 = 1/t18/t17
      t21 = sigmabb*t20
      t23 = 1.D0+0.38D-1*t21
      t24 = t23**2
      t25 = 1/t24
      t26 = 1/rhob
      t29 = taub-0.25D0*sigmabb*t26
      t30 = t25*t29
      t31 = 1/t18
      t32 = t26**(1.D0/3.D0)
      t34 = 1.D0+0.1274696188700087D0*t32
      t36 = t26**(1.D0/6.D0)
      t39 = dsqrt(t26)
      t41 = t32**2
      t43 = 0.1112037486309468D2*t36+0.3844746237447211D1*t32
     #+0.1644733775567609D1*t39+0.2405871291288192D0*t41
      t46 = 1.D0+0.321646831778707D2/t43
      t47 = dlog(t46)
      zk(i) = -0.9305257363491D0*t4-0.42D-2*t7*t14
     #-0.3410636806218528D-2*t30*t31*t34*t47
      vrhoa(i) = 0.D0
      t53 = 1/t3/t17
      t57 = t13**2
      t58 = 1/t57
      t62 = t17*rhob
      t67 = dsqrt(1.D0+t21)
      t68 = 1/t67
      t77 = 1/t24/t23*t29
      t78 = t17**2
      t82 = t34*t47
      t92 = 1/t18/rhob
      t97 = 1/t41
      t103 = t43**2
      t106 = t36**2
      t107 = t106**2
      t110 = 1/t17
      vrhob(i) = -0.12407009817988D1*t3+0.56D-2*t53*sigmabb*t14
     #+0.42D-2*t7*t58*(-0.336D-1*t8*t53*t10-0.336D-1*sigmabb/t18/t62
     #*t68)-0.6912223927269549D-3*t77/t3/t78*t82*sigmabb
     #-0.8526592015546319D-3*t25*sigmabb*t20*t34*t47
     #+0.2273757870812352D-2*t30*t92*t34*t47+0.1449175245975665D-3*t30
     #*t20*t97*t47+0.1097020523068037D0*t30*t31*t34/t103*(
     #-0.1853395810515781D1/t107/t36*t110-0.128158207914907D1*t97*t110
     #-0.8223668877838045D0/t39*t110-0.1603914194192128D0/t32*t110)/t46
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      vsigmabb(i) = -0.42D-2*t6*t14+0.42D-2*t7*t58*(0.126D-1/t8*t6*t10
     #+0.126D-1*t20*t68)+0.2592083972726081D-3*t77/t3/t62*t34*t47
     #+0.8526592015546319D-3*t25*t92*t82
      vtaub(i) = -0.3410636806218528D-2*t25*t31*t82
      vtaua(i) = 0.0d0
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      taua = dmax1(0.D0,taua1(i))
      tau = taua
      t3 = rhoa**(1.D0/3.D0)
      t4 = t3*rhoa
      t6 = 1/t4
      t7 = t6*sigmaaa
      t8 = dsqrt(sigmaaa)
      t9 = t8*t6
      t10 = dlog(t9+dsqrt(1+t9**2))
      t13 = 1.D0+0.252D-1*t9*t10
      t14 = 1/t13
      t17 = rhoa**2
      t18 = t3**2
      t20 = 1/t18/t17
      t21 = sigmaaa*t20
      t23 = 1.D0+0.38D-1*t21
      t24 = t23**2
      t25 = 1/t24
      t26 = 1/rhoa
      t29 = taua-0.25D0*sigmaaa*t26
      t30 = t25*t29
      t31 = 1/t18
      t32 = t26**(1.D0/3.D0)
      t34 = 1.D0+0.1274696188700087D0*t32
      t36 = t26**(1.D0/6.D0)
      t39 = dsqrt(t26)
      t41 = t32**2
      t43 = 0.1112037486309468D2*t36+0.3844746237447211D1*t32
     #+0.1644733775567609D1*t39+0.2405871291288192D0*t41
      t46 = 1.D0+0.321646831778707D2/t43
      t47 = dlog(t46)
      zk(i) = -0.9305257363491D0*t4-0.42D-2*t7*t14
     #-0.3410636806218528D-2*t30*t31*t34*t47
      t53 = 1/t3/t17
      t57 = t13**2
      t58 = 1/t57
      t62 = t17*rhoa
      t67 = dsqrt(1.D0+t21)
      t68 = 1/t67
      t77 = 1/t24/t23*t29
      t78 = t17**2
      t82 = t34*t47
      t92 = 1/t18/rhoa
      t97 = 1/t41
      t103 = t43**2
      t106 = t36**2
      t107 = t106**2
      t110 = 1/t17
      vrhoa(i) = -0.12407009817988D1*t3+0.56D-2*t53*sigmaaa*t14
     #+0.42D-2*t7*t58*(-0.336D-1*t8*t53*t10-0.336D-1*sigmaaa/t18/t62
     #*t68)-0.6912223927269549D-3*t77/t3/t78*t82*sigmaaa
     #-0.8526592015546319D-3*t25*sigmaaa*t20*t34*t47
     #+0.2273757870812352D-2*t30*t92*t34*t47+0.1449175245975665D-3*t30
     #*t20*t97*t47+0.1097020523068037D0*t30*t31*t34/t103*(
     #-0.1853395810515781D1/t107/t36*t110-0.128158207914907D1*t97*t110
     #-0.8223668877838045D0/t39*t110-0.1603914194192128D0/t32*t110)/t46
      vrhob(i) = 0.D0
      vsigmaaa(i) = -0.42D-2*t6*t14+0.42D-2*t7*t58*(0.126D-1/t8*t6*t10
     #+0.126D-1*t20*t68)+0.2592083972726081D-3*t77/t3/t62*t34*t47
     #+0.8526592015546319D-3*t25*t92*t82
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      vtaua(i) = -0.3410636806218528D-2*t25*t31*t82
      vtaub(i) = 0.0d0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      taua = dmax1(0.D0,taua1(i))
      taub = dmax1(0.D0,taub1(i))
      tau = taua+taub
      t6 = rhoa**(1.D0/3.D0)
      t7 = t6*rhoa
      t9 = 1/t7
      t10 = t9*sigmaaa
      t11 = dsqrt(sigmaaa)
      t12 = t11*t9
      t13 = dlog(t12+dsqrt(1+t12**2))
      t16 = 1.D0+0.252D-1*t12*t13
      t17 = 1/t16
      t20 = rhoa**2
      t21 = t6**2
      t23 = 1/t21/t20
      t24 = sigmaaa*t23
      t26 = 1.D0+0.38D-1*t24
      t27 = t26**2
      t28 = 1/t27
      t29 = 1/rhoa
      t32 = taua-0.25D0*sigmaaa*t29
      t33 = t28*t32
      t34 = 1/t21
      t35 = t29**(1.D0/3.D0)
      t37 = 1.D0+0.1274696188700087D0*t35
      t39 = t29**(1.D0/6.D0)
      t42 = dsqrt(t29)
      t44 = t35**2
      t46 = 0.1112037486309468D2*t39+0.3844746237447211D1*t35
     #+0.1644733775567609D1*t42+0.2405871291288192D0*t44
      t49 = 1.D0+0.321646831778707D2/t46
      t50 = dlog(t49)
      t54 = rhob**(1.D0/3.D0)
      t55 = t54*rhob
      t57 = 1/t55
      t58 = t57*sigmabb
      t59 = dsqrt(sigmabb)
      t60 = t59*t57
      t61 = dlog(t60+dsqrt(1+t60**2))
      t64 = 1.D0+0.252D-1*t60*t61
      t65 = 1/t64
      t68 = rhob**2
      t69 = t54**2
      t71 = 1/t69/t68
      t72 = sigmabb*t71
      t74 = 1.D0+0.38D-1*t72
      t75 = t74**2
      t76 = 1/t75
      t77 = 1/rhob
      t80 = taub-0.25D0*sigmabb*t77
      t81 = t76*t80
      t82 = 1/t69
      t83 = t77**(1.D0/3.D0)
      t85 = 1.D0+0.1274696188700087D0*t83
      t87 = t77**(1.D0/6.D0)
      t90 = dsqrt(t77)
      t92 = t83**2
      t94 = 0.1112037486309468D2*t87+0.3844746237447211D1*t83
     #+0.1644733775567609D1*t90+0.2405871291288192D0*t92
      t97 = 1.D0+0.321646831778707D2/t94
      t98 = dlog(t97)
      t104 = 1.D0+0.31D-2*t24+0.31D-2*t72
      t105 = 1/t104
      t106 = rhoa+rhob
      t107 = 1/t106
      t108 = t107**(1.D0/3.D0)
      t110 = 1.D0+0.1325688999052018D0*t108
      t111 = t107**(1.D0/6.D0)
      t114 = dsqrt(t107)
      t116 = t108**2
      t118 = 0.598255043577108D1*t111+0.2225569421150687D1*t108
     #+0.8004286349993634D0*t114+0.1897004325747559D0*t116
      t121 = 1.D0+0.160818243221511D2/t118
      t122 = dlog(t121)
      t124 = 0.62182D-1*t110*t122
      t126 = 1.D0+0.6901399211255825D-1*t108
      t131 = 0.8157414703487641D1*t111+0.2247591863577616D1*t108
     #+0.4300972471276643D0*t114+0.1911512595127338D0*t116
      t134 = 1.D0+0.2960857464321668D2/t131
      t135 = dlog(t134)
      t136 = t126*t135
      t138 = rhoa-1.D0*rhob
      t139 = t138*t107
      t140 = 1.D0+t139
      t141 = t140**(1.D0/3.D0)
      t144 = 1.D0-1.D0*t139
      t145 = t144**(1.D0/3.D0)
      t147 = t141*t140+t145*t144-2.D0
      t148 = t138**2
      t149 = t148**2
      t150 = t106**2
      t151 = t150**2
      t152 = 1/t151
      t153 = t149*t152
      t155 = 1.D0-1.D0*t153
      t158 = 0.3799574853701528D-1*t136*t147*t155
      t160 = 1.D0+0.1274696188700087D0*t108
      t165 = 0.1112037486309468D2*t111+0.3844746237447211D1*t108
     #+0.1644733775567609D1*t114+0.2405871291288192D0*t116
      t168 = 1.D0+0.321646831778707D2/t165
      t169 = dlog(t168)
      t172 = -0.3109D-1*t160*t169+t124
      t173 = t172*t147
      t175 = 0.1923661050931536D1*t173*t153
      t178 = rhoa*t37
      t181 = rhob*t85
      t184 = t106*(-t124+t158+t175)+0.3109D-1*t178*t50+0.3109D-1*t181
     #*t98
      zk(i) = -0.9305257363491D0*t7-0.42D-2*t10*t17
     #-0.3410636806218528D-2*t33*t34*t37*t50-0.9305257363491D0*t55
     #-0.42D-2*t58*t65-0.3410636806218528D-2*t81*t82*t85*t98+t105*t184
      t188 = 1/t6/t20
      t192 = t16**2
      t193 = 1/t192
      t197 = t20*rhoa
      t200 = sigmaaa/t21/t197
      t202 = dsqrt(1.D0+t24)
      t203 = 1/t202
      t212 = 1/t27/t26*t32
      t213 = t20**2
      t217 = t37*t50
      t227 = 1/t21/rhoa
      t232 = 1/t44
      t238 = t46**2
      t239 = 1/t238
      t241 = t39**2
      t242 = t241**2
      t245 = 1/t20
      t256 = -0.1853395810515781D1/t242/t39*t245-0.128158207914907D1
     #*t232*t245-0.8223668877838045D0/t42*t245-0.1603914194192128D0
     #/t35*t245
      t257 = 1/t49
      t262 = t104**2
      t264 = 1/t262*t184
      t268 = 1/t150
      t269 = 1/t116*t268
      t270 = t269*t122
      t271 = 0.2747799777968419D-2*t270
      t272 = t118**2
      t275 = t111**2
      t276 = t275**2
      t279 = 1/t276/t111*t268
      t283 = 1/t114*t268
      t286 = 1/t108*t268
      t291 = t110/t272*(-0.99709173929518D0*t279-0.7418564737168958D0
     #*t269-0.4002143174996817D0*t283-0.1264669550498372D0*t286)/t121
      t292 = 0.1D1*t291
      t296 = 0.8740794299481065D-3*t269*t135*t147*t155
      t297 = t131**2
      t310 = 0.1124999956683108D1*t126/t297*(-0.135956911724794D1*t279
     #-0.7491972878592054D0*t269-0.2150486235638321D0*t283
     #-0.1274341730084892D0*t286)/t134*t147*t155
      t311 = t138*t268
      t312 = 1.D0*t311
      t316 = 1.D0*t107
      t320 = 0.1333333333333333D1*t141*(t107-t312)
     #+0.1333333333333333D1*t145*(-t316+t311)
      t325 = t148*t138*t152
      t326 = 4.D0*t325
      t329 = t149/t151/t106
      t330 = 4.D0*t329
      t337 = t165**2
      t354 = 0.1923661050931536D1*(0.1321010150222857D-2*t269*t169
     #+0.1D1*t160/t337*(-0.1853395810515781D1*t279-0.128158207914907D1
     #*t269-0.8223668877838045D0*t283-0.1603914194192128D0*t286)/t168
     #-0.2747799777968419D-2*t270-0.1D1*t291)*t147*t153
      t358 = t173*t325
      t361 = 0.7694644203726145D1*t173*t329
      vrhoa(i) = -0.12407009817988D1*t6+0.56D-2*t188*sigmaaa*t17
     #+0.42D-2*t10*t193*(-0.336D-1*t11*t188*t13-0.336D-1*t200*t203)
     #-0.6912223927269549D-3*t212/t6/t213*t217*sigmaaa
     #-0.8526592015546319D-3*t28*sigmaaa*t23*t37*t50
     #+0.2273757870812352D-2*t33*t227*t37*t50+0.1449175245975665D-3
     #*t33*t23*t232*t50+0.1097020523068037D0*t33*t34*t37*t239*t256
     #*t257+0.8266666666666667D-2*t264*t200+t105*(-t124+t158+t175+t106
     #*(t271+t292-t296-t310+0.3799574853701528D-1*t136*t320*t155
     #+0.3799574853701528D-1*t136*t147*(-t326+t330)+t354
     #+0.1923661050931536D1*t172*t320*t153+0.7694644203726145D1*t358
     #-t361)+0.3109D-1*t217-0.1321010150222857D-2*t29*t232*t50-0.1D1
     #*t178*t239*t256*t257)
      t376 = 1/t54/t68
      t380 = t64**2
      t381 = 1/t380
      t385 = t68*rhob
      t388 = sigmabb/t69/t385
      t390 = dsqrt(1.D0+t72)
      t391 = 1/t390
      t400 = 1/t75/t74*t80
      t401 = t68**2
      t405 = t85*t98
      t415 = 1/t69/rhob
      t420 = 1/t92
      t426 = t94**2
      t427 = 1/t426
      t429 = t87**2
      t430 = t429**2
      t433 = 1/t68
      t444 = -0.1853395810515781D1/t430/t87*t433-0.128158207914907D1
     #*t420*t433-0.8223668877838045D0/t90*t433-0.1603914194192128D0
     #/t83*t433
      t445 = 1/t97
      t458 = 0.1333333333333333D1*t141*(-t316-t312)
     #+0.1333333333333333D1*t145*(t107+t311)
      vrhob(i) = -0.12407009817988D1*t54+0.56D-2*t376*sigmabb*t65
     #+0.42D-2*t58*t381*(-0.336D-1*t59*t376*t61-0.336D-1*t388*t391)
     #-0.6912223927269549D-3*t400/t54/t401*t405*sigmabb
     #-0.8526592015546319D-3*t76*sigmabb*t71*t85*t98
     #+0.2273757870812352D-2*t81*t415*t85*t98+0.1449175245975665D-3
     #*t81*t71*t420*t98+0.1097020523068037D0*t81*t82*t85*t427*t444
     #*t445+0.8266666666666667D-2*t264*t388+t105*(-t124+t158+t175+t106
     #*(t271+t292-t296-t310+0.3799574853701528D-1*t136*t458*t155
     #+0.3799574853701528D-1*t136*t147*(t326+t330)+t354
     #+0.1923661050931536D1*t172*t458*t153-0.7694644203726145D1*t358
     #-t361)+0.3109D-1*t405-0.1321010150222857D-2*t77*t420*t98-0.1D1
     #*t181*t427*t444*t445)
      vsigmaaa(i) = -0.42D-2*t9*t17+0.42D-2*t10*t193*(0.126D-1/t11*t9
     #*t13+0.126D-1*t23*t203)+0.2592083972726081D-3*t212/t6/t197*t37
     #*t50+0.8526592015546319D-3*t28*t227*t217-0.31D-2*t264*t23
      vsigmaab(i) = 0.D0
      vsigmabb(i) = -0.42D-2*t57*t65+0.42D-2*t58*t381*(0.126D-1/t59
     #*t57*t61+0.126D-1*t71*t391)+0.2592083972726081D-3*t400/t54/t385
     #*t85*t98+0.8526592015546319D-3*t76*t415*t405-0.31D-2*t264*t71
      vtaua(i) = -0.3410636806218528D-2*t28*t34*t217
      vtaub(i) = -0.3410636806218528D-2*t76*t82*t405
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      vtaua(i) = 0.0d0
      vtaub(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      taub = dmax1(0.D0,taub1(i))
      tau = taub
      t3 = rhob**(1.D0/3.D0)
      t4 = t3*rhob
      t6 = 1/t4
      t7 = t6*sigmabb
      t8 = dsqrt(sigmabb)
      t9 = t8*t6
      t10 = dlog(t9+dsqrt(1+t9**2))
      t13 = 1.D0+0.252D-1*t9*t10
      t14 = 1/t13
      t17 = rhob**2
      t18 = t3**2
      t20 = 1/t18/t17
      t21 = sigmabb*t20
      t23 = 1.D0+0.38D-1*t21
      t24 = t23**2
      t25 = 1/t24
      t26 = 1/rhob
      t29 = taub-0.25D0*sigmabb*t26
      t30 = t25*t29
      t31 = 1/t18
      t32 = t26**(1.D0/3.D0)
      t34 = 1.D0+0.1274696188700087D0*t32
      t36 = t26**(1.D0/6.D0)
      t39 = dsqrt(t26)
      t41 = t32**2
      t43 = 0.1112037486309468D2*t36+0.3844746237447211D1*t32
     #+0.1644733775567609D1*t39+0.2405871291288192D0*t41
      t46 = 1.D0+0.321646831778707D2/t43
      t47 = dlog(t46)
      zk(i) = -0.9305257363491D0*t4-0.42D-2*t7*t14
     #-0.3410636806218528D-2*t30*t31*t34*t47
      vrhoa(i) = 0.D0
      t53 = 1/t3/t17
      t54 = t53*sigmabb
      t57 = t13**2
      t58 = 1/t57
      t62 = t17*rhob
      t64 = 1/t18/t62
      t66 = 1.D0+t21
      t67 = dsqrt(t66)
      t68 = 1/t67
      t71 = -0.336D-1*t8*t53*t10-0.336D-1*sigmabb*t64*t68
      t72 = t58*t71
      t76 = 1/t24/t23
      t77 = t76*t29
      t78 = t17**2
      t80 = 1/t3/t78
      t82 = t34*t47
      t83 = t82*sigmabb
      t86 = t25*sigmabb
      t88 = t20*t34*t47
      t92 = 1/t18/rhob
      t97 = 1/t41
      t102 = t30*t31
      t103 = t43**2
      t104 = 1/t103
      t105 = t34*t104
      t106 = t36**2
      t107 = t106**2
      t108 = t107*t36
      t109 = 1/t108
      t110 = 1/t17
      t115 = 1/t39
      t118 = 1/t32
      t121 = -0.1853395810515781D1*t109*t110-0.128158207914907D1*t97
     #*t110-0.8223668877838045D0*t115*t110-0.1603914194192128D0*t118
     #*t110
      t122 = 1/t46
      t123 = t121*t122
      t124 = t105*t123
      vrhob(i) = -0.12407009817988D1*t3+0.56D-2*t54*t14+0.42D-2*t7*t72
     #-0.6912223927269549D-3*t77*t80*t83-0.8526592015546319D-3*t86*t88
     #+0.2273757870812352D-2*t30*t92*t34*t47+0.1449175245975665D-3*t30
     #*t20*t97*t47+0.1097020523068037D0*t102*t124
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      t135 = 0.126D-1/t8*t6*t10+0.126D-1*t20*t68
      t140 = 1/t3/t62
      t146 = t25*t92*t82
      vsigmabb(i) = -0.42D-2*t6*t14+0.42D-2*t7*t58*t135
     #+0.2592083972726081D-3*t77*t140*t34*t47+0.8526592015546319D-3*t146
      t148 = t25*t31
      vtaub(i) = -0.3410636806218528D-2*t148*t82
      vtaua(i) = 0.0d0
      v2rhoa2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t158 = 1/t18/t78
      t168 = t78*t17
      t170 = 1/t3/t168
      t172 = t97*t47
      t178 = t104*t121
      t187 = t24**2
      t189 = 1/t187*t29
      t190 = t78**2
      t193 = sigmabb**2
      t212 = 1/t3/t78/rhob
      t217 = 1/t57/t13
      t218 = t71**2
      t233 = 1/t67/t66
      t242 = 1/t78
      t245 = 1/t62
      t249 = 1/t41/t26
      t274 = t121**2
      t288 = t103**2
      t291 = t46**2
      s1 = -0.3456111963634775D-3*t76*t193*t170*t34*t47
     #-0.4830584153252216D-3*t30*t64*t97*t47-0.1462694030757383D0*t30
     #*t92*t124+0.3456111963634775D-2*t77*t212*t83-0.84D-2*t7*t217*t218
      t297 = s1+0.42D-2*t7*t58*(0.784D-1*t8*t140*t10+0.168D0*sigmabb
     #*t158*t68-0.448D-1*t193/t3/t78/t62*t233)+0.1097020523068037D0
     #*t102*t105*(-0.1544496508763151D1/t108/t26*t242
     #+0.3706791621031562D1*t109*t245-0.854388052766047D0*t249*t242
     #+0.2563164158298141D1*t97*t245-0.4111834438919023D0/t39/t26*t242
     #+0.1644733775567609D1*t115*t245-0.5346380647307093D-1/t32/t26
     #*t242+0.3207828388384256D0*t118*t245)*t122-0.2194041046136074D0
     #*t102*t34/t103/t43*t274*t122+0.9661168306504433D-4*t30*t158*t249
     #*t47-0.932245253120402D-2*t30*t20*t97*t104*t123
     #+0.3528531756410541D1*t102*t34/t288*t274/t291
      v2rhob2(i) = -0.4135669939329333D0*t31-0.1306666666666667D-1
     #*t140*sigmabb*t14-0.112D-1*t54*t72+0.7245876229878325D-4*t86
     #*t158*t97*t47+0.5485102615340186D-1*t86*t20*t124
     #-0.378959645135392D-2*t30*t88+0.5873990330354695D-4*t77*t170
     #*t172*sigmabb+0.4446589853502444D-1*t77*t80*t34*t178*t122
     #*sigmabb+0.284219733851544D-2*t86*t64*t34*t47
     #-0.2101316073889943D-3*t189/t190*t82*t193+t297
      v2sigmaaa2(i) = 0.D0
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      t301 = t135**2
      t325 = t76*t80
      v2sigmabb2(i) = 0.84D-2*t6*t58*t135-0.84D-2*t7*t217*t301+0.42D-2
     #*t7*t58*(-0.63D-2/t8/sigmabb*t6*t10+0.63D-2/sigmabb*t20*t68
     #-0.63D-2*t212*t233)-0.2954975728907732D-4*t189/t168*t34*t47
     #-0.129604198636304D-3*t325*t82
      v2taua2(i) = 0.D0
      v2taub2(i) = 0.D0
      v2tauab(i) = 0.D0
      v2rhoataua(i) = 0.D0
      v2rhoataub(i) = 0.D0
      v2rhobtaua(i) = 0.D0
      v2rhobtaub(i) = -0.6912223927269549D-3*t325*t83
     #+0.2273757870812352D-2*t146+0.1449175245975665D-3*t25*t20*t172
     #+0.1097020523068037D0*t148*t34*t178*t122
      v2sigmaaataua(i) = 0.D0
      v2sigmaaataub(i) = 0.D0
      v2sigmaabtaua(i) = 0.D0
      v2sigmaabtaub(i) = 0.D0
      v2sigmabbtaua(i) = 0.D0
      v2sigmabbtaub(i) = 0.2592083972726081D-3*t76*t140*t82
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      taua = dmax1(0.D0,taua1(i))
      tau = taua
      t3 = rhoa**(1.D0/3.D0)
      t4 = t3*rhoa
      t6 = 1/t4
      t7 = t6*sigmaaa
      t8 = dsqrt(sigmaaa)
      t9 = t8*t6
      t10 = dlog(t9+dsqrt(1+t9**2))
      t13 = 1.D0+0.252D-1*t9*t10
      t14 = 1/t13
      t17 = rhoa**2
      t18 = t3**2
      t20 = 1/t18/t17
      t21 = sigmaaa*t20
      t23 = 1.D0+0.38D-1*t21
      t24 = t23**2
      t25 = 1/t24
      t26 = 1/rhoa
      t29 = taua-0.25D0*sigmaaa*t26
      t30 = t25*t29
      t31 = 1/t18
      t32 = t26**(1.D0/3.D0)
      t34 = 1.D0+0.1274696188700087D0*t32
      t36 = t26**(1.D0/6.D0)
      t39 = dsqrt(t26)
      t41 = t32**2
      t43 = 0.1112037486309468D2*t36+0.3844746237447211D1*t32
     #+0.1644733775567609D1*t39+0.2405871291288192D0*t41
      t46 = 1.D0+0.321646831778707D2/t43
      t47 = dlog(t46)
      zk(i) = -0.9305257363491D0*t4-0.42D-2*t7*t14
     #-0.3410636806218528D-2*t30*t31*t34*t47
      t53 = 1/t3/t17
      t54 = t53*sigmaaa
      t57 = t13**2
      t58 = 1/t57
      t62 = t17*rhoa
      t64 = 1/t18/t62
      t66 = 1.D0+t21
      t67 = dsqrt(t66)
      t68 = 1/t67
      t71 = -0.336D-1*t8*t53*t10-0.336D-1*sigmaaa*t64*t68
      t72 = t58*t71
      t76 = 1/t24/t23
      t77 = t76*t29
      t78 = t17**2
      t80 = 1/t3/t78
      t82 = t34*t47
      t83 = t82*sigmaaa
      t86 = t25*sigmaaa
      t88 = t20*t34*t47
      t92 = 1/t18/rhoa
      t97 = 1/t41
      t102 = t30*t31
      t103 = t43**2
      t104 = 1/t103
      t105 = t34*t104
      t106 = t36**2
      t107 = t106**2
      t108 = t107*t36
      t109 = 1/t108
      t110 = 1/t17
      t115 = 1/t39
      t118 = 1/t32
      t121 = -0.1853395810515781D1*t109*t110-0.128158207914907D1*t97
     #*t110-0.8223668877838045D0*t115*t110-0.1603914194192128D0*t118
     #*t110
      t122 = 1/t46
      t123 = t121*t122
      t124 = t105*t123
      vrhoa(i) = -0.12407009817988D1*t3+0.56D-2*t54*t14+0.42D-2*t7*t72
     #-0.6912223927269549D-3*t77*t80*t83-0.8526592015546319D-3*t86*t88
     #+0.2273757870812352D-2*t30*t92*t34*t47+0.1449175245975665D-3*t30
     #*t20*t97*t47+0.1097020523068037D0*t102*t124
      vrhob(i) = 0.D0
      t135 = 0.126D-1/t8*t6*t10+0.126D-1*t20*t68
      t140 = 1/t3/t62
      t146 = t25*t92*t82
      vsigmaaa(i) = -0.42D-2*t6*t14+0.42D-2*t7*t58*t135
     #+0.2592083972726081D-3*t77*t140*t34*t47+0.8526592015546319D-3*t146
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      t148 = t25*t31
      vtaua(i) = -0.3410636806218528D-2*t148*t82
      vtaub(i) = 0.0d0
      t152 = 1/t18/t78
      t165 = 1/t78
      t168 = 1/t62
      t172 = 1/t41/t26
      t201 = t121**2
      t217 = t103**2
      t220 = t46**2
      t239 = sigmaaa**2
      t245 = 1/t67/t66
      t253 = 1/t57/t13
      t254 = t71**2
      t260 = 1/t3/t78/rhoa
      t264 = t24**2
      t266 = 1/t264*t29
      t267 = t78**2
      t274 = t78*t17
      t276 = 1/t3/t274
      t282 = t97*t47
      t288 = t104*t121
      t297 = -0.4135669939329333D0*t31-0.1306666666666667D-1*t140
     #*sigmaaa*t14-0.112D-1*t54*t72+0.42D-2*t7*t58*(0.784D-1*t8*t140
     #*t10+0.168D0*sigmaaa*t152*t68-0.448D-1*t239/t3/t78/t62*t245)
     #-0.84D-2*t7*t253*t254+0.3456111963634775D-2*t77*t260*t83
     #-0.2101316073889943D-3*t266/t267*t82*t239-0.3456111963634775D-3
     #*t76*t239*t276*t34*t47+0.5873990330354695D-4*t77*t276*t282
     #*sigmaaa+0.4446589853502444D-1*t77*t80*t34*t288*t122*sigmaaa
     #+0.284219733851544D-2*t86*t64*t34*t47
      v2rhoa2(i) = 0.7245876229878325D-4*t86*t152*t97*t47
     #-0.1462694030757383D0*t30*t92*t124+0.5485102615340186D-1*t86*t20
     #*t124+0.1097020523068037D0*t102*t105*(-0.1544496508763151D1/t108
     #/t26*t165+0.3706791621031562D1*t109*t168-0.854388052766047D0
     #*t172*t165+0.2563164158298141D1*t97*t168-0.4111834438919023D0
     #/t39/t26*t165+0.1644733775567609D1*t115*t168
     #-0.5346380647307093D-1/t32/t26*t165+0.3207828388384256D0*t118
     #*t168)*t122-0.4830584153252216D-3*t30*t64*t97*t47
     #-0.2194041046136074D0*t102*t34/t103/t43*t201*t122
     #-0.378959645135392D-2*t30*t88-0.932245253120402D-2*t30*t20*t97
     #*t104*t123+0.9661168306504433D-4*t30*t152*t172*t47
     #+0.3528531756410541D1*t102*t34/t217*t201/t220+t297
      v2rhob2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t301 = t135**2
      t325 = t76*t80
      v2sigmaaa2(i) = 0.84D-2*t6*t58*t135-0.84D-2*t7*t253*t301+0.42D-2
     #*t7*t58*(-0.63D-2/t8/sigmaaa*t6*t10+0.63D-2/sigmaaa*t20*t68
     #-0.63D-2*t260*t245)-0.2954975728907732D-4*t266/t274*t34*t47
     #-0.129604198636304D-3*t325*t82
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      v2sigmabb2(i) = 0.D0
      v2taua2(i) = 0.D0
      v2taub2(i) = 0.D0
      v2tauab(i) = 0.D0
      v2rhoataua(i) = -0.6912223927269549D-3*t325*t83
     #+0.2273757870812352D-2*t146+0.1449175245975665D-3*t25*t20*t282
     #+0.1097020523068037D0*t148*t34*t288*t122
      v2rhoataub(i) = 0.D0
      v2rhobtaua(i) = 0.D0
      v2rhobtaub(i) = 0.D0
      v2sigmaaataua(i) = 0.2592083972726081D-3*t76*t140*t82
      v2sigmaaataub(i) = 0.D0
      v2sigmaabtaua(i) = 0.D0
      v2sigmaabtaub(i) = 0.D0
      v2sigmabbtaua(i) = 0.D0
      v2sigmabbtaub(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      taua = dmax1(0.D0,taua1(i))
      taub = dmax1(0.D0,taub1(i))
      tau = taua+taub
      t6 = rhoa**(1.D0/3.D0)
      t7 = t6*rhoa
      t9 = 1/t7
      t10 = t9*sigmaaa
      t11 = dsqrt(sigmaaa)
      t12 = t11*t9
      t13 = dlog(t12+dsqrt(1+t12**2))
      t16 = 1.D0+0.252D-1*t12*t13
      t17 = 1/t16
      t20 = rhoa**2
      t21 = t6**2
      t23 = 1/t21/t20
      t24 = sigmaaa*t23
      t26 = 1.D0+0.38D-1*t24
      t27 = t26**2
      t28 = 1/t27
      t29 = 1/rhoa
      t32 = taua-0.25D0*sigmaaa*t29
      t33 = t28*t32
      t34 = 1/t21
      t35 = t29**(1.D0/3.D0)
      t37 = 1.D0+0.1274696188700087D0*t35
      t39 = t29**(1.D0/6.D0)
      t42 = dsqrt(t29)
      t44 = t35**2
      t46 = 0.1112037486309468D2*t39+0.3844746237447211D1*t35
     #+0.1644733775567609D1*t42+0.2405871291288192D0*t44
      t49 = 1.D0+0.321646831778707D2/t46
      t50 = dlog(t49)
      t54 = rhob**(1.D0/3.D0)
      t55 = t54*rhob
      t57 = 1/t55
      t58 = t57*sigmabb
      t59 = dsqrt(sigmabb)
      t60 = t59*t57
      t61 = dlog(t60+dsqrt(1+t60**2))
      t64 = 1.D0+0.252D-1*t60*t61
      t65 = 1/t64
      t68 = rhob**2
      t69 = t54**2
      t71 = 1/t69/t68
      t72 = sigmabb*t71
      t74 = 1.D0+0.38D-1*t72
      t75 = t74**2
      t76 = 1/t75
      t77 = 1/rhob
      t80 = taub-0.25D0*sigmabb*t77
      t81 = t76*t80
      t82 = 1/t69
      t83 = t77**(1.D0/3.D0)
      t85 = 1.D0+0.1274696188700087D0*t83
      t87 = t77**(1.D0/6.D0)
      t90 = dsqrt(t77)
      t92 = t83**2
      t94 = 0.1112037486309468D2*t87+0.3844746237447211D1*t83
     #+0.1644733775567609D1*t90+0.2405871291288192D0*t92
      t97 = 1.D0+0.321646831778707D2/t94
      t98 = dlog(t97)
      t104 = 1.D0+0.31D-2*t24+0.31D-2*t72
      t105 = 1/t104
      t106 = rhoa+rhob
      t107 = 1/t106
      t108 = t107**(1.D0/3.D0)
      t110 = 1.D0+0.1325688999052018D0*t108
      t111 = t107**(1.D0/6.D0)
      t114 = dsqrt(t107)
      t116 = t108**2
      t118 = 0.598255043577108D1*t111+0.2225569421150687D1*t108
     #+0.8004286349993634D0*t114+0.1897004325747559D0*t116
      t121 = 1.D0+0.160818243221511D2/t118
      t122 = dlog(t121)
      t124 = 0.62182D-1*t110*t122
      t126 = 1.D0+0.6901399211255825D-1*t108
      t131 = 0.8157414703487641D1*t111+0.2247591863577616D1*t108
     #+0.4300972471276643D0*t114+0.1911512595127338D0*t116
      t134 = 1.D0+0.2960857464321668D2/t131
      t135 = dlog(t134)
      t136 = t126*t135
      t138 = rhoa-1.D0*rhob
      t139 = t138*t107
      t140 = 1.D0+t139
      t141 = t140**(1.D0/3.D0)
      t144 = 1.D0-1.D0*t139
      t145 = t144**(1.D0/3.D0)
      t147 = t141*t140+t145*t144-2.D0
      t148 = t138**2
      t149 = t148**2
      t150 = t106**2
      t151 = t150**2
      t152 = 1/t151
      t153 = t149*t152
      t155 = 1.D0-1.D0*t153
      t156 = t147*t155
      t158 = 0.3799574853701528D-1*t136*t156
      t160 = 1.D0+0.1274696188700087D0*t108
      t165 = 0.1112037486309468D2*t111+0.3844746237447211D1*t108
     #+0.1644733775567609D1*t114+0.2405871291288192D0*t116
      t168 = 1.D0+0.321646831778707D2/t165
      t169 = dlog(t168)
      t172 = -0.3109D-1*t160*t169+t124
      t173 = t172*t147
      t175 = 0.1923661050931536D1*t173*t153
      t178 = rhoa*t37
      t181 = rhob*t85
      t184 = t106*(-t124+t158+t175)+0.3109D-1*t178*t50+0.3109D-1*t181
     #*t98
      zk(i) = -0.9305257363491D0*t7-0.42D-2*t10*t17
     #-0.3410636806218528D-2*t33*t34*t37*t50-0.9305257363491D0*t55
     #-0.42D-2*t58*t65-0.3410636806218528D-2*t81*t82*t85*t98+t105*t184
      t188 = 1/t6/t20
      t189 = t188*sigmaaa
      t192 = t16**2
      t193 = 1/t192
      t197 = t20*rhoa
      t199 = 1/t21/t197
      t200 = sigmaaa*t199
      t201 = 1.D0+t24
      t202 = dsqrt(t201)
      t203 = 1/t202
      t206 = -0.336D-1*t11*t188*t13-0.336D-1*t200*t203
      t207 = t193*t206
      t211 = 1/t27/t26
      t212 = t211*t32
      t213 = t20**2
      t215 = 1/t6/t213
      t217 = t37*t50
      t218 = t217*sigmaaa
      t221 = t28*sigmaaa
      t223 = t23*t37*t50
      t227 = 1/t21/rhoa
      t232 = 1/t44
      t237 = t33*t34
      t238 = t46**2
      t239 = 1/t238
      t240 = t37*t239
      t241 = t39**2
      t242 = t241**2
      t243 = t242*t39
      t244 = 1/t243
      t245 = 1/t20
      t250 = 1/t42
      t253 = 1/t35
      t256 = -0.1853395810515781D1*t244*t245-0.128158207914907D1*t232
     #*t245-0.8223668877838045D0*t250*t245-0.1603914194192128D0*t253
     #*t245
      t257 = 1/t49
      t258 = t256*t257
      t259 = t240*t258
      t262 = t104**2
      t263 = 1/t262
      t264 = t263*t184
      t267 = 1/t116
      t268 = 1/t150
      t269 = t267*t268
      t270 = t269*t122
      t271 = 0.2747799777968419D-2*t270
      t272 = t118**2
      t273 = 1/t272
      t274 = t110*t273
      t275 = t111**2
      t276 = t275**2
      t277 = t276*t111
      t278 = 1/t277
      t279 = t278*t268
      t282 = 1/t114
      t283 = t282*t268
      t285 = 1/t108
      t286 = t285*t268
      t288 = -0.99709173929518D0*t279-0.7418564737168958D0*t269
     #-0.4002143174996817D0*t283-0.1264669550498372D0*t286
      t289 = 1/t121
      t291 = t274*t288*t289
      t292 = 0.1D1*t291
      t293 = t135*t147
      t294 = t293*t155
      t295 = t269*t294
      t296 = 0.8740794299481065D-3*t295
      t297 = t131**2
      t298 = 1/t297
      t299 = t126*t298
      t304 = -0.135956911724794D1*t279-0.7491972878592054D0*t269
     #-0.2150486235638321D0*t283-0.1274341730084892D0*t286
      t305 = t299*t304
      t306 = 1/t134
      t307 = t306*t147
      t308 = t307*t155
      t309 = t305*t308
      t310 = 0.1124999956683108D1*t309
      t311 = t138*t268
      t312 = 1.D0*t311
      t313 = t107-t312
      t316 = 1.D0*t107
      t317 = -t316+t311
      t320 = 0.1333333333333333D1*t141*t313+0.1333333333333333D1*t145
     #*t317
      t322 = t136*t320*t155
      t323 = 0.3799574853701528D-1*t322
      t324 = t148*t138
      t325 = t324*t152
      t326 = 4.D0*t325
      t328 = 1/t151/t106
      t329 = t149*t328
      t330 = 4.D0*t329
      t331 = -t326+t330
      t333 = t136*t147*t331
      t334 = 0.3799574853701528D-1*t333
      t337 = t165**2
      t338 = 1/t337
      t339 = t160*t338
      t344 = -0.1853395810515781D1*t279-0.128158207914907D1*t269
     #-0.8223668877838045D0*t283-0.1603914194192128D0*t286
      t345 = 1/t168
      t351 = 0.1321010150222857D-2*t269*t169+0.1D1*t339*t344*t345
     #-0.2747799777968419D-2*t270-0.1D1*t291
      t352 = t351*t147
      t353 = t352*t153
      t354 = 0.1923661050931536D1*t353
      t355 = t172*t320
      t356 = t355*t153
      t357 = 0.1923661050931536D1*t356
      t358 = t173*t325
      t360 = t173*t329
      t361 = 0.7694644203726145D1*t360
      t365 = t29*t232
      t368 = t239*t256
      t369 = t368*t257
      t372 = -t124+t158+t175+t106*(t271+t292-t296-t310+t323+t334+t354
     #+t357+0.7694644203726145D1*t358-t361)+0.3109D-1*t217
     #-0.1321010150222857D-2*t365*t50-0.1D1*t178*t369
      vrhoa(i) = -0.12407009817988D1*t6+0.56D-2*t189*t17+0.42D-2*t10
     #*t207-0.6912223927269549D-3*t212*t215*t218-0.8526592015546319D-3
     #*t221*t223+0.2273757870812352D-2*t33*t227*t37*t50
     #+0.1449175245975665D-3*t33*t23*t232*t50+0.1097020523068037D0
     #*t237*t259+0.8266666666666667D-2*t264*t200+t105*t372
      t376 = 1/t54/t68
      t377 = t376*sigmabb
      t380 = t64**2
      t381 = 1/t380
      t385 = t68*rhob
      t387 = 1/t69/t385
      t388 = sigmabb*t387
      t389 = 1.D0+t72
      t390 = dsqrt(t389)
      t391 = 1/t390
      t394 = -0.336D-1*t59*t376*t61-0.336D-1*t388*t391
      t395 = t381*t394
      t399 = 1/t75/t74
      t400 = t399*t80
      t401 = t68**2
      t403 = 1/t54/t401
      t405 = t85*t98
      t406 = t405*sigmabb
      t409 = t76*sigmabb
      t411 = t71*t85*t98
      t415 = 1/t69/rhob
      t420 = 1/t92
      t425 = t81*t82
      t426 = t94**2
      t427 = 1/t426
      t428 = t85*t427
      t429 = t87**2
      t430 = t429**2
      t431 = t430*t87
      t432 = 1/t431
      t433 = 1/t68
      t438 = 1/t90
      t441 = 1/t83
      t444 = -0.1853395810515781D1*t432*t433-0.128158207914907D1*t420
     #*t433-0.8223668877838045D0*t438*t433-0.1603914194192128D0*t441
     #*t433
      t445 = 1/t97
      t446 = t444*t445
      t447 = t428*t446
      t452 = -t316-t312
      t455 = t107+t311
      t458 = 0.1333333333333333D1*t141*t452+0.1333333333333333D1*t145
     #*t455
      t460 = t136*t458*t155
      t461 = 0.3799574853701528D-1*t460
      t462 = t326+t330
      t464 = t136*t147*t462
      t465 = 0.3799574853701528D-1*t464
      t466 = t172*t458
      t467 = t466*t153
      t468 = 0.1923661050931536D1*t467
      t473 = t77*t420
      t476 = t427*t444
      t477 = t476*t445
      t480 = -t124+t158+t175+t106*(t271+t292-t296-t310+t461+t465+t354
     #+t468-0.7694644203726145D1*t358-t361)+0.3109D-1*t405
     #-0.1321010150222857D-2*t473*t98-0.1D1*t181*t477
      vrhob(i) = -0.12407009817988D1*t54+0.56D-2*t377*t65+0.42D-2*t58
     #*t395-0.6912223927269549D-3*t400*t403*t406-0.8526592015546319D-3
     #*t409*t411+0.2273757870812352D-2*t81*t415*t85*t98
     #+0.1449175245975665D-3*t81*t71*t420*t98+0.1097020523068037D0
     #*t425*t447+0.8266666666666667D-2*t264*t388+t105*t480
      t484 = 1/t11
      t490 = 0.126D-1*t484*t9*t13+0.126D-1*t23*t203
      t491 = t193*t490
      t495 = 1/t6/t197
      t500 = t28*t227
      t501 = t500*t217
      vsigmaaa(i) = -0.42D-2*t9*t17+0.42D-2*t10*t491
     #+0.2592083972726081D-3*t212*t495*t37*t50+0.8526592015546319D-3
     #*t501-0.31D-2*t264*t23
      vsigmaab(i) = 0.D0
      t507 = 1/t59
      t513 = 0.126D-1*t507*t57*t61+0.126D-1*t71*t391
      t514 = t381*t513
      t518 = 1/t54/t385
      t523 = t76*t415
      t524 = t523*t405
      vsigmabb(i) = -0.42D-2*t57*t65+0.42D-2*t58*t514
     #+0.2592083972726081D-3*t400*t518*t85*t98+0.8526592015546319D-3
     #*t524-0.31D-2*t264*t71
      t528 = t28*t34
      vtaua(i) = -0.3410636806218528D-2*t528*t217
      t531 = t76*t82
      vtaub(i) = -0.3410636806218528D-2*t531*t405
      t536 = 1/t192/t16
      t537 = t206**2
      t548 = 1/t21/t213
      t561 = sigmaaa*t548
      t564 = sigmaaa**2
      t565 = t213*t197
      t568 = t564/t6/t565
      t570 = 1/t202/t201
      t588 = t213*t20
      t590 = 1/t6/t588
      t595 = -0.4135669939329333D0*t34-0.84D-2*t10*t536*t537
     #-0.4830584153252216D-3*t33*t199*t232*t50-0.378959645135392D-2
     #*t33*t223+0.7245876229878325D-4*t221*t548*t232*t50
     #-0.1462694030757383D0*t33*t227*t259-0.112D-1*t189*t207+0.42D-2
     #*t10*t193*(0.784D-1*t11*t495*t13+0.168D0*t561*t203-0.448D-1*t568
     #*t570)+0.5485102615340186D-1*t221*t23*t259-0.1306666666666667D-1
     #*t495*sigmaaa*t17+0.284219733851544D-2*t221*t199*t37*t50
     #-0.3456111963634775D-3*t211*t564*t590*t37*t50
      t596 = t27**2
      t598 = 1/t596*t32
      t599 = t213**2
      t606 = t232*t50
      t611 = 1/t44/t29
      t616 = t215*t37
      t624 = 1/t6/t213/rhoa
      t629 = 1/t238/t46
      t631 = t256**2
      t638 = 1/t213
      t641 = 1/t197
      t660 = -0.1544496508763151D1/t243/t29*t638+0.3706791621031562D1
     #*t244*t641-0.854388052766047D0*t611*t638+0.2563164158298141D1
     #*t232*t641-0.4111834438919023D0/t42/t29*t638
     #+0.1644733775567609D1*t250*t641-0.5346380647307093D-1/t35/t29
     #*t638+0.3207828388384256D0*t253*t641
      t669 = 1/t262/t104*t184
      t672 = t263*t372
      t680 = t238**2
      t681 = 1/t680
      t683 = t49**2
      t684 = 1/t683
      t689 = 0.2D1*t291
      t690 = 0.5495599555936838D-2*t270
      t693 = 0.1538928840745229D2*t360
      t696 = 0.1748158859896213D-2*t295
      t697 = 0.2249999913366216D1*t309
      t698 = 0.3847322101863073D1*t353
      t700 = t355*t325
      t702 = t352*t325
      t706 = t149/t151/t150
      t708 = 0.3847322101863073D2*t173*t706
      t710 = 0.1538928840745229D2*t352*t329
      t713 = 1/t277/t107*t152
      t716 = 1/t150/t106
      t717 = t278*t716
      t721 = 1/t116/t107*t152
      t723 = t267*t716
      t727 = 1/t114/t107*t152
      t729 = t282*t716
      t733 = 1/t108/t107*t152
      t735 = t285*t716
      t740 = 0.1124999956683108D1*t299*(-0.1132974264373283D1*t713
     #+0.271913823449588D1*t717-0.4994648585728036D0*t721
     #+0.1498394575718411D1*t723-0.1075243117819161D0*t727
     #+0.4300972471276643D0*t729-0.4247805766949639D-1*t733
     #+0.2548683460169784D0*t735)*t308
      t745 = 0.5176049209143758D-1*t269*t298*t304*t306*t156
      t749 = t304**2
      t752 = 0.2249999913366216D1*t126/t297/t131*t749*t308
      t753 = t355*t329
      t756 = t351*t320*t153
      t759 = 0.5827196199654043D-3*t721*t294
      t762 = t269*t135*t320*t155
      t765 = t269*t293*t331
      t768 = 0.1748158859896213D-2*t723*t294
      t769 = t141**2
      t770 = 1/t769
      t771 = t313**2
      t774 = 2.D0*t268
      t776 = 2.D0*t138*t716
      t777 = -t774+t776
      t780 = t145**2
      t781 = 1/t780
      t782 = t317**2
      t788 = 0.4444444444444444D0*t770*t771+0.1333333333333333D1*t141
     #*t777+0.4444444444444444D0*t781*t782-0.1333333333333333D1*t145
     #*t777
      t792 = 0.1538928840745229D2*t700+0.1538928840745229D2*t702+t708
     #-t710-t740+t745+t752-0.1538928840745229D2*t753
     #+0.3847322101863073D1*t756-t759-0.1748158859896213D-2*t762
     #-0.1748158859896213D-2*t765+t768+0.3799574853701528D-1*t136*t788
     #*t155
      t796 = t288**2
      t798 = t110/t272/t118*t796*t289
      t799 = 0.2D1*t798
      t800 = t272**2
      t803 = t121**2
      t806 = t110/t800*t796/t803
      t807 = 0.160818243221511D2*t806
      t819 = t344**2
      t835 = t337**2
      t838 = t168**2
      t843 = t721*t122
      t845 = t723*t122
      t849 = t269*t273*t288*t289
      t862 = t274*(-0.8309097827459833D0*t713+0.199418347859036D1*t717
     #-0.4945709824779306D0*t721+0.1483712947433792D1*t723
     #-0.2001071587498409D0*t727+0.8004286349993634D0*t729
     #-0.4215565168327908D-1*t733+0.2529339100996745D0*t735)*t289
      t865 = 0.8806734334819047D-3*t721*t169-0.2642020300445714D-2
     #*t723*t169-0.8497974591333914D-1*t269*t338*t344*t345-0.2D1*t160
     #/t337/t165*t819*t345+0.1D1*t339*(-0.1544496508763151D1*t713
     #+0.3706791621031562D1*t717-0.854388052766047D0*t721
     #+0.2563164158298141D1*t723-0.4111834438919023D0*t727
     #+0.1644733775567609D1*t729-0.5346380647307093D-1*t733
     #+0.3207828388384256D0*t735)*t345+0.321646831778707D2*t160/t835
     #*t819/t838-0.1831866518645613D-2*t843+0.5495599555936838D-2*t845
     #+0.8837926660346786D-1*t849+0.2D1*t798-0.1D1*t862
     #-0.160818243221511D2*t806
      t868 = 0.1923661050931536D1*t865*t147*t153
      t869 = t148*t152
      t870 = 12.D0*t869
      t871 = t324*t328
      t872 = 32.D0*t871
      t873 = 20.D0*t706
      t881 = 0.1831866518645613D-2*t843
      t882 = t297**2
      t886 = t134**2
      t891 = 0.3330964519106732D2*t126/t882*t749/t886*t147*t155
      t892 = 0.1D1*t862
      t895 = t305*t306*t320*t155
      t897 = 0.5495599555936838D-2*t845
      t898 = 0.8837926660346786D-1*t849
      t900 = t305*t307*t331
      t905 = t173*t869
      t906 = 0.2308393261117844D2*t905
      t907 = t173*t871
      t909 = -t799+t807+t868+0.3799574853701528D-1*t136*t147*(-t870
     #+t872-t873)+0.7599149707403056D-1*t136*t320*t331+t881-t891+t892
     #-0.2249999913366216D1*t895-t897-t898-0.2249999913366216D1*t900
     #+0.1923661050931536D1*t172*t788*t153+t906-0.6155715362980916D2
     #*t907
      t929 = t689+t690+0.1538928840745229D2*t358+0.3847322101863073D1
     #*t356-t693+0.7599149707403056D-1*t322+0.7599149707403056D-1*t333
     #-t696-t697+t698-0.2D1*t259+t106*(t792+t909)-0.321646831778707D2
     #*t178*t681*t631*t684-0.1D1*t178*t239*t660*t257
     #-0.8806734334819047D-3*t641*t611*t50+0.8497974591333914D-1*t365
     #*t369+0.2D1*t178*t629*t631*t257
      t931 = -0.2101316073889943D-3*t598/t599*t217*t564
     #+0.5873990330354695D-4*t212*t590*t606*sigmaaa
     #+0.9661168306504433D-4*t33*t548*t611*t50+0.4446589853502444D-1
     #*t212*t616*t368*t257*sigmaaa+0.3456111963634775D-2*t212*t624
     #*t218-0.2194041046136074D0*t237*t37*t629*t631*t257
     #+0.1097020523068037D0*t237*t240*t660*t257-0.3031111111111111D-1
     #*t264*t561+0.1366755555555556D-3*t669*t568+0.1653333333333333D-1
     #*t672*t200-0.932245253120402D-2*t33*t23*t232*t239*t258
     #+0.3528531756410541D1*t237*t37*t681*t631*t684+t105*t929
      v2rhoa2(i) = t595+t931
      t932 = sigmabb**2
      t933 = t401*t385
      t936 = t932/t54/t933
      t940 = 1/t69/t401
      t941 = sigmabb*t940
      t947 = 1/t380/t64
      t948 = t394**2
      t966 = t351*t458*t153
      t968 = t466*t329
      t970 = t466*t325
      t973 = t269*t293*t462
      t975 = t452**2
      t978 = t774+t776
      t981 = t455**2
      t987 = 0.4444444444444444D0*t770*t975+0.1333333333333333D1*t141
     #*t978+0.4444444444444444D0*t781*t981-0.1333333333333333D1*t145
     #*t978
      t991 = -0.1538928840745229D2*t702+t708-t710-t740+t745+t752-t759
     #+0.7599149707403056D-1*t136*t458*t462+0.3799574853701528D-1*t136
     #*t147*(-t870-t872-t873)+0.3847322101863073D1*t966
     #-0.1538928840745229D2*t968-0.1538928840745229D2*t970
     #-0.1748158859896213D-2*t973+0.3799574853701528D-1*t136*t987*t155
      t994 = t305*t306*t458*t155
      t998 = t269*t135*t458*t155
      t1001 = t305*t307*t462
      t1007 = -0.2249999913366216D1*t994-0.1748158859896213D-2*t998
     #-0.2249999913366216D1*t1001+t768+0.1923661050931536D1*t172*t987
     #*t153-t799+t807+t868+t881-t891+t892-t897-t898+t906
     #+0.6155715362980916D2*t907
      t1011 = 1/t385
      t1013 = 1/t92/t77
      t1020 = 1/t426/t94
      t1021 = t444**2
      t1028 = 1/t401
      t1049 = -0.1544496508763151D1/t431/t77*t1028
     #+0.3706791621031562D1*t432*t1011-0.854388052766047D0*t1013*t1028
     #+0.2563164158298141D1*t420*t1011-0.4111834438919023D0/t90/t77
     #*t1028+0.1644733775567609D1*t438*t1011-0.5346380647307093D-1/t83
     #/t77*t1028+0.3207828388384256D0*t441*t1011
      t1054 = t426**2
      t1055 = 1/t1054
      t1057 = t97**2
      t1058 = 1/t1057
      t1062 = t689+t690-0.1538928840745229D2*t358-t693-t696-t697+t698
     #+0.7599149707403056D-1*t460+0.7599149707403056D-1*t464
     #+0.3847322101863073D1*t467+t106*(t991+t1007)-0.2D1*t447
     #-0.8806734334819047D-3*t1011*t1013*t98+0.8497974591333914D-1
     #*t473*t477+0.2D1*t181*t1020*t1021*t445-0.1D1*t181*t427*t1049
     #*t445-0.321646831778707D2*t181*t1055*t1021*t1058
      t1070 = 1/t390/t389
      t1082 = t263*t480
      t1090 = 1/t54/t401/rhob
      t1095 = t401*t68
      t1097 = 1/t54/t1095
      t1102 = 0.1366755555555556D-3*t669*t936-0.3031111111111111D-1
     #*t264*t941-0.112D-1*t377*t395-0.84D-2*t58*t947*t948
     #-0.4135669939329333D0*t82+t105*t1062+0.42D-2*t58*t381*(0.784D-1
     #*t59*t518*t61+0.168D0*t941*t391-0.448D-1*t936*t1070)
     #+0.3528531756410541D1*t425*t85*t1055*t1021*t1058
     #+0.1653333333333333D-1*t1082*t388-0.1306666666666667D-1*t518
     #*sigmabb*t65+0.3456111963634775D-2*t400*t1090*t406
     #-0.3456111963634775D-3*t399*t932*t1097*t85*t98
      t1103 = t75**2
      t1105 = 1/t1103*t80
      t1106 = t401**2
      t1113 = t420*t98
      t1125 = t403*t85
      t1161 = -0.2101316073889943D-3*t1105/t1106*t405*t932
     #+0.5873990330354695D-4*t400*t1097*t1113*sigmabb
     #+0.7245876229878325D-4*t409*t940*t420*t98+0.284219733851544D-2
     #*t409*t387*t85*t98+0.4446589853502444D-1*t400*t1125*t476*t445
     #*sigmabb-0.378959645135392D-2*t81*t411+0.5485102615340186D-1
     #*t409*t71*t447-0.1462694030757383D0*t81*t415*t447
     #-0.4830584153252216D-3*t81*t387*t420*t98+0.9661168306504433D-4
     #*t81*t940*t1013*t98-0.932245253120402D-2*t81*t71*t420*t427*t446
     #-0.2194041046136074D0*t425*t85*t1020*t1021*t445
     #+0.1097020523068037D0*t425*t428*t1049*t445
      v2rhob2(i) = t1102+t1161
      t1191 = 0.4444444444444444D0*t770*t313*t452+0.2666666666666667D1
     #*t141*t138*t716+0.4444444444444444D0*t781*t317*t455
     #-0.2666666666666667D1*t145*t138*t716
      t1206 = -0.7694644203726145D1*t700+t708-t710-t740
     #+0.3799574853701528D-1*t136*t320*t462+t745+0.3799574853701528D-1
     #*t136*t458*t331+t752-0.7694644203726145D1*t753
     #+0.1923661050931536D1*t172*t1191*t153+0.3799574853701528D-1*t136
     #*t147*(t870-t873)+0.1923661050931536D1*t756
     #+0.3799574853701528D-1*t136*t1191*t155-t759
     #-0.8740794299481065D-3*t762+0.1923661050931536D1*t966
     #-0.7694644203726145D1*t968
      t1216 = 0.7694644203726145D1*t970-0.8740794299481065D-3*t973
     #-0.1124999956683108D1*t994-0.8740794299481065D-3*t998
     #-0.1124999956683108D1*t1001-0.8740794299481065D-3*t765+t768-t799
     #+t807+t868+t881-t891+t892-0.1124999956683108D1*t895-t897-t898
     #-0.1124999956683108D1*t900-0.2308393261117844D2*t905
      t1219 = t690+t689-t696-t697+t461+t465+t698+t468-t693+t323+t334
     #+t357+t106*(t1206+t1216)
      v2rhoab(i) = 0.1366755555555556D-3*t669*sigmaaa*t199*sigmabb
     #*t387+0.8266666666666667D-2*t1082*t200+0.8266666666666667D-2
     #*t672*t388+t105*t1219
      t1225 = t9*t193
      t1237 = sigmaaa*t590
      t1254 = t28*t23
      v2rhoasigmaaa(i) = 0.56D-2*t188*t17-0.56D-2*t189*t491+0.42D-2
     #*t1225*t206-0.84D-2*t10*t536*t206*t490+0.42D-2*t10*t193*(
     #-0.168D-1*t484*t188*t13-0.504D-1*t199*t203+0.168D-1*t1237*t570)
     #+0.7879935277087286D-4*t598/t565*t218+0.2376076974998908D-3*t211
     #*t624*t218-0.8640279909086936D-3*t212*t616*t50
     #-0.142109866925772D-2*t1254*t217-0.1101373186941505D-4*t212*t624
     #*t232*t50-0.3622938114939162D-4*t28*t199*t606
     #-0.8337355975317082D-2*t212*t495*t259-0.2742551307670093D-1*t500
     #*t37*t369-0.5125333333333333D-4*t669*t1237+0.8266666666666667D-2
     #*t264*t199-0.31D-2*t672*t23
      v2rhoasigmaab(i) = 0.D0
      v2rhoasigmabb(i) = -0.5125333333333333D-4*t669*t200*t71-0.31D-2
     #*t672*t71
      v2rhobsigmaaa(i) = -0.5125333333333333D-4*t669*t388*t23-0.31D-2
     #*t1082*t23
      v2rhobsigmaab(i) = 0.D0
      t1290 = t57*t381
      t1302 = sigmabb*t1097
      t1319 = t76*t71
      v2rhobsigmabb(i) = 0.56D-2*t376*t65-0.56D-2*t377*t514+0.42D-2
     #*t1290*t394-0.84D-2*t58*t947*t394*t513+0.42D-2*t58*t381*(
     #-0.168D-1*t507*t376*t61-0.504D-1*t387*t391+0.168D-1*t1302*t1070)
     #+0.7879935277087286D-4*t1105/t933*t406+0.2376076974998908D-3
     #*t399*t1090*t406-0.8640279909086936D-3*t400*t1125*t98
     #-0.142109866925772D-2*t1319*t405-0.1101373186941505D-4*t400
     #*t1090*t420*t98-0.3622938114939162D-4*t76*t387*t1113
     #-0.8337355975317082D-2*t400*t518*t447-0.2742551307670093D-1*t523
     #*t85*t477-0.5125333333333333D-4*t669*t1302+0.8266666666666667D-2
     #*t264*t387-0.31D-2*t1082*t71
      t1343 = t490**2
      t1367 = t211*t215
      v2sigmaaa2(i) = 0.84D-2*t1225*t490-0.84D-2*t10*t536*t1343
     #+0.42D-2*t10*t193*(-0.63D-2/t11/sigmaaa*t9*t13+0.63D-2/sigmaaa
     #*t23*t203-0.63D-2*t624*t570)-0.2954975728907732D-4*t598/t588*t37
     #*t50-0.129604198636304D-3*t1367*t217+0.1922D-4*t669*t624
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.1922D-4*t669*t23*t71
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      t1376 = t513**2
      t1400 = t399*t403
      v2sigmabb2(i) = 0.84D-2*t1290*t513-0.84D-2*t58*t947*t1376
     #+0.42D-2*t58*t381*(-0.63D-2/t59/sigmabb*t57*t61+0.63D-2/sigmabb
     #*t71*t391-0.63D-2*t1090*t1070)-0.2954975728907732D-4*t1105/t1095
     #*t85*t98-0.129604198636304D-3*t1400*t405+0.1922D-4*t669*t1090
      v2taua2(i) = 0.D0
      v2taub2(i) = 0.D0
      v2tauab(i) = 0.D0
      v2rhoataua(i) = -0.6912223927269549D-3*t1367*t218
     #+0.2273757870812352D-2*t501+0.1449175245975665D-3*t1254*t606
     #+0.1097020523068037D0*t528*t37*t369
      v2rhoataub(i) = 0.D0
      v2rhobtaua(i) = 0.D0
      v2rhobtaub(i) = -0.6912223927269549D-3*t1400*t406
     #+0.2273757870812352D-2*t524+0.1449175245975665D-3*t1319*t1113
     #+0.1097020523068037D0*t531*t85*t477
      v2sigmaaataua(i) = 0.2592083972726081D-3*t211*t495*t217
      v2sigmaabtaua(i) = 0.D0
      v2sigmabbtaua(i) = 0.D0
      v2sigmaaataub(i) = 0.D0
      v2sigmaabtaub(i) = 0.D0
      v2sigmabbtaub(i) = 0.2592083972726081D-3*t399*t518*t405
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      v2rhob2(i) = 0.0d0
      v2rhoab(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2rhoasigmaab(i) = 0.0d0
      v2rhoasigmabb(i) = 0.0d0
      v2rhobsigmaaa(i) = 0.0d0
      v2rhobsigmaab(i) = 0.0d0
      v2rhobsigmabb(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      v2sigmaab2(i) = 0.0d0
      v2sigmabb2(i) = 0.0d0
      v2sigmaaaab(i) = 0.0d0
      v2sigmaaabb(i) = 0.0d0
      v2sigmaabbb(i) = 0.0d0
      vtaua(i) = 0.0d0
      vtaub(i) = 0.0d0
      v2rhoataua(i) = 0.0d0
      v2rhoataub(i) = 0.0d0
      v2rhobtaua(i) = 0.0d0
      v2rhobtaub(i) = 0.0d0
      v2taua2(i) = 0.0d0
      v2taub2(i) = 0.0d0
      v2tauab(i) = 0.0d0
      v2sigmaaataua(i) = 0.0d0
      v2sigmaaataub(i) = 0.0d0
      v2sigmaabtaua(i) = 0.0d0
      v2sigmaabtaub(i) = 0.0d0
      v2sigmabbtaua(i) = 0.0d0
      v2sigmabbtaub(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end
      
      
      subroutine rks_xc_bb95
     & (ideriv,npt,rhoa1,sigmaaa1,taua1,
     &  zk,vrhoa,vsigmaaa,vtaua,
     &  v2rhoa2,v2rhoasigmaaa,v2sigmaaa2,
     &  v2rhoataua,v2sigmaaataua,v2taua2)
c
c     A.D. Becke
c     Density-functional thermochemistry. IV.
c     A new dynamical correlation functional and implications
c     for exact-exchange mixing
c     J. Chem. Phys. 104 (1996) 1040-1046
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt)
      REAL sigmaaa1(npt)
      REAL taua1(npt)
      REAL zk(npt),vrhoa(npt),vsigmaaa(npt),vtaua(npt)
      REAL v2rhoa2(npt),v2rhoasigmaaa(npt),v2sigmaaa2(npt)
      REAL v2rhoataua(npt),v2sigmaaataua(npt),v2taua2(npt)
      parameter(tol=1.0d-20)
      
      if(ideriv.eq.0) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      tau = dmax1(0.D0,taua1(i))
      t3 = rho**(1.D0/3.D0)
      t4 = t3*rho
      t6 = 1/t4
      t8 = dsqrt(sigma)
      t9 = t8*t6
      t11 = dlog(0.1259921049894873D1*t9+dsqrt(1+0.1587401051968199D1
     #*t9**2))
      t18 = rho**2
      t19 = t3**2
      t22 = sigma/t19/t18
      t25 = (1.D0+0.6032123997479158D-1*t22)**2
      t28 = 1/rho
      t34 = t28**(1.D0/3.D0)
      t36 = 1.D0+0.1606016560364007D0*t34
      t38 = t28**(1.D0/6.D0)
      t41 = dsqrt(t28)
      t43 = t34**2
      t49 = dlog(1.D0+0.321646831778707D2/(0.1248219874679732D2*t38
     #+0.4844076716063854D1*t34+0.2326004811900819D1*t41
     #+0.3819082618690966D0*t43))
      t67 = dlog(1.D0+0.160818243221511D2/(0.598255043577108D1*t38
     #+0.2225569421150687D1*t34+0.8004286349993634D0*t41
     #+0.1897004325747559D0*t43))
      zk(i) = -0.7385587663820224D0*t4-0.5291668409558467D-2*t6*sigma/
     #(1.D0+0.317500104573508D-1*t9*t11)-0.108280969081455D-1/t25*
     #(0.5D0*tau-0.125D0*sigma*t28)/t19*t36*t49+1/(1.D0
     #+0.9841886522202837D-2*t22)*(-0.62182D-1*rho*(1.D0
     #+0.1325688999052018D0*t34)*t67+0.3109D-1*rho*t36*t49)
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      tau = dmax1(0.D0,taua1(i))
      t3 = rho**(1.D0/3.D0)
      t4 = t3*rho
      t6 = 1/t4
      t7 = t6*sigma
      t8 = dsqrt(sigma)
      t9 = t8*t6
      t11 = dlog(0.1259921049894873D1*t9+dsqrt(1+0.1587401051968199D1
     #*t9**2))
      t14 = 1.D0+0.317500104573508D-1*t9*t11
      t15 = 1/t14
      t18 = rho**2
      t19 = t3**2
      t21 = 1/t19/t18
      t22 = sigma*t21
      t24 = 1.D0+0.6032123997479158D-1*t22
      t25 = t24**2
      t26 = 1/t25
      t28 = 1/rho
      t31 = 0.5D0*tau-0.125D0*sigma*t28
      t32 = t26*t31
      t33 = 1/t19
      t34 = t28**(1.D0/3.D0)
      t36 = 1.D0+0.1606016560364007D0*t34
      t38 = t28**(1.D0/6.D0)
      t41 = dsqrt(t28)
      t43 = t34**2
      t45 = 0.1248219874679732D2*t38+0.4844076716063854D1*t34
     #+0.2326004811900819D1*t41+0.3819082618690966D0*t43
      t48 = 1.D0+0.321646831778707D2/t45
      t49 = dlog(t48)
      t54 = 1.D0+0.9841886522202837D-2*t22
      t55 = 1/t54
      t57 = 1.D0+0.1325688999052018D0*t34
      t63 = 0.598255043577108D1*t38+0.2225569421150687D1*t34
     #+0.8004286349993634D0*t41+0.1897004325747559D0*t43
      t66 = 1.D0+0.160818243221511D2/t63
      t67 = dlog(t66)
      t70 = rho*t36
      t73 = -0.62182D-1*rho*t57*t67+0.3109D-1*t70*t49
      zk(i) = -0.7385587663820224D0*t4-0.5291668409558467D-2*t7*t15
     #-0.108280969081455D-1*t32*t33*t36*t49+t55*t73
      t77 = 1/t3/t18
      t81 = t14**2
      t82 = 1/t81
      t86 = t18*rho
      t89 = sigma/t19/t86
      t92 = dsqrt(1.D0+0.1587401051968199D1*t22)
      t93 = 1/t92
      t102 = 1/t25/t24*t31
      t103 = t18**2
      t107 = t36*t49
      t117 = 1/t19/rho
      t122 = 1/t43
      t128 = t45**2
      t129 = 1/t128
      t131 = t38**2
      t132 = t131**2
      t135 = 1/t18
      t136 = 1/t132/t38*t135
      t138 = t122*t135
      t141 = 1/t41*t135
      t144 = 1/t34*t135
      t146 = -0.4160732915599108D1*t136-0.3229384477375903D1*t138
     #-0.2326004811900819D1*t141-0.5092110158254621D0*t144
      t147 = 1/t48
      t152 = t54**2
      t154 = 1/t152*t73
      t161 = t63**2
      vrhoa(i) = -0.9847450218426965D0*t3+0.705555787941129D-2*t77
     #*sigma*t15+0.2645834204779234D-2*t7*t82*(-0.8466669455293548D-1
     #*t8*t77*t11-0.106673350692263D0*t89*t93)-0.3483542571021566D-2
     #*t102/t3/t103*t107*sigma-0.1353512113518188D-2*t26*sigma*t21*t36
     #*t49+0.7218731272097001D-2*t32*t117*t36*t49+0.579670098390266D-3
     #*t32*t21*t122*t49+0.1741411532348907D0*t32*t33*t36*t129*t146
     #*t147+0.2624503072587423D-1*t154*t89+t55*(-0.62182D-1*t57*t67
     #+rho*(0.2747799777968419D-2*t138*t67+0.1D1*t57/t161*(
     #-0.99709173929518D0*t136-0.7418564737168958D0*t138
     #-0.4002143174996817D0*t141-0.1264669550498372D0*t144)/t66)
     #+0.3109D-1*t107-0.1664368495390566D-2*t28*t122*t49-0.5D0*t70
     #*t129*t146*t147)
      vsigmaaa(i) = -0.2116667363823387D-1*t6*t15
     #+0.5291668409558467D-2*t7*t82*(0.6350002091470161D-1/t8*t6*t11
     #+0.8000501301919725D-1*t21*t93)+0.5225313856532348D-2*t102/t3
     #/t86*t36*t49+0.5414048454072751D-2*t26*t117*t107
     #-0.3936754608881135D-1*t154*t21
      vtaua(i) = -0.5414048454072751D-2*t26*t33*t107
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vtaua(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      tau = dmax1(0.D0,taua1(i))
      t3 = rho**(1.D0/3.D0)
      t4 = t3*rho
      t6 = 1/t4
      t7 = t6*sigma
      t8 = dsqrt(sigma)
      t9 = t8*t6
      t11 = dlog(0.1259921049894873D1*t9+dsqrt(1+0.1587401051968199D1
     #*t9**2))
      t14 = 1.D0+0.317500104573508D-1*t9*t11
      t15 = 1/t14
      t18 = rho**2
      t19 = t3**2
      t21 = 1/t19/t18
      t22 = sigma*t21
      t24 = 1.D0+0.6032123997479158D-1*t22
      t25 = t24**2
      t26 = 1/t25
      t28 = 1/rho
      t31 = 0.5D0*tau-0.125D0*sigma*t28
      t32 = t26*t31
      t33 = 1/t19
      t34 = t28**(1.D0/3.D0)
      t36 = 1.D0+0.1606016560364007D0*t34
      t38 = t28**(1.D0/6.D0)
      t41 = dsqrt(t28)
      t43 = t34**2
      t45 = 0.1248219874679732D2*t38+0.4844076716063854D1*t34
     #+0.2326004811900819D1*t41+0.3819082618690966D0*t43
      t48 = 1.D0+0.321646831778707D2/t45
      t49 = dlog(t48)
      t54 = 1.D0+0.9841886522202837D-2*t22
      t55 = 1/t54
      t57 = 1.D0+0.1325688999052018D0*t34
      t63 = 0.598255043577108D1*t38+0.2225569421150687D1*t34
     #+0.8004286349993634D0*t41+0.1897004325747559D0*t43
      t66 = 1.D0+0.160818243221511D2/t63
      t67 = dlog(t66)
      t70 = rho*t36
      t73 = -0.62182D-1*rho*t57*t67+0.3109D-1*t70*t49
      zk(i) = -0.7385587663820224D0*t4-0.5291668409558467D-2*t7*t15
     #-0.108280969081455D-1*t32*t33*t36*t49+t55*t73
      t77 = 1/t3/t18
      t78 = t77*sigma
      t81 = t14**2
      t82 = 1/t81
      t86 = t18*rho
      t88 = 1/t19/t86
      t89 = sigma*t88
      t91 = 1.D0+0.1587401051968199D1*t22
      t92 = dsqrt(t91)
      t93 = 1/t92
      t96 = -0.8466669455293548D-1*t8*t77*t11-0.106673350692263D0*t89
     #*t93
      t97 = t82*t96
      t101 = 1/t25/t24
      t102 = t101*t31
      t103 = t18**2
      t105 = 1/t3/t103
      t107 = t36*t49
      t108 = t107*sigma
      t111 = t26*sigma
      t113 = t21*t36*t49
      t117 = 1/t19/rho
      t122 = 1/t43
      t127 = t32*t33
      t128 = t45**2
      t129 = 1/t128
      t130 = t36*t129
      t131 = t38**2
      t132 = t131**2
      t133 = t132*t38
      t134 = 1/t133
      t135 = 1/t18
      t136 = t134*t135
      t138 = t122*t135
      t140 = 1/t41
      t141 = t140*t135
      t143 = 1/t34
      t144 = t143*t135
      t146 = -0.4160732915599108D1*t136-0.3229384477375903D1*t138
     #-0.2326004811900819D1*t141-0.5092110158254621D0*t144
      t147 = 1/t48
      t148 = t146*t147
      t149 = t130*t148
      t152 = t54**2
      t153 = 1/t152
      t154 = t153*t73
      t159 = t138*t67
      t161 = t63**2
      t162 = 1/t161
      t163 = t57*t162
      t168 = -0.99709173929518D0*t136-0.7418564737168958D0*t138
     #-0.4002143174996817D0*t141-0.1264669550498372D0*t144
      t169 = 1/t66
      t171 = t163*t168*t169
      t176 = t28*t122
      t179 = t129*t146
      t180 = t179*t147
      t183 = -0.62182D-1*t57*t67+rho*(0.2747799777968419D-2*t159+0.1D1
     #*t171)+0.3109D-1*t107-0.1664368495390566D-2*t176*t49-0.5D0*t70
     #*t180
      vrhoa(i) = -0.9847450218426965D0*t3+0.705555787941129D-2*t78*t15
     #+0.2645834204779234D-2*t7*t97-0.3483542571021566D-2*t102*t105
     #*t108-0.1353512113518188D-2*t111*t113+0.7218731272097001D-2*t32
     #*t117*t36*t49+0.579670098390266D-3*t32*t21*t122*t49
     #+0.1741411532348907D0*t127*t149+0.2624503072587423D-1*t154*t89
     #+t55*t183
      t187 = 1/t8
      t193 = 0.6350002091470161D-1*t187*t6*t11+0.8000501301919725D-1
     #*t21*t93
      t194 = t82*t193
      t198 = 1/t3/t86
      t203 = t26*t117
      t204 = t203*t107
      vsigmaaa(i) = -0.2116667363823387D-1*t6*t15
     #+0.5291668409558467D-2*t7*t194+0.5225313856532348D-2*t102*t198
     #*t36*t49+0.5414048454072751D-2*t204-0.3936754608881135D-1*t154*t21
      t208 = t26*t33
      vtaua(i) = -0.5414048454072751D-2*t208*t107
      t212 = 0.5495599555936838D-2*t159
      t213 = 0.2D1*t171
      t215 = 1/t43/t28
      t216 = 1/t103
      t217 = t215*t216
      t219 = 0.1831866518645613D-2*t217*t67
      t220 = 1/t86
      t221 = t122*t220
      t223 = 0.5495599555936838D-2*t221*t67
      t234 = dlog(1.D0+0.2960857464321668D2/(0.8157414703487641D1*t38
     #+0.2247591863577616D1*t34+0.4300972471276643D0*t41
     #+0.1911512595127338D0*t43))
      t236 = (1.D0+0.6901399211255825D-1*t34)*t234*t135
      t241 = t168**2
      t244 = 0.2D1*t57/t161/t63*t241*t169
      t247 = 1/t133/t28*t216
      t249 = t134*t220
      t255 = 1/t41/t28*t216
      t257 = t140*t220
      t261 = 1/t34/t28*t216
      t263 = t143*t220
      t268 = 0.1D1*t163*(-0.8309097827459833D0*t247
     #+0.199418347859036D1*t249-0.4945709824779306D0*t217
     #+0.1483712947433792D1*t221-0.2001071587498409D0*t255
     #+0.8004286349993634D0*t257-0.4215565168327908D-1*t261
     #+0.2529339100996745D0*t263)*t169
      t269 = t161**2
      t272 = t66**2
      t276 = 0.160818243221511D2*t57/t269*t241/t272
      t280 = 0.8837926660346786D-1*t138*t162*t168*t169
      t292 = 1/t128/t45
      t293 = t146**2
      t312 = -0.6934554859331846D1*t247+0.1664293166239643D2*t249
     #-0.4305845969834537D1*t217+0.1291753790950361D2*t221
     #-0.2326004811900819D1*t255+0.9304019247603276D1*t257
     #-0.3394740105503081D0*t261+0.2036844063301848D1*t263
      t317 = t128**2
      t318 = 1/t317
      t320 = t48**2
      t321 = 1/t320
      t333 = 1/t19/t103
      t334 = sigma*t333
      t337 = sigma**2
      t338 = t103*t86
      t341 = t337/t3/t338
      t343 = 1/t92/t91
      t351 = 1/t81/t14
      t352 = t96**2
      t358 = 1/t152/t54*t73
      t361 = t153*t183
      t367 = t103*t18
      t369 = 1/t3/t367
      s1 = -0.6564966812284644D0*t33+t55*(t212+t213+rho*(t219-t223
     #-0.3377399869956914D-1*t236-t244+t268+t276-t280))
     #-0.3292593677058602D-1*t198*sigma*t15+t55*(rho*(t219-t223
     #+0.3377399869956914D-1*t236-t244+t268+t276-t280)+0.1D1*t70*t292
     #*t293*t147+0.1070677706909338D0*t176*t180-0.2219157993854088D-2
     #*t220*t215*t49-0.2D1*t149-0.5D0*t70*t129*t312*t147
     #-0.1608234158893535D2*t70*t318*t293*t321+t213+t212)
     #-0.1411111575882258D-1*t78*t97+0.2645834204779234D-2*t7*t82*
     #(0.3951112412470322D0*t8*t198*t11+0.106673350692263D1*t334*t93
     #-0.4515557042823225D0*t341*t343)
      t381 = s1-0.5291668409558467D-2*t7*t351*t352
     #+0.275520655120833D-2*t358*t341+0.1049801229034969D0*t361*t89
     #-0.192463558656411D0*t154*t334-0.1741771285510783D-2*t101*t337
     #*t369*t36*t49+0.289835049195133D-3*t111*t333*t122*t49
     #+0.8707057661744533D-1*t111*t21*t149
      t395 = t25**2
      t397 = 1/t395*t31
      t398 = t103**2
      t418 = t122*t49
      t422 = t105*t36
      t440 = 1/t3/t103/rho
      t444 = -0.3482823064697813D0*t127*t36*t292*t293*t147
     #+0.7728934645203546D-3*t32*t333*t215*t49+0.9023414090121251D-2
     #*t111*t88*t36*t49-0.3362105718223909D-2*t397/t398*t107*t337
     #-0.3864467322601773D-2*t32*t88*t122*t49+0.1741411532348907D0
     #*t127*t130*t312*t147-0.3728981012481608D-1*t32*t21*t122*t129
     #*t148+0.745950274372486D-3*t102*t369*t418*sigma
     #+0.2240940862670676D0*t102*t422*t179*t147*sigma
     #-0.4643764086263751D0*t32*t117*t149-0.2406243757365667D-1*t32
     #*t113+0.5601195022029291D1*t127*t36*t318*t293*t321
     #+0.3483542571021566D-1*t102*t440*t108
      v2rhoa2(i) = t381+t444
      t449 = t6*t82
      t461 = sigma*t369
      t478 = t26*t21
      v2rhoasigmaaa(i) = 0.2822223151764516D-1*t77*t15
     #-0.705555787941129D-2*t78*t194+0.1058333681911693D-1*t449*t96
     #-0.5291668409558467D-2*t7*t351*t96*t193+0.2645834204779234D-2*t7
     #*t82*(-0.169333389105871D0*t187*t77*t11-0.640040104153578D0*t88
     #*t93+0.3386667782117419D0*t461*t343)+0.2521579288667932D-2*t397
     #/t338*t108+0.2394935517577326D-2*t101*t440*t108
     #-0.1741771285510783D-1*t102*t422*t49-0.9023414090121251D-2*t478
     #*t107-0.2797313528896822D-3*t102*t440*t122*t49
     #-0.289835049195133D-3*t26*t88*t418-0.8403528235015034D-1*t102
     #*t198*t149-0.8707057661744533D-1*t203*t36*t180
     #-0.2066404913406247D-2*t358*t461+0.1049801229034969D0*t154*t88
     #-0.3936754608881135D-1*t361*t21
      t502 = t193**2
      t526 = t101*t105
      v2sigmaaa2(i) = 0.4233334727646774D-1*t449*t193
     #-0.1058333681911693D-1*t7*t351*t502+0.5291668409558467D-2*t7*t82
     #*(-0.1270000418294032D0/t8/sigma*t6*t11+0.1600100260383945D0
     #/sigma*t21*t93-0.2540000836588064D0*t440*t343)
     #-0.3782368933001897D-2*t397/t367*t36*t49-0.5225313856532348D-2
     #*t526*t107+0.3099607370109371D-2*t358*t440
      v2taua2(i) = 0.D0
      v2rhoataua(i) = -0.3483542571021566D-2*t526*t108
     #+0.7218731272097001D-2*t204+0.579670098390266D-3*t478*t418
     #+0.1741411532348907D0*t208*t36*t180
      v2sigmaaataua(i) = 0.2612656928266174D-2*t101*t198*t107
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      vtaua(i) = 0.0d0
      v2rhoataua(i) = 0.0d0
      v2taua2(i) = 0.0d0
      v2sigmaaataua(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end

c:XC_BB95subrend
_ENDIF
_IF(ccpdft,all,xc_b1b95)
c:XC_B1B95subrstart

c    Generated: Tue Oct 19 14:42:56 BST 2004

      subroutine uks_xc_b1b95
     & (ideriv,npt,rhoa1,rhob1,sigmaaa1,sigmabb1,sigmaab1,
     &  taua1,taub1,
     &  zk,vrhoa,vrhob,vsigmaaa,vsigmabb,vsigmaab,
     &  vtaua,vtaub,
     &  v2rhoa2,v2rhob2,v2rhoab,
     &  v2rhoasigmaaa,v2rhoasigmaab,v2rhoasigmabb,
     &  v2rhobsigmabb,v2rhobsigmaab,v2rhobsigmaaa,
     &  v2sigmaaa2,v2sigmaaaab,v2sigmaaabb,
     &  v2sigmaab2,v2sigmaabbb,v2sigmabb2,
     &  v2rhoataua,v2rhoataub,v2rhobtaua,v2rhobtaub,
     &  v2sigmaaataua,v2sigmaaataub,
     &  v2sigmaabtaua,v2sigmaabtaub,
     &  v2sigmabbtaua,v2sigmabbtaub,
     &  v2taua2,v2taub2,v2tauab)
c
c     A.D. Becke
c     Density-functional thermochemistry. IV.
c     A new dynamical correlation functional and implications
c     for exact-exchange mixing
c     J. Chem. Phys. 104 (1996) 1040-1046
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt),rhob1(npt)
      REAL sigmaaa1(npt),sigmabb1(npt),sigmaab1(npt)
      REAL taua1(npt),taub1(npt)
      REAL zk(npt),vrhoa(npt),vrhob(npt)
      REAL vsigmaaa(npt),vsigmabb(npt),vsigmaab(npt)
      REAL vtaua(npt),vtaub(npt)
      REAL v2rhoa2(npt),v2rhob2(npt),v2rhoab(npt)
      REAL v2rhoasigmaaa(npt),v2rhoasigmaab(npt)
      REAL v2rhoasigmabb(npt),v2rhobsigmabb(npt)
      REAL v2rhobsigmaab(npt),v2rhobsigmaaa(npt)
      REAL v2sigmaaa2(npt),v2sigmaaaab(npt),v2sigmaaabb(npt)
      REAL v2sigmaab2(npt),v2sigmaabbb(npt),v2sigmabb2(npt)
      REAL v2rhoataua(npt),v2rhoataub(npt)
      REAL v2rhobtaua(npt),v2rhobtaub(npt)
      REAL v2sigmaaataua(npt),v2sigmaaataub(npt)
      REAL v2sigmaabtaua(npt),v2sigmaabtaub(npt)
      REAL v2sigmabbtaua(npt),v2sigmabbtaub(npt)
      REAL v2taua2(npt),v2taub2(npt),v2tauab(npt)
      parameter(tol=1.0d-20)
      
      if (ideriv.eq.0) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      taub = dmax1(0.D0,taub1(i))
      tau = taub
      t3 = rhob**(1.D0/3.D0)
      t4 = t3*rhob
      t6 = 1/t4
      t8 = dsqrt(sigmabb)
      t9 = t8*t6
      t10 = dlog(t9+dsqrt(1+t9**2))
      t17 = rhob**2
      t18 = t3**2
      t24 = (1.D0+0.38D-1*sigmabb/t18/t17)**2
      t26 = 1/rhob
      t32 = t26**(1.D0/3.D0)
      t36 = t26**(1.D0/6.D0)
      t39 = dsqrt(t26)
      t41 = t32**2
      t47 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t36
     #+0.3844746237447211D1*t32+0.1644733775567609D1*t39
     #+0.2405871291288192D0*t41))
      zk(i) = -0.669978530171352D0*t4-0.3024D-2*t6*sigmabb/(1.D0
     #+0.252D-1*t9*t10)-0.3410636806218528D-2/t24*(taub-0.25D0*sigmabb
     #*t26)/t18*(1.D0+0.1274696188700087D0*t32)*t47
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      taua = dmax1(0.D0,taua1(i))
      tau = taua
      t3 = rhoa**(1.D0/3.D0)
      t4 = t3*rhoa
      t6 = 1/t4
      t8 = dsqrt(sigmaaa)
      t9 = t8*t6
      t10 = dlog(t9+dsqrt(1+t9**2))
      t17 = rhoa**2
      t18 = t3**2
      t24 = (1.D0+0.38D-1*sigmaaa/t18/t17)**2
      t26 = 1/rhoa
      t32 = t26**(1.D0/3.D0)
      t36 = t26**(1.D0/6.D0)
      t39 = dsqrt(t26)
      t41 = t32**2
      t47 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t36
     #+0.3844746237447211D1*t32+0.1644733775567609D1*t39
     #+0.2405871291288192D0*t41))
      zk(i) = -0.669978530171352D0*t4-0.3024D-2*t6*sigmaaa/(1.D0
     #+0.252D-1*t9*t10)-0.3410636806218528D-2/t24*(taua-0.25D0*sigmaaa
     #*t26)/t18*(1.D0+0.1274696188700087D0*t32)*t47
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      taua = dmax1(0.D0,taua1(i))
      taub = dmax1(0.D0,taub1(i))
      tau = taua+taub
      t6 = rhoa**(1.D0/3.D0)
      t7 = t6*rhoa
      t9 = 1/t7
      t11 = dsqrt(sigmaaa)
      t12 = t11*t9
      t13 = dlog(t12+dsqrt(1+t12**2))
      t20 = rhoa**2
      t21 = t6**2
      t24 = sigmaaa/t21/t20
      t27 = (1.D0+0.38D-1*t24)**2
      t29 = 1/rhoa
      t35 = t29**(1.D0/3.D0)
      t37 = 1.D0+0.1274696188700087D0*t35
      t39 = t29**(1.D0/6.D0)
      t42 = dsqrt(t29)
      t44 = t35**2
      t50 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t39
     #+0.3844746237447211D1*t35+0.1644733775567609D1*t42
     #+0.2405871291288192D0*t44))
      t54 = rhob**(1.D0/3.D0)
      t55 = t54*rhob
      t57 = 1/t55
      t59 = dsqrt(sigmabb)
      t60 = t59*t57
      t61 = dlog(t60+dsqrt(1+t60**2))
      t68 = rhob**2
      t69 = t54**2
      t72 = sigmabb/t69/t68
      t75 = (1.D0+0.38D-1*t72)**2
      t77 = 1/rhob
      t83 = t77**(1.D0/3.D0)
      t85 = 1.D0+0.1274696188700087D0*t83
      t87 = t77**(1.D0/6.D0)
      t90 = dsqrt(t77)
      t92 = t83**2
      t98 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t87
     #+0.3844746237447211D1*t83+0.1644733775567609D1*t90
     #+0.2405871291288192D0*t92))
      t106 = rhoa+rhob
      t107 = 1/t106
      t108 = t107**(1.D0/3.D0)
      t111 = t107**(1.D0/6.D0)
      t114 = dsqrt(t107)
      t116 = t108**2
      t122 = dlog(1.D0+0.160818243221511D2/(0.598255043577108D1*t111
     #+0.2225569421150687D1*t108+0.8004286349993634D0*t114
     #+0.1897004325747559D0*t116))
      t124 = 0.62182D-1*(1.D0+0.1325688999052018D0*t108)*t122
      t135 = dlog(1.D0+0.2960857464321668D2/(0.8157414703487641D1*t111
     #+0.2247591863577616D1*t108+0.4300972471276643D0*t114
     #+0.1911512595127338D0*t116))
      t138 = rhoa-1.D0*rhob
      t139 = t138*t107
      t140 = 1.D0+t139
      t141 = t140**(1.D0/3.D0)
      t144 = 1.D0-1.D0*t139
      t145 = t144**(1.D0/3.D0)
      t147 = t141*t140+t145*t144-2.D0
      t148 = t138**2
      t149 = t148**2
      t150 = t106**2
      t151 = t150**2
      t153 = t149/t151
      t169 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t111
     #+0.3844746237447211D1*t108+0.1644733775567609D1*t114
     #+0.2405871291288192D0*t116))
      zk(i) = -0.669978530171352D0*t7-0.3024D-2*t9*sigmaaa/(1.D0
     #+0.252D-1*t12*t13)-0.3410636806218528D-2/t27*(taua-0.25D0
     #*sigmaaa*t29)/t21*t37*t50-0.669978530171352D0*t55-0.3024D-2*t57
     #*sigmabb/(1.D0+0.252D-1*t60*t61)-0.3410636806218528D-2/t75*(taub
     #-0.25D0*sigmabb*t77)/t69*t85*t98+1/(1.D0+0.31D-2*t24+0.31D-2*t72
     #)*(t106*(-t124+0.3799574853701528D-1*(1.D0+0.6901399211255825D-1
     #*t108)*t135*t147*(1.D0-1.D0*t153)+0.1923661050931536D1*(
     #-0.3109D-1*(1.D0+0.1274696188700087D0*t108)*t169+t124)*t147*t153
     #)+0.3109D-1*rhoa*t37*t50+0.3109D-1*rhob*t85*t98)
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      taub = dmax1(0.D0,taub1(i))
      tau = taub
      t3 = rhob**(1.D0/3.D0)
      t4 = t3*rhob
      t6 = 1/t4
      t7 = t6*sigmabb
      t8 = dsqrt(sigmabb)
      t9 = t8*t6
      t10 = dlog(t9+dsqrt(1+t9**2))
      t13 = 1.D0+0.252D-1*t9*t10
      t14 = 1/t13
      t17 = rhob**2
      t18 = t3**2
      t20 = 1/t18/t17
      t21 = sigmabb*t20
      t23 = 1.D0+0.38D-1*t21
      t24 = t23**2
      t25 = 1/t24
      t26 = 1/rhob
      t29 = taub-0.25D0*sigmabb*t26
      t30 = t25*t29
      t31 = 1/t18
      t32 = t26**(1.D0/3.D0)
      t34 = 1.D0+0.1274696188700087D0*t32
      t36 = t26**(1.D0/6.D0)
      t39 = dsqrt(t26)
      t41 = t32**2
      t43 = 0.1112037486309468D2*t36+0.3844746237447211D1*t32
     #+0.1644733775567609D1*t39+0.2405871291288192D0*t41
      t46 = 1.D0+0.321646831778707D2/t43
      t47 = dlog(t46)
      zk(i) = -0.669978530171352D0*t4-0.3024D-2*t7*t14
     #-0.3410636806218528D-2*t30*t31*t34*t47
      vrhoa(i) = 0.D0
      t53 = 1/t3/t17
      t57 = t13**2
      t58 = 1/t57
      t62 = t17*rhob
      t67 = dsqrt(1.D0+t21)
      t68 = 1/t67
      t77 = 1/t24/t23*t29
      t78 = t17**2
      t82 = t34*t47
      t92 = 1/t18/rhob
      t97 = 1/t41
      t103 = t43**2
      t106 = t36**2
      t107 = t106**2
      t110 = 1/t17
      vrhob(i) = -0.893304706895136D0*t3+0.4032D-2*t53*sigmabb*t14
     #+0.3024D-2*t7*t58*(-0.336D-1*t8*t53*t10-0.336D-1*sigmabb/t18/t62
     #*t68)-0.6912223927269549D-3*t77/t3/t78*t82*sigmabb
     #-0.8526592015546319D-3*t25*sigmabb*t20*t34*t47
     #+0.2273757870812352D-2*t30*t92*t34*t47+0.1449175245975665D-3*t30
     #*t20*t97*t47+0.1097020523068037D0*t30*t31*t34/t103*(
     #-0.1853395810515781D1/t107/t36*t110-0.128158207914907D1*t97*t110
     #-0.8223668877838045D0/t39*t110-0.1603914194192128D0/t32*t110)/t46
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      vsigmabb(i) = -0.3024D-2*t6*t14+0.3024D-2*t7*t58*(0.126D-1/t8*t6
     #*t10+0.126D-1*t20*t68)+0.2592083972726081D-3*t77/t3/t62*t34*t47
     #+0.8526592015546319D-3*t25*t92*t82
      vtaub(i) = -0.3410636806218528D-2*t25*t31*t82
      vtaua(i) = 0.0d0
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      taua = dmax1(0.D0,taua1(i))
      tau = taua
      t3 = rhoa**(1.D0/3.D0)
      t4 = t3*rhoa
      t6 = 1/t4
      t7 = t6*sigmaaa
      t8 = dsqrt(sigmaaa)
      t9 = t8*t6
      t10 = dlog(t9+dsqrt(1+t9**2))
      t13 = 1.D0+0.252D-1*t9*t10
      t14 = 1/t13
      t17 = rhoa**2
      t18 = t3**2
      t20 = 1/t18/t17
      t21 = sigmaaa*t20
      t23 = 1.D0+0.38D-1*t21
      t24 = t23**2
      t25 = 1/t24
      t26 = 1/rhoa
      t29 = taua-0.25D0*sigmaaa*t26
      t30 = t25*t29
      t31 = 1/t18
      t32 = t26**(1.D0/3.D0)
      t34 = 1.D0+0.1274696188700087D0*t32
      t36 = t26**(1.D0/6.D0)
      t39 = dsqrt(t26)
      t41 = t32**2
      t43 = 0.1112037486309468D2*t36+0.3844746237447211D1*t32
     #+0.1644733775567609D1*t39+0.2405871291288192D0*t41
      t46 = 1.D0+0.321646831778707D2/t43
      t47 = dlog(t46)
      zk(i) = -0.669978530171352D0*t4-0.3024D-2*t7*t14
     #-0.3410636806218528D-2*t30*t31*t34*t47
      t53 = 1/t3/t17
      t57 = t13**2
      t58 = 1/t57
      t62 = t17*rhoa
      t67 = dsqrt(1.D0+t21)
      t68 = 1/t67
      t77 = 1/t24/t23*t29
      t78 = t17**2
      t82 = t34*t47
      t92 = 1/t18/rhoa
      t97 = 1/t41
      t103 = t43**2
      t106 = t36**2
      t107 = t106**2
      t110 = 1/t17
      vrhoa(i) = -0.893304706895136D0*t3+0.4032D-2*t53*sigmaaa*t14
     #+0.3024D-2*t7*t58*(-0.336D-1*t8*t53*t10-0.336D-1*sigmaaa/t18/t62
     #*t68)-0.6912223927269549D-3*t77/t3/t78*t82*sigmaaa
     #-0.8526592015546319D-3*t25*sigmaaa*t20*t34*t47
     #+0.2273757870812352D-2*t30*t92*t34*t47+0.1449175245975665D-3*t30
     #*t20*t97*t47+0.1097020523068037D0*t30*t31*t34/t103*(
     #-0.1853395810515781D1/t107/t36*t110-0.128158207914907D1*t97*t110
     #-0.8223668877838045D0/t39*t110-0.1603914194192128D0/t32*t110)/t46
      vrhob(i) = 0.D0
      vsigmaaa(i) = -0.3024D-2*t6*t14+0.3024D-2*t7*t58*(0.126D-1/t8*t6
     #*t10+0.126D-1*t20*t68)+0.2592083972726081D-3*t77/t3/t62*t34*t47
     #+0.8526592015546319D-3*t25*t92*t82
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      vtaua(i) = -0.3410636806218528D-2*t25*t31*t82
      vtaub(i) = 0.0d0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      taua = dmax1(0.D0,taua1(i))
      taub = dmax1(0.D0,taub1(i))
      tau = taua+taub
      t6 = rhoa**(1.D0/3.D0)
      t7 = t6*rhoa
      t9 = 1/t7
      t10 = t9*sigmaaa
      t11 = dsqrt(sigmaaa)
      t12 = t11*t9
      t13 = dlog(t12+dsqrt(1+t12**2))
      t16 = 1.D0+0.252D-1*t12*t13
      t17 = 1/t16
      t20 = rhoa**2
      t21 = t6**2
      t23 = 1/t21/t20
      t24 = sigmaaa*t23
      t26 = 1.D0+0.38D-1*t24
      t27 = t26**2
      t28 = 1/t27
      t29 = 1/rhoa
      t32 = taua-0.25D0*sigmaaa*t29
      t33 = t28*t32
      t34 = 1/t21
      t35 = t29**(1.D0/3.D0)
      t37 = 1.D0+0.1274696188700087D0*t35
      t39 = t29**(1.D0/6.D0)
      t42 = dsqrt(t29)
      t44 = t35**2
      t46 = 0.1112037486309468D2*t39+0.3844746237447211D1*t35
     #+0.1644733775567609D1*t42+0.2405871291288192D0*t44
      t49 = 1.D0+0.321646831778707D2/t46
      t50 = dlog(t49)
      t54 = rhob**(1.D0/3.D0)
      t55 = t54*rhob
      t57 = 1/t55
      t58 = t57*sigmabb
      t59 = dsqrt(sigmabb)
      t60 = t59*t57
      t61 = dlog(t60+dsqrt(1+t60**2))
      t64 = 1.D0+0.252D-1*t60*t61
      t65 = 1/t64
      t68 = rhob**2
      t69 = t54**2
      t71 = 1/t69/t68
      t72 = sigmabb*t71
      t74 = 1.D0+0.38D-1*t72
      t75 = t74**2
      t76 = 1/t75
      t77 = 1/rhob
      t80 = taub-0.25D0*sigmabb*t77
      t81 = t76*t80
      t82 = 1/t69
      t83 = t77**(1.D0/3.D0)
      t85 = 1.D0+0.1274696188700087D0*t83
      t87 = t77**(1.D0/6.D0)
      t90 = dsqrt(t77)
      t92 = t83**2
      t94 = 0.1112037486309468D2*t87+0.3844746237447211D1*t83
     #+0.1644733775567609D1*t90+0.2405871291288192D0*t92
      t97 = 1.D0+0.321646831778707D2/t94
      t98 = dlog(t97)
      t104 = 1.D0+0.31D-2*t24+0.31D-2*t72
      t105 = 1/t104
      t106 = rhoa+rhob
      t107 = 1/t106
      t108 = t107**(1.D0/3.D0)
      t110 = 1.D0+0.1325688999052018D0*t108
      t111 = t107**(1.D0/6.D0)
      t114 = dsqrt(t107)
      t116 = t108**2
      t118 = 0.598255043577108D1*t111+0.2225569421150687D1*t108
     #+0.8004286349993634D0*t114+0.1897004325747559D0*t116
      t121 = 1.D0+0.160818243221511D2/t118
      t122 = dlog(t121)
      t124 = 0.62182D-1*t110*t122
      t126 = 1.D0+0.6901399211255825D-1*t108
      t131 = 0.8157414703487641D1*t111+0.2247591863577616D1*t108
     #+0.4300972471276643D0*t114+0.1911512595127338D0*t116
      t134 = 1.D0+0.2960857464321668D2/t131
      t135 = dlog(t134)
      t136 = t126*t135
      t138 = rhoa-1.D0*rhob
      t139 = t138*t107
      t140 = 1.D0+t139
      t141 = t140**(1.D0/3.D0)
      t144 = 1.D0-1.D0*t139
      t145 = t144**(1.D0/3.D0)
      t147 = t141*t140+t145*t144-2.D0
      t148 = t138**2
      t149 = t148**2
      t150 = t106**2
      t151 = t150**2
      t152 = 1/t151
      t153 = t149*t152
      t155 = 1.D0-1.D0*t153
      t158 = 0.3799574853701528D-1*t136*t147*t155
      t160 = 1.D0+0.1274696188700087D0*t108
      t165 = 0.1112037486309468D2*t111+0.3844746237447211D1*t108
     #+0.1644733775567609D1*t114+0.2405871291288192D0*t116
      t168 = 1.D0+0.321646831778707D2/t165
      t169 = dlog(t168)
      t172 = -0.3109D-1*t160*t169+t124
      t173 = t172*t147
      t175 = 0.1923661050931536D1*t173*t153
      t178 = rhoa*t37
      t181 = rhob*t85
      t184 = t106*(-t124+t158+t175)+0.3109D-1*t178*t50+0.3109D-1*t181
     #*t98
      zk(i) = -0.669978530171352D0*t7-0.3024D-2*t10*t17
     #-0.3410636806218528D-2*t33*t34*t37*t50-0.669978530171352D0*t55
     #-0.3024D-2*t58*t65-0.3410636806218528D-2*t81*t82*t85*t98+t105*t184
      t188 = 1/t6/t20
      t192 = t16**2
      t193 = 1/t192
      t197 = t20*rhoa
      t200 = sigmaaa/t21/t197
      t202 = dsqrt(1.D0+t24)
      t203 = 1/t202
      t212 = 1/t27/t26*t32
      t213 = t20**2
      t217 = t37*t50
      t227 = 1/t21/rhoa
      t232 = 1/t44
      t238 = t46**2
      t239 = 1/t238
      t241 = t39**2
      t242 = t241**2
      t245 = 1/t20
      t256 = -0.1853395810515781D1/t242/t39*t245-0.128158207914907D1
     #*t232*t245-0.8223668877838045D0/t42*t245-0.1603914194192128D0
     #/t35*t245
      t257 = 1/t49
      t262 = t104**2
      t264 = 1/t262*t184
      t268 = 1/t150
      t269 = 1/t116*t268
      t270 = t269*t122
      t271 = 0.2747799777968419D-2*t270
      t272 = t118**2
      t275 = t111**2
      t276 = t275**2
      t279 = 1/t276/t111*t268
      t283 = 1/t114*t268
      t286 = 1/t108*t268
      t291 = t110/t272*(-0.99709173929518D0*t279-0.7418564737168958D0
     #*t269-0.4002143174996817D0*t283-0.1264669550498372D0*t286)/t121
      t292 = 0.1D1*t291
      t296 = 0.8740794299481065D-3*t269*t135*t147*t155
      t297 = t131**2
      t310 = 0.1124999956683108D1*t126/t297*(-0.135956911724794D1*t279
     #-0.7491972878592054D0*t269-0.2150486235638321D0*t283
     #-0.1274341730084892D0*t286)/t134*t147*t155
      t311 = t138*t268
      t312 = 1.D0*t311
      t316 = 1.D0*t107
      t320 = 0.1333333333333333D1*t141*(t107-t312)
     #+0.1333333333333333D1*t145*(-t316+t311)
      t325 = t148*t138*t152
      t326 = 4.D0*t325
      t329 = t149/t151/t106
      t330 = 4.D0*t329
      t337 = t165**2
      t354 = 0.1923661050931536D1*(0.1321010150222857D-2*t269*t169
     #+0.1D1*t160/t337*(-0.1853395810515781D1*t279-0.128158207914907D1
     #*t269-0.8223668877838045D0*t283-0.1603914194192128D0*t286)/t168
     #-0.2747799777968419D-2*t270-0.1D1*t291)*t147*t153
      t358 = t173*t325
      t361 = 0.7694644203726145D1*t173*t329
      vrhoa(i) = -0.893304706895136D0*t6+0.4032D-2*t188*sigmaaa*t17
     #+0.3024D-2*t10*t193*(-0.336D-1*t11*t188*t13-0.336D-1*t200*t203)
     #-0.6912223927269549D-3*t212/t6/t213*t217*sigmaaa
     #-0.8526592015546319D-3*t28*sigmaaa*t23*t37*t50
     #+0.2273757870812352D-2*t33*t227*t37*t50+0.1449175245975665D-3
     #*t33*t23*t232*t50+0.1097020523068037D0*t33*t34*t37*t239*t256
     #*t257+0.8266666666666667D-2*t264*t200+t105*(-t124+t158+t175+t106
     #*(t271+t292-t296-t310+0.3799574853701528D-1*t136*t320*t155
     #+0.3799574853701528D-1*t136*t147*(-t326+t330)+t354
     #+0.1923661050931536D1*t172*t320*t153+0.7694644203726145D1*t358
     #-t361)+0.3109D-1*t217-0.1321010150222857D-2*t29*t232*t50-0.1D1
     #*t178*t239*t256*t257)
      t376 = 1/t54/t68
      t380 = t64**2
      t381 = 1/t380
      t385 = t68*rhob
      t388 = sigmabb/t69/t385
      t390 = dsqrt(1.D0+t72)
      t391 = 1/t390
      t400 = 1/t75/t74*t80
      t401 = t68**2
      t405 = t85*t98
      t415 = 1/t69/rhob
      t420 = 1/t92
      t426 = t94**2
      t427 = 1/t426
      t429 = t87**2
      t430 = t429**2
      t433 = 1/t68
      t444 = -0.1853395810515781D1/t430/t87*t433-0.128158207914907D1
     #*t420*t433-0.8223668877838045D0/t90*t433-0.1603914194192128D0
     #/t83*t433
      t445 = 1/t97
      t458 = 0.1333333333333333D1*t141*(-t316-t312)
     #+0.1333333333333333D1*t145*(t107+t311)
      vrhob(i) = -0.893304706895136D0*t54+0.4032D-2*t376*sigmabb*t65
     #+0.3024D-2*t58*t381*(-0.336D-1*t59*t376*t61-0.336D-1*t388*t391)
     #-0.6912223927269549D-3*t400/t54/t401*t405*sigmabb
     #-0.8526592015546319D-3*t76*sigmabb*t71*t85*t98
     #+0.2273757870812352D-2*t81*t415*t85*t98+0.1449175245975665D-3
     #*t81*t71*t420*t98+0.1097020523068037D0*t81*t82*t85*t427*t444
     #*t445+0.8266666666666667D-2*t264*t388+t105*(-t124+t158+t175+t106
     #*(t271+t292-t296-t310+0.3799574853701528D-1*t136*t458*t155
     #+0.3799574853701528D-1*t136*t147*(t326+t330)+t354
     #+0.1923661050931536D1*t172*t458*t153-0.7694644203726145D1*t358
     #-t361)+0.3109D-1*t405-0.1321010150222857D-2*t77*t420*t98-0.1D1
     #*t181*t427*t444*t445)
      vsigmaaa(i) = -0.3024D-2*t9*t17+0.3024D-2*t10*t193*(0.126D-1/t11
     #*t9*t13+0.126D-1*t23*t203)+0.2592083972726081D-3*t212/t6/t197
     #*t37*t50+0.8526592015546319D-3*t28*t227*t217-0.31D-2*t264*t23
      vsigmaab(i) = 0.D0
      vsigmabb(i) = -0.3024D-2*t57*t65+0.3024D-2*t58*t381*(0.126D-1
     #/t59*t57*t61+0.126D-1*t71*t391)+0.2592083972726081D-3*t400/t54
     #/t385*t85*t98+0.8526592015546319D-3*t76*t415*t405-0.31D-2*t264*t71
      vtaua(i) = -0.3410636806218528D-2*t28*t34*t217
      vtaub(i) = -0.3410636806218528D-2*t76*t82*t405
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      vtaua(i) = 0.0d0
      vtaub(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      taub = dmax1(0.D0,taub1(i))
      tau = taub
      t3 = rhob**(1.D0/3.D0)
      t4 = t3*rhob
      t6 = 1/t4
      t7 = t6*sigmabb
      t8 = dsqrt(sigmabb)
      t9 = t8*t6
      t10 = dlog(t9+dsqrt(1+t9**2))
      t13 = 1.D0+0.252D-1*t9*t10
      t14 = 1/t13
      t17 = rhob**2
      t18 = t3**2
      t20 = 1/t18/t17
      t21 = sigmabb*t20
      t23 = 1.D0+0.38D-1*t21
      t24 = t23**2
      t25 = 1/t24
      t26 = 1/rhob
      t29 = taub-0.25D0*sigmabb*t26
      t30 = t25*t29
      t31 = 1/t18
      t32 = t26**(1.D0/3.D0)
      t34 = 1.D0+0.1274696188700087D0*t32
      t36 = t26**(1.D0/6.D0)
      t39 = dsqrt(t26)
      t41 = t32**2
      t43 = 0.1112037486309468D2*t36+0.3844746237447211D1*t32
     #+0.1644733775567609D1*t39+0.2405871291288192D0*t41
      t46 = 1.D0+0.321646831778707D2/t43
      t47 = dlog(t46)
      zk(i) = -0.669978530171352D0*t4-0.3024D-2*t7*t14
     #-0.3410636806218528D-2*t30*t31*t34*t47
      vrhoa(i) = 0.D0
      t53 = 1/t3/t17
      t54 = t53*sigmabb
      t57 = t13**2
      t58 = 1/t57
      t62 = t17*rhob
      t64 = 1/t18/t62
      t66 = 1.D0+t21
      t67 = dsqrt(t66)
      t68 = 1/t67
      t71 = -0.336D-1*t8*t53*t10-0.336D-1*sigmabb*t64*t68
      t72 = t58*t71
      t76 = 1/t24/t23
      t77 = t76*t29
      t78 = t17**2
      t80 = 1/t3/t78
      t82 = t34*t47
      t83 = t82*sigmabb
      t86 = t25*sigmabb
      t88 = t20*t34*t47
      t92 = 1/t18/rhob
      t97 = 1/t41
      t102 = t30*t31
      t103 = t43**2
      t104 = 1/t103
      t105 = t34*t104
      t106 = t36**2
      t107 = t106**2
      t108 = t107*t36
      t109 = 1/t108
      t110 = 1/t17
      t115 = 1/t39
      t118 = 1/t32
      t121 = -0.1853395810515781D1*t109*t110-0.128158207914907D1*t97
     #*t110-0.8223668877838045D0*t115*t110-0.1603914194192128D0*t118
     #*t110
      t122 = 1/t46
      t123 = t121*t122
      t124 = t105*t123
      vrhob(i) = -0.893304706895136D0*t3+0.4032D-2*t54*t14+0.3024D-2
     #*t7*t72-0.6912223927269549D-3*t77*t80*t83-0.8526592015546319D-3
     #*t86*t88+0.2273757870812352D-2*t30*t92*t34*t47
     #+0.1449175245975665D-3*t30*t20*t97*t47+0.1097020523068037D0*t102
     #*t124
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      t135 = 0.126D-1/t8*t6*t10+0.126D-1*t20*t68
      t140 = 1/t3/t62
      t146 = t25*t92*t82
      vsigmabb(i) = -0.3024D-2*t6*t14+0.3024D-2*t7*t58*t135
     #+0.2592083972726081D-3*t77*t140*t34*t47+0.8526592015546319D-3*t146
      t148 = t25*t31
      vtaub(i) = -0.3410636806218528D-2*t148*t82
      vtaua(i) = 0.0d0
      v2rhoa2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t152 = 1/t57/t13
      t153 = t71**2
      t167 = 1/t18/t78
      t171 = sigmabb**2
      t177 = 1/t67/t66
      t193 = t24**2
      t195 = 1/t193*t29
      t196 = t78**2
      t203 = t78*t17
      t205 = 1/t3/t203
      t212 = t97*t47
      t218 = t104*t121
      t229 = 1/t3/t78/rhob
      t242 = 1/t78
      t245 = 1/t62
      t249 = 1/t41/t26
      t271 = t103**2
      t274 = t121**2
      t275 = t46**2
      t297 = 0.5873990330354695D-4*t77*t205*t212*sigmabb
     #+0.4446589853502444D-1*t77*t80*t34*t218*t122*sigmabb
     #+0.284219733851544D-2*t86*t64*t34*t47+0.3456111963634775D-2*t77
     #*t229*t83-0.4830584153252216D-3*t30*t64*t97*t47
     #-0.1462694030757383D0*t30*t92*t124+0.1097020523068037D0*t102
     #*t105*(-0.1544496508763151D1/t108/t26*t242+0.3706791621031562D1
     #*t109*t245-0.854388052766047D0*t249*t242+0.2563164158298141D1
     #*t97*t245-0.4111834438919023D0/t39/t26*t242+0.1644733775567609D1
     #*t115*t245-0.5346380647307093D-1/t32/t26*t242
     #+0.3207828388384256D0*t118*t245)*t122+0.3528531756410541D1*t102
     #*t34/t271*t274/t275+0.9661168306504433D-4*t30*t167*t249*t47
     #-0.932245253120402D-2*t30*t20*t97*t104*t123-0.2194041046136074D0
     #*t102*t34/t103/t43*t274*t122
      v2rhob2(i) = -0.6048D-2*t7*t152*t153-0.297768235631712D0*t31
     #-0.9408D-2*t140*sigmabb*t14-0.8064D-2*t54*t72+0.3024D-2*t7*t58*
     #(0.784D-1*t8*t140*t10+0.168D0*sigmabb*t167*t68-0.448D-1*t171/t3
     #/t78/t62*t177)-0.378959645135392D-2*t30*t88
     #+0.7245876229878325D-4*t86*t167*t97*t47+0.5485102615340186D-1
     #*t86*t20*t124-0.2101316073889943D-3*t195/t196*t82*t171
     #-0.3456111963634775D-3*t76*t171*t205*t34*t47+t297
      v2sigmaaa2(i) = 0.D0
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      t301 = t135**2
      t325 = t76*t80
      v2sigmabb2(i) = 0.6048D-2*t6*t58*t135-0.6048D-2*t7*t152*t301
     #+0.3024D-2*t7*t58*(-0.63D-2/t8/sigmabb*t6*t10+0.63D-2/sigmabb
     #*t20*t68-0.63D-2*t229*t177)-0.2954975728907732D-4*t195/t203*t34
     #*t47-0.129604198636304D-3*t325*t82
      v2taua2(i) = 0.D0
      v2taub2(i) = 0.D0
      v2tauab(i) = 0.D0
      v2rhoataua(i) = 0.D0
      v2rhoataub(i) = 0.D0
      v2rhobtaua(i) = 0.D0
      v2rhobtaub(i) = -0.6912223927269549D-3*t325*t83
     #+0.2273757870812352D-2*t146+0.1449175245975665D-3*t25*t20*t212
     #+0.1097020523068037D0*t148*t34*t218*t122
      v2sigmaaataua(i) = 0.D0
      v2sigmaaataub(i) = 0.D0
      v2sigmaabtaua(i) = 0.D0
      v2sigmaabtaub(i) = 0.D0
      v2sigmabbtaua(i) = 0.D0
      v2sigmabbtaub(i) = 0.2592083972726081D-3*t76*t140*t82
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      taua = dmax1(0.D0,taua1(i))
      tau = taua
      t3 = rhoa**(1.D0/3.D0)
      t4 = t3*rhoa
      t6 = 1/t4
      t7 = t6*sigmaaa
      t8 = dsqrt(sigmaaa)
      t9 = t8*t6
      t10 = dlog(t9+dsqrt(1+t9**2))
      t13 = 1.D0+0.252D-1*t9*t10
      t14 = 1/t13
      t17 = rhoa**2
      t18 = t3**2
      t20 = 1/t18/t17
      t21 = sigmaaa*t20
      t23 = 1.D0+0.38D-1*t21
      t24 = t23**2
      t25 = 1/t24
      t26 = 1/rhoa
      t29 = taua-0.25D0*sigmaaa*t26
      t30 = t25*t29
      t31 = 1/t18
      t32 = t26**(1.D0/3.D0)
      t34 = 1.D0+0.1274696188700087D0*t32
      t36 = t26**(1.D0/6.D0)
      t39 = dsqrt(t26)
      t41 = t32**2
      t43 = 0.1112037486309468D2*t36+0.3844746237447211D1*t32
     #+0.1644733775567609D1*t39+0.2405871291288192D0*t41
      t46 = 1.D0+0.321646831778707D2/t43
      t47 = dlog(t46)
      zk(i) = -0.669978530171352D0*t4-0.3024D-2*t7*t14
     #-0.3410636806218528D-2*t30*t31*t34*t47
      t53 = 1/t3/t17
      t54 = t53*sigmaaa
      t57 = t13**2
      t58 = 1/t57
      t62 = t17*rhoa
      t64 = 1/t18/t62
      t66 = 1.D0+t21
      t67 = dsqrt(t66)
      t68 = 1/t67
      t71 = -0.336D-1*t8*t53*t10-0.336D-1*sigmaaa*t64*t68
      t72 = t58*t71
      t76 = 1/t24/t23
      t77 = t76*t29
      t78 = t17**2
      t80 = 1/t3/t78
      t82 = t34*t47
      t83 = t82*sigmaaa
      t86 = t25*sigmaaa
      t88 = t20*t34*t47
      t92 = 1/t18/rhoa
      t97 = 1/t41
      t102 = t30*t31
      t103 = t43**2
      t104 = 1/t103
      t105 = t34*t104
      t106 = t36**2
      t107 = t106**2
      t108 = t107*t36
      t109 = 1/t108
      t110 = 1/t17
      t115 = 1/t39
      t118 = 1/t32
      t121 = -0.1853395810515781D1*t109*t110-0.128158207914907D1*t97
     #*t110-0.8223668877838045D0*t115*t110-0.1603914194192128D0*t118
     #*t110
      t122 = 1/t46
      t123 = t121*t122
      t124 = t105*t123
      vrhoa(i) = -0.893304706895136D0*t3+0.4032D-2*t54*t14+0.3024D-2
     #*t7*t72-0.6912223927269549D-3*t77*t80*t83-0.8526592015546319D-3
     #*t86*t88+0.2273757870812352D-2*t30*t92*t34*t47
     #+0.1449175245975665D-3*t30*t20*t97*t47+0.1097020523068037D0*t102
     #*t124
      vrhob(i) = 0.D0
      t135 = 0.126D-1/t8*t6*t10+0.126D-1*t20*t68
      t140 = 1/t3/t62
      t146 = t25*t92*t82
      vsigmaaa(i) = -0.3024D-2*t6*t14+0.3024D-2*t7*t58*t135
     #+0.2592083972726081D-3*t77*t140*t34*t47+0.8526592015546319D-3*t146
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      t148 = t25*t31
      vtaua(i) = -0.3410636806218528D-2*t148*t82
      vtaub(i) = 0.0d0
      t151 = t103**2
      t154 = t121**2
      t155 = t46**2
      t168 = 1/t57/t13
      t169 = t71**2
      t177 = 1/t18/t78
      t181 = sigmaaa**2
      t187 = 1/t67/t66
      t196 = 1/t3/t78/rhoa
      t202 = t104*t121
      t207 = t78*t17
      t209 = 1/t3/t207
      t211 = t97*t47
      t221 = t24**2
      t223 = 1/t221*t29
      t224 = t78**2
      t251 = 1/t41/t26
      t270 = 1/t78
      t273 = 1/t62
      t297 = -0.2101316073889943D-3*t223/t224*t82*t181
     #+0.284219733851544D-2*t86*t64*t34*t47-0.378959645135392D-2*t30
     #*t88+0.7245876229878325D-4*t86*t177*t97*t47
     #+0.5485102615340186D-1*t86*t20*t124-0.4830584153252216D-3*t30
     #*t64*t97*t47-0.1462694030757383D0*t30*t92*t124
     #+0.9661168306504433D-4*t30*t177*t251*t47-0.932245253120402D-2
     #*t30*t20*t97*t104*t123-0.2194041046136074D0*t102*t34/t103/t43
     #*t154*t122+0.1097020523068037D0*t102*t105*(-0.1544496508763151D1
     #/t108/t26*t270+0.3706791621031562D1*t109*t273
     #-0.854388052766047D0*t251*t270+0.2563164158298141D1*t97*t273
     #-0.4111834438919023D0/t39/t26*t270+0.1644733775567609D1*t115
     #*t273-0.5346380647307093D-1/t32/t26*t270+0.3207828388384256D0
     #*t118*t273)*t122
      v2rhoa2(i) = 0.3528531756410541D1*t102*t34/t151*t154/t155
     #-0.8064D-2*t54*t72-0.297768235631712D0*t31-0.9408D-2*t140
     #*sigmaaa*t14-0.6048D-2*t7*t168*t169+0.3024D-2*t7*t58*(0.784D-1
     #*t8*t140*t10+0.168D0*sigmaaa*t177*t68-0.448D-1*t181/t3/t78/t62
     #*t187)+0.3456111963634775D-2*t77*t196*t83+0.4446589853502444D-1
     #*t77*t80*t34*t202*t122*sigmaaa+0.5873990330354695D-4*t77*t209
     #*t211*sigmaaa-0.3456111963634775D-3*t76*t181*t209*t34*t47+t297
      v2rhob2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t301 = t135**2
      t325 = t76*t80
      v2sigmaaa2(i) = 0.6048D-2*t6*t58*t135-0.6048D-2*t7*t168*t301
     #+0.3024D-2*t7*t58*(-0.63D-2/t8/sigmaaa*t6*t10+0.63D-2/sigmaaa
     #*t20*t68-0.63D-2*t196*t187)-0.2954975728907732D-4*t223/t207*t34
     #*t47-0.129604198636304D-3*t325*t82
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      v2sigmabb2(i) = 0.D0
      v2taua2(i) = 0.D0
      v2taub2(i) = 0.D0
      v2tauab(i) = 0.D0
      v2rhoataua(i) = -0.6912223927269549D-3*t325*t83
     #+0.2273757870812352D-2*t146+0.1449175245975665D-3*t25*t20*t211
     #+0.1097020523068037D0*t148*t34*t202*t122
      v2rhoataub(i) = 0.D0
      v2rhobtaua(i) = 0.D0
      v2rhobtaub(i) = 0.D0
      v2sigmaaataua(i) = 0.2592083972726081D-3*t76*t140*t82
      v2sigmaaataub(i) = 0.D0
      v2sigmaabtaua(i) = 0.D0
      v2sigmaabtaub(i) = 0.D0
      v2sigmabbtaua(i) = 0.D0
      v2sigmabbtaub(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      taua = dmax1(0.D0,taua1(i))
      taub = dmax1(0.D0,taub1(i))
      tau = taua+taub
      t6 = rhoa**(1.D0/3.D0)
      t7 = t6*rhoa
      t9 = 1/t7
      t10 = t9*sigmaaa
      t11 = dsqrt(sigmaaa)
      t12 = t11*t9
      t13 = dlog(t12+dsqrt(1+t12**2))
      t16 = 1.D0+0.252D-1*t12*t13
      t17 = 1/t16
      t20 = rhoa**2
      t21 = t6**2
      t23 = 1/t21/t20
      t24 = sigmaaa*t23
      t26 = 1.D0+0.38D-1*t24
      t27 = t26**2
      t28 = 1/t27
      t29 = 1/rhoa
      t32 = taua-0.25D0*sigmaaa*t29
      t33 = t28*t32
      t34 = 1/t21
      t35 = t29**(1.D0/3.D0)
      t37 = 1.D0+0.1274696188700087D0*t35
      t39 = t29**(1.D0/6.D0)
      t42 = dsqrt(t29)
      t44 = t35**2
      t46 = 0.1112037486309468D2*t39+0.3844746237447211D1*t35
     #+0.1644733775567609D1*t42+0.2405871291288192D0*t44
      t49 = 1.D0+0.321646831778707D2/t46
      t50 = dlog(t49)
      t54 = rhob**(1.D0/3.D0)
      t55 = t54*rhob
      t57 = 1/t55
      t58 = t57*sigmabb
      t59 = dsqrt(sigmabb)
      t60 = t59*t57
      t61 = dlog(t60+dsqrt(1+t60**2))
      t64 = 1.D0+0.252D-1*t60*t61
      t65 = 1/t64
      t68 = rhob**2
      t69 = t54**2
      t71 = 1/t69/t68
      t72 = sigmabb*t71
      t74 = 1.D0+0.38D-1*t72
      t75 = t74**2
      t76 = 1/t75
      t77 = 1/rhob
      t80 = taub-0.25D0*sigmabb*t77
      t81 = t76*t80
      t82 = 1/t69
      t83 = t77**(1.D0/3.D0)
      t85 = 1.D0+0.1274696188700087D0*t83
      t87 = t77**(1.D0/6.D0)
      t90 = dsqrt(t77)
      t92 = t83**2
      t94 = 0.1112037486309468D2*t87+0.3844746237447211D1*t83
     #+0.1644733775567609D1*t90+0.2405871291288192D0*t92
      t97 = 1.D0+0.321646831778707D2/t94
      t98 = dlog(t97)
      t104 = 1.D0+0.31D-2*t24+0.31D-2*t72
      t105 = 1/t104
      t106 = rhoa+rhob
      t107 = 1/t106
      t108 = t107**(1.D0/3.D0)
      t110 = 1.D0+0.1325688999052018D0*t108
      t111 = t107**(1.D0/6.D0)
      t114 = dsqrt(t107)
      t116 = t108**2
      t118 = 0.598255043577108D1*t111+0.2225569421150687D1*t108
     #+0.8004286349993634D0*t114+0.1897004325747559D0*t116
      t121 = 1.D0+0.160818243221511D2/t118
      t122 = dlog(t121)
      t124 = 0.62182D-1*t110*t122
      t126 = 1.D0+0.6901399211255825D-1*t108
      t131 = 0.8157414703487641D1*t111+0.2247591863577616D1*t108
     #+0.4300972471276643D0*t114+0.1911512595127338D0*t116
      t134 = 1.D0+0.2960857464321668D2/t131
      t135 = dlog(t134)
      t136 = t126*t135
      t138 = rhoa-1.D0*rhob
      t139 = t138*t107
      t140 = 1.D0+t139
      t141 = t140**(1.D0/3.D0)
      t144 = 1.D0-1.D0*t139
      t145 = t144**(1.D0/3.D0)
      t147 = t141*t140+t145*t144-2.D0
      t148 = t138**2
      t149 = t148**2
      t150 = t106**2
      t151 = t150**2
      t152 = 1/t151
      t153 = t149*t152
      t155 = 1.D0-1.D0*t153
      t156 = t147*t155
      t158 = 0.3799574853701528D-1*t136*t156
      t160 = 1.D0+0.1274696188700087D0*t108
      t165 = 0.1112037486309468D2*t111+0.3844746237447211D1*t108
     #+0.1644733775567609D1*t114+0.2405871291288192D0*t116
      t168 = 1.D0+0.321646831778707D2/t165
      t169 = dlog(t168)
      t172 = -0.3109D-1*t160*t169+t124
      t173 = t172*t147
      t175 = 0.1923661050931536D1*t173*t153
      t178 = rhoa*t37
      t181 = rhob*t85
      t184 = t106*(-t124+t158+t175)+0.3109D-1*t178*t50+0.3109D-1*t181
     #*t98
      zk(i) = -0.669978530171352D0*t7-0.3024D-2*t10*t17
     #-0.3410636806218528D-2*t33*t34*t37*t50-0.669978530171352D0*t55
     #-0.3024D-2*t58*t65-0.3410636806218528D-2*t81*t82*t85*t98+t105*t184
      t188 = 1/t6/t20
      t189 = t188*sigmaaa
      t192 = t16**2
      t193 = 1/t192
      t197 = t20*rhoa
      t199 = 1/t21/t197
      t200 = sigmaaa*t199
      t201 = 1.D0+t24
      t202 = dsqrt(t201)
      t203 = 1/t202
      t206 = -0.336D-1*t11*t188*t13-0.336D-1*t200*t203
      t207 = t193*t206
      t211 = 1/t27/t26
      t212 = t211*t32
      t213 = t20**2
      t215 = 1/t6/t213
      t217 = t37*t50
      t218 = t217*sigmaaa
      t221 = t28*sigmaaa
      t223 = t23*t37*t50
      t227 = 1/t21/rhoa
      t232 = 1/t44
      t237 = t33*t34
      t238 = t46**2
      t239 = 1/t238
      t240 = t37*t239
      t241 = t39**2
      t242 = t241**2
      t243 = t242*t39
      t244 = 1/t243
      t245 = 1/t20
      t250 = 1/t42
      t253 = 1/t35
      t256 = -0.1853395810515781D1*t244*t245-0.128158207914907D1*t232
     #*t245-0.8223668877838045D0*t250*t245-0.1603914194192128D0*t253
     #*t245
      t257 = 1/t49
      t258 = t256*t257
      t259 = t240*t258
      t262 = t104**2
      t263 = 1/t262
      t264 = t263*t184
      t267 = 1/t116
      t268 = 1/t150
      t269 = t267*t268
      t270 = t269*t122
      t271 = 0.2747799777968419D-2*t270
      t272 = t118**2
      t273 = 1/t272
      t274 = t110*t273
      t275 = t111**2
      t276 = t275**2
      t277 = t276*t111
      t278 = 1/t277
      t279 = t278*t268
      t282 = 1/t114
      t283 = t282*t268
      t285 = 1/t108
      t286 = t285*t268
      t288 = -0.99709173929518D0*t279-0.7418564737168958D0*t269
     #-0.4002143174996817D0*t283-0.1264669550498372D0*t286
      t289 = 1/t121
      t291 = t274*t288*t289
      t292 = 0.1D1*t291
      t293 = t135*t147
      t294 = t293*t155
      t295 = t269*t294
      t296 = 0.8740794299481065D-3*t295
      t297 = t131**2
      t298 = 1/t297
      t299 = t126*t298
      t304 = -0.135956911724794D1*t279-0.7491972878592054D0*t269
     #-0.2150486235638321D0*t283-0.1274341730084892D0*t286
      t305 = t299*t304
      t306 = 1/t134
      t307 = t306*t147
      t308 = t307*t155
      t309 = t305*t308
      t310 = 0.1124999956683108D1*t309
      t311 = t138*t268
      t312 = 1.D0*t311
      t313 = t107-t312
      t316 = 1.D0*t107
      t317 = -t316+t311
      t320 = 0.1333333333333333D1*t141*t313+0.1333333333333333D1*t145
     #*t317
      t322 = t136*t320*t155
      t323 = 0.3799574853701528D-1*t322
      t324 = t148*t138
      t325 = t324*t152
      t326 = 4.D0*t325
      t328 = 1/t151/t106
      t329 = t149*t328
      t330 = 4.D0*t329
      t331 = -t326+t330
      t333 = t136*t147*t331
      t334 = 0.3799574853701528D-1*t333
      t337 = t165**2
      t338 = 1/t337
      t339 = t160*t338
      t344 = -0.1853395810515781D1*t279-0.128158207914907D1*t269
     #-0.8223668877838045D0*t283-0.1603914194192128D0*t286
      t345 = 1/t168
      t351 = 0.1321010150222857D-2*t269*t169+0.1D1*t339*t344*t345
     #-0.2747799777968419D-2*t270-0.1D1*t291
      t352 = t351*t147
      t353 = t352*t153
      t354 = 0.1923661050931536D1*t353
      t355 = t172*t320
      t356 = t355*t153
      t357 = 0.1923661050931536D1*t356
      t358 = t173*t325
      t360 = t173*t329
      t361 = 0.7694644203726145D1*t360
      t365 = t29*t232
      t368 = t239*t256
      t369 = t368*t257
      t372 = -t124+t158+t175+t106*(t271+t292-t296-t310+t323+t334+t354
     #+t357+0.7694644203726145D1*t358-t361)+0.3109D-1*t217
     #-0.1321010150222857D-2*t365*t50-0.1D1*t178*t369
      vrhoa(i) = -0.893304706895136D0*t6+0.4032D-2*t189*t17+0.3024D-2
     #*t10*t207-0.6912223927269549D-3*t212*t215*t218
     #-0.8526592015546319D-3*t221*t223+0.2273757870812352D-2*t33*t227
     #*t37*t50+0.1449175245975665D-3*t33*t23*t232*t50
     #+0.1097020523068037D0*t237*t259+0.8266666666666667D-2*t264*t200
     #+t105*t372
      t376 = 1/t54/t68
      t377 = t376*sigmabb
      t380 = t64**2
      t381 = 1/t380
      t385 = t68*rhob
      t387 = 1/t69/t385
      t388 = sigmabb*t387
      t389 = 1.D0+t72
      t390 = dsqrt(t389)
      t391 = 1/t390
      t394 = -0.336D-1*t59*t376*t61-0.336D-1*t388*t391
      t395 = t381*t394
      t399 = 1/t75/t74
      t400 = t399*t80
      t401 = t68**2
      t403 = 1/t54/t401
      t405 = t85*t98
      t406 = t405*sigmabb
      t409 = t76*sigmabb
      t411 = t71*t85*t98
      t415 = 1/t69/rhob
      t420 = 1/t92
      t425 = t81*t82
      t426 = t94**2
      t427 = 1/t426
      t428 = t85*t427
      t429 = t87**2
      t430 = t429**2
      t431 = t430*t87
      t432 = 1/t431
      t433 = 1/t68
      t438 = 1/t90
      t441 = 1/t83
      t444 = -0.1853395810515781D1*t432*t433-0.128158207914907D1*t420
     #*t433-0.8223668877838045D0*t438*t433-0.1603914194192128D0*t441
     #*t433
      t445 = 1/t97
      t446 = t444*t445
      t447 = t428*t446
      t452 = -t316-t312
      t455 = t107+t311
      t458 = 0.1333333333333333D1*t141*t452+0.1333333333333333D1*t145
     #*t455
      t460 = t136*t458*t155
      t461 = 0.3799574853701528D-1*t460
      t462 = t326+t330
      t464 = t136*t147*t462
      t465 = 0.3799574853701528D-1*t464
      t466 = t172*t458
      t467 = t466*t153
      t468 = 0.1923661050931536D1*t467
      t473 = t77*t420
      t476 = t427*t444
      t477 = t476*t445
      t480 = -t124+t158+t175+t106*(t271+t292-t296-t310+t461+t465+t354
     #+t468-0.7694644203726145D1*t358-t361)+0.3109D-1*t405
     #-0.1321010150222857D-2*t473*t98-0.1D1*t181*t477
      vrhob(i) = -0.893304706895136D0*t54+0.4032D-2*t377*t65+0.3024D-2
     #*t58*t395-0.6912223927269549D-3*t400*t403*t406
     #-0.8526592015546319D-3*t409*t411+0.2273757870812352D-2*t81*t415
     #*t85*t98+0.1449175245975665D-3*t81*t71*t420*t98
     #+0.1097020523068037D0*t425*t447+0.8266666666666667D-2*t264*t388
     #+t105*t480
      t484 = 1/t11
      t490 = 0.126D-1*t484*t9*t13+0.126D-1*t23*t203
      t491 = t193*t490
      t495 = 1/t6/t197
      t500 = t28*t227
      t501 = t500*t217
      vsigmaaa(i) = -0.3024D-2*t9*t17+0.3024D-2*t10*t491
     #+0.2592083972726081D-3*t212*t495*t37*t50+0.8526592015546319D-3
     #*t501-0.31D-2*t264*t23
      vsigmaab(i) = 0.D0
      t507 = 1/t59
      t513 = 0.126D-1*t507*t57*t61+0.126D-1*t71*t391
      t514 = t381*t513
      t518 = 1/t54/t385
      t523 = t76*t415
      t524 = t523*t405
      vsigmabb(i) = -0.3024D-2*t57*t65+0.3024D-2*t58*t514
     #+0.2592083972726081D-3*t400*t518*t85*t98+0.8526592015546319D-3
     #*t524-0.31D-2*t264*t71
      t528 = t28*t34
      vtaua(i) = -0.3410636806218528D-2*t528*t217
      t531 = t76*t82
      vtaub(i) = -0.3410636806218528D-2*t531*t405
      t535 = 1/t192/t16
      t536 = t206**2
      t541 = 1/t21/t213
      t542 = sigmaaa*t541
      t547 = 1/t262/t104*t184
      t548 = sigmaaa**2
      t549 = t213*t197
      t552 = t548/t6/t549
      t558 = 1/t6/t213/rhoa
      t563 = 1/t44/t29
      t570 = 1/t213
      t573 = 1/t197
      t592 = -0.1544496508763151D1/t243/t29*t570+0.3706791621031562D1
     #*t244*t573-0.854388052766047D0*t563*t570+0.2563164158298141D1
     #*t232*t573-0.4111834438919023D0/t42/t29*t570
     #+0.1644733775567609D1*t250*t573-0.5346380647307093D-1/t35/t29
     #*t570+0.3207828388384256D0*t253*t573
      t598 = 1/t238/t46
      t600 = t256**2
      t616 = t238**2
      t617 = 1/t616
      t619 = t49**2
      t620 = 1/t619
      t625 = -0.6048D-2*t10*t535*t536-0.3031111111111111D-1*t264*t542
     #+0.1366755555555556D-3*t547*t552-0.297768235631712D0*t34
     #+0.3456111963634775D-2*t212*t558*t218+0.9661168306504433D-4*t33
     #*t541*t563*t50+0.1097020523068037D0*t237*t240*t592*t257
     #-0.2194041046136074D0*t237*t37*t598*t600*t257
     #-0.932245253120402D-2*t33*t23*t232*t239*t258
     #-0.4830584153252216D-3*t33*t199*t232*t50-0.378959645135392D-2
     #*t33*t223+0.3528531756410541D1*t237*t37*t617*t600*t620
      t626 = t263*t372
      t641 = t213*t20
      t643 = 1/t6/t641
      t645 = t232*t50
      t655 = 1/t202/t201
      t669 = t27**2
      t671 = 1/t669*t32
      t672 = t213**2
      t683 = t215*t37
      t691 = 0.1538928840745229D2*t360
      t694 = 0.1748158859896213D-2*t295
      t695 = 0.2249999913366216D1*t309
      t696 = 0.3847322101863073D1*t353
      t697 = 0.2D1*t291
      t698 = 0.5495599555936838D-2*t270
      t701 = 1/t116/t107*t152
      t705 = 1/t150/t106
      t706 = t267*t705
      t716 = t344**2
      t722 = 1/t277/t107*t152
      t724 = t278*t705
      t730 = 1/t114/t107*t152
      t732 = t282*t705
      t736 = 1/t108/t107*t152
      t738 = t285*t705
      t744 = t337**2
      t747 = t168**2
      t752 = t701*t122
      t754 = t706*t122
      t758 = t269*t273*t288*t289
      t763 = t288**2
      t765 = t110/t272/t118*t763*t289
      t777 = t274*(-0.8309097827459833D0*t722+0.199418347859036D1*t724
     #-0.4945709824779306D0*t701+0.1483712947433792D1*t706
     #-0.2001071587498409D0*t730+0.8004286349993634D0*t732
     #-0.4215565168327908D-1*t736+0.2529339100996745D0*t738)*t289
      t779 = t272**2
      t782 = t121**2
      t785 = t110/t779*t763/t782
      t787 = 0.8806734334819047D-3*t701*t169-0.2642020300445714D-2
     #*t706*t169-0.8497974591333914D-1*t269*t338*t344*t345-0.2D1*t160
     #/t337/t165*t716*t345+0.1D1*t339*(-0.1544496508763151D1*t722
     #+0.3706791621031562D1*t724-0.854388052766047D0*t701
     #+0.2563164158298141D1*t706-0.4111834438919023D0*t730
     #+0.1644733775567609D1*t732-0.5346380647307093D-1*t736
     #+0.3207828388384256D0*t738)*t345+0.321646831778707D2*t160/t744
     #*t716/t747-0.1831866518645613D-2*t752+0.5495599555936838D-2*t754
     #+0.8837926660346786D-1*t758+0.2D1*t765-0.1D1*t777
     #-0.160818243221511D2*t785
      t790 = 0.1923661050931536D1*t787*t147*t153
      t791 = t355*t325
      t796 = t355*t329
      t798 = t148*t152
      t799 = 12.D0*t798
      t800 = t324*t328
      t801 = 32.D0*t800
      t804 = t149/t151/t150
      t805 = 20.D0*t804
      t811 = 0.3847322101863073D2*t173*t804
      t812 = t173*t798
      t813 = 0.2308393261117844D2*t812
      t814 = t141**2
      t815 = 1/t814
      t816 = t313**2
      t819 = 2.D0*t268
      t821 = 2.D0*t138*t705
      t822 = -t819+t821
      t825 = t145**2
      t826 = 1/t825
      t827 = t317**2
      t833 = 0.4444444444444444D0*t815*t816+0.1333333333333333D1*t141
     #*t822+0.4444444444444444D0*t826*t827-0.1333333333333333D1*t145
     #*t822
      t837 = t173*t800
      t839 = t352*t325
      t841 = 0.5495599555936838D-2*t754
      t843 = 0.1538928840745229D2*t352*t329
      t845 = t351*t320*t153
      t850 = t790+0.1538928840745229D2*t791+0.7599149707403056D-1*t136
     #*t320*t331-0.1538928840745229D2*t796+0.3799574853701528D-1*t136
     #*t147*(-t799+t801-t805)+t811+t813+0.1923661050931536D1*t172*t833
     #*t153-0.6155715362980916D2*t837+0.1538928840745229D2*t839-t841
     #-t843+0.3847322101863073D1*t845+0.3799574853701528D-1*t136*t833
     #*t155
      t851 = 0.1D1*t777
      t852 = t297**2
      t855 = t304**2
      t857 = t134**2
      t862 = 0.3330964519106732D2*t126/t852*t855/t857*t147*t155
      t864 = t305*t307*t331
      t868 = t305*t306*t320*t155
      t881 = 0.1124999956683108D1*t299*(-0.1132974264373283D1*t722
     #+0.271913823449588D1*t724-0.4994648585728036D0*t701
     #+0.1498394575718411D1*t706-0.1075243117819161D0*t730
     #+0.4300972471276643D0*t732-0.4247805766949639D-1*t736
     #+0.2548683460169784D0*t738)*t308
      t882 = 0.1831866518645613D-2*t752
      t884 = 0.5827196199654043D-3*t701*t294
      t890 = 0.2249999913366216D1*t126/t297/t131*t855*t308
      t893 = t269*t135*t320*t155
      t899 = 0.5176049209143758D-1*t269*t298*t304*t306*t156
      t900 = 0.160818243221511D2*t785
      t901 = 0.2D1*t765
      t903 = 0.1748158859896213D-2*t706*t294
      t904 = 0.8837926660346786D-1*t758
      t906 = t269*t293*t331
      t908 = t851-t862-0.2249999913366216D1*t864-0.2249999913366216D1
     #*t868-t881+t882-t884+t890-0.1748158859896213D-2*t893+t899+t900
     #-t901+t903-t904-0.1748158859896213D-2*t906
      t929 = 0.3847322101863073D1*t356+0.1538928840745229D2*t358-t691
     #+0.7599149707403056D-1*t322+0.7599149707403056D-1*t333-t694-t695
     #+t696+t697+t698+t106*(t850+t908)-0.2D1*t259-0.1D1*t178*t239*t592
     #*t257-0.321646831778707D2*t178*t617*t600*t620
     #-0.8806734334819047D-3*t573*t563*t50+0.8497974591333914D-1*t365
     #*t369+0.2D1*t178*t598*t600*t257
      t931 = 0.1653333333333333D-1*t626*t200-0.8064D-2*t189*t207
     #-0.1462694030757383D0*t33*t227*t259+0.7245876229878325D-4*t221
     #*t541*t232*t50-0.9408D-2*t495*sigmaaa*t17+0.5873990330354695D-4
     #*t212*t643*t645*sigmaaa+0.3024D-2*t10*t193*(0.784D-1*t11*t495
     #*t13+0.168D0*t542*t203-0.448D-1*t552*t655)+0.5485102615340186D-1
     #*t221*t23*t259+0.284219733851544D-2*t221*t199*t37*t50
     #-0.2101316073889943D-3*t671/t672*t217*t548-0.3456111963634775D-3
     #*t211*t548*t643*t37*t50+0.4446589853502444D-1*t212*t683*t368
     #*t257*sigmaaa+t105*t929
      v2rhoa2(i) = t625+t931
      t932 = sigmabb**2
      t933 = t401*t385
      t936 = t932/t54/t933
      t940 = 1/t69/t401
      t941 = sigmabb*t940
      t950 = t426**2
      t951 = 1/t950
      t953 = t444**2
      t954 = t97**2
      t955 = 1/t954
      t965 = t269*t293*t462
      t969 = t305*t306*t458*t155
      t973 = t269*t135*t458*t155
      t975 = t452**2
      t978 = t819+t821
      t981 = t455**2
      t987 = 0.4444444444444444D0*t815*t975+0.1333333333333333D1*t141
     #*t978+0.4444444444444444D0*t826*t981-0.1333333333333333D1*t145
     #*t978
      t992 = t305*t307*t462
      t994 = t466*t329
      t1004 = t351*t458*t153
      t1009 = t466*t325
      t1011 = t790-0.1748158859896213D-2*t965-0.2249999913366216D1
     #*t969-0.1748158859896213D-2*t973+0.3799574853701528D-1*t136*t987
     #*t155-0.2249999913366216D1*t992-0.1538928840745229D2*t994
     #+0.7599149707403056D-1*t136*t458*t462+0.3799574853701528D-1*t136
     #*t147*(-t799-t801-t805)+0.3847322101863073D1*t1004
     #+0.1923661050931536D1*t172*t987*t153-0.1538928840745229D2*t1009
     #+t811+t813
      t1014 = 0.6155715362980916D2*t837-0.1538928840745229D2*t839-t841
     #-t843+t851-t862-t881+t882-t884+t890+t899+t900-t901+t903-t904
      t1018 = 1/t385
      t1020 = 1/t92/t77
      t1027 = 1/t426/t94
      t1034 = 1/t401
      t1055 = -0.1544496508763151D1/t431/t77*t1034
     #+0.3706791621031562D1*t432*t1018-0.854388052766047D0*t1020*t1034
     #+0.2563164158298141D1*t420*t1018-0.4111834438919023D0/t90/t77
     #*t1034+0.1644733775567609D1*t438*t1018-0.5346380647307093D-1/t83
     #/t77*t1034+0.3207828388384256D0*t441*t1018
      t1064 = -0.1538928840745229D2*t358-t691-t694-t695+t696+t697+t698
     #+0.7599149707403056D-1*t460+0.7599149707403056D-1*t464
     #+0.3847322101863073D1*t467+t106*(t1011+t1014)-0.2D1*t447
     #-0.8806734334819047D-3*t1018*t1020*t98+0.8497974591333914D-1
     #*t473*t477+0.2D1*t181*t1027*t953*t445-0.1D1*t181*t427*t1055*t445
     #-0.321646831778707D2*t181*t951*t953*t955
      t1072 = 1/t390/t389
      t1080 = 1/t380/t64
      t1081 = t394**2
      t1087 = 1/t54/t401/rhob
      t1091 = t401*t68
      t1093 = 1/t54/t1091
      t1095 = t420*t98
      t1104 = 0.1366755555555556D-3*t547*t936-0.3031111111111111D-1
     #*t264*t941-0.8064D-2*t377*t395-0.9408D-2*t518*sigmabb*t65
     #-0.297768235631712D0*t82+0.3528531756410541D1*t425*t85*t951*t953
     #*t955+t105*t1064+0.3024D-2*t58*t381*(0.784D-1*t59*t518*t61
     #+0.168D0*t941*t391-0.448D-1*t936*t1072)-0.6048D-2*t58*t1080
     #*t1081+0.3456111963634775D-2*t400*t1087*t406
     #+0.5873990330354695D-4*t400*t1093*t1095*sigmabb
     #-0.3456111963634775D-3*t399*t932*t1093*t85*t98
      t1105 = t75**2
      t1107 = 1/t1105*t80
      t1108 = t401**2
      t1122 = t403*t85
      t1144 = t263*t480
      t1161 = -0.2101316073889943D-3*t1107/t1108*t405*t932
     #+0.284219733851544D-2*t409*t387*t85*t98+0.7245876229878325D-4
     #*t409*t940*t420*t98+0.4446589853502444D-1*t400*t1122*t476*t445
     #*sigmabb-0.4830584153252216D-3*t81*t387*t420*t98
     #+0.5485102615340186D-1*t409*t71*t447-0.378959645135392D-2*t81
     #*t411+0.9661168306504433D-4*t81*t940*t1020*t98
     #-0.1462694030757383D0*t81*t415*t447+0.1653333333333333D-1*t1144
     #*t388-0.932245253120402D-2*t81*t71*t420*t427*t446
     #-0.2194041046136074D0*t425*t85*t1027*t953*t445
     #+0.1097020523068037D0*t425*t428*t1055*t445
      v2rhob2(i) = t1104+t1161
      t1193 = 0.4444444444444444D0*t815*t313*t452+0.2666666666666667D1
     #*t141*t138*t705+0.4444444444444444D0*t826*t317*t455
     #-0.2666666666666667D1*t145*t138*t705
      t1210 = t790+0.3799574853701528D-1*t136*t320*t462
     #+0.3799574853701528D-1*t136*t147*(t799-t805)
     #+0.3799574853701528D-1*t136*t458*t331+0.3799574853701528D-1*t136
     #*t1193*t155+0.1923661050931536D1*t172*t1193*t153
     #-0.8740794299481065D-3*t965-0.1124999956683108D1*t969
     #-0.8740794299481065D-3*t973-0.1124999956683108D1*t992
     #-0.7694644203726145D1*t994-0.7694644203726145D1*t791
     #-0.7694644203726145D1*t796+0.1923661050931536D1*t1004
     #+0.7694644203726145D1*t1009+t811-0.2308393261117844D2*t812
      t1216 = -t841-t843+0.1923661050931536D1*t845+t851-t862
     #-0.1124999956683108D1*t864-0.1124999956683108D1*t868-t881+t882
     #-t884+t890-0.8740794299481065D-3*t893+t899+t900-t901+t903-t904
     #-0.8740794299481065D-3*t906
      t1219 = t698+t697-t694-t695+t461+t465+t696+t468-t691+t323+t334
     #+t357+t106*(t1210+t1216)
      v2rhoab(i) = 0.1366755555555556D-3*t547*sigmaaa*t199*sigmabb
     #*t387+0.8266666666666667D-2*t1144*t200+0.8266666666666667D-2
     #*t626*t388+t105*t1219
      t1225 = t9*t193
      t1237 = sigmaaa*t643
      t1254 = t28*t23
      v2rhoasigmaaa(i) = 0.4032D-2*t188*t17-0.4032D-2*t189*t491
     #+0.3024D-2*t1225*t206-0.6048D-2*t10*t535*t206*t490+0.3024D-2*t10
     #*t193*(-0.168D-1*t484*t188*t13-0.504D-1*t199*t203+0.168D-1*t1237
     #*t655)+0.7879935277087286D-4*t671/t549*t218
     #+0.2376076974998908D-3*t211*t558*t218-0.8640279909086936D-3*t212
     #*t683*t50-0.142109866925772D-2*t1254*t217-0.1101373186941505D-4
     #*t212*t558*t232*t50-0.3622938114939162D-4*t28*t199*t645
     #-0.8337355975317082D-2*t212*t495*t259-0.2742551307670093D-1*t500
     #*t37*t369-0.5125333333333333D-4*t547*t1237+0.8266666666666667D-2
     #*t264*t199-0.31D-2*t626*t23
      v2rhoasigmaab(i) = 0.D0
      v2rhoasigmabb(i) = -0.5125333333333333D-4*t547*t200*t71-0.31D-2
     #*t626*t71
      v2rhobsigmaaa(i) = -0.5125333333333333D-4*t547*t388*t23-0.31D-2
     #*t1144*t23
      v2rhobsigmaab(i) = 0.D0
      t1290 = t57*t381
      t1302 = sigmabb*t1093
      t1319 = t76*t71
      v2rhobsigmabb(i) = 0.4032D-2*t376*t65-0.4032D-2*t377*t514
     #+0.3024D-2*t1290*t394-0.6048D-2*t58*t1080*t394*t513+0.3024D-2
     #*t58*t381*(-0.168D-1*t507*t376*t61-0.504D-1*t387*t391+0.168D-1
     #*t1302*t1072)+0.7879935277087286D-4*t1107/t933*t406
     #+0.2376076974998908D-3*t399*t1087*t406-0.8640279909086936D-3
     #*t400*t1122*t98-0.142109866925772D-2*t1319*t405
     #-0.1101373186941505D-4*t400*t1087*t420*t98-0.3622938114939162D-4
     #*t76*t387*t1095-0.8337355975317082D-2*t400*t518*t447
     #-0.2742551307670093D-1*t523*t85*t477-0.5125333333333333D-4*t547
     #*t1302+0.8266666666666667D-2*t264*t387-0.31D-2*t1144*t71
      t1343 = t490**2
      t1367 = t211*t215
      v2sigmaaa2(i) = 0.6048D-2*t1225*t490-0.6048D-2*t10*t535*t1343
     #+0.3024D-2*t10*t193*(-0.63D-2/t11/sigmaaa*t9*t13+0.63D-2/sigmaaa
     #*t23*t203-0.63D-2*t558*t655)-0.2954975728907732D-4*t671/t641*t37
     #*t50-0.129604198636304D-3*t1367*t217+0.1922D-4*t547*t558
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.1922D-4*t547*t23*t71
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      t1376 = t513**2
      t1400 = t399*t403
      v2sigmabb2(i) = 0.6048D-2*t1290*t513-0.6048D-2*t58*t1080*t1376
     #+0.3024D-2*t58*t381*(-0.63D-2/t59/sigmabb*t57*t61+0.63D-2
     #/sigmabb*t71*t391-0.63D-2*t1087*t1072)-0.2954975728907732D-4
     #*t1107/t1091*t85*t98-0.129604198636304D-3*t1400*t405+0.1922D-4
     #*t547*t1087
      v2taua2(i) = 0.D0
      v2taub2(i) = 0.D0
      v2tauab(i) = 0.D0
      v2rhoataua(i) = -0.6912223927269549D-3*t1367*t218
     #+0.2273757870812352D-2*t501+0.1449175245975665D-3*t1254*t645
     #+0.1097020523068037D0*t528*t37*t369
      v2rhoataub(i) = 0.D0
      v2rhobtaua(i) = 0.D0
      v2rhobtaub(i) = -0.6912223927269549D-3*t1400*t406
     #+0.2273757870812352D-2*t524+0.1449175245975665D-3*t1319*t1095
     #+0.1097020523068037D0*t531*t85*t477
      v2sigmaaataua(i) = 0.2592083972726081D-3*t211*t495*t217
      v2sigmaabtaua(i) = 0.D0
      v2sigmabbtaua(i) = 0.D0
      v2sigmaaataub(i) = 0.D0
      v2sigmaabtaub(i) = 0.D0
      v2sigmabbtaub(i) = 0.2592083972726081D-3*t399*t518*t405
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      v2rhob2(i) = 0.0d0
      v2rhoab(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2rhoasigmaab(i) = 0.0d0
      v2rhoasigmabb(i) = 0.0d0
      v2rhobsigmaaa(i) = 0.0d0
      v2rhobsigmaab(i) = 0.0d0
      v2rhobsigmabb(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      v2sigmaab2(i) = 0.0d0
      v2sigmabb2(i) = 0.0d0
      v2sigmaaaab(i) = 0.0d0
      v2sigmaaabb(i) = 0.0d0
      v2sigmaabbb(i) = 0.0d0
      vtaua(i) = 0.0d0
      vtaub(i) = 0.0d0
      v2rhoataua(i) = 0.0d0
      v2rhoataub(i) = 0.0d0
      v2rhobtaua(i) = 0.0d0
      v2rhobtaub(i) = 0.0d0
      v2taua2(i) = 0.0d0
      v2taub2(i) = 0.0d0
      v2tauab(i) = 0.0d0
      v2sigmaaataua(i) = 0.0d0
      v2sigmaaataub(i) = 0.0d0
      v2sigmaabtaua(i) = 0.0d0
      v2sigmaabtaub(i) = 0.0d0
      v2sigmabbtaua(i) = 0.0d0
      v2sigmabbtaub(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end
      
      
      subroutine rks_xc_b1b95
     & (ideriv,npt,rhoa1,sigmaaa1,taua1,
     &  zk,vrhoa,vsigmaaa,vtaua,
     &  v2rhoa2,v2rhoasigmaaa,v2sigmaaa2,
     &  v2rhoataua,v2sigmaaataua,v2taua2)
c
c     A.D. Becke
c     Density-functional thermochemistry. IV.
c     A new dynamical correlation functional and implications
c     for exact-exchange mixing
c     J. Chem. Phys. 104 (1996) 1040-1046
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt)
      REAL sigmaaa1(npt)
      REAL taua1(npt)
      REAL zk(npt),vrhoa(npt),vsigmaaa(npt),vtaua(npt)
      REAL v2rhoa2(npt),v2rhoasigmaaa(npt),v2sigmaaa2(npt)
      REAL v2rhoataua(npt),v2sigmaaataua(npt),v2taua2(npt)
      parameter(tol=1.0d-20)
      
      if(ideriv.eq.0) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      tau = dmax1(0.D0,taua1(i))
      t3 = rho**(1.D0/3.D0)
      t4 = t3*rho
      t6 = 1/t4
      t8 = dsqrt(sigma)
      t9 = t8*t6
      t11 = dlog(0.1259921049894873D1*t9+dsqrt(1+0.1587401051968199D1
     #*t9**2))
      t18 = rho**2
      t19 = t3**2
      t22 = sigma/t19/t18
      t25 = (1.D0+0.6032123997479158D-1*t22)**2
      t28 = 1/rho
      t34 = t28**(1.D0/3.D0)
      t36 = 1.D0+0.1606016560364007D0*t34
      t38 = t28**(1.D0/6.D0)
      t41 = dsqrt(t28)
      t43 = t34**2
      t49 = dlog(1.D0+0.321646831778707D2/(0.1248219874679732D2*t38
     #+0.4844076716063854D1*t34+0.2326004811900819D1*t41
     #+0.3819082618690966D0*t43))
      t67 = dlog(1.D0+0.160818243221511D2/(0.598255043577108D1*t38
     #+0.2225569421150687D1*t34+0.8004286349993634D0*t41
     #+0.1897004325747559D0*t43))
      zk(i) = -0.5317623117950561D0*t4-0.3810001254882096D-2*t6*sigma/
     #(1.D0+0.317500104573508D-1*t9*t11)-0.108280969081455D-1/t25*
     #(0.5D0*tau-0.125D0*sigma*t28)/t19*t36*t49+1/(1.D0
     #+0.9841886522202837D-2*t22)*(-0.62182D-1*rho*(1.D0
     #+0.1325688999052018D0*t34)*t67+0.3109D-1*rho*t36*t49)
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      tau = dmax1(0.D0,taua1(i))
      t3 = rho**(1.D0/3.D0)
      t4 = t3*rho
      t6 = 1/t4
      t7 = t6*sigma
      t8 = dsqrt(sigma)
      t9 = t8*t6
      t11 = dlog(0.1259921049894873D1*t9+dsqrt(1+0.1587401051968199D1
     #*t9**2))
      t14 = 1.D0+0.317500104573508D-1*t9*t11
      t15 = 1/t14
      t18 = rho**2
      t19 = t3**2
      t21 = 1/t19/t18
      t22 = sigma*t21
      t24 = 1.D0+0.6032123997479158D-1*t22
      t25 = t24**2
      t26 = 1/t25
      t28 = 1/rho
      t31 = 0.5D0*tau-0.125D0*sigma*t28
      t32 = t26*t31
      t33 = 1/t19
      t34 = t28**(1.D0/3.D0)
      t36 = 1.D0+0.1606016560364007D0*t34
      t38 = t28**(1.D0/6.D0)
      t41 = dsqrt(t28)
      t43 = t34**2
      t45 = 0.1248219874679732D2*t38+0.4844076716063854D1*t34
     #+0.2326004811900819D1*t41+0.3819082618690966D0*t43
      t48 = 1.D0+0.321646831778707D2/t45
      t49 = dlog(t48)
      t54 = 1.D0+0.9841886522202837D-2*t22
      t55 = 1/t54
      t57 = 1.D0+0.1325688999052018D0*t34
      t63 = 0.598255043577108D1*t38+0.2225569421150687D1*t34
     #+0.8004286349993634D0*t41+0.1897004325747559D0*t43
      t66 = 1.D0+0.160818243221511D2/t63
      t67 = dlog(t66)
      t70 = rho*t36
      t73 = -0.62182D-1*rho*t57*t67+0.3109D-1*t70*t49
      zk(i) = -0.5317623117950561D0*t4-0.3810001254882096D-2*t7*t15
     #-0.108280969081455D-1*t32*t33*t36*t49+t55*t73
      t77 = 1/t3/t18
      t81 = t14**2
      t82 = 1/t81
      t86 = t18*rho
      t89 = sigma/t19/t86
      t92 = dsqrt(1.D0+0.1587401051968199D1*t22)
      t93 = 1/t92
      t102 = 1/t25/t24*t31
      t103 = t18**2
      t107 = t36*t49
      t117 = 1/t19/rho
      t122 = 1/t43
      t128 = t45**2
      t129 = 1/t128
      t131 = t38**2
      t132 = t131**2
      t135 = 1/t18
      t136 = 1/t132/t38*t135
      t138 = t122*t135
      t141 = 1/t41*t135
      t144 = 1/t34*t135
      t146 = -0.4160732915599108D1*t136-0.3229384477375903D1*t138
     #-0.2326004811900819D1*t141-0.5092110158254621D0*t144
      t147 = 1/t48
      t152 = t54**2
      t154 = 1/t152*t73
      t161 = t63**2
      vrhoa(i) = -0.7090164157267415D0*t3+0.5080001673176129D-2*t77
     #*sigma*t15+0.1905000627441048D-2*t7*t82*(-0.8466669455293548D-1
     #*t8*t77*t11-0.106673350692263D0*t89*t93)-0.3483542571021566D-2
     #*t102/t3/t103*t107*sigma-0.1353512113518188D-2*t26*sigma*t21*t36
     #*t49+0.7218731272097001D-2*t32*t117*t36*t49+0.579670098390266D-3
     #*t32*t21*t122*t49+0.1741411532348907D0*t32*t33*t36*t129*t146
     #*t147+0.2624503072587423D-1*t154*t89+t55*(-0.62182D-1*t57*t67
     #+rho*(0.2747799777968419D-2*t138*t67+0.1D1*t57/t161*(
     #-0.99709173929518D0*t136-0.7418564737168958D0*t138
     #-0.4002143174996817D0*t141-0.1264669550498372D0*t144)/t66)
     #+0.3109D-1*t107-0.1664368495390566D-2*t28*t122*t49-0.5D0*t70
     #*t129*t146*t147)
      vsigmaaa(i) = -0.1524000501952839D-1*t6*t15
     #+0.3810001254882096D-2*t7*t82*(0.6350002091470161D-1/t8*t6*t11
     #+0.8000501301919725D-1*t21*t93)+0.5225313856532348D-2*t102/t3
     #/t86*t36*t49+0.5414048454072751D-2*t26*t117*t107
     #-0.3936754608881135D-1*t154*t21
      vtaua(i) = -0.5414048454072751D-2*t26*t33*t107
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vtaua(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      tau = dmax1(0.D0,taua1(i))
      t3 = rho**(1.D0/3.D0)
      t4 = t3*rho
      t6 = 1/t4
      t7 = t6*sigma
      t8 = dsqrt(sigma)
      t9 = t8*t6
      t11 = dlog(0.1259921049894873D1*t9+dsqrt(1+0.1587401051968199D1
     #*t9**2))
      t14 = 1.D0+0.317500104573508D-1*t9*t11
      t15 = 1/t14
      t18 = rho**2
      t19 = t3**2
      t21 = 1/t19/t18
      t22 = sigma*t21
      t24 = 1.D0+0.6032123997479158D-1*t22
      t25 = t24**2
      t26 = 1/t25
      t28 = 1/rho
      t31 = 0.5D0*tau-0.125D0*sigma*t28
      t32 = t26*t31
      t33 = 1/t19
      t34 = t28**(1.D0/3.D0)
      t36 = 1.D0+0.1606016560364007D0*t34
      t38 = t28**(1.D0/6.D0)
      t41 = dsqrt(t28)
      t43 = t34**2
      t45 = 0.1248219874679732D2*t38+0.4844076716063854D1*t34
     #+0.2326004811900819D1*t41+0.3819082618690966D0*t43
      t48 = 1.D0+0.321646831778707D2/t45
      t49 = dlog(t48)
      t54 = 1.D0+0.9841886522202837D-2*t22
      t55 = 1/t54
      t57 = 1.D0+0.1325688999052018D0*t34
      t63 = 0.598255043577108D1*t38+0.2225569421150687D1*t34
     #+0.8004286349993634D0*t41+0.1897004325747559D0*t43
      t66 = 1.D0+0.160818243221511D2/t63
      t67 = dlog(t66)
      t70 = rho*t36
      t73 = -0.62182D-1*rho*t57*t67+0.3109D-1*t70*t49
      zk(i) = -0.5317623117950561D0*t4-0.3810001254882096D-2*t7*t15
     #-0.108280969081455D-1*t32*t33*t36*t49+t55*t73
      t77 = 1/t3/t18
      t78 = t77*sigma
      t81 = t14**2
      t82 = 1/t81
      t86 = t18*rho
      t88 = 1/t19/t86
      t89 = sigma*t88
      t91 = 1.D0+0.1587401051968199D1*t22
      t92 = dsqrt(t91)
      t93 = 1/t92
      t96 = -0.8466669455293548D-1*t8*t77*t11-0.106673350692263D0*t89
     #*t93
      t97 = t82*t96
      t101 = 1/t25/t24
      t102 = t101*t31
      t103 = t18**2
      t105 = 1/t3/t103
      t107 = t36*t49
      t108 = t107*sigma
      t111 = t26*sigma
      t113 = t21*t36*t49
      t117 = 1/t19/rho
      t122 = 1/t43
      t127 = t32*t33
      t128 = t45**2
      t129 = 1/t128
      t130 = t36*t129
      t131 = t38**2
      t132 = t131**2
      t133 = t132*t38
      t134 = 1/t133
      t135 = 1/t18
      t136 = t134*t135
      t138 = t122*t135
      t140 = 1/t41
      t141 = t140*t135
      t143 = 1/t34
      t144 = t143*t135
      t146 = -0.4160732915599108D1*t136-0.3229384477375903D1*t138
     #-0.2326004811900819D1*t141-0.5092110158254621D0*t144
      t147 = 1/t48
      t148 = t146*t147
      t149 = t130*t148
      t152 = t54**2
      t153 = 1/t152
      t154 = t153*t73
      t159 = t138*t67
      t161 = t63**2
      t162 = 1/t161
      t163 = t57*t162
      t168 = -0.99709173929518D0*t136-0.7418564737168958D0*t138
     #-0.4002143174996817D0*t141-0.1264669550498372D0*t144
      t169 = 1/t66
      t171 = t163*t168*t169
      t176 = t28*t122
      t179 = t129*t146
      t180 = t179*t147
      t183 = -0.62182D-1*t57*t67+rho*(0.2747799777968419D-2*t159+0.1D1
     #*t171)+0.3109D-1*t107-0.1664368495390566D-2*t176*t49-0.5D0*t70
     #*t180
      vrhoa(i) = -0.7090164157267415D0*t3+0.5080001673176129D-2*t78
     #*t15+0.1905000627441048D-2*t7*t97-0.3483542571021566D-2*t102
     #*t105*t108-0.1353512113518188D-2*t111*t113+0.7218731272097001D-2
     #*t32*t117*t36*t49+0.579670098390266D-3*t32*t21*t122*t49
     #+0.1741411532348907D0*t127*t149+0.2624503072587423D-1*t154*t89
     #+t55*t183
      t187 = 1/t8
      t193 = 0.6350002091470161D-1*t187*t6*t11+0.8000501301919725D-1
     #*t21*t93
      t194 = t82*t193
      t198 = 1/t3/t86
      t203 = t26*t117
      t204 = t203*t107
      vsigmaaa(i) = -0.1524000501952839D-1*t6*t15
     #+0.3810001254882096D-2*t7*t194+0.5225313856532348D-2*t102*t198
     #*t36*t49+0.5414048454072751D-2*t204-0.3936754608881135D-1*t154*t21
      t208 = t26*t33
      vtaua(i) = -0.5414048454072751D-2*t208*t107
      t216 = 1/t19/t103
      t217 = sigma*t216
      t220 = sigma**2
      t221 = t103*t86
      t224 = t220/t3/t221
      t226 = 1/t92/t91
      t234 = 1/t81/t14
      t235 = t96**2
      t245 = 1/t152/t54*t73
      t248 = t153*t183
      t251 = 0.5495599555936838D-2*t159
      t252 = 0.2D1*t171
      t254 = 1/t43/t28
      t255 = 1/t103
      t256 = t254*t255
      t258 = 0.1831866518645613D-2*t256*t67
      t259 = 1/t86
      t260 = t122*t259
      t262 = 0.5495599555936838D-2*t260*t67
      t266 = t168**2
      t269 = 0.2D1*t57/t161/t63*t266*t169
      t272 = 1/t133/t28*t255
      t274 = t134*t259
      t280 = 1/t41/t28*t255
      t282 = t140*t259
      t286 = 1/t34/t28*t255
      t288 = t143*t259
      t293 = 0.1D1*t163*(-0.8309097827459833D0*t272
     #+0.199418347859036D1*t274-0.4945709824779306D0*t256
     #+0.1483712947433792D1*t260-0.2001071587498409D0*t280
     #+0.8004286349993634D0*t282-0.4215565168327908D-1*t286
     #+0.2529339100996745D0*t288)*t169
      t294 = t161**2
      t297 = t66**2
      t301 = 0.160818243221511D2*t57/t294*t266/t297
      t305 = 0.8837926660346786D-1*t138*t162*t168*t169
      t316 = dlog(1.D0+0.2960857464321668D2/(0.8157414703487641D1*t38
     #+0.2247591863577616D1*t34+0.4300972471276643D0*t41
     #+0.1911512595127338D0*t43))
      t318 = (1.D0+0.6901399211255825D-1*t34)*t316*t135
      t332 = 1/t128/t45
      t333 = t146**2
      t351 = -0.6934554859331846D1*t272+0.1664293166239643D2*t274
     #-0.4305845969834537D1*t256+0.1291753790950361D2*t260
     #-0.2326004811900819D1*t280+0.9304019247603276D1*t282
     #-0.3394740105503081D0*t286+0.2036844063301848D1*t288
      t356 = t128**2
      t357 = 1/t356
      t359 = t48**2
      t360 = 1/t359
      s1 = -0.4726776104844943D0*t33+0.1905000627441048D-2*t7*t82*
     #(0.3951112412470322D0*t8*t198*t11+0.106673350692263D1*t217*t93
     #-0.4515557042823225D0*t224*t226)-0.3810001254882096D-2*t7*t234
     #*t235-0.1016000334635226D-1*t78*t97-0.192463558656411D0*t154
     #*t217+0.275520655120833D-2*t245*t224
      t377 = s1+0.1049801229034969D0*t248*t89+t55*(t251+t252+rho*(t258
     #-t262-t269+t293+t301-t305-0.3377399869956914D-1*t318))
     #-0.2370667447482193D-1*t198*sigma*t15+t55*(rho*(t258-t262-t269
     #+t293+t301-t305+0.3377399869956914D-1*t318)-0.2D1*t149+0.1D1*t70
     #*t332*t333*t147+0.1070677706909338D0*t176*t180
     #-0.2219157993854088D-2*t259*t254*t49-0.5D0*t70*t129*t351*t147
     #-0.1608234158893535D2*t70*t357*t333*t360+t252+t251)
     #+0.289835049195133D-3*t111*t216*t122*t49+0.8707057661744533D-1
     #*t111*t21*t149+0.9023414090121251D-2*t111*t88*t36*t49
      t379 = t103*t18
      t381 = 1/t3/t379
      t412 = t122*t49
      t416 = t105*t36
      t428 = 1/t3/t103/rho
      t435 = t25**2
      t437 = 1/t435*t31
      t438 = t103**2
      t444 = -0.1741771285510783D-2*t101*t220*t381*t36*t49
     #+0.1741411532348907D0*t127*t130*t351*t147-0.3482823064697813D0
     #*t127*t36*t332*t333*t147+0.7728934645203546D-3*t32*t216*t254*t49
     #-0.3728981012481608D-1*t32*t21*t122*t129*t148
     #-0.2406243757365667D-1*t32*t113+0.5601195022029291D1*t127*t36
     #*t357*t333*t360+0.745950274372486D-3*t102*t381*t412*sigma
     #+0.2240940862670676D0*t102*t416*t179*t147*sigma
     #-0.3864467322601773D-2*t32*t88*t122*t49+0.3483542571021566D-1
     #*t102*t428*t108-0.4643764086263751D0*t32*t117*t149
     #-0.3362105718223909D-2*t437/t438*t107*t220
      v2rhoa2(i) = t377+t444
      t449 = t6*t82
      t461 = sigma*t381
      t478 = t26*t21
      v2rhoasigmaaa(i) = 0.2032000669270451D-1*t77*t15
     #-0.5080001673176129D-2*t78*t194+0.7620002509764193D-2*t449*t96
     #-0.3810001254882096D-2*t7*t234*t96*t193+0.1905000627441048D-2*t7
     #*t82*(-0.169333389105871D0*t187*t77*t11-0.640040104153578D0*t88
     #*t93+0.3386667782117419D0*t461*t226)+0.2521579288667932D-2*t437
     #/t221*t108+0.2394935517577326D-2*t101*t428*t108
     #-0.1741771285510783D-1*t102*t416*t49-0.9023414090121251D-2*t478
     #*t107-0.2797313528896822D-3*t102*t428*t122*t49
     #-0.289835049195133D-3*t26*t88*t412-0.8403528235015034D-1*t102
     #*t198*t149-0.8707057661744533D-1*t203*t36*t180
     #-0.2066404913406247D-2*t245*t461+0.1049801229034969D0*t154*t88
     #-0.3936754608881135D-1*t248*t21
      t502 = t193**2
      t526 = t101*t105
      v2sigmaaa2(i) = 0.3048001003905677D-1*t449*t193
     #-0.7620002509764193D-2*t7*t234*t502+0.3810001254882096D-2*t7*t82
     #*(-0.1270000418294032D0/t8/sigma*t6*t11+0.1600100260383945D0
     #/sigma*t21*t93-0.2540000836588064D0*t428*t226)
     #-0.3782368933001897D-2*t437/t379*t36*t49-0.5225313856532348D-2
     #*t526*t107+0.3099607370109371D-2*t245*t428
      v2taua2(i) = 0.D0
      v2rhoataua(i) = -0.3483542571021566D-2*t526*t108
     #+0.7218731272097001D-2*t204+0.579670098390266D-3*t478*t412
     #+0.1741411532348907D0*t208*t36*t180
      v2sigmaaataua(i) = 0.2612656928266174D-2*t101*t198*t107
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      vtaua(i) = 0.0d0
      v2rhoataua(i) = 0.0d0
      v2taua2(i) = 0.0d0
      v2sigmaaataua(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end

c:XC_B1B95subrend
_ENDIF
_IF(ccpdft,all,xc_bb1k)
c:XC_BB1Ksubrstart

c    Generated: Tue Oct 19 15:23:13 BST 2004

      subroutine uks_xc_bb1k
     & (ideriv,npt,rhoa1,rhob1,sigmaaa1,sigmabb1,sigmaab1,
     &  taua1,taub1,
     &  zk,vrhoa,vrhob,vsigmaaa,vsigmabb,vsigmaab,
     &  vtaua,vtaub,
     &  v2rhoa2,v2rhob2,v2rhoab,
     &  v2rhoasigmaaa,v2rhoasigmaab,v2rhoasigmabb,
     &  v2rhobsigmabb,v2rhobsigmaab,v2rhobsigmaaa,
     &  v2sigmaaa2,v2sigmaaaab,v2sigmaaabb,
     &  v2sigmaab2,v2sigmaabbb,v2sigmabb2,
     &  v2rhoataua,v2rhoataub,v2rhobtaua,v2rhobtaub,
     &  v2sigmaaataua,v2sigmaaataub,
     &  v2sigmaabtaua,v2sigmaabtaub,
     &  v2sigmabbtaua,v2sigmabbtaub,
     &  v2taua2,v2taub2,v2tauab)
c
c     Y. Zhao, B.J. Lynch, D.G. Truhlar
c     Development and assessment of a new hybrid density functional
c     model for thermochemical kinetics
c     J. Phys. Chem. A 108 (2004) 2715-2719
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt),rhob1(npt)
      REAL sigmaaa1(npt),sigmabb1(npt),sigmaab1(npt)
      REAL taua1(npt),taub1(npt)
      REAL zk(npt),vrhoa(npt),vrhob(npt)
      REAL vsigmaaa(npt),vsigmabb(npt),vsigmaab(npt)
      REAL vtaua(npt),vtaub(npt)
      REAL v2rhoa2(npt),v2rhob2(npt),v2rhoab(npt)
      REAL v2rhoasigmaaa(npt),v2rhoasigmaab(npt)
      REAL v2rhoasigmabb(npt),v2rhobsigmabb(npt)
      REAL v2rhobsigmaab(npt),v2rhobsigmaaa(npt)
      REAL v2sigmaaa2(npt),v2sigmaaaab(npt),v2sigmaaabb(npt)
      REAL v2sigmaab2(npt),v2sigmaabbb(npt),v2sigmabb2(npt)
      REAL v2rhoataua(npt),v2rhoataub(npt)
      REAL v2rhobtaua(npt),v2rhobtaub(npt)
      REAL v2sigmaaataua(npt),v2sigmaaataub(npt)
      REAL v2sigmaabtaua(npt),v2sigmaabtaub(npt)
      REAL v2sigmabbtaua(npt),v2sigmabbtaub(npt)
      REAL v2taua2(npt),v2taub2(npt),v2tauab(npt)
      parameter(tol=1.0d-20)
      
      if (ideriv.eq.0) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      taub = dmax1(0.D0,taub1(i))
      tau = taub
      t3 = rhob**(1.D0/3.D0)
      t4 = t3*rhob
      t6 = 1/t4
      t8 = dsqrt(sigmabb)
      t9 = t8*t6
      t10 = dlog(t9+dsqrt(1+t9**2))
      t17 = rhob**2
      t18 = t3**2
      t24 = (1.D0+0.38D-1*sigmabb/t18/t17)**2
      t26 = 1/rhob
      t32 = t26**(1.D0/3.D0)
      t36 = t26**(1.D0/6.D0)
      t39 = dsqrt(t26)
      t41 = t32**2
      t47 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t36
     #+0.3844746237447211D1*t32+0.1644733775567609D1*t39
     #+0.2405871291288192D0*t41))
      zk(i) = -0.539704927082478D0*t4-0.2436D-2*t6*sigmabb/(1.D0
     #+0.252D-1*t9*t10)-0.3410636806218528D-2/t24*(taub-0.25D0*sigmabb
     #*t26)/t18*(1.D0+0.1274696188700087D0*t32)*t47
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      taua = dmax1(0.D0,taua1(i))
      tau = taua
      t3 = rhoa**(1.D0/3.D0)
      t4 = t3*rhoa
      t6 = 1/t4
      t8 = dsqrt(sigmaaa)
      t9 = t8*t6
      t10 = dlog(t9+dsqrt(1+t9**2))
      t17 = rhoa**2
      t18 = t3**2
      t24 = (1.D0+0.38D-1*sigmaaa/t18/t17)**2
      t26 = 1/rhoa
      t32 = t26**(1.D0/3.D0)
      t36 = t26**(1.D0/6.D0)
      t39 = dsqrt(t26)
      t41 = t32**2
      t47 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t36
     #+0.3844746237447211D1*t32+0.1644733775567609D1*t39
     #+0.2405871291288192D0*t41))
      zk(i) = -0.539704927082478D0*t4-0.2436D-2*t6*sigmaaa/(1.D0
     #+0.252D-1*t9*t10)-0.3410636806218528D-2/t24*(taua-0.25D0*sigmaaa
     #*t26)/t18*(1.D0+0.1274696188700087D0*t32)*t47
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      taua = dmax1(0.D0,taua1(i))
      taub = dmax1(0.D0,taub1(i))
      tau = taua+taub
      t6 = rhoa**(1.D0/3.D0)
      t7 = t6*rhoa
      t9 = 1/t7
      t11 = dsqrt(sigmaaa)
      t12 = t11*t9
      t13 = dlog(t12+dsqrt(1+t12**2))
      t20 = rhoa**2
      t21 = t6**2
      t24 = sigmaaa/t21/t20
      t27 = (1.D0+0.38D-1*t24)**2
      t29 = 1/rhoa
      t35 = t29**(1.D0/3.D0)
      t37 = 1.D0+0.1274696188700087D0*t35
      t39 = t29**(1.D0/6.D0)
      t42 = dsqrt(t29)
      t44 = t35**2
      t50 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t39
     #+0.3844746237447211D1*t35+0.1644733775567609D1*t42
     #+0.2405871291288192D0*t44))
      t54 = rhob**(1.D0/3.D0)
      t55 = t54*rhob
      t57 = 1/t55
      t59 = dsqrt(sigmabb)
      t60 = t59*t57
      t61 = dlog(t60+dsqrt(1+t60**2))
      t68 = rhob**2
      t69 = t54**2
      t72 = sigmabb/t69/t68
      t75 = (1.D0+0.38D-1*t72)**2
      t77 = 1/rhob
      t83 = t77**(1.D0/3.D0)
      t85 = 1.D0+0.1274696188700087D0*t83
      t87 = t77**(1.D0/6.D0)
      t90 = dsqrt(t77)
      t92 = t83**2
      t98 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t87
     #+0.3844746237447211D1*t83+0.1644733775567609D1*t90
     #+0.2405871291288192D0*t92))
      t106 = rhoa+rhob
      t107 = 1/t106
      t108 = t107**(1.D0/3.D0)
      t111 = t107**(1.D0/6.D0)
      t114 = dsqrt(t107)
      t116 = t108**2
      t122 = dlog(1.D0+0.160818243221511D2/(0.598255043577108D1*t111
     #+0.2225569421150687D1*t108+0.8004286349993634D0*t114
     #+0.1897004325747559D0*t116))
      t124 = 0.62182D-1*(1.D0+0.1325688999052018D0*t108)*t122
      t135 = dlog(1.D0+0.2960857464321668D2/(0.8157414703487641D1*t111
     #+0.2247591863577616D1*t108+0.4300972471276643D0*t114
     #+0.1911512595127338D0*t116))
      t138 = rhoa-1.D0*rhob
      t139 = t138*t107
      t140 = 1.D0+t139
      t141 = t140**(1.D0/3.D0)
      t144 = 1.D0-1.D0*t139
      t145 = t144**(1.D0/3.D0)
      t147 = t141*t140+t145*t144-2.D0
      t148 = t138**2
      t149 = t148**2
      t150 = t106**2
      t151 = t150**2
      t153 = t149/t151
      t169 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t111
     #+0.3844746237447211D1*t108+0.1644733775567609D1*t114
     #+0.2405871291288192D0*t116))
      zk(i) = -0.539704927082478D0*t7-0.2436D-2*t9*sigmaaa/(1.D0
     #+0.252D-1*t12*t13)-0.3410636806218528D-2/t27*(taua-0.25D0
     #*sigmaaa*t29)/t21*t37*t50-0.539704927082478D0*t55-0.2436D-2*t57
     #*sigmabb/(1.D0+0.252D-1*t60*t61)-0.3410636806218528D-2/t75*(taub
     #-0.25D0*sigmabb*t77)/t69*t85*t98+1/(1.D0+0.31D-2*t24+0.31D-2*t72
     #)*(t106*(-t124+0.3799574853701528D-1*(1.D0+0.6901399211255825D-1
     #*t108)*t135*t147*(1.D0-1.D0*t153)+0.1923661050931536D1*(
     #-0.3109D-1*(1.D0+0.1274696188700087D0*t108)*t169+t124)*t147*t153
     #)+0.3109D-1*rhoa*t37*t50+0.3109D-1*rhob*t85*t98)
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      taub = dmax1(0.D0,taub1(i))
      tau = taub
      t3 = rhob**(1.D0/3.D0)
      t4 = t3*rhob
      t6 = 1/t4
      t7 = t6*sigmabb
      t8 = dsqrt(sigmabb)
      t9 = t8*t6
      t10 = dlog(t9+dsqrt(1+t9**2))
      t13 = 1.D0+0.252D-1*t9*t10
      t14 = 1/t13
      t17 = rhob**2
      t18 = t3**2
      t20 = 1/t18/t17
      t21 = sigmabb*t20
      t23 = 1.D0+0.38D-1*t21
      t24 = t23**2
      t25 = 1/t24
      t26 = 1/rhob
      t29 = taub-0.25D0*sigmabb*t26
      t30 = t25*t29
      t31 = 1/t18
      t32 = t26**(1.D0/3.D0)
      t34 = 1.D0+0.1274696188700087D0*t32
      t36 = t26**(1.D0/6.D0)
      t39 = dsqrt(t26)
      t41 = t32**2
      t43 = 0.1112037486309468D2*t36+0.3844746237447211D1*t32
     #+0.1644733775567609D1*t39+0.2405871291288192D0*t41
      t46 = 1.D0+0.321646831778707D2/t43
      t47 = dlog(t46)
      zk(i) = -0.539704927082478D0*t4-0.2436D-2*t7*t14
     #-0.3410636806218528D-2*t30*t31*t34*t47
      vrhoa(i) = 0.D0
      t53 = 1/t3/t17
      t57 = t13**2
      t58 = 1/t57
      t62 = t17*rhob
      t67 = dsqrt(1.D0+t21)
      t68 = 1/t67
      t77 = 1/t24/t23*t29
      t78 = t17**2
      t82 = t34*t47
      t92 = 1/t18/rhob
      t97 = 1/t41
      t103 = t43**2
      t106 = t36**2
      t107 = t106**2
      t110 = 1/t17
      vrhob(i) = -0.719606569443304D0*t3+0.3248D-2*t53*sigmabb*t14
     #+0.2436D-2*t7*t58*(-0.336D-1*t8*t53*t10-0.336D-1*sigmabb/t18/t62
     #*t68)-0.6912223927269549D-3*t77/t3/t78*t82*sigmabb
     #-0.8526592015546319D-3*t25*sigmabb*t20*t34*t47
     #+0.2273757870812352D-2*t30*t92*t34*t47+0.1449175245975665D-3*t30
     #*t20*t97*t47+0.1097020523068037D0*t30*t31*t34/t103*(
     #-0.1853395810515781D1/t107/t36*t110-0.128158207914907D1*t97*t110
     #-0.8223668877838045D0/t39*t110-0.1603914194192128D0/t32*t110)/t46
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      vsigmabb(i) = -0.2436D-2*t6*t14+0.2436D-2*t7*t58*(0.126D-1/t8*t6
     #*t10+0.126D-1*t20*t68)+0.2592083972726081D-3*t77/t3/t62*t34*t47
     #+0.8526592015546319D-3*t25*t92*t82
      vtaub(i) = -0.3410636806218528D-2*t25*t31*t82
      vtaua(i) = 0.0d0
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      taua = dmax1(0.D0,taua1(i))
      tau = taua
      t3 = rhoa**(1.D0/3.D0)
      t4 = t3*rhoa
      t6 = 1/t4
      t7 = t6*sigmaaa
      t8 = dsqrt(sigmaaa)
      t9 = t8*t6
      t10 = dlog(t9+dsqrt(1+t9**2))
      t13 = 1.D0+0.252D-1*t9*t10
      t14 = 1/t13
      t17 = rhoa**2
      t18 = t3**2
      t20 = 1/t18/t17
      t21 = sigmaaa*t20
      t23 = 1.D0+0.38D-1*t21
      t24 = t23**2
      t25 = 1/t24
      t26 = 1/rhoa
      t29 = taua-0.25D0*sigmaaa*t26
      t30 = t25*t29
      t31 = 1/t18
      t32 = t26**(1.D0/3.D0)
      t34 = 1.D0+0.1274696188700087D0*t32
      t36 = t26**(1.D0/6.D0)
      t39 = dsqrt(t26)
      t41 = t32**2
      t43 = 0.1112037486309468D2*t36+0.3844746237447211D1*t32
     #+0.1644733775567609D1*t39+0.2405871291288192D0*t41
      t46 = 1.D0+0.321646831778707D2/t43
      t47 = dlog(t46)
      zk(i) = -0.539704927082478D0*t4-0.2436D-2*t7*t14
     #-0.3410636806218528D-2*t30*t31*t34*t47
      t53 = 1/t3/t17
      t57 = t13**2
      t58 = 1/t57
      t62 = t17*rhoa
      t67 = dsqrt(1.D0+t21)
      t68 = 1/t67
      t77 = 1/t24/t23*t29
      t78 = t17**2
      t82 = t34*t47
      t92 = 1/t18/rhoa
      t97 = 1/t41
      t103 = t43**2
      t106 = t36**2
      t107 = t106**2
      t110 = 1/t17
      vrhoa(i) = -0.719606569443304D0*t3+0.3248D-2*t53*sigmaaa*t14
     #+0.2436D-2*t7*t58*(-0.336D-1*t8*t53*t10-0.336D-1*sigmaaa/t18/t62
     #*t68)-0.6912223927269549D-3*t77/t3/t78*t82*sigmaaa
     #-0.8526592015546319D-3*t25*sigmaaa*t20*t34*t47
     #+0.2273757870812352D-2*t30*t92*t34*t47+0.1449175245975665D-3*t30
     #*t20*t97*t47+0.1097020523068037D0*t30*t31*t34/t103*(
     #-0.1853395810515781D1/t107/t36*t110-0.128158207914907D1*t97*t110
     #-0.8223668877838045D0/t39*t110-0.1603914194192128D0/t32*t110)/t46
      vrhob(i) = 0.D0
      vsigmaaa(i) = -0.2436D-2*t6*t14+0.2436D-2*t7*t58*(0.126D-1/t8*t6
     #*t10+0.126D-1*t20*t68)+0.2592083972726081D-3*t77/t3/t62*t34*t47
     #+0.8526592015546319D-3*t25*t92*t82
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      vtaua(i) = -0.3410636806218528D-2*t25*t31*t82
      vtaub(i) = 0.0d0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      taua = dmax1(0.D0,taua1(i))
      taub = dmax1(0.D0,taub1(i))
      tau = taua+taub
      t6 = rhoa**(1.D0/3.D0)
      t7 = t6*rhoa
      t9 = 1/t7
      t10 = t9*sigmaaa
      t11 = dsqrt(sigmaaa)
      t12 = t11*t9
      t13 = dlog(t12+dsqrt(1+t12**2))
      t16 = 1.D0+0.252D-1*t12*t13
      t17 = 1/t16
      t20 = rhoa**2
      t21 = t6**2
      t23 = 1/t21/t20
      t24 = sigmaaa*t23
      t26 = 1.D0+0.38D-1*t24
      t27 = t26**2
      t28 = 1/t27
      t29 = 1/rhoa
      t32 = taua-0.25D0*sigmaaa*t29
      t33 = t28*t32
      t34 = 1/t21
      t35 = t29**(1.D0/3.D0)
      t37 = 1.D0+0.1274696188700087D0*t35
      t39 = t29**(1.D0/6.D0)
      t42 = dsqrt(t29)
      t44 = t35**2
      t46 = 0.1112037486309468D2*t39+0.3844746237447211D1*t35
     #+0.1644733775567609D1*t42+0.2405871291288192D0*t44
      t49 = 1.D0+0.321646831778707D2/t46
      t50 = dlog(t49)
      t54 = rhob**(1.D0/3.D0)
      t55 = t54*rhob
      t57 = 1/t55
      t58 = t57*sigmabb
      t59 = dsqrt(sigmabb)
      t60 = t59*t57
      t61 = dlog(t60+dsqrt(1+t60**2))
      t64 = 1.D0+0.252D-1*t60*t61
      t65 = 1/t64
      t68 = rhob**2
      t69 = t54**2
      t71 = 1/t69/t68
      t72 = sigmabb*t71
      t74 = 1.D0+0.38D-1*t72
      t75 = t74**2
      t76 = 1/t75
      t77 = 1/rhob
      t80 = taub-0.25D0*sigmabb*t77
      t81 = t76*t80
      t82 = 1/t69
      t83 = t77**(1.D0/3.D0)
      t85 = 1.D0+0.1274696188700087D0*t83
      t87 = t77**(1.D0/6.D0)
      t90 = dsqrt(t77)
      t92 = t83**2
      t94 = 0.1112037486309468D2*t87+0.3844746237447211D1*t83
     #+0.1644733775567609D1*t90+0.2405871291288192D0*t92
      t97 = 1.D0+0.321646831778707D2/t94
      t98 = dlog(t97)
      t104 = 1.D0+0.31D-2*t24+0.31D-2*t72
      t105 = 1/t104
      t106 = rhoa+rhob
      t107 = 1/t106
      t108 = t107**(1.D0/3.D0)
      t110 = 1.D0+0.1325688999052018D0*t108
      t111 = t107**(1.D0/6.D0)
      t114 = dsqrt(t107)
      t116 = t108**2
      t118 = 0.598255043577108D1*t111+0.2225569421150687D1*t108
     #+0.8004286349993634D0*t114+0.1897004325747559D0*t116
      t121 = 1.D0+0.160818243221511D2/t118
      t122 = dlog(t121)
      t124 = 0.62182D-1*t110*t122
      t126 = 1.D0+0.6901399211255825D-1*t108
      t131 = 0.8157414703487641D1*t111+0.2247591863577616D1*t108
     #+0.4300972471276643D0*t114+0.1911512595127338D0*t116
      t134 = 1.D0+0.2960857464321668D2/t131
      t135 = dlog(t134)
      t136 = t126*t135
      t138 = rhoa-1.D0*rhob
      t139 = t138*t107
      t140 = 1.D0+t139
      t141 = t140**(1.D0/3.D0)
      t144 = 1.D0-1.D0*t139
      t145 = t144**(1.D0/3.D0)
      t147 = t141*t140+t145*t144-2.D0
      t148 = t138**2
      t149 = t148**2
      t150 = t106**2
      t151 = t150**2
      t152 = 1/t151
      t153 = t149*t152
      t155 = 1.D0-1.D0*t153
      t158 = 0.3799574853701528D-1*t136*t147*t155
      t160 = 1.D0+0.1274696188700087D0*t108
      t165 = 0.1112037486309468D2*t111+0.3844746237447211D1*t108
     #+0.1644733775567609D1*t114+0.2405871291288192D0*t116
      t168 = 1.D0+0.321646831778707D2/t165
      t169 = dlog(t168)
      t172 = -0.3109D-1*t160*t169+t124
      t173 = t172*t147
      t175 = 0.1923661050931536D1*t173*t153
      t178 = rhoa*t37
      t181 = rhob*t85
      t184 = t106*(-t124+t158+t175)+0.3109D-1*t178*t50+0.3109D-1*t181
     #*t98
      zk(i) = -0.539704927082478D0*t7-0.2436D-2*t10*t17
     #-0.3410636806218528D-2*t33*t34*t37*t50-0.539704927082478D0*t55
     #-0.2436D-2*t58*t65-0.3410636806218528D-2*t81*t82*t85*t98+t105*t184
      t188 = 1/t6/t20
      t192 = t16**2
      t193 = 1/t192
      t197 = t20*rhoa
      t200 = sigmaaa/t21/t197
      t202 = dsqrt(1.D0+t24)
      t203 = 1/t202
      t212 = 1/t27/t26*t32
      t213 = t20**2
      t217 = t37*t50
      t227 = 1/t21/rhoa
      t232 = 1/t44
      t238 = t46**2
      t239 = 1/t238
      t241 = t39**2
      t242 = t241**2
      t245 = 1/t20
      t256 = -0.1853395810515781D1/t242/t39*t245-0.128158207914907D1
     #*t232*t245-0.8223668877838045D0/t42*t245-0.1603914194192128D0
     #/t35*t245
      t257 = 1/t49
      t262 = t104**2
      t264 = 1/t262*t184
      t268 = 1/t150
      t269 = 1/t116*t268
      t270 = t269*t122
      t271 = 0.2747799777968419D-2*t270
      t272 = t118**2
      t275 = t111**2
      t276 = t275**2
      t279 = 1/t276/t111*t268
      t283 = 1/t114*t268
      t286 = 1/t108*t268
      t291 = t110/t272*(-0.99709173929518D0*t279-0.7418564737168958D0
     #*t269-0.4002143174996817D0*t283-0.1264669550498372D0*t286)/t121
      t292 = 0.1D1*t291
      t296 = 0.8740794299481065D-3*t269*t135*t147*t155
      t297 = t131**2
      t310 = 0.1124999956683108D1*t126/t297*(-0.135956911724794D1*t279
     #-0.7491972878592054D0*t269-0.2150486235638321D0*t283
     #-0.1274341730084892D0*t286)/t134*t147*t155
      t311 = t138*t268
      t312 = 1.D0*t311
      t316 = 1.D0*t107
      t320 = 0.1333333333333333D1*t141*(t107-t312)
     #+0.1333333333333333D1*t145*(-t316+t311)
      t325 = t148*t138*t152
      t326 = 4.D0*t325
      t329 = t149/t151/t106
      t330 = 4.D0*t329
      t337 = t165**2
      t354 = 0.1923661050931536D1*(0.1321010150222857D-2*t269*t169
     #+0.1D1*t160/t337*(-0.1853395810515781D1*t279-0.128158207914907D1
     #*t269-0.8223668877838045D0*t283-0.1603914194192128D0*t286)/t168
     #-0.2747799777968419D-2*t270-0.1D1*t291)*t147*t153
      t358 = t173*t325
      t361 = 0.7694644203726145D1*t173*t329
      vrhoa(i) = -0.719606569443304D0*t6+0.3248D-2*t188*sigmaaa*t17
     #+0.2436D-2*t10*t193*(-0.336D-1*t11*t188*t13-0.336D-1*t200*t203)
     #-0.6912223927269549D-3*t212/t6/t213*t217*sigmaaa
     #-0.8526592015546319D-3*t28*sigmaaa*t23*t37*t50
     #+0.2273757870812352D-2*t33*t227*t37*t50+0.1449175245975665D-3
     #*t33*t23*t232*t50+0.1097020523068037D0*t33*t34*t37*t239*t256
     #*t257+0.8266666666666667D-2*t264*t200+t105*(-t124+t158+t175+t106
     #*(t271+t292-t296-t310+0.3799574853701528D-1*t136*t320*t155
     #+0.3799574853701528D-1*t136*t147*(-t326+t330)+t354
     #+0.1923661050931536D1*t172*t320*t153+0.7694644203726145D1*t358
     #-t361)+0.3109D-1*t217-0.1321010150222857D-2*t29*t232*t50-0.1D1
     #*t178*t239*t256*t257)
      t376 = 1/t54/t68
      t380 = t64**2
      t381 = 1/t380
      t385 = t68*rhob
      t388 = sigmabb/t69/t385
      t390 = dsqrt(1.D0+t72)
      t391 = 1/t390
      t400 = 1/t75/t74*t80
      t401 = t68**2
      t405 = t85*t98
      t415 = 1/t69/rhob
      t420 = 1/t92
      t426 = t94**2
      t427 = 1/t426
      t429 = t87**2
      t430 = t429**2
      t433 = 1/t68
      t444 = -0.1853395810515781D1/t430/t87*t433-0.128158207914907D1
     #*t420*t433-0.8223668877838045D0/t90*t433-0.1603914194192128D0
     #/t83*t433
      t445 = 1/t97
      t458 = 0.1333333333333333D1*t141*(-t316-t312)
     #+0.1333333333333333D1*t145*(t107+t311)
      vrhob(i) = -0.719606569443304D0*t54+0.3248D-2*t376*sigmabb*t65
     #+0.2436D-2*t58*t381*(-0.336D-1*t59*t376*t61-0.336D-1*t388*t391)
     #-0.6912223927269549D-3*t400/t54/t401*t405*sigmabb
     #-0.8526592015546319D-3*t76*sigmabb*t71*t85*t98
     #+0.2273757870812352D-2*t81*t415*t85*t98+0.1449175245975665D-3
     #*t81*t71*t420*t98+0.1097020523068037D0*t81*t82*t85*t427*t444
     #*t445+0.8266666666666667D-2*t264*t388+t105*(-t124+t158+t175+t106
     #*(t271+t292-t296-t310+0.3799574853701528D-1*t136*t458*t155
     #+0.3799574853701528D-1*t136*t147*(t326+t330)+t354
     #+0.1923661050931536D1*t172*t458*t153-0.7694644203726145D1*t358
     #-t361)+0.3109D-1*t405-0.1321010150222857D-2*t77*t420*t98-0.1D1
     #*t181*t427*t444*t445)
      vsigmaaa(i) = -0.2436D-2*t9*t17+0.2436D-2*t10*t193*(0.126D-1/t11
     #*t9*t13+0.126D-1*t23*t203)+0.2592083972726081D-3*t212/t6/t197
     #*t37*t50+0.8526592015546319D-3*t28*t227*t217-0.31D-2*t264*t23
      vsigmaab(i) = 0.D0
      vsigmabb(i) = -0.2436D-2*t57*t65+0.2436D-2*t58*t381*(0.126D-1
     #/t59*t57*t61+0.126D-1*t71*t391)+0.2592083972726081D-3*t400/t54
     #/t385*t85*t98+0.8526592015546319D-3*t76*t415*t405-0.31D-2*t264*t71
      vtaua(i) = -0.3410636806218528D-2*t28*t34*t217
      vtaub(i) = -0.3410636806218528D-2*t76*t82*t405
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      vtaua(i) = 0.0d0
      vtaub(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      taub = dmax1(0.D0,taub1(i))
      tau = taub
      t3 = rhob**(1.D0/3.D0)
      t4 = t3*rhob
      t6 = 1/t4
      t7 = t6*sigmabb
      t8 = dsqrt(sigmabb)
      t9 = t8*t6
      t10 = dlog(t9+dsqrt(1+t9**2))
      t13 = 1.D0+0.252D-1*t9*t10
      t14 = 1/t13
      t17 = rhob**2
      t18 = t3**2
      t20 = 1/t18/t17
      t21 = sigmabb*t20
      t23 = 1.D0+0.38D-1*t21
      t24 = t23**2
      t25 = 1/t24
      t26 = 1/rhob
      t29 = taub-0.25D0*sigmabb*t26
      t30 = t25*t29
      t31 = 1/t18
      t32 = t26**(1.D0/3.D0)
      t34 = 1.D0+0.1274696188700087D0*t32
      t36 = t26**(1.D0/6.D0)
      t39 = dsqrt(t26)
      t41 = t32**2
      t43 = 0.1112037486309468D2*t36+0.3844746237447211D1*t32
     #+0.1644733775567609D1*t39+0.2405871291288192D0*t41
      t46 = 1.D0+0.321646831778707D2/t43
      t47 = dlog(t46)
      zk(i) = -0.539704927082478D0*t4-0.2436D-2*t7*t14
     #-0.3410636806218528D-2*t30*t31*t34*t47
      vrhoa(i) = 0.D0
      t53 = 1/t3/t17
      t54 = t53*sigmabb
      t57 = t13**2
      t58 = 1/t57
      t62 = t17*rhob
      t64 = 1/t18/t62
      t66 = 1.D0+t21
      t67 = dsqrt(t66)
      t68 = 1/t67
      t71 = -0.336D-1*t8*t53*t10-0.336D-1*sigmabb*t64*t68
      t72 = t58*t71
      t76 = 1/t24/t23
      t77 = t76*t29
      t78 = t17**2
      t80 = 1/t3/t78
      t82 = t34*t47
      t83 = t82*sigmabb
      t86 = t25*sigmabb
      t88 = t20*t34*t47
      t92 = 1/t18/rhob
      t97 = 1/t41
      t102 = t30*t31
      t103 = t43**2
      t104 = 1/t103
      t105 = t34*t104
      t106 = t36**2
      t107 = t106**2
      t108 = t107*t36
      t109 = 1/t108
      t110 = 1/t17
      t115 = 1/t39
      t118 = 1/t32
      t121 = -0.1853395810515781D1*t109*t110-0.128158207914907D1*t97
     #*t110-0.8223668877838045D0*t115*t110-0.1603914194192128D0*t118
     #*t110
      t122 = 1/t46
      t123 = t121*t122
      t124 = t105*t123
      vrhob(i) = -0.719606569443304D0*t3+0.3248D-2*t54*t14+0.2436D-2
     #*t7*t72-0.6912223927269549D-3*t77*t80*t83-0.8526592015546319D-3
     #*t86*t88+0.2273757870812352D-2*t30*t92*t34*t47
     #+0.1449175245975665D-3*t30*t20*t97*t47+0.1097020523068037D0*t102
     #*t124
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      t135 = 0.126D-1/t8*t6*t10+0.126D-1*t20*t68
      t140 = 1/t3/t62
      t146 = t25*t92*t82
      vsigmabb(i) = -0.2436D-2*t6*t14+0.2436D-2*t7*t58*t135
     #+0.2592083972726081D-3*t77*t140*t34*t47+0.8526592015546319D-3*t146
      t148 = t25*t31
      vtaub(i) = -0.3410636806218528D-2*t148*t82
      vtaua(i) = 0.0d0
      v2rhoa2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t152 = 1/t57/t13
      t153 = t71**2
      t161 = 1/t18/t78
      t165 = sigmabb**2
      t171 = 1/t67/t66
      t185 = t78*t17
      t187 = 1/t3/t185
      t192 = t24**2
      t194 = 1/t192*t29
      t195 = t78**2
      t209 = 1/t3/t78/rhob
      t215 = t97*t47
      t221 = t104*t121
      t243 = t121**2
      t249 = 1/t41/t26
      t261 = 1/t78
      t264 = 1/t62
      t288 = t103**2
      t291 = t46**2
      t297 = 0.5873990330354695D-4*t77*t187*t215*sigmabb
     #+0.4446589853502444D-1*t77*t80*t34*t221*t122*sigmabb
     #+0.284219733851544D-2*t86*t64*t34*t47-0.4830584153252216D-3*t30
     #*t64*t97*t47-0.1462694030757383D0*t30*t92*t124
     #+0.5485102615340186D-1*t86*t20*t124-0.2194041046136074D0*t102
     #*t34/t103/t43*t243*t122+0.9661168306504433D-4*t30*t161*t249*t47
     #-0.932245253120402D-2*t30*t20*t97*t104*t123+0.1097020523068037D0
     #*t102*t105*(-0.1544496508763151D1/t108/t26*t261
     #+0.3706791621031562D1*t109*t264-0.854388052766047D0*t249*t261
     #+0.2563164158298141D1*t97*t264-0.4111834438919023D0/t39/t26*t261
     #+0.1644733775567609D1*t115*t264-0.5346380647307093D-1/t32/t26
     #*t261+0.3207828388384256D0*t118*t264)*t122+0.3528531756410541D1
     #*t102*t34/t288*t243/t291
      v2rhob2(i) = -0.4872D-2*t7*t152*t153+0.2436D-2*t7*t58*(0.784D-1
     #*t8*t140*t10+0.168D0*sigmabb*t161*t68-0.448D-1*t165/t3/t78/t62
     #*t171)-0.2398688564811013D0*t31-0.7578666666666667D-2*t140
     #*sigmabb*t14-0.6496D-2*t54*t72-0.3456111963634775D-3*t76*t165
     #*t187*t34*t47-0.2101316073889943D-3*t194/t195*t82*t165
     #+0.7245876229878325D-4*t86*t161*t97*t47-0.378959645135392D-2*t30
     #*t88+0.3456111963634775D-2*t77*t209*t83+t297
      v2sigmaaa2(i) = 0.D0
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      t301 = t135**2
      t325 = t76*t80
      v2sigmabb2(i) = 0.4872D-2*t6*t58*t135-0.4872D-2*t7*t152*t301
     #+0.2436D-2*t7*t58*(-0.63D-2/t8/sigmabb*t6*t10+0.63D-2/sigmabb
     #*t20*t68-0.63D-2*t209*t171)-0.2954975728907732D-4*t194/t185*t34
     #*t47-0.129604198636304D-3*t325*t82
      v2taua2(i) = 0.D0
      v2taub2(i) = 0.D0
      v2tauab(i) = 0.D0
      v2rhoataua(i) = 0.D0
      v2rhoataub(i) = 0.D0
      v2rhobtaua(i) = 0.D0
      v2rhobtaub(i) = -0.6912223927269549D-3*t325*t83
     #+0.2273757870812352D-2*t146+0.1449175245975665D-3*t25*t20*t215
     #+0.1097020523068037D0*t148*t34*t221*t122
      v2sigmaaataua(i) = 0.D0
      v2sigmaaataub(i) = 0.D0
      v2sigmaabtaua(i) = 0.D0
      v2sigmaabtaub(i) = 0.D0
      v2sigmabbtaua(i) = 0.D0
      v2sigmabbtaub(i) = 0.2592083972726081D-3*t76*t140*t82
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      taua = dmax1(0.D0,taua1(i))
      tau = taua
      t3 = rhoa**(1.D0/3.D0)
      t4 = t3*rhoa
      t6 = 1/t4
      t7 = t6*sigmaaa
      t8 = dsqrt(sigmaaa)
      t9 = t8*t6
      t10 = dlog(t9+dsqrt(1+t9**2))
      t13 = 1.D0+0.252D-1*t9*t10
      t14 = 1/t13
      t17 = rhoa**2
      t18 = t3**2
      t20 = 1/t18/t17
      t21 = sigmaaa*t20
      t23 = 1.D0+0.38D-1*t21
      t24 = t23**2
      t25 = 1/t24
      t26 = 1/rhoa
      t29 = taua-0.25D0*sigmaaa*t26
      t30 = t25*t29
      t31 = 1/t18
      t32 = t26**(1.D0/3.D0)
      t34 = 1.D0+0.1274696188700087D0*t32
      t36 = t26**(1.D0/6.D0)
      t39 = dsqrt(t26)
      t41 = t32**2
      t43 = 0.1112037486309468D2*t36+0.3844746237447211D1*t32
     #+0.1644733775567609D1*t39+0.2405871291288192D0*t41
      t46 = 1.D0+0.321646831778707D2/t43
      t47 = dlog(t46)
      zk(i) = -0.539704927082478D0*t4-0.2436D-2*t7*t14
     #-0.3410636806218528D-2*t30*t31*t34*t47
      t53 = 1/t3/t17
      t54 = t53*sigmaaa
      t57 = t13**2
      t58 = 1/t57
      t62 = t17*rhoa
      t64 = 1/t18/t62
      t66 = 1.D0+t21
      t67 = dsqrt(t66)
      t68 = 1/t67
      t71 = -0.336D-1*t8*t53*t10-0.336D-1*sigmaaa*t64*t68
      t72 = t58*t71
      t76 = 1/t24/t23
      t77 = t76*t29
      t78 = t17**2
      t80 = 1/t3/t78
      t82 = t34*t47
      t83 = t82*sigmaaa
      t86 = t25*sigmaaa
      t88 = t20*t34*t47
      t92 = 1/t18/rhoa
      t97 = 1/t41
      t102 = t30*t31
      t103 = t43**2
      t104 = 1/t103
      t105 = t34*t104
      t106 = t36**2
      t107 = t106**2
      t108 = t107*t36
      t109 = 1/t108
      t110 = 1/t17
      t115 = 1/t39
      t118 = 1/t32
      t121 = -0.1853395810515781D1*t109*t110-0.128158207914907D1*t97
     #*t110-0.8223668877838045D0*t115*t110-0.1603914194192128D0*t118
     #*t110
      t122 = 1/t46
      t123 = t121*t122
      t124 = t105*t123
      vrhoa(i) = -0.719606569443304D0*t3+0.3248D-2*t54*t14+0.2436D-2
     #*t7*t72-0.6912223927269549D-3*t77*t80*t83-0.8526592015546319D-3
     #*t86*t88+0.2273757870812352D-2*t30*t92*t34*t47
     #+0.1449175245975665D-3*t30*t20*t97*t47+0.1097020523068037D0*t102
     #*t124
      vrhob(i) = 0.D0
      t135 = 0.126D-1/t8*t6*t10+0.126D-1*t20*t68
      t140 = 1/t3/t62
      t146 = t25*t92*t82
      vsigmaaa(i) = -0.2436D-2*t6*t14+0.2436D-2*t7*t58*t135
     #+0.2592083972726081D-3*t77*t140*t34*t47+0.8526592015546319D-3*t146
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      t148 = t25*t31
      vtaua(i) = -0.3410636806218528D-2*t148*t82
      vtaub(i) = 0.0d0
      t151 = t103**2
      t154 = t121**2
      t155 = t46**2
      t168 = 1/t57/t13
      t169 = t71**2
      t177 = 1/t18/t78
      t181 = sigmaaa**2
      t187 = 1/t67/t66
      t196 = 1/t3/t78/rhoa
      t206 = t104*t121
      t211 = t78*t17
      t213 = 1/t3/t211
      t215 = t97*t47
      t225 = t24**2
      t227 = 1/t225*t29
      t228 = t78**2
      t251 = 1/t41/t26
      t270 = 1/t78
      t273 = 1/t62
      t297 = -0.3456111963634775D-3*t76*t181*t213*t34*t47
     #-0.2101316073889943D-3*t227/t228*t82*t181-0.378959645135392D-2
     #*t30*t88+0.7245876229878325D-4*t86*t177*t97*t47
     #+0.5485102615340186D-1*t86*t20*t124-0.1462694030757383D0*t30*t92
     #*t124-0.4830584153252216D-3*t30*t64*t97*t47
     #+0.9661168306504433D-4*t30*t177*t251*t47-0.932245253120402D-2
     #*t30*t20*t97*t104*t123-0.2194041046136074D0*t102*t34/t103/t43
     #*t154*t122+0.1097020523068037D0*t102*t105*(-0.1544496508763151D1
     #/t108/t26*t270+0.3706791621031562D1*t109*t273
     #-0.854388052766047D0*t251*t270+0.2563164158298141D1*t97*t273
     #-0.4111834438919023D0/t39/t26*t270+0.1644733775567609D1*t115
     #*t273-0.5346380647307093D-1/t32/t26*t270+0.3207828388384256D0
     #*t118*t273)*t122
      v2rhoa2(i) = 0.3528531756410541D1*t102*t34/t151*t154/t155
     #-0.7578666666666667D-2*t140*sigmaaa*t14-0.2398688564811013D0*t31
     #-0.6496D-2*t54*t72-0.4872D-2*t7*t168*t169+0.2436D-2*t7*t58*
     #(0.784D-1*t8*t140*t10+0.168D0*sigmaaa*t177*t68-0.448D-1*t181/t3
     #/t78/t62*t187)+0.3456111963634775D-2*t77*t196*t83
     #+0.284219733851544D-2*t86*t64*t34*t47+0.4446589853502444D-1*t77
     #*t80*t34*t206*t122*sigmaaa+0.5873990330354695D-4*t77*t213*t215
     #*sigmaaa+t297
      v2rhob2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t301 = t135**2
      t325 = t76*t80
      v2sigmaaa2(i) = 0.4872D-2*t6*t58*t135-0.4872D-2*t7*t168*t301
     #+0.2436D-2*t7*t58*(-0.63D-2/t8/sigmaaa*t6*t10+0.63D-2/sigmaaa
     #*t20*t68-0.63D-2*t196*t187)-0.2954975728907732D-4*t227/t211*t34
     #*t47-0.129604198636304D-3*t325*t82
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      v2sigmabb2(i) = 0.D0
      v2taua2(i) = 0.D0
      v2taub2(i) = 0.D0
      v2tauab(i) = 0.D0
      v2rhoataua(i) = -0.6912223927269549D-3*t325*t83
     #+0.2273757870812352D-2*t146+0.1449175245975665D-3*t25*t20*t215
     #+0.1097020523068037D0*t148*t34*t206*t122
      v2rhoataub(i) = 0.D0
      v2rhobtaua(i) = 0.D0
      v2rhobtaub(i) = 0.D0
      v2sigmaaataua(i) = 0.2592083972726081D-3*t76*t140*t82
      v2sigmaaataub(i) = 0.D0
      v2sigmaabtaua(i) = 0.D0
      v2sigmaabtaub(i) = 0.D0
      v2sigmabbtaua(i) = 0.D0
      v2sigmabbtaub(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      taua = dmax1(0.D0,taua1(i))
      taub = dmax1(0.D0,taub1(i))
      tau = taua+taub
      t6 = rhoa**(1.D0/3.D0)
      t7 = t6*rhoa
      t9 = 1/t7
      t10 = t9*sigmaaa
      t11 = dsqrt(sigmaaa)
      t12 = t11*t9
      t13 = dlog(t12+dsqrt(1+t12**2))
      t16 = 1.D0+0.252D-1*t12*t13
      t17 = 1/t16
      t20 = rhoa**2
      t21 = t6**2
      t23 = 1/t21/t20
      t24 = sigmaaa*t23
      t26 = 1.D0+0.38D-1*t24
      t27 = t26**2
      t28 = 1/t27
      t29 = 1/rhoa
      t32 = taua-0.25D0*sigmaaa*t29
      t33 = t28*t32
      t34 = 1/t21
      t35 = t29**(1.D0/3.D0)
      t37 = 1.D0+0.1274696188700087D0*t35
      t39 = t29**(1.D0/6.D0)
      t42 = dsqrt(t29)
      t44 = t35**2
      t46 = 0.1112037486309468D2*t39+0.3844746237447211D1*t35
     #+0.1644733775567609D1*t42+0.2405871291288192D0*t44
      t49 = 1.D0+0.321646831778707D2/t46
      t50 = dlog(t49)
      t54 = rhob**(1.D0/3.D0)
      t55 = t54*rhob
      t57 = 1/t55
      t58 = t57*sigmabb
      t59 = dsqrt(sigmabb)
      t60 = t59*t57
      t61 = dlog(t60+dsqrt(1+t60**2))
      t64 = 1.D0+0.252D-1*t60*t61
      t65 = 1/t64
      t68 = rhob**2
      t69 = t54**2
      t71 = 1/t69/t68
      t72 = sigmabb*t71
      t74 = 1.D0+0.38D-1*t72
      t75 = t74**2
      t76 = 1/t75
      t77 = 1/rhob
      t80 = taub-0.25D0*sigmabb*t77
      t81 = t76*t80
      t82 = 1/t69
      t83 = t77**(1.D0/3.D0)
      t85 = 1.D0+0.1274696188700087D0*t83
      t87 = t77**(1.D0/6.D0)
      t90 = dsqrt(t77)
      t92 = t83**2
      t94 = 0.1112037486309468D2*t87+0.3844746237447211D1*t83
     #+0.1644733775567609D1*t90+0.2405871291288192D0*t92
      t97 = 1.D0+0.321646831778707D2/t94
      t98 = dlog(t97)
      t104 = 1.D0+0.31D-2*t24+0.31D-2*t72
      t105 = 1/t104
      t106 = rhoa+rhob
      t107 = 1/t106
      t108 = t107**(1.D0/3.D0)
      t110 = 1.D0+0.1325688999052018D0*t108
      t111 = t107**(1.D0/6.D0)
      t114 = dsqrt(t107)
      t116 = t108**2
      t118 = 0.598255043577108D1*t111+0.2225569421150687D1*t108
     #+0.8004286349993634D0*t114+0.1897004325747559D0*t116
      t121 = 1.D0+0.160818243221511D2/t118
      t122 = dlog(t121)
      t124 = 0.62182D-1*t110*t122
      t126 = 1.D0+0.6901399211255825D-1*t108
      t131 = 0.8157414703487641D1*t111+0.2247591863577616D1*t108
     #+0.4300972471276643D0*t114+0.1911512595127338D0*t116
      t134 = 1.D0+0.2960857464321668D2/t131
      t135 = dlog(t134)
      t136 = t126*t135
      t138 = rhoa-1.D0*rhob
      t139 = t138*t107
      t140 = 1.D0+t139
      t141 = t140**(1.D0/3.D0)
      t144 = 1.D0-1.D0*t139
      t145 = t144**(1.D0/3.D0)
      t147 = t141*t140+t145*t144-2.D0
      t148 = t138**2
      t149 = t148**2
      t150 = t106**2
      t151 = t150**2
      t152 = 1/t151
      t153 = t149*t152
      t155 = 1.D0-1.D0*t153
      t156 = t147*t155
      t158 = 0.3799574853701528D-1*t136*t156
      t160 = 1.D0+0.1274696188700087D0*t108
      t165 = 0.1112037486309468D2*t111+0.3844746237447211D1*t108
     #+0.1644733775567609D1*t114+0.2405871291288192D0*t116
      t168 = 1.D0+0.321646831778707D2/t165
      t169 = dlog(t168)
      t172 = -0.3109D-1*t160*t169+t124
      t173 = t172*t147
      t175 = 0.1923661050931536D1*t173*t153
      t178 = rhoa*t37
      t181 = rhob*t85
      t184 = t106*(-t124+t158+t175)+0.3109D-1*t178*t50+0.3109D-1*t181
     #*t98
      zk(i) = -0.539704927082478D0*t7-0.2436D-2*t10*t17
     #-0.3410636806218528D-2*t33*t34*t37*t50-0.539704927082478D0*t55
     #-0.2436D-2*t58*t65-0.3410636806218528D-2*t81*t82*t85*t98+t105*t184
      t188 = 1/t6/t20
      t189 = t188*sigmaaa
      t192 = t16**2
      t193 = 1/t192
      t197 = t20*rhoa
      t199 = 1/t21/t197
      t200 = sigmaaa*t199
      t201 = 1.D0+t24
      t202 = dsqrt(t201)
      t203 = 1/t202
      t206 = -0.336D-1*t11*t188*t13-0.336D-1*t200*t203
      t207 = t193*t206
      t211 = 1/t27/t26
      t212 = t211*t32
      t213 = t20**2
      t215 = 1/t6/t213
      t217 = t37*t50
      t218 = t217*sigmaaa
      t221 = t28*sigmaaa
      t223 = t23*t37*t50
      t227 = 1/t21/rhoa
      t232 = 1/t44
      t237 = t33*t34
      t238 = t46**2
      t239 = 1/t238
      t240 = t37*t239
      t241 = t39**2
      t242 = t241**2
      t243 = t242*t39
      t244 = 1/t243
      t245 = 1/t20
      t250 = 1/t42
      t253 = 1/t35
      t256 = -0.1853395810515781D1*t244*t245-0.128158207914907D1*t232
     #*t245-0.8223668877838045D0*t250*t245-0.1603914194192128D0*t253
     #*t245
      t257 = 1/t49
      t258 = t256*t257
      t259 = t240*t258
      t262 = t104**2
      t263 = 1/t262
      t264 = t263*t184
      t267 = 1/t116
      t268 = 1/t150
      t269 = t267*t268
      t270 = t269*t122
      t271 = 0.2747799777968419D-2*t270
      t272 = t118**2
      t273 = 1/t272
      t274 = t110*t273
      t275 = t111**2
      t276 = t275**2
      t277 = t276*t111
      t278 = 1/t277
      t279 = t278*t268
      t282 = 1/t114
      t283 = t282*t268
      t285 = 1/t108
      t286 = t285*t268
      t288 = -0.99709173929518D0*t279-0.7418564737168958D0*t269
     #-0.4002143174996817D0*t283-0.1264669550498372D0*t286
      t289 = 1/t121
      t291 = t274*t288*t289
      t292 = 0.1D1*t291
      t293 = t135*t147
      t294 = t293*t155
      t295 = t269*t294
      t296 = 0.8740794299481065D-3*t295
      t297 = t131**2
      t298 = 1/t297
      t299 = t126*t298
      t304 = -0.135956911724794D1*t279-0.7491972878592054D0*t269
     #-0.2150486235638321D0*t283-0.1274341730084892D0*t286
      t305 = t299*t304
      t306 = 1/t134
      t307 = t306*t147
      t308 = t307*t155
      t309 = t305*t308
      t310 = 0.1124999956683108D1*t309
      t311 = t138*t268
      t312 = 1.D0*t311
      t313 = t107-t312
      t316 = 1.D0*t107
      t317 = -t316+t311
      t320 = 0.1333333333333333D1*t141*t313+0.1333333333333333D1*t145
     #*t317
      t322 = t136*t320*t155
      t323 = 0.3799574853701528D-1*t322
      t324 = t148*t138
      t325 = t324*t152
      t326 = 4.D0*t325
      t328 = 1/t151/t106
      t329 = t149*t328
      t330 = 4.D0*t329
      t331 = -t326+t330
      t333 = t136*t147*t331
      t334 = 0.3799574853701528D-1*t333
      t337 = t165**2
      t338 = 1/t337
      t339 = t160*t338
      t344 = -0.1853395810515781D1*t279-0.128158207914907D1*t269
     #-0.8223668877838045D0*t283-0.1603914194192128D0*t286
      t345 = 1/t168
      t351 = 0.1321010150222857D-2*t269*t169+0.1D1*t339*t344*t345
     #-0.2747799777968419D-2*t270-0.1D1*t291
      t352 = t351*t147
      t353 = t352*t153
      t354 = 0.1923661050931536D1*t353
      t355 = t172*t320
      t356 = t355*t153
      t357 = 0.1923661050931536D1*t356
      t358 = t173*t325
      t360 = t173*t329
      t361 = 0.7694644203726145D1*t360
      t365 = t29*t232
      t368 = t239*t256
      t369 = t368*t257
      t372 = -t124+t158+t175+t106*(t271+t292-t296-t310+t323+t334+t354
     #+t357+0.7694644203726145D1*t358-t361)+0.3109D-1*t217
     #-0.1321010150222857D-2*t365*t50-0.1D1*t178*t369
      vrhoa(i) = -0.719606569443304D0*t6+0.3248D-2*t189*t17+0.2436D-2
     #*t10*t207-0.6912223927269549D-3*t212*t215*t218
     #-0.8526592015546319D-3*t221*t223+0.2273757870812352D-2*t33*t227
     #*t37*t50+0.1449175245975665D-3*t33*t23*t232*t50
     #+0.1097020523068037D0*t237*t259+0.8266666666666667D-2*t264*t200
     #+t105*t372
      t376 = 1/t54/t68
      t377 = t376*sigmabb
      t380 = t64**2
      t381 = 1/t380
      t385 = t68*rhob
      t387 = 1/t69/t385
      t388 = sigmabb*t387
      t389 = 1.D0+t72
      t390 = dsqrt(t389)
      t391 = 1/t390
      t394 = -0.336D-1*t59*t376*t61-0.336D-1*t388*t391
      t395 = t381*t394
      t399 = 1/t75/t74
      t400 = t399*t80
      t401 = t68**2
      t403 = 1/t54/t401
      t405 = t85*t98
      t406 = t405*sigmabb
      t409 = t76*sigmabb
      t411 = t71*t85*t98
      t415 = 1/t69/rhob
      t420 = 1/t92
      t425 = t81*t82
      t426 = t94**2
      t427 = 1/t426
      t428 = t85*t427
      t429 = t87**2
      t430 = t429**2
      t431 = t430*t87
      t432 = 1/t431
      t433 = 1/t68
      t438 = 1/t90
      t441 = 1/t83
      t444 = -0.1853395810515781D1*t432*t433-0.128158207914907D1*t420
     #*t433-0.8223668877838045D0*t438*t433-0.1603914194192128D0*t441
     #*t433
      t445 = 1/t97
      t446 = t444*t445
      t447 = t428*t446
      t452 = -t316-t312
      t455 = t107+t311
      t458 = 0.1333333333333333D1*t141*t452+0.1333333333333333D1*t145
     #*t455
      t460 = t136*t458*t155
      t461 = 0.3799574853701528D-1*t460
      t462 = t326+t330
      t464 = t136*t147*t462
      t465 = 0.3799574853701528D-1*t464
      t466 = t172*t458
      t467 = t466*t153
      t468 = 0.1923661050931536D1*t467
      t473 = t77*t420
      t476 = t427*t444
      t477 = t476*t445
      t480 = -t124+t158+t175+t106*(t271+t292-t296-t310+t461+t465+t354
     #+t468-0.7694644203726145D1*t358-t361)+0.3109D-1*t405
     #-0.1321010150222857D-2*t473*t98-0.1D1*t181*t477
      vrhob(i) = -0.719606569443304D0*t54+0.3248D-2*t377*t65+0.2436D-2
     #*t58*t395-0.6912223927269549D-3*t400*t403*t406
     #-0.8526592015546319D-3*t409*t411+0.2273757870812352D-2*t81*t415
     #*t85*t98+0.1449175245975665D-3*t81*t71*t420*t98
     #+0.1097020523068037D0*t425*t447+0.8266666666666667D-2*t264*t388
     #+t105*t480
      t484 = 1/t11
      t490 = 0.126D-1*t484*t9*t13+0.126D-1*t23*t203
      t491 = t193*t490
      t495 = 1/t6/t197
      t500 = t28*t227
      t501 = t500*t217
      vsigmaaa(i) = -0.2436D-2*t9*t17+0.2436D-2*t10*t491
     #+0.2592083972726081D-3*t212*t495*t37*t50+0.8526592015546319D-3
     #*t501-0.31D-2*t264*t23
      vsigmaab(i) = 0.D0
      t507 = 1/t59
      t513 = 0.126D-1*t507*t57*t61+0.126D-1*t71*t391
      t514 = t381*t513
      t518 = 1/t54/t385
      t523 = t76*t415
      t524 = t523*t405
      vsigmabb(i) = -0.2436D-2*t57*t65+0.2436D-2*t58*t514
     #+0.2592083972726081D-3*t400*t518*t85*t98+0.8526592015546319D-3
     #*t524-0.31D-2*t264*t71
      t528 = t28*t34
      vtaua(i) = -0.3410636806218528D-2*t528*t217
      t531 = t76*t82
      vtaub(i) = -0.3410636806218528D-2*t531*t405
      t536 = 1/t262/t104*t184
      t537 = sigmaaa**2
      t538 = t213*t197
      t541 = t537/t6/t538
      t547 = 1/t6/t213/rhoa
      t551 = t213*t20
      t553 = 1/t6/t551
      t555 = t232*t50
      t564 = t27**2
      t566 = 1/t564*t32
      t567 = t213**2
      t574 = 1/t21/t213
      t580 = 1/t192/t16
      t581 = t206**2
      t590 = sigmaaa*t574
      t594 = 1/t202/t201
      t601 = t263*t372
      t607 = 0.1366755555555556D-3*t536*t541-0.2398688564811013D0*t34
     #+0.3456111963634775D-2*t212*t547*t218+0.5873990330354695D-4*t212
     #*t553*t555*sigmaaa-0.3456111963634775D-3*t211*t537*t553*t37*t50
     #-0.2101316073889943D-3*t566/t567*t217*t537+0.7245876229878325D-4
     #*t221*t574*t232*t50-0.4872D-2*t10*t580*t581-0.6496D-2*t189*t207
     #+0.2436D-2*t10*t193*(0.784D-1*t11*t495*t13+0.168D0*t590*t203
     #-0.448D-1*t541*t594)+0.1653333333333333D-1*t601*t200
     #-0.7578666666666667D-2*t495*sigmaaa*t17
      t614 = t215*t37
      t625 = 1/t213
      t628 = 1/t197
      t632 = 1/t44/t29
      t649 = -0.1544496508763151D1/t243/t29*t625+0.3706791621031562D1
     #*t244*t628-0.854388052766047D0*t632*t625+0.2563164158298141D1
     #*t232*t628-0.4111834438919023D0/t42/t29*t625
     #+0.1644733775567609D1*t250*t628-0.5346380647307093D-1/t35/t29
     #*t625+0.3207828388384256D0*t253*t628
      t654 = t238**2
      t655 = 1/t654
      t657 = t256**2
      t658 = t49**2
      t659 = 1/t658
      t665 = 1/t238/t46
      t684 = 0.1538928840745229D2*t360
      t687 = 0.5495599555936838D-2*t270
      t688 = 0.2D1*t291
      t691 = 0.1748158859896213D-2*t295
      t692 = 0.2249999913366216D1*t309
      t693 = 0.3847322101863073D1*t353
      t696 = t149/t151/t150
      t698 = 0.3847322101863073D2*t173*t696
      t700 = 0.1538928840745229D2*t352*t329
      t702 = t351*t320*t153
      t704 = t297**2
      t707 = t304**2
      t709 = t134**2
      t714 = 0.3330964519106732D2*t126/t704*t707/t709*t147*t155
      t717 = 1/t277/t107*t152
      t720 = 1/t150/t106
      t721 = t278*t720
      t725 = 1/t116/t107*t152
      t727 = t267*t720
      t731 = 1/t114/t107*t152
      t733 = t282*t720
      t737 = 1/t108/t107*t152
      t739 = t285*t720
      t744 = 0.1124999956683108D1*t299*(-0.1132974264373283D1*t717
     #+0.271913823449588D1*t721-0.4994648585728036D0*t725
     #+0.1498394575718411D1*t727-0.1075243117819161D0*t731
     #+0.4300972471276643D0*t733-0.4247805766949639D-1*t737
     #+0.2548683460169784D0*t739)*t308
      t749 = 0.5176049209143758D-1*t269*t298*t304*t306*t156
      t752 = t305*t306*t320*t155
      t755 = t305*t307*t331
      t762 = 0.2249999913366216D1*t126/t297/t131*t707*t308
      t765 = t269*t135*t320*t155
      t767 = t725*t122
      t768 = 0.1831866518645613D-2*t767
      t769 = t727*t122
      t770 = 0.5495599555936838D-2*t769
      t772 = 0.5827196199654043D-3*t725*t294
      t774 = t269*t293*t331
      t776 = t698-t700+0.3847322101863073D1*t702-t714-t744+t749
     #-0.2249999913366216D1*t752-0.2249999913366216D1*t755+t762
     #-0.1748158859896213D-2*t765+t768-t770-t772-0.1748158859896213D-2
     #*t774
      t778 = 0.1748158859896213D-2*t727*t294
      t782 = t288**2
      t784 = t110/t272/t118*t782*t289
      t785 = 0.2D1*t784
      t796 = t274*(-0.8309097827459833D0*t717+0.199418347859036D1*t721
     #-0.4945709824779306D0*t725+0.1483712947433792D1*t727
     #-0.2001071587498409D0*t731+0.8004286349993634D0*t733
     #-0.4215565168327908D-1*t737+0.2529339100996745D0*t739)*t289
      t797 = 0.1D1*t796
      t798 = t272**2
      t801 = t121**2
      t804 = t110/t798*t782/t801
      t805 = 0.160818243221511D2*t804
      t817 = t344**2
      t833 = t337**2
      t836 = t168**2
      t845 = t269*t273*t288*t289
      t850 = 0.8806734334819047D-3*t725*t169-0.2642020300445714D-2
     #*t727*t169-0.8497974591333914D-1*t269*t338*t344*t345-0.2D1*t160
     #/t337/t165*t817*t345+0.1D1*t339*(-0.1544496508763151D1*t717
     #+0.3706791621031562D1*t721-0.854388052766047D0*t725
     #+0.2563164158298141D1*t727-0.4111834438919023D0*t731
     #+0.1644733775567609D1*t733-0.5346380647307093D-1*t737
     #+0.3207828388384256D0*t739)*t345+0.321646831778707D2*t160/t833
     #*t817/t836-0.1831866518645613D-2*t767+0.5495599555936838D-2*t769
     #+0.8837926660346786D-1*t845+0.2D1*t784-0.1D1*t796
     #-0.160818243221511D2*t804
      t853 = 0.1923661050931536D1*t850*t147*t153
      t854 = t148*t152
      t855 = 12.D0*t854
      t856 = t324*t328
      t857 = 32.D0*t856
      t858 = 20.D0*t696
      t866 = t173*t854
      t867 = 0.2308393261117844D2*t866
      t868 = t173*t856
      t870 = t355*t325
      t872 = t355*t329
      t874 = t352*t325
      t876 = t141**2
      t877 = 1/t876
      t878 = t313**2
      t881 = 2.D0*t268
      t883 = 2.D0*t138*t720
      t884 = -t881+t883
      t887 = t145**2
      t888 = 1/t887
      t889 = t317**2
      t895 = 0.4444444444444444D0*t877*t878+0.1333333333333333D1*t141
     #*t884+0.4444444444444444D0*t888*t889-0.1333333333333333D1*t145
     #*t884
      t899 = 0.8837926660346786D-1*t845
      t903 = t778-t785+t797+t805+t853+0.3799574853701528D-1*t136*t147*
     #(-t855+t857-t858)+0.7599149707403056D-1*t136*t320*t331+t867
     #-0.6155715362980916D2*t868+0.1538928840745229D2*t870
     #-0.1538928840745229D2*t872+0.1538928840745229D2*t874
     #+0.1923661050931536D1*t172*t895*t153-t899+0.3799574853701528D-1
     #*t136*t895*t155
      t924 = -t684+0.3847322101863073D1*t356+0.1538928840745229D2*t358
     #+t687+t688+0.7599149707403056D-1*t322+0.7599149707403056D-1*t333
     #-t691-t692+t693+t106*(t776+t903)-0.2D1*t259-0.321646831778707D2
     #*t178*t655*t657*t659-0.1D1*t178*t239*t649*t257+0.2D1*t178*t665
     #*t657*t257-0.8806734334819047D-3*t628*t632*t50
     #+0.8497974591333914D-1*t365*t369
      t931 = -0.3031111111111111D-1*t264*t590+0.284219733851544D-2
     #*t221*t199*t37*t50+0.4446589853502444D-1*t212*t614*t368*t257
     #*sigmaaa+0.5485102615340186D-1*t221*t23*t259
     #+0.1097020523068037D0*t237*t240*t649*t257+0.3528531756410541D1
     #*t237*t37*t655*t657*t659-0.2194041046136074D0*t237*t37*t665*t657
     #*t257+0.9661168306504433D-4*t33*t574*t632*t50
     #-0.932245253120402D-2*t33*t23*t232*t239*t258
     #-0.4830584153252216D-3*t33*t199*t232*t50+t105*t924
     #-0.378959645135392D-2*t33*t223-0.1462694030757383D0*t33*t227*t259
      v2rhoa2(i) = t607+t931
      t936 = t452**2
      t939 = t881+t883
      t942 = t455**2
      t948 = 0.4444444444444444D0*t877*t936+0.1333333333333333D1*t141
     #*t939+0.4444444444444444D0*t888*t942-0.1333333333333333D1*t145
     #*t939
      t961 = t269*t135*t458*t155
      t964 = t269*t293*t462
      t967 = t305*t307*t462
      t971 = t305*t306*t458*t155
      t974 = t351*t458*t153
      t979 = t698-t700-t714-t744+t749+0.3799574853701528D-1*t136*t948
     #*t155+0.7599149707403056D-1*t136*t458*t462+0.3799574853701528D-1
     #*t136*t147*(-t855-t857-t858)-0.1748158859896213D-2*t961
     #-0.1748158859896213D-2*t964-0.2249999913366216D1*t967
     #-0.2249999913366216D1*t971+0.3847322101863073D1*t974
     #+0.1923661050931536D1*t172*t948*t153
      t980 = t466*t329
      t982 = t466*t325
      t986 = -0.1538928840745229D2*t980-0.1538928840745229D2*t982+t762
     #+t768-t770-t772+t778-t785+t797+t805+t853+t867
     #+0.6155715362980916D2*t868-0.1538928840745229D2*t874-t899
      t990 = 1/t385
      t992 = 1/t92/t77
      t999 = 1/t426/t94
      t1000 = t444**2
      t1007 = 1/t401
      t1028 = -0.1544496508763151D1/t431/t77*t1007
     #+0.3706791621031562D1*t432*t990-0.854388052766047D0*t992*t1007
     #+0.2563164158298141D1*t420*t990-0.4111834438919023D0/t90/t77
     #*t1007+0.1644733775567609D1*t438*t990-0.5346380647307093D-1/t83
     #/t77*t1007+0.3207828388384256D0*t441*t990
      t1033 = t426**2
      t1034 = 1/t1033
      t1036 = t97**2
      t1037 = 1/t1036
      t1041 = -t684-0.1538928840745229D2*t358+t687+t688-t691-t692+t693
     #+0.7599149707403056D-1*t460+0.7599149707403056D-1*t464
     #+0.3847322101863073D1*t467+t106*(t979+t986)-0.2D1*t447
     #-0.8806734334819047D-3*t990*t992*t98+0.8497974591333914D-1*t473
     #*t477+0.2D1*t181*t999*t1000*t445-0.1D1*t181*t427*t1028*t445
     #-0.321646831778707D2*t181*t1034*t1000*t1037
      t1043 = sigmabb**2
      t1044 = t401*t385
      t1047 = t1043/t54/t1044
      t1051 = 1/t69/t401
      t1052 = sigmabb*t1051
      t1063 = 1/t390/t389
      t1071 = 1/t380/t64
      t1072 = t394**2
      t1089 = t263*t480
      t1094 = 1/t54/t401/rhob
      t1098 = t105*t1041+0.1366755555555556D-3*t536*t1047
     #-0.3031111111111111D-1*t264*t1052-0.6496D-2*t377*t395+0.2436D-2
     #*t58*t381*(0.784D-1*t59*t518*t61+0.168D0*t1052*t391-0.448D-1
     #*t1047*t1063)-0.4872D-2*t58*t1071*t1072+0.3528531756410541D1
     #*t425*t85*t1034*t1000*t1037-0.2398688564811013D0*t82
     #+0.1097020523068037D0*t425*t428*t1028*t445-0.7578666666666667D-2
     #*t518*sigmabb*t65+0.1653333333333333D-1*t1089*t388
     #+0.3456111963634775D-2*t400*t1094*t406
      t1099 = t401*t68
      t1101 = 1/t54/t1099
      t1103 = t420*t98
      t1112 = t75**2
      t1114 = 1/t1112*t80
      t1115 = t401**2
      t1125 = t403*t85
      t1161 = 0.5873990330354695D-4*t400*t1101*t1103*sigmabb
     #-0.3456111963634775D-3*t399*t1043*t1101*t85*t98
     #-0.2101316073889943D-3*t1114/t1115*t405*t1043
     #+0.7245876229878325D-4*t409*t1051*t420*t98+0.4446589853502444D-1
     #*t400*t1125*t476*t445*sigmabb+0.284219733851544D-2*t409*t387*t85
     #*t98-0.1462694030757383D0*t81*t415*t447-0.4830584153252216D-3
     #*t81*t387*t420*t98-0.378959645135392D-2*t81*t411
     #+0.5485102615340186D-1*t409*t71*t447-0.932245253120402D-2*t81
     #*t71*t420*t427*t446+0.9661168306504433D-4*t81*t1051*t992*t98
     #-0.2194041046136074D0*t425*t85*t999*t1000*t445
      v2rhob2(i) = t1098+t1161
      t1194 = 0.4444444444444444D0*t877*t313*t452+0.2666666666666667D1
     #*t141*t138*t720+0.4444444444444444D0*t888*t317*t455
     #-0.2666666666666667D1*t145*t138*t720
      t1207 = t698-t700+0.1923661050931536D1*t702-t714-t744
     #+0.3799574853701528D-1*t136*t147*(t855-t858)
     #+0.3799574853701528D-1*t136*t458*t331+0.3799574853701528D-1*t136
     #*t320*t462+0.3799574853701528D-1*t136*t1194*t155+t749
     #+0.1923661050931536D1*t172*t1194*t153-0.1124999956683108D1*t752
     #-0.8740794299481065D-3*t961-0.1124999956683108D1*t755
     #-0.8740794299481065D-3*t964-0.1124999956683108D1*t967
     #-0.1124999956683108D1*t971
      t1216 = 0.1923661050931536D1*t974-0.7694644203726145D1*t980
     #+0.7694644203726145D1*t982+t762-0.8740794299481065D-3*t765+t768
     #-t770-t772-0.8740794299481065D-3*t774+t778-t785+t797+t805+t853
     #-0.2308393261117844D2*t866-0.7694644203726145D1*t870
     #-0.7694644203726145D1*t872-t899
      t1219 = t687+t688-t691-t692+t461+t465+t693+t468-t684+t323+t334
     #+t357+t106*(t1207+t1216)
      v2rhoab(i) = 0.1366755555555556D-3*t536*sigmaaa*t199*sigmabb
     #*t387+0.8266666666666667D-2*t1089*t200+0.8266666666666667D-2
     #*t601*t388+t105*t1219
      t1225 = t9*t193
      t1237 = sigmaaa*t553
      t1254 = t28*t23
      v2rhoasigmaaa(i) = 0.3248D-2*t188*t17-0.3248D-2*t189*t491
     #+0.2436D-2*t1225*t206-0.4872D-2*t10*t580*t206*t490+0.2436D-2*t10
     #*t193*(-0.168D-1*t484*t188*t13-0.504D-1*t199*t203+0.168D-1*t1237
     #*t594)+0.7879935277087286D-4*t566/t538*t218
     #+0.2376076974998908D-3*t211*t547*t218-0.8640279909086936D-3*t212
     #*t614*t50-0.142109866925772D-2*t1254*t217-0.1101373186941505D-4
     #*t212*t547*t232*t50-0.3622938114939162D-4*t28*t199*t555
     #-0.8337355975317082D-2*t212*t495*t259-0.2742551307670093D-1*t500
     #*t37*t369-0.5125333333333333D-4*t536*t1237+0.8266666666666667D-2
     #*t264*t199-0.31D-2*t601*t23
      v2rhoasigmaab(i) = 0.D0
      v2rhoasigmabb(i) = -0.5125333333333333D-4*t536*t200*t71-0.31D-2
     #*t601*t71
      v2rhobsigmaaa(i) = -0.5125333333333333D-4*t536*t388*t23-0.31D-2
     #*t1089*t23
      v2rhobsigmaab(i) = 0.D0
      t1290 = t57*t381
      t1302 = sigmabb*t1101
      t1319 = t76*t71
      v2rhobsigmabb(i) = 0.3248D-2*t376*t65-0.3248D-2*t377*t514
     #+0.2436D-2*t1290*t394-0.4872D-2*t58*t1071*t394*t513+0.2436D-2
     #*t58*t381*(-0.168D-1*t507*t376*t61-0.504D-1*t387*t391+0.168D-1
     #*t1302*t1063)+0.7879935277087286D-4*t1114/t1044*t406
     #+0.2376076974998908D-3*t399*t1094*t406-0.8640279909086936D-3
     #*t400*t1125*t98-0.142109866925772D-2*t1319*t405
     #-0.1101373186941505D-4*t400*t1094*t420*t98-0.3622938114939162D-4
     #*t76*t387*t1103-0.8337355975317082D-2*t400*t518*t447
     #-0.2742551307670093D-1*t523*t85*t477-0.5125333333333333D-4*t536
     #*t1302+0.8266666666666667D-2*t264*t387-0.31D-2*t1089*t71
      t1343 = t490**2
      t1367 = t211*t215
      v2sigmaaa2(i) = 0.4872D-2*t1225*t490-0.4872D-2*t10*t580*t1343
     #+0.2436D-2*t10*t193*(-0.63D-2/t11/sigmaaa*t9*t13+0.63D-2/sigmaaa
     #*t23*t203-0.63D-2*t547*t594)-0.2954975728907732D-4*t566/t551*t37
     #*t50-0.129604198636304D-3*t1367*t217+0.1922D-4*t536*t547
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.1922D-4*t536*t23*t71
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      t1376 = t513**2
      t1400 = t399*t403
      v2sigmabb2(i) = 0.4872D-2*t1290*t513-0.4872D-2*t58*t1071*t1376
     #+0.2436D-2*t58*t381*(-0.63D-2/t59/sigmabb*t57*t61+0.63D-2
     #/sigmabb*t71*t391-0.63D-2*t1094*t1063)-0.2954975728907732D-4
     #*t1114/t1099*t85*t98-0.129604198636304D-3*t1400*t405+0.1922D-4
     #*t536*t1094
      v2taua2(i) = 0.D0
      v2taub2(i) = 0.D0
      v2tauab(i) = 0.D0
      v2rhoataua(i) = -0.6912223927269549D-3*t1367*t218
     #+0.2273757870812352D-2*t501+0.1449175245975665D-3*t1254*t555
     #+0.1097020523068037D0*t528*t37*t369
      v2rhoataub(i) = 0.D0
      v2rhobtaua(i) = 0.D0
      v2rhobtaub(i) = -0.6912223927269549D-3*t1400*t406
     #+0.2273757870812352D-2*t524+0.1449175245975665D-3*t1319*t1103
     #+0.1097020523068037D0*t531*t85*t477
      v2sigmaaataua(i) = 0.2592083972726081D-3*t211*t495*t217
      v2sigmaabtaua(i) = 0.D0
      v2sigmabbtaua(i) = 0.D0
      v2sigmaaataub(i) = 0.D0
      v2sigmaabtaub(i) = 0.D0
      v2sigmabbtaub(i) = 0.2592083972726081D-3*t399*t518*t405
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      v2rhob2(i) = 0.0d0
      v2rhoab(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2rhoasigmaab(i) = 0.0d0
      v2rhoasigmabb(i) = 0.0d0
      v2rhobsigmaaa(i) = 0.0d0
      v2rhobsigmaab(i) = 0.0d0
      v2rhobsigmabb(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      v2sigmaab2(i) = 0.0d0
      v2sigmabb2(i) = 0.0d0
      v2sigmaaaab(i) = 0.0d0
      v2sigmaaabb(i) = 0.0d0
      v2sigmaabbb(i) = 0.0d0
      vtaua(i) = 0.0d0
      vtaub(i) = 0.0d0
      v2rhoataua(i) = 0.0d0
      v2rhoataub(i) = 0.0d0
      v2rhobtaua(i) = 0.0d0
      v2rhobtaub(i) = 0.0d0
      v2taua2(i) = 0.0d0
      v2taub2(i) = 0.0d0
      v2tauab(i) = 0.0d0
      v2sigmaaataua(i) = 0.0d0
      v2sigmaaataub(i) = 0.0d0
      v2sigmaabtaua(i) = 0.0d0
      v2sigmaabtaub(i) = 0.0d0
      v2sigmabbtaua(i) = 0.0d0
      v2sigmabbtaub(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end
      
      
      subroutine rks_xc_bb1k
     & (ideriv,npt,rhoa1,sigmaaa1,taua1,
     &  zk,vrhoa,vsigmaaa,vtaua,
     &  v2rhoa2,v2rhoasigmaaa,v2sigmaaa2,
     &  v2rhoataua,v2sigmaaataua,v2taua2)
c
c     Y. Zhao, B.J. Lynch, D.G. Truhlar
c     Development and assessment of a new hybrid density functional
c     model for thermochemical kinetics
c     J. Phys. Chem. A 108 (2004) 2715-2719
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt)
      REAL sigmaaa1(npt)
      REAL taua1(npt)
      REAL zk(npt),vrhoa(npt),vsigmaaa(npt),vtaua(npt)
      REAL v2rhoa2(npt),v2rhoasigmaaa(npt),v2sigmaaa2(npt)
      REAL v2rhoataua(npt),v2sigmaaataua(npt),v2taua2(npt)
      parameter(tol=1.0d-20)
      
      if(ideriv.eq.0) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      tau = dmax1(0.D0,taua1(i))
      t3 = rho**(1.D0/3.D0)
      t4 = t3*rho
      t6 = 1/t4
      t8 = dsqrt(sigma)
      t9 = t8*t6
      t11 = dlog(0.1259921049894873D1*t9+dsqrt(1+0.1587401051968199D1
     #*t9**2))
      t18 = rho**2
      t19 = t3**2
      t22 = sigma/t19/t18
      t25 = (1.D0+0.6032123997479158D-1*t22)**2
      t28 = 1/rho
      t34 = t28**(1.D0/3.D0)
      t36 = 1.D0+0.1606016560364007D0*t34
      t38 = t28**(1.D0/6.D0)
      t41 = dsqrt(t28)
      t43 = t34**2
      t49 = dlog(1.D0+0.321646831778707D2/(0.1248219874679732D2*t38
     #+0.4844076716063854D1*t34+0.2326004811900819D1*t41
     #+0.3819082618690966D0*t43))
      t67 = dlog(1.D0+0.160818243221511D2/(0.598255043577108D1*t38
     #+0.2225569421150687D1*t34+0.8004286349993634D0*t41
     #+0.1897004325747559D0*t43))
      zk(i) = -0.428364084501573D0*t4-0.3069167677543911D-2*t6*sigma/
     #(1.D0+0.317500104573508D-1*t9*t11)-0.108280969081455D-1/t25*
     #(0.5D0*tau-0.125D0*sigma*t28)/t19*t36*t49+1/(1.D0
     #+0.9841886522202837D-2*t22)*(-0.62182D-1*rho*(1.D0
     #+0.1325688999052018D0*t34)*t67+0.3109D-1*rho*t36*t49)
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      tau = dmax1(0.D0,taua1(i))
      t3 = rho**(1.D0/3.D0)
      t4 = t3*rho
      t6 = 1/t4
      t7 = t6*sigma
      t8 = dsqrt(sigma)
      t9 = t8*t6
      t11 = dlog(0.1259921049894873D1*t9+dsqrt(1+0.1587401051968199D1
     #*t9**2))
      t14 = 1.D0+0.317500104573508D-1*t9*t11
      t15 = 1/t14
      t18 = rho**2
      t19 = t3**2
      t21 = 1/t19/t18
      t22 = sigma*t21
      t24 = 1.D0+0.6032123997479158D-1*t22
      t25 = t24**2
      t26 = 1/t25
      t28 = 1/rho
      t31 = 0.5D0*tau-0.125D0*sigma*t28
      t32 = t26*t31
      t33 = 1/t19
      t34 = t28**(1.D0/3.D0)
      t36 = 1.D0+0.1606016560364007D0*t34
      t38 = t28**(1.D0/6.D0)
      t41 = dsqrt(t28)
      t43 = t34**2
      t45 = 0.1248219874679732D2*t38+0.4844076716063854D1*t34
     #+0.2326004811900819D1*t41+0.3819082618690966D0*t43
      t48 = 1.D0+0.321646831778707D2/t45
      t49 = dlog(t48)
      t54 = 1.D0+0.9841886522202837D-2*t22
      t55 = 1/t54
      t57 = 1.D0+0.1325688999052018D0*t34
      t63 = 0.598255043577108D1*t38+0.2225569421150687D1*t34
     #+0.8004286349993634D0*t41+0.1897004325747559D0*t43
      t66 = 1.D0+0.160818243221511D2/t63
      t67 = dlog(t66)
      t70 = rho*t36
      t73 = -0.62182D-1*rho*t57*t67+0.3109D-1*t70*t49
      zk(i) = -0.428364084501573D0*t4-0.3069167677543911D-2*t7*t15
     #-0.108280969081455D-1*t32*t33*t36*t49+t55*t73
      t77 = 1/t3/t18
      t81 = t14**2
      t82 = 1/t81
      t86 = t18*rho
      t89 = sigma/t19/t86
      t92 = dsqrt(1.D0+0.1587401051968199D1*t22)
      t93 = 1/t92
      t102 = 1/t25/t24*t31
      t103 = t18**2
      t107 = t36*t49
      t117 = 1/t19/rho
      t122 = 1/t43
      t128 = t45**2
      t129 = 1/t128
      t131 = t38**2
      t132 = t131**2
      t135 = 1/t18
      t136 = 1/t132/t38*t135
      t138 = t122*t135
      t141 = 1/t41*t135
      t144 = 1/t34*t135
      t146 = -0.4160732915599108D1*t136-0.3229384477375903D1*t138
     #-0.2326004811900819D1*t141-0.5092110158254621D0*t144
      t147 = 1/t48
      t152 = t54**2
      t154 = 1/t152*t73
      t161 = t63**2
      vrhoa(i) = -0.571152112668764D0*t3+0.4092223570058548D-2*t77
     #*sigma*t15+0.1534583838771956D-2*t7*t82*(-0.8466669455293548D-1
     #*t8*t77*t11-0.106673350692263D0*t89*t93)-0.3483542571021566D-2
     #*t102/t3/t103*t107*sigma-0.1353512113518188D-2*t26*sigma*t21*t36
     #*t49+0.7218731272097001D-2*t32*t117*t36*t49+0.579670098390266D-3
     #*t32*t21*t122*t49+0.1741411532348907D0*t32*t33*t36*t129*t146
     #*t147+0.2624503072587423D-1*t154*t89+t55*(-0.62182D-1*t57*t67
     #+rho*(0.2747799777968419D-2*t138*t67+0.1D1*t57/t161*(
     #-0.99709173929518D0*t136-0.7418564737168958D0*t138
     #-0.4002143174996817D0*t141-0.1264669550498372D0*t144)/t66)
     #+0.3109D-1*t107-0.1664368495390566D-2*t28*t122*t49-0.5D0*t70
     #*t129*t146*t147)
      vsigmaaa(i) = -0.1227667071017564D-1*t6*t15
     #+0.3069167677543911D-2*t7*t82*(0.6350002091470161D-1/t8*t6*t11
     #+0.8000501301919725D-1*t21*t93)+0.5225313856532348D-2*t102/t3
     #/t86*t36*t49+0.5414048454072751D-2*t26*t117*t107
     #-0.3936754608881135D-1*t154*t21
      vtaua(i) = -0.5414048454072751D-2*t26*t33*t107
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vtaua(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      tau = dmax1(0.D0,taua1(i))
      t3 = rho**(1.D0/3.D0)
      t4 = t3*rho
      t6 = 1/t4
      t7 = t6*sigma
      t8 = dsqrt(sigma)
      t9 = t8*t6
      t11 = dlog(0.1259921049894873D1*t9+dsqrt(1+0.1587401051968199D1
     #*t9**2))
      t14 = 1.D0+0.317500104573508D-1*t9*t11
      t15 = 1/t14
      t18 = rho**2
      t19 = t3**2
      t21 = 1/t19/t18
      t22 = sigma*t21
      t24 = 1.D0+0.6032123997479158D-1*t22
      t25 = t24**2
      t26 = 1/t25
      t28 = 1/rho
      t31 = 0.5D0*tau-0.125D0*sigma*t28
      t32 = t26*t31
      t33 = 1/t19
      t34 = t28**(1.D0/3.D0)
      t36 = 1.D0+0.1606016560364007D0*t34
      t38 = t28**(1.D0/6.D0)
      t41 = dsqrt(t28)
      t43 = t34**2
      t45 = 0.1248219874679732D2*t38+0.4844076716063854D1*t34
     #+0.2326004811900819D1*t41+0.3819082618690966D0*t43
      t48 = 1.D0+0.321646831778707D2/t45
      t49 = dlog(t48)
      t54 = 1.D0+0.9841886522202837D-2*t22
      t55 = 1/t54
      t57 = 1.D0+0.1325688999052018D0*t34
      t63 = 0.598255043577108D1*t38+0.2225569421150687D1*t34
     #+0.8004286349993634D0*t41+0.1897004325747559D0*t43
      t66 = 1.D0+0.160818243221511D2/t63
      t67 = dlog(t66)
      t70 = rho*t36
      t73 = -0.62182D-1*rho*t57*t67+0.3109D-1*t70*t49
      zk(i) = -0.428364084501573D0*t4-0.3069167677543911D-2*t7*t15
     #-0.108280969081455D-1*t32*t33*t36*t49+t55*t73
      t77 = 1/t3/t18
      t78 = t77*sigma
      t81 = t14**2
      t82 = 1/t81
      t86 = t18*rho
      t88 = 1/t19/t86
      t89 = sigma*t88
      t91 = 1.D0+0.1587401051968199D1*t22
      t92 = dsqrt(t91)
      t93 = 1/t92
      t96 = -0.8466669455293548D-1*t8*t77*t11-0.106673350692263D0*t89
     #*t93
      t97 = t82*t96
      t101 = 1/t25/t24
      t102 = t101*t31
      t103 = t18**2
      t105 = 1/t3/t103
      t107 = t36*t49
      t108 = t107*sigma
      t111 = t26*sigma
      t113 = t21*t36*t49
      t117 = 1/t19/rho
      t122 = 1/t43
      t127 = t32*t33
      t128 = t45**2
      t129 = 1/t128
      t130 = t36*t129
      t131 = t38**2
      t132 = t131**2
      t133 = t132*t38
      t134 = 1/t133
      t135 = 1/t18
      t136 = t134*t135
      t138 = t122*t135
      t140 = 1/t41
      t141 = t140*t135
      t143 = 1/t34
      t144 = t143*t135
      t146 = -0.4160732915599108D1*t136-0.3229384477375903D1*t138
     #-0.2326004811900819D1*t141-0.5092110158254621D0*t144
      t147 = 1/t48
      t148 = t146*t147
      t149 = t130*t148
      t152 = t54**2
      t153 = 1/t152
      t154 = t153*t73
      t159 = t138*t67
      t161 = t63**2
      t162 = 1/t161
      t163 = t57*t162
      t168 = -0.99709173929518D0*t136-0.7418564737168958D0*t138
     #-0.4002143174996817D0*t141-0.1264669550498372D0*t144
      t169 = 1/t66
      t171 = t163*t168*t169
      t176 = t28*t122
      t179 = t129*t146
      t180 = t179*t147
      t183 = -0.62182D-1*t57*t67+rho*(0.2747799777968419D-2*t159+0.1D1
     #*t171)+0.3109D-1*t107-0.1664368495390566D-2*t176*t49-0.5D0*t70
     #*t180
      vrhoa(i) = -0.571152112668764D0*t3+0.4092223570058548D-2*t78*t15
     #+0.1534583838771956D-2*t7*t97-0.3483542571021566D-2*t102*t105
     #*t108-0.1353512113518188D-2*t111*t113+0.7218731272097001D-2*t32
     #*t117*t36*t49+0.579670098390266D-3*t32*t21*t122*t49
     #+0.1741411532348907D0*t127*t149+0.2624503072587423D-1*t154*t89
     #+t55*t183
      t187 = 1/t8
      t193 = 0.6350002091470161D-1*t187*t6*t11+0.8000501301919725D-1
     #*t21*t93
      t194 = t82*t193
      t198 = 1/t3/t86
      t203 = t26*t117
      t204 = t203*t107
      vsigmaaa(i) = -0.1227667071017564D-1*t6*t15
     #+0.3069167677543911D-2*t7*t194+0.5225313856532348D-2*t102*t198
     #*t36*t49+0.5414048454072751D-2*t204-0.3936754608881135D-1*t154*t21
      t208 = t26*t33
      vtaua(i) = -0.5414048454072751D-2*t208*t107
      t212 = 0.5495599555936838D-2*t159
      t213 = 0.2D1*t171
      t217 = t168**2
      t220 = 0.2D1*t57/t161/t63*t217*t169
      t223 = 1/t103
      t224 = 1/t133/t28*t223
      t226 = 1/t86
      t227 = t134*t226
      t230 = 1/t43/t28
      t231 = t230*t223
      t233 = t122*t226
      t237 = 1/t41/t28*t223
      t239 = t140*t226
      t243 = 1/t34/t28*t223
      t245 = t143*t226
      t250 = 0.1D1*t163*(-0.8309097827459833D0*t224
     #+0.199418347859036D1*t227-0.4945709824779306D0*t231
     #+0.1483712947433792D1*t233-0.2001071587498409D0*t237
     #+0.8004286349993634D0*t239-0.4215565168327908D-1*t243
     #+0.2529339100996745D0*t245)*t169
      t251 = t161**2
      t254 = t66**2
      t258 = 0.160818243221511D2*t57/t251*t217/t254
      t260 = 0.1831866518645613D-2*t231*t67
      t262 = 0.5495599555936838D-2*t233*t67
      t273 = dlog(1.D0+0.2960857464321668D2/(0.8157414703487641D1*t38
     #+0.2247591863577616D1*t34+0.4300972471276643D0*t41
     #+0.1911512595127338D0*t43))
      t275 = (1.D0+0.6901399211255825D-1*t34)*t273*t135
      t280 = 0.8837926660346786D-1*t138*t162*t168*t169
      t289 = 1/t81/t14
      t290 = t96**2
      t300 = 1/t19/t103
      t301 = sigma*t300
      t304 = sigma**2
      t305 = t103*t86
      t308 = t304/t3/t305
      t310 = 1/t92/t91
      t321 = 1/t152/t54*t73
      t324 = t153*t183
      t344 = -0.6934554859331846D1*t224+0.1664293166239643D2*t227
     #-0.4305845969834537D1*t231+0.1291753790950361D2*t233
     #-0.2326004811900819D1*t237+0.9304019247603276D1*t239
     #-0.3394740105503081D0*t243+0.2036844063301848D1*t245
      t350 = 1/t128/t45
      t351 = t146**2
      t356 = t128**2
      t357 = 1/t356
      t359 = t48**2
      t360 = 1/t359
      t367 = t103*t18
      t369 = 1/t3/t367
      s1 = -0.3807680751125093D0*t33+t55*(t212+t213+rho*(-t220+t250
     #+t258+t260-t262-0.3377399869956914D-1*t275-t280))
     #-0.1909704332693989D-1*t198*sigma*t15-0.3069167677543911D-2*t7
     #*t289*t290-0.8184447140117096D-2*t78*t97+0.1534583838771956D-2
     #*t7*t82*(0.3951112412470322D0*t8*t198*t11+0.106673350692263D1
     #*t301*t93-0.4515557042823225D0*t308*t310)
      t383 = s1-0.192463558656411D0*t154*t301+0.275520655120833D-2
     #*t321*t308+0.1049801229034969D0*t324*t89+t55*(rho*(-t220+t250
     #+t258+t260-t262+0.3377399869956914D-1*t275-t280)-0.2D1*t149
     #+0.1070677706909338D0*t176*t180-0.2219157993854088D-2*t226*t230
     #*t49-0.5D0*t70*t129*t344*t147+0.1D1*t70*t350*t351*t147
     #-0.1608234158893535D2*t70*t357*t351*t360+t213+t212)
     #-0.1741771285510783D-2*t101*t304*t369*t36*t49
     #+0.7728934645203546D-3*t32*t300*t230*t49-0.3482823064697813D0
     #*t127*t36*t350*t351*t147
      t403 = t25**2
      t405 = 1/t403*t31
      t406 = t103**2
      t418 = t122*t49
      t422 = t105*t36
      t430 = 1/t3/t103/rho
      t444 = 0.9023414090121251D-2*t111*t88*t36*t49
     #+0.289835049195133D-3*t111*t300*t122*t49+0.8707057661744533D-1
     #*t111*t21*t149-0.3728981012481608D-1*t32*t21*t122*t129*t148
     #-0.4643764086263751D0*t32*t117*t149-0.3362105718223909D-2*t405
     #/t406*t107*t304+0.5601195022029291D1*t127*t36*t357*t351*t360
     #+0.745950274372486D-3*t102*t369*t418*sigma+0.2240940862670676D0
     #*t102*t422*t179*t147*sigma+0.3483542571021566D-1*t102*t430*t108
     #-0.3864467322601773D-2*t32*t88*t122*t49+0.1741411532348907D0
     #*t127*t130*t344*t147-0.2406243757365667D-1*t32*t113
      v2rhoa2(i) = t383+t444
      t449 = t6*t82
      t461 = sigma*t369
      t478 = t26*t21
      v2rhoasigmaaa(i) = 0.1636889428023419D-1*t77*t15
     #-0.4092223570058548D-2*t78*t194+0.6138335355087822D-2*t449*t96
     #-0.3069167677543911D-2*t7*t289*t96*t193+0.1534583838771956D-2*t7
     #*t82*(-0.169333389105871D0*t187*t77*t11-0.640040104153578D0*t88
     #*t93+0.3386667782117419D0*t461*t310)+0.2521579288667932D-2*t405
     #/t305*t108+0.2394935517577326D-2*t101*t430*t108
     #-0.1741771285510783D-1*t102*t422*t49-0.9023414090121251D-2*t478
     #*t107-0.2797313528896822D-3*t102*t430*t122*t49
     #-0.289835049195133D-3*t26*t88*t418-0.8403528235015034D-1*t102
     #*t198*t149-0.8707057661744533D-1*t203*t36*t180
     #-0.2066404913406247D-2*t321*t461+0.1049801229034969D0*t154*t88
     #-0.3936754608881135D-1*t324*t21
      t502 = t193**2
      t526 = t101*t105
      v2sigmaaa2(i) = 0.2455334142035129D-1*t449*t193
     #-0.6138335355087822D-2*t7*t289*t502+0.3069167677543911D-2*t7*t82
     #*(-0.1270000418294032D0/t8/sigma*t6*t11+0.1600100260383945D0
     #/sigma*t21*t93-0.2540000836588064D0*t430*t310)
     #-0.3782368933001897D-2*t405/t367*t36*t49-0.5225313856532348D-2
     #*t526*t107+0.3099607370109371D-2*t321*t430
      v2taua2(i) = 0.D0
      v2rhoataua(i) = -0.3483542571021566D-2*t526*t108
     #+0.7218731272097001D-2*t204+0.579670098390266D-3*t478*t418
     #+0.1741411532348907D0*t208*t36*t180
      v2sigmaaataua(i) = 0.2612656928266174D-2*t101*t198*t107
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      vtaua(i) = 0.0d0
      v2rhoataua(i) = 0.0d0
      v2taua2(i) = 0.0d0
      v2sigmaaataua(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end

c:XC_BB1Ksubrend
_ENDIF
_IF(ccpdft,all,xc_edf1)
c:XC_EDF1subrstart

c    Generated: Wed Jul 23 17:14:37 GMT 2003

      subroutine uks_xc_edf1
     & (ideriv,npt,rhoa1,rhob1,sigmaaa1,sigmabb1,sigmaab1,
     &  zk,vrhoa,vrhob,vsigmaaa,vsigmabb,vsigmaab,
     &  v2rhoa2,v2rhob2,v2rhoab,
     &  v2rhoasigmaaa,v2rhoasigmaab,v2rhoasigmabb,
     &  v2rhobsigmabb,v2rhobsigmaab,v2rhobsigmaaa,
     &  v2sigmaaa2,v2sigmaaaab,v2sigmaaabb,
     &  v2sigmaab2,v2sigmaabbb,v2sigmabb2)
c
c     R.D. Adamson, P.M.W. Gill, and J.A. Pople
c     Empirical density functionals
c     Chem. Phys. Lett. 284 (1998) 6-11
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt),rhob1(npt)
      REAL sigmaaa1(npt),sigmabb1(npt),sigmaab1(npt)
      REAL zk(npt),vrhoa(npt),vrhob(npt)
      REAL vsigmaaa(npt),vsigmabb(npt),vsigmaab(npt)
      REAL v2rhoa2(npt),v2rhob2(npt),v2rhoab(npt)
      REAL v2rhoasigmaaa(npt),v2rhoasigmaab(npt)
      REAL v2rhoasigmabb(npt),v2rhobsigmabb(npt)
      REAL v2rhobsigmaab(npt),v2rhobsigmaaa(npt)
      REAL v2sigmaaa2(npt),v2sigmaaaab(npt),v2sigmaaabb(npt)
      REAL v2sigmaab2(npt),v2sigmaabbb(npt),v2sigmabb2(npt)
      parameter(tol=1.0d-20)
      
      if (ideriv.eq.0) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**2
      t3 = rhob**(1.D0/3.D0)
      t4 = t3**2
      t7 = sigmabb/t4/t2
      t8 = dsqrt(sigmabb)
      t9 = t3*rhob
      t11 = t8/t9
      t12 = dlog(t11+dsqrt(1+t11**2))
      t13 = t11*t12
      zk(i) = (-0.9593273689405774D0-0.3640595D-1*t7/(1.D0+0.21D-1*t13
     #)+0.35481306D-1*t7/(1.D0+0.252D-1*t13))*t9
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**2
      t3 = rhoa**(1.D0/3.D0)
      t4 = t3**2
      t7 = sigmaaa/t4/t2
      t8 = dsqrt(sigmaaa)
      t9 = t3*rhoa
      t11 = t8/t9
      t12 = dlog(t11+dsqrt(1+t11**2))
      t13 = t11*t12
      zk(i) = (-0.9593273689405774D0-0.3640595D-1*t7/(1.D0+0.21D-1*t13
     #)+0.35481306D-1*t7/(1.D0+0.252D-1*t13))*t9
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**2
      t5 = rhoa**(1.D0/3.D0)
      t6 = t5**2
      t7 = t6*t4
      t9 = sigmaaa/t7
      t10 = dsqrt(sigmaaa)
      t11 = t5*rhoa
      t13 = t10/t11
      t14 = dlog(t13+dsqrt(1+t13**2))
      t15 = t13*t14
      t28 = rhob**2
      t29 = rhob**(1.D0/3.D0)
      t30 = t29**2
      t31 = t30*t28
      t33 = sigmabb/t31
      t34 = dsqrt(sigmabb)
      t35 = t29*rhob
      t37 = t34/t35
      t38 = dlog(t37+dsqrt(1+t37**2))
      t39 = t37*t38
      t52 = rho**(1.D0/3.D0)
      t53 = 1/t52
      t56 = 1/(1.D0+0.3505D0*t53)
      t58 = 1/rho
      t59 = rhob*t58
      t62 = 0.25D0*t53
      t63 = dexp(-t62)
      t65 = rho**2
      t67 = t52**2
      t74 = t53*t56
      t96 = 0.6666666666666667D0*t65
      zk(i) = (-0.9593273689405774D0-0.3640595D-1*t9/(1.D0+0.21D-1*t15
     #)+0.35481306D-1*t9/(1.D0+0.252D-1*t15))*t11+(
     #-0.9593273689405774D0-0.3640595D-1*t33/(1.D0+0.21D-1*t39)
     #+0.35481306D-1*t33/(1.D0+0.252D-1*t39))*t35-0.22D0*t56*rhoa*t59
     #-0.869D-2*t63*t56/t67/t65/rho*(rhoa*rhob*(0.3646239897876478D2
     #*t7+0.3646239897876478D2*t31+(0.2611111111111111D1
     #-0.9722222222222222D-1*t53-0.1363055555555556D0*t74)*sigma-1.D0*
     #(0.25D1-0.1388888888888889D-1*t53-0.1947222222222222D-1*t74)*
     #(sigmaaa+sigmabb)-0.1111111111111111D0*(t62+0.3505D0*t74-11.D0)*
     #(rhoa*t58*sigmaaa+t59*sigmabb))-0.6666666666666667D0*t65*sigma+
     #(t96-1.D0*t4)*sigmabb+(t96-1.D0*t28)*sigmaaa)
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**2
      t3 = rhob**(1.D0/3.D0)
      t4 = t3**2
      t6 = 1/t4/t2
      t7 = sigmabb*t6
      t8 = dsqrt(sigmabb)
      t9 = t3*rhob
      t10 = 1/t9
      t11 = t8*t10
      t12 = dlog(t11+dsqrt(1+t11**2))
      t13 = t11*t12
      t15 = 1.D0+0.21D-1*t13
      t16 = 1/t15
      t20 = 1.D0+0.252D-1*t13
      t21 = 1/t20
      t24 = -0.9593273689405774D0-0.3640595D-1*t7*t16+0.35481306D-1*t7
     #*t21
      zk(i) = t24*t9
      vrhoa(i) = 0.D0
      t28 = sigmabb/t4/t2/rhob
      t31 = t15**2
      t32 = 1/t31
      t36 = t8/t3/t2*t12
      t39 = dsqrt(1.D0+t7)
      t40 = 1/t39
      t41 = t28*t40
      t49 = t20**2
      t50 = 1/t49
      vrhob(i) = (0.9708253333333333D-1*t28*t16+0.3640595D-1*t7*t32*(
     #-0.28D-1*t36-0.28D-1*t41)-0.94616816D-1*t28*t21-0.35481306D-1*t7
     #*t50*(-0.336D-1*t36-0.336D-1*t41))*t9+0.1333333333333333D1*t24*t3
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      t65 = 1/t8*t10*t12
      t67 = t6*t40
      vsigmabb(i) = (-0.3640595D-1*t6*t16+0.3640595D-1*t7*t32*
     #(0.105D-1*t65+0.105D-1*t67)+0.35481306D-1*t6*t21-0.35481306D-1
     #*t7*t50*(0.126D-1*t65+0.126D-1*t67))*t9
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**2
      t3 = rhoa**(1.D0/3.D0)
      t4 = t3**2
      t6 = 1/t4/t2
      t7 = sigmaaa*t6
      t8 = dsqrt(sigmaaa)
      t9 = t3*rhoa
      t10 = 1/t9
      t11 = t8*t10
      t12 = dlog(t11+dsqrt(1+t11**2))
      t13 = t11*t12
      t15 = 1.D0+0.21D-1*t13
      t16 = 1/t15
      t20 = 1.D0+0.252D-1*t13
      t21 = 1/t20
      t24 = -0.9593273689405774D0-0.3640595D-1*t7*t16+0.35481306D-1*t7
     #*t21
      zk(i) = t24*t9
      t28 = sigmaaa/t4/t2/rhoa
      t31 = t15**2
      t32 = 1/t31
      t36 = t8/t3/t2*t12
      t39 = dsqrt(1.D0+t7)
      t40 = 1/t39
      t41 = t28*t40
      t49 = t20**2
      t50 = 1/t49
      vrhoa(i) = (0.9708253333333333D-1*t28*t16+0.3640595D-1*t7*t32*(
     #-0.28D-1*t36-0.28D-1*t41)-0.94616816D-1*t28*t21-0.35481306D-1*t7
     #*t50*(-0.336D-1*t36-0.336D-1*t41))*t9+0.1333333333333333D1*t24*t3
      vrhob(i) = 0.D0
      t65 = 1/t8*t10*t12
      t67 = t6*t40
      vsigmaaa(i) = (-0.3640595D-1*t6*t16+0.3640595D-1*t7*t32*
     #(0.105D-1*t65+0.105D-1*t67)+0.35481306D-1*t6*t21-0.35481306D-1
     #*t7*t50*(0.126D-1*t65+0.126D-1*t67))*t9
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**2
      t5 = rhoa**(1.D0/3.D0)
      t6 = t5**2
      t7 = t6*t4
      t8 = 1/t7
      t9 = sigmaaa*t8
      t10 = dsqrt(sigmaaa)
      t11 = t5*rhoa
      t12 = 1/t11
      t13 = t10*t12
      t14 = dlog(t13+dsqrt(1+t13**2))
      t15 = t13*t14
      t17 = 1.D0+0.21D-1*t15
      t18 = 1/t17
      t22 = 1.D0+0.252D-1*t15
      t23 = 1/t22
      t26 = -0.9593273689405774D0-0.3640595D-1*t9*t18+0.35481306D-1*t9
     #*t23
      t28 = rhob**2
      t29 = rhob**(1.D0/3.D0)
      t30 = t29**2
      t31 = t30*t28
      t32 = 1/t31
      t33 = sigmabb*t32
      t34 = dsqrt(sigmabb)
      t35 = t29*rhob
      t36 = 1/t35
      t37 = t34*t36
      t38 = dlog(t37+dsqrt(1+t37**2))
      t39 = t37*t38
      t41 = 1.D0+0.21D-1*t39
      t42 = 1/t41
      t46 = 1.D0+0.252D-1*t39
      t47 = 1/t46
      t50 = -0.9593273689405774D0-0.3640595D-1*t33*t42+0.35481306D-1
     #*t33*t47
      t52 = rho**(1.D0/3.D0)
      t53 = 1/t52
      t55 = 1.D0+0.3505D0*t53
      t56 = 1/t55
      t57 = t56*rhoa
      t58 = 1/rho
      t59 = rhob*t58
      t62 = 0.25D0*t53
      t63 = dexp(-t62)
      t64 = t63*t56
      t65 = rho**2
      t67 = t52**2
      t69 = 1/t67/t65/rho
      t70 = rhoa*rhob
      t74 = t53*t56
      t76 = 0.2611111111111111D1-0.9722222222222222D-1*t53
     #-0.1363055555555556D0*t74
      t81 = sigmaaa+sigmabb
      t85 = t62+0.3505D0*t74-11.D0
      t89 = rhoa*t58*sigmaaa+t59*sigmabb
      t92 = 0.3646239897876478D2*t7+0.3646239897876478D2*t31+t76*sigma
     #-1.D0*(0.25D1-0.1388888888888889D-1*t53-0.1947222222222222D-1
     #*t74)*t81-0.1111111111111111D0*t85*t89
      t96 = 0.6666666666666667D0*t65
      t97 = 1.D0*t4
      t100 = 1.D0*t28
      t103 = t70*t92-0.6666666666666667D0*t65*sigma+(t96-t97)*sigmabb+
     #(t96-t100)*sigmaaa
      zk(i) = t26*t11+t50*t35-0.22D0*t57*t59-0.869D-2*t64*t69*t103
      t110 = sigmaaa/t6/t4/rhoa
      t113 = t17**2
      t114 = 1/t113
      t118 = t10/t5/t4*t14
      t121 = dsqrt(1.D0+t9)
      t122 = 1/t121
      t123 = t110*t122
      t131 = t22**2
      t132 = 1/t131
      t149 = t85*t58
      t160 = t55**2
      t161 = 1/t160
      t167 = 0.2570333333333333D-1*t161*rhoa*rhob/t52/t65
      t168 = 1/t65
      t169 = rhob*t168
      t171 = 0.22D0*t57*t169
      t172 = t65**2
      t174 = 1/t172/rho
      t178 = 0.7241666666666667D-3*t174*t63*t56*t103
      t182 = 0.1015281666666667D-2*t63*t161*t174*t103
      t187 = 0.3186333333333333D-1*t64/t67/t172*t103
      t189 = 1/t52/rho
      t191 = t189*t56
      t195 = 1/t67/rho*t161
      t230 = 0.869D-2*t64*t69*(t70*((0.3240740740740741D-1*t189
     #+0.4543518518518519D-1*t191-0.1592503240740741D-1*t195)*sigma
     #-1.D0*(0.462962962962963D-2*t189+0.6490740740740741D-2*t191
     #-0.227500462962963D-2*t195)*t81-0.1111111111111111D0*(
     #-0.8333333333333333D-1*t189-0.1168333333333333D0*t191
     #+0.4095008333333333D-1*t195)*t89-0.1111111111111111D0*t85*(-1.D0
     #*rhoa*t168*sigmaaa-1.D0*t169*sigmabb))-0.1333333333333333D1*rho
     #*sigma+0.1333333333333333D1*rho*sigmabb+0.1333333333333333D1*rho
     #*sigmaaa)
      vrhoa(i) = (0.9708253333333333D-1*t110*t18+0.3640595D-1*t9*t114*
     #(-0.28D-1*t118-0.28D-1*t123)-0.94616816D-1*t110*t23
     #-0.35481306D-1*t9*t132*(-0.336D-1*t118-0.336D-1*t123))*t11
     #+0.1333333333333333D1*t26*t5-0.22D0*t56*rhob*t58-0.869D-2*t64
     #*t69*(rhob*t92+t70*(0.9723306394337274D2*t6*rhoa
     #-0.1111111111111111D0*t149*sigmaaa)-2.D0*rhoa*sigmabb)-t167+t171
     #-t178-t182+t187-t230
      t234 = sigmabb/t30/t28/rhob
      t237 = t41**2
      t238 = 1/t237
      t242 = t34/t29/t28*t38
      t245 = dsqrt(1.D0+t33)
      t246 = 1/t245
      t247 = t234*t246
      t255 = t46**2
      t256 = 1/t255
      vrhob(i) = (0.9708253333333333D-1*t234*t42+0.3640595D-1*t33*t238
     #*(-0.28D-1*t242-0.28D-1*t247)-0.94616816D-1*t234*t47
     #-0.35481306D-1*t33*t256*(-0.336D-1*t242-0.336D-1*t247))*t35
     #+0.1333333333333333D1*t50*t29-0.22D0*t57*t58-0.869D-2*t64*t69*
     #(rhoa*t92+t70*(0.9723306394337274D2*t30*rhob
     #-0.1111111111111111D0*t149*sigmabb)-2.D0*rhob*sigmaaa)-t167+t171
     #-t178-t182+t187-t230
      t286 = 1/t10*t12*t14
      t288 = t8*t122
      t304 = 0.1388888888888889D-1*t53
      t305 = 0.1947222222222222D-1*t74
      t319 = t64*t69*(t70*t76-0.6666666666666667D0*t65)
      t320 = 0.869D-2*t319
      vsigmaaa(i) = (-0.3640595D-1*t8*t18+0.3640595D-1*t9*t114*
     #(0.105D-1*t286+0.105D-1*t288)+0.35481306D-1*t8*t23-0.35481306D-1
     #*t9*t132*(0.126D-1*t286+0.126D-1*t288))*t11-0.869D-2*t64*t69*
     #(t70*(-0.25D1+t304+t305-0.1111111111111111D0*t85*rhoa*t58)+t96
     #-t100)-t320
      vsigmaab(i) = -0.1738D-1*t319
      t326 = 1/t34*t36*t38
      t328 = t32*t246
      vsigmabb(i) = (-0.3640595D-1*t32*t42+0.3640595D-1*t33*t238*
     #(0.105D-1*t326+0.105D-1*t328)+0.35481306D-1*t32*t47
     #-0.35481306D-1*t33*t256*(0.126D-1*t326+0.126D-1*t328))*t35
     #-0.869D-2*t64*t69*(t70*(-0.25D1+t304+t305-0.1111111111111111D0
     #*t85*rhob*t58)+t96-t97)-t320
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**2
      t3 = rhob**(1.D0/3.D0)
      t4 = t3**2
      t6 = 1/t4/t2
      t7 = sigmabb*t6
      t8 = dsqrt(sigmabb)
      t9 = t3*rhob
      t10 = 1/t9
      t11 = t8*t10
      t12 = dlog(t11+dsqrt(1+t11**2))
      t13 = t11*t12
      t15 = 1.D0+0.21D-1*t13
      t16 = 1/t15
      t20 = 1.D0+0.252D-1*t13
      t21 = 1/t20
      t24 = -0.9593273689405774D0-0.3640595D-1*t7*t16+0.35481306D-1*t7
     #*t21
      zk(i) = t24*t9
      vrhoa(i) = 0.D0
      t25 = t2*rhob
      t28 = sigmabb/t4/t25
      t31 = t15**2
      t32 = 1/t31
      t36 = t8/t3/t2*t12
      t38 = 1.D0+t7
      t39 = dsqrt(t38)
      t40 = 1/t39
      t41 = t28*t40
      t43 = -0.28D-1*t36-0.28D-1*t41
      t44 = t32*t43
      t49 = t20**2
      t50 = 1/t49
      t53 = -0.336D-1*t36-0.336D-1*t41
      t54 = t50*t53
      t57 = 0.9708253333333333D-1*t28*t16+0.3640595D-1*t7*t44
     #-0.94616816D-1*t28*t21-0.35481306D-1*t7*t54
      vrhob(i) = t57*t9+0.1333333333333333D1*t24*t3
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      t65 = 1/t8*t10*t12
      t67 = t6*t40
      t69 = 0.105D-1*t65+0.105D-1*t67
      t77 = 0.126D-1*t65+0.126D-1*t67
      vsigmabb(i) = (-0.3640595D-1*t6*t16+0.3640595D-1*t7*t32*t69
     #+0.35481306D-1*t6*t21-0.35481306D-1*t7*t50*t77)*t9
      v2rhoa2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t82 = t2**2
      t85 = sigmabb/t4/t82
      t91 = 1/t31/t15
      t92 = t43**2
      t99 = t8/t3/t25*t12
      t101 = t85*t40
      t103 = sigmabb**2
      t109 = 1/t39/t38
      t110 = t103/t3/t82/t25*t109
      t121 = 1/t49/t20
      t122 = t53**2
      v2rhob2(i) = (-0.3559692888888889D0*t85*t16-0.1941650666666667D0
     #*t28*t44-0.728119D-1*t7*t91*t92+0.3640595D-1*t7*t32*
     #(0.6533333333333333D-1*t99+0.14D0*t101-0.3733333333333333D-1
     #*t110)+0.3469283253333333D0*t85*t21+0.189233632D0*t28*t54
     #+0.70962612D-1*t7*t121*t122-0.35481306D-1*t7*t50*(0.784D-1*t99
     #+0.168D0*t101-0.448D-1*t110))*t9+0.2666666666666667D1*t57*t3
     #+0.4444444444444444D0*t24/t4
      v2sigmaaa2(i) = 0.D0
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      t143 = t69**2
      t150 = 1/t8/sigmabb*t10*t12
      t154 = 1/sigmabb*t6*t40
      t159 = 1/t3/t82/rhob*t109
      t168 = t77**2
      v2sigmabb2(i) = (0.728119D-1*t6*t32*t69-0.728119D-1*t7*t91*t143
     #+0.3640595D-1*t7*t32*(-0.525D-2*t150+0.525D-2*t154-0.525D-2*t159
     #)-0.70962612D-1*t6*t50*t77+0.70962612D-1*t7*t121*t168
     #-0.35481306D-1*t7*t50*(-0.63D-2*t150+0.63D-2*t154-0.63D-2*t159))
     #*t9
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**2
      t3 = rhoa**(1.D0/3.D0)
      t4 = t3**2
      t6 = 1/t4/t2
      t7 = sigmaaa*t6
      t8 = dsqrt(sigmaaa)
      t9 = t3*rhoa
      t10 = 1/t9
      t11 = t8*t10
      t12 = dlog(t11+dsqrt(1+t11**2))
      t13 = t11*t12
      t15 = 1.D0+0.21D-1*t13
      t16 = 1/t15
      t20 = 1.D0+0.252D-1*t13
      t21 = 1/t20
      t24 = -0.9593273689405774D0-0.3640595D-1*t7*t16+0.35481306D-1*t7
     #*t21
      zk(i) = t24*t9
      t25 = t2*rhoa
      t28 = sigmaaa/t4/t25
      t31 = t15**2
      t32 = 1/t31
      t36 = t8/t3/t2*t12
      t38 = 1.D0+t7
      t39 = dsqrt(t38)
      t40 = 1/t39
      t41 = t28*t40
      t43 = -0.28D-1*t36-0.28D-1*t41
      t44 = t32*t43
      t49 = t20**2
      t50 = 1/t49
      t53 = -0.336D-1*t36-0.336D-1*t41
      t54 = t50*t53
      t57 = 0.9708253333333333D-1*t28*t16+0.3640595D-1*t7*t44
     #-0.94616816D-1*t28*t21-0.35481306D-1*t7*t54
      vrhoa(i) = t57*t9+0.1333333333333333D1*t24*t3
      vrhob(i) = 0.D0
      t65 = 1/t8*t10*t12
      t67 = t6*t40
      t69 = 0.105D-1*t65+0.105D-1*t67
      t77 = 0.126D-1*t65+0.126D-1*t67
      vsigmaaa(i) = (-0.3640595D-1*t6*t16+0.3640595D-1*t7*t32*t69
     #+0.35481306D-1*t6*t21-0.35481306D-1*t7*t50*t77)*t9
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      t82 = t2**2
      t85 = sigmaaa/t4/t82
      t91 = 1/t31/t15
      t92 = t43**2
      t99 = t8/t3/t25*t12
      t101 = t85*t40
      t103 = sigmaaa**2
      t109 = 1/t39/t38
      t110 = t103/t3/t82/t25*t109
      t121 = 1/t49/t20
      t122 = t53**2
      v2rhoa2(i) = (-0.3559692888888889D0*t85*t16-0.1941650666666667D0
     #*t28*t44-0.728119D-1*t7*t91*t92+0.3640595D-1*t7*t32*
     #(0.6533333333333333D-1*t99+0.14D0*t101-0.3733333333333333D-1
     #*t110)+0.3469283253333333D0*t85*t21+0.189233632D0*t28*t54
     #+0.70962612D-1*t7*t121*t122-0.35481306D-1*t7*t50*(0.784D-1*t99
     #+0.168D0*t101-0.448D-1*t110))*t9+0.2666666666666667D1*t57*t3
     #+0.4444444444444444D0*t24/t4
      v2rhob2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t143 = t69**2
      t150 = 1/t8/sigmaaa*t10*t12
      t154 = 1/sigmaaa*t6*t40
      t159 = 1/t3/t82/rhoa*t109
      t168 = t77**2
      v2sigmaaa2(i) = (0.728119D-1*t6*t32*t69-0.728119D-1*t7*t91*t143
     #+0.3640595D-1*t7*t32*(-0.525D-2*t150+0.525D-2*t154-0.525D-2*t159
     #)-0.70962612D-1*t6*t50*t77+0.70962612D-1*t7*t121*t168
     #-0.35481306D-1*t7*t50*(-0.63D-2*t150+0.63D-2*t154-0.63D-2*t159))
     #*t9
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      v2sigmabb2(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**2
      t5 = rhoa**(1.D0/3.D0)
      t6 = t5**2
      t7 = t6*t4
      t8 = 1/t7
      t9 = sigmaaa*t8
      t10 = dsqrt(sigmaaa)
      t11 = t5*rhoa
      t12 = 1/t11
      t13 = t10*t12
      t14 = dlog(t13+dsqrt(1+t13**2))
      t15 = t13*t14
      t17 = 1.D0+0.21D-1*t15
      t18 = 1/t17
      t22 = 1.D0+0.252D-1*t15
      t23 = 1/t22
      t26 = -0.9593273689405774D0-0.3640595D-1*t9*t18+0.35481306D-1*t9
     #*t23
      t28 = rhob**2
      t29 = rhob**(1.D0/3.D0)
      t30 = t29**2
      t31 = t30*t28
      t32 = 1/t31
      t33 = sigmabb*t32
      t34 = dsqrt(sigmabb)
      t35 = t29*rhob
      t36 = 1/t35
      t37 = t34*t36
      t38 = dlog(t37+dsqrt(1+t37**2))
      t39 = t37*t38
      t41 = 1.D0+0.21D-1*t39
      t42 = 1/t41
      t46 = 1.D0+0.252D-1*t39
      t47 = 1/t46
      t50 = -0.9593273689405774D0-0.3640595D-1*t33*t42+0.35481306D-1
     #*t33*t47
      t52 = rho**(1.D0/3.D0)
      t53 = 1/t52
      t55 = 1.D0+0.3505D0*t53
      t56 = 1/t55
      t57 = t56*rhoa
      t58 = 1/rho
      t59 = rhob*t58
      t62 = 0.25D0*t53
      t63 = dexp(-t62)
      t64 = t63*t56
      t65 = rho**2
      t66 = t65*rho
      t67 = t52**2
      t69 = 1/t67/t66
      t70 = rhoa*rhob
      t71 = 0.3646239897876478D2*t7
      t72 = 0.3646239897876478D2*t31
      t74 = t53*t56
      t76 = 0.2611111111111111D1-0.9722222222222222D-1*t53
     #-0.1363055555555556D0*t74
      t77 = t76*sigma
      t81 = sigmaaa+sigmabb
      t83 = 1.D0*(0.25D1-0.1388888888888889D-1*t53
     #-0.1947222222222222D-1*t74)*t81
      t85 = t62+0.3505D0*t74-11.D0
      t89 = rhoa*t58*sigmaaa+t59*sigmabb
      t91 = 0.1111111111111111D0*t85*t89
      t92 = t71+t72+t77-t83-t91
      t96 = 0.6666666666666667D0*t65
      t97 = 1.D0*t4
      t100 = 1.D0*t28
      t103 = t70*t92-0.6666666666666667D0*t65*sigma+(t96-t97)*sigmabb+
     #(t96-t100)*sigmaaa
      zk(i) = t26*t11+t50*t35-0.22D0*t57*t59-0.869D-2*t64*t69*t103
      t107 = t4*rhoa
      t109 = 1/t6/t107
      t110 = sigmaaa*t109
      t113 = t17**2
      t114 = 1/t113
      t116 = 1/t5/t4
      t118 = t10*t116*t14
      t120 = 1.D0+t9
      t121 = dsqrt(t120)
      t122 = 1/t121
      t123 = t110*t122
      t125 = -0.28D-1*t118-0.28D-1*t123
      t126 = t114*t125
      t131 = t22**2
      t132 = 1/t131
      t135 = -0.336D-1*t118-0.336D-1*t123
      t136 = t132*t135
      t139 = 0.9708253333333333D-1*t110*t18+0.3640595D-1*t9*t126
     #-0.94616816D-1*t110*t23-0.35481306D-1*t9*t136
      t143 = t56*rhob
      t147 = t6*rhoa
      t149 = t85*t58
      t152 = 0.9723306394337274D2*t147-0.1111111111111111D0*t149*sigmaaa
      t156 = rhob*t92+t70*t152-2.D0*rhoa*sigmabb
      t160 = t55**2
      t161 = 1/t160
      t162 = t161*rhoa
      t164 = 1/t52/t65
      t167 = 0.2570333333333333D-1*t162*rhob*t164
      t168 = 1/t65
      t169 = rhob*t168
      t171 = 0.22D0*t57*t169
      t172 = t65**2
      t173 = t172*rho
      t174 = 1/t173
      t175 = t174*t63
      t176 = t56*t103
      t178 = 0.7241666666666667D-3*t175*t176
      t179 = t63*t161
      t182 = 0.1015281666666667D-2*t179*t174*t103
      t184 = 1/t67/t172
      t187 = 0.3186333333333333D-1*t64*t184*t103
      t189 = 1/t52/rho
      t191 = t189*t56
      t195 = 1/t67/rho*t161
      t197 = 0.3240740740740741D-1*t189+0.4543518518518519D-1*t191
     #-0.1592503240740741D-1*t195
      t208 = -0.8333333333333333D-1*t189-0.1168333333333333D0*t191
     #+0.4095008333333333D-1*t195
      t216 = -1.D0*rhoa*t168*sigmaaa-1.D0*t169*sigmabb
      t219 = t197*sigma-1.D0*(0.462962962962963D-2*t189
     #+0.6490740740740741D-2*t191-0.227500462962963D-2*t195)*t81
     #-0.1111111111111111D0*t208*t89-0.1111111111111111D0*t85*t216
      t227 = t70*t219-0.1333333333333333D1*rho*sigma
     #+0.1333333333333333D1*rho*sigmabb+0.1333333333333333D1*rho*sigmaaa
      t230 = 0.869D-2*t64*t69*t227
      vrhoa(i) = t139*t11+0.1333333333333333D1*t26*t5-0.22D0*t143*t58
     #-0.869D-2*t64*t69*t156-t167+t171-t178-t182+t187-t230
      t231 = t28*rhob
      t233 = 1/t30/t231
      t234 = sigmabb*t233
      t237 = t41**2
      t238 = 1/t237
      t240 = 1/t29/t28
      t242 = t34*t240*t38
      t244 = 1.D0+t33
      t245 = dsqrt(t244)
      t246 = 1/t245
      t247 = t234*t246
      t249 = -0.28D-1*t242-0.28D-1*t247
      t250 = t238*t249
      t255 = t46**2
      t256 = 1/t255
      t259 = -0.336D-1*t242-0.336D-1*t247
      t260 = t256*t259
      t263 = 0.9708253333333333D-1*t234*t42+0.3640595D-1*t33*t250
     #-0.94616816D-1*t234*t47-0.35481306D-1*t33*t260
      t270 = t30*rhob
      t274 = 0.9723306394337274D2*t270-0.1111111111111111D0*t149*sigmabb
      t278 = rhoa*t92+t70*t274-2.D0*rhob*sigmaaa
      vrhob(i) = t263*t35+0.1333333333333333D1*t50*t29-0.22D0*t57*t58
     #-0.869D-2*t64*t69*t278-t167+t171-t178-t182+t187-t230
      t284 = 1/t10
      t286 = t284*t12*t14
      t288 = t8*t122
      t290 = 0.105D-1*t286+0.105D-1*t288
      t291 = t114*t290
      t298 = 0.126D-1*t286+0.126D-1*t288
      t299 = t132*t298
      t302 = -0.3640595D-1*t8*t18+0.3640595D-1*t9*t291+0.35481306D-1
     #*t8*t23-0.35481306D-1*t9*t299
      t304 = 0.1388888888888889D-1*t53
      t305 = 0.1947222222222222D-1*t74
      t306 = t85*rhoa
      t309 = -0.25D1+t304+t305-0.1111111111111111D0*t306*t58
      t311 = t70*t309+t96-t100
      t317 = t70*t76-0.6666666666666667D0*t65
      t319 = t64*t69*t317
      t320 = 0.869D-2*t319
      vsigmaaa(i) = t302*t11-0.869D-2*t64*t69*t311-t320
      vsigmaab(i) = -0.1738D-1*t319
      t324 = 1/t34
      t326 = t324*t36*t38
      t328 = t32*t246
      t330 = 0.105D-1*t326+0.105D-1*t328
      t331 = t238*t330
      t338 = 0.126D-1*t326+0.126D-1*t328
      t339 = t256*t338
      t342 = -0.3640595D-1*t32*t42+0.3640595D-1*t33*t331+0.35481306D-1
     #*t32*t47-0.35481306D-1*t33*t339
      t344 = t85*rhob
      t347 = -0.25D1+t304+t305-0.1111111111111111D0*t344*t58
      t349 = t70*t347+t96-t97
      vsigmabb(i) = t342*t35-0.869D-2*t64*t69*t349-t320
      t362 = t4**2
      t365 = sigmaaa/t6/t362
      t371 = 1/t113/t17
      t372 = t125**2
      t379 = t10/t5/t107*t14
      t381 = t365*t122
      t383 = sigmaaa**2
      t389 = 1/t121/t120
      t390 = t383/t5/t362/t107*t389
      t401 = 1/t131/t22
      t402 = t135**2
      t416 = 1/t160/t55
      t418 = rhob*t69
      t420 = 0.6006012222222222D-2*t416*rhoa*t418
      t423 = 0.1448333333333333D-2*t175*t56*t227
      t424 = t172*t65
      t426 = 1/t52/t424
      t427 = t426*t63
      t429 = 0.6034722222222222D-4*t427*t176
      t432 = 0.1692136111111111D-3*t427*t161*t103
      t435 = 0.2030563333333333D-2*t179*t174*t227
      t439 = 0.2372374827777778D-3*t63*t416*t426*t103
      t442 = 0.6372666666666667D-1*t64*t184*t227
      t444 = t164*t56
      t448 = 1/t67/t65*t161
      t450 = 1/t66
      t451 = t450*t416
      t474 = rhob*t450
      t488 = 0.869D-2*t64*t69*(t70*((-0.4320987654320988D-1*t164
     #-0.6058024691358025D-1*t444+0.3185006481481481D-1*t448
     #-0.3721149239197531D-2*t451)*sigma-1.D0*(-0.617283950617284D-2
     #*t164-0.8654320987654321D-2*t444+0.4550009259259259D-2*t448
     #-0.5315927484567901D-3*t451)*t81-0.1111111111111111D0*
     #(0.1111111111111111D0*t164+0.1557777777777778D0*t444
     #-0.8190016666666667D-1*t448+0.9568669472222222D-2*t451)*t89
     #-0.2222222222222222D0*t208*t216-0.1111111111111111D0*t85*(2.D0
     #*rhoa*t450*sigmaaa+2.D0*t474*sigmabb))-0.1333333333333333D1
     #*sigma+0.1333333333333333D1*sigmabb+0.1333333333333333D1*sigmaaa)
      t490 = t208*t58
      t493 = t85*t168
      t500 = t64*t69*(rhob*t219+t70*(-0.1111111111111111D0*t490
     #*sigmaaa+0.1111111111111111D0*t493*sigmaaa))
      t502 = -0.869D-2*t64*t69*(2.D0*rhob*t152+0.1620551065722879D3
     #*t147*rhob-2.D0*sigmabb)+(-0.3559692888888889D0*t365*t18
     #-0.1941650666666667D0*t110*t126-0.728119D-1*t9*t371*t372
     #+0.3640595D-1*t9*t114*(0.6533333333333333D-1*t379+0.14D0*t381
     #-0.3733333333333333D-1*t390)+0.3469283253333333D0*t365*t23
     #+0.189233632D0*t110*t136+0.70962612D-1*t9*t401*t402
     #-0.35481306D-1*t9*t132*(0.784D-1*t379+0.168D0*t381-0.448D-1*t390
     #))*t11-t420-t423-t429-t432-t435-t439+t442-t488-0.1738D-1*t500
      t504 = t179*t174*t156
      t507 = t64*t184*t156
      t510 = t161*rhob*t164
      t512 = t143*t168
      t515 = t175*t56*t156
      t522 = 1/t424
      t525 = 0.8799107777777778D-2*t179*t522*t103
      t527 = 0.44D0*t57*t474
      t530 = 0.6276111111111111D-2*t522*t63*t176
      t535 = 0.8567777777777778D-1*t162*rhob/t52/t66
      t540 = 0.1486955555555556D0*t64/t67/t173*t103
      t541 = -0.2030563333333333D-2*t504+0.6372666666666667D-1*t507
     #-0.5140666666666667D-1*t510+0.44D0*t512-0.1448333333333333D-2
     #*t515+0.2666666666666667D1*t139*t5+0.4444444444444444D0*t26/t6
     #+t525-t527+t530+t535-t540
      v2rhoa2(i) = t502+t541
      t542 = -t420-t423-t429-t432-t435-t439+t442-t488+t525-t527+t530
      t557 = t162*t164
      t559 = t57*t168
      t562 = t175*t56*t278
      t565 = t179*t174*t278
      t567 = t28**2
      t570 = sigmabb/t30/t567
      t576 = 1/t237/t41
      t577 = t249**2
      t584 = t34/t29/t231*t38
      t586 = t570*t246
      t588 = sigmabb**2
      t594 = 1/t245/t244
      t595 = t588/t29/t567/t231*t594
      t606 = 1/t255/t46
      t607 = t259**2
      t621 = t64*t184*t278
      t632 = t64*t69*(rhoa*t219+t70*(-0.1111111111111111D0*t490
     #*sigmabb+0.1111111111111111D0*t493*sigmabb))
      t634 = t535+0.2666666666666667D1*t263*t29+0.4444444444444444D0
     #*t50/t30-0.869D-2*t64*t69*(2.D0*rhoa*t274+0.1620551065722879D3
     #*rhoa*t270-2.D0*sigmaaa)-0.5140666666666667D-1*t557+0.44D0*t559
     #-0.1448333333333333D-2*t562-0.2030563333333333D-2*t565+(
     #-0.3559692888888889D0*t570*t42-0.1941650666666667D0*t234*t250
     #-0.728119D-1*t33*t576*t577+0.3640595D-1*t33*t238*
     #(0.6533333333333333D-1*t584+0.14D0*t586-0.3733333333333333D-1
     #*t595)+0.3469283253333333D0*t570*t47+0.189233632D0*t234*t260
     #+0.70962612D-1*t33*t606*t607-0.35481306D-1*t33*t256*(0.784D-1
     #*t584+0.168D0*t586-0.448D-1*t595))*t35-t540
     #+0.6372666666666667D-1*t621-0.1738D-1*t632
      v2rhob2(i) = t542+t634
      t640 = -t420-t423-t435-t439+t442-t429-t432-t488-0.869D-2*t500
     #-0.1015281666666667D-2*t504+0.3186333333333333D-1*t507
     #-0.7241666666666667D-3*t515-0.2570333333333333D-1*t510
      t656 = 0.22D0*t512+t525-t527+t530+t535-t540
     #-0.2570333333333333D-1*t557+0.22D0*t559-0.7241666666666667D-3
     #*t562-0.1015281666666667D-2*t565+0.3186333333333333D-1*t621
     #-0.869D-2*t632-0.869D-2*t64*t69*(t71+t72+t77-t83-t91+rhob*t274
     #+rhoa*t152)-0.22D0*t56*t58
      v2rhoab(i) = t640+t656
      t661 = t8*t114
      t669 = t284*t116*t14
      t671 = t109*t122
      t677 = sigmaaa/t5/t362/t4*t389
      t687 = t8*t132
      t707 = 0.1111111111111111D0*t70*t149
      t714 = 0.7241666666666667D-3*t175*t56*t311
      t717 = 0.1015281666666667D-2*t179*t174*t311
      t720 = 0.3186333333333333D-1*t64*t184*t311
      t721 = 0.462962962962963D-2*t189
      t722 = 0.6490740740740741D-2*t191
      t723 = 0.227500462962963D-2*t195
      t731 = 0.1333333333333333D1*rho
      t735 = 0.869D-2*t64*t69*(t70*(-t721-t722+t723
     #-0.1111111111111111D0*t208*rhoa*t58+0.1111111111111111D0*t306
     #*t168)+t731)
      t737 = t64*t418*t76
      t738 = 0.869D-2*t737
      t740 = t175*t56*t317
      t741 = 0.7241666666666667D-3*t740
      t743 = t179*t174*t317
      t744 = 0.1015281666666667D-2*t743
      t746 = t64*t184*t317
      t747 = 0.3186333333333333D-1*t746
      t752 = t64*t69*(t70*t197-0.1333333333333333D1*rho)
      t753 = 0.869D-2*t752
      v2rhoasigmaaa(i) = (0.9708253333333333D-1*t109*t18
     #-0.9708253333333333D-1*t110*t291+0.3640595D-1*t661*t125
     #-0.728119D-1*t9*t371*t125*t290+0.3640595D-1*t9*t114*(-0.14D-1
     #*t669-0.42D-1*t671+0.14D-1*t677)-0.94616816D-1*t109*t23
     #+0.94616816D-1*t110*t299-0.35481306D-1*t687*t135+0.70962612D-1
     #*t9*t401*t135*t298-0.35481306D-1*t9*t132*(-0.168D-1*t669
     #-0.504D-1*t671+0.168D-1*t677))*t11+0.1333333333333333D1*t302*t5
     #-0.869D-2*t64*t69*(rhob*t309-t707)-t714-t717+t720-t735-t738-t741
     #-t744+t747-t753
      t755 = 0.1448333333333333D-2*t740
      t756 = 0.2030563333333333D-2*t743
      t757 = 0.6372666666666667D-1*t746
      t758 = 0.1738D-1*t752
      v2rhoasigmaab(i) = -0.1738D-1*t737-t755-t756+t757-t758
      t767 = 0.7241666666666667D-3*t175*t56*t349
      t770 = 0.1015281666666667D-2*t179*t174*t349
      t773 = 0.3186333333333333D-1*t64*t184*t349
      t784 = 0.869D-2*t64*t69*(t70*(-t721-t722+t723
     #-0.1111111111111111D0*t208*rhob*t58+0.1111111111111111D0*t344
     #*t168)+t731)
      v2rhoasigmabb(i) = -0.869D-2*t64*t69*(rhob*t347-2.D0*rhoa)-t767
     #-t770+t773-t784-t738-t741-t744+t747-t753
      t793 = t64*t69*rhoa*t76
      t794 = 0.869D-2*t793
      v2rhobsigmaaa(i) = -0.869D-2*t64*t69*(rhoa*t309-2.D0*rhob)-t714
     #-t717+t720-t735-t794-t741-t744+t747-t753
      v2rhobsigmaab(i) = -0.1738D-1*t793-t755-t756+t757-t758
      t800 = t32*t238
      t808 = t324*t240*t38
      t810 = t233*t246
      t816 = sigmabb/t29/t567/t28*t594
      t826 = t32*t256
      v2rhobsigmabb(i) = (0.9708253333333333D-1*t233*t42
     #-0.9708253333333333D-1*t234*t331+0.3640595D-1*t800*t249
     #-0.728119D-1*t33*t576*t249*t330+0.3640595D-1*t33*t238*(-0.14D-1
     #*t808-0.42D-1*t810+0.14D-1*t816)-0.94616816D-1*t233*t47
     #+0.94616816D-1*t234*t339-0.35481306D-1*t826*t259+0.70962612D-1
     #*t33*t606*t259*t338-0.35481306D-1*t33*t256*(-0.168D-1*t808
     #-0.504D-1*t810+0.168D-1*t816))*t35+0.1333333333333333D1*t342*t29
     #-0.869D-2*t64*t69*(rhoa*t347-t707)-t767-t770+t773-t784-t794-t741
     #-t744+t747-t753
      t851 = t290**2
      t858 = 1/t10/sigmaaa*t12*t14
      t862 = 1/sigmaaa*t8*t122
      t867 = 1/t5/t362/rhoa*t389
      t875 = t298**2
      v2sigmaaa2(i) = (0.728119D-1*t661*t290-0.728119D-1*t9*t371*t851
     #+0.3640595D-1*t9*t114*(-0.525D-2*t858+0.525D-2*t862-0.525D-2
     #*t867)-0.70962612D-1*t687*t298+0.70962612D-1*t9*t401*t875
     #-0.35481306D-1*t9*t132*(-0.63D-2*t858+0.63D-2*t862-0.63D-2*t867)
     #)*t11
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      t889 = t330**2
      t896 = 1/t34/sigmabb*t36*t38
      t900 = 1/sigmabb*t32*t246
      t905 = 1/t29/t567/rhob*t594
      t913 = t338**2
      v2sigmabb2(i) = (0.728119D-1*t800*t330-0.728119D-1*t33*t576*t889
     #+0.3640595D-1*t33*t238*(-0.525D-2*t896+0.525D-2*t900-0.525D-2
     #*t905)-0.70962612D-1*t826*t338+0.70962612D-1*t33*t606*t913
     #-0.35481306D-1*t33*t256*(-0.63D-2*t896+0.63D-2*t900-0.63D-2*t905
     #))*t35
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      v2rhob2(i) = 0.0d0
      v2rhoab(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2rhoasigmaab(i) = 0.0d0
      v2rhoasigmabb(i) = 0.0d0
      v2rhobsigmaaa(i) = 0.0d0
      v2rhobsigmaab(i) = 0.0d0
      v2rhobsigmabb(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      v2sigmaab2(i) = 0.0d0
      v2sigmabb2(i) = 0.0d0
      v2sigmaaaab(i) = 0.0d0
      v2sigmaaabb(i) = 0.0d0
      v2sigmaabbb(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end
      
      
      subroutine rks_xc_edf1
     & (ideriv,npt,rhoa1,sigmaaa1,
     &  zk,vrhoa,vsigmaaa,
     &  v2rhoa2,v2rhoasigmaaa,v2sigmaaa2)
c
c     R.D. Adamson, P.M.W. Gill, and J.A. Pople
c     Empirical density functionals
c     Chem. Phys. Lett. 284 (1998) 6-11
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt)
      REAL sigmaaa1(npt)
      REAL zk(npt),vrhoa(npt),vsigmaaa(npt)
      REAL v2rhoa2(npt),v2rhoasigmaaa(npt),v2sigmaaa2(npt)
      parameter(tol=1.0d-20)
      
      if(ideriv.eq.0) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**2
      t3 = rho**(1.D0/3.D0)
      t4 = t3**2
      t5 = t4*t2
      t7 = sigma/t5
      t8 = dsqrt(sigma)
      t9 = t3*rho
      t11 = t8/t9
      t13 = dlog(0.1259921049894873D1*t11+dsqrt(1+0.1587401051968199D1
     #*t11**2))
      t14 = t11*t13
      t28 = 1/t3
      t31 = 1/(1.D0+0.3505D0*t28)
      t34 = 0.25D0*t28
      t35 = dexp(-t34)
      t42 = t28*t31
      zk(i) = 0.7937005259840997D0*(-0.9593273689405774D0
     #-0.5779084332790167D-1*t7/(1.D0+0.2645834204779234D-1*t14)
     #+0.5632306246960559D-1*t7/(1.D0+0.317500104573508D-1*t14))*t9
     #-0.55D-1*t31*rho-0.869D-2*t35*t31/t4/t2/rho*(0.25D0*t2*
     #(0.1148493600075277D2*t5+(0.2611111111111111D1
     #-0.9722222222222222D-1*t28-0.1363055555555556D0*t42)*sigma-0.5D0
     #*(0.25D1-0.1388888888888889D-1*t28-0.1947222222222222D-1*t42)
     #*sigma-0.2777777777777778D-1*(t34+0.3505D0*t42-11.D0)*sigma)
     #-0.4583333333333333D0*t2*sigma)
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**2
      t3 = rho**(1.D0/3.D0)
      t4 = t3**2
      t5 = t4*t2
      t6 = 1/t5
      t7 = sigma*t6
      t8 = dsqrt(sigma)
      t9 = t3*rho
      t10 = 1/t9
      t11 = t8*t10
      t13 = dlog(0.1259921049894873D1*t11+dsqrt(1+0.1587401051968199D1
     #*t11**2))
      t14 = t11*t13
      t16 = 1.D0+0.2645834204779234D-1*t14
      t17 = 1/t16
      t21 = 1.D0+0.317500104573508D-1*t14
      t22 = 1/t21
      t25 = -0.9593273689405774D0-0.5779084332790167D-1*t7*t17
     #+0.5632306246960559D-1*t7*t22
      t28 = 1/t3
      t30 = 1.D0+0.3505D0*t28
      t31 = 1/t30
      t34 = 0.25D0*t28
      t35 = dexp(-t34)
      t36 = t35*t31
      t39 = 1/t4/t2/rho
      t42 = t28*t31
      t44 = 0.2611111111111111D1-0.9722222222222222D-1*t28
     #-0.1363055555555556D0*t42
      t52 = t34+0.3505D0*t42-11.D0
      t55 = 0.1148493600075277D2*t5+t44*sigma-0.5D0*(0.25D1
     #-0.1388888888888889D-1*t28-0.1947222222222222D-1*t42)*sigma
     #-0.2777777777777778D-1*t52*sigma
      t60 = 0.25D0*t2*t55-0.4583333333333333D0*t2*sigma
      zk(i) = 0.7937005259840997D0*t25*t9-0.55D-1*t31*rho-0.869D-2*t36
     #*t39*t60
      t64 = sigma*t39
      t67 = t16**2
      t68 = 1/t67
      t72 = t8/t3/t2*t13
      t76 = dsqrt(1.D0+0.1587401051968199D1*t7)
      t77 = 1/t76
      t78 = t64*t77
      t86 = t21**2
      t87 = 1/t86
      t102 = t4*rho
      t106 = t52/rho*sigma
      t111 = rho*sigma
      t117 = t30**2
      t118 = 1/t117
      t121 = t2**2
      t123 = 1/t121/rho
      t138 = t10*t31
      t140 = 1/t102
      t141 = t140*t118
      s1 = 0.3968502629920499D0*(0.3082178310821422D0*t64*t17
     #+0.5779084332790167D-1*t7*t68*(-0.705555787941129D-1*t72
     #-0.8889445891021917D-1*t78)-0.3003896665045631D0*t64*t22
     #-0.5632306246960559D-1*t7*t87*(-0.8466669455293548D-1*t72
     #-0.106673350692263D0*t78))*t9+0.10582673679788D1*t25*t3-0.55D-1
     #*t31-0.869D-2*t36*t39*(0.5D0*rho*t55+0.25D0*t2*
     #(0.3062649600200738D2*t102-0.2777777777777778D-1*t106)-0.25D0
     #*t111)
      vrhoa(i) = s1-0.6425833333333333D-2*t118*t28
     #-0.7241666666666667D-3*t123*t35*t31*t60-0.1015281666666667D-2
     #*t35*t118*t123*t60+0.3186333333333333D-1*t36/t4/t121*t60
     #-0.869D-2*t36*t39*(0.25D0*t2*((0.3240740740740741D-1*t10
     #+0.4543518518518519D-1*t138-0.1592503240740741D-1*t141)*sigma
     #-0.5D0*(0.462962962962963D-2*t10+0.6490740740740741D-2*t138
     #-0.227500462962963D-2*t141)*sigma-0.2777777777777778D-1*(
     #-0.8333333333333333D-1*t10-0.1168333333333333D0*t138
     #+0.4095008333333333D-1*t141)*sigma+0.2777777777777778D-1*t106)
     #-0.6666666666666667D0*t111)
      t170 = 1/t8*t10*t13
      t172 = t6*t77
      vsigmaaa(i) = 0.7937005259840997D0*(-0.2311633733116067D0*t6*t17
     #+0.5779084332790167D-1*t7*t68*(0.5291668409558467D-1*t170
     #+0.6667084418266438D-1*t172)+0.2252922498784224D0*t6*t22
     #-0.5632306246960559D-1*t7*t87*(0.6350002091470161D-1*t170
     #+0.8000501301919725D-1*t172))*t9+0.9655555555555556D-3*t36*t140
     #-0.3476D-1*t36*t39*(0.25D0*t2*t44-0.6666666666666667D0*t2)
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**2
      t3 = rho**(1.D0/3.D0)
      t4 = t3**2
      t5 = t4*t2
      t6 = 1/t5
      t7 = sigma*t6
      t8 = dsqrt(sigma)
      t9 = t3*rho
      t10 = 1/t9
      t11 = t8*t10
      t13 = dlog(0.1259921049894873D1*t11+dsqrt(1+0.1587401051968199D1
     #*t11**2))
      t14 = t11*t13
      t16 = 1.D0+0.2645834204779234D-1*t14
      t17 = 1/t16
      t21 = 1.D0+0.317500104573508D-1*t14
      t22 = 1/t21
      t25 = -0.9593273689405774D0-0.5779084332790167D-1*t7*t17
     #+0.5632306246960559D-1*t7*t22
      t28 = 1/t3
      t30 = 1.D0+0.3505D0*t28
      t31 = 1/t30
      t34 = 0.25D0*t28
      t35 = dexp(-t34)
      t36 = t35*t31
      t37 = t2*rho
      t39 = 1/t4/t37
      t40 = 0.1148493600075277D2*t5
      t42 = t28*t31
      t44 = 0.2611111111111111D1-0.9722222222222222D-1*t28
     #-0.1363055555555556D0*t42
      t45 = t44*sigma
      t50 = 0.5D0*(0.25D1-0.1388888888888889D-1*t28
     #-0.1947222222222222D-1*t42)*sigma
      t52 = t34+0.3505D0*t42-11.D0
      t54 = 0.2777777777777778D-1*t52*sigma
      t55 = t40+t45-t50-t54
      t60 = 0.25D0*t2*t55-0.4583333333333333D0*t2*sigma
      zk(i) = 0.7937005259840997D0*t25*t9-0.55D-1*t31*rho-0.869D-2*t36
     #*t39*t60
      t64 = sigma*t39
      t67 = t16**2
      t68 = 1/t67
      t70 = 1/t3/t2
      t72 = t8*t70*t13
      t75 = 1.D0+0.1587401051968199D1*t7
      t76 = dsqrt(t75)
      t77 = 1/t76
      t78 = t64*t77
      t80 = -0.705555787941129D-1*t72-0.8889445891021917D-1*t78
      t81 = t68*t80
      t86 = t21**2
      t87 = 1/t86
      t90 = -0.8466669455293548D-1*t72-0.106673350692263D0*t78
      t91 = t87*t90
      t94 = 0.3082178310821422D0*t64*t17+0.5779084332790167D-1*t7*t81
     #-0.3003896665045631D0*t64*t22-0.5632306246960559D-1*t7*t91
      t102 = t4*rho
      t104 = 1/rho
      t105 = t52*t104
      t106 = t105*sigma
      t108 = 0.3062649600200738D2*t102-0.2777777777777778D-1*t106
      t111 = rho*sigma
      t113 = 0.5D0*rho*t55+0.25D0*t2*t108-0.25D0*t111
      t117 = t30**2
      t118 = 1/t117
      t121 = t2**2
      t122 = t121*rho
      t123 = 1/t122
      t124 = t123*t35
      t125 = t31*t60
      t128 = t35*t118
      t133 = 1/t4/t121
      t138 = t10*t31
      t140 = 1/t102
      t141 = t140*t118
      t143 = 0.3240740740740741D-1*t10+0.4543518518518519D-1*t138
     #-0.1592503240740741D-1*t141
      t154 = -0.8333333333333333D-1*t10-0.1168333333333333D0*t138
     #+0.4095008333333333D-1*t141
      t158 = t143*sigma-0.5D0*(0.462962962962963D-2*t10
     #+0.6490740740740741D-2*t138-0.227500462962963D-2*t141)*sigma
     #-0.2777777777777778D-1*t154*sigma+0.2777777777777778D-1*t106
      t162 = 0.25D0*t2*t158-0.6666666666666667D0*t111
      vrhoa(i) = 0.3968502629920499D0*t94*t9+0.10582673679788D1*t25*t3
     #-0.55D-1*t31-0.869D-2*t36*t39*t113-0.6425833333333333D-2*t118
     #*t28-0.7241666666666667D-3*t124*t125-0.1015281666666667D-2*t128
     #*t123*t60+0.3186333333333333D-1*t36*t133*t60-0.869D-2*t36*t39*t162
      t168 = 1/t8
      t170 = t168*t10*t13
      t172 = t6*t77
      t174 = 0.5291668409558467D-1*t170+0.6667084418266438D-1*t172
      t175 = t68*t174
      t182 = 0.6350002091470161D-1*t170+0.8000501301919725D-1*t172
      t183 = t87*t182
      t186 = -0.2311633733116067D0*t6*t17+0.5779084332790167D-1*t7
     #*t175+0.2252922498784224D0*t6*t22-0.5632306246960559D-1*t7*t183
      t194 = 0.25D0*t2*t44-0.6666666666666667D0*t2
      vsigmaaa(i) = 0.7937005259840997D0*t186*t9+0.9655555555555556D-3
     #*t36*t140-0.3476D-1*t36*t39*t194
      t205 = t70*t31
      t207 = t6*t118
      t209 = 1/t37
      t211 = 1/t117/t30
      t212 = t209*t211
      t231 = t154*t104*sigma
      t235 = t52/t2*sigma
      t261 = sigma*t133
      t267 = 1/t67/t16
      t268 = t80**2
      t275 = t8/t3/t37*t13
      t277 = t261*t77
      t279 = sigma**2
      t285 = 1/t76/t75
      t286 = t279/t3/t121/t37*t285
      t297 = 1/t86/t21
      t298 = t90**2
      t321 = t121*t2
      t323 = 1/t3/t321
      t333 = 1/t321
      t345 = rho*t108
      t359 = t323*t35
      t365 = -0.4744749655555556D-3*t35*t211*t323*t60
     #+0.1274533333333333D0*t36*t133*t113-0.2896666666666667D-2*t124
     #*t31*t113+0.1759821555555556D-1*t128*t333*t60
     #+0.1255222222222222D-1*t333*t35*t125-0.2973911111111111D0*t36/t4
     #/t122*t60-0.869D-2*t36*t39*(t40+t45-t50-t54+t345)-0.869D-2*t36
     #*t39*(t345+0.2552208000167282D2*t5-0.5D0*sigma)
     #-0.2896666666666667D-2*t124*t31*t162-0.1206944444444444D-3*t359
     #*t125-0.3384272222222222D-3*t359*t118*t60
      s1 = -0.4061126666666667D-2*t128*t123*t162+0.1274533333333333D0
     #*t36*t133*t162-0.1738D-1*t36*t39*(0.25D0*t2*((
     #-0.4320987654320988D-1*t70-0.6058024691358025D-1*t205
     #+0.3185006481481481D-1*t207-0.3721149239197531D-2*t212)*sigma
     #-0.5D0*(-0.617283950617284D-2*t70-0.8654320987654321D-2*t205
     #+0.4550009259259259D-2*t207-0.5315927484567901D-3*t212)*sigma
     #-0.2777777777777778D-1*(0.1111111111111111D0*t70
     #+0.1557777777777778D0*t205-0.8190016666666667D-1*t207
     #+0.9568669472222222D-2*t212)*sigma+0.5555555555555556D-1*t231
     #-0.5555555555555556D-1*t235)-0.6666666666666667D0*sigma)
     #-0.3476D-1*t36*t39*(0.5D0*rho*t158+0.25D0*t2*(
     #-0.2777777777777778D-1*t231+0.2777777777777778D-1*t235))
     #-0.4061126666666667D-2*t128*t123*t113
      v2rhoa2(i) = s1-0.3003006111111111D-2*t211*t140
     #+0.3968502629920499D0*(-0.2260264094602376D1*t261*t17
     #-0.6164356621642845D0*t64*t81-0.1155816866558033D0*t7*t267*t268
     #+0.5779084332790167D-1*t7*t68*(0.3292593677058602D0*t275
     #+0.8889445891021917D0*t277-0.3762964202352688D0*t286)
     #+0.2202857554366796D1*t261*t22+0.6007793330091263D0*t64*t91
     #+0.1126461249392112D0*t7*t297*t298-0.5632306246960559D-1*t7*t87*
     #(0.3951112412470322D0*t275+0.106673350692263D1*t277
     #-0.4515557042823225D0*t286))*t9+0.2116534735957599D1*t94*t3
     #+0.7055115786525331D0*t25/t4-0.8567777777777778D-2*t118*t10+t365
      t370 = t6*t68
      t378 = t168*t70*t13
      t380 = t39*t77
      t383 = sigma*t323*t285
      t393 = t6*t87
      s1 = 0.3968502629920499D0*(0.1232871324328569D1*t39*t17
     #-0.3082178310821422D0*t64*t175+0.2311633733116067D0*t370*t80
     #-0.1155816866558033D0*t7*t267*t80*t174+0.5779084332790167D-1*t7
     #*t68*(-0.1411111575882258D0*t378-0.533366753461315D0*t380
     #+0.2822223151764516D0*t383)-0.1201558666018253D1*t39*t22
     #+0.3003896665045631D0*t64*t183-0.2252922498784224D0*t393*t90
     #+0.1126461249392112D0*t7*t297*t90*t182-0.5632306246960559D-1*t7
     #*t87*(-0.169333389105871D0*t378-0.640040104153578D0*t380
     #+0.3386667782117419D0*t383))*t9+0.10582673679788D1*t186*t3
     #-0.869D-2*t36*t39*(-0.9444444444444444D0*rho
     #-0.2777777777777778D-1*rho*t52)+0.8046296296296296D-4*t209*t35
     #*t31+0.1128090740740741D-3*t128*t209+0.1335685185185185D-1*t36*t6
      v2rhoasigmaaa(i) = s1-0.1738D-1*t36*t39*(0.25D0*t2*(-0.1D-22*t10
     #-0.1D-22*t138+0.5555555555555556D-1*t105)+0.1333333333333333D1
     #*rho)-0.1738D-1*t36*t6*t44-0.2896666666666667D-2*t124*t31*t194
     #-0.4061126666666667D-2*t128*t123*t194+0.1274533333333333D0*t36
     #*t133*t194-0.3476D-1*t36*t39*(0.25D0*t2*t143
     #-0.1333333333333333D1*rho)
      t458 = t174**2
      t465 = 1/t8/sigma*t10*t13
      t469 = 1/sigma*t6*t77
      t473 = 1/t3/t122*t285
      t481 = t182**2
      v2sigmaaa2(i) = 0.7937005259840997D0*(0.4623267466232134D0*t370
     #*t174-0.1155816866558033D0*t7*t267*t458+0.5779084332790167D-1*t7
     #*t68*(-0.1058333681911693D0*t465+0.1333416883653288D0*t469
     #-0.2116667363823387D0*t473)-0.4505844997568447D0*t393*t182
     #+0.1126461249392112D0*t7*t297*t481-0.5632306246960559D-1*t7*t87*
     #(-0.1270000418294032D0*t465+0.1600100260383945D0*t469
     #-0.2540000836588064D0*t473))*t9
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end

c:XC_EDF1subrend
_ENDIF
_IF(ccpdft,all,c_ft97,xc_ft97)
c:C_FT97subrstart

c    Generated: Tue Nov  4 11:48:09 GMT 2003

      subroutine uks_c_ft97
     & (ideriv,npt,rhoa1,rhob1,sigmaaa1,sigmabb1,sigmaab1,
     &  zk,vrhoa,vrhob,vsigmaaa,vsigmabb,vsigmaab,
     &  v2rhoa2,v2rhob2,v2rhoab,
     &  v2rhoasigmaaa,v2rhoasigmaab,v2rhoasigmabb,
     &  v2rhobsigmabb,v2rhobsigmaab,v2rhobsigmaaa,
     &  v2sigmaaa2,v2sigmaaaab,v2sigmaaabb,
     &  v2sigmaab2,v2sigmaabbb,v2sigmabb2)
c
c     M. Filatov, and W. Thiel
c     A nonlocal correlation energy density functional from a 
c     Coulomb hole model
c     Int. J. Quant. Chem. 62 (1997) 603-616
c
c     M. Filatov, and W. Thiel
c     A new gradient-corrected exchange-correlation density functional
c     Mol. Phys. 91 (1997) 847-859
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt),rhob1(npt)
      REAL sigmaaa1(npt),sigmabb1(npt),sigmaab1(npt)
      REAL zk(npt),vrhoa(npt),vrhob(npt)
      REAL vsigmaaa(npt),vsigmabb(npt),vsigmaab(npt)
      REAL v2rhoa2(npt),v2rhob2(npt),v2rhoab(npt)
      REAL v2rhoasigmaaa(npt),v2rhoasigmaab(npt)
      REAL v2rhoasigmabb(npt),v2rhobsigmabb(npt)
      REAL v2rhobsigmaab(npt),v2rhobsigmaaa(npt)
      REAL v2sigmaaa2(npt),v2sigmaaaab(npt),v2sigmaaabb(npt)
      REAL v2sigmaab2(npt),v2sigmaabbb(npt),v2sigmabb2(npt)
      parameter(tolmin=1.0d-20)
      parameter(tolmax=1.0d+5)
      
      if (ideriv.eq.0) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      zk(i) = 0.D0
      if(rho.gt.tolmin) then
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      if(rhoa.gt.tolmin) then
      t1 = 1/rhoa
      t2 = t1**(1.D0/3.D0)
      trsa = 0.1285808356226127D-1*t2
      t3 = t1**(1.D0/15.D0)
      t4 = t3**2
      t6 = dexp(-0.5416509560827845D0*t4)
      t8 = t1**(1.D0/6.D0)
      t10 = dexp(-0.8579886777788441D0*t8)
      t13 = (0.1247511874D1+0.812904345D0*t6-0.859614445D0*t10)**2
      t14 = sigmaaa**2
      t15 = rhoa**2
      t16 = t15**2
      t18 = rhoa**(1.D0/3.D0)
      t21 = t14/t18/t16/rhoa
      t24 = (0.1D1+0.4473229026479948D-1*t21)**2
      t26 = t18**2
      t36 = dexp(-0.4473229026479948D-1*t21)
      t37 = t36**2
      trcaa = t13*t24/(0.1D1+0.2481823842598833D0*sigmaaa/t26/t15/t2)
     #*t37
      if(trsa.lt.tolmax*trcaa) then
      t2 = 1/rhoa
      t3 = t2**(1.D0/3.D0)
      t4 = t3**2
      t5 = t2**(1.D0/6.D0)
      t9 = (0.7395908974809453D0*t5+0.1075172860312113D1*t3)**2
      t13 = dexp(-0.3848347315591266D0*t4/t9)
      t15 = 0.3141592653589793D1**2
      t18 = 1/0.3141592653589793D1*t2
      t19 = t18**(1.D0/3.D0)
      t21 = t18**(1.D0/15.D0)
      t22 = t21**2
      t24 = dexp(-0.630966299458536D0*t22)
      t26 = t18**(1.D0/6.D0)
      t28 = dexp(-0.1038340679664977D1*t26)
      t31 = (0.1247511874D1+0.812904345D0*t24-0.859614445D0*t28)**2
      t34 = 0.3141592653589793D1**(1.D0/3.D0)
      t37 = sigmaaa**2
      t39 = rhoa**2
      t40 = t39**2
      t42 = rhoa**(1.D0/3.D0)
      t44 = 1/t42/t40/rhoa
      t45 = 1/t34/0.3141592653589793D1*t37*t44
      t48 = (0.1D1+0.2058200272046996D0*t45)**2
      t50 = t34**2
      t53 = t42**2
      t55 = 1/t53/t39
      t63 = dexp(0.4116400544093991D0*t45)
      t67 = expei(-0.1858628590577086D0/t15*t19/t31/t48*(0.1D1
     #+0.3634859066227017D0/t50*sigmaaa*t55/t19)*t63)
      t69 = t2**(1.D0/15.D0)
      t70 = t69**2
      t72 = dexp(-0.5416509560827845D0*t70)
      t75 = dexp(-0.8579886777788441D0*t5)
      t78 = (0.1247511874D1+0.812904345D0*t72-0.859614445D0*t75)**2
      t80 = t3/t78
      t81 = t37*t44
      t84 = (0.1D1+0.4473229026479948D-1*t81)**2
      t85 = 1/t84
      t90 = 0.1D1+0.2481823842598833D0*sigmaaa*t55/t3
      t93 = dexp(0.8946458052959895D-1*t81)
      t95 = t80*t85*t90*t93
      t96 = dsqrt(t95)
      zk(i) = zk(i)+0.1554534543482745D-1*rhoa*t13*(1.D0*t67+(0.6D1
     #+0.4535739597862518D0*t96+0.5143233424904509D-1*t95)/(0.3D1
     #+0.6803609396793777D0*t96+0.7714850137356763D-1*t95)*
     #(0.1285808356226127D-1*t80*t85*t90*t67*t93+0.1D1))
      endif
      endif ! rhoa
      if(rhob.gt.tolmin) then
      t1 = 1/rhob
      t2 = t1**(1.D0/3.D0)
      trsb = 0.1285808356226127D-1*t2
      t3 = t1**(1.D0/15.D0)
      t4 = t3**2
      t6 = dexp(-0.5416509560827845D0*t4)
      t8 = t1**(1.D0/6.D0)
      t10 = dexp(-0.8579886777788441D0*t8)
      t13 = (0.1247511874D1+0.812904345D0*t6-0.859614445D0*t10)**2
      t14 = sigmabb**2
      t15 = rhob**2
      t16 = t15**2
      t18 = rhob**(1.D0/3.D0)
      t21 = t14/t18/t16/rhob
      t24 = (0.1D1+0.4473229026479948D-1*t21)**2
      t26 = t18**2
      t36 = dexp(-0.4473229026479948D-1*t21)
      t37 = t36**2
      trcbb = t13*t24/(0.1D1+0.2481823842598833D0*sigmabb/t26/t15/t2)
     #*t37
      if(trsb.lt.tolmax*trcbb) then
      t2 = 1/rhob
      t3 = t2**(1.D0/3.D0)
      t4 = t3**2
      t5 = t2**(1.D0/6.D0)
      t9 = (0.7395908974809453D0*t5+0.1075172860312113D1*t3)**2
      t13 = dexp(-0.3848347315591266D0*t4/t9)
      t15 = 0.3141592653589793D1**2
      t18 = 1/0.3141592653589793D1*t2
      t19 = t18**(1.D0/3.D0)
      t21 = t18**(1.D0/15.D0)
      t22 = t21**2
      t24 = dexp(-0.630966299458536D0*t22)
      t26 = t18**(1.D0/6.D0)
      t28 = dexp(-0.1038340679664977D1*t26)
      t31 = (0.1247511874D1+0.812904345D0*t24-0.859614445D0*t28)**2
      t34 = 0.3141592653589793D1**(1.D0/3.D0)
      t37 = sigmabb**2
      t39 = rhob**2
      t40 = t39**2
      t42 = rhob**(1.D0/3.D0)
      t44 = 1/t42/t40/rhob
      t45 = 1/t34/0.3141592653589793D1*t37*t44
      t48 = (0.1D1+0.2058200272046996D0*t45)**2
      t50 = t34**2
      t53 = t42**2
      t55 = 1/t53/t39
      t63 = dexp(0.4116400544093991D0*t45)
      t67 = expei(-0.1858628590577086D0/t15*t19/t31/t48*(0.1D1
     #+0.3634859066227017D0/t50*sigmabb*t55/t19)*t63)
      t69 = t2**(1.D0/15.D0)
      t70 = t69**2
      t72 = dexp(-0.5416509560827845D0*t70)
      t75 = dexp(-0.8579886777788441D0*t5)
      t78 = (0.1247511874D1+0.812904345D0*t72-0.859614445D0*t75)**2
      t80 = t3/t78
      t81 = t37*t44
      t84 = (0.1D1+0.4473229026479948D-1*t81)**2
      t85 = 1/t84
      t90 = 0.1D1+0.2481823842598833D0*sigmabb*t55/t3
      t93 = dexp(0.8946458052959895D-1*t81)
      t95 = t80*t85*t90*t93
      t96 = dsqrt(t95)
      zk(i) = zk(i)+0.1554534543482745D-1*rhob*t13*(1.D0*t67+(0.6D1
     #+0.4535739597862518D0*t96+0.5143233424904509D-1*t95)/(0.3D1
     #+0.6803609396793777D0*t96+0.7714850137356763D-1*t95)*
     #(0.1285808356226127D-1*t80*t85*t90*t67*t93+0.1D1))
      endif
      endif ! rhob
      if ((rhoa.gt.tolmin).and.(rhob.gt.tolmin)) then
      t1 = 1/rhob
      t2 = t1**(1.D0/3.D0)
      trsb = 0.1285808356226127D-1*t2
      t3 = t1**(1.D0/15.D0)
      t4 = t3**2
      t5 = t4**2
      t7 = dexp(-0.5683671053580832D-1*t5)
      t10 = (0.942486901D0+0.349064173D0*t7)**2
      t11 = rhob**2
      t12 = rhob**(1.D0/3.D0)
      t13 = t12**2
      t16 = sigmabb/t13/t11
      t18 = sigmabb**2
      t19 = t11**2
      t23 = t18/t12/t19/rhob
      t26 = (0.1D1+0.6936084891727404D-1*t16+0.4389159297635699D-3*t23
     #)**2
      t34 = dexp(-0.4389159297635699D-3*t23)
      t35 = t34**2
      trcab = t10*t26/(0.1D1+0.9505299311782149D-1*t16/t2)*t35
      if(trsb.lt.tolmax*trcab) then
      t2 = 0.3141592653589793D1**2
      t5 = 1/rhob
      t6 = 1/0.3141592653589793D1*t5
      t7 = t6**(1.D0/3.D0)
      t9 = t6**(1.D0/15.D0)
      t10 = t9**2
      t11 = t10**2
      t13 = dexp(-0.7712625328179681D-1*t11)
      t16 = (0.942486901D0+0.349064173D0*t13)**2
      t19 = 0.3141592653589793D1**(1.D0/3.D0)
      t20 = t19**2
      t22 = 1/t20*sigmabb
      t23 = rhob**2
      t24 = rhob**(1.D0/3.D0)
      t25 = t24**2
      t27 = 1/t25/t23
      t32 = sigmabb**2
      t34 = t23**2
      t37 = 1/t24/t34/rhob
      t38 = 1/t19/0.3141592653589793D1*t32*t37
      t41 = (0.1D1+0.1487810599361293D0*t22*t27+0.2019518519390501D-2
     #*t38)**2
      t50 = dexp(0.4039037038781002D-2*t38)
      t54 = expei(-0.1858628590577086D0/t2*t7/t16/t41*(0.1D1
     #+0.1392138426088027D0*t22*t27/t7)*t50)
      t56 = t5**(1.D0/3.D0)
      t57 = t5**(1.D0/15.D0)
      t58 = t57**2
      t59 = t58**2
      t61 = dexp(-0.5683671053580832D-1*t59)
      t64 = (0.942486901D0+0.349064173D0*t61)**2
      t66 = t56/t64
      t67 = sigmabb*t27
      t69 = t32*t37
      t72 = (0.1D1+0.6936084891727404D-1*t67+0.4389159297635699D-3*t69
     #)**2
      t73 = 1/t72
      t77 = 0.1D1+0.9505299311782149D-1*t67/t56
      t80 = dexp(0.8778318595271399D-3*t69)
      t82 = t66*t73*t77*t80
      t83 = dsqrt(t82)
      zk(i) = zk(i)+0.1554534543482745D-1*rhoa*(1.D0*t54+(0.6D1
     #+0.4535739597862518D0*t83+0.5143233424904509D-1*t82)/(0.3D1
     #+0.6803609396793777D0*t83+0.7714850137356763D-1*t82)*
     #(0.1285808356226127D-1*t66*t73*t77*t54*t80+0.1D1))
      endif
      t1 = 1/rhoa
      t2 = t1**(1.D0/3.D0)
      trsa = 0.1285808356226127D-1*t2
      t3 = t1**(1.D0/15.D0)
      t4 = t3**2
      t5 = t4**2
      t7 = dexp(-0.5683671053580832D-1*t5)
      t10 = (0.942486901D0+0.349064173D0*t7)**2
      t11 = rhoa**2
      t12 = rhoa**(1.D0/3.D0)
      t13 = t12**2
      t16 = sigmaaa/t13/t11
      t18 = sigmaaa**2
      t19 = t11**2
      t23 = t18/t12/t19/rhoa
      t26 = (0.1D1+0.6936084891727404D-1*t16+0.4389159297635699D-3*t23
     #)**2
      t34 = dexp(-0.4389159297635699D-3*t23)
      t35 = t34**2
      trcba = t10*t26/(0.1D1+0.9505299311782149D-1*t16/t2)*t35
      if(trsa.lt.tolmax*trcba) then
      t2 = 0.3141592653589793D1**2
      t5 = 1/rhoa
      t6 = 1/0.3141592653589793D1*t5
      t7 = t6**(1.D0/3.D0)
      t9 = t6**(1.D0/15.D0)
      t10 = t9**2
      t11 = t10**2
      t13 = dexp(-0.7712625328179681D-1*t11)
      t16 = (0.942486901D0+0.349064173D0*t13)**2
      t19 = 0.3141592653589793D1**(1.D0/3.D0)
      t20 = t19**2
      t22 = 1/t20*sigmaaa
      t23 = rhoa**2
      t24 = rhoa**(1.D0/3.D0)
      t25 = t24**2
      t27 = 1/t25/t23
      t32 = sigmaaa**2
      t34 = t23**2
      t37 = 1/t24/t34/rhoa
      t38 = 1/t19/0.3141592653589793D1*t32*t37
      t41 = (0.1D1+0.1487810599361293D0*t22*t27+0.2019518519390501D-2
     #*t38)**2
      t50 = dexp(0.4039037038781002D-2*t38)
      t54 = expei(-0.1858628590577086D0/t2*t7/t16/t41*(0.1D1
     #+0.1392138426088027D0*t22*t27/t7)*t50)
      t56 = t5**(1.D0/3.D0)
      t57 = t5**(1.D0/15.D0)
      t58 = t57**2
      t59 = t58**2
      t61 = dexp(-0.5683671053580832D-1*t59)
      t64 = (0.942486901D0+0.349064173D0*t61)**2
      t66 = t56/t64
      t67 = sigmaaa*t27
      t69 = t32*t37
      t72 = (0.1D1+0.6936084891727404D-1*t67+0.4389159297635699D-3*t69
     #)**2
      t73 = 1/t72
      t77 = 0.1D1+0.9505299311782149D-1*t67/t56
      t80 = dexp(0.8778318595271399D-3*t69)
      t82 = t66*t73*t77*t80
      t83 = dsqrt(t82)
      zk(i) = zk(i)+0.1554534543482745D-1*rhob*(1.D0*t54+(0.6D1
     #+0.4535739597862518D0*t83+0.5143233424904509D-1*t82)/(0.3D1
     #+0.6803609396793777D0*t83+0.7714850137356763D-1*t82)*
     #(0.1285808356226127D-1*t66*t73*t77*t54*t80+0.1D1))
      endif
      endif ! rhoa,rhob
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      zk(i) = 0.D0
      vrhoa(i) = 0.D0
      vrhob(i) = 0.D0
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      if(rho.gt.tolmin) then
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      if(rhoa.gt.tolmin) then
      t1 = 1/rhoa
      t2 = t1**(1.D0/3.D0)
      trsa = 0.1285808356226127D-1*t2
      t3 = t1**(1.D0/15.D0)
      t4 = t3**2
      t6 = dexp(-0.5416509560827845D0*t4)
      t8 = t1**(1.D0/6.D0)
      t10 = dexp(-0.8579886777788441D0*t8)
      t13 = (0.1247511874D1+0.812904345D0*t6-0.859614445D0*t10)**2
      t14 = sigmaaa**2
      t15 = rhoa**2
      t16 = t15**2
      t18 = rhoa**(1.D0/3.D0)
      t21 = t14/t18/t16/rhoa
      t24 = (0.1D1+0.4473229026479948D-1*t21)**2
      t26 = t18**2
      t36 = dexp(-0.4473229026479948D-1*t21)
      t37 = t36**2
      trcaa = t13*t24/(0.1D1+0.2481823842598833D0*sigmaaa/t26/t15/t2)
     #*t37
      if(trsa.lt.tolmax*trcaa) then
      t2 = 1/rhoa
      t3 = t2**(1.D0/3.D0)
      t4 = t3**2
      t5 = t2**(1.D0/6.D0)
      t8 = 0.7395908974809453D0*t5+0.1075172860312113D1*t3
      t9 = t8**2
      t10 = 1/t9
      t13 = dexp(-0.3848347315591266D0*t4*t10)
      t14 = rhoa*t13
      t15 = 0.3141592653589793D1**2
      t18 = 1/0.3141592653589793D1*t2
      t19 = t18**(1.D0/3.D0)
      t21 = t18**(1.D0/15.D0)
      t22 = t21**2
      t24 = dexp(-0.630966299458536D0*t22)
      t26 = t18**(1.D0/6.D0)
      t28 = dexp(-0.1038340679664977D1*t26)
      t31 = (0.1247511874D1+0.812904345D0*t24-0.859614445D0*t28)**2
      t34 = 0.3141592653589793D1**(1.D0/3.D0)
      t37 = sigmaaa**2
      t39 = rhoa**2
      t40 = t39**2
      t42 = rhoa**(1.D0/3.D0)
      t44 = 1/t42/t40/rhoa
      t45 = 1/t34/0.3141592653589793D1*t37*t44
      t48 = (0.1D1+0.2058200272046996D0*t45)**2
      t50 = t34**2
      t53 = t42**2
      t55 = 1/t53/t39
      t63 = dexp(0.4116400544093991D0*t45)
      t67 = expei(-0.1858628590577086D0/t15*t19/t31/t48*(0.1D1
     #+0.3634859066227017D0/t50*sigmaaa*t55/t19)*t63)
      t69 = t2**(1.D0/15.D0)
      t70 = t69**2
      t72 = dexp(-0.5416509560827845D0*t70)
      t75 = dexp(-0.8579886777788441D0*t5)
      t77 = 0.1247511874D1+0.812904345D0*t72-0.859614445D0*t75
      t78 = t77**2
      t79 = 1/t78
      t80 = t3*t79
      t81 = t37*t44
      t83 = 0.1D1+0.4473229026479948D-1*t81
      t84 = t83**2
      t85 = 1/t84
      t87 = 1/t3
      t90 = 0.1D1+0.2481823842598833D0*sigmaaa*t55*t87
      t91 = t85*t90
      t93 = dexp(0.8946458052959895D-1*t81)
      t95 = t80*t91*t93
      t96 = dsqrt(t95)
      t99 = 0.6D1+0.4535739597862518D0*t96+0.5143233424904509D-1*t95
      t102 = 0.3D1+0.6803609396793777D0*t96+0.7714850137356763D-1*t95
      t103 = 1/t102
      t104 = t99*t103
      t105 = t80*t85
      t106 = t90*t67
      t110 = 0.1285808356226127D-1*t105*t106*t93+0.1D1
      t112 = 1.D0*t67+t104*t110
      zk(i) = zk(i)+0.1554534543482745D-1*t14*t112
      t116 = t13*t112
      t119 = 1/t39
      t125 = t5**2
      t126 = t125**2
      t129 = 1/t126/t5*t119
      t131 = 1/t4
      t142 = t131*t79*t85
      t143 = t90*t93
      t145 = t142*t143*t119
      t146 = 0.4286027854087091D-2*t145
      t150 = t3/t78/t77*t85
      t151 = t70**2
      t153 = t151**2
      t161 = 0.5870805542307996D-1/t153/t151/t69*t119*t72
     #-0.1229232435108575D0*t129*t75
      t163 = t150*t143*t161
      t164 = 0.2571616712452254D-1*t163
      t166 = 1/t84/t83
      t167 = t80*t166
      t170 = 1/t42/t40/t39
      t172 = t143*t37*t170
      t173 = t167*t172
      t174 = 0.613516294566526D-2*t173
      t188 = -0.6618196913596887D0*sigmaaa/t53/t39/rhoa*t87
     #+0.8272746141996109D-1*sigmaaa/t53/t40/t3/t2
      t191 = t80*t85*t188*t93
      t192 = 0.1285808356226127D-1*t191
      t193 = t105*t172
      t194 = 0.613516294566526D-2*t193
      t195 = -t146-t164+t174+t192-t194
      t204 = dexp(-0.8946458052959895D-1*t81)
      t205 = t84/t90*t204
      t208 = 1/t96
      t215 = t208*(-0.2306016315371713D-1*t145-0.1383609789223028D0
     #*t163+0.3300908517586267D-1*t173+0.6918048946115138D-1*t191
     #-0.3300908517586267D-1*t193)
      t225 = t102**2
      t227 = t99/t225
      t247 = t80*t166*t90
      t250 = t67*t37*t170*t93
      t257 = t80*t91
      t261 = t67*t93
      t265 = -0.4286027854087091D-2*t142*t106*t119*t93
     #-0.2571616712452254D-1*t150*t106*t161*t93+0.613516294566526D-2
     #*t247*t250+0.1285808356226127D-1*t105*t188*t67*t93
     #-0.613516294566526D-2*t257*t250+0.1285808356226127D-1*t105*t90
     #*t195*t261-t146-t164+t174+t192-t194
      vrhoa(i) = vrhoa(i)+0.1554534543482745D-1*t116
     #+0.1554534543482745D-1*rhoa*(0.2565564877060844D0*t87*t10*t119
     #+0.7696694631182532D0*t4/t9/t8*(-0.1232651495801576D0*t129
     #-0.358390953437371D0*t131*t119))*t116+0.1554534543482745D-1*t14*
     #(1.D0*t195*t67+0.7777208750882749D2*t195*t87*t78*t205+
     #(0.3278192763011299D1*t215-0.1714411141634836D-1*t145
     #-0.1028646684980902D0*t163+0.2454065178266104D-1*t173
     #+0.5143233424904509D-1*t191-0.2454065178266104D-1*t193)*t103
     #*t110-1.D0*t227*t110*(0.4917289144516948D1*t215
     #-0.2571616712452254D-1*t145-0.1542970027471353D0*t163
     #+0.3681097767399156D-1*t173+0.7714850137356763D-1*t191
     #-0.3681097767399156D-1*t193)+t104*t265)
      t272 = t143*sigmaaa*t44
      t273 = t167*t272
      t274 = 0.2300686104624472D-2*t273
      t275 = t79*t85
      t277 = t275*t55*t93
      t278 = 0.3191149835494816D-2*t277
      t279 = t105*t272
      t280 = 0.2300686104624472D-2*t279
      t281 = -t274+t278+t280
      t293 = t208*(-0.123784069409485D-1*t273+0.1716937881873428D-1
     #*t277+0.123784069409485D-1*t279)
      t311 = t67*sigmaaa*t44*t93
      vsigmaaa(i) = vsigmaaa(i)+0.1554534543482745D-1*t14*(1.D0*t281
     #*t67+0.7777208750882749D2*t281*t87*t78*t205+
     #(0.3278192763011299D1*t293-0.9202744418497889D-2*t273
     #+0.1276459934197926D-1*t277+0.9202744418497889D-2*t279)*t103
     #*t110-1.D0*t227*t110*(0.4917289144516948D1*t293
     #-0.1380411662774683D-1*t273+0.1914689901296889D-1*t277
     #+0.1380411662774683D-1*t279)+t104*(-0.2300686104624472D-2*t247
     #*t311+0.3191149835494816D-2*t275*t55*t67*t93
     #+0.2300686104624472D-2*t257*t311+0.1285808356226127D-1*t105*t90
     #*t281*t261-t274+t278+t280))
      endif
      endif ! rhoa
      if(rhob.gt.tolmin) then
      t1 = 1/rhob
      t2 = t1**(1.D0/3.D0)
      trsb = 0.1285808356226127D-1*t2
      t3 = t1**(1.D0/15.D0)
      t4 = t3**2
      t6 = dexp(-0.5416509560827845D0*t4)
      t8 = t1**(1.D0/6.D0)
      t10 = dexp(-0.8579886777788441D0*t8)
      t13 = (0.1247511874D1+0.812904345D0*t6-0.859614445D0*t10)**2
      t14 = sigmabb**2
      t15 = rhob**2
      t16 = t15**2
      t18 = rhob**(1.D0/3.D0)
      t21 = t14/t18/t16/rhob
      t24 = (0.1D1+0.4473229026479948D-1*t21)**2
      t26 = t18**2
      t36 = dexp(-0.4473229026479948D-1*t21)
      t37 = t36**2
      trcbb = t13*t24/(0.1D1+0.2481823842598833D0*sigmabb/t26/t15/t2)
     #*t37
      if(trsb.lt.tolmax*trcbb) then
      t2 = 1/rhob
      t3 = t2**(1.D0/3.D0)
      t4 = t3**2
      t5 = t2**(1.D0/6.D0)
      t8 = 0.7395908974809453D0*t5+0.1075172860312113D1*t3
      t9 = t8**2
      t10 = 1/t9
      t13 = dexp(-0.3848347315591266D0*t4*t10)
      t14 = rhob*t13
      t15 = 0.3141592653589793D1**2
      t18 = 1/0.3141592653589793D1*t2
      t19 = t18**(1.D0/3.D0)
      t21 = t18**(1.D0/15.D0)
      t22 = t21**2
      t24 = dexp(-0.630966299458536D0*t22)
      t26 = t18**(1.D0/6.D0)
      t28 = dexp(-0.1038340679664977D1*t26)
      t31 = (0.1247511874D1+0.812904345D0*t24-0.859614445D0*t28)**2
      t34 = 0.3141592653589793D1**(1.D0/3.D0)
      t37 = sigmabb**2
      t39 = rhob**2
      t40 = t39**2
      t42 = rhob**(1.D0/3.D0)
      t44 = 1/t42/t40/rhob
      t45 = 1/t34/0.3141592653589793D1*t37*t44
      t48 = (0.1D1+0.2058200272046996D0*t45)**2
      t50 = t34**2
      t53 = t42**2
      t55 = 1/t53/t39
      t63 = dexp(0.4116400544093991D0*t45)
      t67 = expei(-0.1858628590577086D0/t15*t19/t31/t48*(0.1D1
     #+0.3634859066227017D0/t50*sigmabb*t55/t19)*t63)
      t69 = t2**(1.D0/15.D0)
      t70 = t69**2
      t72 = dexp(-0.5416509560827845D0*t70)
      t75 = dexp(-0.8579886777788441D0*t5)
      t77 = 0.1247511874D1+0.812904345D0*t72-0.859614445D0*t75
      t78 = t77**2
      t79 = 1/t78
      t80 = t3*t79
      t81 = t37*t44
      t83 = 0.1D1+0.4473229026479948D-1*t81
      t84 = t83**2
      t85 = 1/t84
      t87 = 1/t3
      t90 = 0.1D1+0.2481823842598833D0*sigmabb*t55*t87
      t91 = t85*t90
      t93 = dexp(0.8946458052959895D-1*t81)
      t95 = t80*t91*t93
      t96 = dsqrt(t95)
      t99 = 0.6D1+0.4535739597862518D0*t96+0.5143233424904509D-1*t95
      t102 = 0.3D1+0.6803609396793777D0*t96+0.7714850137356763D-1*t95
      t103 = 1/t102
      t104 = t99*t103
      t105 = t80*t85
      t106 = t90*t67
      t110 = 0.1285808356226127D-1*t105*t106*t93+0.1D1
      t112 = 1.D0*t67+t104*t110
      zk(i) = zk(i)+0.1554534543482745D-1*t14*t112
      t116 = t13*t112
      t119 = 1/t39
      t125 = t5**2
      t126 = t125**2
      t129 = 1/t126/t5*t119
      t131 = 1/t4
      t142 = t131*t79*t85
      t143 = t90*t93
      t145 = t142*t143*t119
      t146 = 0.4286027854087091D-2*t145
      t150 = t3/t78/t77*t85
      t151 = t70**2
      t153 = t151**2
      t161 = 0.5870805542307996D-1/t153/t151/t69*t119*t72
     #-0.1229232435108575D0*t129*t75
      t163 = t150*t143*t161
      t164 = 0.2571616712452254D-1*t163
      t166 = 1/t84/t83
      t167 = t80*t166
      t170 = 1/t42/t40/t39
      t172 = t143*t37*t170
      t173 = t167*t172
      t174 = 0.613516294566526D-2*t173
      t188 = -0.6618196913596887D0*sigmabb/t53/t39/rhob*t87
     #+0.8272746141996109D-1*sigmabb/t53/t40/t3/t2
      t191 = t80*t85*t188*t93
      t192 = 0.1285808356226127D-1*t191
      t193 = t105*t172
      t194 = 0.613516294566526D-2*t193
      t195 = -t146-t164+t174+t192-t194
      t204 = dexp(-0.8946458052959895D-1*t81)
      t205 = t84/t90*t204
      t208 = 1/t96
      t215 = t208*(-0.2306016315371713D-1*t145-0.1383609789223028D0
     #*t163+0.3300908517586267D-1*t173+0.6918048946115138D-1*t191
     #-0.3300908517586267D-1*t193)
      t225 = t102**2
      t227 = t99/t225
      t247 = t80*t166*t90
      t250 = t67*t37*t170*t93
      t257 = t80*t91
      t261 = t67*t93
      t265 = -0.4286027854087091D-2*t142*t106*t119*t93
     #-0.2571616712452254D-1*t150*t106*t161*t93+0.613516294566526D-2
     #*t247*t250+0.1285808356226127D-1*t105*t188*t67*t93
     #-0.613516294566526D-2*t257*t250+0.1285808356226127D-1*t105*t90
     #*t195*t261-t146-t164+t174+t192-t194
      vrhob(i) = vrhob(i)+0.1554534543482745D-1*t116
     #+0.1554534543482745D-1*rhob*(0.2565564877060844D0*t87*t10*t119
     #+0.7696694631182532D0*t4/t9/t8*(-0.1232651495801576D0*t129
     #-0.358390953437371D0*t131*t119))*t116+0.1554534543482745D-1*t14*
     #(1.D0*t195*t67+0.7777208750882749D2*t195*t87*t78*t205+
     #(0.3278192763011299D1*t215-0.1714411141634836D-1*t145
     #-0.1028646684980902D0*t163+0.2454065178266104D-1*t173
     #+0.5143233424904509D-1*t191-0.2454065178266104D-1*t193)*t103
     #*t110-1.D0*t227*t110*(0.4917289144516948D1*t215
     #-0.2571616712452254D-1*t145-0.1542970027471353D0*t163
     #+0.3681097767399156D-1*t173+0.7714850137356763D-1*t191
     #-0.3681097767399156D-1*t193)+t104*t265)
      t272 = t143*sigmabb*t44
      t273 = t167*t272
      t274 = 0.2300686104624472D-2*t273
      t275 = t79*t85
      t277 = t275*t55*t93
      t278 = 0.3191149835494816D-2*t277
      t279 = t105*t272
      t280 = 0.2300686104624472D-2*t279
      t281 = -t274+t278+t280
      t293 = t208*(-0.123784069409485D-1*t273+0.1716937881873428D-1
     #*t277+0.123784069409485D-1*t279)
      t311 = t67*sigmabb*t44*t93
      vsigmabb(i) = vsigmabb(i)+0.1554534543482745D-1*t14*(1.D0*t281
     #*t67+0.7777208750882749D2*t281*t87*t78*t205+
     #(0.3278192763011299D1*t293-0.9202744418497889D-2*t273
     #+0.1276459934197926D-1*t277+0.9202744418497889D-2*t279)*t103
     #*t110-1.D0*t227*t110*(0.4917289144516948D1*t293
     #-0.1380411662774683D-1*t273+0.1914689901296889D-1*t277
     #+0.1380411662774683D-1*t279)+t104*(-0.2300686104624472D-2*t247
     #*t311+0.3191149835494816D-2*t275*t55*t67*t93
     #+0.2300686104624472D-2*t257*t311+0.1285808356226127D-1*t105*t90
     #*t281*t261-t274+t278+t280))
      endif
      endif ! rhob
      if ((rhoa.gt.tolmin).and.(rhob.gt.tolmin)) then
      t1 = 1/rhob
      t2 = t1**(1.D0/3.D0)
      trsb = 0.1285808356226127D-1*t2
      t3 = t1**(1.D0/15.D0)
      t4 = t3**2
      t5 = t4**2
      t7 = dexp(-0.5683671053580832D-1*t5)
      t10 = (0.942486901D0+0.349064173D0*t7)**2
      t11 = rhob**2
      t12 = rhob**(1.D0/3.D0)
      t13 = t12**2
      t16 = sigmabb/t13/t11
      t18 = sigmabb**2
      t19 = t11**2
      t23 = t18/t12/t19/rhob
      t26 = (0.1D1+0.6936084891727404D-1*t16+0.4389159297635699D-3*t23
     #)**2
      t34 = dexp(-0.4389159297635699D-3*t23)
      t35 = t34**2
      trcab = t10*t26/(0.1D1+0.9505299311782149D-1*t16/t2)*t35
      if(trsb.lt.tolmax*trcab) then
      t2 = 0.3141592653589793D1**2
      t5 = 1/rhob
      t6 = 1/0.3141592653589793D1*t5
      t7 = t6**(1.D0/3.D0)
      t9 = t6**(1.D0/15.D0)
      t10 = t9**2
      t11 = t10**2
      t13 = dexp(-0.7712625328179681D-1*t11)
      t16 = (0.942486901D0+0.349064173D0*t13)**2
      t19 = 0.3141592653589793D1**(1.D0/3.D0)
      t20 = t19**2
      t22 = 1/t20*sigmabb
      t23 = rhob**2
      t24 = rhob**(1.D0/3.D0)
      t25 = t24**2
      t27 = 1/t25/t23
      t32 = sigmabb**2
      t34 = t23**2
      t37 = 1/t24/t34/rhob
      t38 = 1/t19/0.3141592653589793D1*t32*t37
      t41 = (0.1D1+0.1487810599361293D0*t22*t27+0.2019518519390501D-2
     #*t38)**2
      t50 = dexp(0.4039037038781002D-2*t38)
      t54 = expei(-0.1858628590577086D0/t2*t7/t16/t41*(0.1D1
     #+0.1392138426088027D0*t22*t27/t7)*t50)
      t56 = t5**(1.D0/3.D0)
      t57 = t5**(1.D0/15.D0)
      t58 = t57**2
      t59 = t58**2
      t60 = 0.5683671053580832D-1*t59
      t61 = dexp(-t60)
      t63 = 0.942486901D0+0.349064173D0*t61
      t64 = t63**2
      t65 = 1/t64
      t66 = t56*t65
      t67 = sigmabb*t27
      t69 = t32*t37
      t71 = 0.1D1+0.6936084891727404D-1*t67+0.4389159297635699D-3*t69
      t72 = t71**2
      t73 = 1/t72
      t74 = 1/t56
      t77 = 0.1D1+0.9505299311782149D-1*t67*t74
      t78 = t73*t77
      t79 = 0.8778318595271399D-3*t69
      t80 = dexp(t79)
      t82 = t66*t78*t80
      t83 = dsqrt(t82)
      t86 = 0.6D1+0.4535739597862518D0*t83+0.5143233424904509D-1*t82
      t89 = 0.3D1+0.6803609396793777D0*t83+0.7714850137356763D-1*t82
      t90 = 1/t89
      t91 = t86*t90
      t92 = t66*t73
      t93 = t77*t54
      t97 = 0.1285808356226127D-1*t92*t93*t80+0.1D1
      t98 = t91*t97
      zk(i) = zk(i)+0.1554534543482745D-1*rhoa*(1.D0*t54+t98)
      vrhoa(i) = vrhoa(i)+0.1554534543482745D-1*t54
     #+0.1554534543482745D-1*t98
      t106 = t56**2
      t109 = 1/t106*t65*t73
      t110 = t77*t80
      t111 = 1/t23
      t113 = t109*t110*t111
      t114 = 0.4286027854087091D-2*t113
      t115 = t5**(1.D0/5.D0)
      t116 = t115**2
      t121 = 1/t116/t64/t63*t73
      t124 = dexp(t79-t60)
      t126 = t121*t77*t111*t124
      t127 = 0.1360533322067624D-3*t126
      t130 = t66/t72/t71
      t134 = sigmabb/t25/t23/rhob
      t138 = 1/t24/t34/t23
      t139 = t32*t138
      t141 = -0.1849622637793975D0*t134-0.234088495873904D-2*t139
      t143 = t130*t110*t141
      t144 = 0.2571616712452254D-1*t143
      t154 = -0.2534746483141907D0*t134*t74+0.3168433103927383D-1
     #*sigmabb/t25/t34/t56/t5
      t157 = t66*t73*t154*t80
      t158 = 0.1285808356226127D-1*t157
      t160 = t92*t110*t139
      t161 = 0.601985888182142D-4*t160
      t162 = -t114-t127-t144+t158-t161
      t171 = dexp(-0.8778318595271399D-3*t69)
      t172 = t72/t77*t171
      t175 = 1/t83
      t182 = t175*(-0.2306016315371713D-1*t113-0.7320092507805402D-3
     #*t126-0.1383609789223028D0*t143+0.6918048946115138D-1*t157
     #-0.3238871344356278D-3*t160)
      t192 = t89**2
      t194 = t86/t192
      t221 = t66*t78
      t228 = t54*t80
      t232 = -0.4286027854087091D-2*t109*t93*t111*t80
     #-0.1360533322067624D-3*t121*t93*t111*t124-0.2571616712452254D-1
     #*t130*t93*t141*t80+0.1285808356226127D-1*t92*t154*t54*t80
     #-0.601985888182142D-4*t221*t54*t32*t138*t80
     #+0.1285808356226127D-1*t92*t77*t162*t228-t114-t127-t144+t158-t161
      vrhob(i) = vrhob(i)+0.1554534543482745D-1*rhoa*(1.D0*t162*t54
     #+0.7777208750882749D2*t162*t74*t64*t172+(0.3278192763011299D1
     #*t182-0.1714411141634836D-1*t113-0.5442133288270495D-3*t126
     #-0.1028646684980902D0*t143+0.5143233424904509D-1*t157
     #-0.2407943552728568D-3*t160)*t90*t97-1.D0*t194*t97*
     #(0.4917289144516948D1*t182-0.2571616712452254D-1*t113
     #-0.8163199932405743D-3*t126-0.1542970027471353D0*t143
     #+0.7714850137356763D-1*t157-0.3611915329092852D-3*t160)+t91*t232)
      t239 = sigmabb*t37
      t241 = 0.6936084891727404D-1*t27+0.8778318595271399D-3*t239
      t243 = t130*t110*t241
      t244 = 0.2571616712452254D-1*t243
      t245 = t65*t73
      t247 = t245*t27*t80
      t248 = 0.1222199328351994D-2*t247
      t250 = t92*t110*t239
      t251 = 0.2257447080683033D-4*t250
      t252 = -t244+t248+t251
      t264 = t175*(-0.1383609789223028D0*t243+0.6575812588638345D-2
     #*t247+0.1214576754133604D-3*t250)
      vsigmabb(i) = vsigmabb(i)+0.1554534543482745D-1*rhoa*(1.D0*t252
     #*t54+0.7777208750882749D2*t252*t74*t64*t172+
     #(0.3278192763011299D1*t264-0.1028646684980902D0*t243
     #+0.4888797313407978D-2*t247+0.9029788322732131D-4*t250)*t90*t97
     #-1.D0*t194*t97*(0.4917289144516948D1*t264-0.1542970027471353D0
     #*t243+0.7333195970111966D-2*t247+0.135446824840982D-3*t250)+t91*
     #(-0.2571616712452254D-1*t130*t93*t241*t80+0.1222199328351994D-2
     #*t245*t27*t54*t80+0.2257447080683033D-4*t221*t54*sigmabb*t37*t80
     #+0.1285808356226127D-1*t92*t77*t252*t228-t244+t248+t251))
      endif
      t1 = 1/rhoa
      t2 = t1**(1.D0/3.D0)
      trsa = 0.1285808356226127D-1*t2
      t3 = t1**(1.D0/15.D0)
      t4 = t3**2
      t5 = t4**2
      t7 = dexp(-0.5683671053580832D-1*t5)
      t10 = (0.942486901D0+0.349064173D0*t7)**2
      t11 = rhoa**2
      t12 = rhoa**(1.D0/3.D0)
      t13 = t12**2
      t16 = sigmaaa/t13/t11
      t18 = sigmaaa**2
      t19 = t11**2
      t23 = t18/t12/t19/rhoa
      t26 = (0.1D1+0.6936084891727404D-1*t16+0.4389159297635699D-3*t23
     #)**2
      t34 = dexp(-0.4389159297635699D-3*t23)
      t35 = t34**2
      trcba = t10*t26/(0.1D1+0.9505299311782149D-1*t16/t2)*t35
      if(trsa.lt.tolmax*trcba) then
      t2 = 0.3141592653589793D1**2
      t5 = 1/rhoa
      t6 = 1/0.3141592653589793D1*t5
      t7 = t6**(1.D0/3.D0)
      t9 = t6**(1.D0/15.D0)
      t10 = t9**2
      t11 = t10**2
      t13 = dexp(-0.7712625328179681D-1*t11)
      t16 = (0.942486901D0+0.349064173D0*t13)**2
      t19 = 0.3141592653589793D1**(1.D0/3.D0)
      t20 = t19**2
      t22 = 1/t20*sigmaaa
      t23 = rhoa**2
      t24 = rhoa**(1.D0/3.D0)
      t25 = t24**2
      t27 = 1/t25/t23
      t32 = sigmaaa**2
      t34 = t23**2
      t37 = 1/t24/t34/rhoa
      t38 = 1/t19/0.3141592653589793D1*t32*t37
      t41 = (0.1D1+0.1487810599361293D0*t22*t27+0.2019518519390501D-2
     #*t38)**2
      t50 = dexp(0.4039037038781002D-2*t38)
      t54 = expei(-0.1858628590577086D0/t2*t7/t16/t41*(0.1D1
     #+0.1392138426088027D0*t22*t27/t7)*t50)
      t56 = t5**(1.D0/3.D0)
      t57 = t5**(1.D0/15.D0)
      t58 = t57**2
      t59 = t58**2
      t60 = 0.5683671053580832D-1*t59
      t61 = dexp(-t60)
      t63 = 0.942486901D0+0.349064173D0*t61
      t64 = t63**2
      t65 = 1/t64
      t66 = t56*t65
      t67 = sigmaaa*t27
      t69 = t32*t37
      t71 = 0.1D1+0.6936084891727404D-1*t67+0.4389159297635699D-3*t69
      t72 = t71**2
      t73 = 1/t72
      t74 = 1/t56
      t77 = 0.1D1+0.9505299311782149D-1*t67*t74
      t78 = t73*t77
      t79 = 0.8778318595271399D-3*t69
      t80 = dexp(t79)
      t82 = t66*t78*t80
      t83 = dsqrt(t82)
      t86 = 0.6D1+0.4535739597862518D0*t83+0.5143233424904509D-1*t82
      t89 = 0.3D1+0.6803609396793777D0*t83+0.7714850137356763D-1*t82
      t90 = 1/t89
      t91 = t86*t90
      t92 = t66*t73
      t93 = t77*t54
      t97 = 0.1285808356226127D-1*t92*t93*t80+0.1D1
      t98 = t91*t97
      zk(i) = zk(i)+0.1554534543482745D-1*rhob*(1.D0*t54+t98)
      t103 = t56**2
      t106 = 1/t103*t65*t73
      t107 = t77*t80
      t108 = 1/t23
      t110 = t106*t107*t108
      t111 = 0.4286027854087091D-2*t110
      t112 = t5**(1.D0/5.D0)
      t113 = t112**2
      t118 = 1/t113/t64/t63*t73
      t121 = dexp(t79-t60)
      t123 = t118*t77*t108*t121
      t124 = 0.1360533322067624D-3*t123
      t127 = t66/t72/t71
      t131 = sigmaaa/t25/t23/rhoa
      t135 = 1/t24/t34/t23
      t136 = t32*t135
      t138 = -0.1849622637793975D0*t131-0.234088495873904D-2*t136
      t140 = t127*t107*t138
      t141 = 0.2571616712452254D-1*t140
      t151 = -0.2534746483141907D0*t131*t74+0.3168433103927383D-1
     #*sigmaaa/t25/t34/t56/t5
      t154 = t66*t73*t151*t80
      t155 = 0.1285808356226127D-1*t154
      t157 = t92*t107*t136
      t158 = 0.601985888182142D-4*t157
      t159 = -t111-t124-t141+t155-t158
      t168 = dexp(-0.8778318595271399D-3*t69)
      t169 = t72/t77*t168
      t172 = 1/t83
      t179 = t172*(-0.2306016315371713D-1*t110-0.7320092507805402D-3
     #*t123-0.1383609789223028D0*t140+0.6918048946115138D-1*t154
     #-0.3238871344356278D-3*t157)
      t189 = t89**2
      t191 = t86/t189
      t218 = t66*t78
      t225 = t54*t80
      t229 = -0.4286027854087091D-2*t106*t93*t108*t80
     #-0.1360533322067624D-3*t118*t93*t108*t121-0.2571616712452254D-1
     #*t127*t93*t138*t80+0.1285808356226127D-1*t92*t151*t54*t80
     #-0.601985888182142D-4*t218*t54*t32*t135*t80
     #+0.1285808356226127D-1*t92*t77*t159*t225-t111-t124-t141+t155-t158
      vrhoa(i) = vrhoa(i)+0.1554534543482745D-1*rhob*(1.D0*t159*t54
     #+0.7777208750882749D2*t159*t74*t64*t169+(0.3278192763011299D1
     #*t179-0.1714411141634836D-1*t110-0.5442133288270495D-3*t123
     #-0.1028646684980902D0*t140+0.5143233424904509D-1*t154
     #-0.2407943552728568D-3*t157)*t90*t97-1.D0*t191*t97*
     #(0.4917289144516948D1*t179-0.2571616712452254D-1*t110
     #-0.8163199932405743D-3*t123-0.1542970027471353D0*t140
     #+0.7714850137356763D-1*t154-0.3611915329092852D-3*t157)+t91*t229)
      vrhob(i) = vrhob(i)+0.1554534543482745D-1*t54
     #+0.1554534543482745D-1*t98
      t239 = sigmaaa*t37
      t241 = 0.6936084891727404D-1*t27+0.8778318595271399D-3*t239
      t243 = t127*t107*t241
      t244 = 0.2571616712452254D-1*t243
      t245 = t65*t73
      t247 = t245*t27*t80
      t248 = 0.1222199328351994D-2*t247
      t250 = t92*t107*t239
      t251 = 0.2257447080683033D-4*t250
      t252 = -t244+t248+t251
      t264 = t172*(-0.1383609789223028D0*t243+0.6575812588638345D-2
     #*t247+0.1214576754133604D-3*t250)
      vsigmaaa(i) = vsigmaaa(i)+0.1554534543482745D-1*rhob*(1.D0*t252
     #*t54+0.7777208750882749D2*t252*t74*t64*t169+
     #(0.3278192763011299D1*t264-0.1028646684980902D0*t243
     #+0.4888797313407978D-2*t247+0.9029788322732131D-4*t250)*t90*t97
     #-1.D0*t191*t97*(0.4917289144516948D1*t264-0.1542970027471353D0
     #*t243+0.7333195970111966D-2*t247+0.135446824840982D-3*t250)+t91*
     #(-0.2571616712452254D-1*t127*t93*t241*t80+0.1222199328351994D-2
     #*t245*t27*t54*t80+0.2257447080683033D-4*t218*t54*sigmaaa*t37*t80
     #+0.1285808356226127D-1*t92*t77*t252*t225-t244+t248+t251))
      endif
      endif ! rhoa,rhob
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      zk(i) = 0.D0
      vrhoa(i) = 0.D0
      vrhob(i) = 0.D0
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      v2rhoa2(i) = 0.D0
      v2rhob2(i) = 0.D0
      v2rhoab(i) = 0.D0
      v2rhoasigmaaa(i) = 0.D0
      v2rhoasigmaab(i) = 0.D0
      v2rhoasigmabb(i) = 0.D0
      v2rhobsigmaaa(i) = 0.D0
      v2rhobsigmaab(i) = 0.D0
      v2rhobsigmabb(i) = 0.D0
      v2sigmaaa2(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmabb2(i) = 0.D0
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      if(rho.gt.tolmin) then
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      if(rhoa.gt.tolmin) then
      t1 = 1/rhoa
      t2 = t1**(1.D0/3.D0)
      trsa = 0.1285808356226127D-1*t2
      t3 = t1**(1.D0/15.D0)
      t4 = t3**2
      t6 = dexp(-0.5416509560827845D0*t4)
      t8 = t1**(1.D0/6.D0)
      t10 = dexp(-0.8579886777788441D0*t8)
      t13 = (0.1247511874D1+0.812904345D0*t6-0.859614445D0*t10)**2
      t14 = sigmaaa**2
      t15 = rhoa**2
      t16 = t15**2
      t18 = rhoa**(1.D0/3.D0)
      t21 = t14/t18/t16/rhoa
      t24 = (0.1D1+0.4473229026479948D-1*t21)**2
      t26 = t18**2
      t36 = dexp(-0.4473229026479948D-1*t21)
      t37 = t36**2
      trcaa = t13*t24/(0.1D1+0.2481823842598833D0*sigmaaa/t26/t15/t2)
     #*t37
      if(trsa.lt.tolmax*trcaa) then
      t2 = 1/rhoa
      t3 = t2**(1.D0/3.D0)
      t4 = t3**2
      t5 = t2**(1.D0/6.D0)
      t8 = 0.7395908974809453D0*t5+0.1075172860312113D1*t3
      t9 = t8**2
      t10 = 1/t9
      t13 = dexp(-0.3848347315591266D0*t4*t10)
      t14 = rhoa*t13
      t15 = 0.3141592653589793D1**2
      t18 = 1/0.3141592653589793D1*t2
      t19 = t18**(1.D0/3.D0)
      t21 = t18**(1.D0/15.D0)
      t22 = t21**2
      t24 = dexp(-0.630966299458536D0*t22)
      t26 = t18**(1.D0/6.D0)
      t28 = dexp(-0.1038340679664977D1*t26)
      t31 = (0.1247511874D1+0.812904345D0*t24-0.859614445D0*t28)**2
      t34 = 0.3141592653589793D1**(1.D0/3.D0)
      t37 = sigmaaa**2
      t39 = rhoa**2
      t40 = t39**2
      t41 = t40*rhoa
      t42 = rhoa**(1.D0/3.D0)
      t44 = 1/t42/t41
      t45 = 1/t34/0.3141592653589793D1*t37*t44
      t48 = (0.1D1+0.2058200272046996D0*t45)**2
      t50 = t34**2
      t53 = t42**2
      t55 = 1/t53/t39
      t63 = dexp(0.4116400544093991D0*t45)
      t67 = expei(-0.1858628590577086D0/t15*t19/t31/t48*(0.1D1
     #+0.3634859066227017D0/t50*sigmaaa*t55/t19)*t63)
      t69 = t2**(1.D0/15.D0)
      t70 = t69**2
      t72 = dexp(-0.5416509560827845D0*t70)
      t75 = dexp(-0.8579886777788441D0*t5)
      t77 = 0.1247511874D1+0.812904345D0*t72-0.859614445D0*t75
      t78 = t77**2
      t79 = 1/t78
      t80 = t3*t79
      t81 = t37*t44
      t83 = 0.1D1+0.4473229026479948D-1*t81
      t84 = t83**2
      t85 = 1/t84
      t87 = 1/t3
      t90 = 0.1D1+0.2481823842598833D0*sigmaaa*t55*t87
      t91 = t85*t90
      t93 = dexp(0.8946458052959895D-1*t81)
      t95 = t80*t91*t93
      t96 = dsqrt(t95)
      t99 = 0.6D1+0.4535739597862518D0*t96+0.5143233424904509D-1*t95
      t102 = 0.3D1+0.6803609396793777D0*t96+0.7714850137356763D-1*t95
      t103 = 1/t102
      t104 = t99*t103
      t105 = t80*t85
      t106 = t90*t67
      t110 = 0.1285808356226127D-1*t105*t106*t93+0.1D1
      t112 = 1.D0*t67+t104*t110
      zk(i) = zk(i)+0.1554534543482745D-1*t14*t112
      t116 = t13*t112
      t118 = t87*t10
      t119 = 1/t39
      t123 = 1/t9/t8
      t124 = t4*t123
      t125 = t5**2
      t126 = t125**2
      t127 = t126*t5
      t128 = 1/t127
      t129 = t128*t119
      t131 = 1/t4
      t134 = -0.1232651495801576D0*t129-0.358390953437371D0*t131*t119
      t137 = 0.2565564877060844D0*t118*t119+0.7696694631182532D0*t124
     #*t134
      t138 = rhoa*t137
      t141 = t131*t79
      t142 = t141*t85
      t143 = t90*t93
      t145 = t142*t143*t119
      t146 = 0.4286027854087091D-2*t145
      t148 = 1/t78/t77
      t149 = t3*t148
      t150 = t149*t85
      t151 = t70**2
      t153 = t151**2
      t154 = t153*t151*t69
      t155 = 1/t154
      t161 = 0.5870805542307996D-1*t155*t119*t72-0.1229232435108575D0
     #*t129*t75
      t163 = t150*t143*t161
      t164 = 0.2571616712452254D-1*t163
      t166 = 1/t84/t83
      t167 = t80*t166
      t168 = t40*t39
      t170 = 1/t42/t168
      t171 = t37*t170
      t172 = t143*t171
      t173 = t167*t172
      t174 = 0.613516294566526D-2*t173
      t175 = t39*rhoa
      t177 = 1/t53/t175
      t182 = 1/t53/t40
      t183 = sigmaaa*t182
      t185 = 1/t3/t2
      t188 = -0.6618196913596887D0*sigmaaa*t177*t87
     #+0.8272746141996109D-1*t183*t185
      t189 = t85*t188
      t191 = t80*t189*t93
      t192 = 0.1285808356226127D-1*t191
      t193 = t105*t172
      t194 = 0.613516294566526D-2*t193
      t195 = -t146-t164+t174+t192-t194
      t196 = t195*t67
      t198 = -t195
      t199 = t198*t87
      t200 = t199*t78
      t201 = 1/t90
      t202 = t84*t201
      t204 = dexp(-0.8946458052959895D-1*t81)
      t205 = t202*t204
      t208 = 1/t96
      t214 = -0.2306016315371713D-1*t145-0.1383609789223028D0*t163
     #+0.3300908517586267D-1*t173+0.6918048946115138D-1*t191
     #-0.3300908517586267D-1*t193
      t215 = t208*t214
      t222 = 0.3278192763011299D1*t215-0.1714411141634836D-1*t145
     #-0.1028646684980902D0*t163+0.2454065178266104D-1*t173
     #+0.5143233424904509D-1*t191-0.2454065178266104D-1*t193
      t223 = t222*t103
      t225 = t102**2
      t226 = 1/t225
      t227 = t99*t226
      t234 = 0.4917289144516948D1*t215-0.2571616712452254D-1*t145
     #-0.1542970027471353D0*t163+0.3681097767399156D-1*t173
     #+0.7714850137356763D-1*t191-0.3681097767399156D-1*t193
      t235 = t110*t234
      t238 = t119*t93
      t242 = t161*t93
      t246 = t166*t90
      t247 = t80*t246
      t248 = t67*t37
      t249 = t170*t93
      t250 = t248*t249
      t253 = t188*t67
      t257 = t80*t91
      t261 = t67*t93
      t265 = -0.4286027854087091D-2*t142*t106*t238
     #-0.2571616712452254D-1*t150*t106*t242+0.613516294566526D-2*t247
     #*t250+0.1285808356226127D-1*t105*t253*t93-0.613516294566526D-2
     #*t257*t250+0.1285808356226127D-1*t105*t90*t195*t261-t146-t164
     #+t174+t192-t194
      t267 = 1.D0*t196-0.7777208750882749D2*t200*t205+t223*t110-1.D0
     #*t227*t235+t104*t265
      vrhoa(i) = vrhoa(i)+0.1554534543482745D-1*t116
     #+0.1554534543482745D-1*t138*t116+0.1554534543482745D-1*t14*t267
      t271 = sigmaaa*t44
      t272 = t143*t271
      t273 = t167*t272
      t274 = 0.2300686104624472D-2*t273
      t275 = t79*t85
      t276 = t55*t93
      t277 = t275*t276
      t278 = 0.3191149835494816D-2*t277
      t279 = t105*t272
      t280 = 0.2300686104624472D-2*t279
      t281 = -t274+t278+t280
      t282 = t281*t67
      t284 = -t281
      t285 = t284*t87
      t292 = -0.123784069409485D-1*t273+0.1716937881873428D-1*t277
     #+0.123784069409485D-1*t279
      t293 = t208*t292
      t298 = 0.3278192763011299D1*t293-0.9202744418497889D-2*t273
     #+0.1276459934197926D-1*t277+0.9202744418497889D-2*t279
      t299 = t298*t103
      t305 = 0.4917289144516948D1*t293-0.1380411662774683D-1*t273
     #+0.1914689901296889D-1*t277+0.1380411662774683D-1*t279
      t306 = t110*t305
      t309 = t67*sigmaaa
      t310 = t44*t93
      t311 = t309*t310
      t324 = -0.2300686104624472D-2*t247*t311+0.3191149835494816D-2
     #*t275*t55*t67*t93+0.2300686104624472D-2*t257*t311
     #+0.1285808356226127D-1*t105*t90*t281*t261-t274+t278+t280
      t326 = 1.D0*t282-0.7777208750882749D2*t285*t78*t205+t299*t110
     #-1.D0*t227*t306+t104*t324
      vsigmaaa(i) = vsigmaaa(i)+0.1554534543482745D-1*t14*t326
      t333 = t13*t267
      t336 = 1/t40
      t343 = 1/t175
      t346 = t9**2
      t349 = t134**2
      t354 = 1/t127/t2*t336
      t356 = t128*t343
      t359 = 1/t4/t2
      t360 = t359*t336
      t371 = t137**2
      t377 = t141*t166
      t378 = t40**2
      t380 = 1/t42/t378
      t382 = t143*t380*t37
      t383 = t377*t382
      t384 = 0.4090108630443506D-2*t383
      t385 = t188*t93
      t387 = t150*t385*t161
      t388 = 0.5143233424904509D-1*t387
      t410 = 0.5088031470000263D-1/t154/t2*t336*t72
     #-0.1174161108461599D0*t155*t343*t72+0.4239903246622982D-2/t153
     #/t70/t69/t2*t336*t72-0.1024360362590479D0*t354*t75
     #+0.245846487021715D0*t356*t75-0.1757779186136125D-1*t360*t75
      t412 = t150*t143*t410
      t413 = 0.2571616712452254D-1*t412
      t415 = t142*t385*t119
      t416 = 0.8572055708174181D-2*t415
      t418 = t142*t143*t343
      t419 = 0.8572055708174181D-2*t418
      t421 = t359*t79*t85
      t423 = t421*t143*t336
      t424 = 0.2857351902724727D-2*t423
      t425 = t142*t382
      t426 = 0.4090108630443506D-2*t425
      t427 = t78**2
      t430 = t3/t427*t85
      t431 = t161**2
      t433 = t430*t143*t431
      t434 = 0.7714850137356763D-1*t433
      t435 = t131*t148
      t439 = t435*t85*t143*t119*t161
      t440 = 0.1714411141634836D-1*t439
      t443 = 1/t42/t40/t175
      t445 = t143*t37*t443
      t446 = t105*t445
      t447 = 0.3885603198921331D-1*t446
      t448 = t37**2
      t451 = 1/t53/t378/t40
      t453 = t143*t448*t451
      t454 = t105*t453
      t455 = 0.2927358823544966D-2*t454
      t470 = 0.2426672201652192D1*t183*t87-0.606668050413048D0*sigmaaa
     #/t53/t41*t185+0.1103032818932815D0*sigmaaa/t53/t168/t3/t119
      t473 = t80*t85*t470*t93
      t474 = 0.1285808356226127D-1*t473
      t475 = t385*t171
      t476 = t105*t475
      t477 = 0.1227032589133052D-1*t476
      t478 = t167*t453
      t479 = 0.5854717647089932D-2*t478
      t480 = t167*t445
      t481 = 0.3885603198921331D-1*t480
      t482 = t84**2
      t483 = 1/t482
      t484 = t80*t483
      t485 = t484*t453
      t486 = 0.4391038235317449D-2*t485
      t487 = t167*t475
      t488 = 0.1227032589133052D-1*t487
      t489 = t149*t91
      t490 = t242*t171
      t491 = t489*t490
      t492 = 0.2454065178266104D-1*t491
      t493 = t149*t246
      t494 = t493*t490
      t495 = 0.2454065178266104D-1*t494
      t496 = -t384-t388-t413-t416+t419-t424+t426+t434+t440+t447+t455
     #+t474-t477-t479-t481+t486+t488+t492-t495
      t499 = t195**2
      t502 = t195*t198
      t504 = t78*t84
      t506 = t504*t201*t204
      t514 = t198**2
      t530 = t78*t83
      t531 = t199*t530
      t534 = t201*t37*t170*t204
      t537 = t90**2
      t539 = t84/t537
      t544 = t199*t504
      t586 = -0.2200605678390844D-1*t383-0.2767219578446055D0*t387
     #-0.1383609789223028D0*t412-0.4612032630743426D-1*t415
     #+0.4612032630743426D-1*t418-0.1537344210247809D-1*t423
     #+0.2200605678390844D-1*t425+0.4150829367669083D0*t433
     #+0.9224065261486851D-1*t439+0.2090575394471302D0*t446
     #+0.1575010111426323D-1*t454+0.6918048946115138D-1*t473
     #-0.6601817035172533D-1*t476-0.3150020222852647D-1*t478
     #-0.2090575394471302D0*t480+0.2362515167139485D-1*t485
     #+0.6601817035172533D-1*t487+0.1320363407034507D0*t491
     #-0.1320363407034507D0*t494
      t587 = t208*t586
      t590 = 1/t96/t95
      t591 = t214**2
      t592 = t590*t591
      t594 = 0.1170943529417986D-1*t454+0.5143233424904509D-1*t473
     #-0.4908130356532208D-1*t476-0.2341887058835973D-1*t478
     #-0.1554241279568532D0*t480+0.175641529412698D-1*t485
     #+0.4908130356532208D-1*t487+0.9816260713064415D-1*t491
     #-0.9816260713064415D-1*t494+0.3278192763011299D1*t587
     #-0.2369304401100098D2*t592
      t598 = t222*t226
      t605 = t99/t225/t102
      t606 = t234**2
      t635 = 0.175641529412698D-1*t454+0.7714850137356763D-1*t473
     #-0.7362195534798311D-1*t476-0.3512830588253959D-1*t478
     #-0.2331361919352799D0*t480+0.263462294119047D-1*t485
     #+0.7362195534798311D-1*t487+0.1472439106959662D0*t491
     #-0.1472439106959662D0*t494+0.4917289144516948D1*t587
     #-0.3553956601650148D2*t592
      t640 = t67*t161
      t641 = t171*t93
      t642 = t640*t641
      t656 = t141*t91
      t662 = t67*t448*t451*t93
      t668 = t80*t166*t188
      t677 = t248*t443*t93
      t681 = t80*t483*t90
      t686 = t474+0.2454065178266104D-1*t489*t642
     #+0.8572055708174181D-2*t142*t106*t343*t93-0.8572055708174181D-2
     #*t142*t253*t238+0.1285808356226127D-1*t105*t470*t67*t93
     #-0.8572055708174181D-2*t656*t196*t238-0.5854717647089932D-2*t247
     #*t662+0.2927358823544966D-2*t257*t662+0.1227032589133052D-1*t668
     #*t250+0.1714411141634836D-1*t435*t91*t67*t119*t242
     #+0.3885603198921331D-1*t257*t677+0.4391038235317449D-2*t681*t662
     #-0.3885603198921331D-1*t247*t677
      t687 = t196*t641
      t690 = t80*t189
      t701 = 0.1227032589133052D-1*t247*t687-0.1227032589133052D-1
     #*t690*t250-0.5143233424904509D-1*t489*t196*t242-t384-t388-t413
     #-t416+t419-0.2454065178266104D-1*t493*t642-t424+t426
     #-0.5143233424904509D-1*t150*t253*t242+t434
      t713 = 0.1285808356226127D-1*t105*t90*t499*t261+t440+t447+t455
     #-t477-t479-0.1227032589133052D-1*t257*t687-t481+t486+t488+t492
     #-t495+0.7714850137356763D-1*t430*t106*t431*t93
      t729 = 1/t77
      t741 = 1/t83
      t747 = t67*t380*t37*t93
      t753 = t141*t246
      t756 = -0.2857351902724727D-2*t421*t106*t336*t93
     #+0.2571616712452254D-1*t105*t188*t195*t261+0.1285808356226127D-1
     #*t105*t90*t496*t261+0.4771444294911944D0*t198*t37*t170+0.2D1
     #*t729*t198*t161-0.1D1*t188*t198*t201-0.2571616712452254D-1*t150
     #*t106*t410*t93-0.1D1*t514-0.4771444294911944D0*t741*t198*t171
     #+0.4090108630443506D-2*t656*t747+0.3333333333333333D0*t2*t198
     #-0.2D1*t502-0.4090108630443506D-2*t753*t747
      s1 = 1.D0*t496*t67+1.D0*t499*t67-0.155544175017655D3*t502*t87
     #*t506+0.7777208750882749D2*t496*t87*t78*t205
     #-0.7777208750882749D2*t514*t87*t78*t205-0.2592402916960916D2
     #*t198*t185*t78*t202*t119*t204-0.155544175017655D3*t199*t77*t202
     #*t161*t204+0.3710851832473874D2*t531*t534
      t760 = s1+0.7777208750882749D2*t200*t539*t188*t204
     #-0.3710851832473874D2*t544*t534+(-0.1636043452177403D-1*t383
     #-0.2057293369961804D0*t387-0.1028646684980902D0*t412
     #-0.3428822283269673D-1*t415+0.3428822283269673D-1*t418
     #-0.1142940761089891D-1*t423+0.1636043452177403D-1*t425
     #+0.3085940054942705D0*t433+0.6857644566539345D-1*t439
     #+0.1554241279568532D0*t446+t594)*t103*t110-2.D0*t598*t235+2.D0
     #*t223*t265+2.D0*t605*t110*t606-2.D0*t227*t265*t234-1.D0*t227
     #*t110*(-0.2454065178266104D-1*t383-0.3085940054942705D0*t387
     #-0.1542970027471353D0*t412-0.5143233424904509D-1*t415
     #+0.5143233424904509D-1*t418-0.1714411141634836D-1*t423
     #+0.2454065178266104D-1*t425+0.4628910082414058D0*t433
     #+0.1028646684980902D0*t439+0.2331361919352799D0*t446+t635)+t104*
     #(t686+t701+t713+t756)
      v2rhoa2(i) = v2rhoa2(i)+0.310906908696549D-1*t137*t13*t112
     #+0.310906908696549D-1*t333+0.1554534543482745D-1*rhoa*
     #(0.8551882923536146D-1*t185*t10*t336-0.1026225950824338D1*t87
     #*t123*t119*t134-0.5131129754121688D0*t118*t343
     #-0.2309008389354759D1*t4/t346*t349+0.7696694631182532D0*t124*(
     #-0.1027209579834646D0*t354+0.2465302991603151D0*t356
     #-0.2389273022915807D0*t360+0.7167819068747421D0*t131*t343))*t116
     #+0.1554534543482745D-1*rhoa*t371*t116+0.310906908696549D-1*t138
     #*t333+0.1554534543482745D-1*t14*t760
      t764 = t13*t326
      t769 = t143*t443*sigmaaa
      t770 = t377*t769
      t771 = 0.7668953682081574D-3*t770
      t772 = t177*t79
      t774 = t772*t85*t93
      t775 = 0.1063716611831605D-2*t774
      t776 = t142*t769
      t777 = 0.7668953682081574D-3*t776
      t778 = t242*t271
      t779 = t493*t778
      t780 = 0.4601372209248945D-2*t779
      t781 = t148*t85
      t783 = t781*t276*t161
      t784 = 0.6382299670989632D-2*t783
      t785 = t489*t778
      t786 = 0.4601372209248945D-2*t785
      t787 = t37*sigmaaa
      t790 = 1/t53/t378/t175
      t792 = t143*t787*t790
      t793 = t484*t792
      t794 = 0.1646639338244043D-2*t793
      t795 = t79*t166
      t797 = 1/t378/rhoa
      t799 = t797*t93*t37
      t800 = t795*t799
      t801 = 0.1522639367678093D-2*t800
      t802 = t167*t792
      t803 = 0.2195519117658725D-2*t802
      t805 = t143*sigmaaa*t170
      t806 = t167*t805
      t807 = 0.1227032589133052D-1*t806
      t808 = t385*t271
      t809 = t167*t808
      t810 = 0.2300686104624472D-2*t809
      t815 = -0.6618196913596887D0*t177*t87+0.8272746141996109D-1*t182
     #*t185
      t818 = t80*t85*t815*t93
      t819 = 0.1285808356226127D-1*t818
      t820 = t105*t808
      t821 = 0.2300686104624472D-2*t820
      t822 = t275*t799
      t823 = 0.1522639367678093D-2*t822
      t824 = t105*t792
      t825 = 0.1097759558829362D-2*t824
      t826 = t105*t805
      t827 = 0.1227032589133052D-1*t826
      t828 = t771-t775-t777+t780-t784-t786-t794+t801+t803+t807-t810
     #+t819+t821-t823-t825-t827
      t831 = t195*t281
      t834 = t195*t284
      t838 = t281*t198
      t847 = t198*t284
      t853 = t201*sigmaaa*t44*t204
      t859 = t539*t55*t204
      t865 = t590*t214*t292
      t883 = 0.4126135646982833D-2*t770-0.5723126272911426D-2*t774
     #-0.4126135646982833D-2*t776+0.24756813881897D-1*t779
     #-0.3433875763746856D-1*t783-0.24756813881897D-1*t785
     #-0.8859431876773069D-2*t793+0.8192273461183165D-2*t800
     #+0.1181257583569743D-1*t802+0.6601817035172533D-1*t806
     #-0.123784069409485D-1*t809+0.6918048946115138D-1*t818
     #+0.123784069409485D-1*t820-0.8192273461183165D-2*t822
     #-0.5906287917848713D-2*t824-0.6601817035172533D-1*t826
      t884 = t208*t883
      t902 = -0.2369304401100098D2*t865+0.3278192763011299D1*t884
     #+0.306758147283263D-2*t770-0.4254866447326421D-2*t774
     #-0.306758147283263D-2*t776+0.1840548883699578D-1*t779
     #-0.2552919868395853D-1*t783-0.1840548883699578D-1*t785
     #-0.6586557352976174D-2*t793+0.6090557470712371D-2*t800
     #+0.8782076470634898D-2*t802+0.4908130356532208D-1*t806
     #-0.9202744418497889D-2*t809+0.5143233424904509D-1*t818
     #+0.9202744418497889D-2*t820-0.6090557470712371D-2*t822
     #-0.4391038235317449D-2*t824-0.4908130356532208D-1*t826
      t908 = t298*t226
      t935 = -0.3553956601650148D2*t865+0.4917289144516948D1*t884
     #+0.4601372209248945D-2*t770-0.6382299670989632D-2*t774
     #-0.4601372209248945D-2*t776+0.2760823325549367D-1*t779
     #-0.3829379802593779D-1*t783-0.2760823325549367D-1*t785
     #-0.9879836029464261D-2*t793+0.9135836206068557D-2*t800
     #+0.1317311470595235D-1*t802+0.7362195534798311D-1*t806
     #-0.1380411662774683D-1*t809+0.7714850137356763D-1*t818
     #+0.1380411662774683D-1*t820-0.9135836206068557D-2*t822
     #-0.6586557352976174D-2*t824-0.7362195534798311D-1*t826
      t943 = t271*t93
      t944 = t196*t943
      t947 = t275*t55
      t951 = -0.2300686104624472D-2*t247*t944+t780+t771
     #+0.3191149835494816D-2*t947*t196*t93-t777-t775-t794+t801+t803
     #+t821-t823-t825
      t952 = t640*t943
      t963 = t67*t787*t790*t93
      t966 = t309*t249
      t974 = -t786-t784-t827-0.4601372209248945D-2*t489*t952
     #+0.4601372209248945D-2*t493*t952-0.1063716611831605D-2*t772*t85
     #*t67*t93+t819-0.1097759558829362D-2*t257*t963-t810+t807
     #-0.1227032589133052D-1*t257*t966+0.1285808356226127D-1*t257*t831
     #*t261+0.2195519117658725D-2*t247*t963
      t978 = t67*t443*sigmaaa*t93
      t989 = t282*t641
      t1004 = t741*t284
      t1010 = 0.7668953682081574D-3*t753*t978-0.6382299670989632D-2
     #*t781*t55*t640*t93+0.1285808356226127D-1*t105*t815*t67*t93
     #+0.613516294566526D-2*t247*t989-0.1D1*t834-0.613516294566526D-2
     #*t257*t989+0.2D1*t729*t284*t161-0.1D1*t188*t284*t201
     #+0.4771444294911944D0*t284*t37*t170-0.4771444294911944D0*t1004
     #*t171+0.3333333333333333D0*t2*t284-0.1D1*t838
      t1020 = t248*t93
      t1045 = -0.1D1*t847-0.2571616712452254D-1*t489*t282*t242
     #+0.1227032589133052D-1*t247*t966-0.1646639338244043D-2*t681*t963
     #-0.1522639367678093D-2*t275*t797*t1020+0.1285808356226127D-1
     #*t105*t188*t281*t261-0.7668953682081574D-3*t656*t978
     #-0.4286027854087091D-2*t656*t282*t238+0.2300686104624472D-2*t690
     #*t311+0.1285808356226127D-1*t105*t90*t828*t261
     #+0.1522639367678093D-2*t795*t797*t1020+0.2300686104624472D-2
     #*t257*t944-0.2300686104624472D-2*t668*t311
      t1049 = 1.D0*t828*t67+1.D0*t831*t67-0.7777208750882749D2*t834
     #*t87*t506-0.7777208750882749D2*t838*t87*t506
     #+0.7777208750882749D2*t828*t87*t78*t205-0.7777208750882749D2
     #*t847*t87*t506-0.1391569437177703D2*t531*t853
     #+0.1930166210680909D2*t198*t131*t78*t859+0.1391569437177703D2
     #*t544*t853+t902*t103*t110-1.D0*t598*t306+t223*t324-1.D0*t908
     #*t235+2.D0*t605*t235*t305-1.D0*t227*t324*t234-1.D0*t227*t110
     #*t935+t299*t265-1.D0*t227*t265*t305+t104*(t951+t974+t1010+t1045)
      v2rhoasigmaaa(i) = v2rhoasigmaaa(i)+0.1554534543482745D-1*t764
     #+0.1554534543482745D-1*t138*t764+0.1554534543482745D-1*t14*t1049
      t1055 = 1/t53/t378/t39
      t1057 = t143*t37*t1055
      t1058 = t484*t1057
      t1059 = 0.6174897518415163D-3*t1058
      t1060 = 1/t378
      t1062 = t1060*t93*sigmaaa
      t1063 = t795*t1062
      t1064 = 0.114197952575857D-2*t1063
      t1065 = t167*t1057
      t1066 = 0.8233196691220217D-3*t1065
      t1067 = t143*t44
      t1068 = t167*t1067
      t1069 = 0.2300686104624472D-2*t1068
      t1070 = t275*t1062
      t1071 = 0.114197952575857D-2*t1070
      t1072 = t105*t1057
      t1073 = 0.4116598345610109D-3*t1072
      t1074 = t105*t1067
      t1075 = 0.2300686104624472D-2*t1074
      t1076 = t1059-t1064-t1066-t1069+t1071+t1073+t1075
      t1079 = t281**2
      t1082 = t281*t284
      t1091 = t284**2
      t1106 = t292**2
      t1107 = t590*t1106
      t1117 = t208*(0.3322286953789901D-2*t1058-0.6144205095887373D-2
     #*t1063-0.4429715938386535D-2*t1065-0.123784069409485D-1*t1068
     #+0.6144205095887373D-2*t1070+0.2214857969193267D-2*t1072
     #+0.123784069409485D-1*t1074)
      t1133 = t305**2
      t1154 = t309*t93
      t1168 = t248*t1055*t93
      t1171 = t282*t943
      t1180 = t106*t310
      t1185 = 0.114197952575857D-2*t275*t1060*t1154
     #+0.6382299670989632D-2*t947*t282*t93-0.2481823842598833D0*t55
     #*t284*t87*t201-0.114197952575857D-2*t795*t1060*t1154
     #-0.8233196691220217D-3*t247*t1168-0.4601372209248945D-2*t247
     #*t1171+0.1789291610591979D0*t1004*t271+0.6174897518415163D-3
     #*t681*t1168+0.4116598345610109D-3*t257*t1168
     #-0.2300686104624472D-2*t167*t1180-0.2D1*t1082-0.1D1*t1091
      t1201 = 0.1285808356226127D-1*t105*t90*t1079*t261+t1059-t1064
     #-t1066-t1069+t1071+t1073+t1075+0.4601372209248945D-2*t257*t1171
     #-0.1789291610591979D0*t284*sigmaaa*t44+0.1285808356226127D-1
     #*t105*t90*t1076*t261+0.2300686104624472D-2*t105*t1180
      s1 = 1.D0*t1076*t67+1.D0*t1079*t67-0.155544175017655D3*t1082*t87
     #*t506+0.7777208750882749D2*t1076*t87*t78*t205
     #-0.7777208750882749D2*t1091*t87*t78*t205-0.1391569437177703D2
     #*t285*t530*t853+0.1930166210680909D2*t284*t131*t78*t859
      t1204 = s1+0.1391569437177703D2*t285*t504*t853+(
     #-0.2369304401100098D2*t1107+0.3278192763011299D1*t1117
     #+0.2469959007366065D-2*t1058-0.4567918103034278D-2*t1063
     #-0.3293278676488087D-2*t1065-0.9202744418497889D-2*t1068
     #+0.4567918103034278D-2*t1070+0.1646639338244043D-2*t1072
     #+0.9202744418497889D-2*t1074)*t103*t110-2.D0*t908*t306+2.D0*t299
     #*t324+2.D0*t605*t110*t1133-2.D0*t227*t324*t305-1.D0*t227*t110*(
     #-0.3553956601650148D2*t1107+0.4917289144516948D1*t1117
     #+0.3704938511049098D-2*t1058-0.6851877154551418D-2*t1063
     #-0.493991801473213D-2*t1065-0.1380411662774683D-1*t1068
     #+0.6851877154551418D-2*t1070+0.2469959007366065D-2*t1072
     #+0.1380411662774683D-1*t1074)+t104*(t1185+t1201)
      v2sigmaaa2(i) = v2sigmaaa2(i)+0.1554534543482745D-1*t14*t1204
      endif
      endif ! rhoa
      if(rhob.gt.tolmin) then
      t1 = 1/rhob
      t2 = t1**(1.D0/3.D0)
      trsb = 0.1285808356226127D-1*t2
      t3 = t1**(1.D0/15.D0)
      t4 = t3**2
      t6 = dexp(-0.5416509560827845D0*t4)
      t8 = t1**(1.D0/6.D0)
      t10 = dexp(-0.8579886777788441D0*t8)
      t13 = (0.1247511874D1+0.812904345D0*t6-0.859614445D0*t10)**2
      t14 = sigmabb**2
      t15 = rhob**2
      t16 = t15**2
      t18 = rhob**(1.D0/3.D0)
      t21 = t14/t18/t16/rhob
      t24 = (0.1D1+0.4473229026479948D-1*t21)**2
      t26 = t18**2
      t36 = dexp(-0.4473229026479948D-1*t21)
      t37 = t36**2
      trcbb = t13*t24/(0.1D1+0.2481823842598833D0*sigmabb/t26/t15/t2)
     #*t37
      if(trsb.lt.tolmax*trcbb) then
      t2 = 1/rhob
      t3 = t2**(1.D0/3.D0)
      t4 = t3**2
      t5 = t2**(1.D0/6.D0)
      t8 = 0.7395908974809453D0*t5+0.1075172860312113D1*t3
      t9 = t8**2
      t10 = 1/t9
      t13 = dexp(-0.3848347315591266D0*t4*t10)
      t14 = rhob*t13
      t15 = 0.3141592653589793D1**2
      t18 = 1/0.3141592653589793D1*t2
      t19 = t18**(1.D0/3.D0)
      t21 = t18**(1.D0/15.D0)
      t22 = t21**2
      t24 = dexp(-0.630966299458536D0*t22)
      t26 = t18**(1.D0/6.D0)
      t28 = dexp(-0.1038340679664977D1*t26)
      t31 = (0.1247511874D1+0.812904345D0*t24-0.859614445D0*t28)**2
      t34 = 0.3141592653589793D1**(1.D0/3.D0)
      t37 = sigmabb**2
      t39 = rhob**2
      t40 = t39**2
      t41 = t40*rhob
      t42 = rhob**(1.D0/3.D0)
      t44 = 1/t42/t41
      t45 = 1/t34/0.3141592653589793D1*t37*t44
      t48 = (0.1D1+0.2058200272046996D0*t45)**2
      t50 = t34**2
      t53 = t42**2
      t55 = 1/t53/t39
      t63 = dexp(0.4116400544093991D0*t45)
      t67 = expei(-0.1858628590577086D0/t15*t19/t31/t48*(0.1D1
     #+0.3634859066227017D0/t50*sigmabb*t55/t19)*t63)
      t69 = t2**(1.D0/15.D0)
      t70 = t69**2
      t72 = dexp(-0.5416509560827845D0*t70)
      t75 = dexp(-0.8579886777788441D0*t5)
      t77 = 0.1247511874D1+0.812904345D0*t72-0.859614445D0*t75
      t78 = t77**2
      t79 = 1/t78
      t80 = t3*t79
      t81 = t37*t44
      t83 = 0.1D1+0.4473229026479948D-1*t81
      t84 = t83**2
      t85 = 1/t84
      t87 = 1/t3
      t90 = 0.1D1+0.2481823842598833D0*sigmabb*t55*t87
      t91 = t85*t90
      t93 = dexp(0.8946458052959895D-1*t81)
      t95 = t80*t91*t93
      t96 = dsqrt(t95)
      t99 = 0.6D1+0.4535739597862518D0*t96+0.5143233424904509D-1*t95
      t102 = 0.3D1+0.6803609396793777D0*t96+0.7714850137356763D-1*t95
      t103 = 1/t102
      t104 = t99*t103
      t105 = t80*t85
      t106 = t90*t67
      t110 = 0.1285808356226127D-1*t105*t106*t93+0.1D1
      t112 = 1.D0*t67+t104*t110
      zk(i) = zk(i)+0.1554534543482745D-1*t14*t112
      t116 = t13*t112
      t118 = t87*t10
      t119 = 1/t39
      t123 = 1/t9/t8
      t124 = t4*t123
      t125 = t5**2
      t126 = t125**2
      t127 = t126*t5
      t128 = 1/t127
      t129 = t128*t119
      t131 = 1/t4
      t134 = -0.1232651495801576D0*t129-0.358390953437371D0*t131*t119
      t137 = 0.2565564877060844D0*t118*t119+0.7696694631182532D0*t124
     #*t134
      t138 = rhob*t137
      t141 = t131*t79
      t142 = t141*t85
      t143 = t90*t93
      t145 = t142*t143*t119
      t146 = 0.4286027854087091D-2*t145
      t148 = 1/t78/t77
      t149 = t3*t148
      t150 = t149*t85
      t151 = t70**2
      t153 = t151**2
      t154 = t153*t151*t69
      t155 = 1/t154
      t161 = 0.5870805542307996D-1*t155*t119*t72-0.1229232435108575D0
     #*t129*t75
      t163 = t150*t143*t161
      t164 = 0.2571616712452254D-1*t163
      t166 = 1/t84/t83
      t167 = t80*t166
      t168 = t40*t39
      t170 = 1/t42/t168
      t171 = t37*t170
      t172 = t143*t171
      t173 = t167*t172
      t174 = 0.613516294566526D-2*t173
      t175 = t39*rhob
      t177 = 1/t53/t175
      t182 = 1/t53/t40
      t183 = sigmabb*t182
      t185 = 1/t3/t2
      t188 = -0.6618196913596887D0*sigmabb*t177*t87
     #+0.8272746141996109D-1*t183*t185
      t189 = t85*t188
      t191 = t80*t189*t93
      t192 = 0.1285808356226127D-1*t191
      t193 = t105*t172
      t194 = 0.613516294566526D-2*t193
      t195 = -t146-t164+t174+t192-t194
      t196 = t195*t67
      t198 = -t195
      t199 = t198*t87
      t200 = t199*t78
      t201 = 1/t90
      t202 = t84*t201
      t204 = dexp(-0.8946458052959895D-1*t81)
      t205 = t202*t204
      t208 = 1/t96
      t214 = -0.2306016315371713D-1*t145-0.1383609789223028D0*t163
     #+0.3300908517586267D-1*t173+0.6918048946115138D-1*t191
     #-0.3300908517586267D-1*t193
      t215 = t208*t214
      t222 = 0.3278192763011299D1*t215-0.1714411141634836D-1*t145
     #-0.1028646684980902D0*t163+0.2454065178266104D-1*t173
     #+0.5143233424904509D-1*t191-0.2454065178266104D-1*t193
      t223 = t222*t103
      t225 = t102**2
      t226 = 1/t225
      t227 = t99*t226
      t234 = 0.4917289144516948D1*t215-0.2571616712452254D-1*t145
     #-0.1542970027471353D0*t163+0.3681097767399156D-1*t173
     #+0.7714850137356763D-1*t191-0.3681097767399156D-1*t193
      t235 = t110*t234
      t238 = t119*t93
      t242 = t161*t93
      t246 = t166*t90
      t247 = t80*t246
      t248 = t67*t37
      t249 = t170*t93
      t250 = t248*t249
      t253 = t188*t67
      t257 = t80*t91
      t261 = t67*t93
      t265 = -0.4286027854087091D-2*t142*t106*t238
     #-0.2571616712452254D-1*t150*t106*t242+0.613516294566526D-2*t247
     #*t250+0.1285808356226127D-1*t105*t253*t93-0.613516294566526D-2
     #*t257*t250+0.1285808356226127D-1*t105*t90*t195*t261-t146-t164
     #+t174+t192-t194
      t267 = 1.D0*t196-0.7777208750882749D2*t200*t205+t223*t110-1.D0
     #*t227*t235+t104*t265
      vrhob(i) = vrhob(i)+0.1554534543482745D-1*t116
     #+0.1554534543482745D-1*t138*t116+0.1554534543482745D-1*t14*t267
      t271 = sigmabb*t44
      t272 = t143*t271
      t273 = t167*t272
      t274 = 0.2300686104624472D-2*t273
      t275 = t79*t85
      t276 = t55*t93
      t277 = t275*t276
      t278 = 0.3191149835494816D-2*t277
      t279 = t105*t272
      t280 = 0.2300686104624472D-2*t279
      t281 = -t274+t278+t280
      t282 = t281*t67
      t284 = -t281
      t292 = -0.123784069409485D-1*t273+0.1716937881873428D-1*t277
     #+0.123784069409485D-1*t279
      t293 = t208*t292
      t298 = 0.3278192763011299D1*t293-0.9202744418497889D-2*t273
     #+0.1276459934197926D-1*t277+0.9202744418497889D-2*t279
      t299 = t298*t103
      t305 = 0.4917289144516948D1*t293-0.1380411662774683D-1*t273
     #+0.1914689901296889D-1*t277+0.1380411662774683D-1*t279
      t306 = t110*t305
      t309 = t67*sigmabb
      t311 = t309*t44*t93
      t324 = -0.2300686104624472D-2*t247*t311+0.3191149835494816D-2
     #*t275*t55*t67*t93+0.2300686104624472D-2*t257*t311
     #+0.1285808356226127D-1*t105*t90*t281*t261-t274+t278+t280
      t326 = 1.D0*t282-0.7777208750882749D2*t284*t87*t78*t205+t299
     #*t110-1.D0*t227*t306+t104*t324
      vsigmabb(i) = vsigmabb(i)+0.1554534543482745D-1*t14*t326
      t333 = t13*t267
      t336 = 1/t40
      t343 = 1/t175
      t346 = t9**2
      t349 = t134**2
      t354 = 1/t127/t2*t336
      t356 = t128*t343
      t359 = 1/t4/t2
      t360 = t359*t336
      t371 = t137**2
      t377 = t78**2
      t380 = t3/t377*t85
      t381 = t161**2
      t383 = t380*t143*t381
      t384 = 0.7714850137356763D-1*t383
      t385 = t40**2
      t387 = 1/t42/t385
      t389 = t143*t387*t37
      t390 = t142*t389
      t391 = 0.4090108630443506D-2*t390
      t392 = t141*t166
      t393 = t392*t389
      t394 = 0.4090108630443506D-2*t393
      t396 = t359*t79*t85
      t398 = t396*t143*t336
      t399 = 0.2857351902724727D-2*t398
      t401 = t142*t143*t343
      t402 = 0.8572055708174181D-2*t401
      t403 = t188*t93
      t405 = t142*t403*t119
      t406 = 0.8572055708174181D-2*t405
      t407 = t131*t148
      t411 = t407*t85*t143*t119*t161
      t412 = 0.1714411141634836D-1*t411
      t413 = t149*t246
      t414 = t242*t171
      t415 = t413*t414
      t416 = 0.2454065178266104D-1*t415
      t438 = 0.5088031470000263D-1/t154/t2*t336*t72
     #-0.1174161108461599D0*t155*t343*t72+0.4239903246622982D-2/t153
     #/t70/t69/t2*t336*t72-0.1024360362590479D0*t354*t75
     #+0.245846487021715D0*t356*t75-0.1757779186136125D-1*t360*t75
      t440 = t150*t143*t438
      t441 = 0.2571616712452254D-1*t440
      t443 = t150*t403*t161
      t444 = 0.5143233424904509D-1*t443
      t445 = t37**2
      t448 = 1/t53/t385/t40
      t450 = t143*t445*t448
      t451 = t105*t450
      t452 = 0.2927358823544966D-2*t451
      t455 = 1/t42/t40/t175
      t457 = t143*t37*t455
      t458 = t105*t457
      t459 = 0.3885603198921331D-1*t458
      t460 = t403*t171
      t461 = t105*t460
      t462 = 0.1227032589133052D-1*t461
      t477 = 0.2426672201652192D1*t183*t87-0.606668050413048D0*sigmabb
     #/t53/t41*t185+0.1103032818932815D0*sigmabb/t53/t168/t3/t119
      t480 = t80*t85*t477*t93
      t481 = 0.1285808356226127D-1*t480
      t482 = t84**2
      t483 = 1/t482
      t484 = t80*t483
      t485 = t484*t450
      t486 = 0.4391038235317449D-2*t485
      t487 = t167*t450
      t488 = 0.5854717647089932D-2*t487
      t489 = t167*t457
      t490 = 0.3885603198921331D-1*t489
      t491 = t167*t460
      t492 = 0.1227032589133052D-1*t491
      t493 = t149*t91
      t494 = t493*t414
      t495 = 0.2454065178266104D-1*t494
      t496 = t384+t391-t394-t399+t402-t406+t412-t416-t441-t444+t452
     #+t459-t462+t481+t486-t488-t490+t492+t495
      t499 = t195**2
      t502 = t195*t198
      t504 = t78*t84
      t506 = t504*t201*t204
      t514 = t198**2
      t531 = t199*t78*t83
      t534 = t201*t37*t170*t204
      t537 = t90**2
      t539 = t84/t537
      t544 = t199*t504
      t568 = 1/t96/t95
      t569 = t214**2
      t570 = t568*t569
      t591 = 0.4150829367669083D0*t383+0.2200605678390844D-1*t390
     #-0.2200605678390844D-1*t393-0.1537344210247809D-1*t398
     #+0.4612032630743426D-1*t401-0.4612032630743426D-1*t405
     #+0.9224065261486851D-1*t411-0.1320363407034507D0*t415
     #-0.1383609789223028D0*t440-0.2767219578446055D0*t443
     #+0.1575010111426323D-1*t451+0.2090575394471302D0*t458
     #-0.6601817035172533D-1*t461+0.6918048946115138D-1*t480
     #+0.2362515167139485D-1*t485-0.3150020222852647D-1*t487
     #-0.2090575394471302D0*t489+0.6601817035172533D-1*t491
     #+0.1320363407034507D0*t494
      t592 = t208*t591
      t594 = 0.1170943529417986D-1*t451+0.1554241279568532D0*t458
     #-0.4908130356532208D-1*t461+0.5143233424904509D-1*t480
     #+0.175641529412698D-1*t485-0.2341887058835973D-1*t487
     #-0.1554241279568532D0*t489+0.4908130356532208D-1*t491
     #+0.9816260713064415D-1*t494-0.2369304401100098D2*t570
     #+0.3278192763011299D1*t592
      t598 = t222*t226
      t605 = t99/t225/t102
      t606 = t234**2
      t635 = 0.175641529412698D-1*t451+0.2331361919352799D0*t458
     #-0.7362195534798311D-1*t461+0.7714850137356763D-1*t480
     #+0.263462294119047D-1*t485-0.3512830588253959D-1*t487
     #-0.2331361919352799D0*t489+0.7362195534798311D-1*t491
     #+0.1472439106959662D0*t494-0.3553956601650148D2*t570
     #+0.4917289144516948D1*t592
      t648 = t141*t91
      t651 = t67*t387*t37*t93
      t661 = t141*t246
      t673 = t248*t455*t93
      t677 = t80*t166*t188
      t683 = t80*t189
      t686 = 0.8572055708174181D-2*t142*t106*t343*t93
     #+0.7714850137356763D-1*t380*t106*t381*t93+0.4090108630443506D-2
     #*t648*t651-0.8572055708174181D-2*t142*t253*t238
     #-0.5143233424904509D-1*t150*t253*t242-0.2D1*t502
     #-0.4090108630443506D-2*t661*t651-0.2857351902724727D-2*t396*t106
     #*t336*t93-0.2571616712452254D-1*t150*t106*t438*t93
     #+0.3885603198921331D-1*t257*t673+0.1227032589133052D-1*t677*t250
     #-0.8572055708174181D-2*t648*t196*t238-0.1227032589133052D-1*t683
     #*t250
      t688 = t80*t483*t90
      t691 = t67*t445*t448*t93
      t694 = t171*t93
      t695 = t196*t694
      t709 = t67*t161
      t710 = t709*t694
      t727 = 0.4391038235317449D-2*t688*t691-0.1227032589133052D-1
     #*t257*t695+0.2571616712452254D-1*t105*t188*t195*t261
     #+0.2927358823544966D-2*t257*t691+0.1714411141634836D-1*t407*t91
     #*t67*t119*t242-0.2454065178266104D-1*t413*t710+t391
     #+0.2454065178266104D-1*t493*t710-0.3885603198921331D-1*t247*t673
     #+0.3333333333333333D0*t2*t198+0.1285808356226127D-1*t105*t90
     #*t499*t261+0.1227032589133052D-1*t247*t695-0.5854717647089932D-2
     #*t247*t691
      t736 = 0.1285808356226127D-1*t105*t477*t67*t93-t394-t399+t402
     #-0.5143233424904509D-1*t493*t196*t242+t384-t441-t444+t452-t416
     #+t412-t406-t488
      t745 = 1/t77
      t752 = 1/t83
      t756 = -t490+t492+t459-t462+t481+t486+t495+0.1285808356226127D-1
     #*t105*t90*t496*t261-0.1D1*t514-0.1D1*t188*t198*t201+0.2D1*t745
     #*t198*t161+0.4771444294911944D0*t198*t37*t170
     #-0.4771444294911944D0*t752*t198*t171
      s1 = 1.D0*t496*t67+1.D0*t499*t67-0.155544175017655D3*t502*t87
     #*t506+0.7777208750882749D2*t496*t87*t78*t205
     #-0.7777208750882749D2*t514*t87*t78*t205-0.2592402916960916D2
     #*t198*t185*t78*t202*t119*t204-0.155544175017655D3*t199*t77*t202
     #*t161*t204+0.3710851832473874D2*t531*t534
      t760 = s1+0.7777208750882749D2*t200*t539*t188*t204
     #-0.3710851832473874D2*t544*t534+(0.3085940054942705D0*t383
     #+0.1636043452177403D-1*t390-0.1636043452177403D-1*t393
     #-0.1142940761089891D-1*t398+0.3428822283269673D-1*t401
     #-0.3428822283269673D-1*t405+0.6857644566539345D-1*t411
     #-0.9816260713064415D-1*t415-0.1028646684980902D0*t440
     #-0.2057293369961804D0*t443+t594)*t103*t110-2.D0*t598*t235+2.D0
     #*t223*t265+2.D0*t605*t110*t606-2.D0*t227*t265*t234-1.D0*t227
     #*t110*(0.4628910082414058D0*t383+0.2454065178266104D-1*t390
     #-0.2454065178266104D-1*t393-0.1714411141634836D-1*t398
     #+0.5143233424904509D-1*t401-0.5143233424904509D-1*t405
     #+0.1028646684980902D0*t411-0.1472439106959662D0*t415
     #-0.1542970027471353D0*t440-0.3085940054942705D0*t443+t635)+t104*
     #(t686+t727+t736+t756)
      v2rhob2(i) = v2rhob2(i)+0.310906908696549D-1*t137*t13*t112
     #+0.310906908696549D-1*t333+0.1554534543482745D-1*rhob*
     #(0.8551882923536146D-1*t185*t10*t336-0.1026225950824338D1*t87
     #*t123*t119*t134-0.5131129754121688D0*t118*t343
     #-0.2309008389354759D1*t4/t346*t349+0.7696694631182532D0*t124*(
     #-0.1027209579834646D0*t354+0.2465302991603151D0*t356
     #-0.2389273022915807D0*t360+0.7167819068747421D0*t131*t343))*t116
     #+0.1554534543482745D-1*rhob*t371*t116+0.310906908696549D-1*t138
     #*t333+0.1554534543482745D-1*t14*t760
      t764 = t13*t326
      t769 = t143*t455*sigmabb
      t770 = t392*t769
      t771 = 0.7668953682081574D-3*t770
      t772 = t177*t79
      t774 = t772*t85*t93
      t775 = 0.1063716611831605D-2*t774
      t776 = t142*t769
      t777 = 0.7668953682081574D-3*t776
      t778 = t242*t271
      t779 = t413*t778
      t780 = 0.4601372209248945D-2*t779
      t781 = t148*t85
      t783 = t781*t276*t161
      t784 = 0.6382299670989632D-2*t783
      t785 = t493*t778
      t786 = 0.4601372209248945D-2*t785
      t787 = t37*sigmabb
      t790 = 1/t53/t385/t175
      t792 = t143*t787*t790
      t793 = t484*t792
      t794 = 0.1646639338244043D-2*t793
      t795 = t79*t166
      t797 = 1/t385/rhob
      t799 = t797*t93*t37
      t800 = t795*t799
      t801 = 0.1522639367678093D-2*t800
      t802 = t167*t792
      t803 = 0.2195519117658725D-2*t802
      t805 = t143*sigmabb*t170
      t806 = t167*t805
      t807 = 0.1227032589133052D-1*t806
      t808 = t403*t271
      t809 = t167*t808
      t810 = 0.2300686104624472D-2*t809
      t815 = -0.6618196913596887D0*t177*t87+0.8272746141996109D-1*t182
     #*t185
      t818 = t80*t85*t815*t93
      t819 = 0.1285808356226127D-1*t818
      t820 = t105*t808
      t821 = 0.2300686104624472D-2*t820
      t822 = t275*t799
      t823 = 0.1522639367678093D-2*t822
      t824 = t105*t792
      t825 = 0.1097759558829362D-2*t824
      t826 = t105*t805
      t827 = 0.1227032589133052D-1*t826
      t828 = t771-t775-t777+t780-t784-t786-t794+t801+t803+t807-t810
     #+t819+t821-t823-t825-t827
      t831 = t195*t281
      t834 = t195*t284
      t838 = t281*t198
      t847 = t198*t284
      t853 = t201*sigmabb*t44*t204
      t865 = t568*t214*t292
      t883 = 0.4126135646982833D-2*t770-0.5723126272911426D-2*t774
     #-0.4126135646982833D-2*t776+0.24756813881897D-1*t779
     #-0.3433875763746856D-1*t783-0.24756813881897D-1*t785
     #-0.8859431876773069D-2*t793+0.8192273461183165D-2*t800
     #+0.1181257583569743D-1*t802+0.6601817035172533D-1*t806
     #-0.123784069409485D-1*t809+0.6918048946115138D-1*t818
     #+0.123784069409485D-1*t820-0.8192273461183165D-2*t822
     #-0.5906287917848713D-2*t824-0.6601817035172533D-1*t826
      t884 = t208*t883
      t902 = -0.2369304401100098D2*t865+0.3278192763011299D1*t884
     #+0.306758147283263D-2*t770-0.4254866447326421D-2*t774
     #-0.306758147283263D-2*t776+0.1840548883699578D-1*t779
     #-0.2552919868395853D-1*t783-0.1840548883699578D-1*t785
     #-0.6586557352976174D-2*t793+0.6090557470712371D-2*t800
     #+0.8782076470634898D-2*t802+0.4908130356532208D-1*t806
     #-0.9202744418497889D-2*t809+0.5143233424904509D-1*t818
     #+0.9202744418497889D-2*t820-0.6090557470712371D-2*t822
     #-0.4391038235317449D-2*t824-0.4908130356532208D-1*t826
      t935 = -0.3553956601650148D2*t865+0.4917289144516948D1*t884
     #+0.4601372209248945D-2*t770-0.6382299670989632D-2*t774
     #-0.4601372209248945D-2*t776+0.2760823325549367D-1*t779
     #-0.3829379802593779D-1*t783-0.2760823325549367D-1*t785
     #-0.9879836029464261D-2*t793+0.9135836206068557D-2*t800
     #+0.1317311470595235D-1*t802+0.7362195534798311D-1*t806
     #-0.1380411662774683D-1*t809+0.7714850137356763D-1*t818
     #+0.1380411662774683D-1*t820-0.9135836206068557D-2*t822
     #-0.6586557352976174D-2*t824-0.7362195534798311D-1*t826
      t950 = t282*t694
      t959 = t67*t787*t790*t93
      t972 = -0.4771444294911944D0*t752*t284*t171+0.3333333333333333D0
     #*t2*t284-0.1D1*t847-0.1D1*t838-0.613516294566526D-2*t257*t950
     #-0.1D1*t834+0.4771444294911944D0*t284*t37*t170
     #-0.1646639338244043D-2*t688*t959-0.1063716611831605D-2*t772*t85
     #*t67*t93+0.2D1*t745*t284*t161-0.1D1*t188*t284*t201-t775
      t977 = t271*t93
      t978 = t196*t977
      t992 = t248*t93
      t995 = t309*t249
      t998 = 0.2300686104624472D-2*t683*t311-0.1097759558829362D-2
     #*t257*t959-0.2300686104624472D-2*t247*t978+0.613516294566526D-2
     #*t247*t950+0.1285808356226127D-1*t105*t815*t67*t93
     #+0.1285808356226127D-1*t105*t188*t281*t261-0.1522639367678093D-2
     #*t275*t797*t992-0.1227032589133052D-1*t257*t995-t786-t794+t801
     #+t803+t807
      t1009 = t709*t977
      t1022 = -t810+t819+0.1285808356226127D-1*t105*t90*t828*t261
     #+0.1285808356226127D-1*t257*t831*t261+0.2300686104624472D-2*t257
     #*t978+0.4601372209248945D-2*t413*t1009-t784
     #-0.6382299670989632D-2*t781*t55*t709*t93+t780
     #-0.2571616712452254D-1*t493*t282*t242+t771+0.1522639367678093D-2
     #*t795*t797*t992
      t1032 = t67*t455*sigmabb*t93
      t1045 = -t777-0.4286027854087091D-2*t648*t282*t238+t821-t823
     #-t825-t827-0.4601372209248945D-2*t493*t1009
     #+0.1227032589133052D-1*t247*t995-0.7668953682081574D-3*t648
     #*t1032+0.7668953682081574D-3*t661*t1032+0.2195519117658725D-2
     #*t247*t959+0.3191149835494816D-2*t275*t55*t196*t93
     #-0.2300686104624472D-2*t677*t311
      t1049 = 1.D0*t828*t67+1.D0*t831*t67-0.7777208750882749D2*t834
     #*t87*t506-0.7777208750882749D2*t838*t87*t506
     #+0.7777208750882749D2*t828*t87*t78*t205-0.7777208750882749D2
     #*t847*t87*t506-0.1391569437177703D2*t531*t853
     #+0.1930166210680909D2*t198*t131*t78*t539*t55*t204
     #+0.1391569437177703D2*t544*t853+t902*t103*t110-1.D0*t598*t306
     #+t223*t324-1.D0*t298*t226*t235+2.D0*t605*t235*t305-1.D0*t227
     #*t324*t234-1.D0*t227*t110*t935+t299*t265-1.D0*t227*t265*t305
     #+t104*(t972+t998+t1022+t1045)
      v2rhobsigmabb(i) = v2rhobsigmabb(i)+0.1554534543482745D-1*t764
     #+0.1554534543482745D-1*t138*t764+0.1554534543482745D-1*t14*t1049
      v2sigmabb2(i) = v2sigmabb2(i)
      endif
      endif ! rhob
      if ((rhoa.gt.tolmin).and.(rhob.gt.tolmin)) then
      t1 = 1/rhob
      t2 = t1**(1.D0/3.D0)
      trsb = 0.1285808356226127D-1*t2
      t3 = t1**(1.D0/15.D0)
      t4 = t3**2
      t5 = t4**2
      t7 = dexp(-0.5683671053580832D-1*t5)
      t10 = (0.942486901D0+0.349064173D0*t7)**2
      t11 = rhob**2
      t12 = rhob**(1.D0/3.D0)
      t13 = t12**2
      t16 = sigmabb/t13/t11
      t18 = sigmabb**2
      t19 = t11**2
      t23 = t18/t12/t19/rhob
      t26 = (0.1D1+0.6936084891727404D-1*t16+0.4389159297635699D-3*t23
     #)**2
      t34 = dexp(-0.4389159297635699D-3*t23)
      t35 = t34**2
      trcab = t10*t26/(0.1D1+0.9505299311782149D-1*t16/t2)*t35
      if(trsb.lt.tolmax*trcab) then
      t2 = 0.3141592653589793D1**2
      t5 = 1/rhob
      t6 = 1/0.3141592653589793D1*t5
      t7 = t6**(1.D0/3.D0)
      t9 = t6**(1.D0/15.D0)
      t10 = t9**2
      t11 = t10**2
      t13 = dexp(-0.7712625328179681D-1*t11)
      t16 = (0.942486901D0+0.349064173D0*t13)**2
      t19 = 0.3141592653589793D1**(1.D0/3.D0)
      t20 = t19**2
      t22 = 1/t20*sigmabb
      t23 = rhob**2
      t24 = rhob**(1.D0/3.D0)
      t25 = t24**2
      t27 = 1/t25/t23
      t32 = sigmabb**2
      t34 = t23**2
      t35 = t34*rhob
      t37 = 1/t24/t35
      t38 = 1/t19/0.3141592653589793D1*t32*t37
      t41 = (0.1D1+0.1487810599361293D0*t22*t27+0.2019518519390501D-2
     #*t38)**2
      t50 = dexp(0.4039037038781002D-2*t38)
      t54 = expei(-0.1858628590577086D0/t2*t7/t16/t41*(0.1D1
     #+0.1392138426088027D0*t22*t27/t7)*t50)
      t56 = t5**(1.D0/3.D0)
      t57 = t5**(1.D0/15.D0)
      t58 = t57**2
      t59 = t58**2
      t60 = 0.5683671053580832D-1*t59
      t61 = dexp(-t60)
      t63 = 0.942486901D0+0.349064173D0*t61
      t64 = t63**2
      t65 = 1/t64
      t66 = t56*t65
      t67 = sigmabb*t27
      t69 = t32*t37
      t71 = 0.1D1+0.6936084891727404D-1*t67+0.4389159297635699D-3*t69
      t72 = t71**2
      t73 = 1/t72
      t74 = 1/t56
      t77 = 0.1D1+0.9505299311782149D-1*t67*t74
      t78 = t73*t77
      t79 = 0.8778318595271399D-3*t69
      t80 = dexp(t79)
      t82 = t66*t78*t80
      t83 = dsqrt(t82)
      t86 = 0.6D1+0.4535739597862518D0*t83+0.5143233424904509D-1*t82
      t89 = 0.3D1+0.6803609396793777D0*t83+0.7714850137356763D-1*t82
      t90 = 1/t89
      t91 = t86*t90
      t92 = t66*t73
      t93 = t77*t54
      t97 = 0.1285808356226127D-1*t92*t93*t80+0.1D1
      t98 = t91*t97
      zk(i) = zk(i)+0.1554534543482745D-1*rhoa*(1.D0*t54+t98)
      vrhoa(i) = vrhoa(i)+0.1554534543482745D-1*t54
     #+0.1554534543482745D-1*t98
      t106 = t56**2
      t107 = 1/t106
      t108 = t107*t65
      t109 = t108*t73
      t110 = t77*t80
      t111 = 1/t23
      t113 = t109*t110*t111
      t114 = 0.4286027854087091D-2*t113
      t115 = t5**(1.D0/5.D0)
      t116 = t115**2
      t119 = 1/t64/t63
      t120 = 1/t116*t119
      t121 = t120*t73
      t122 = t77*t111
      t124 = dexp(t79-t60)
      t126 = t121*t122*t124
      t127 = 0.1360533322067624D-3*t126
      t129 = 1/t72/t71
      t130 = t66*t129
      t131 = t23*rhob
      t133 = 1/t25/t131
      t134 = sigmabb*t133
      t136 = t34*t23
      t138 = 1/t24/t136
      t139 = t32*t138
      t141 = -0.1849622637793975D0*t134-0.234088495873904D-2*t139
      t143 = t130*t110*t141
      t144 = 0.2571616712452254D-1*t143
      t148 = 1/t25/t34
      t149 = sigmabb*t148
      t151 = 1/t56/t5
      t154 = -0.2534746483141907D0*t134*t74+0.3168433103927383D-1*t149
     #*t151
      t155 = t73*t154
      t157 = t66*t155*t80
      t158 = 0.1285808356226127D-1*t157
      t160 = t92*t110*t139
      t161 = 0.601985888182142D-4*t160
      t162 = -t114-t127-t144+t158-t161
      t163 = t162*t54
      t165 = -t162
      t166 = t165*t74
      t167 = t166*t64
      t168 = 1/t77
      t169 = t72*t168
      t170 = 0.8778318595271399D-3*t69
      t171 = dexp(-t170)
      t172 = t169*t171
      t173 = t167*t172
      t175 = 1/t83
      t181 = -0.2306016315371713D-1*t113-0.7320092507805402D-3*t126
     #-0.1383609789223028D0*t143+0.6918048946115138D-1*t157
     #-0.3238871344356278D-3*t160
      t182 = t175*t181
      t189 = 0.3278192763011299D1*t182-0.1714411141634836D-1*t113
     #-0.5442133288270495D-3*t126-0.1028646684980902D0*t143
     #+0.5143233424904509D-1*t157-0.2407943552728568D-3*t160
      t190 = t189*t90
      t191 = t190*t97
      t192 = t89**2
      t193 = 1/t192
      t194 = t86*t193
      t201 = 0.4917289144516948D1*t182-0.2571616712452254D-1*t113
     #-0.8163199932405743D-3*t126-0.1542970027471353D0*t143
     #+0.7714850137356763D-1*t157-0.3611915329092852D-3*t160
      t202 = t97*t201
      t203 = t194*t202
      t205 = t111*t80
      t209 = t111*t124
      t213 = t141*t80
      t217 = t154*t54
      t221 = t66*t78
      t222 = t54*t32
      t223 = t138*t80
      t224 = t222*t223
      t228 = t54*t80
      t232 = -0.4286027854087091D-2*t109*t93*t205
     #-0.1360533322067624D-3*t121*t93*t209-0.2571616712452254D-1*t130
     #*t93*t213+0.1285808356226127D-1*t92*t217*t80
     #-0.601985888182142D-4*t221*t224+0.1285808356226127D-1*t92*t77
     #*t162*t228-t114-t127-t144+t158-t161
      t233 = t91*t232
      vrhob(i) = vrhob(i)+0.1554534543482745D-1*rhoa*(1.D0*t163
     #-0.7777208750882749D2*t173+t191-1.D0*t203+t233)
      t239 = sigmabb*t37
      t241 = 0.6936084891727404D-1*t27+0.8778318595271399D-3*t239
      t243 = t130*t110*t241
      t244 = 0.2571616712452254D-1*t243
      t245 = t65*t73
      t246 = t27*t80
      t247 = t245*t246
      t248 = 0.1222199328351994D-2*t247
      t250 = t92*t110*t239
      t251 = 0.2257447080683033D-4*t250
      t252 = -t244+t248+t251
      t253 = t252*t54
      t255 = -t252
      t256 = t255*t74
      t257 = t256*t64
      t258 = t257*t172
      t263 = -0.1383609789223028D0*t243+0.6575812588638345D-2*t247
     #+0.1214576754133604D-3*t250
      t264 = t175*t263
      t269 = 0.3278192763011299D1*t264-0.1028646684980902D0*t243
     #+0.4888797313407978D-2*t247+0.9029788322732131D-4*t250
      t270 = t269*t90
      t271 = t270*t97
      t276 = 0.4917289144516948D1*t264-0.1542970027471353D0*t243
     #+0.7333195970111966D-2*t247+0.135446824840982D-3*t250
      t277 = t97*t276
      t278 = t194*t277
      t280 = t241*t80
      t288 = t54*sigmabb
      t289 = t37*t80
      t290 = t288*t289
      t297 = -0.2571616712452254D-1*t130*t93*t280
     #+0.1222199328351994D-2*t245*t27*t54*t80+0.2257447080683033D-4
     #*t221*t290+0.1285808356226127D-1*t92*t77*t252*t228-t244+t248+t251
      t298 = t91*t297
      vsigmabb(i) = vsigmabb(i)+0.1554534543482745D-1*rhoa*(1.D0*t253
     #-0.7777208750882749D2*t258+t271-1.D0*t278+t298)
      v2rhoa2(i) = v2rhoa2(i)
      v2rhoab(i) = v2rhoab(i)+0.1554534543482745D-1*t163
     #-0.1208993965512352D1*t173+0.1554534543482745D-1*t191
     #-0.1554534543482745D-1*t203+0.1554534543482745D-1*t233
      t311 = t121*t154*t111*t124
      t312 = 0.2721066644135248D-3*t311
      t316 = 1/t24/t34/t131
      t317 = t32*t316
      t319 = 0.678194967191124D0*t149+0.1482560473868058D-1*t317
      t321 = t130*t110*t319
      t322 = 0.2571616712452254D-1*t321
      t323 = t129*t77
      t324 = t66*t323
      t326 = t324*t213*t139
      t327 = 0.2407943552728568D-3*t326
      t342 = 0.9294070438186991D0*t149*t74-0.2323517609546748D0
     #*sigmabb/t25/t35*t151+0.4224577471903178D-1*sigmabb/t25/t136/t56
     #/t111
      t345 = t66*t73*t342*t80
      t346 = 0.1285808356226127D-1*t345
      t347 = t32**2
      t348 = t34**2
      t351 = 1/t25/t348/t34
      t354 = t92*t110*t347*t351
      t355 = 0.2818359422037475D-6*t354
      t357 = t92*t110*t317
      t358 = 0.3812577291820233D-3*t357
      t359 = t154*t80
      t361 = t92*t359*t139
      t362 = 0.1203971776364284D-3*t361
      t364 = t130*t359*t141
      t365 = 0.5143233424904509D-1*t364
      t367 = 1/t58/t5
      t368 = t64**2
      t371 = t367/t368*t73
      t372 = 1/t34
      t373 = t77*t372
      t376 = dexp(t79-0.1136734210716166D0*t59)
      t378 = t371*t373*t376
      t379 = 0.2159401412535421D-5*t378
      t381 = 1/t24/t348
      t383 = t32*t124
      t385 = t121*t77*t381*t383
      t386 = 0.1273940795796543D-5*t385
      t388 = t367*t119*t73
      t389 = t373*t124
      t390 = t388*t389
      t391 = 0.2062086362684779D-5*t390
      t392 = t72**2
      t393 = 1/t392
      t394 = t66*t393
      t395 = t141**2
      t397 = t394*t110*t395
      t398 = 0.7714850137356763D-1*t397
      t399 = 1/t131
      t402 = t121*t77*t399*t124
      t403 = 0.2721066644135248D-3*t402
      t404 = t120*t129
      t405 = t141*t124
      t407 = t404*t122*t405
      t408 = 0.5442133288270495D-3*t407
      t410 = t109*t110*t399
      t411 = 0.8572055708174181D-2*t410
      t415 = 1/t106/t5*t65*t73
      t417 = t415*t110*t372
      t418 = 0.2857351902724727D-2*t417
      t422 = 1/t116/t5*t119*t73
      t423 = t422*t389
      t424 = 0.9070222147117492D-5*t423
      t427 = t109*t110*t381*t32
      t428 = 0.4013239254547614D-4*t427
      t429 = t108*t129
      t432 = t429*t110*t111*t141
      t433 = 0.1714411141634836D-1*t432
      t435 = t109*t359*t111
      t436 = 0.8572055708174181D-2*t435
      t437 = -t312-t322+t327+t346+t355+t358-t362-t365+t379+t386-t391
     #+t398+t403+t408+t411-t418-t424+t428+t433-t436
      t440 = t162**2
      t443 = t162*t165
      t445 = t64*t72
      t447 = t445*t168*t171
      t455 = t165**2
      t471 = dexp(-t170-t60)
      t476 = t71*t168
      t481 = t77**2
      t483 = t72/t481
      t488 = t166*t445
      t505 = -0.1088426657654099D-2*t311-0.1028646684980902D0*t321
     #+0.9631774210914273D-3*t326+0.5143233424904509D-1*t345
     #+0.112734376881499D-5*t354+0.1525030916728093D-2*t357
     #-0.4815887105457136D-3*t361-0.2057293369961804D0*t364
     #+0.8637605650141684D-5*t378+0.5095763183186173D-5*t385
     #-0.8248345450739115D-5*t390
      t516 = 1/t83/t82
      t517 = t181**2
      t518 = t516*t517
      t540 = -0.146401850156108D-2*t311-0.1383609789223028D0*t321
     #+0.1295548537742511D-2*t326+0.6918048946115138D-1*t345
     #+0.1516365042658901D-5*t354+0.2051285184758976D-2*t357
     #-0.6477742688712557D-3*t361-0.2767219578446055D0*t364
     #+0.1161825134662837D-4*t378+0.6854197779240001D-5*t385
     #-0.1109466610563933D-4*t390+0.4150829367669083D0*t397
     #+0.146401850156108D-2*t402+0.2928037003122161D-2*t407
     #+0.4612032630743426D-1*t410-0.1537344210247809D-1*t417
     #-0.4880061671870268D-4*t423+0.2159247562904186D-3*t427
     #+0.9224065261486851D-1*t432-0.4612032630743426D-1*t435
      t541 = t175*t540
      t543 = 0.3085940054942705D0*t397+0.1088426657654099D-2*t402
     #+0.2176853315308198D-2*t407+0.3428822283269673D-1*t410
     #-0.1142940761089891D-1*t417-0.3628088858846997D-4*t423
     #+0.1605295701819045D-3*t427+0.6857644566539345D-1*t432
     #-0.3428822283269673D-1*t435-0.2369304401100098D2*t518
     #+0.3278192763011299D1*t541
      t547 = t189*t193
      t554 = t86/t192/t89
      t555 = t201**2
      t573 = -0.1632639986481149D-2*t311-0.1542970027471353D0*t321
     #+0.1444766131637141D-2*t326+0.7714850137356763D-1*t345
     #+0.1691015653222485D-5*t354+0.228754637509214D-2*t357
     #-0.7223830658185704D-3*t361-0.3085940054942705D0*t364
     #+0.1295640847521253D-4*t378+0.764364477477926D-5*t385
     #-0.1237251817610867D-4*t390
      t585 = 0.4628910082414058D0*t397+0.1632639986481149D-2*t402
     #+0.3265279972962297D-2*t407+0.5143233424904509D-1*t410
     #-0.1714411141634836D-1*t417-0.5442133288270495D-4*t423
     #+0.2407943552728568D-3*t427+0.1028646684980902D0*t432
     #-0.5143233424904509D-1*t435-0.3553956601650148D2*t518
     #+0.4917289144516948D1*t541
      t590 = 1/t71
      t598 = t59**2
      t600 = 1/t598/t58/t57
      t602 = t600/t63
      t613 = t93*t372*t124
      t628 = t120*t78
      t632 = t54*t381
      t636 = t54*t141
      t637 = t139*t80
      t641 = 0.2D1*t590*t165*t141+0.4681769917478079D-2*t165*t32*t138
     #+0.105811516582519D-1*t602*t165*t111*t61+0.2721066644135248D-3
     #*t121*t93*t399*t124-0.2D1*t443-0.2062086362684779D-5*t388*t613
     #+0.1285808356226127D-1*t92*t77*t437*t228-0.2571616712452254D-1
     #*t130*t93*t319*t80+0.7714850137356763D-1*t394*t93*t395*t80
     #-0.2721066644135248D-3*t628*t163*t209+0.1273940795796543D-5*t628
     #*t632*t383+0.2407943552728568D-3*t324*t636*t637+t327
      t646 = t108*t323
      t647 = t54*t111
      t667 = 0.1285808356226127D-1*t92*t342*t54*t80
     #+0.1714411141634836D-1*t646*t647*t213-t322-0.2721066644135248D-3
     #*t121*t217*t209-t312-0.5143233424904509D-1*t130*t217*t213
     #+0.2159401412535421D-5*t371*t93*t372*t376-0.5143233424904509D-1
     #*t324*t163*t213+t379-0.1D1*t154*t165*t168-t365+t358-t362+t346
      t678 = t108*t78
      t679 = t32*t80
      t683 = t120*t323
      t691 = t355+t408+t398-0.8572055708174181D-2*t109*t217*t205
     #-0.2857351902724727D-2*t415*t93*t372*t80+t403-t391
     #-0.9070222147117492D-5*t422*t613+0.4013239254547614D-4*t678*t632
     #*t679+t386+0.5442133288270495D-3*t683*t647*t405
     #+0.1285808356226127D-1*t92*t77*t440*t228+t428
      t718 = t66*t155
      t721 = t433-t424-t418+t411-t436+0.8572055708174181D-2*t109*t93
     #*t399*t80-0.8572055708174181D-2*t678*t163*t205
     #+0.2818359422037475D-6*t221*t54*t347*t351*t80
     #+0.2571616712452254D-1*t92*t154*t162*t228-0.1203971776364284D-3
     #*t221*t163*t637-0.1D1*t455+0.3333333333333333D0*t5*t165
     #+0.3812577291820233D-3*t221*t222*t316*t80-0.1203971776364284D-3
     #*t718*t224
      t725 = 1.D0*t437*t54+1.D0*t440*t54-0.155544175017655D3*t443*t74
     #*t447+0.7777208750882749D2*t437*t74*t64*t172
     #-0.7777208750882749D2*t455*t74*t64*t172-0.2592402916960916D2
     #*t165*t151*t64*t169*t111*t171-0.8229182527097421D0*t165/t57/t5
     #*t63*t169*t111*t471-0.155544175017655D3*t167*t476*t141*t171
     #+0.7777208750882749D2*t167*t483*t154*t171-0.3641110197183013D0
     #*t488*t168*t32*t138*t171+(t505+t543)*t90*t97-2.D0*t547*t202+2.D0
     #*t190*t232+2.D0*t554*t97*t555-2.D0*t194*t232*t201-1.D0*t194*t97*
     #(t573+t585)+t91*(t641+t667+t691+t721)
      v2rhob2(i) = v2rhob2(i)+0.1554534543482745D-1*rhoa*t725
      v2rhoasigmabb(i) = v2rhoasigmabb(i)+0.1554534543482745D-1*t253
     #-0.1208993965512352D1*t258+0.1554534543482745D-1*t271
     #-0.1554534543482745D-1*t278+0.1554534543482745D-1*t298
      t737 = t429*t110*t111*t241
      t738 = 0.8572055708174181D-2*t737
      t739 = t133*t65
      t741 = t739*t73*t80
      t742 = 0.4073997761173315D-3*t741
      t745 = t109*t110*t316*sigmabb
      t746 = 0.7524823602276776D-5*t745
      t747 = t241*t124
      t749 = t404*t122*t747
      t750 = 0.2721066644135248D-3*t749
      t751 = t600*t119
      t754 = t751*t73*t148*t124
      t755 = 0.1293227644990607D-4*t754
      t757 = sigmabb*t124
      t759 = t121*t77*t316*t757
      t760 = 0.2388638992118519D-6*t759
      t763 = t394*t110*t141*t241
      t764 = 0.7714850137356763D-1*t763
      t765 = t65*t129
      t767 = t765*t246*t141
      t768 = 0.2444398656703989D-2*t767
      t770 = t324*t213*t239
      t771 = 0.4514894161366065D-4*t770
      t773 = sigmabb*t138
      t775 = -0.1849622637793975D0*t133-0.4681769917478079D-2*t773
      t777 = t130*t110*t775
      t778 = 0.2571616712452254D-1*t777
      t780 = t130*t359*t241
      t781 = 0.2571616712452254D-1*t780
      t786 = -0.2534746483141907D0*t133*t74+0.3168433103927383D-1*t148
     #*t151
      t789 = t66*t73*t786*t80
      t790 = 0.1285808356226127D-1*t789
      t792 = t92*t359*t239
      t793 = 0.2257447080683033D-4*t792
      t794 = t138*t241
      t796 = t324*t679*t794
      t797 = 0.1203971776364284D-3*t796
      t799 = 1/t348/rhob
      t802 = t245*t799*t80*t32
      t803 = 0.5722056048640281D-5*t802
      t804 = t32*sigmabb
      t807 = 1/t25/t348/t131
      t810 = t92*t110*t804*t807
      t811 = 0.1056884783264053D-6*t810
      t813 = t92*t110*t773
      t814 = 0.1203971776364284D-3*t813
      t815 = t738-t742-t746+t750-t755-t760+t764-t768-t771-t778-t781
     #+t790+t793+t797-t803-t811-t814
      t818 = t162*t252
      t821 = t162*t255
      t825 = t252*t165
      t834 = t165*t255
      t839 = t476*t241*t171
      t845 = t483*t27*t171
      t850 = t168*sigmabb*t37*t171
      t854 = t516*t181*t263
      t873 = 0.4612032630743426D-1*t737-0.2191937529546115D-2*t741
     #-0.4048589180445348D-4*t745+0.146401850156108D-2*t749
     #-0.6957967027662436D-4*t754-0.12851620836075D-5*t759
     #+0.4150829367669083D0*t763-0.1315162517727669D-1*t767
     #-0.2429153508267209D-3*t770-0.1383609789223028D0*t777
     #-0.1383609789223028D0*t780+0.6918048946115138D-1*t789
     #+0.1214576754133604D-3*t792+0.6477742688712557D-3*t796
     #-0.3078644156046066D-4*t802-0.5686368909970879D-6*t810
     #-0.6477742688712557D-3*t813
      t874 = t175*t873
      t893 = -0.2369304401100098D2*t854+0.3278192763011299D1*t874
     #+0.3428822283269673D-1*t737-0.1629599104469326D-2*t741
     #-0.300992944091071D-4*t745+0.1088426657654099D-2*t749
     #-0.5172910579962427D-4*t754-0.9554555968474075D-6*t759
     #+0.3085940054942705D0*t763-0.9777594626815955D-2*t767
     #-0.1805957664546426D-3*t770-0.1028646684980902D0*t777
     #-0.1028646684980902D0*t780+0.5143233424904509D-1*t789
     #+0.9029788322732131D-4*t792+0.4815887105457136D-3*t796
     #-0.2288822419456112D-4*t802-0.4227539133056213D-6*t810
     #-0.4815887105457136D-3*t813
      t899 = t269*t193
      t927 = -0.3553956601650148D2*t854+0.4917289144516948D1*t874
     #+0.5143233424904509D-1*t737-0.2444398656703989D-2*t741
     #-0.4514894161366065D-4*t745+0.1632639986481149D-2*t749
     #-0.775936586994364D-4*t754-0.1433183395271111D-5*t759
     #+0.4628910082414058D0*t763-0.1466639194022393D-1*t767
     #-0.2708936496819639D-3*t770-0.1542970027471353D0*t777
     #-0.1542970027471353D0*t780+0.7714850137356763D-1*t789
     #+0.135446824840982D-3*t792+0.7223830658185704D-3*t796
     #-0.3433233629184168D-4*t802-0.634130869958432D-6*t810
     #-0.7223830658185704D-3*t813
      t941 = t590*t255
      t951 = t54*t316
      t974 = t245*t27
      t978 = 0.4681769917478079D-2*t255*t32*t138-0.1D1*t154*t255*t168
     #+0.2D1*t941*t141+0.3333333333333333D0*t5*t255
     #-0.1293227644990607D-4*t751*t73*t148*t54*t124
     #-0.7524823602276776D-5*t678*t951*sigmabb*t80-t742
     #+0.8572055708174181D-2*t646*t647*t280-0.4073997761173315D-3*t739
     #*t73*t54*t80-0.1360533322067624D-3*t628*t253*t209
     #-0.2388638992118519D-6*t628*t951*t757+0.7714850137356763D-1*t66
     #*t393*t77*t636*t280+0.1222199328351994D-2*t974*t163*t80
      t990 = -0.1D1*t834-0.1D1*t821-0.1D1*t825+t738
     #-0.5722056048640281D-5*t245*t799*t222*t80+t790+t793-t746
     #+0.105811516582519D-1*t602*t255*t111*t61-t768+t764-t760-t755
      t1009 = -0.1203971776364284D-3*t221*t288*t223+t750+t797-t811
     #-t814-t781-t771-t778-t803+0.2257447080683033D-4*t718*t290
     #-0.2571616712452254D-1*t130*t217*t280+0.1285808356226127D-1*t92
     #*t786*t54*t80-0.1056884783264053D-6*t221*t54*t804*t807*t80
      t1017 = t765*t27
      t1027 = t239*t80
      t1055 = 0.1285808356226127D-1*t92*t77*t815*t228
     #-0.2571616712452254D-1*t324*t253*t213-0.2444398656703989D-2
     #*t1017*t636*t80-0.601985888182142D-4*t221*t253*t637
     #-0.2571616712452254D-1*t324*t163*t280-0.4514894161366065D-4*t324
     #*t636*t1027+0.1203971776364284D-3*t324*t222*t794*t80
     #+0.1285808356226127D-1*t92*t154*t252*t228+0.2257447080683033D-4
     #*t221*t163*t1027+0.2721066644135248D-3*t683*t647*t747
     #+0.1285808356226127D-1*t221*t818*t228-0.2571616712452254D-1*t130
     #*t93*t775*t80-0.4286027854087091D-2*t678*t253*t205
      t1059 = 1.D0*t815*t54+1.D0*t818*t54-0.7777208750882749D2*t821
     #*t74*t447-0.7777208750882749D2*t825*t74*t447
     #+0.7777208750882749D2*t815*t74*t64*t172-0.7777208750882749D2
     #*t834*t74*t447-0.155544175017655D3*t167*t839
     #+0.7392469698735191D1*t165*t107*t64*t845+0.136541632394363D0
     #*t488*t850+t893*t90*t97-1.D0*t547*t277+t190*t297-1.D0*t899*t202
     #+2.D0*t554*t202*t276-1.D0*t194*t297*t201-1.D0*t194*t97*t927+t270
     #*t232-1.D0*t194*t232*t276+t91*(t978+t990+t1009+t1055)
      v2rhobsigmabb(i) = v2rhobsigmabb(i)+0.1554534543482745D-1*rhoa
     #*t1059
      t1063 = t241**2
      t1065 = t394*t110*t1063
      t1066 = 0.7714850137356763D-1*t1065
      t1068 = t765*t246*t241
      t1069 = 0.4888797313407978D-2*t1068
      t1071 = t324*t280*t239
      t1072 = 0.9029788322732131D-4*t1071
      t1073 = t110*t37
      t1074 = t130*t1073
      t1075 = 0.2257447080683033D-4*t1074
      t1076 = 1/t348
      t1079 = t245*t1076*t80*sigmabb
      t1080 = 0.4291542036480211D-5*t1079
      t1083 = 1/t25/t348/t23
      t1086 = t92*t110*t32*t1083
      t1087 = 0.39633179372402D-7*t1086
      t1088 = t92*t1073
      t1089 = 0.2257447080683033D-4*t1088
      t1090 = t1066-t1069-t1072-t1075+t1080+t1087+t1089
      t1093 = t252**2
      t1096 = t252*t255
      t1105 = t255**2
      t1119 = t263**2
      t1120 = t516*t1119
      t1130 = t175*(0.4150829367669083D0*t1065-0.2630325035455338D-1
     #*t1068-0.4858307016534418D-3*t1071-0.1214576754133604D-3*t1074
     #+0.2308983117034549D-4*t1079+0.2132388341239079D-6*t1086
     #+0.1214576754133604D-3*t1088)
      t1146 = t276**2
      t1170 = t93*t289
      t1173 = t54*t241
      t1207 = 0.7714850137356763D-1*t394*t93*t1063*t80
     #-0.2257447080683033D-4*t130*t1170-0.9029788322732131D-4*t324
     #*t1173*t1027-0.5143233424904509D-1*t324*t253*t280
     #-0.4888797313407978D-2*t1017*t1173*t80+0.2D1*t941*t241
     #-0.9505299311782149D-1*t27*t255*t74*t168+0.4291542036480211D-5
     #*t245*t1076*t288*t80+0.2444398656703989D-2*t974*t253*t80
     #+0.1285808356226127D-1*t92*t77*t1090*t228+0.39633179372402D-7
     #*t221*t222*t1083*t80-0.175566371905428D-2*t255*sigmabb*t37
      t1219 = 0.4514894161366065D-4*t221*t253*t1027
     #+0.2257447080683033D-4*t92*t1170+t1066-t1069-t1072-t1075+t1080
     #+t1087+t1089+0.1285808356226127D-1*t92*t77*t1093*t228-0.2D1
     #*t1096-0.1D1*t1105
      s1 = 1.D0*t1090*t54+1.D0*t1093*t54-0.155544175017655D3*t1096*t74
     #*t447+0.7777208750882749D2*t1090*t74*t64*t172
     #-0.7777208750882749D2*t1105*t74*t64*t172-0.155544175017655D3
     #*t257*t839+0.7392469698735191D1*t255*t107*t64*t845
      t1222 = s1+0.136541632394363D0*t256*t445*t850+(
     #-0.2369304401100098D2*t1120+0.3278192763011299D1*t1130
     #+0.3085940054942705D0*t1065-0.1955518925363191D-1*t1068
     #-0.3611915329092852D-3*t1071-0.9029788322732131D-4*t1074
     #+0.1716616814592084D-4*t1079+0.158532717489608D-6*t1086
     #+0.9029788322732131D-4*t1088)*t90*t97-2.D0*t899*t277+2.D0*t270
     #*t297+2.D0*t554*t97*t1146-2.D0*t194*t297*t276-1.D0*t194*t97*(
     #-0.3553956601650148D2*t1120+0.4917289144516948D1*t1130
     #+0.4628910082414058D0*t1065-0.2933278388044787D-1*t1068
     #-0.5417872993639278D-3*t1071-0.135446824840982D-3*t1074
     #+0.2574925221888126D-4*t1079+0.237799076234412D-6*t1086
     #+0.135446824840982D-3*t1088)+t91*(t1207+t1219)
      v2sigmabb2(i) = v2sigmabb2(i)+0.1554534543482745D-1*rhoa*t1222
      endif
      t1 = 1/rhoa
      t2 = t1**(1.D0/3.D0)
      trsa = 0.1285808356226127D-1*t2
      t3 = t1**(1.D0/15.D0)
      t4 = t3**2
      t5 = t4**2
      t7 = dexp(-0.5683671053580832D-1*t5)
      t10 = (0.942486901D0+0.349064173D0*t7)**2
      t11 = rhoa**2
      t12 = rhoa**(1.D0/3.D0)
      t13 = t12**2
      t16 = sigmaaa/t13/t11
      t18 = sigmaaa**2
      t19 = t11**2
      t23 = t18/t12/t19/rhoa
      t26 = (0.1D1+0.6936084891727404D-1*t16+0.4389159297635699D-3*t23
     #)**2
      t34 = dexp(-0.4389159297635699D-3*t23)
      t35 = t34**2
      trcba = t10*t26/(0.1D1+0.9505299311782149D-1*t16/t2)*t35
      if(trsa.lt.tolmax*trcba) then
      t2 = 0.3141592653589793D1**2
      t5 = 1/rhoa
      t6 = 1/0.3141592653589793D1*t5
      t7 = t6**(1.D0/3.D0)
      t9 = t6**(1.D0/15.D0)
      t10 = t9**2
      t11 = t10**2
      t13 = dexp(-0.7712625328179681D-1*t11)
      t16 = (0.942486901D0+0.349064173D0*t13)**2
      t19 = 0.3141592653589793D1**(1.D0/3.D0)
      t20 = t19**2
      t22 = 1/t20*sigmaaa
      t23 = rhoa**2
      t24 = rhoa**(1.D0/3.D0)
      t25 = t24**2
      t27 = 1/t25/t23
      t32 = sigmaaa**2
      t34 = t23**2
      t35 = t34*rhoa
      t37 = 1/t24/t35
      t38 = 1/t19/0.3141592653589793D1*t32*t37
      t41 = (0.1D1+0.1487810599361293D0*t22*t27+0.2019518519390501D-2
     #*t38)**2
      t50 = dexp(0.4039037038781002D-2*t38)
      t54 = expei(-0.1858628590577086D0/t2*t7/t16/t41*(0.1D1
     #+0.1392138426088027D0*t22*t27/t7)*t50)
      t56 = t5**(1.D0/3.D0)
      t57 = t5**(1.D0/15.D0)
      t58 = t57**2
      t59 = t58**2
      t60 = 0.5683671053580832D-1*t59
      t61 = dexp(-t60)
      t63 = 0.942486901D0+0.349064173D0*t61
      t64 = t63**2
      t65 = 1/t64
      t66 = t56*t65
      t67 = sigmaaa*t27
      t69 = t32*t37
      t71 = 0.1D1+0.6936084891727404D-1*t67+0.4389159297635699D-3*t69
      t72 = t71**2
      t73 = 1/t72
      t74 = 1/t56
      t77 = 0.1D1+0.9505299311782149D-1*t67*t74
      t78 = t73*t77
      t79 = 0.8778318595271399D-3*t69
      t80 = dexp(t79)
      t82 = t66*t78*t80
      t83 = dsqrt(t82)
      t86 = 0.6D1+0.4535739597862518D0*t83+0.5143233424904509D-1*t82
      t89 = 0.3D1+0.6803609396793777D0*t83+0.7714850137356763D-1*t82
      t90 = 1/t89
      t91 = t86*t90
      t92 = t66*t73
      t93 = t77*t54
      t97 = 0.1285808356226127D-1*t92*t93*t80+0.1D1
      t98 = t91*t97
      zk(i) = zk(i)+0.1554534543482745D-1*rhob*(1.D0*t54+t98)
      t103 = t56**2
      t104 = 1/t103
      t105 = t104*t65
      t106 = t105*t73
      t107 = t77*t80
      t108 = 1/t23
      t110 = t106*t107*t108
      t111 = 0.4286027854087091D-2*t110
      t112 = t5**(1.D0/5.D0)
      t113 = t112**2
      t116 = 1/t64/t63
      t117 = 1/t113*t116
      t118 = t117*t73
      t119 = t77*t108
      t121 = dexp(t79-t60)
      t123 = t118*t119*t121
      t124 = 0.1360533322067624D-3*t123
      t126 = 1/t72/t71
      t127 = t66*t126
      t128 = t23*rhoa
      t130 = 1/t25/t128
      t131 = sigmaaa*t130
      t133 = t34*t23
      t135 = 1/t24/t133
      t136 = t32*t135
      t138 = -0.1849622637793975D0*t131-0.234088495873904D-2*t136
      t140 = t127*t107*t138
      t141 = 0.2571616712452254D-1*t140
      t145 = 1/t25/t34
      t146 = sigmaaa*t145
      t148 = 1/t56/t5
      t151 = -0.2534746483141907D0*t131*t74+0.3168433103927383D-1*t146
     #*t148
      t152 = t73*t151
      t154 = t66*t152*t80
      t155 = 0.1285808356226127D-1*t154
      t157 = t92*t107*t136
      t158 = 0.601985888182142D-4*t157
      t159 = -t111-t124-t141+t155-t158
      t160 = t159*t54
      t162 = -t159
      t163 = t162*t74
      t164 = t163*t64
      t165 = 1/t77
      t166 = t72*t165
      t167 = 0.8778318595271399D-3*t69
      t168 = dexp(-t167)
      t169 = t166*t168
      t170 = t164*t169
      t172 = 1/t83
      t178 = -0.2306016315371713D-1*t110-0.7320092507805402D-3*t123
     #-0.1383609789223028D0*t140+0.6918048946115138D-1*t154
     #-0.3238871344356278D-3*t157
      t179 = t172*t178
      t186 = 0.3278192763011299D1*t179-0.1714411141634836D-1*t110
     #-0.5442133288270495D-3*t123-0.1028646684980902D0*t140
     #+0.5143233424904509D-1*t154-0.2407943552728568D-3*t157
      t187 = t186*t90
      t188 = t187*t97
      t189 = t89**2
      t190 = 1/t189
      t191 = t86*t190
      t198 = 0.4917289144516948D1*t179-0.2571616712452254D-1*t110
     #-0.8163199932405743D-3*t123-0.1542970027471353D0*t140
     #+0.7714850137356763D-1*t154-0.3611915329092852D-3*t157
      t199 = t97*t198
      t200 = t191*t199
      t202 = t108*t80
      t206 = t108*t121
      t210 = t138*t80
      t214 = t151*t54
      t218 = t66*t78
      t219 = t54*t32
      t220 = t135*t80
      t221 = t219*t220
      t225 = t54*t80
      t229 = -0.4286027854087091D-2*t106*t93*t202
     #-0.1360533322067624D-3*t118*t93*t206-0.2571616712452254D-1*t127
     #*t93*t210+0.1285808356226127D-1*t92*t214*t80
     #-0.601985888182142D-4*t218*t221+0.1285808356226127D-1*t92*t77
     #*t159*t225-t111-t124-t141+t155-t158
      t230 = t91*t229
      vrhoa(i) = vrhoa(i)+0.1554534543482745D-1*rhob*(1.D0*t160
     #-0.7777208750882749D2*t170+t188-1.D0*t200+t230)
      vrhob(i) = vrhob(i)+0.1554534543482745D-1*t54
     #+0.1554534543482745D-1*t98
      t239 = sigmaaa*t37
      t241 = 0.6936084891727404D-1*t27+0.8778318595271399D-3*t239
      t243 = t127*t107*t241
      t244 = 0.2571616712452254D-1*t243
      t245 = t65*t73
      t246 = t27*t80
      t247 = t245*t246
      t248 = 0.1222199328351994D-2*t247
      t250 = t92*t107*t239
      t251 = 0.2257447080683033D-4*t250
      t252 = -t244+t248+t251
      t253 = t252*t54
      t255 = -t252
      t256 = t255*t74
      t257 = t256*t64
      t258 = t257*t169
      t263 = -0.1383609789223028D0*t243+0.6575812588638345D-2*t247
     #+0.1214576754133604D-3*t250
      t264 = t172*t263
      t269 = 0.3278192763011299D1*t264-0.1028646684980902D0*t243
     #+0.4888797313407978D-2*t247+0.9029788322732131D-4*t250
      t270 = t269*t90
      t271 = t270*t97
      t276 = 0.4917289144516948D1*t264-0.1542970027471353D0*t243
     #+0.7333195970111966D-2*t247+0.135446824840982D-3*t250
      t277 = t97*t276
      t278 = t191*t277
      t280 = t241*t80
      t288 = t54*sigmaaa
      t289 = t37*t80
      t290 = t288*t289
      t297 = -0.2571616712452254D-1*t127*t93*t280
     #+0.1222199328351994D-2*t245*t27*t54*t80+0.2257447080683033D-4
     #*t218*t290+0.1285808356226127D-1*t92*t77*t252*t225-t244+t248+t251
      t298 = t91*t297
      vsigmaaa(i) = vsigmaaa(i)+0.1554534543482745D-1*rhob*(1.D0*t253
     #-0.7777208750882749D2*t258+t271-1.D0*t278+t298)
      t305 = 1/t24/t34/t128
      t306 = t32*t305
      t308 = t92*t107*t306
      t309 = 0.3812577291820233D-3*t308
      t310 = t32**2
      t311 = t34**2
      t314 = 1/t25/t311/t34
      t317 = t92*t107*t310*t314
      t318 = 0.2818359422037475D-6*t317
      t319 = t151*t80
      t321 = t92*t319*t136
      t322 = 0.1203971776364284D-3*t321
      t325 = 0.678194967191124D0*t146+0.1482560473868058D-1*t306
      t327 = t127*t107*t325
      t328 = 0.2571616712452254D-1*t327
      t329 = t126*t77
      t330 = t66*t329
      t332 = t330*t210*t136
      t333 = 0.2407943552728568D-3*t332
      t348 = 0.9294070438186991D0*t146*t74-0.2323517609546748D0
     #*sigmaaa/t25/t35*t148+0.4224577471903178D-1*sigmaaa/t25/t133/t56
     #/t108
      t351 = t66*t73*t348*t80
      t352 = 0.1285808356226127D-1*t351
      t353 = 1/t128
      t356 = t118*t77*t353*t121
      t357 = 0.2721066644135248D-3*t356
      t359 = 1/t58/t5
      t360 = t64**2
      t363 = t359/t360*t73
      t364 = 1/t34
      t365 = t77*t364
      t368 = dexp(t79-0.1136734210716166D0*t59)
      t370 = t363*t365*t368
      t371 = 0.2159401412535421D-5*t370
      t373 = 1/t24/t311
      t375 = t32*t121
      t377 = t118*t77*t373*t375
      t378 = 0.1273940795796543D-5*t377
      t380 = t359*t116*t73
      t381 = t365*t121
      t382 = t380*t381
      t383 = 0.2062086362684779D-5*t382
      t384 = t72**2
      t385 = 1/t384
      t386 = t66*t385
      t387 = t138**2
      t389 = t386*t107*t387
      t390 = 0.7714850137356763D-1*t389
      t392 = t127*t319*t138
      t393 = 0.5143233424904509D-1*t392
      t396 = t118*t151*t108*t121
      t397 = 0.2721066644135248D-3*t396
      t399 = t106*t107*t353
      t400 = 0.8572055708174181D-2*t399
      t404 = 1/t103/t5*t65*t73
      t406 = t404*t107*t364
      t407 = 0.2857351902724727D-2*t406
      t411 = 1/t113/t5*t116*t73
      t412 = t411*t381
      t413 = 0.9070222147117492D-5*t412
      t416 = t106*t107*t373*t32
      t417 = 0.4013239254547614D-4*t416
      t418 = t117*t126
      t419 = t138*t121
      t421 = t418*t119*t419
      t422 = 0.5442133288270495D-3*t421
      t423 = t105*t126
      t426 = t423*t107*t108*t138
      t427 = 0.1714411141634836D-1*t426
      t429 = t106*t319*t108
      t430 = 0.8572055708174181D-2*t429
      t431 = t309+t318-t322-t328+t333+t352+t357+t371+t378-t383+t390
     #-t393-t397+t400-t407-t413+t417+t422+t427-t430
      t434 = t159**2
      t437 = t159*t162
      t439 = t64*t72
      t441 = t439*t165*t168
      t449 = t162**2
      t465 = dexp(-t167-t60)
      t470 = t71*t165
      t475 = t77**2
      t477 = t72/t475
      t482 = t163*t439
      t499 = 0.1525030916728093D-2*t308+0.112734376881499D-5*t317
     #-0.4815887105457136D-3*t321-0.1028646684980902D0*t327
     #+0.9631774210914273D-3*t332+0.5143233424904509D-1*t351
     #+0.1088426657654099D-2*t356+0.8637605650141684D-5*t370
     #+0.5095763183186173D-5*t377-0.8248345450739115D-5*t382
     #+0.3085940054942705D0*t389
      t529 = 0.2051285184758976D-2*t308+0.1516365042658901D-5*t317
     #-0.6477742688712557D-3*t321-0.1383609789223028D0*t327
     #+0.1295548537742511D-2*t332+0.6918048946115138D-1*t351
     #+0.146401850156108D-2*t356+0.1161825134662837D-4*t370
     #+0.6854197779240001D-5*t377-0.1109466610563933D-4*t382
     #+0.4150829367669083D0*t389-0.2767219578446055D0*t392
     #-0.146401850156108D-2*t396+0.4612032630743426D-1*t399
     #-0.1537344210247809D-1*t406-0.4880061671870268D-4*t412
     #+0.2159247562904186D-3*t416+0.2928037003122161D-2*t421
     #+0.9224065261486851D-1*t426-0.4612032630743426D-1*t429
      t530 = t172*t529
      t533 = 1/t83/t82
      t534 = t178**2
      t535 = t533*t534
      t537 = -0.2057293369961804D0*t392-0.1088426657654099D-2*t396
     #+0.3428822283269673D-1*t399-0.1142940761089891D-1*t406
     #-0.3628088858846997D-4*t412+0.1605295701819045D-3*t416
     #+0.2176853315308198D-2*t421+0.6857644566539345D-1*t426
     #-0.3428822283269673D-1*t429+0.3278192763011299D1*t530
     #-0.2369304401100098D2*t535
      t541 = t186*t190
      t548 = t86/t189/t89
      t549 = t198**2
      t567 = 0.228754637509214D-2*t308+0.1691015653222485D-5*t317
     #-0.7223830658185704D-3*t321-0.1542970027471353D0*t327
     #+0.1444766131637141D-2*t332+0.7714850137356763D-1*t351
     #+0.1632639986481149D-2*t356+0.1295640847521253D-4*t370
     #+0.764364477477926D-5*t377-0.1237251817610867D-4*t382
     #+0.4628910082414058D0*t389
      t579 = -0.3085940054942705D0*t392-0.1632639986481149D-2*t396
     #+0.5143233424904509D-1*t399-0.1714411141634836D-1*t406
     #-0.5442133288270495D-4*t412+0.2407943552728568D-3*t416
     #+0.3265279972962297D-2*t421+0.1028646684980902D0*t426
     #-0.5143233424904509D-1*t429+0.4917289144516948D1*t530
     #-0.3553956601650148D2*t535
      t584 = t309+t318-t328+t371+t357-t383+t333+t352-t322+t400-t397
     #-t393+t390
      t586 = t117*t78
      t606 = t54*t373
      t610 = t378-t430+t427+t422+t417-t413-t407-0.1D1*t449
     #-0.2721066644135248D-3*t586*t160*t206+0.3812577291820233D-3*t218
     #*t219*t305*t80+0.2818359422037475D-6*t218*t54*t310*t314*t80
     #-0.8572055708174181D-2*t106*t214*t202+0.2721066644135248D-3*t118
     #*t93*t353*t121+0.1273940795796543D-5*t586*t606*t375
      t612 = t105*t329
      t613 = t54*t108
      t634 = 1/t71
      t638 = t66*t152
      t650 = t59**2
      t652 = 1/t650/t58/t57
      t654 = t652/t63
      t659 = t136*t80
      t663 = 0.1714411141634836D-1*t612*t613*t210
     #+0.1285808356226127D-1*t92*t77*t431*t225+0.4681769917478079D-2
     #*t162*t32*t135-0.1D1*t151*t162*t165+0.1285808356226127D-1*t92
     #*t77*t434*t225+0.3333333333333333D0*t5*t162-0.2D1*t437+0.2D1
     #*t634*t162*t138-0.1203971776364284D-3*t638*t221
     #+0.2159401412535421D-5*t363*t93*t364*t368-0.2857351902724727D-2
     #*t404*t93*t364*t80+0.105811516582519D-1*t654*t162*t108*t61
     #-0.1203971776364284D-3*t218*t160*t659
      t667 = t117*t329
      t671 = t105*t78
      t675 = t54*t138
      t680 = t93*t364*t121
      t683 = t32*t80
      t715 = -0.2721066644135248D-3*t118*t214*t206
     #+0.5442133288270495D-3*t667*t613*t419-0.8572055708174181D-2*t671
     #*t160*t202+0.2407943552728568D-3*t330*t675*t659
     #-0.9070222147117492D-5*t411*t680+0.4013239254547614D-4*t671*t606
     #*t683-0.2571616712452254D-1*t127*t93*t325*t80
     #+0.7714850137356763D-1*t386*t93*t387*t80-0.5143233424904509D-1
     #*t330*t160*t210+0.1285808356226127D-1*t92*t348*t54*t80
     #+0.2571616712452254D-1*t92*t151*t159*t225-0.5143233424904509D-1
     #*t127*t214*t210-0.2062086362684779D-5*t380*t680
     #+0.8572055708174181D-2*t106*t93*t353*t80
      t719 = 1.D0*t431*t54+1.D0*t434*t54-0.155544175017655D3*t437*t74
     #*t441+0.7777208750882749D2*t431*t74*t64*t169
     #-0.7777208750882749D2*t449*t74*t64*t169-0.2592402916960916D2
     #*t162*t148*t64*t166*t108*t168-0.8229182527097421D0*t162/t57/t5
     #*t63*t166*t108*t465-0.155544175017655D3*t164*t470*t138*t168
     #+0.7777208750882749D2*t164*t477*t151*t168-0.3641110197183013D0
     #*t482*t165*t32*t135*t168+(t499+t537)*t90*t97-2.D0*t541*t199+2.D0
     #*t187*t229+2.D0*t548*t97*t549-2.D0*t191*t229*t198-1.D0*t191*t97*
     #(t567+t579)+t91*(t584+t610+t663+t715)
      v2rhoa2(i) = v2rhoa2(i)+0.1554534543482745D-1*rhob*t719
      v2rhoab(i) = v2rhoab(i)+0.1554534543482745D-1*t160
     #-0.1208993965512352D1*t170+0.1554534543482745D-1*t188
     #-0.1554534543482745D-1*t200+0.1554534543482745D-1*t230
      v2rhob2(i) = v2rhob2(i)
      t731 = t423*t107*t108*t241
      t732 = 0.8572055708174181D-2*t731
      t733 = t130*t65
      t735 = t733*t73*t80
      t736 = 0.4073997761173315D-3*t735
      t739 = t106*t107*t305*sigmaaa
      t740 = 0.7524823602276776D-5*t739
      t741 = t241*t121
      t743 = t418*t119*t741
      t744 = 0.2721066644135248D-3*t743
      t745 = t652*t116
      t748 = t745*t73*t145*t121
      t749 = 0.1293227644990607D-4*t748
      t751 = sigmaaa*t121
      t753 = t118*t77*t305*t751
      t754 = 0.2388638992118519D-6*t753
      t757 = t386*t107*t138*t241
      t758 = 0.7714850137356763D-1*t757
      t759 = t65*t126
      t761 = t759*t246*t138
      t762 = 0.2444398656703989D-2*t761
      t764 = t330*t210*t239
      t765 = 0.4514894161366065D-4*t764
      t767 = sigmaaa*t135
      t769 = -0.1849622637793975D0*t130-0.4681769917478079D-2*t767
      t771 = t127*t107*t769
      t772 = 0.2571616712452254D-1*t771
      t774 = t127*t319*t241
      t775 = 0.2571616712452254D-1*t774
      t780 = -0.2534746483141907D0*t130*t74+0.3168433103927383D-1*t145
     #*t148
      t783 = t66*t73*t780*t80
      t784 = 0.1285808356226127D-1*t783
      t786 = t92*t319*t239
      t787 = 0.2257447080683033D-4*t786
      t788 = t135*t241
      t790 = t330*t683*t788
      t791 = 0.1203971776364284D-3*t790
      t793 = 1/t311/rhoa
      t796 = t245*t793*t80*t32
      t797 = 0.5722056048640281D-5*t796
      t798 = t32*sigmaaa
      t801 = 1/t25/t311/t128
      t804 = t92*t107*t798*t801
      t805 = 0.1056884783264053D-6*t804
      t807 = t92*t107*t767
      t808 = 0.1203971776364284D-3*t807
      t809 = t732-t736-t740+t744-t749-t754+t758-t762-t765-t772-t775
     #+t784+t787+t791-t797-t805-t808
      t812 = t159*t252
      t815 = t159*t255
      t819 = t252*t162
      t828 = t162*t255
      t833 = t470*t241*t168
      t839 = t477*t27*t168
      t844 = t165*sigmaaa*t37*t168
      t848 = t533*t178*t263
      t867 = 0.4612032630743426D-1*t731-0.2191937529546115D-2*t735
     #-0.4048589180445348D-4*t739+0.146401850156108D-2*t743
     #-0.6957967027662436D-4*t748-0.12851620836075D-5*t753
     #+0.4150829367669083D0*t757-0.1315162517727669D-1*t761
     #-0.2429153508267209D-3*t764-0.1383609789223028D0*t771
     #-0.1383609789223028D0*t774+0.6918048946115138D-1*t783
     #+0.1214576754133604D-3*t786+0.6477742688712557D-3*t790
     #-0.3078644156046066D-4*t796-0.5686368909970879D-6*t804
     #-0.6477742688712557D-3*t807
      t868 = t172*t867
      t887 = -0.2369304401100098D2*t848+0.3278192763011299D1*t868
     #+0.3428822283269673D-1*t731-0.1629599104469326D-2*t735
     #-0.300992944091071D-4*t739+0.1088426657654099D-2*t743
     #-0.5172910579962427D-4*t748-0.9554555968474075D-6*t753
     #+0.3085940054942705D0*t757-0.9777594626815955D-2*t761
     #-0.1805957664546426D-3*t764-0.1028646684980902D0*t771
     #-0.1028646684980902D0*t774+0.5143233424904509D-1*t783
     #+0.9029788322732131D-4*t786+0.4815887105457136D-3*t790
     #-0.2288822419456112D-4*t796-0.4227539133056213D-6*t804
     #-0.4815887105457136D-3*t807
      t893 = t269*t190
      t921 = -0.3553956601650148D2*t848+0.4917289144516948D1*t868
     #+0.5143233424904509D-1*t731-0.2444398656703989D-2*t735
     #-0.4514894161366065D-4*t739+0.1632639986481149D-2*t743
     #-0.775936586994364D-4*t748-0.1433183395271111D-5*t753
     #+0.4628910082414058D0*t757-0.1466639194022393D-1*t761
     #-0.2708936496819639D-3*t764-0.1542970027471353D0*t771
     #-0.1542970027471353D0*t774+0.7714850137356763D-1*t783
     #+0.135446824840982D-3*t786+0.7223830658185704D-3*t790
     #-0.3433233629184168D-4*t796-0.634130869958432D-6*t804
     #-0.7223830658185704D-3*t807
      t941 = t54*t305
      t959 = 0.7714850137356763D-1*t66*t385*t77*t675*t280-t736
     #-0.1360533322067624D-3*t586*t253*t206+0.1203971776364284D-3*t330
     #*t219*t788*t80-0.2388638992118519D-6*t586*t941*t751
     #-0.1293227644990607D-4*t745*t73*t145*t54*t121-t749
     #-0.2571616712452254D-1*t127*t214*t280-0.2571616712452254D-1*t330
     #*t253*t210-t762-t775+t784+0.4681769917478079D-2*t255*t32*t135
      t967 = t759*t27
      t974 = t239*t80
      t978 = 0.8572055708174181D-2*t612*t613*t280-t772
     #-0.7524823602276776D-5*t671*t941*sigmaaa*t80-t765
     #-0.2444398656703989D-2*t967*t675*t80-0.4286027854087091D-2*t671
     #*t253*t202+t758-t754+t744-t740-0.4514894161366065D-4*t330*t675
     #*t974+t732-t797
      t1011 = -0.1203971776364284D-3*t218*t288*t220
     #+0.2721066644135248D-3*t667*t613*t741-t805+0.1285808356226127D-1
     #*t92*t151*t252*t225+t791+t787-0.2571616712452254D-1*t330*t160
     #*t280-t808+0.2257447080683033D-4*t638*t290-0.4073997761173315D-3
     #*t733*t73*t54*t80-0.5722056048640281D-5*t245*t793*t219*t80
     #-0.601985888182142D-4*t218*t253*t659-0.1056884783264053D-6*t218
     #*t54*t798*t801*t80
      t1026 = t245*t27
      t1035 = t634*t255
      t1049 = 0.1285808356226127D-1*t92*t77*t809*t225
     #+0.1285808356226127D-1*t218*t812*t225-0.2571616712452254D-1*t127
     #*t93*t769*t80+0.2257447080683033D-4*t218*t160*t974
     #+0.1222199328351994D-2*t1026*t160*t80-0.1D1*t828
     #+0.1285808356226127D-1*t92*t780*t54*t80+0.2D1*t1035*t138-0.1D1
     #*t151*t255*t165+0.3333333333333333D0*t5*t255-0.1D1*t815-0.1D1
     #*t819+0.105811516582519D-1*t654*t255*t108*t61
      t1053 = 1.D0*t809*t54+1.D0*t812*t54-0.7777208750882749D2*t815
     #*t74*t441-0.7777208750882749D2*t819*t74*t441
     #+0.7777208750882749D2*t809*t74*t64*t169-0.7777208750882749D2
     #*t828*t74*t441-0.155544175017655D3*t164*t833
     #+0.7392469698735191D1*t162*t104*t64*t839+0.136541632394363D0
     #*t482*t844+t887*t90*t97-1.D0*t541*t277+t187*t297-1.D0*t893*t199
     #+2.D0*t548*t199*t276-1.D0*t191*t297*t198-1.D0*t191*t97*t921+t270
     #*t229-1.D0*t191*t229*t276+t91*(t959+t978+t1011+t1049)
      v2rhoasigmaaa(i) = v2rhoasigmaaa(i)+0.1554534543482745D-1*rhob
     #*t1053
      v2rhobsigmaaa(i) = v2rhobsigmaaa(i)+0.1554534543482745D-1*t253
     #-0.1208993965512352D1*t258+0.1554534543482745D-1*t271
     #-0.1554534543482745D-1*t278+0.1554534543482745D-1*t298
      t1063 = t241**2
      t1065 = t386*t107*t1063
      t1066 = 0.7714850137356763D-1*t1065
      t1068 = t759*t246*t241
      t1069 = 0.4888797313407978D-2*t1068
      t1071 = t330*t280*t239
      t1072 = 0.9029788322732131D-4*t1071
      t1073 = t107*t37
      t1074 = t127*t1073
      t1075 = 0.2257447080683033D-4*t1074
      t1076 = 1/t311
      t1079 = t245*t1076*t80*sigmaaa
      t1080 = 0.4291542036480211D-5*t1079
      t1083 = 1/t25/t311/t23
      t1086 = t92*t107*t32*t1083
      t1087 = 0.39633179372402D-7*t1086
      t1088 = t92*t1073
      t1089 = 0.2257447080683033D-4*t1088
      t1090 = t1066-t1069-t1072-t1075+t1080+t1087+t1089
      t1093 = t252**2
      t1096 = t252*t255
      t1105 = t255**2
      t1119 = t263**2
      t1120 = t533*t1119
      t1130 = t172*(0.4150829367669083D0*t1065-0.2630325035455338D-1
     #*t1068-0.4858307016534418D-3*t1071-0.1214576754133604D-3*t1074
     #+0.2308983117034549D-4*t1079+0.2132388341239079D-6*t1086
     #+0.1214576754133604D-3*t1088)
      t1146 = t276**2
      t1176 = t93*t289
      t1196 = t54*t241
      t1203 = -0.175566371905428D-2*t255*sigmaaa*t37
     #+0.4514894161366065D-4*t218*t253*t974+0.1285808356226127D-1*t92
     #*t77*t1090*t225+0.2257447080683033D-4*t92*t1176
     #+0.39633179372402D-7*t218*t219*t1083*t80-0.2D1*t1096-0.1D1*t1105
     #+0.4291542036480211D-5*t245*t1076*t288*t80+0.2444398656703989D-2
     #*t1026*t253*t80-0.9505299311782149D-1*t27*t255*t74*t165
     #-0.9029788322732131D-4*t330*t1196*t974-0.5143233424904509D-1
     #*t330*t253*t280
      t1219 = -0.2257447080683033D-4*t127*t1176-0.4888797313407978D-2
     #*t967*t1196*t80+0.2D1*t1035*t241+0.7714850137356763D-1*t386*t93
     #*t1063*t80+t1066-t1069-t1072-t1075+t1080+t1087+t1089
     #+0.1285808356226127D-1*t92*t77*t1093*t225
      s1 = 1.D0*t1090*t54+1.D0*t1093*t54-0.155544175017655D3*t1096*t74
     #*t441+0.7777208750882749D2*t1090*t74*t64*t169
     #-0.7777208750882749D2*t1105*t74*t64*t169-0.155544175017655D3
     #*t257*t833+0.7392469698735191D1*t255*t104*t64*t839
      t1222 = s1+0.136541632394363D0*t256*t439*t844+(
     #-0.2369304401100098D2*t1120+0.3278192763011299D1*t1130
     #+0.3085940054942705D0*t1065-0.1955518925363191D-1*t1068
     #-0.3611915329092852D-3*t1071-0.9029788322732131D-4*t1074
     #+0.1716616814592084D-4*t1079+0.158532717489608D-6*t1086
     #+0.9029788322732131D-4*t1088)*t90*t97-2.D0*t893*t277+2.D0*t270
     #*t297+2.D0*t548*t97*t1146-2.D0*t191*t297*t276-1.D0*t191*t97*(
     #-0.3553956601650148D2*t1120+0.4917289144516948D1*t1130
     #+0.4628910082414058D0*t1065-0.2933278388044787D-1*t1068
     #-0.5417872993639278D-3*t1071-0.135446824840982D-3*t1074
     #+0.2574925221888126D-4*t1079+0.237799076234412D-6*t1086
     #+0.135446824840982D-3*t1088)+t91*(t1203+t1219)
      v2sigmaaa2(i) = v2sigmaaa2(i)+0.1554534543482745D-1*rhob*t1222
      endif
      endif ! rhoa,rhob
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end
      
      
      subroutine rks_c_ft97
     & (ideriv,npt,rhoa1,sigmaaa1,
     &  zk,vrhoa,vsigmaaa,
     &  v2rhoa2,v2rhoasigmaaa,v2sigmaaa2)
c
c     M. Filatov, and W. Thiel
c     A nonlocal correlation energy density functional from a 
c     Coulomb hole model
c     Int. J. Quant. Chem. 62 (1997) 603-616
c
c     M. Filatov, and W. Thiel
c     A new gradient-corrected exchange-correlation density functional
c     Mol. Phys. 91 (1997) 847-859
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt)
      REAL sigmaaa1(npt)
      REAL zk(npt),vrhoa(npt),vsigmaaa(npt)
      REAL v2rhoa2(npt),v2rhoasigmaaa(npt),v2sigmaaa2(npt)
      parameter(tolmin=1.0d-20)
      parameter(tolmax=1.0d+5)
      
      if(ideriv.eq.0) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      zk(i) = 0.D0
      if(rho.gt.tolmin) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t1 = 1/rho
      t2 = t1**(1.D0/3.D0)
      trsa = 0.1620017014140023D-1*t2
      t3 = t1**(1.D0/15.D0)
      t4 = t3**2
      t6 = dexp(-0.5940962989070748D0*t4)
      t8 = t1**(1.D0/6.D0)
      t10 = dexp(-0.9630597286858919D0*t8)
      t13 = (0.1247511874D1+0.812904345D0*t6-0.859614445D0*t10)**2
      t14 = sigma**2
      t15 = rho**2
      t16 = t15**2
      t18 = rho**(1.D0/3.D0)
      t21 = t14/t18/t16/rho
      t24 = (0.1D1+0.1127183082292567D0*t21)**2
      t26 = t18**2
      t36 = dexp(-0.1127183082292567D0*t21)
      t37 = t36**2
      trcaa = t13*t24/(0.1D1+0.312690210142125D0*sigma/t26/t15/t2)*t37
      if(trsa.lt.tolmax*trcaa) then
      t2 = 1/rho
      t3 = t2**(1.D0/3.D0)
      t4 = t3**2
      t5 = t2**(1.D0/6.D0)
      t9 = (0.8301627136974294D0*t5+0.1354632918982911D1*t3)**2
      t13 = dexp(-0.6108870577108572D0*t4/t9)
      t15 = 0.3141592653589793D1**2
      t17 = 2**(1.D0/3.D0)
      t20 = 1/0.3141592653589793D1*t2
      t21 = t20**(1.D0/3.D0)
      t23 = 2**(1.D0/15.D0)
      t24 = t23**2
      t25 = t20**(1.D0/15.D0)
      t26 = t25**2
      t29 = dexp(-0.630966299458536D0*t24*t26)
      t31 = 2**(1.D0/6.D0)
      t32 = t20**(1.D0/6.D0)
      t35 = dexp(-0.1038340679664977D1*t31*t32)
      t38 = (0.1247511874D1+0.812904345D0*t29-0.859614445D0*t35)**2
      t40 = 0.3141592653589793D1**(1.D0/3.D0)
      t43 = sigma**2
      t45 = rho**2
      t46 = t45**2
      t48 = rho**(1.D0/3.D0)
      t50 = 1/t48/t46/rho
      t52 = 1/t40/0.3141592653589793D1*t43*t17*t50
      t55 = (0.1D1+0.4116400544093991D0*t52)**2
      t58 = t40**2
      t61 = t48**2
      t63 = 1/t61/t45
      t71 = dexp(0.8232801088187983D0*t52)
      t76 = expei(-0.1858628590577086D0/t15*t17*t21/t38/t55*(0.1D1
     #+0.3634859066227017D0/t58*sigma*t17*t63/t21)*t71)
      t78 = t2**(1.D0/15.D0)
      t79 = t78**2
      t81 = dexp(-0.5940962989070748D0*t79)
      t84 = dexp(-0.9630597286858919D0*t5)
      t87 = (0.1247511874D1+0.812904345D0*t81-0.859614445D0*t84)**2
      t89 = t3/t87
      t90 = t43*t50
      t93 = (0.1D1+0.1127183082292567D0*t90)**2
      t94 = 1/t93
      t99 = 0.1D1+0.312690210142125D0*sigma*t63/t3
      t102 = dexp(0.2254366164585135D0*t90)
      t104 = t89*t94*t99*t102
      t105 = dsqrt(t104)
      t123 = 0.7772672717413724D-2*rho*t13*(1.D0*t76+(0.6D1
     #+0.5091195559614694D0*t105+0.6480068056560093D-1*t104)/(0.3D1
     #+0.763679333942204D0*t105+0.972010208484014D-1*t104)*
     #(0.1620017014140023D-1*t89*t94*t99*t76*t102+0.1D1))
      zk(i) = zk(i)+2*t123
      endif
      t1 = 1/rho
      t2 = t1**(1.D0/3.D0)
      trsa = 0.1620017014140023D-1*t2
      t3 = t1**(1.D0/15.D0)
      t4 = t3**2
      t5 = t4**2
      t7 = dexp(-0.6837598574312962D-1*t5)
      t10 = (0.942486901D0+0.349064173D0*t7)**2
      t11 = rho**2
      t12 = rho**(1.D0/3.D0)
      t13 = t12**2
      t16 = sigma/t13/t11
      t18 = sigma**2
      t19 = t11**2
      t23 = t18/t12/t19/rho
      t26 = (0.1D1+0.1101034845366882D0*t16+0.1105998838086603D-2*t23)
     #**2
      t34 = dexp(-0.1105998838086603D-2*t23)
      t35 = t34**2
      trcba = t10*t26/(0.1D1+0.1197592668846558D0*t16/t2)*t35
      if(trsa.lt.tolmax*trcba) then
      t2 = 0.3141592653589793D1**2
      t4 = 2**(1.D0/3.D0)
      t7 = 1/rho
      t8 = 1/0.3141592653589793D1*t7
      t9 = t8**(1.D0/3.D0)
      t11 = 2**(1.D0/15.D0)
      t12 = t11**2
      t13 = t12**2
      t14 = t8**(1.D0/15.D0)
      t15 = t14**2
      t16 = t15**2
      t19 = dexp(-0.7712625328179681D-1*t13*t16)
      t22 = (0.942486901D0+0.349064173D0*t19)**2
      t24 = 0.3141592653589793D1**(1.D0/3.D0)
      t25 = t24**2
      t27 = 1/t25*sigma
      t28 = t4**2
      t29 = rho**2
      t30 = rho**(1.D0/3.D0)
      t31 = t30**2
      t33 = 1/t31/t29
      t39 = sigma**2
      t41 = t29**2
      t44 = 1/t30/t41/rho
      t46 = 1/t24/0.3141592653589793D1*t39*t4*t44
      t49 = (0.1D1+0.1487810599361293D0*t27*t28*t33
     #+0.4039037038781002D-2*t46)**2
      t59 = dexp(0.8078074077562004D-2*t46)
      t64 = expei(-0.1858628590577086D0/t2*t4*t9/t22/t49*(0.1D1
     #+0.1392138426088027D0*t27*t4*t33/t9)*t59)
      t66 = t7**(1.D0/3.D0)
      t67 = t7**(1.D0/15.D0)
      t68 = t67**2
      t69 = t68**2
      t71 = dexp(-0.6837598574312962D-1*t69)
      t74 = (0.942486901D0+0.349064173D0*t71)**2
      t76 = t66/t74
      t77 = sigma*t33
      t79 = t39*t44
      t82 = (0.1D1+0.1101034845366882D0*t77+0.1105998838086603D-2*t79)
     #**2
      t83 = 1/t82
      t87 = 0.1D1+0.1197592668846558D0*t77/t66
      t90 = dexp(0.2211997676173206D-2*t79)
      t92 = t76*t83*t87*t90
      t93 = dsqrt(t92)
      t111 = 0.7772672717413724D-2*rho*(1.D0*t64+(0.6D1
     #+0.5091195559614694D0*t93+0.6480068056560093D-1*t92)/(0.3D1
     #+0.763679333942204D0*t93+0.972010208484014D-1*t92)*
     #(0.1620017014140023D-1*t76*t83*t87*t64*t90+0.1D1))
      zk(i) = zk(i)+2*t111
      endif
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      zk(i) = 0.D0
      vrhoa(i) = 0.D0
      vsigmaaa(i) = 0.D0
      if(rho.gt.tolmin) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t1 = 1/rho
      t2 = t1**(1.D0/3.D0)
      trsa = 0.1620017014140023D-1*t2
      t3 = t1**(1.D0/15.D0)
      t4 = t3**2
      t6 = dexp(-0.5940962989070748D0*t4)
      t8 = t1**(1.D0/6.D0)
      t10 = dexp(-0.9630597286858919D0*t8)
      t13 = (0.1247511874D1+0.812904345D0*t6-0.859614445D0*t10)**2
      t14 = sigma**2
      t15 = rho**2
      t16 = t15**2
      t18 = rho**(1.D0/3.D0)
      t21 = t14/t18/t16/rho
      t24 = (0.1D1+0.1127183082292567D0*t21)**2
      t26 = t18**2
      t36 = dexp(-0.1127183082292567D0*t21)
      t37 = t36**2
      trcaa = t13*t24/(0.1D1+0.312690210142125D0*sigma/t26/t15/t2)*t37
      if(trsa.lt.tolmax*trcaa) then
      t2 = 1/rho
      t3 = t2**(1.D0/3.D0)
      t4 = t3**2
      t5 = t2**(1.D0/6.D0)
      t8 = 0.8301627136974294D0*t5+0.1354632918982911D1*t3
      t9 = t8**2
      t10 = 1/t9
      t13 = dexp(-0.6108870577108572D0*t4*t10)
      t14 = rho*t13
      t15 = 0.3141592653589793D1**2
      t17 = 2**(1.D0/3.D0)
      t20 = 1/0.3141592653589793D1*t2
      t21 = t20**(1.D0/3.D0)
      t23 = 2**(1.D0/15.D0)
      t24 = t23**2
      t25 = t20**(1.D0/15.D0)
      t26 = t25**2
      t29 = dexp(-0.630966299458536D0*t24*t26)
      t31 = 2**(1.D0/6.D0)
      t32 = t20**(1.D0/6.D0)
      t35 = dexp(-0.1038340679664977D1*t31*t32)
      t38 = (0.1247511874D1+0.812904345D0*t29-0.859614445D0*t35)**2
      t40 = 0.3141592653589793D1**(1.D0/3.D0)
      t43 = sigma**2
      t45 = rho**2
      t46 = t45**2
      t48 = rho**(1.D0/3.D0)
      t50 = 1/t48/t46/rho
      t52 = 1/t40/0.3141592653589793D1*t43*t17*t50
      t55 = (0.1D1+0.4116400544093991D0*t52)**2
      t58 = t40**2
      t61 = t48**2
      t63 = 1/t61/t45
      t71 = dexp(0.8232801088187983D0*t52)
      t76 = expei(-0.1858628590577086D0/t15*t17*t21/t38/t55*(0.1D1
     #+0.3634859066227017D0/t58*sigma*t17*t63/t21)*t71)
      t78 = t2**(1.D0/15.D0)
      t79 = t78**2
      t81 = dexp(-0.5940962989070748D0*t79)
      t84 = dexp(-0.9630597286858919D0*t5)
      t86 = 0.1247511874D1+0.812904345D0*t81-0.859614445D0*t84
      t87 = t86**2
      t88 = 1/t87
      t89 = t3*t88
      t90 = t43*t50
      t92 = 0.1D1+0.1127183082292567D0*t90
      t93 = t92**2
      t94 = 1/t93
      t96 = 1/t3
      t99 = 0.1D1+0.312690210142125D0*sigma*t63*t96
      t100 = t94*t99
      t102 = dexp(0.2254366164585135D0*t90)
      t104 = t89*t100*t102
      t105 = dsqrt(t104)
      t108 = 0.6D1+0.5091195559614694D0*t105+0.6480068056560093D-1*t104
      t111 = 0.3D1+0.763679333942204D0*t105+0.972010208484014D-1*t104
      t112 = 1/t111
      t113 = t108*t112
      t114 = t89*t94
      t115 = t99*t76
      t119 = 0.1620017014140023D-1*t114*t115*t102+0.1D1
      t121 = 1.D0*t76+t113*t119
      t123 = 0.7772672717413724D-2*t14*t121
      zk(i) = zk(i)+2*t123
      t125 = t13*t121
      t128 = 1/t45
      t134 = t5**2
      t135 = t134**2
      t138 = 1/t135/t5*t128
      t140 = 1/t4
      t151 = t140*t88*t94
      t152 = t99*t102
      t154 = t151*t152*t128
      t155 = 0.1080011342760016D-1*t154
      t159 = t3/t87/t86*t94
      t160 = t79**2
      t162 = t160**2
      t170 = 0.1287849233946613D0/t162/t160/t78*t128*t81
     #-0.2759533513920579D0*t138*t84
      t172 = t159*t152*t170
      t173 = 0.3240034028280047D-1*t172
      t175 = 1/t93/t92
      t176 = t89*t175
      t179 = 1/t48/t46/t45
      t181 = t152*t43*t179
      t182 = t176*t181
      t183 = 0.389558564557814D-1*t182
      t197 = -0.1667681120758D1*sigma/t61/t45/rho*t96
     #+0.20846014009475D0*sigma/t61/t46/t3/t2
      t200 = t89*t94*t197*t102
      t201 = 0.1620017014140023D-1*t200
      t202 = t114*t181
      t203 = 0.389558564557814D-1*t202
      t204 = -t155-t173+t183+t201-t203
      t213 = dexp(-0.2254366164585135D0*t90)
      t214 = t93/t99*t213
      t217 = 1/t105
      t224 = t217*(-0.5810796994275671D-1*t154-0.1743239098282701D0
     #*t172+0.2095946261306892D0*t182+0.8716195491413506D-1*t200
     #-0.2095946261306892D0*t202)
      t234 = t111**2
      t236 = t108/t234
      t256 = t89*t175*t99
      t259 = t76*t43*t179*t102
      t266 = t89*t100
      t270 = t76*t102
      t274 = -0.1080011342760016D-1*t151*t115*t128*t102
     #-0.3240034028280047D-1*t159*t115*t170*t102+0.389558564557814D-1
     #*t256*t259+0.1620017014140023D-1*t114*t197*t76*t102
     #-0.389558564557814D-1*t266*t259+0.1620017014140023D-1*t114*t99
     #*t204*t270-t155-t173+t183+t201-t203
      vrhoa(i) = vrhoa(i)+0.1554534543482745D-1*t125
     #+0.7772672717413724D-2*rho*(0.8145160769478096D0*t96*t10*t128
     #+0.1221774115421714D1*t4/t9/t8*(-0.2767209045658098D0*t138
     #-0.9030886126552743D0*t140*t128))*t125+0.7772672717413724D-2*t14
     #*(1.D0*t204*t76+0.6172774676263781D2*t204*t96*t87*t214+
     #(0.2920537730383703D1*t224-0.4320045371040062D-1*t154
     #-0.1296013611312019D0*t172+0.1558234258231256D0*t182
     #+0.6480068056560093D-1*t200-0.1558234258231256D0*t202)*t112*t119
     #-1.D0*t236*t119*(0.4380806595575555D1*t224-0.6480068056560093D-1
     #*t154-0.1944020416968028D0*t172+0.2337351387346884D0*t182
     #+0.972010208484014D-1*t200-0.2337351387346884D0*t202)+t113*t274)
      t281 = t152*sigma*t50
      t282 = t176*t281
      t283 = 0.2921689234183605D-1*t282
      t284 = t88*t94
      t286 = t284*t63*t102
      t287 = 0.2026253842341047D-1*t286
      t288 = t114*t281
      t289 = 0.2921689234183605D-1*t288
      t290 = -t283+t287+t289
      t302 = t217*(-0.1571959695980169D0*t282+0.1090187599939973D0
     #*t286+0.1571959695980169D0*t288)
      t320 = t76*sigma*t50*t102
      vsigmaaa(i) = vsigmaaa(i)+0.1554534543482745D-1*t14*(1.D0*t290
     #*t76+0.6172774676263781D2*t290*t96*t87*t214+
     #(0.2920537730383703D1*t302-0.1168675693673442D0*t282
     #+0.8105015369364188D-1*t286+0.1168675693673442D0*t288)*t112*t119
     #-1.D0*t236*t119*(0.4380806595575555D1*t302-0.1753013540510163D0
     #*t282+0.1215752305404628D0*t286+0.1753013540510163D0*t288)+t113*
     #(-0.2921689234183605D-1*t256*t320+0.2026253842341047D-1*t284*t63
     #*t76*t102+0.2921689234183605D-1*t266*t320+0.1620017014140023D-1
     #*t114*t99*t290*t270-t283+t287+t289))
      endif
      t1 = 1/rho
      t2 = t1**(1.D0/3.D0)
      trsa = 0.1620017014140023D-1*t2
      t3 = t1**(1.D0/15.D0)
      t4 = t3**2
      t5 = t4**2
      t7 = dexp(-0.6837598574312962D-1*t5)
      t10 = (0.942486901D0+0.349064173D0*t7)**2
      t11 = rho**2
      t12 = rho**(1.D0/3.D0)
      t13 = t12**2
      t16 = sigma/t13/t11
      t18 = sigma**2
      t19 = t11**2
      t23 = t18/t12/t19/rho
      t26 = (0.1D1+0.1101034845366882D0*t16+0.1105998838086603D-2*t23)
     #**2
      t34 = dexp(-0.1105998838086603D-2*t23)
      t35 = t34**2
      trcba = t10*t26/(0.1D1+0.1197592668846558D0*t16/t2)*t35
      if(trsa.lt.tolmax*trcba) then
      t2 = 0.3141592653589793D1**2
      t4 = 2**(1.D0/3.D0)
      t7 = 1/rho
      t8 = 1/0.3141592653589793D1*t7
      t9 = t8**(1.D0/3.D0)
      t11 = 2**(1.D0/15.D0)
      t12 = t11**2
      t13 = t12**2
      t14 = t8**(1.D0/15.D0)
      t15 = t14**2
      t16 = t15**2
      t19 = dexp(-0.7712625328179681D-1*t13*t16)
      t22 = (0.942486901D0+0.349064173D0*t19)**2
      t24 = 0.3141592653589793D1**(1.D0/3.D0)
      t25 = t24**2
      t27 = 1/t25*sigma
      t28 = t4**2
      t29 = rho**2
      t30 = rho**(1.D0/3.D0)
      t31 = t30**2
      t33 = 1/t31/t29
      t39 = sigma**2
      t41 = t29**2
      t44 = 1/t30/t41/rho
      t46 = 1/t24/0.3141592653589793D1*t39*t4*t44
      t49 = (0.1D1+0.1487810599361293D0*t27*t28*t33
     #+0.4039037038781002D-2*t46)**2
      t59 = dexp(0.8078074077562004D-2*t46)
      t64 = expei(-0.1858628590577086D0/t2*t4*t9/t22/t49*(0.1D1
     #+0.1392138426088027D0*t27*t4*t33/t9)*t59)
      t66 = t7**(1.D0/3.D0)
      t67 = t7**(1.D0/15.D0)
      t68 = t67**2
      t69 = t68**2
      t70 = 0.6837598574312962D-1*t69
      t71 = dexp(-t70)
      t73 = 0.942486901D0+0.349064173D0*t71
      t74 = t73**2
      t75 = 1/t74
      t76 = t66*t75
      t77 = sigma*t33
      t79 = t39*t44
      t81 = 0.1D1+0.1101034845366882D0*t77+0.1105998838086603D-2*t79
      t82 = t81**2
      t83 = 1/t82
      t84 = 1/t66
      t87 = 0.1D1+0.1197592668846558D0*t77*t84
      t88 = t83*t87
      t89 = 0.2211997676173206D-2*t79
      t90 = dexp(t89)
      t92 = t76*t88*t90
      t93 = dsqrt(t92)
      t96 = 0.6D1+0.5091195559614694D0*t93+0.6480068056560093D-1*t92
      t99 = 0.3D1+0.763679333942204D0*t93+0.972010208484014D-1*t92
      t100 = 1/t99
      t101 = t96*t100
      t102 = t76*t83
      t103 = t87*t64
      t107 = 0.1620017014140023D-1*t102*t103*t90+0.1D1
      t108 = t101*t107
      t111 = 0.7772672717413724D-2*rho*(1.D0*t64+t108)
      zk(i) = zk(i)+2*t111
      t113 = t66**2
      t116 = 1/t113*t75*t83
      t117 = t87*t90
      t118 = 1/t29
      t120 = t116*t117*t118
      t121 = 0.1080011342760016D-1*t120
      t122 = t7**(1.D0/5.D0)
      t123 = t122**2
      t128 = 1/t123/t74/t73*t83
      t131 = dexp(t89-t70)
      t133 = t128*t87*t118*t131
      t134 = 0.4124365791094649D-3*t133
      t137 = t76/t82/t81
      t141 = sigma/t31/t29/rho
      t145 = 1/t30/t41/t29
      t146 = t39*t145
      t148 = -0.5872185841956702D0*t141-0.1179732093959043D-1*t146
      t150 = t137*t117*t148
      t151 = 0.3240034028280047D-1*t150
      t161 = -0.6387160900514977D0*t141*t84+0.7983951125643721D-1
     #*sigma/t31/t41/t66/t7
      t164 = t76*t83*t161*t90
      t165 = 0.1620017014140023D-1*t164
      t167 = t102*t117*t146
      t168 = 0.3822372128681373D-3*t167
      t169 = -t121-t134-t151+t165-t168
      t178 = dexp(-0.2211997676173206D-2*t79)
      t179 = t82/t87*t178
      t182 = 1/t93
      t189 = t182*(-0.5810796994275671D-1*t120-0.2219037096493859D-2
     #*t133-0.1743239098282701D0*t150+0.8716195491413506D-1*t164
     #-0.2056555111688325D-2*t167)
      t199 = t99**2
      t201 = t96/t199
      t228 = t76*t88
      t235 = t64*t90
      t239 = -0.1080011342760016D-1*t116*t103*t118*t90
     #-0.4124365791094649D-3*t128*t103*t118*t131-0.3240034028280047D-1
     #*t137*t103*t148*t90+0.1620017014140023D-1*t102*t161*t64*t90
     #-0.3822372128681373D-3*t228*t64*t39*t145*t90
     #+0.1620017014140023D-1*t102*t87*t169*t235-t121-t134-t151+t165-t168
      vrhoa(i) = vrhoa(i)+0.7772672717413724D-2*rho*(1.D0*t169*t64
     #+0.6172774676263781D2*t169*t84*t74*t179+(0.2920537730383703D1
     #*t189-0.4320045371040062D-1*t120-0.164974631643786D-2*t133
     #-0.1296013611312019D0*t150+0.6480068056560093D-1*t164
     #-0.1528948851472549D-2*t167)*t100*t107-1.D0*t201*t107*
     #(0.4380806595575555D1*t189-0.6480068056560093D-1*t120
     #-0.2474619474656789D-2*t133-0.1944020416968028D0*t150
     #+0.972010208484014D-1*t164-0.2293423277208824D-2*t167)+t101*t239
     #)+0.1554534543482745D-1*t64+0.1554534543482745D-1*t108
      t248 = sigma*t44
      t250 = 0.4404139381467527D0*t33+0.8847990704692823D-2*t248
      t252 = t137*t117*t250
      t253 = 0.3240034028280047D-1*t252
      t254 = t75*t83
      t256 = t254*t33*t90
      t257 = 0.7760481998163131D-2*t256
      t259 = t102*t117*t248
      t260 = 0.286677909651103D-3*t259
      t261 = -t253+t257+t260
      t273 = t182*(-0.1743239098282701D0*t252+0.4175380728300095D-1
     #*t256+0.1542416333766244D-2*t259)
      vsigmaaa(i) = vsigmaaa(i)+0.1554534543482745D-1*rho*(1.D0*t261
     #*t64+0.6172774676263781D2*t261*t84*t74*t179+
     #(0.2920537730383703D1*t273-0.1296013611312019D0*t252
     #+0.3104192799265252D-1*t256+0.1146711638604412D-2*t259)*t100
     #*t107-1.D0*t201*t107*(0.4380806595575555D1*t273
     #-0.1944020416968028D0*t252+0.4656289198897879D-1*t256
     #+0.1720067457906618D-2*t259)+t101*(-0.3240034028280047D-1*t137
     #*t103*t250*t90+0.7760481998163131D-2*t254*t33*t64*t90
     #+0.286677909651103D-3*t228*t64*sigma*t44*t90
     #+0.1620017014140023D-1*t102*t87*t261*t235-t253+t257+t260))
      endif
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      zk(i) = 0.D0
      vrhoa(i) = 0.D0
      vsigmaaa(i) = 0.D0
      v2rhoa2(i) = 0.D0
      v2rhoasigmaaa(i) = 0.D0
      v2sigmaaa2(i) = 0.D0
      if(rho.gt.tolmin) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t1 = 1/rho
      t2 = t1**(1.D0/3.D0)
      trsa = 0.1620017014140023D-1*t2
      t3 = t1**(1.D0/15.D0)
      t4 = t3**2
      t6 = dexp(-0.5940962989070748D0*t4)
      t8 = t1**(1.D0/6.D0)
      t10 = dexp(-0.9630597286858919D0*t8)
      t13 = (0.1247511874D1+0.812904345D0*t6-0.859614445D0*t10)**2
      t14 = sigma**2
      t15 = rho**2
      t16 = t15**2
      t18 = rho**(1.D0/3.D0)
      t21 = t14/t18/t16/rho
      t24 = (0.1D1+0.1127183082292567D0*t21)**2
      t26 = t18**2
      t36 = dexp(-0.1127183082292567D0*t21)
      t37 = t36**2
      trcaa = t13*t24/(0.1D1+0.312690210142125D0*sigma/t26/t15/t2)*t37
      if(trsa.lt.tolmax*trcaa) then
      t2 = 1/rho
      t3 = t2**(1.D0/3.D0)
      t4 = t3**2
      t5 = t2**(1.D0/6.D0)
      t8 = 0.8301627136974294D0*t5+0.1354632918982911D1*t3
      t9 = t8**2
      t10 = 1/t9
      t13 = dexp(-0.6108870577108572D0*t4*t10)
      t14 = rho*t13
      t15 = 0.3141592653589793D1**2
      t17 = 2**(1.D0/3.D0)
      t20 = 1/0.3141592653589793D1*t2
      t21 = t20**(1.D0/3.D0)
      t23 = 2**(1.D0/15.D0)
      t24 = t23**2
      t25 = t20**(1.D0/15.D0)
      t26 = t25**2
      t29 = dexp(-0.630966299458536D0*t24*t26)
      t31 = 2**(1.D0/6.D0)
      t32 = t20**(1.D0/6.D0)
      t35 = dexp(-0.1038340679664977D1*t31*t32)
      t38 = (0.1247511874D1+0.812904345D0*t29-0.859614445D0*t35)**2
      t40 = 0.3141592653589793D1**(1.D0/3.D0)
      t43 = sigma**2
      t45 = rho**2
      t46 = t45**2
      t47 = t46*rho
      t48 = rho**(1.D0/3.D0)
      t50 = 1/t48/t47
      t52 = 1/t40/0.3141592653589793D1*t43*t17*t50
      t55 = (0.1D1+0.4116400544093991D0*t52)**2
      t58 = t40**2
      t61 = t48**2
      t63 = 1/t61/t45
      t71 = dexp(0.8232801088187983D0*t52)
      t76 = expei(-0.1858628590577086D0/t15*t17*t21/t38/t55*(0.1D1
     #+0.3634859066227017D0/t58*sigma*t17*t63/t21)*t71)
      t78 = t2**(1.D0/15.D0)
      t79 = t78**2
      t81 = dexp(-0.5940962989070748D0*t79)
      t84 = dexp(-0.9630597286858919D0*t5)
      t86 = 0.1247511874D1+0.812904345D0*t81-0.859614445D0*t84
      t87 = t86**2
      t88 = 1/t87
      t89 = t3*t88
      t90 = t43*t50
      t92 = 0.1D1+0.1127183082292567D0*t90
      t93 = t92**2
      t94 = 1/t93
      t96 = 1/t3
      t99 = 0.1D1+0.312690210142125D0*sigma*t63*t96
      t100 = t94*t99
      t102 = dexp(0.2254366164585135D0*t90)
      t104 = t89*t100*t102
      t105 = dsqrt(t104)
      t108 = 0.6D1+0.5091195559614694D0*t105+0.6480068056560093D-1*t104
      t111 = 0.3D1+0.763679333942204D0*t105+0.972010208484014D-1*t104
      t112 = 1/t111
      t113 = t108*t112
      t114 = t89*t94
      t115 = t99*t76
      t119 = 0.1620017014140023D-1*t114*t115*t102+0.1D1
      t121 = 1.D0*t76+t113*t119
      t123 = 0.7772672717413724D-2*t14*t121
      zk(i) = zk(i)+2*t123
      t125 = t13*t121
      t127 = t96*t10
      t128 = 1/t45
      t132 = 1/t9/t8
      t133 = t4*t132
      t134 = t5**2
      t135 = t134**2
      t136 = t135*t5
      t137 = 1/t136
      t138 = t137*t128
      t140 = 1/t4
      t143 = -0.2767209045658098D0*t138-0.9030886126552743D0*t140*t128
      t146 = 0.8145160769478096D0*t127*t128+0.1221774115421714D1*t133
     #*t143
      t147 = rho*t146
      t150 = t140*t88
      t151 = t150*t94
      t152 = t99*t102
      t154 = t151*t152*t128
      t155 = 0.1080011342760016D-1*t154
      t157 = 1/t87/t86
      t158 = t3*t157
      t159 = t158*t94
      t160 = t79**2
      t162 = t160**2
      t163 = t162*t160*t78
      t164 = 1/t163
      t170 = 0.1287849233946613D0*t164*t128*t81-0.2759533513920579D0
     #*t138*t84
      t172 = t159*t152*t170
      t173 = 0.3240034028280047D-1*t172
      t175 = 1/t93/t92
      t176 = t89*t175
      t177 = t46*t45
      t179 = 1/t48/t177
      t180 = t43*t179
      t181 = t152*t180
      t182 = t176*t181
      t183 = 0.389558564557814D-1*t182
      t184 = t45*rho
      t186 = 1/t61/t184
      t191 = 1/t61/t46
      t192 = sigma*t191
      t194 = 1/t3/t2
      t197 = -0.1667681120758D1*sigma*t186*t96+0.20846014009475D0*t192
     #*t194
      t198 = t94*t197
      t200 = t89*t198*t102
      t201 = 0.1620017014140023D-1*t200
      t202 = t114*t181
      t203 = 0.389558564557814D-1*t202
      t204 = -t155-t173+t183+t201-t203
      t205 = t204*t76
      t207 = -t204
      t208 = t207*t96
      t209 = t208*t87
      t210 = 1/t99
      t211 = t93*t210
      t213 = dexp(-0.2254366164585135D0*t90)
      t214 = t211*t213
      t217 = 1/t105
      t223 = -0.5810796994275671D-1*t154-0.1743239098282701D0*t172
     #+0.2095946261306892D0*t182+0.8716195491413506D-1*t200
     #-0.2095946261306892D0*t202
      t224 = t217*t223
      t231 = 0.2920537730383703D1*t224-0.4320045371040062D-1*t154
     #-0.1296013611312019D0*t172+0.1558234258231256D0*t182
     #+0.6480068056560093D-1*t200-0.1558234258231256D0*t202
      t232 = t231*t112
      t234 = t111**2
      t235 = 1/t234
      t236 = t108*t235
      t243 = 0.4380806595575555D1*t224-0.6480068056560093D-1*t154
     #-0.1944020416968028D0*t172+0.2337351387346884D0*t182
     #+0.972010208484014D-1*t200-0.2337351387346884D0*t202
      t244 = t119*t243
      t247 = t128*t102
      t251 = t170*t102
      t255 = t175*t99
      t256 = t89*t255
      t257 = t76*t43
      t258 = t179*t102
      t259 = t257*t258
      t262 = t197*t76
      t266 = t89*t100
      t270 = t76*t102
      t274 = -0.1080011342760016D-1*t151*t115*t247
     #-0.3240034028280047D-1*t159*t115*t251+0.389558564557814D-1*t256
     #*t259+0.1620017014140023D-1*t114*t262*t102-0.389558564557814D-1
     #*t266*t259+0.1620017014140023D-1*t114*t99*t204*t270-t155-t173
     #+t183+t201-t203
      t276 = 1.D0*t205-0.6172774676263781D2*t209*t214+t232*t119-1.D0
     #*t236*t244+t113*t274
      vrhoa(i) = vrhoa(i)+0.1554534543482745D-1*t125
     #+0.7772672717413724D-2*t147*t125+0.7772672717413724D-2*t14*t276
      t280 = sigma*t50
      t281 = t152*t280
      t282 = t176*t281
      t283 = 0.2921689234183605D-1*t282
      t284 = t88*t94
      t285 = t63*t102
      t286 = t284*t285
      t287 = 0.2026253842341047D-1*t286
      t288 = t114*t281
      t289 = 0.2921689234183605D-1*t288
      t290 = -t283+t287+t289
      t291 = t290*t76
      t293 = -t290
      t294 = t293*t96
      t301 = -0.1571959695980169D0*t282+0.1090187599939973D0*t286
     #+0.1571959695980169D0*t288
      t302 = t217*t301
      t307 = 0.2920537730383703D1*t302-0.1168675693673442D0*t282
     #+0.8105015369364188D-1*t286+0.1168675693673442D0*t288
      t308 = t307*t112
      t314 = 0.4380806595575555D1*t302-0.1753013540510163D0*t282
     #+0.1215752305404628D0*t286+0.1753013540510163D0*t288
      t315 = t119*t314
      t318 = t76*sigma
      t319 = t50*t102
      t320 = t318*t319
      t333 = -0.2921689234183605D-1*t256*t320+0.2026253842341047D-1
     #*t284*t63*t76*t102+0.2921689234183605D-1*t266*t320
     #+0.1620017014140023D-1*t114*t99*t290*t270-t283+t287+t289
      t335 = 1.D0*t291-0.6172774676263781D2*t294*t87*t214+t308*t119
     #-1.D0*t236*t315+t113*t333
      vsigmaaa(i) = vsigmaaa(i)+0.1554534543482745D-1*t14*t335
      t342 = t13*t276
      t345 = 1/t46
      t352 = 1/t184
      t355 = t9**2
      t358 = t143**2
      t363 = 1/t136/t2*t345
      t365 = t137*t352
      t368 = 1/t4/t2
      t369 = t368*t345
      t380 = t146**2
      t386 = t140*t157
      t390 = t386*t94*t152*t128*t170
      t391 = 0.4320045371040062D-1*t390
      t392 = t197*t102
      t394 = t151*t392*t128
      t395 = 0.2160022685520031D-1*t394
      t397 = t151*t152*t352
      t398 = 0.4320045371040062D-1*t397
      t400 = t368*t88*t94
      t402 = t400*t152*t345
      t403 = 0.1440015123680021D-1*t402
      t404 = t150*t175
      t405 = t46**2
      t407 = 1/t48/t405
      t409 = t152*t407*t43
      t410 = t404*t409
      t411 = 0.5194114194104187D-1*t410
      t412 = t151*t409
      t413 = 0.5194114194104187D-1*t412
      t414 = t87**2
      t417 = t3/t414*t94
      t418 = t170**2
      t420 = t417*t152*t418
      t421 = 0.972010208484014D-1*t420
      t423 = t159*t392*t170
      t424 = 0.6480068056560093D-1*t423
      t446 = 0.2232272005507463D0/t163/t2*t345*t81
     #-0.5151396935786452D0*t164*t352*t81+0.2040283902501318D-1/t162
     #/t79/t78/t2*t345*t81-0.4599222523200964D0*t363*t84
     #+0.1103813405568231D1*t365*t84-0.8858651990719928D-1*t369*t84
      t448 = t159*t152*t446
      t449 = 0.3240034028280047D-1*t448
      t450 = t158*t255
      t451 = t251*t180
      t452 = t450*t451
      t453 = 0.1558234258231256D0*t452
      t454 = t158*t100
      t455 = t454*t451
      t456 = 0.1558234258231256D0*t455
      t457 = t392*t180
      t458 = t176*t457
      t459 = 0.779117129115628D-1*t458
      t462 = 1/t48/t46/t184
      t464 = t152*t43*t462
      t465 = t176*t464
      t466 = 0.4934408484398978D0*t465
      t467 = t93**2
      t468 = 1/t467
      t469 = t89*t468
      t470 = t43**2
      t473 = 1/t61/t405/t46
      t475 = t152*t470*t473
      t476 = t469*t475
      t477 = 0.1405132235301584D0*t476
      t478 = t176*t475
      t479 = 0.1873509647068778D0*t478
      t494 = 0.1222966155222533D2*t192*t96-0.3057415388056333D1*sigma
     #/t61/t47*t194+0.5558937069193333D0*sigma/t61/t177/t3/t128
      t497 = t89*t94*t494*t102
      t498 = 0.1620017014140023D-1*t497
      t499 = t114*t457
      t500 = 0.779117129115628D-1*t499
      t501 = t114*t464
      t502 = 0.4934408484398978D0*t501
      t503 = t114*t475
      t504 = 0.9367548235343892D-1*t503
      t505 = t391-t395+t398-t403-t411+t413+t421-t424-t449-t453+t456
     #+t459-t466+t477-t479+t498-t500+t502+t504
      t508 = t204**2
      t511 = t204*t207
      t513 = t87*t93
      t515 = t513*t210*t213
      t523 = t207**2
      t539 = t87*t92
      t540 = t208*t539
      t543 = t210*t43*t179*t213
      t546 = t99**2
      t548 = t93/t546
      t553 = t208*t513
      t577 = 1/t105/t104
      t578 = t223**2
      t579 = t577*t578
      t600 = 0.2324318797710268D0*t390-0.1162159398855134D0*t394
     #+0.2324318797710268D0*t397-0.7747729325700894D-1*t402
     #-0.2794595015075856D0*t410+0.2794595015075856D0*t412
     #+0.5229717294848104D0*t420-0.3486478196565402D0*t423
     #-0.1743239098282701D0*t448-0.8383785045227567D0*t452
     #+0.8383785045227567D0*t455+0.4191892522613783D0*t458
     #-0.2654865264322063D1*t465+0.7560048534846353D0*t476
     #-0.1008006471312847D1*t478+0.8716195491413506D-1*t497
     #-0.4191892522613783D0*t499+0.2654865264322063D1*t501
     #+0.5040032356564235D0*t503
      t601 = t217*t600
      t603 = 0.6232937032925024D0*t455+0.3116468516462512D0*t458
     #-0.1973763393759591D1*t465+0.5620528941206335D0*t476
     #-0.7494038588275113D0*t478+0.6480068056560093D-1*t497
     #-0.3116468516462512D0*t499+0.1973763393759591D1*t501
     #+0.3747019294137557D0*t503-0.1675351208713011D2*t579
     #+0.2920537730383703D1*t601
      t607 = t231*t235
      t614 = t108/t234/t111
      t615 = t243**2
      t644 = 0.9349405549387536D0*t455+0.4674702774693768D0*t458
     #-0.2960645090639387D1*t465+0.8430793411809502D0*t476
     #-0.1124105788241267D1*t478+0.972010208484014D-1*t497
     #-0.4674702774693768D0*t499+0.2960645090639387D1*t501
     #+0.5620528941206335D0*t503-0.2513026813069517D2*t579
     #+0.4380806595575555D1*t601
      t659 = 1/t86
      t666 = t150*t100
      t670 = 1/t92
      t675 = t89*t175*t197
      t679 = t257*t462*t102
      t682 = -0.6480068056560093D-1*t159*t262*t251
     #+0.972010208484014D-1*t417*t115*t418*t102-0.6480068056560093D-1
     #*t454*t205*t251+0.2D1*t659*t207*t170-0.1D1*t197*t207*t210
     #-0.2160022685520031D-1*t666*t205*t247-t403-t411-t395
     #-0.2404657242224144D1*t670*t207*t180+t391+0.779117129115628D-1
     #*t675*t259+0.4934408484398978D0*t266*t679
      t683 = t76*t170
      t684 = t180*t102
      t685 = t683*t684
      t696 = t76*t470*t473*t102
      t702 = t150*t255
      t705 = t76*t407*t43*t102
      t708 = t89*t198
      t711 = t398+t413+t421-0.1558234258231256D0*t450*t685
     #+0.1620017014140023D-1*t114*t99*t505*t270+0.1558234258231256D0
     #*t454*t685+t477+0.9367548235343892D-1*t266*t696
     #+0.2404657242224144D1*t207*t43*t179-0.5194114194104187D-1*t702
     #*t705+t459-t466-0.779117129115628D-1*t708*t259
      t716 = t89*t468*t99
      t723 = -t449-t453+t456-t424-t500+t502+t504-0.4934408484398978D0
     #*t256*t679+0.1405132235301584D0*t716*t696-t479
     #-0.1873509647068778D0*t256*t696+t498+0.5194114194104187D-1*t666
     #*t705
      t724 = t205*t684
      t765 = 0.779117129115628D-1*t256*t724-0.779117129115628D-1*t266
     #*t724-0.1D1*t523-0.2160022685520031D-1*t151*t262*t247
     #+0.4320045371040062D-1*t386*t100*t76*t128*t251
     #+0.1620017014140023D-1*t114*t99*t508*t270-0.2D1*t511
     #+0.6666666666666667D0*t2*t207+0.4320045371040062D-1*t151*t115
     #*t352*t102-0.1440015123680021D-1*t400*t115*t345*t102
     #+0.3240034028280047D-1*t114*t197*t204*t270+0.1620017014140023D-1
     #*t114*t494*t76*t102-0.3240034028280047D-1*t159*t115*t446*t102
      s1 = 1.D0*t505*t76+1.D0*t508*t76-0.1234554935252756D3*t511*t96
     #*t515+0.6172774676263781D2*t505*t96*t87*t214
     #-0.6172774676263781D2*t523*t96*t87*t214-0.4115183117509188D2
     #*t207*t194*t87*t211*t128*t213-0.1234554935252756D3*t208*t86*t211
     #*t170*t213+0.148434073298955D3*t540*t543
      t769 = s1+0.6172774676263781D2*t209*t548*t197*t213
     #-0.148434073298955D3*t553*t543+(0.1728018148416025D0*t390
     #-0.8640090742080124D-1*t394+0.1728018148416025D0*t397
     #-0.5760060494720083D-1*t402-0.2077645677641675D0*t410
     #+0.2077645677641675D0*t412+0.3888040833936056D0*t420
     #-0.2592027222624037D0*t423-0.1296013611312019D0*t448
     #-0.6232937032925024D0*t452+t603)*t112*t119-2.D0*t607*t244+2.D0
     #*t232*t274+2.D0*t614*t119*t615-2.D0*t236*t274*t243-1.D0*t236
     #*t119*(0.2592027222624037D0*t390-0.1296013611312019D0*t394
     #+0.2592027222624037D0*t397-0.8640090742080124D-1*t402
     #-0.3116468516462512D0*t410+0.3116468516462512D0*t412
     #+0.5832061250904084D0*t420-0.3888040833936056D0*t423
     #-0.1944020416968028D0*t448-0.9349405549387536D0*t452+t644)+t113*
     #(t682+t711+t723+t765)
      v2rhoa2(i) = v2rhoa2(i)+0.310906908696549D-1*t146*t13*t121
     #+0.310906908696549D-1*t342+0.7772672717413724D-2*rho*
     #(0.5430107179652064D0*t194*t10*t345-0.3258064307791238D1*t96
     #*t132*t128*t143-0.3258064307791238D1*t127*t352
     #-0.3665322346265143D1*t4/t355*t358+0.1221774115421714D1*t133*(
     #-0.461201507609683D0*t363+0.1106883618263239D1*t365
     #-0.1204118150207032D1*t369+0.3612354450621097D1*t140*t352))*t125
     #+0.7772672717413724D-2*rho*t380*t125+0.1554534543482745D-1*t147
     #*t342+0.7772672717413724D-2*t14*t769
      t773 = t13*t335
      t778 = t152*t462*sigma
      t779 = t404*t778
      t780 = 0.194779282278907D-1*t779
      t781 = t186*t88
      t783 = t781*t94*t102
      t784 = 0.1350835894894031D-1*t783
      t785 = t151*t778
      t786 = 0.194779282278907D-1*t785
      t787 = t251*t280
      t788 = t450*t787
      t789 = 0.584337846836721D-1*t788
      t790 = t157*t94
      t792 = t790*t285*t170
      t793 = 0.4052507684682094D-1*t792
      t794 = t454*t787
      t795 = 0.584337846836721D-1*t794
      t796 = t43*sigma
      t799 = 1/t61/t405/t184
      t801 = t152*t796*t799
      t802 = t469*t801
      t803 = 0.1053849176476188D0*t802
      t804 = t88*t175
      t806 = 1/t405/rho
      t808 = t806*t102*t43
      t809 = t804*t808
      t810 = 0.4872445976569897D-1*t809
      t811 = t176*t801
      t812 = 0.1405132235301584D0*t811
      t814 = t152*sigma*t179
      t815 = t176*t814
      t816 = 0.3116468516462512D0*t815
      t817 = t392*t280
      t818 = t176*t817
      t819 = 0.2921689234183605D-1*t818
      t824 = -0.6670724483032D1*t186*t96+0.8338405603789999D0*t191*t194
      t827 = t89*t94*t824*t102
      t828 = 0.1620017014140023D-1*t827
      t829 = t114*t817
      t830 = 0.2921689234183605D-1*t829
      t831 = t284*t808
      t832 = 0.4872445976569897D-1*t831
      t833 = t114*t801
      t834 = 0.7025661176507919D-1*t833
      t835 = t114*t814
      t836 = 0.3116468516462512D0*t835
      t837 = t780-t784-t786+t789-t793-t795-t803+t810+t812+t816-t819
     #+t828+t830-t832-t834-t836
      t840 = t204*t290
      t843 = t204*t293
      t847 = t290*t207
      t856 = t207*t293
      t862 = t210*sigma*t50*t213
      t868 = t548*t63*t213
      t874 = t577*t223*t301
      t892 = 0.1047973130653446D0*t779-0.7267917332933151D-1*t783
     #-0.1047973130653446D0*t785+0.3143919391960338D0*t788
     #-0.2180375199879945D0*t792-0.3143919391960338D0*t794
     #-0.5670036401134764D0*t802+0.2621527507578613D0*t809
     #+0.7560048534846353D0*t811+0.1676757009045513D1*t815
     #-0.1571959695980169D0*t818+0.8716195491413506D-1*t827
     #+0.1571959695980169D0*t829-0.2621527507578613D0*t831
     #-0.3780024267423176D0*t833-0.1676757009045513D1*t835
      t893 = t217*t892
      t911 = -0.1675351208713011D2*t874+0.2920537730383703D1*t893
     #+0.779117129115628D-1*t779-0.5403343579576125D-1*t783
     #-0.779117129115628D-1*t785+0.2337351387346884D0*t788
     #-0.1621003073872838D0*t792-0.2337351387346884D0*t794
     #-0.4215396705904751D0*t802+0.1948978390627959D0*t809
     #+0.5620528941206335D0*t811+0.1246587406585005D1*t815
     #-0.1168675693673442D0*t818+0.6480068056560093D-1*t827
     #+0.1168675693673442D0*t829-0.1948978390627959D0*t831
     #-0.2810264470603167D0*t833-0.1246587406585005D1*t835
      t917 = t307*t235
      t944 = -0.2513026813069517D2*t874+0.4380806595575555D1*t893
     #+0.1168675693673442D0*t779-0.8105015369364188D-1*t783
     #-0.1168675693673442D0*t785+0.3506027081020326D0*t788
     #-0.2431504610809256D0*t792-0.3506027081020326D0*t794
     #-0.6323095058857127D0*t802+0.2923467585941938D0*t809
     #+0.8430793411809502D0*t811+0.1869881109877507D1*t815
     #-0.1753013540510163D0*t818+0.972010208484014D-1*t827
     #+0.1753013540510163D0*t829-0.2923467585941938D0*t831
     #-0.4215396705904751D0*t833-0.1869881109877507D1*t835
      t958 = t670*t293
      t990 = 0.2D1*t659*t293*t170-0.1D1*t197*t293*t210-t784
     #-0.2404657242224144D1*t958*t180+0.1620017014140023D-1*t114*t197
     #*t290*t270+0.1620017014140023D-1*t114*t824*t76*t102
     #+0.1620017014140023D-1*t114*t99*t837*t270-0.1350835894894031D-1
     #*t781*t94*t76*t102-0.3240034028280047D-1*t454*t291*t251
     #-0.1080011342760016D-1*t666*t291*t247-0.4052507684682094D-1*t790
     #*t63*t683*t102+0.1620017014140023D-1*t266*t840*t270
      t993 = t284*t63
      t999 = t76*t796*t799*t102
      t1005 = t280*t102
      t1006 = t683*t1005
      t1011 = t76*t462*sigma*t102
      t1015 = t257*t102
      t1018 = t205*t1005
      t1021 = -0.1D1*t843-0.1D1*t847+0.2026253842341047D-1*t993*t205
     #*t102+0.1405132235301584D0*t256*t999-0.1D1*t856
     #+0.6666666666666667D0*t2*t293+0.584337846836721D-1*t450*t1006
     #-0.194779282278907D-1*t666*t1011-t793+0.4872445976569897D-1*t804
     #*t806*t1015-t795+0.2921689234183605D-1*t266*t1018-t803
      t1025 = t318*t258
      t1028 = t291*t684
      t1031 = t810+t812+t789+t780-0.2921689234183605D-1*t256*t1018
     #-t786-t836+0.3116468516462512D0*t256*t1025+0.389558564557814D-1
     #*t256*t1028+t830-t832-t834
      t1054 = t816+0.2921689234183605D-1*t708*t320-t819
     #-0.584337846836721D-1*t454*t1006+t828-0.7025661176507919D-1*t266
     #*t999-0.3116468516462512D0*t266*t1025-0.4872445976569897D-1*t284
     #*t806*t1015-0.1053849176476188D0*t716*t999+0.2404657242224144D1
     #*t293*t43*t179-0.2921689234183605D-1*t675*t320
     #+0.194779282278907D-1*t702*t1011-0.389558564557814D-1*t266*t1028
      t1058 = 1.D0*t837*t76+1.D0*t840*t76-0.6172774676263781D2*t843
     #*t96*t515-0.6172774676263781D2*t847*t96*t515
     #+0.6172774676263781D2*t837*t96*t87*t214-0.6172774676263781D2
     #*t856*t96*t515-0.1113255549742162D3*t540*t862
     #+0.7720664842723637D2*t207*t140*t87*t868+0.1113255549742162D3
     #*t553*t862+t911*t112*t119-1.D0*t607*t315+t232*t333-1.D0*t917
     #*t244+2.D0*t614*t244*t314-1.D0*t236*t333*t243-1.D0*t236*t119
     #*t944+t308*t274-1.D0*t236*t274*t314+t113*(t990+t1021+t1031+t1054)
      v2rhoasigmaaa(i) = v2rhoasigmaaa(i)+0.1554534543482745D-1*t773
     #+0.7772672717413724D-2*t147*t773+0.7772672717413724D-2*t14*t1058
      t1064 = 1/t61/t405/t45
      t1066 = t152*t43*t1064
      t1067 = t469*t1066
      t1068 = 0.7903868823571409D-1*t1067
      t1069 = 1/t405
      t1071 = t1069*t102*sigma
      t1072 = t804*t1071
      t1073 = 0.7308668964854846D-1*t1072
      t1074 = t176*t1066
      t1075 = 0.1053849176476188D0*t1074
      t1076 = t152*t50
      t1077 = t176*t1076
      t1078 = 0.1168675693673442D0*t1077
      t1079 = t284*t1071
      t1080 = 0.7308668964854846D-1*t1079
      t1081 = t114*t1066
      t1082 = 0.5269245882380939D-1*t1081
      t1083 = t114*t1076
      t1084 = 0.1168675693673442D0*t1083
      t1085 = t1068-t1073-t1075-t1078+t1080+t1082+t1084
      t1088 = t290**2
      t1091 = t290*t293
      t1100 = t293**2
      t1115 = t301**2
      t1116 = t577*t1115
      t1126 = t217*(0.4252527300851073D0*t1067-0.3932291261367919D0
     #*t1072-0.5670036401134764D0*t1074-0.6287838783920675D0*t1077
     #+0.3932291261367919D0*t1079+0.2835018200567382D0*t1081
     #+0.6287838783920675D0*t1083)
      t1142 = t314**2
      t1163 = t318*t102
      t1167 = t257*t1064*t102
      t1170 = t291*t1005
      t1175 = t115*t319
      t1190 = -0.7308668964854846D-1*t804*t1069*t1163
     #-0.1053849176476188D0*t256*t1167-0.584337846836721D-1*t256*t1170
     #+0.1803492931668108D1*t958*t280-0.1168675693673442D0*t176*t1175
     #+0.7903868823571409D-1*t716*t1167-0.12507608405685D1*t63*t293
     #*t96*t210+0.1620017014140023D-1*t114*t99*t1088*t270-0.2D1*t1091
     #-0.1D1*t1100+t1068-t1073
      t1210 = -t1075-t1078+t1080+t1082+t1084+0.1620017014140023D-1
     #*t114*t99*t1085*t270+0.5269245882380939D-1*t266*t1167
     #+0.584337846836721D-1*t266*t1170-0.1803492931668108D1*t293*sigma
     #*t50+0.1168675693673442D0*t114*t1175+0.7308668964854846D-1*t284
     #*t1069*t1163+0.4052507684682094D-1*t993*t291*t102
      s1 = 1.D0*t1085*t76+1.D0*t1088*t76-0.1234554935252756D3*t1091
     #*t96*t515+0.6172774676263781D2*t1085*t96*t87*t214
     #-0.6172774676263781D2*t1100*t96*t87*t214-0.1113255549742162D3
     #*t294*t539*t862+0.7720664842723637D2*t293*t140*t87*t868
      t1213 = s1+0.1113255549742162D3*t294*t513*t862+(
     #-0.1675351208713011D2*t1116+0.2920537730383703D1*t1126
     #+0.3161547529428563D0*t1067-0.2923467585941938D0*t1072
     #-0.4215396705904751D0*t1074-0.4674702774693768D0*t1077
     #+0.2923467585941938D0*t1079+0.2107698352952376D0*t1081
     #+0.4674702774693768D0*t1083)*t112*t119-2.D0*t917*t315+2.D0*t308
     #*t333+2.D0*t614*t119*t1142-2.D0*t236*t333*t314-1.D0*t236*t119*(
     #-0.2513026813069517D2*t1116+0.4380806595575555D1*t1126
     #+0.4742321294142845D0*t1067-0.4385201378912907D0*t1072
     #-0.6323095058857127D0*t1074-0.7012054162040652D0*t1077
     #+0.4385201378912907D0*t1079+0.3161547529428563D0*t1081
     #+0.7012054162040652D0*t1083)+t113*(t1190+t1210)
      v2sigmaaa2(i) = v2sigmaaa2(i)+0.1554534543482745D-1*t14*t1213
      endif
      t1 = 1/rho
      t2 = t1**(1.D0/3.D0)
      trsa = 0.1620017014140023D-1*t2
      t3 = t1**(1.D0/15.D0)
      t4 = t3**2
      t5 = t4**2
      t7 = dexp(-0.6837598574312962D-1*t5)
      t10 = (0.942486901D0+0.349064173D0*t7)**2
      t11 = rho**2
      t12 = rho**(1.D0/3.D0)
      t13 = t12**2
      t16 = sigma/t13/t11
      t18 = sigma**2
      t19 = t11**2
      t23 = t18/t12/t19/rho
      t26 = (0.1D1+0.1101034845366882D0*t16+0.1105998838086603D-2*t23)
     #**2
      t34 = dexp(-0.1105998838086603D-2*t23)
      t35 = t34**2
      trcba = t10*t26/(0.1D1+0.1197592668846558D0*t16/t2)*t35
      if(trsa.lt.tolmax*trcba) then
      t2 = 0.3141592653589793D1**2
      t4 = 2**(1.D0/3.D0)
      t7 = 1/rho
      t8 = 1/0.3141592653589793D1*t7
      t9 = t8**(1.D0/3.D0)
      t11 = 2**(1.D0/15.D0)
      t12 = t11**2
      t13 = t12**2
      t14 = t8**(1.D0/15.D0)
      t15 = t14**2
      t16 = t15**2
      t19 = dexp(-0.7712625328179681D-1*t13*t16)
      t22 = (0.942486901D0+0.349064173D0*t19)**2
      t24 = 0.3141592653589793D1**(1.D0/3.D0)
      t25 = t24**2
      t27 = 1/t25*sigma
      t28 = t4**2
      t29 = rho**2
      t30 = rho**(1.D0/3.D0)
      t31 = t30**2
      t33 = 1/t31/t29
      t39 = sigma**2
      t41 = t29**2
      t42 = t41*rho
      t44 = 1/t30/t42
      t46 = 1/t24/0.3141592653589793D1*t39*t4*t44
      t49 = (0.1D1+0.1487810599361293D0*t27*t28*t33
     #+0.4039037038781002D-2*t46)**2
      t59 = dexp(0.8078074077562004D-2*t46)
      t64 = expei(-0.1858628590577086D0/t2*t4*t9/t22/t49*(0.1D1
     #+0.1392138426088027D0*t27*t4*t33/t9)*t59)
      t66 = t7**(1.D0/3.D0)
      t67 = t7**(1.D0/15.D0)
      t68 = t67**2
      t69 = t68**2
      t70 = 0.6837598574312962D-1*t69
      t71 = dexp(-t70)
      t73 = 0.942486901D0+0.349064173D0*t71
      t74 = t73**2
      t75 = 1/t74
      t76 = t66*t75
      t77 = sigma*t33
      t79 = t39*t44
      t81 = 0.1D1+0.1101034845366882D0*t77+0.1105998838086603D-2*t79
      t82 = t81**2
      t83 = 1/t82
      t84 = 1/t66
      t87 = 0.1D1+0.1197592668846558D0*t77*t84
      t88 = t83*t87
      t89 = 0.2211997676173206D-2*t79
      t90 = dexp(t89)
      t92 = t76*t88*t90
      t93 = dsqrt(t92)
      t96 = 0.6D1+0.5091195559614694D0*t93+0.6480068056560093D-1*t92
      t99 = 0.3D1+0.763679333942204D0*t93+0.972010208484014D-1*t92
      t100 = 1/t99
      t101 = t96*t100
      t102 = t76*t83
      t103 = t87*t64
      t107 = 0.1620017014140023D-1*t102*t103*t90+0.1D1
      t108 = t101*t107
      t111 = 0.7772672717413724D-2*rho*(1.D0*t64+t108)
      zk(i) = zk(i)+2*t111
      t113 = t66**2
      t114 = 1/t113
      t115 = t114*t75
      t116 = t115*t83
      t117 = t87*t90
      t118 = 1/t29
      t120 = t116*t117*t118
      t121 = 0.1080011342760016D-1*t120
      t122 = t7**(1.D0/5.D0)
      t123 = t122**2
      t126 = 1/t74/t73
      t127 = 1/t123*t126
      t128 = t127*t83
      t129 = t87*t118
      t131 = dexp(t89-t70)
      t133 = t128*t129*t131
      t134 = 0.4124365791094649D-3*t133
      t136 = 1/t82/t81
      t137 = t76*t136
      t138 = t29*rho
      t140 = 1/t31/t138
      t141 = sigma*t140
      t143 = t41*t29
      t145 = 1/t30/t143
      t146 = t39*t145
      t148 = -0.5872185841956702D0*t141-0.1179732093959043D-1*t146
      t150 = t137*t117*t148
      t151 = 0.3240034028280047D-1*t150
      t155 = 1/t31/t41
      t156 = sigma*t155
      t158 = 1/t66/t7
      t161 = -0.6387160900514977D0*t141*t84+0.7983951125643721D-1*t156
     #*t158
      t162 = t83*t161
      t164 = t76*t162*t90
      t165 = 0.1620017014140023D-1*t164
      t167 = t102*t117*t146
      t168 = 0.3822372128681373D-3*t167
      t169 = -t121-t134-t151+t165-t168
      t170 = t169*t64
      t172 = -t169
      t173 = t172*t84
      t174 = t173*t74
      t175 = 1/t87
      t176 = t82*t175
      t177 = 0.2211997676173206D-2*t79
      t178 = dexp(-t177)
      t179 = t176*t178
      t180 = t174*t179
      t182 = 1/t93
      t188 = -0.5810796994275671D-1*t120-0.2219037096493859D-2*t133
     #-0.1743239098282701D0*t150+0.8716195491413506D-1*t164
     #-0.2056555111688325D-2*t167
      t189 = t182*t188
      t196 = 0.2920537730383703D1*t189-0.4320045371040062D-1*t120
     #-0.164974631643786D-2*t133-0.1296013611312019D0*t150
     #+0.6480068056560093D-1*t164-0.1528948851472549D-2*t167
      t197 = t196*t100
      t198 = t197*t107
      t199 = t99**2
      t200 = 1/t199
      t201 = t96*t200
      t208 = 0.4380806595575555D1*t189-0.6480068056560093D-1*t120
     #-0.2474619474656789D-2*t133-0.1944020416968028D0*t150
     #+0.972010208484014D-1*t164-0.2293423277208824D-2*t167
      t209 = t107*t208
      t210 = t201*t209
      t212 = t118*t90
      t216 = t118*t131
      t220 = t148*t90
      t224 = t161*t64
      t228 = t76*t88
      t229 = t64*t39
      t230 = t145*t90
      t231 = t229*t230
      t235 = t64*t90
      t239 = -0.1080011342760016D-1*t116*t103*t212
     #-0.4124365791094649D-3*t128*t103*t216-0.3240034028280047D-1*t137
     #*t103*t220+0.1620017014140023D-1*t102*t224*t90
     #-0.3822372128681373D-3*t228*t231+0.1620017014140023D-1*t102*t87
     #*t169*t235-t121-t134-t151+t165-t168
      t240 = t101*t239
      vrhoa(i) = vrhoa(i)+0.7772672717413724D-2*rho*(1.D0*t170
     #-0.6172774676263781D2*t180+t198-1.D0*t210+t240)
     #+0.1554534543482745D-1*t64+0.1554534543482745D-1*t108
      t248 = sigma*t44
      t250 = 0.4404139381467527D0*t33+0.8847990704692823D-2*t248
      t252 = t137*t117*t250
      t253 = 0.3240034028280047D-1*t252
      t254 = t75*t83
      t255 = t33*t90
      t256 = t254*t255
      t257 = 0.7760481998163131D-2*t256
      t259 = t102*t117*t248
      t260 = 0.286677909651103D-3*t259
      t261 = -t253+t257+t260
      t262 = t261*t64
      t264 = -t261
      t265 = t264*t84
      t266 = t265*t74
      t267 = t266*t179
      t272 = -0.1743239098282701D0*t252+0.4175380728300095D-1*t256
     #+0.1542416333766244D-2*t259
      t273 = t182*t272
      t278 = 0.2920537730383703D1*t273-0.1296013611312019D0*t252
     #+0.3104192799265252D-1*t256+0.1146711638604412D-2*t259
      t279 = t278*t100
      t280 = t279*t107
      t285 = 0.4380806595575555D1*t273-0.1944020416968028D0*t252
     #+0.4656289198897879D-1*t256+0.1720067457906618D-2*t259
      t286 = t107*t285
      t287 = t201*t286
      t289 = t250*t90
      t297 = t64*sigma
      t298 = t44*t90
      t299 = t297*t298
      t306 = -0.3240034028280047D-1*t137*t103*t289
     #+0.7760481998163131D-2*t254*t33*t64*t90+0.286677909651103D-3
     #*t228*t299+0.1620017014140023D-1*t102*t87*t261*t235-t253+t257+t260
      t307 = t101*t306
      vsigmaaa(i) = vsigmaaa(i)+0.1554534543482745D-1*rho*(1.D0*t262
     #-0.6172774676263781D2*t267+t280-1.D0*t287+t307)
      t314 = 1/t30/t41/t138
      t315 = t39*t314
      t317 = t102*t117*t315
      t318 = 0.4841671362996405D-2*t317
      t319 = t39**2
      t320 = t41**2
      t323 = 1/t31/t320/t41
      t326 = t102*t117*t319*t323
      t327 = 0.9018750150519921D-5*t326
      t342 = 0.4683917993710983D1*t156*t84-0.1170979498427746D1*sigma
     #/t31/t42*t158+0.2129053633504992D0*sigma/t31/t143/t66/t118
      t345 = t76*t83*t342*t90
      t346 = 0.1620017014140023D-1*t345
      t347 = t161*t90
      t349 = t102*t347*t146
      t350 = 0.7644744257362745D-3*t349
      t351 = t136*t87
      t352 = t76*t351
      t354 = t352*t220*t146
      t355 = 0.1528948851472549D-2*t354
      t357 = 1/t68/t7
      t359 = t357*t126*t83
      t360 = 1/t41
      t361 = t87*t360
      t362 = t361*t131
      t363 = t359*t362
      t364 = 0.1504040408167142D-4*t363
      t365 = t82**2
      t366 = 1/t365
      t367 = t76*t366
      t368 = t148**2
      t370 = t367*t117*t368
      t371 = 0.972010208484014D-1*t370
      t373 = t137*t347*t148
      t374 = 0.6480068056560093D-1*t373
      t377 = 0.4306269617434915D1*t156+0.1494327319014788D0*t315
      t379 = t137*t117*t377
      t380 = 0.3240034028280047D-1*t379
      t381 = 1/t138
      t384 = t128*t87*t381*t131
      t385 = 0.164974631643786D-2*t384
      t386 = t74**2
      t389 = t357/t386*t83
      t392 = dexp(t89-0.1367519714862592D0*t69)
      t394 = t389*t361*t392
      t395 = 0.1575019863706338D-4*t394
      t397 = 1/t30/t320
      t399 = t39*t131
      t401 = t128*t87*t397*t399
      t402 = 0.1946258676392454D-4*t401
      t403 = t127*t136
      t404 = t148*t131
      t406 = t403*t129*t404
      t407 = 0.164974631643786D-2*t406
      t410 = t128*t161*t118*t131
      t411 = 0.8248731582189298D-3*t410
      t412 = t115*t136
      t415 = t412*t117*t118*t148
      t416 = 0.4320045371040062D-1*t415
      t418 = t116*t347*t118
      t419 = 0.2160022685520031D-1*t418
      t421 = t116*t117*t381
      t422 = 0.4320045371040062D-1*t421
      t426 = 1/t113/t7*t75*t83
      t428 = t426*t117*t360
      t429 = 0.1440015123680021D-1*t428
      t433 = 1/t123/t7*t126*t83
      t434 = t433*t362
      t435 = 0.5499154388126198D-4*t434
      t438 = t116*t117*t397*t39
      t439 = 0.5096496171575164D-3*t438
      t440 = t318+t327+t346-t350+t355-t364+t371-t374-t380+t385+t395
     #+t402+t407-t411+t416-t419+t422-t429-t435+t439
      t443 = t169**2
      t446 = t169*t172
      t448 = t74*t82
      t450 = t448*t175*t178
      t458 = t172**2
      t474 = dexp(-t177-t70)
      t479 = t81*t175
      t484 = t87**2
      t486 = t82/t484
      t491 = t173*t448
      t517 = 0.2604969808138545D-1*t317+0.4852368136508483D-4*t326
     #+0.8716195491413506D-1*t345-0.411311022337665D-2*t349
     #+0.8226220446753301D-2*t354-0.809220527324479D-4*t363
     #+0.5229717294848104D0*t370-0.3486478196565402D0*t373
     #-0.1743239098282701D0*t379+0.8876148385975435D-2*t384
     #+0.8474096824354295D-4*t394+0.1047147712167798D-3*t401
     #+0.8876148385975435D-2*t406-0.4438074192987717D-2*t410
     #+0.2324318797710268D0*t415-0.1162159398855134D0*t418
     #+0.2324318797710268D0*t421-0.7747729325700894D-1*t428
     #-0.2958716128658478D-3*t434+0.27420734822511D-2*t438
      t518 = t182*t517
      t530 = 0.2920537730383703D1*t518+0.1936668545198562D-1*t317
     #+0.3607500060207969D-4*t326+0.6480068056560093D-1*t345
     #-0.3057897702945098D-2*t349+0.6115795405890196D-2*t354
     #-0.601616163266857D-4*t363+0.3888040833936056D0*t370
     #-0.2592027222624037D0*t373-0.1296013611312019D0*t379
     #+0.6598985265751438D-2*t384
      t542 = 1/t93/t92
      t543 = t188**2
      t544 = t542*t543
      t546 = 0.6300079454825353D-4*t394+0.7785034705569816D-4*t401
     #+0.6598985265751438D-2*t406-0.3299492632875719D-2*t410
     #+0.1728018148416025D0*t415-0.8640090742080124D-1*t418
     #+0.1728018148416025D0*t421-0.5760060494720083D-1*t428
     #-0.2199661755250479D-3*t434+0.2038598468630065D-2*t438
     #-0.1675351208713011D2*t544
      t550 = t196*t200
      t557 = t96/t199/t99
      t558 = t208**2
      t576 = 0.4380806595575555D1*t518+0.2905002817797843D-1*t317
     #+0.5411250090311953D-4*t326+0.972010208484014D-1*t345
     #-0.4586846554417647D-2*t349+0.9173693108835294D-2*t354
     #-0.9024242449002855D-4*t363+0.5832061250904084D0*t370
     #-0.3888040833936056D0*t373-0.1944020416968028D0*t379
     #+0.9898477898627157D-2*t384
      t588 = 0.9450119182238029D-4*t394+0.1167755205835472D-3*t401
     #+0.9898477898627157D-2*t406-0.4949238949313579D-2*t410
     #+0.2592027222624037D0*t415-0.1296013611312019D0*t418
     #+0.2592027222624037D0*t421-0.8640090742080124D-1*t428
     #-0.3299492632875719D-3*t434+0.3057897702945098D-2*t438
     #-0.2513026813069517D2*t544
      t596 = 1/t81
      t608 = t103*t360*t131
      t611 = t115*t351
      t612 = t64*t118
      t619 = -0.1D1*t161*t172*t175+0.2D1*t596*t172*t148-t364
     #-0.8248731582189298D-3*t128*t224*t216-0.1440015123680021D-1*t426
     #*t103*t360*t90+t355-0.5499154388126198D-4*t433*t608-t350
     #+0.4320045371040062D-1*t611*t612*t220+t346-0.2160022685520031D-1
     #*t116*t224*t212+t327+t318
      t633 = t402+t395+t385-t380+0.1620017014140023D-1*t102*t342*t64
     #*t90-t374+0.972010208484014D-1*t367*t103*t368*t90+t371+t422-t419
     #-0.1504040408167142D-4*t359*t608+t416-t411-0.6480068056560093D-1
     #*t137*t224*t220
      t636 = t69**2
      t638 = 1/t636/t68/t67
      t640 = t638/t73
      t670 = t127*t351
      t674 = t407+0.2545878071091769D-1*t640*t172*t118*t71
     #+0.4320045371040062D-1*t116*t103*t381*t90+0.1620017014140023D-1
     #*t102*t87*t443*t235-t435+t439-t429+0.1575019863706338D-4*t389
     #*t103*t360*t392-0.3240034028280047D-1*t137*t103*t377*t90-0.1D1
     #*t458+0.1620017014140023D-1*t102*t87*t440*t235
     #+0.164974631643786D-2*t128*t103*t381*t131+0.164974631643786D-2
     #*t670*t612*t404
      t679 = t115*t88
      t686 = t127*t88
      t693 = t64*t397
      t694 = t39*t90
      t713 = t76*t162
      t716 = t64*t148
      t717 = t146*t90
      t724 = 0.3240034028280047D-1*t102*t161*t169*t235
     #-0.2160022685520031D-1*t679*t170*t212-0.6480068056560093D-1*t352
     #*t170*t220-0.8248731582189298D-3*t686*t170*t216
     #+0.2359464187918086D-1*t172*t39*t145+0.5096496171575164D-3*t679
     #*t693*t694+0.6666666666666667D0*t7*t172-0.2D1*t446
     #+0.1946258676392454D-4*t686*t693*t399+0.9018750150519921D-5*t228
     #*t64*t319*t323*t90+0.4841671362996405D-2*t228*t229*t314*t90
     #-0.7644744257362745D-3*t713*t231+0.1528948851472549D-2*t352*t716
     #*t717-0.7644744257362745D-3*t228*t170*t717
      t728 = 1.D0*t440*t64+1.D0*t443*t64-0.1234554935252756D3*t446*t84
     #*t450+0.6172774676263781D2*t440*t84*t74*t179
     #-0.6172774676263781D2*t458*t84*t74*t179-0.4115183117509188D2
     #*t172*t158*t74*t176*t118*t178-0.1571513168609055D1*t172/t67/t7
     #*t73*t176*t118*t474-0.1234554935252756D3*t174*t479*t148*t178
     #+0.6172774676263781D2*t174*t486*t161*t178-0.1456444078873205D1
     #*t491*t175*t39*t145*t178+(t530+t546)*t100*t107-2.D0*t550*t209
     #+2.D0*t197*t239+2.D0*t557*t107*t558-2.D0*t201*t239*t208-1.D0
     #*t201*t107*(t576+t588)+t101*(t619+t633+t674+t724)
      v2rhoa2(i) = v2rhoa2(i)+0.7772672717413724D-2*rho*t728
     #+0.310906908696549D-1*t170-0.1919158292677513D1*t180
     #+0.310906908696549D-1*t198-0.310906908696549D-1*t210
     #+0.310906908696549D-1*t240
      t739 = t412*t117*t118*t250
      t740 = 0.2160022685520031D-1*t739
      t741 = t140*t75
      t743 = t741*t83*t90
      t744 = 0.5173654665442087D-2*t743
      t747 = t116*t117*t314*sigma
      t748 = 0.1911186064340686D-3*t747
      t749 = t250*t131
      t751 = t403*t129*t749
      t752 = 0.8248731582189298D-3*t751
      t753 = t638*t126
      t756 = t753*t83*t155*t131
      t757 = 0.1975724094022595D-3*t756
      t759 = sigma*t131
      t761 = t128*t87*t314*t759
      t762 = 0.7298470036471703D-5*t761
      t765 = t367*t117*t148*t250
      t766 = 0.972010208484014D-1*t765
      t767 = t75*t136
      t769 = t767*t255*t148
      t770 = 0.1552096399632626D-1*t769
      t772 = t352*t220*t248
      t773 = 0.5733558193022059D-3*t772
      t775 = sigma*t145
      t777 = -0.2348874336782681D1*t140-0.9437856751672345D-1*t775
      t779 = t137*t117*t777
      t780 = 0.3240034028280047D-1*t779
      t782 = t137*t347*t250
      t783 = 0.3240034028280047D-1*t782
      t788 = -0.2554864360205991D1*t140*t84+0.3193580450257488D0*t155
     #*t158
      t791 = t76*t83*t788*t90
      t792 = 0.1620017014140023D-1*t791
      t794 = t102*t347*t248
      t795 = 0.286677909651103D-3*t794
      t796 = t145*t250
      t798 = t352*t694*t796
      t799 = 0.7644744257362745D-3*t798
      t801 = 1/t320/rho
      t804 = t254*t801*t90*t39
      t805 = 0.183105793556489D-3*t804
      t806 = t39*sigma
      t809 = 1/t31/t320/t138
      t812 = t102*t117*t806*t809
      t813 = 0.6764062612889941D-5*t812
      t815 = t102*t117*t775
      t816 = 0.3057897702945098D-2*t815
      t817 = t740-t744-t748+t752-t757-t762+t766-t770-t773-t780-t783
     #+t792+t795+t799-t805-t813-t816
      t820 = t169*t261
      t823 = t169*t264
      t827 = t261*t172
      t836 = t172*t264
      t841 = t479*t250*t178
      t847 = t486*t33*t178
      t852 = t175*sigma*t44*t178
      t856 = t542*t188*t272
      t875 = 0.1162159398855134D0*t739-0.2783587152200063D-1*t743
     #-0.1028277555844163D-2*t747+0.4438074192987717D-2*t751
     #-0.1063001023463839D-2*t756-0.3926803920629242D-4*t761
     #+0.5229717294848104D0*t765-0.835076145660019D-1*t769
     #-0.3084832667532488D-2*t772-0.1743239098282701D0*t779
     #-0.1743239098282701D0*t782+0.8716195491413506D-1*t791
     #+0.1542416333766244D-2*t794+0.411311022337665D-2*t798
     #-0.9851661299347411D-3*t804-0.3639276102381362D-4*t812
     #-0.164524408935066D-1*t815
      t876 = t182*t875
      t895 = -0.1675351208713011D2*t856+0.2920537730383703D1*t876
     #+0.8640090742080124D-1*t739-0.2069461866176835D-1*t743
     #-0.7644744257362745D-3*t747+0.3299492632875719D-2*t751
     #-0.7902896376090378D-3*t756-0.2919388014588681D-4*t761
     #+0.3888040833936056D0*t765-0.6208385598530505D-1*t769
     #-0.2293423277208824D-2*t772-0.1296013611312019D0*t779
     #-0.1296013611312019D0*t782+0.6480068056560093D-1*t791
     #+0.1146711638604412D-2*t794+0.3057897702945098D-2*t798
     #-0.7324231742259559D-3*t804-0.2705625045155976D-4*t812
     #-0.1223159081178039D-1*t815
      t901 = t278*t200
      t929 = -0.2513026813069517D2*t856+0.4380806595575555D1*t876
     #+0.1296013611312019D0*t739-0.3104192799265252D-1*t743
     #-0.1146711638604412D-2*t747+0.4949238949313579D-2*t751
     #-0.1185434456413557D-2*t756-0.4379082021883022D-4*t761
     #+0.5832061250904084D0*t765-0.9312578397795757D-1*t769
     #-0.3440134915813235D-2*t772-0.1944020416968028D0*t779
     #-0.1944020416968028D0*t782+0.972010208484014D-1*t791
     #+0.1720067457906618D-2*t794+0.4586846554417647D-2*t798
     #-0.1098634761338934D-2*t804-0.4058437567733965D-4*t812
     #-0.1834738621767059D-1*t815
      t942 = t64*t314
      t970 = t248*t90
      t974 = 0.1620017014140023D-1*t228*t820*t235-t744-0.1D1*t836
     #-0.1D1*t827-0.7298470036471703D-5*t686*t942*t759
     #-0.1911186064340686D-3*t679*t942*sigma*t90-0.6764062612889941D-5
     #*t228*t64*t806*t809*t90-0.183105793556489D-3*t254*t801*t229*t90
     #-0.3057897702945098D-2*t228*t297*t230-0.3822372128681373D-3*t228
     #*t262*t717+0.2359464187918086D-1*t264*t39*t145
     #+0.286677909651103D-3*t713*t299+0.286677909651103D-3*t228*t170
     #*t970
      t997 = t254*t33
      t1019 = 0.7644744257362745D-3*t352*t229*t796*t90
     #-0.5733558193022059D-3*t352*t716*t970-0.1080011342760016D-1*t679
     #*t262*t212-0.3240034028280047D-1*t137*t103*t777*t90
     #-0.4124365791094649D-3*t686*t262*t216+0.972010208484014D-1*t76
     #*t366*t87*t716*t289+0.7760481998163131D-2*t997*t170*t90
     #+0.8248731582189298D-3*t670*t612*t749-0.3240034028280047D-1*t137
     #*t224*t289-0.3240034028280047D-1*t352*t262*t220
     #-0.1975724094022595D-3*t753*t83*t155*t64*t131+t740
     #+0.1620017014140023D-1*t102*t161*t261*t235
      t1036 = -t748+t752-t757-0.5173654665442087D-2*t741*t83*t64*t90
     #-t762+0.1620017014140023D-1*t102*t788*t64*t90+t766-t770
     #+0.2160022685520031D-1*t611*t612*t289-t773+0.2545878071091769D-1
     #*t640*t264*t118*t71-t780-t783
      t1044 = t767*t33
      t1048 = t596*t264
      t1057 = t792+t795+t799-t805-t813-t816+0.6666666666666667D0*t7
     #*t264-0.1D1*t823+0.1620017014140023D-1*t102*t87*t817*t235
     #-0.1552096399632626D-1*t1044*t716*t90+0.2D1*t1048*t148-0.1D1
     #*t161*t264*t175-0.3240034028280047D-1*t352*t170*t289
      t1061 = 1.D0*t817*t64+1.D0*t820*t64-0.6172774676263781D2*t823
     #*t84*t450-0.6172774676263781D2*t827*t84*t450
     #+0.6172774676263781D2*t817*t84*t74*t179-0.6172774676263781D2
     #*t836*t84*t450-0.1234554935252756D3*t174*t841
     #+0.2956987879494076D2*t172*t114*t74*t847+0.1092333059154904D1
     #*t491*t852+t895*t100*t107-1.D0*t550*t286+t197*t306-1.D0*t901
     #*t209+2.D0*t557*t209*t285-1.D0*t201*t306*t208-1.D0*t201*t107
     #*t929+t279*t239-1.D0*t201*t239*t285+t101*(t974+t1019+t1036+t1057)
      v2rhoasigmaaa(i) = v2rhoasigmaaa(i)+0.7772672717413724D-2*rho
     #*t1061+0.1554534543482745D-1*t262-0.9595791463387565D0*t267
     #+0.1554534543482745D-1*t280-0.1554534543482745D-1*t287
     #+0.1554534543482745D-1*t307
      t1070 = t250**2
      t1072 = t367*t117*t1070
      t1073 = 0.972010208484014D-1*t1072
      t1075 = t767*t255*t250
      t1076 = 0.3104192799265252D-1*t1075
      t1078 = t352*t289*t248
      t1079 = 0.1146711638604412D-2*t1078
      t1080 = t117*t44
      t1081 = t137*t1080
      t1082 = 0.1146711638604412D-2*t1081
      t1083 = 1/t320
      t1086 = t254*t1083*t90*sigma
      t1087 = 0.2746586903347335D-3*t1086
      t1090 = 1/t31/t320/t29
      t1093 = t102*t117*t39*t1090
      t1094 = 0.5073046959667456D-5*t1093
      t1095 = t102*t1080
      t1096 = 0.1146711638604412D-2*t1095
      t1097 = t1073-t1076-t1079-t1082+t1087+t1094+t1096
      t1100 = t261**2
      t1103 = t261*t264
      t1112 = t264**2
      t1126 = t272**2
      t1127 = t542*t1126
      t1137 = t182*(0.5229717294848104D0*t1072-0.1670152291320038D0
     #*t1075-0.6169665335064975D-2*t1078-0.6169665335064975D-2*t1081
     #+0.1477749194902112D-2*t1086+0.2729457076786022D-4*t1093
     #+0.6169665335064975D-2*t1095)
      t1153 = t285**2
      t1181 = t103*t298
      t1204 = t64*t250
      t1211 = 0.972010208484014D-1*t367*t103*t1070*t90
     #+0.1620017014140023D-1*t102*t87*t1097*t235+0.1146711638604412D-2
     #*t102*t1181+0.5073046959667456D-5*t228*t229*t1090*t90
     #-0.1769598140938565D-1*t264*sigma*t44+0.2746586903347335D-3*t254
     #*t1083*t297*t90+0.1552096399632626D-1*t997*t262*t90
     #-0.4790370675386232D0*t33*t264*t84*t175-0.2D1*t1103-0.1D1*t1112
     #-0.3104192799265252D-1*t1044*t1204*t90-0.1146711638604412D-2
     #*t352*t1204*t970
      t1226 = -0.6480068056560093D-1*t352*t262*t289+0.2D1*t1048*t250
     #-0.1146711638604412D-2*t137*t1181+0.5733558193022059D-3*t228
     #*t262*t970+0.1620017014140023D-1*t102*t87*t1100*t235+t1073-t1076
     #-t1079-t1082+t1087+t1094+t1096
      s1 = 1.D0*t1097*t64+1.D0*t1100*t64-0.1234554935252756D3*t1103
     #*t84*t450+0.6172774676263781D2*t1097*t84*t74*t179
     #-0.6172774676263781D2*t1112*t84*t74*t179-0.1234554935252756D3
     #*t266*t841+0.2956987879494076D2*t264*t114*t74*t847
      t1229 = s1+0.1092333059154904D1*t265*t448*t852+(
     #-0.1675351208713011D2*t1127+0.2920537730383703D1*t1137
     #+0.3888040833936056D0*t1072-0.1241677119706101D0*t1075
     #-0.4586846554417647D-2*t1078-0.4586846554417647D-2*t1081
     #+0.1098634761338934D-2*t1086+0.2029218783866982D-4*t1093
     #+0.4586846554417647D-2*t1095)*t100*t107-2.D0*t901*t286+2.D0*t279
     #*t306+2.D0*t557*t107*t1153-2.D0*t201*t306*t285-1.D0*t201*t107*(
     #-0.2513026813069517D2*t1127+0.4380806595575555D1*t1137
     #+0.5832061250904084D0*t1072-0.1862515679559151D0*t1075
     #-0.6880269831626471D-2*t1078-0.6880269831626471D-2*t1081
     #+0.1647952142008401D-2*t1086+0.3043828175800473D-4*t1093
     #+0.6880269831626471D-2*t1095)+t101*(t1211+t1226)
      v2sigmaaa2(i) = v2sigmaaa2(i)+0.1554534543482745D-1*rho*t1229
      endif
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end

c:C_FT97subrend
_ENDIF
_IF(ccpdft,all,xc_mpw1k)
c:XC_MPW1Ksubrstart

c    Generated: Mon Nov 19 16:33:16 GMT 2007

      subroutine uks_xc_mpw1k
     & (ideriv,npt,rhoa1,rhob1,sigmaaa1,sigmabb1,sigmaab1,
     &  zk,vrhoa,vrhob,vsigmaaa,vsigmabb,vsigmaab,
     &  v2rhoa2,v2rhob2,v2rhoab,
     &  v2rhoasigmaaa,v2rhoasigmaab,v2rhoasigmabb,
     &  v2rhobsigmabb,v2rhobsigmaab,v2rhobsigmaaa,
     &  v2sigmaaa2,v2sigmaaaab,v2sigmaaabb,
     &  v2sigmaab2,v2sigmaabbb,v2sigmabb2)
c
c     B.J. Lynch, P.L. Fast, M. Harris, D.G. Truhlar
c     Adiabatic connection for kinetics
c     J.Phys.Chem.A 104 (2000) 4811-4815
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt),rhob1(npt)
      REAL sigmaaa1(npt),sigmabb1(npt),sigmaab1(npt)
      REAL zk(npt),vrhoa(npt),vrhob(npt)
      REAL vsigmaaa(npt),vsigmabb(npt),vsigmaab(npt)
      REAL v2rhoa2(npt),v2rhob2(npt),v2rhoab(npt)
      REAL v2rhoasigmaaa(npt),v2rhoasigmaab(npt)
      REAL v2rhoasigmabb(npt),v2rhobsigmabb(npt)
      REAL v2rhobsigmaab(npt),v2rhobsigmaaa(npt)
      REAL v2sigmaaa2(npt),v2sigmaaaab(npt),v2sigmaaabb(npt)
      REAL v2sigmaab2(npt),v2sigmaabbb(npt),v2sigmabb2(npt)
      parameter(tol=1.0d-20)
      
      if (ideriv.eq.0) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t3 = t2*rhob
      t4 = rhob**2
      t5 = t2**2
      t8 = sigmabb/t5/t4
      t11 = dexp(-0.16455D1*t8)
      t14 = dsqrt(sigmabb)
      t16 = t14/t3
      t17 = t16**0.372D1
      t20 = dlog(t16+dsqrt(1+t16**2))
      t31 = 1/rhob
      t32 = t31**(1.D0/3.D0)
      t35 = t31**(1.D0/6.D0)
      t38 = dsqrt(t31)
      t40 = t32**2
      t46 = dlog(1.D0+0.3216395899738507D2/(0.1112037486309468D2*t35
     #+0.3844746237447211D1*t32+0.1644733775567609D1*t38
     #+0.2405871291288192D0*t40))
      t47 = (1.D0+0.1274696188700087D0*t32)*t46
      t50 = 1/t2/t4
      t54 = dexp(0.2513845706671277D1*t47)
      t55 = t54-1.D0
      t56 = 1/t55
      t57 = sigmabb**2
      t59 = t4**2
      t61 = 1/t5/t59
      t68 = t55**2
      t78 = dlog(1.D0+0.2697586091519874D1*(0.1007494971260294D0
     #*sigmabb*t50+0.2738174287780083D-1*t56*t57*t61)/(1.D0
     #+0.2717804421747983D0*t56*sigmabb*t50+0.7386460874872889D-1/t68
     #*t57*t61))
      t93 = dexp(-0.1645530784602056D1*t8)
      zk(i) = 0.572D0*t3*(-0.9305257363491D0-1.D0*(0.426D-2*t8
     #-0.2369618833300074D-2*t8*t11-0.1D-5*t17)/(1.D0+0.2556D-1*t16
     #*t20+0.1074661302677646D-5*t17))+rhob*(-0.310907D-1*t47
     #+0.1236778371778789D-1*t78+0.7937005259840997D0*(0.1D-2*
     #(0.2568D1+0.1443307452126544D2*t32+0.2843543831490386D-2*t40)/
     #(1.D0+0.5411317332115466D1*t32+0.1816419932959077D0*t40
     #+0.1763993811759022D-1*t31)-0.1853571428571429D-2)*sigmabb*t50
     #*t93)
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t3 = t2*rhoa
      t4 = rhoa**2
      t5 = t2**2
      t8 = sigmaaa/t5/t4
      t11 = dexp(-0.16455D1*t8)
      t14 = dsqrt(sigmaaa)
      t16 = t14/t3
      t17 = t16**0.372D1
      t20 = dlog(t16+dsqrt(1+t16**2))
      t31 = 1/rhoa
      t32 = t31**(1.D0/3.D0)
      t35 = t31**(1.D0/6.D0)
      t38 = dsqrt(t31)
      t40 = t32**2
      t46 = dlog(1.D0+0.3216395899738507D2/(0.1112037486309468D2*t35
     #+0.3844746237447211D1*t32+0.1644733775567609D1*t38
     #+0.2405871291288192D0*t40))
      t47 = (1.D0+0.1274696188700087D0*t32)*t46
      t50 = 1/t2/t4
      t54 = dexp(0.2513845706671277D1*t47)
      t55 = t54-1.D0
      t56 = 1/t55
      t57 = sigmaaa**2
      t59 = t4**2
      t61 = 1/t5/t59
      t68 = t55**2
      t78 = dlog(1.D0+0.2697586091519874D1*(0.1007494971260294D0
     #*sigmaaa*t50+0.2738174287780083D-1*t56*t57*t61)/(1.D0
     #+0.2717804421747983D0*t56*sigmaaa*t50+0.7386460874872889D-1/t68
     #*t57*t61))
      t93 = dexp(-0.1645530784602056D1*t8)
      zk(i) = 0.572D0*t3*(-0.9305257363491D0-1.D0*(0.426D-2*t8
     #-0.2369618833300074D-2*t8*t11-0.1D-5*t17)/(1.D0+0.2556D-1*t16
     #*t20+0.1074661302677646D-5*t17))+rhoa*(-0.310907D-1*t47
     #+0.1236778371778789D-1*t78+0.7937005259840997D0*(0.1D-2*
     #(0.2568D1+0.1443307452126544D2*t32+0.2843543831490386D-2*t40)/
     #(1.D0+0.5411317332115466D1*t32+0.1816419932959077D0*t40
     #+0.1763993811759022D-1*t31)-0.1853571428571429D-2)*sigmaaa*t50
     #*t93)
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t5 = t4*rhoa
      t6 = rhoa**2
      t7 = t4**2
      t10 = sigmaaa/t7/t6
      t13 = dexp(-0.16455D1*t10)
      t16 = dsqrt(sigmaaa)
      t18 = t16/t5
      t19 = t18**0.372D1
      t22 = dlog(t18+dsqrt(1+t18**2))
      t33 = rhob**(1.D0/3.D0)
      t34 = t33*rhob
      t35 = rhob**2
      t36 = t33**2
      t39 = sigmabb/t36/t35
      t42 = dexp(-0.16455D1*t39)
      t45 = dsqrt(sigmabb)
      t47 = t45/t34
      t48 = t47**0.372D1
      t51 = dlog(t47+dsqrt(1+t47**2))
      t62 = 1/rho
      t63 = t62**(1.D0/3.D0)
      t66 = t62**(1.D0/6.D0)
      t69 = dsqrt(t62)
      t71 = t63**2
      t77 = dlog(1.D0+0.1608197949869254D2/(0.598255043577108D1*t66
     #+0.2225569421150687D1*t63+0.8004286349993634D0*t69
     #+0.1897004325747559D0*t71))
      t79 = 0.621814D-1*(1.D0+0.1325688999052018D0*t63)*t77
      t90 = dlog(1.D0+0.2960874997779344D2/(0.8157414703487641D1*t66
     #+0.2247591863577616D1*t63+0.4300972471276643D0*t69
     #+0.1911512595127338D0*t71))
      t93 = rhoa-1.D0*rhob
      t94 = t93*t62
      t95 = 1.D0+t94
      t96 = t95**(1.D0/3.D0)
      t99 = 1.D0-1.D0*t94
      t100 = t99**(1.D0/3.D0)
      t102 = t96*t95+t100*t99-2.D0
      t103 = t93**2
      t104 = t103**2
      t105 = rho**2
      t106 = t105**2
      t108 = t104/t106
      t113 = 0.3799552353702395D-1*(1.D0+0.6901399211255825D-1*t63)
     #*t90*t102*(1.D0-1.D0*t108)
      t124 = dlog(1.D0+0.3216395899738507D2/(0.1112037486309468D2*t66
     #+0.3844746237447211D1*t63+0.1644733775567609D1*t69
     #+0.2405871291288192D0*t71))
      t130 = 0.1923661050931536D1*(-0.310907D-1*(1.D0
     #+0.1274696188700087D0*t63)*t124+t79)*t102*t108
      t131 = t96**2
      t133 = t100**2
      t135 = 0.5D0*t131+0.5D0*t133
      t136 = t135**2
      t137 = t136*t135
      t138 = 1/t136
      t140 = rho**(1.D0/3.D0)
      t142 = 1/t140/t105
      t149 = dexp(-0.4042761511756372D2*(-t79+t113+t130)/t137)
      t150 = t149-1.D0
      t151 = 1/t150
      t152 = sigma**2
      t154 = t136**2
      t156 = t140**2
      t159 = 1/t154/t156/t106
      t167 = t150**2
      t177 = dlog(1.D0+0.2697586091519874D1*(0.634682060977037D-1
     #*sigma*t138*t142+0.1086645186223595D-1*t151*t152*t159)/(1.D0
     #+0.1712109500228824D0*t151*sigma*t138*t142+0.2931318940773793D-1
     #/t167*t152*t159))
      t198 = dexp(-0.261211729852336D1*t136/t156/t105*sigma)
      zk(i) = 0.572D0*t5*(-0.9305257363491D0-1.D0*(0.426D-2*t10
     #-0.2369618833300074D-2*t10*t13-0.1D-5*t19)/(1.D0+0.2556D-1*t18
     #*t22+0.1074661302677646D-5*t19))+0.572D0*t34*(-0.9305257363491D0
     #-1.D0*(0.426D-2*t39-0.2369618833300074D-2*t39*t42-0.1D-5*t48)/
     #(1.D0+0.2556D-1*t47*t51+0.1074661302677646D-5*t48))+rho*(-t79
     #+t113+t130+0.2473556743557577D-1*t137*t177+0.1D1*(0.1D-2*
     #(0.2568D1+0.1443307452126544D2*t63+0.2843543831490386D-2*t71)/
     #(1.D0+0.5411317332115466D1*t63+0.1816419932959077D0*t71
     #+0.1763993811759022D-1*t62)-0.1853571428571429D-2)*t135*sigma
     #*t142*t198)
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t3 = t2*rhob
      t4 = rhob**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigmabb*t7
      t11 = dexp(-0.16455D1*t8)
      t14 = dsqrt(sigmabb)
      t15 = 1/t3
      t16 = t14*t15
      t17 = t16**0.372D1
      t19 = 0.426D-2*t8-0.2369618833300074D-2*t8*t11-0.1D-5*t17
      t20 = dlog(t16+dsqrt(1+t16**2))
      t24 = 1.D0+0.2556D-1*t16*t20+0.1074661302677646D-5*t17
      t25 = 1/t24
      t28 = -0.9305257363491D0-1.D0*t19*t25
      t31 = 1/rhob
      t32 = t31**(1.D0/3.D0)
      t34 = 1.D0+0.1274696188700087D0*t32
      t35 = t31**(1.D0/6.D0)
      t38 = dsqrt(t31)
      t40 = t32**2
      t42 = 0.1112037486309468D2*t35+0.3844746237447211D1*t32
     #+0.1644733775567609D1*t38+0.2405871291288192D0*t40
      t45 = 1.D0+0.3216395899738507D2/t42
      t46 = dlog(t45)
      t47 = t34*t46
      t48 = 0.310907D-1*t47
      t50 = 1/t2/t4
      t54 = dexp(0.2513845706671277D1*t47)
      t55 = t54-1.D0
      t56 = 1/t55
      t57 = sigmabb**2
      t58 = t56*t57
      t59 = t4**2
      t61 = 1/t5/t59
      t64 = 0.1007494971260294D0*sigmabb*t50+0.2738174287780083D-1*t58
     #*t61
      t65 = t56*sigmabb
      t68 = t55**2
      t69 = 1/t68
      t70 = t69*t57
      t73 = 1.D0+0.2717804421747983D0*t65*t50+0.7386460874872889D-1
     #*t70*t61
      t74 = 1/t73
      t77 = 1.D0+0.2697586091519874D1*t64*t74
      t78 = dlog(t77)
      t79 = 0.1236778371778789D-1*t78
      t82 = 0.2568D1+0.1443307452126544D2*t32+0.2843543831490386D-2*t40
      t86 = 1.D0+0.5411317332115466D1*t32+0.1816419932959077D0*t40
     #+0.1763993811759022D-1*t31
      t87 = 1/t86
      t90 = 0.1D-2*t82*t87-0.1853571428571429D-2
      t91 = t90*sigmabb
      t93 = dexp(-0.1645530784602056D1*t8)
      t94 = t50*t93
      t96 = 0.7937005259840997D0*t91*t94
      zk(i) = 0.572D0*t3*t28+rhob*(-t48+t79+t96)
      vrhoa(i) = 0.D0
      t101 = t4*rhob
      t104 = sigmabb/t5/t101
      t108 = t59*t4
      t114 = t16**0.272D1
      t116 = t114*t14*t50
      t121 = t24**2
      t123 = t19/t121
      t128 = dsqrt(1.D0+t8)
      t129 = 1/t128
      t139 = 1/t4
      t140 = 1/t40*t139
      t142 = 0.1321039893133927D-2*t140*t46
      t143 = t42**2
      t146 = t35**2
      t147 = t146**2
      t157 = 1/t32*t139
      t163 = 0.1D1*t34/t143*(-0.1853395810515781D1/t147/t35*t139
     #-0.128158207914907D1*t140-0.8223668877838045D0/t38*t139
     #-0.1603914194192128D0*t157)/t45
      t165 = 1/t2/t101
      t168 = t142+t163
      t170 = t61*t168*t54
      t173 = t59*rhob
      t175 = 1/t5/t173
      t181 = t73**2
      t183 = t64/t181
      t184 = t69*sigmabb
      t202 = 1/t77
      t210 = t86**2
      s1 = 0.7626666666666667D0*t2*t28+0.572D0*t3*(-1.D0*(-0.1136D-1
     #*t104+0.6318983555466863D-2*t104*t11-0.1039788744052072D-1*t57
     #/t2/t108*t11+0.496D-5*t116)*t25+t123*(-0.3408D-1*t14*t50*t20
     #-0.3408D-1*t104*t129-0.5330320061281126D-5*t116))-t48
      vrhob(i) = s1+t79+t96+rhob*(t142+t163+0.1236778371778789D-1*
     #(0.2697586091519874D1*(-0.2350821599607352D0*sigmabb*t165
     #+0.2213957124623647D1*t70*t170-0.1277814667630705D0*t58*t175)
     #*t74-0.2697586091519874D1*t183*(0.2197487022544806D2*t184*t50
     #*t168*t54-0.6341543650745294D0*t65*t165+0.1194467989321217D2/t68
     #/t55*t57*t170-0.3447015074940681D0*t70*t175))*t202
     #+0.7937005259840997D0*(0.1D-2*(-0.4811024840421814D1*t140
     #-0.1895695887660258D-2*t157)*t87-0.1D-2*t82/t210*(
     #-0.1803772444038489D1*t140-0.1210946621972718D0*t157
     #-0.1763993811759022D-1*t139))*sigmabb*t94-0.1851967893962899D1
     #*t91*t165*t93+0.3482823064697813D1*t90*t57/t108*t93)
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      t241 = 1/t14
      t243 = t114*t241*t15
      vsigmabb(i) = 0.572D0*t3*(-1.D0*(0.426D-2*t7
     #-0.2369618833300074D-2*t7*t11+0.3899207790195271D-2*sigmabb/t2
     #/t173*t11-0.186D-5*t243)*t25+t123*(0.1278D-1*t241*t15*t20
     #+0.1278D-1*t7*t129+0.1998870022980422D-5*t243))+rhob*
     #(0.1236778371778789D-1*(0.2697586091519874D1*
     #(0.1007494971260294D0*t50+0.5476348575560166D-1*t65*t61)*t74
     #-0.2697586091519874D1*t183*(0.2717804421747983D0*t56*t50
     #+0.1477292174974578D0*t184*t61))*t202+0.7937005259840997D0*t90
     #*t50*t93-0.130605864926168D1*t91/t173*t93)
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t3 = t2*rhoa
      t4 = rhoa**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigmaaa*t7
      t11 = dexp(-0.16455D1*t8)
      t14 = dsqrt(sigmaaa)
      t15 = 1/t3
      t16 = t14*t15
      t17 = t16**0.372D1
      t19 = 0.426D-2*t8-0.2369618833300074D-2*t8*t11-0.1D-5*t17
      t20 = dlog(t16+dsqrt(1+t16**2))
      t24 = 1.D0+0.2556D-1*t16*t20+0.1074661302677646D-5*t17
      t25 = 1/t24
      t28 = -0.9305257363491D0-1.D0*t19*t25
      t31 = 1/rhoa
      t32 = t31**(1.D0/3.D0)
      t34 = 1.D0+0.1274696188700087D0*t32
      t35 = t31**(1.D0/6.D0)
      t38 = dsqrt(t31)
      t40 = t32**2
      t42 = 0.1112037486309468D2*t35+0.3844746237447211D1*t32
     #+0.1644733775567609D1*t38+0.2405871291288192D0*t40
      t45 = 1.D0+0.3216395899738507D2/t42
      t46 = dlog(t45)
      t47 = t34*t46
      t48 = 0.310907D-1*t47
      t50 = 1/t2/t4
      t54 = dexp(0.2513845706671277D1*t47)
      t55 = t54-1.D0
      t56 = 1/t55
      t57 = sigmaaa**2
      t58 = t56*t57
      t59 = t4**2
      t61 = 1/t5/t59
      t64 = 0.1007494971260294D0*sigmaaa*t50+0.2738174287780083D-1*t58
     #*t61
      t65 = t56*sigmaaa
      t68 = t55**2
      t69 = 1/t68
      t70 = t69*t57
      t73 = 1.D0+0.2717804421747983D0*t65*t50+0.7386460874872889D-1
     #*t70*t61
      t74 = 1/t73
      t77 = 1.D0+0.2697586091519874D1*t64*t74
      t78 = dlog(t77)
      t79 = 0.1236778371778789D-1*t78
      t82 = 0.2568D1+0.1443307452126544D2*t32+0.2843543831490386D-2*t40
      t86 = 1.D0+0.5411317332115466D1*t32+0.1816419932959077D0*t40
     #+0.1763993811759022D-1*t31
      t87 = 1/t86
      t90 = 0.1D-2*t82*t87-0.1853571428571429D-2
      t91 = t90*sigmaaa
      t93 = dexp(-0.1645530784602056D1*t8)
      t94 = t50*t93
      t96 = 0.7937005259840997D0*t91*t94
      zk(i) = 0.572D0*t3*t28+rhoa*(-t48+t79+t96)
      t101 = t4*rhoa
      t104 = sigmaaa/t5/t101
      t108 = t59*t4
      t114 = t16**0.272D1
      t116 = t114*t14*t50
      t121 = t24**2
      t123 = t19/t121
      t128 = dsqrt(1.D0+t8)
      t129 = 1/t128
      t139 = 1/t4
      t140 = 1/t40*t139
      t142 = 0.1321039893133927D-2*t140*t46
      t143 = t42**2
      t146 = t35**2
      t147 = t146**2
      t157 = 1/t32*t139
      t163 = 0.1D1*t34/t143*(-0.1853395810515781D1/t147/t35*t139
     #-0.128158207914907D1*t140-0.8223668877838045D0/t38*t139
     #-0.1603914194192128D0*t157)/t45
      t165 = 1/t2/t101
      t168 = t142+t163
      t170 = t61*t168*t54
      t173 = t59*rhoa
      t175 = 1/t5/t173
      t181 = t73**2
      t183 = t64/t181
      t184 = t69*sigmaaa
      t202 = 1/t77
      t210 = t86**2
      s1 = 0.7626666666666667D0*t2*t28+0.572D0*t3*(-1.D0*(-0.1136D-1
     #*t104+0.6318983555466863D-2*t104*t11-0.1039788744052072D-1*t57
     #/t2/t108*t11+0.496D-5*t116)*t25+t123*(-0.3408D-1*t14*t50*t20
     #-0.3408D-1*t104*t129-0.5330320061281126D-5*t116))-t48
      vrhoa(i) = s1+t79+t96+rhoa*(t142+t163+0.1236778371778789D-1*
     #(0.2697586091519874D1*(-0.2350821599607352D0*sigmaaa*t165
     #+0.2213957124623647D1*t70*t170-0.1277814667630705D0*t58*t175)
     #*t74-0.2697586091519874D1*t183*(0.2197487022544806D2*t184*t50
     #*t168*t54-0.6341543650745294D0*t65*t165+0.1194467989321217D2/t68
     #/t55*t57*t170-0.3447015074940681D0*t70*t175))*t202
     #+0.7937005259840997D0*(0.1D-2*(-0.4811024840421814D1*t140
     #-0.1895695887660258D-2*t157)*t87-0.1D-2*t82/t210*(
     #-0.1803772444038489D1*t140-0.1210946621972718D0*t157
     #-0.1763993811759022D-1*t139))*sigmaaa*t94-0.1851967893962899D1
     #*t91*t165*t93+0.3482823064697813D1*t90*t57/t108*t93)
      vrhob(i) = 0.D0
      t241 = 1/t14
      t243 = t114*t241*t15
      vsigmaaa(i) = 0.572D0*t3*(-1.D0*(0.426D-2*t7
     #-0.2369618833300074D-2*t7*t11+0.3899207790195271D-2*sigmaaa/t2
     #/t173*t11-0.186D-5*t243)*t25+t123*(0.1278D-1*t241*t15*t20
     #+0.1278D-1*t7*t129+0.1998870022980422D-5*t243))+rhoa*
     #(0.1236778371778789D-1*(0.2697586091519874D1*
     #(0.1007494971260294D0*t50+0.5476348575560166D-1*t65*t61)*t74
     #-0.2697586091519874D1*t183*(0.2717804421747983D0*t56*t50
     #+0.1477292174974578D0*t184*t61))*t202+0.7937005259840997D0*t90
     #*t50*t93-0.130605864926168D1*t91/t173*t93)
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t5 = t4*rhoa
      t6 = rhoa**2
      t7 = t4**2
      t9 = 1/t7/t6
      t10 = sigmaaa*t9
      t13 = dexp(-0.16455D1*t10)
      t16 = dsqrt(sigmaaa)
      t17 = 1/t5
      t18 = t16*t17
      t19 = t18**0.372D1
      t21 = 0.426D-2*t10-0.2369618833300074D-2*t10*t13-0.1D-5*t19
      t22 = dlog(t18+dsqrt(1+t18**2))
      t26 = 1.D0+0.2556D-1*t18*t22+0.1074661302677646D-5*t19
      t27 = 1/t26
      t30 = -0.9305257363491D0-1.D0*t21*t27
      t33 = rhob**(1.D0/3.D0)
      t34 = t33*rhob
      t35 = rhob**2
      t36 = t33**2
      t38 = 1/t36/t35
      t39 = sigmabb*t38
      t42 = dexp(-0.16455D1*t39)
      t45 = dsqrt(sigmabb)
      t46 = 1/t34
      t47 = t45*t46
      t48 = t47**0.372D1
      t50 = 0.426D-2*t39-0.2369618833300074D-2*t39*t42-0.1D-5*t48
      t51 = dlog(t47+dsqrt(1+t47**2))
      t55 = 1.D0+0.2556D-1*t47*t51+0.1074661302677646D-5*t48
      t56 = 1/t55
      t59 = -0.9305257363491D0-1.D0*t50*t56
      t62 = 1/rho
      t63 = t62**(1.D0/3.D0)
      t65 = 1.D0+0.1325688999052018D0*t63
      t66 = t62**(1.D0/6.D0)
      t69 = dsqrt(t62)
      t71 = t63**2
      t73 = 0.598255043577108D1*t66+0.2225569421150687D1*t63
     #+0.8004286349993634D0*t69+0.1897004325747559D0*t71
      t76 = 1.D0+0.1608197949869254D2/t73
      t77 = dlog(t76)
      t79 = 0.621814D-1*t65*t77
      t81 = 1.D0+0.6901399211255825D-1*t63
      t86 = 0.8157414703487641D1*t66+0.2247591863577616D1*t63
     #+0.4300972471276643D0*t69+0.1911512595127338D0*t71
      t89 = 1.D0+0.2960874997779344D2/t86
      t90 = dlog(t89)
      t91 = t81*t90
      t93 = rhoa-1.D0*rhob
      t94 = t93*t62
      t95 = 1.D0+t94
      t96 = t95**(1.D0/3.D0)
      t99 = 1.D0-1.D0*t94
      t100 = t99**(1.D0/3.D0)
      t102 = t96*t95+t100*t99-2.D0
      t103 = t93**2
      t104 = t103**2
      t105 = rho**2
      t106 = t105**2
      t107 = 1/t106
      t108 = t104*t107
      t110 = 1.D0-1.D0*t108
      t113 = 0.3799552353702395D-1*t91*t102*t110
      t115 = 1.D0+0.1274696188700087D0*t63
      t120 = 0.1112037486309468D2*t66+0.3844746237447211D1*t63
     #+0.1644733775567609D1*t69+0.2405871291288192D0*t71
      t123 = 1.D0+0.3216395899738507D2/t120
      t124 = dlog(t123)
      t127 = -0.310907D-1*t115*t124+t79
      t128 = t127*t102
      t130 = 0.1923661050931536D1*t128*t108
      t131 = t96**2
      t133 = t100**2
      t135 = 0.5D0*t131+0.5D0*t133
      t136 = t135**2
      t137 = t136*t135
      t138 = 1/t136
      t139 = sigma*t138
      t140 = rho**(1.D0/3.D0)
      t142 = 1/t140/t105
      t145 = -t79+t113+t130
      t146 = 1/t137
      t149 = dexp(-0.4042761511756372D2*t145*t146)
      t150 = t149-1.D0
      t151 = 1/t150
      t152 = sigma**2
      t153 = t151*t152
      t154 = t136**2
      t155 = 1/t154
      t156 = t140**2
      t158 = 1/t156/t106
      t159 = t155*t158
      t162 = 0.634682060977037D-1*t139*t142+0.1086645186223595D-1*t153
     #*t159
      t163 = t151*sigma
      t164 = t138*t142
      t167 = t150**2
      t168 = 1/t167
      t169 = t168*t152
      t172 = 1.D0+0.1712109500228824D0*t163*t164+0.2931318940773793D-1
     #*t169*t159
      t173 = 1/t172
      t176 = 1.D0+0.2697586091519874D1*t162*t173
      t177 = dlog(t176)
      t179 = 0.2473556743557577D-1*t137*t177
      t182 = 0.2568D1+0.1443307452126544D2*t63+0.2843543831490386D-2*t71
      t186 = 1.D0+0.5411317332115466D1*t63+0.1816419932959077D0*t71
     #+0.1763993811759022D-1*t62
      t187 = 1/t186
      t190 = 0.1D-2*t182*t187-0.1853571428571429D-2
      t191 = t190*t135
      t194 = 1/t156/t105
      t198 = dexp(-0.261211729852336D1*t136*t194*sigma)
      t199 = sigma*t142*t198
      t201 = 0.1D1*t191*t199
      zk(i) = 0.572D0*t5*t30+0.572D0*t34*t59+rho*(-t79+t113+t130+t179
     #+t201)
      t209 = sigmaaa/t7/t6/rhoa
      t213 = sigmaaa**2
      t214 = t6**2
      t221 = t18**0.272D1
      t224 = 1/t4/t6
      t225 = t221*t16*t224
      t230 = t26**2
      t232 = t21/t230
      t237 = dsqrt(1.D0+t10)
      t238 = 1/t237
      t251 = 0.1333333333333333D1*t96*t62-0.1333333333333333D1*t100*t62
      t254 = 0.3799552353702395D-1*t91*t251*t110
      t255 = t103*t93
      t258 = t91*t102*t255*t107
      t259 = 0.1519820941480958D0*t258
      t262 = 0.1923661050931536D1*t127*t251*t108
      t264 = t128*t255*t107
      t265 = 0.7694644203726145D1*t264
      t266 = t136*t177
      t267 = 1/t96
      t270 = 1/t100
      t273 = 0.3333333333333333D0*t267*t62-0.3333333333333333D0*t270*t62
      t276 = sigma*t146
      t280 = t169*t155
      t284 = t145*t155
      t287 = -0.4042761511756372D2*(t254-t259+t262+t265)*t146
     #+0.1212828453526912D3*t284*t273
      t289 = t158*t287*t149
      t294 = 1/t154/t135*t158
      t295 = t294*t273
      t301 = t172**2
      t303 = t162/t301
      t304 = t168*sigma
      t305 = t304*t138
      t310 = t146*t142
      t317 = 1/t167/t150*t152*t155
      t327 = 1/t176
      t334 = t190*t136*t152
      t335 = t106*rho
      t336 = 1/t335
      t344 = 1/t105
      t345 = 1/t71*t344
      t346 = t345*t77
      t347 = 0.2747773264188438D-2*t346
      t348 = t73**2
      t351 = t66**2
      t352 = t351**2
      t355 = 1/t352/t66*t344
      t359 = 1/t69*t344
      t362 = 1/t63*t344
      t367 = t65/t348*(-0.99709173929518D0*t355-0.7418564737168958D0
     #*t345-0.4002143174996817D0*t359-0.1264669550498372D0*t362)/t76
      t368 = 0.1D1*t367
      t372 = 0.8740742538988973D-3*t345*t90*t102*t110
      t373 = t86**2
      t386 = 0.1124999956683108D1*t81/t373*(-0.135956911724794D1*t355
     #-0.7491972878592054D0*t345-0.2150486235638321D0*t359
     #-0.1274341730084892D0*t362)/t89*t102*t110
      t393 = -0.1333333333333333D1*t96*t93*t344+0.1333333333333333D1
     #*t100*t93*t344
      t396 = 0.3799552353702395D-1*t91*t393*t110
      t400 = 0.1519820941480958D0*t91*t102*t104*t336
      t403 = t120**2
      t420 = 0.1923661050931536D1*(0.1321039893133927D-2*t345*t124
     #+0.1D1*t115/t403*(-0.1853395810515781D1*t355-0.128158207914907D1
     #*t345-0.8223668877838045D0*t359-0.1603914194192128D0*t362)/t123
     #-0.2747773264188438D-2*t346-0.1D1*t367)*t102*t108
      t423 = 0.1923661050931536D1*t127*t393*t108
      t426 = 0.7694644203726145D1*t128*t104*t336
      t433 = -0.3333333333333333D0*t267*t93*t344+0.3333333333333333D0
     #*t270*t93*t344
      t439 = t105*rho
      t441 = 1/t140/t439
      t449 = -0.4042761511756372D2*(t347+t368-t372-t386+t396+t400+t420
     #+t423-t426)*t146+0.1212828453526912D3*t284*t433
      t451 = t158*t449*t149
      t454 = t294*t433
      t459 = t155/t156/t335
      t493 = t186**2
      s1 = t347+t368-t372-t386+t396+t400+t420
      s2 = s1+t423-t426+0.7420670230672731D-1*t266*t433
      s3 = s2+0.2473556743557577D-1*t137*(0.2697586091519874D1*(
     #-0.1269364121954074D0*t276*t142*t433-0.148092480894642D0*t139
     #*t441-0.1086645186223595D-1*t280*t451-0.4346580744894379D-1*t153
     #*t454-0.5071010869043442D-1*t153*t459)*t173-0.2697586091519874D1
     #*t303*(-0.1712109500228824D0*t305*t142*t449*t149
     #-0.3424219000457648D0*t163*t310*t433-0.3994922167200589D0*t163
     #*t138*t441-0.5862637881547585D-1*t317*t451-0.1172527576309517D0
     #*t169*t454-0.136794883902777D0*t169*t459))*t327+0.1D1*(0.1D-2*(
     #-0.4811024840421814D1*t345-0.1895695887660258D-2*t362)*t187
     #-0.1D-2*t182/t493*(-0.1803772444038489D1*t345
     #-0.1210946621972718D0*t362-0.1763993811759022D-1*t344))*t135*t199
      t528 = s3+0.1D1*t190*t433*t199-0.2333333333333333D1*t191*sigma
     #*t441*t198+0.1D1*t191*sigma*t142*(-0.522423459704672D1*t135*t194
     #*sigma*t433+0.6965646129395627D1*t136/t156/t439*sigma)*t198
      t529 = rho*t528
      s1 = 0.7626666666666667D0*t4*t30+0.572D0*t5*(-1.D0*(-0.1136D-1
     #*t209+0.6318983555466863D-2*t209*t13-0.1039788744052072D-1*t213
     #/t4/t214/t6*t13+0.496D-5*t225)*t27+t232*(-0.3408D-1*t16*t224*t22
     #-0.3408D-1*t209*t238-0.5330320061281126D-5*t225))+rho*(t254-t259
     #+t262+t265+0.7420670230672731D-1*t266*t273+0.2473556743557577D-1
     #*t137*(0.2697586091519874D1*(-0.1269364121954074D0*t276*t142
     #*t273-0.1086645186223595D-1*t280*t289-0.4346580744894379D-1*t153
     #*t295)*t173-0.2697586091519874D1*t303*(-0.1712109500228824D0
     #*t305*t142*t287*t149-0.3424219000457648D0*t163*t310*t273
     #-0.5862637881547585D-1*t317*t289-0.1172527576309517D0*t169*t295)
     #)*t327+0.1D1*t190*t273*t199-0.522423459704672D1*t334*t336*t273
     #*t198)-t79
      vrhoa(i) = s1+t113+t130+t179+t201+t529
      t535 = sigmabb/t36/t35/rhob
      t539 = sigmabb**2
      t540 = t35**2
      t547 = t47**0.272D1
      t550 = 1/t33/t35
      t551 = t547*t45*t550
      t556 = t55**2
      t558 = t50/t556
      t563 = dsqrt(1.D0+t39)
      t564 = 1/t563
      t573 = -t251
      t576 = 0.3799552353702395D-1*t91*t573*t110
      t577 = 0.1519820941480958D0*t258
      t580 = 0.1923661050931536D1*t127*t573*t108
      t581 = 0.7694644203726145D1*t264
      t582 = -t273
      t593 = -0.4042761511756372D2*(t576+t577+t580-t581)*t146
     #+0.1212828453526912D3*t284*t582
      t595 = t158*t593*t149
      t598 = t294*t582
      s1 = 0.7626666666666667D0*t33*t59+0.572D0*t34*(-1.D0*(-0.1136D-1
     #*t535+0.6318983555466863D-2*t535*t42-0.1039788744052072D-1*t539
     #/t33/t540/t35*t42+0.496D-5*t551)*t56+t558*(-0.3408D-1*t45*t550
     #*t51-0.3408D-1*t535*t564-0.5330320061281126D-5*t551))+rho*(t576
     #+t577+t580-t581+0.7420670230672731D-1*t266*t582
     #+0.2473556743557577D-1*t137*(0.2697586091519874D1*(
     #-0.1269364121954074D0*t276*t142*t582-0.1086645186223595D-1*t280
     #*t595-0.4346580744894379D-1*t153*t598)*t173-0.2697586091519874D1
     #*t303*(-0.1712109500228824D0*t305*t142*t593*t149
     #-0.3424219000457648D0*t163*t310*t582-0.5862637881547585D-1*t317
     #*t595-0.1172527576309517D0*t169*t598))*t327+0.1D1*t190*t582*t199
     #-0.522423459704672D1*t334*t336*t582*t198)-t79
      vrhob(i) = s1+t113+t130+t179+t201+t529
      t640 = 1/t16
      t642 = t221*t640*t17
      t685 = rho*(0.2473556743557577D-1*t137*(0.2697586091519874D1*
     #(0.634682060977037D-1*t164+0.2173290372447189D-1*t163*t159)*t173
     #-0.2697586091519874D1*t303*(0.1712109500228824D0*t151*t138*t142
     #+0.5862637881547585D-1*t304*t159))*t327+0.1D1*t191*t142*t198
     #-0.261211729852336D1*t190*t137*sigma*t336*t198)
      vsigmaaa(i) = 0.572D0*t5*(-1.D0*(0.426D-2*t9
     #-0.2369618833300074D-2*t9*t13+0.3899207790195271D-2*sigmaaa/t4
     #/t214/rhoa*t13-0.186D-5*t642)*t27+t232*(0.1278D-1*t640*t17*t22
     #+0.1278D-1*t9*t238+0.1998870022980422D-5*t642))+t685
      vsigmaab(i) = 2.D0*t685
      t695 = 1/t45
      t697 = t547*t695*t46
      vsigmabb(i) = 0.572D0*t34*(-1.D0*(0.426D-2*t38
     #-0.2369618833300074D-2*t38*t42+0.3899207790195271D-2*sigmabb/t33
     #/t540/rhob*t42-0.186D-5*t697)*t56+t558*(0.1278D-1*t695*t46*t51
     #+0.1278D-1*t38*t564+0.1998870022980422D-5*t697))+t685
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t3 = t2*rhob
      t4 = rhob**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigmabb*t7
      t11 = dexp(-0.16455D1*t8)
      t14 = dsqrt(sigmabb)
      t15 = 1/t3
      t16 = t14*t15
      t17 = t16**0.372D1
      t19 = 0.426D-2*t8-0.2369618833300074D-2*t8*t11-0.1D-5*t17
      t20 = dlog(t16+dsqrt(1+t16**2))
      t24 = 1.D0+0.2556D-1*t16*t20+0.1074661302677646D-5*t17
      t25 = 1/t24
      t28 = -0.9305257363491D0-1.D0*t19*t25
      t31 = 1/rhob
      t32 = t31**(1.D0/3.D0)
      t34 = 1.D0+0.1274696188700087D0*t32
      t35 = t31**(1.D0/6.D0)
      t38 = dsqrt(t31)
      t40 = t32**2
      t42 = 0.1112037486309468D2*t35+0.3844746237447211D1*t32
     #+0.1644733775567609D1*t38+0.2405871291288192D0*t40
      t45 = 1.D0+0.3216395899738507D2/t42
      t46 = dlog(t45)
      t47 = t34*t46
      t48 = 0.310907D-1*t47
      t50 = 1/t2/t4
      t54 = dexp(0.2513845706671277D1*t47)
      t55 = t54-1.D0
      t56 = 1/t55
      t57 = sigmabb**2
      t58 = t56*t57
      t59 = t4**2
      t61 = 1/t5/t59
      t64 = 0.1007494971260294D0*sigmabb*t50+0.2738174287780083D-1*t58
     #*t61
      t65 = t56*sigmabb
      t68 = t55**2
      t69 = 1/t68
      t70 = t69*t57
      t73 = 1.D0+0.2717804421747983D0*t65*t50+0.7386460874872889D-1
     #*t70*t61
      t74 = 1/t73
      t77 = 1.D0+0.2697586091519874D1*t64*t74
      t78 = dlog(t77)
      t79 = 0.1236778371778789D-1*t78
      t82 = 0.2568D1+0.1443307452126544D2*t32+0.2843543831490386D-2*t40
      t86 = 1.D0+0.5411317332115466D1*t32+0.1816419932959077D0*t40
     #+0.1763993811759022D-1*t31
      t87 = 1/t86
      t90 = 0.1D-2*t82*t87-0.1853571428571429D-2
      t91 = t90*sigmabb
      t93 = dexp(-0.1645530784602056D1*t8)
      t94 = t50*t93
      t96 = 0.7937005259840997D0*t91*t94
      zk(i) = 0.572D0*t3*t28+rhob*(-t48+t79+t96)
      vrhoa(i) = 0.D0
      t101 = t4*rhob
      t104 = sigmabb/t5/t101
      t108 = t59*t4
      t114 = t16**0.272D1
      t115 = t114*t14
      t116 = t115*t50
      t118 = -0.1136D-1*t104+0.6318983555466863D-2*t104*t11
     #-0.1039788744052072D-1*t57/t2/t108*t11+0.496D-5*t116
      t121 = t24**2
      t122 = 1/t121
      t123 = t19*t122
      t127 = 1.D0+t8
      t128 = dsqrt(t127)
      t129 = 1/t128
      t133 = -0.3408D-1*t14*t50*t20-0.3408D-1*t104*t129
     #-0.5330320061281126D-5*t116
      t135 = -1.D0*t118*t25+t123*t133
      t138 = 1/t40
      t139 = 1/t4
      t140 = t138*t139
      t141 = t140*t46
      t142 = 0.1321039893133927D-2*t141
      t143 = t42**2
      t144 = 1/t143
      t145 = t34*t144
      t146 = t35**2
      t147 = t146**2
      t148 = t147*t35
      t149 = 1/t148
      t150 = t149*t139
      t153 = 1/t38
      t154 = t153*t139
      t156 = 1/t32
      t157 = t156*t139
      t159 = -0.1853395810515781D1*t150-0.128158207914907D1*t140
     #-0.8223668877838045D0*t154-0.1603914194192128D0*t157
      t160 = 1/t45
      t162 = t145*t159*t160
      t163 = 0.1D1*t162
      t165 = 1/t2/t101
      t168 = t142+t163
      t170 = t61*t168*t54
      t173 = t59*rhob
      t175 = 1/t5/t173
      t178 = -0.2350821599607352D0*sigmabb*t165+0.2213957124623647D1
     #*t70*t170-0.1277814667630705D0*t58*t175
      t181 = t73**2
      t182 = 1/t181
      t183 = t64*t182
      t184 = t69*sigmabb
      t192 = 1/t68/t55
      t193 = t192*t57
      t198 = 0.2197487022544806D2*t184*t50*t168*t54
     #-0.6341543650745294D0*t65*t165+0.1194467989321217D2*t193*t170
     #-0.3447015074940681D0*t70*t175
      t201 = 0.2697586091519874D1*t178*t74-0.2697586091519874D1*t183
     #*t198
      t202 = 1/t77
      t203 = t201*t202
      t207 = -0.4811024840421814D1*t140-0.1895695887660258D-2*t157
      t210 = t86**2
      t211 = 1/t210
      t212 = t82*t211
      t216 = -0.1803772444038489D1*t140-0.1210946621972718D0*t157
     #-0.1763993811759022D-1*t139
      t219 = 0.1D-2*t207*t87-0.1D-2*t212*t216
      t220 = t219*sigmabb
      t221 = t220*t94
      t223 = t165*t93
      t224 = t91*t223
      t226 = t90*t57
      t228 = 1/t108*t93
      t229 = t226*t228
      vrhob(i) = 0.7626666666666667D0*t2*t28+0.572D0*t3*t135-t48+t79
     #+t96+rhob*(t142+t163+0.1236778371778789D-1*t203
     #+0.7937005259840997D0*t221-0.1851967893962899D1*t224
     #+0.3482823064697813D1*t229)
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      t237 = 1/t2/t173
      t241 = 1/t14
      t243 = t114*t241*t15
      t245 = 0.426D-2*t7-0.2369618833300074D-2*t7*t11
     #+0.3899207790195271D-2*sigmabb*t237*t11-0.186D-5*t243
      t254 = 0.1278D-1*t241*t15*t20+0.1278D-1*t7*t129
     #+0.1998870022980422D-5*t243
      t262 = 0.1007494971260294D0*t50+0.5476348575560166D-1*t65*t61
      t269 = 0.2717804421747983D0*t56*t50+0.1477292174974578D0*t184*t61
      t272 = 0.2697586091519874D1*t262*t74-0.2697586091519874D1*t183
     #*t269
      t278 = 1/t173
      vsigmabb(i) = 0.572D0*t3*(-1.D0*t245*t25+t123*t254)+rhob*
     #(0.1236778371778789D-1*t272*t202+0.7937005259840997D0*t90*t50
     #*t93-0.130605864926168D1*t91*t278*t93)
      v2rhoa2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t289 = sigmabb*t61
      t293 = t59*t101
      t296 = t57/t2/t293
      t299 = t57*sigmabb
      t300 = t59**2
      t306 = t16**0.172D1
      t308 = t306*sigmabb*t61
      t310 = t115*t165
      t320 = t19/t121/t24
      t321 = t133**2
      t330 = 1/t128/t127
      t347 = 1/t2/t59
      t350 = t168**2
      t351 = t61*t350
      t353 = dexp(0.5027691413342554D1*t47)
      t354 = t351*t353
      t358 = t175*t168*t54
      t365 = 0.598255043577108D1*t35+0.2225569421150687D1*t32
     #+0.8004286349993634D0*t38+0.1897004325747559D0*t40
      t366 = t365**2
      t380 = 0.2D-21*t140/t366*(-0.99709173929518D0*t150
     #-0.7418564737168958D0*t140-0.4002143174996817D0*t154
     #-0.1264669550498372D0*t157)/(1.D0+0.1608197949869254D2/t365)
      t383 = 1/t59
      t384 = 1/t40/t31*t383
      t386 = 0.8806932620892844D-3*t384*t46
      t387 = 1/t101
      t388 = t138*t387
      t390 = 0.2642079786267853D-2*t388*t46
      t394 = 0.8497974591333914D-1*t140*t144*t159*t160
      t398 = t159**2
      t401 = 0.2D1*t34/t143/t42*t398*t160
      t418 = 1/t32/t31*t383
      t420 = t156*t387
      t425 = 0.1D1*t145*(-0.1544496508763151D1/t148/t31*t383
     #+0.3706791621031562D1*t149*t387-0.854388052766047D0*t384
     #+0.2563164158298141D1*t388-0.4111834438919023D0/t38/t31*t383
     #+0.1644733775567609D1*t153*t387-0.5346380647307093D-1*t418
     #+0.3207828388384256D0*t420)*t160
      t426 = t143**2
      t429 = t45**2
      t433 = 0.3216395899738507D2*t34/t426*t398/t429
      t434 = -t380+t386-t390-t394-t401+t425+t433
      t436 = t61*t434*t54
      t439 = t351*t54
      t443 = 1/t5/t108
      t454 = t64/t181/t73
      t455 = t198**2
      t459 = t50*t350
      t476 = t68**2
      t508 = t216**2
      t542 = t201**2
      t543 = t77**2
      t544 = 1/t543
      s3 = 0.1236778371778789D-1*(0.2697586091519874D1*
     #(0.7836071998691172D0*sigmabb*t347+0.3580200260842915D3*t193
     #*t354-0.2066359982982071D2*t70*t358+0.2213957124623647D1*t70
     #*t436-0.1790100130421458D3*t70*t439+0.7240949783240664D0*t58
     #*t443)*t74-0.5395172183039748D1*t178*t182*t198
     #+0.5395172183039748D1*t454*t455-0.2697586091519874D1*t183*
     #(0.35535663829313D4*t192*sigmabb*t459*t353-0.1025493943854243D3
     #*t184*t165*t168*t54+0.2197487022544806D2*t184*t50*t434*t54
     #-0.177678319146565D4*t184*t459*t54+0.2113847883581765D1*t65*t347
     #+0.2897369528551702D4/t476*t57*t354-0.1114836790033136D3*t193
     #*t358+0.1194467989321217D2*t193*t436-0.9657898428505673D3*t193
     #*t439+0.1953308542466386D1*t70*t443))*t202
      s4 = 0.7937005259840997D0*(0.1D-2*(-0.3207349893614542D1*t384
     #+0.9622049680843627D1*t388-0.6318986292200858D-3*t418
     #+0.3791391775320515D-2*t420)*t87-0.2D-2*t207*t211*t216+0.2D-2
     #*t82/t210/t86*t508-0.1D-2*t212*(-0.1202514962692326D1*t384
     #+0.3607544888076978D1*t388-0.4036488739909061D-1*t418
     #+0.2421893243945437D0*t420+0.3527987623518044D-1*t387))*sigmabb
     #*t94-0.3703935787925799D1*t220*t223
      s2 = s3+s4
      s1 = s2+0.6965646129395627D1*t219*t57*t228+0.6173226313209665D1
     #*t91*t347*t93-0.2902352553914844D2*t226/t293*t93
     #+0.1528291352075288D2*t90*t299/t5/t300/rhob*t93
      t547 = s1-0.1236778371778789D-1*t542*t544-t380+t386-t401+t425
     #+t433-t390-t394
      v2rhob2(i) = 0.2542222222222222D0/t5*t28+0.1525333333333333D1*t2
     #*t135+0.572D0*t3*(-1.D0*(0.4165333333333333D-1*t289
     #-0.2316960637004517D-1*t289*t11+0.9358098696468651D-1*t296*t11
     #-0.4562593008900494D-1*t299/t300/t4*t11-0.1798826666666667D-4
     #*t308-0.1157333333333333D-4*t310)*t25+2.D0*t118*t122*t133-2.D0
     #*t320*t321+t123*(0.7952D-1*t14*t165*t20+0.1704D0*t289*t129
     #-0.4544D-1*t296*t330+0.1933129408891288D-4*t308
     #+0.1243741347632263D-4*t310))+0.2642079786267853D-2*t141+0.2D1
     #*t162+0.2473556743557577D-1*t203+0.1587401051968199D1*t221
     #-0.3703935787925799D1*t224+0.6965646129395627D1*t229+rhob*t547
      v2sigmaaa2(i) = 0.D0
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      t555 = 1/sigmabb
      t557 = t306*t555*t7
      t560 = 1/t14/sigmabb
      t562 = t114*t560*t15
      t570 = t254**2
      t594 = t269**2
      t603 = t272**2
      v2sigmabb2(i) = 0.572D0*t3*(-1.D0*(0.7798415580390543D-2*t237
     #*t11-0.6416146418766319D-2*sigmabb/t300*t11-0.25296D-5*t557
     #+0.93D-6*t562)*t25+2.D0*t245*t122*t254-2.D0*t320*t570+t123*(
     #-0.639D-2*t560*t15*t20+0.639D-2*t555*t7*t129-0.639D-2*t237*t330
     #+0.2718463231253374D-5*t557-0.9994350114902112D-6*t562))+rhob*
     #(0.1236778371778789D-1*(0.1477292174974578D0*t56*t61*t74
     #-0.5395172183039748D1*t262*t182*t269+0.5395172183039748D1*t454
     #*t594-0.3985122824322565D0*t183*t69*t61)*t202
     #-0.1236778371778789D-1*t603*t544-0.261211729852336D1*t90*t278
     #*t93+0.2149159713855873D1*t91/t5/t293*t93)
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t3 = t2*rhoa
      t4 = rhoa**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigmaaa*t7
      t11 = dexp(-0.16455D1*t8)
      t14 = dsqrt(sigmaaa)
      t15 = 1/t3
      t16 = t14*t15
      t17 = t16**0.372D1
      t19 = 0.426D-2*t8-0.2369618833300074D-2*t8*t11-0.1D-5*t17
      t20 = dlog(t16+dsqrt(1+t16**2))
      t24 = 1.D0+0.2556D-1*t16*t20+0.1074661302677646D-5*t17
      t25 = 1/t24
      t28 = -0.9305257363491D0-1.D0*t19*t25
      t31 = 1/rhoa
      t32 = t31**(1.D0/3.D0)
      t34 = 1.D0+0.1274696188700087D0*t32
      t35 = t31**(1.D0/6.D0)
      t38 = dsqrt(t31)
      t40 = t32**2
      t42 = 0.1112037486309468D2*t35+0.3844746237447211D1*t32
     #+0.1644733775567609D1*t38+0.2405871291288192D0*t40
      t45 = 1.D0+0.3216395899738507D2/t42
      t46 = dlog(t45)
      t47 = t34*t46
      t48 = 0.310907D-1*t47
      t50 = 1/t2/t4
      t54 = dexp(0.2513845706671277D1*t47)
      t55 = t54-1.D0
      t56 = 1/t55
      t57 = sigmaaa**2
      t58 = t56*t57
      t59 = t4**2
      t61 = 1/t5/t59
      t64 = 0.1007494971260294D0*sigmaaa*t50+0.2738174287780083D-1*t58
     #*t61
      t65 = t56*sigmaaa
      t68 = t55**2
      t69 = 1/t68
      t70 = t69*t57
      t73 = 1.D0+0.2717804421747983D0*t65*t50+0.7386460874872889D-1
     #*t70*t61
      t74 = 1/t73
      t77 = 1.D0+0.2697586091519874D1*t64*t74
      t78 = dlog(t77)
      t79 = 0.1236778371778789D-1*t78
      t82 = 0.2568D1+0.1443307452126544D2*t32+0.2843543831490386D-2*t40
      t86 = 1.D0+0.5411317332115466D1*t32+0.1816419932959077D0*t40
     #+0.1763993811759022D-1*t31
      t87 = 1/t86
      t90 = 0.1D-2*t82*t87-0.1853571428571429D-2
      t91 = t90*sigmaaa
      t93 = dexp(-0.1645530784602056D1*t8)
      t94 = t50*t93
      t96 = 0.7937005259840997D0*t91*t94
      zk(i) = 0.572D0*t3*t28+rhoa*(-t48+t79+t96)
      t101 = t4*rhoa
      t104 = sigmaaa/t5/t101
      t108 = t59*t4
      t114 = t16**0.272D1
      t115 = t114*t14
      t116 = t115*t50
      t118 = -0.1136D-1*t104+0.6318983555466863D-2*t104*t11
     #-0.1039788744052072D-1*t57/t2/t108*t11+0.496D-5*t116
      t121 = t24**2
      t122 = 1/t121
      t123 = t19*t122
      t127 = 1.D0+t8
      t128 = dsqrt(t127)
      t129 = 1/t128
      t133 = -0.3408D-1*t14*t50*t20-0.3408D-1*t104*t129
     #-0.5330320061281126D-5*t116
      t135 = -1.D0*t118*t25+t123*t133
      t138 = 1/t40
      t139 = 1/t4
      t140 = t138*t139
      t141 = t140*t46
      t142 = 0.1321039893133927D-2*t141
      t143 = t42**2
      t144 = 1/t143
      t145 = t34*t144
      t146 = t35**2
      t147 = t146**2
      t148 = t147*t35
      t149 = 1/t148
      t150 = t149*t139
      t153 = 1/t38
      t154 = t153*t139
      t156 = 1/t32
      t157 = t156*t139
      t159 = -0.1853395810515781D1*t150-0.128158207914907D1*t140
     #-0.8223668877838045D0*t154-0.1603914194192128D0*t157
      t160 = 1/t45
      t162 = t145*t159*t160
      t163 = 0.1D1*t162
      t165 = 1/t2/t101
      t168 = t142+t163
      t170 = t61*t168*t54
      t173 = t59*rhoa
      t175 = 1/t5/t173
      t178 = -0.2350821599607352D0*sigmaaa*t165+0.2213957124623647D1
     #*t70*t170-0.1277814667630705D0*t58*t175
      t181 = t73**2
      t182 = 1/t181
      t183 = t64*t182
      t184 = t69*sigmaaa
      t192 = 1/t68/t55
      t193 = t192*t57
      t198 = 0.2197487022544806D2*t184*t50*t168*t54
     #-0.6341543650745294D0*t65*t165+0.1194467989321217D2*t193*t170
     #-0.3447015074940681D0*t70*t175
      t201 = 0.2697586091519874D1*t178*t74-0.2697586091519874D1*t183
     #*t198
      t202 = 1/t77
      t203 = t201*t202
      t207 = -0.4811024840421814D1*t140-0.1895695887660258D-2*t157
      t210 = t86**2
      t211 = 1/t210
      t212 = t82*t211
      t216 = -0.1803772444038489D1*t140-0.1210946621972718D0*t157
     #-0.1763993811759022D-1*t139
      t219 = 0.1D-2*t207*t87-0.1D-2*t212*t216
      t220 = t219*sigmaaa
      t221 = t220*t94
      t223 = t165*t93
      t224 = t91*t223
      t226 = t90*t57
      t228 = 1/t108*t93
      t229 = t226*t228
      vrhoa(i) = 0.7626666666666667D0*t2*t28+0.572D0*t3*t135-t48+t79
     #+t96+rhoa*(t142+t163+0.1236778371778789D-1*t203
     #+0.7937005259840997D0*t221-0.1851967893962899D1*t224
     #+0.3482823064697813D1*t229)
      vrhob(i) = 0.D0
      t237 = 1/t2/t173
      t241 = 1/t14
      t243 = t114*t241*t15
      t245 = 0.426D-2*t7-0.2369618833300074D-2*t7*t11
     #+0.3899207790195271D-2*sigmaaa*t237*t11-0.186D-5*t243
      t254 = 0.1278D-1*t241*t15*t20+0.1278D-1*t7*t129
     #+0.1998870022980422D-5*t243
      t262 = 0.1007494971260294D0*t50+0.5476348575560166D-1*t65*t61
      t269 = 0.2717804421747983D0*t56*t50+0.1477292174974578D0*t184*t61
      t272 = 0.2697586091519874D1*t262*t74-0.2697586091519874D1*t183
     #*t269
      t278 = 1/t173
      vsigmaaa(i) = 0.572D0*t3*(-1.D0*t245*t25+t123*t254)+rhoa*
     #(0.1236778371778789D-1*t272*t202+0.7937005259840997D0*t90*t50
     #*t93-0.130605864926168D1*t91*t278*t93)
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      t289 = sigmaaa*t61
      t293 = t59*t101
      t296 = t57/t2/t293
      t299 = t57*sigmaaa
      t300 = t59**2
      t306 = t16**0.172D1
      t308 = t306*sigmaaa*t61
      t310 = t115*t165
      t320 = t19/t121/t24
      t321 = t133**2
      t330 = 1/t128/t127
      t347 = 1/t2/t59
      t350 = t168**2
      t351 = t61*t350
      t353 = dexp(0.5027691413342554D1*t47)
      t354 = t351*t353
      t358 = t175*t168*t54
      t365 = 0.598255043577108D1*t35+0.2225569421150687D1*t32
     #+0.8004286349993634D0*t38+0.1897004325747559D0*t40
      t366 = t365**2
      t380 = 0.2D-21*t140/t366*(-0.99709173929518D0*t150
     #-0.7418564737168958D0*t140-0.4002143174996817D0*t154
     #-0.1264669550498372D0*t157)/(1.D0+0.1608197949869254D2/t365)
      t383 = 1/t59
      t384 = 1/t40/t31*t383
      t386 = 0.8806932620892844D-3*t384*t46
      t387 = 1/t101
      t388 = t138*t387
      t390 = 0.2642079786267853D-2*t388*t46
      t394 = 0.8497974591333914D-1*t140*t144*t159*t160
      t398 = t159**2
      t401 = 0.2D1*t34/t143/t42*t398*t160
      t418 = 1/t32/t31*t383
      t420 = t156*t387
      t425 = 0.1D1*t145*(-0.1544496508763151D1/t148/t31*t383
     #+0.3706791621031562D1*t149*t387-0.854388052766047D0*t384
     #+0.2563164158298141D1*t388-0.4111834438919023D0/t38/t31*t383
     #+0.1644733775567609D1*t153*t387-0.5346380647307093D-1*t418
     #+0.3207828388384256D0*t420)*t160
      t426 = t143**2
      t429 = t45**2
      t433 = 0.3216395899738507D2*t34/t426*t398/t429
      t434 = -t380+t386-t390-t394-t401+t425+t433
      t436 = t61*t434*t54
      t439 = t351*t54
      t443 = 1/t5/t108
      t454 = t64/t181/t73
      t455 = t198**2
      t459 = t50*t350
      t476 = t68**2
      t508 = t216**2
      t542 = t201**2
      t543 = t77**2
      t544 = 1/t543
      s3 = 0.1236778371778789D-1*(0.2697586091519874D1*
     #(0.7836071998691172D0*sigmaaa*t347+0.3580200260842915D3*t193
     #*t354-0.2066359982982071D2*t70*t358+0.2213957124623647D1*t70
     #*t436-0.1790100130421458D3*t70*t439+0.7240949783240664D0*t58
     #*t443)*t74-0.5395172183039748D1*t178*t182*t198
     #+0.5395172183039748D1*t454*t455-0.2697586091519874D1*t183*
     #(0.35535663829313D4*t192*sigmaaa*t459*t353-0.1025493943854243D3
     #*t184*t165*t168*t54+0.2197487022544806D2*t184*t50*t434*t54
     #-0.177678319146565D4*t184*t459*t54+0.2113847883581765D1*t65*t347
     #+0.2897369528551702D4/t476*t57*t354-0.1114836790033136D3*t193
     #*t358+0.1194467989321217D2*t193*t436-0.9657898428505673D3*t193
     #*t439+0.1953308542466386D1*t70*t443))*t202
      s4 = 0.7937005259840997D0*(0.1D-2*(-0.3207349893614542D1*t384
     #+0.9622049680843627D1*t388-0.6318986292200858D-3*t418
     #+0.3791391775320515D-2*t420)*t87-0.2D-2*t207*t211*t216+0.2D-2
     #*t82/t210/t86*t508-0.1D-2*t212*(-0.1202514962692326D1*t384
     #+0.3607544888076978D1*t388-0.4036488739909061D-1*t418
     #+0.2421893243945437D0*t420+0.3527987623518044D-1*t387))*sigmaaa
     #*t94-0.3703935787925799D1*t220*t223
      s2 = s3+s4
      s1 = s2+0.6965646129395627D1*t219*t57*t228+0.6173226313209665D1
     #*t91*t347*t93-0.2902352553914844D2*t226/t293*t93
     #+0.1528291352075288D2*t90*t299/t5/t300/rhoa*t93
      t547 = s1-0.1236778371778789D-1*t542*t544-t380+t386-t401+t425
     #+t433-t390-t394
      v2rhoa2(i) = 0.2542222222222222D0/t5*t28+0.1525333333333333D1*t2
     #*t135+0.572D0*t3*(-1.D0*(0.4165333333333333D-1*t289
     #-0.2316960637004517D-1*t289*t11+0.9358098696468651D-1*t296*t11
     #-0.4562593008900494D-1*t299/t300/t4*t11-0.1798826666666667D-4
     #*t308-0.1157333333333333D-4*t310)*t25+2.D0*t118*t122*t133-2.D0
     #*t320*t321+t123*(0.7952D-1*t14*t165*t20+0.1704D0*t289*t129
     #-0.4544D-1*t296*t330+0.1933129408891288D-4*t308
     #+0.1243741347632263D-4*t310))+0.2642079786267853D-2*t141+0.2D1
     #*t162+0.2473556743557577D-1*t203+0.1587401051968199D1*t221
     #-0.3703935787925799D1*t224+0.6965646129395627D1*t229+rhoa*t547
      v2rhob2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t555 = 1/sigmaaa
      t557 = t306*t555*t7
      t560 = 1/t14/sigmaaa
      t562 = t114*t560*t15
      t570 = t254**2
      t594 = t269**2
      t603 = t272**2
      v2sigmaaa2(i) = 0.572D0*t3*(-1.D0*(0.7798415580390543D-2*t237
     #*t11-0.6416146418766319D-2*sigmaaa/t300*t11-0.25296D-5*t557
     #+0.93D-6*t562)*t25+2.D0*t245*t122*t254-2.D0*t320*t570+t123*(
     #-0.639D-2*t560*t15*t20+0.639D-2*t555*t7*t129-0.639D-2*t237*t330
     #+0.2718463231253374D-5*t557-0.9994350114902112D-6*t562))+rhoa*
     #(0.1236778371778789D-1*(0.1477292174974578D0*t56*t61*t74
     #-0.5395172183039748D1*t262*t182*t269+0.5395172183039748D1*t454
     #*t594-0.3985122824322565D0*t183*t69*t61)*t202
     #-0.1236778371778789D-1*t603*t544-0.261211729852336D1*t90*t278
     #*t93+0.2149159713855873D1*t91/t5/t293*t93)
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      v2sigmabb2(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t5 = t4*rhoa
      t6 = rhoa**2
      t7 = t4**2
      t9 = 1/t7/t6
      t10 = sigmaaa*t9
      t13 = dexp(-0.16455D1*t10)
      t16 = dsqrt(sigmaaa)
      t17 = 1/t5
      t18 = t16*t17
      t19 = t18**0.372D1
      t21 = 0.426D-2*t10-0.2369618833300074D-2*t10*t13-0.1D-5*t19
      t22 = dlog(t18+dsqrt(1+t18**2))
      t26 = 1.D0+0.2556D-1*t18*t22+0.1074661302677646D-5*t19
      t27 = 1/t26
      t30 = -0.9305257363491D0-1.D0*t21*t27
      t33 = rhob**(1.D0/3.D0)
      t34 = t33*rhob
      t35 = rhob**2
      t36 = t33**2
      t38 = 1/t36/t35
      t39 = sigmabb*t38
      t42 = dexp(-0.16455D1*t39)
      t45 = dsqrt(sigmabb)
      t46 = 1/t34
      t47 = t45*t46
      t48 = t47**0.372D1
      t50 = 0.426D-2*t39-0.2369618833300074D-2*t39*t42-0.1D-5*t48
      t51 = dlog(t47+dsqrt(1+t47**2))
      t55 = 1.D0+0.2556D-1*t47*t51+0.1074661302677646D-5*t48
      t56 = 1/t55
      t59 = -0.9305257363491D0-1.D0*t50*t56
      t62 = 1/rho
      t63 = t62**(1.D0/3.D0)
      t65 = 1.D0+0.1325688999052018D0*t63
      t66 = t62**(1.D0/6.D0)
      t69 = dsqrt(t62)
      t71 = t63**2
      t73 = 0.598255043577108D1*t66+0.2225569421150687D1*t63
     #+0.8004286349993634D0*t69+0.1897004325747559D0*t71
      t76 = 1.D0+0.1608197949869254D2/t73
      t77 = dlog(t76)
      t79 = 0.621814D-1*t65*t77
      t81 = 1.D0+0.6901399211255825D-1*t63
      t86 = 0.8157414703487641D1*t66+0.2247591863577616D1*t63
     #+0.4300972471276643D0*t69+0.1911512595127338D0*t71
      t89 = 1.D0+0.2960874997779344D2/t86
      t90 = dlog(t89)
      t91 = t81*t90
      t93 = rhoa-1.D0*rhob
      t94 = t93*t62
      t95 = 1.D0+t94
      t96 = t95**(1.D0/3.D0)
      t97 = t96*t95
      t99 = 1.D0-1.D0*t94
      t100 = t99**(1.D0/3.D0)
      t101 = t100*t99
      t102 = t97+t101-2.D0
      t103 = t93**2
      t104 = t103**2
      t105 = rho**2
      t106 = t105**2
      t107 = 1/t106
      t108 = t104*t107
      t110 = 1.D0-1.D0*t108
      t111 = t102*t110
      t113 = 0.3799552353702395D-1*t91*t111
      t115 = 1.D0+0.1274696188700087D0*t63
      t120 = 0.1112037486309468D2*t66+0.3844746237447211D1*t63
     #+0.1644733775567609D1*t69+0.2405871291288192D0*t71
      t123 = 1.D0+0.3216395899738507D2/t120
      t124 = dlog(t123)
      t127 = -0.310907D-1*t115*t124+t79
      t128 = t127*t102
      t130 = 0.1923661050931536D1*t128*t108
      t131 = t96**2
      t133 = t100**2
      t135 = 0.5D0*t131+0.5D0*t133
      t136 = t135**2
      t137 = t136*t135
      t138 = 1/t136
      t139 = sigma*t138
      t140 = rho**(1.D0/3.D0)
      t142 = 1/t140/t105
      t145 = -t79+t113+t130
      t146 = 1/t137
      t147 = t145*t146
      t149 = dexp(-0.4042761511756372D2*t147)
      t150 = t149-1.D0
      t151 = 1/t150
      t152 = sigma**2
      t153 = t151*t152
      t154 = t136**2
      t155 = 1/t154
      t156 = t140**2
      t158 = 1/t156/t106
      t159 = t155*t158
      t162 = 0.634682060977037D-1*t139*t142+0.1086645186223595D-1*t153
     #*t159
      t163 = t151*sigma
      t164 = t138*t142
      t167 = t150**2
      t168 = 1/t167
      t169 = t168*t152
      t172 = 1.D0+0.1712109500228824D0*t163*t164+0.2931318940773793D-1
     #*t169*t159
      t173 = 1/t172
      t176 = 1.D0+0.2697586091519874D1*t162*t173
      t177 = dlog(t176)
      t179 = 0.2473556743557577D-1*t137*t177
      t182 = 0.2568D1+0.1443307452126544D2*t63+0.2843543831490386D-2*t71
      t186 = 1.D0+0.5411317332115466D1*t63+0.1816419932959077D0*t71
     #+0.1763993811759022D-1*t62
      t187 = 1/t186
      t190 = 0.1D-2*t182*t187-0.1853571428571429D-2
      t191 = t190*t135
      t194 = 1/t156/t105
      t198 = dexp(-0.261211729852336D1*t136*t194*sigma)
      t199 = sigma*t142*t198
      t201 = 0.1D1*t191*t199
      zk(i) = 0.572D0*t5*t30+0.572D0*t34*t59+rho*(-t79+t113+t130+t179
     #+t201)
      t206 = t6*rhoa
      t208 = 1/t7/t206
      t209 = sigmaaa*t208
      t213 = sigmaaa**2
      t214 = t6**2
      t217 = 1/t4/t214/t6
      t221 = t18**0.272D1
      t222 = t221*t16
      t224 = 1/t4/t6
      t225 = t222*t224
      t227 = -0.1136D-1*t209+0.6318983555466863D-2*t209*t13
     #-0.1039788744052072D-1*t213*t217*t13+0.496D-5*t225
      t230 = t26**2
      t231 = 1/t230
      t232 = t21*t231
      t236 = 1.D0+t10
      t237 = dsqrt(t236)
      t238 = 1/t237
      t242 = -0.3408D-1*t16*t224*t22-0.3408D-1*t209*t238
     #-0.5330320061281126D-5*t225
      t244 = -1.D0*t227*t27+t232*t242
      t251 = 0.1333333333333333D1*t96*t62-0.1333333333333333D1*t100*t62
      t253 = t91*t251*t110
      t254 = 0.3799552353702395D-1*t253
      t255 = t103*t93
      t256 = t102*t255
      t258 = t91*t256*t107
      t259 = 0.1519820941480958D0*t258
      t260 = t127*t251
      t261 = t260*t108
      t262 = 0.1923661050931536D1*t261
      t263 = t255*t107
      t264 = t128*t263
      t265 = 0.7694644203726145D1*t264
      t266 = t136*t177
      t267 = 1/t96
      t270 = 1/t100
      t273 = 0.3333333333333333D0*t267*t62-0.3333333333333333D0*t270*t62
      t274 = t266*t273
      t275 = 0.7420670230672731D-1*t274
      t276 = sigma*t146
      t277 = t142*t273
      t280 = t169*t155
      t281 = t254-t259+t262+t265
      t284 = t145*t155
      t287 = -0.4042761511756372D2*t281*t146+0.1212828453526912D3*t284
     #*t273
      t288 = t158*t287
      t289 = t288*t149
      t292 = t154*t135
      t293 = 1/t292
      t294 = t293*t158
      t295 = t294*t273
      t298 = -0.1269364121954074D0*t276*t277-0.1086645186223595D-1
     #*t280*t289-0.4346580744894379D-1*t153*t295
      t301 = t172**2
      t302 = 1/t301
      t303 = t162*t302
      t304 = t168*sigma
      t305 = t304*t138
      t306 = t142*t287
      t307 = t306*t149
      t310 = t146*t142
      t311 = t310*t273
      t315 = 1/t167/t150
      t316 = t315*t152
      t317 = t316*t155
      t322 = -0.1712109500228824D0*t305*t307-0.3424219000457648D0*t163
     #*t311-0.5862637881547585D-1*t317*t289-0.1172527576309517D0*t169
     #*t295
      t325 = 0.2697586091519874D1*t298*t173-0.2697586091519874D1*t303
     #*t322
      t326 = t137*t325
      t327 = 1/t176
      t328 = t326*t327
      t329 = 0.2473556743557577D-1*t328
      t330 = t190*t273
      t331 = t330*t199
      t332 = 0.1D1*t331
      t334 = t190*t136*t152
      t335 = t106*rho
      t336 = 1/t335
      t338 = t336*t273*t198
      t339 = t334*t338
      t340 = 0.522423459704672D1*t339
      t343 = 1/t71
      t344 = 1/t105
      t345 = t343*t344
      t346 = t345*t77
      t347 = 0.2747773264188438D-2*t346
      t348 = t73**2
      t349 = 1/t348
      t350 = t65*t349
      t351 = t66**2
      t352 = t351**2
      t353 = t352*t66
      t354 = 1/t353
      t355 = t354*t344
      t358 = 1/t69
      t359 = t358*t344
      t361 = 1/t63
      t362 = t361*t344
      t364 = -0.99709173929518D0*t355-0.7418564737168958D0*t345
     #-0.4002143174996817D0*t359-0.1264669550498372D0*t362
      t365 = 1/t76
      t367 = t350*t364*t365
      t368 = 0.1D1*t367
      t369 = t90*t102
      t370 = t369*t110
      t371 = t345*t370
      t372 = 0.8740742538988973D-3*t371
      t373 = t86**2
      t374 = 1/t373
      t375 = t81*t374
      t380 = -0.135956911724794D1*t355-0.7491972878592054D0*t345
     #-0.2150486235638321D0*t359-0.1274341730084892D0*t362
      t381 = t375*t380
      t382 = 1/t89
      t383 = t382*t102
      t384 = t383*t110
      t385 = t381*t384
      t386 = 0.1124999956683108D1*t385
      t387 = t96*t93
      t390 = t100*t93
      t393 = -0.1333333333333333D1*t387*t344+0.1333333333333333D1*t390
     #*t344
      t395 = t91*t393*t110
      t396 = 0.3799552353702395D-1*t395
      t397 = t102*t104
      t399 = t91*t397*t336
      t400 = 0.1519820941480958D0*t399
      t403 = t120**2
      t404 = 1/t403
      t405 = t115*t404
      t410 = -0.1853395810515781D1*t355-0.128158207914907D1*t345
     #-0.8223668877838045D0*t359-0.1603914194192128D0*t362
      t411 = 1/t123
      t417 = 0.1321039893133927D-2*t345*t124+0.1D1*t405*t410*t411
     #-0.2747773264188438D-2*t346-0.1D1*t367
      t418 = t417*t102
      t419 = t418*t108
      t420 = 0.1923661050931536D1*t419
      t421 = t127*t393
      t422 = t421*t108
      t423 = 0.1923661050931536D1*t422
      t424 = t104*t336
      t425 = t128*t424
      t426 = 0.7694644203726145D1*t425
      t427 = t267*t93
      t430 = t270*t93
      t433 = -0.3333333333333333D0*t427*t344+0.3333333333333333D0*t430
     #*t344
      t434 = t266*t433
      t436 = t142*t433
      t439 = t105*rho
      t441 = 1/t140/t439
      t444 = t347+t368-t372-t386+t396+t400+t420+t423-t426
      t449 = -0.4042761511756372D2*t444*t146+0.1212828453526912D3*t284
     #*t433
      t450 = t158*t449
      t451 = t450*t149
      t454 = t294*t433
      t458 = 1/t156/t335
      t459 = t155*t458
      t462 = -0.1269364121954074D0*t276*t436-0.148092480894642D0*t139
     #*t441-0.1086645186223595D-1*t280*t451-0.4346580744894379D-1*t153
     #*t454-0.5071010869043442D-1*t153*t459
      t465 = t142*t449
      t466 = t465*t149
      t469 = t310*t433
      t472 = t138*t441
      t481 = -0.1712109500228824D0*t305*t466-0.3424219000457648D0*t163
     #*t469-0.3994922167200589D0*t163*t472-0.5862637881547585D-1*t317
     #*t451-0.1172527576309517D0*t169*t454-0.136794883902777D0*t169*t459
      t484 = 0.2697586091519874D1*t462*t173-0.2697586091519874D1*t303
     #*t481
      t485 = t137*t484
      t486 = t485*t327
      t490 = -0.4811024840421814D1*t345-0.1895695887660258D-2*t362
      t493 = t186**2
      t494 = 1/t493
      t495 = t182*t494
      t499 = -0.1803772444038489D1*t345-0.1210946621972718D0*t362
     #-0.1763993811759022D-1*t344
      t502 = 0.1D-2*t490*t187-0.1D-2*t495*t499
      t503 = t502*t135
      t504 = t503*t199
      t506 = t190*t433
      t507 = t506*t199
      t510 = sigma*t441*t198
      t511 = t191*t510
      t513 = t191*sigma
      t514 = t135*t194
      t515 = sigma*t433
      t519 = 1/t156/t439
      t520 = t136*t519
      t523 = -0.522423459704672D1*t514*t515+0.6965646129395627D1*t520
     #*sigma
      t525 = t142*t523*t198
      t526 = t513*t525
      t528 = t347+t368-t372-t386+t396+t400+t420+t423-t426
     #+0.7420670230672731D-1*t434+0.2473556743557577D-1*t486+0.1D1
     #*t504+0.1D1*t507-0.2333333333333333D1*t511+0.1D1*t526
      t529 = rho*t528
      vrhoa(i) = 0.7626666666666667D0*t4*t30+0.572D0*t5*t244+rho*(t254
     #-t259+t262+t265+t275+t329+t332-t340)-t79+t113+t130+t179+t201+t529
      t532 = t35*rhob
      t534 = 1/t36/t532
      t535 = sigmabb*t534
      t539 = sigmabb**2
      t540 = t35**2
      t543 = 1/t33/t540/t35
      t547 = t47**0.272D1
      t548 = t547*t45
      t550 = 1/t33/t35
      t551 = t548*t550
      t553 = -0.1136D-1*t535+0.6318983555466863D-2*t535*t42
     #-0.1039788744052072D-1*t539*t543*t42+0.496D-5*t551
      t556 = t55**2
      t557 = 1/t556
      t558 = t50*t557
      t562 = 1.D0+t39
      t563 = dsqrt(t562)
      t564 = 1/t563
      t568 = -0.3408D-1*t45*t550*t51-0.3408D-1*t535*t564
     #-0.5330320061281126D-5*t551
      t570 = -1.D0*t553*t56+t558*t568
      t573 = -t251
      t575 = t91*t573*t110
      t576 = 0.3799552353702395D-1*t575
      t577 = 0.1519820941480958D0*t258
      t578 = t127*t573
      t579 = t578*t108
      t580 = 0.1923661050931536D1*t579
      t581 = 0.7694644203726145D1*t264
      t582 = -t273
      t583 = t266*t582
      t584 = 0.7420670230672731D-1*t583
      t585 = t142*t582
      t588 = t576+t577+t580-t581
      t593 = -0.4042761511756372D2*t588*t146+0.1212828453526912D3*t284
     #*t582
      t594 = t158*t593
      t595 = t594*t149
      t598 = t294*t582
      t601 = -0.1269364121954074D0*t276*t585-0.1086645186223595D-1
     #*t280*t595-0.4346580744894379D-1*t153*t598
      t604 = t142*t593
      t605 = t604*t149
      t608 = t310*t582
      t615 = -0.1712109500228824D0*t305*t605-0.3424219000457648D0*t163
     #*t608-0.5862637881547585D-1*t317*t595-0.1172527576309517D0*t169
     #*t598
      t618 = 0.2697586091519874D1*t601*t173-0.2697586091519874D1*t303
     #*t615
      t619 = t137*t618
      t620 = t619*t327
      t621 = 0.2473556743557577D-1*t620
      t622 = t190*t582
      t623 = t622*t199
      t624 = 0.1D1*t623
      t626 = t336*t582*t198
      t627 = t334*t626
      t628 = 0.522423459704672D1*t627
      vrhob(i) = 0.7626666666666667D0*t33*t59+0.572D0*t34*t570+rho*
     #(t576+t577+t580-t581+t584+t621+t624-t628)-t79+t113+t130+t179
     #+t201+t529
      t636 = 1/t4/t214/rhoa
      t640 = 1/t16
      t641 = t221*t640
      t642 = t641*t17
      t644 = 0.426D-2*t9-0.2369618833300074D-2*t9*t13
     #+0.3899207790195271D-2*sigmaaa*t636*t13-0.186D-5*t642
      t653 = 0.1278D-1*t640*t17*t22+0.1278D-1*t9*t238
     #+0.1998870022980422D-5*t642
      t655 = -1.D0*t644*t27+t232*t653
      t661 = 0.634682060977037D-1*t164+0.2173290372447189D-1*t163*t159
      t664 = t151*t138
      t669 = 0.1712109500228824D0*t664*t142+0.5862637881547585D-1*t304
     #*t159
      t672 = 0.2697586091519874D1*t661*t173-0.2697586091519874D1*t303
     #*t669
      t674 = t137*t672*t327
      t675 = 0.2473556743557577D-1*t674
      t676 = t142*t198
      t677 = t191*t676
      t678 = 0.1D1*t677
      t679 = t190*t137
      t681 = sigma*t336*t198
      t682 = t679*t681
      t683 = 0.261211729852336D1*t682
      t685 = rho*(t675+t678-t683)
      vsigmaaa(i) = 0.572D0*t5*t655+t685
      vsigmaab(i) = 2.D0*t685
      t691 = 1/t33/t540/rhob
      t695 = 1/t45
      t696 = t547*t695
      t697 = t696*t46
      t699 = 0.426D-2*t38-0.2369618833300074D-2*t38*t42
     #+0.3899207790195271D-2*sigmabb*t691*t42-0.186D-5*t697
      t708 = 0.1278D-1*t695*t46*t51+0.1278D-1*t38*t564
     #+0.1998870022980422D-5*t697
      t710 = -1.D0*t699*t56+t558*t708
      vsigmabb(i) = 0.572D0*t34*t710+t685
      t716 = 0.2D1*t367
      t720 = 0.5495546528376876D-2*t346
      t721 = 0.1484134046134546D0*t434
      t724 = 0.1748148507797795D-2*t371
      t725 = 0.7599104707404789D-1*t395
      t726 = 0.3847322101863073D1*t419
      t727 = 0.3847322101863073D1*t422
      t728 = 0.7599104707404789D-1*t253+0.3847322101863073D1*t261
     #+0.1538928840745229D2*t264+t716+0.1484134046134546D0*t274
     #-0.3039641882961916D0*t258+0.4947113487115154D-1*t328+t720+t721
     #+0.2D1*t331-0.1044846919409344D2*t339-t724+t725+t726+t727
      t729 = 0.1538928840745229D2*t425
      t730 = 0.2249999913366216D1*t385
      t731 = 0.3039641882961916D0*t399
      t735 = 1/t7/t214
      t736 = sigmaaa*t735
      t743 = t213/t4/t214/t206
      t747 = t214**2
      t753 = t18**0.172D1
      t755 = t753*sigmaaa*t735
      t758 = 1/t4/t206
      t759 = t222*t758
      t764 = t227*t231
      t769 = t21/t230/t26
      t770 = t242**2
      t779 = 1/t237/t236
      t789 = 0.4947113487115154D-1*t486
      t790 = 0.2D1*t504
      t791 = 0.2D1*t507
      t792 = 0.4666666666666667D1*t511
      t793 = 0.2D1*t526
      t796 = t506*sigma
      t799 = t523**2
      t804 = t484**2
      t806 = t176**2
      t807 = 1/t806
      t810 = t433**2
      t814 = t135*t519
      t817 = 1/t97
      t821 = 1/t439
      t824 = 1/t101
      t830 = -0.1111111111111111D0*t817*t103*t107+0.6666666666666667D0
     #*t427*t821-0.1111111111111111D0*t824*t103*t107
     #-0.6666666666666667D0*t430*t821
      t843 = 1/t140/t106
      t850 = sigma*t155
      t860 = t169*t293
      t861 = t149*t433
      t862 = t450*t861
      t866 = t458*t449*t149
      t872 = 0.3039641882961916D0*t91*t393*t104*t336
      t876 = t364**2
      t878 = t65/t348/t73*t876*t365
      t879 = 0.2D1*t878
      t882 = 1/t353/t62*t107
      t884 = t354*t821
      t888 = 1/t71/t62*t107
      t890 = t343*t821
      t894 = 1/t69/t62*t107
      t896 = t358*t821
      t900 = 1/t63/t62*t107
      t902 = t361*t821
      t906 = t350*(-0.8309097827459833D0*t882+0.199418347859036D1*t884
     #-0.4945709824779306D0*t888+0.1483712947433792D1*t890
     #-0.2001071587498409D0*t894+0.8004286349993634D0*t896
     #-0.4215565168327908D-1*t900+0.2529339100996745D0*t902)*t365
      t907 = 0.1D1*t906
      t908 = t348**2
      t911 = t76**2
      t914 = t65/t908*t876/t911
      t915 = 0.1608197949869254D2*t914
      t927 = t410**2
      t943 = t403**2
      t946 = t123**2
      t951 = t888*t77
      t953 = t890*t77
      t957 = t345*t349*t364*t365
      t962 = 0.8806932620892844D-3*t888*t124-0.2642079786267853D-2
     #*t890*t124-0.8497974591333914D-1*t345*t404*t410*t411-0.2D1*t115
     #/t403/t120*t927*t411+0.1D1*t405*(-0.1544496508763151D1*t882
     #+0.3706791621031562D1*t884-0.854388052766047D0*t888
     #+0.2563164158298141D1*t890-0.4111834438919023D0*t894
     #+0.1644733775567609D1*t896-0.5346380647307093D-1*t900
     #+0.3207828388384256D0*t902)*t411+0.3216395899738507D2*t115/t943
     #*t927/t946-0.1831848842792292D-2*t951+0.5495546528376876D-2*t953
     #+0.8837926660346786D-1*t957+0.2D1*t878-0.1D1*t906
     #-0.1608197949869254D2*t914
      t965 = 0.1923661050931536D1*t962*t102*t108
      t966 = 1/t131
      t972 = 1/t133
      t978 = 0.4444444444444444D0*t966*t103*t107+0.2666666666666667D1
     #*t387*t821+0.4444444444444444D0*t972*t103*t107
     #-0.2666666666666667D1*t390*t821
      t981 = 0.3799552353702395D-1*t91*t978*t110
      t984 = 0.3847322101863073D1*t417*t393*t108
      t985 = t106*t105
      t986 = 1/t985
      t989 = 0.3847322101863073D2*t128*t104*t986
      t992 = 0.1923661050931536D1*t127*t978*t108
      t994 = 0.1538928840745229D2*t421*t424
      t995 = 0.1831848842792292D-2*t951
      t996 = 0.5495546528376876D-2*t953
      t997 = t872-t879+t907+t915+t965+t981+t984+t989+t992-t994+t995-t996
      t998 = 0.8837926660346786D-1*t957
      t999 = t373**2
      t1002 = t380**2
      t1004 = t89**2
      t1009 = 0.3330984244245859D2*t81/t999*t1002/t1004*t102*t110
      t1013 = 0.2249999913366216D1*t381*t382*t393*t110
      t1015 = 0.1538928840745229D2*t418*t424
      t1018 = 0.8999999653464862D1*t381*t383*t424
      t1020 = 0.5827161692659315D-3*t888*t370
      t1024 = 0.1748148507797795D-2*t345*t90*t393*t110
      t1025 = t106*t439
      t1030 = 0.6992594031191179D-2*t343/t1025*t369*t104
      t1035 = 0.5176049209143758D-1*t345*t374*t380*t382*t111
      t1041 = 0.2249999913366216D1*t81/t373/t86*t1002*t384
      t1053 = 0.1124999956683108D1*t375*(-0.1132974264373283D1*t882
     #+0.271913823449588D1*t884-0.4994648585728036D0*t888
     #+0.1498394575718411D1*t890-0.1075243117819161D0*t894
     #+0.4300972471276643D0*t896-0.4247805766949639D-1*t900
     #+0.2548683460169784D0*t902)*t384
      t1056 = 0.7599104707404789D0*t91*t397*t986
      t1058 = 0.1748148507797795D-2*t890*t370
      t1059 = -t998-t1009-t1013-t1015-t1018-t1020-t1024-t1030+t1035
     #+t1041-t1053-t1056+t1058
      t1063 = t444*t155
      t1066 = t145*t293
      t1071 = -0.4042761511756372D2*(t997+t1059)*t146
     #+0.2425656907053823D3*t1063*t433-0.4851313814107647D3*t1066*t810
     #+0.1212828453526912D3*t284*t830
      t1073 = t158*t1071*t149
      t1076 = t449**2
      t1077 = t158*t1076
      t1079 = dexp(-0.8085523023512745D2*t147)
      t1080 = t1077*t1079
      t1083 = t1077*t149
      t1087 = 1/t154/t136
      t1088 = t1087*t158
      t1089 = t1088*t810
      t1092 = t293*t458
      t1093 = t1092*t433
      t1096 = t294*t830
      t1101 = t155/t156/t985
      t1104 = 0.4936416029821399D0*t139*t843+0.3808092365862222D0*t850
     #*t142*t810+0.5923699235785679D0*t276*t441*t433
     #-0.1269364121954074D0*t276*t142*t830+0.8693161489788758D-1*t860
     #*t862+0.1014202173808688D0*t280*t866-0.1086645186223595D-1*t280
     #*t1073+0.2173290372447189D-1*t317*t1080-0.1086645186223595D-1
     #*t280*t1083+0.2173290372447189D0*t153*t1089+0.4056808695234754D0
     #*t153*t1093-0.4346580744894379D-1*t153*t1096
     #+0.2873572825791284D0*t153*t1101
      t1107 = t462*t302
      t1112 = t162/t301/t172
      t1113 = t481**2
      t1116 = t167**2
      t1119 = 1/t1116*t152*t155
      t1124 = t316*t293
      t1135 = t304*t146
      t1139 = t142*t1076
      t1143 = t315*sigma
      t1144 = t1143*t138
      t1151 = t146*t441
      t1158 = t155*t142
      t1174 = 0.1758791364464276D0*t1119*t1080+0.5862637881547585D0
     #*t169*t1089+0.4690110305238068D0*t1124*t862-0.1712109500228824D0
     #*t305*t142*t1071*t149+0.7989844334401178D0*t305*t441*t449*t149
     #+0.6848438000915295D0*t1135*t465*t861-0.1712109500228824D0*t305
     #*t1139*t149+0.3424219000457648D0*t1144*t1139*t1079
     #-0.3424219000457648D0*t163*t310*t830+0.1597968866880236D1*t163
     #*t1151*t433+0.1331640722400196D1*t163*t138*t843
     #+0.1027265700137294D1*t163*t1158*t810-0.5862637881547585D-1*t317
     #*t1073+0.547179535611108D0*t317*t866-0.5862637881547585D-1*t317
     #*t1083-0.1172527576309517D0*t169*t1096+0.1094359071222216D1*t169
     #*t1093+0.7751710087824029D0*t169*t1101
      t1194 = t499**2
      t1212 = t135*t177
      s2 = -0.4666666666666667D1*t506*t510+0.2D1*t796*t525+0.1D1*t513
     #*t142*t799*t198-0.2473556743557577D-1*t137*t804*t807+0.1D1*t513
     #*t142*(-0.522423459704672D1*t810*t194*sigma+0.2786258451758251D2
     #*t814*t515-0.522423459704672D1*t514*sigma*t830
     #-0.2554070247445063D2*t136*t158*sigma)*t198
      s1 = s2+0.7777777777777778D1*t191*sigma*t843*t198
     #+0.2473556743557577D-1*t137*(0.2697586091519874D1*t1104*t173
     #-0.5395172183039748D1*t1107*t481+0.5395172183039748D1*t1112
     #*t1113-0.2697586091519874D1*t303*t1174)*t327+0.1D1*(0.1D-2*(
     #-0.3207349893614542D1*t888+0.9622049680843627D1*t890
     #-0.6318986292200858D-3*t900+0.3791391775320515D-2*t902)*t187
     #-0.2D-2*t490*t494*t499+0.2D-2*t182/t493/t186*t1194-0.1D-2*t495*(
     #-0.1202514962692326D1*t888+0.3607544888076978D1*t890
     #-0.4036488739909061D-1*t900+0.2421893243945437D0*t902
     #+0.3527987623518044D-1*t821))*t135*t199+t872+0.1D1*t190*t830*t199
      t1215 = s1-t879+t907+t915+t965+t981+t984+t989+t992-t994
     #+0.1484134046134546D0*t1212*t810
      t1218 = t136*t484
      t1219 = t327*t433
      t1235 = -t1020-t1024-t1030+t1035+t1041-t1053-t1056+t1058+0.2D1
     #*t502*t433*t199+0.2D1*t503*sigma*t525-0.4666666666666667D1*t503
     #*t510
      t1238 = rho*(t1215+t995-t996-t998+0.7420670230672731D-1*t266
     #*t830+0.1484134046134546D0*t1218*t1219-0.4666666666666667D1*t513
     #*t441*t523*t198-t1009-t1013-t1015-t1018+t1235)
      t1242 = 0.8740742538988973D-3*t345*t90*t251*t110
      t1253 = -0.4444444444444444D0*t966*t93*t821-0.1333333333333333D1
     #*t96*t344-0.4444444444444444D0*t972*t93*t821
     #+0.1333333333333333D1*t100*t344
      t1256 = 0.3799552353702395D-1*t91*t1253*t110
      t1259 = 0.1923661050931536D1*t417*t251*t108
      t1262 = t343*t986*t369*t255
      t1263 = 0.3496297015595589D-2*t1262
      t1267 = 0.1124999956683108D1*t381*t382*t251*t110
      t1268 = t327*t273
      t1273 = t91*t393*t255*t107
      t1274 = 0.1519820941480958D0*t1273
      t1278 = 0.1519820941480958D0*t91*t251*t104*t336
      t1280 = t91*t256*t336
      t1281 = 0.6079283765923831D0*t1280
      t1282 = t418*t263
      t1283 = 0.7694644203726145D1*t1282
      t1286 = 0.1923661050931536D1*t127*t1253*t108
      t1287 = t421*t263
      t1288 = 0.7694644203726145D1*t1287
      t1290 = 0.7694644203726145D1*t260*t424
      t1292 = t128*t255*t336
      t1293 = 0.3077857681490458D2*t1292
      t1294 = -t1242+t1256+t1259+t1263-t1267+0.7420670230672731D-1
     #*t1218*t1268-t1274+t1278+t1281+t1283+t1286+t1288-t1290-t1293
      t1295 = t136*t325
      t1297 = 0.7420670230672731D-1*t1295*t1219
      t1298 = t433*t273
      t1300 = 0.1484134046134546D0*t1212*t1298
      t1311 = 0.1111111111111111D0*t817*t93*t821-0.3333333333333333D0
     #*t267*t344+0.1111111111111111D0*t824*t93*t821
     #+0.3333333333333333D0*t270*t344
      t1313 = 0.7420670230672731D-1*t266*t1311
      t1316 = 0.2473556743557577D-1*t485*t807*t325
      t1331 = t436*t273
      t1340 = t1079*t287
      t1341 = t450*t1340
      t1344 = t149*t273
      t1345 = t450*t1344
      t1349 = t381*t383*t263
      t1350 = 0.4499999826732431D1*t1349
      t1351 = -t1242+t1263-t1267+t1350+t1256-t1274+t1278+t1281+t1259
     #+t1283+t1286+t1288-t1290-t1293
      t1356 = t281*t155
      t1363 = -0.4042761511756372D2*t1351*t146+0.1212828453526912D3
     #*t1063*t273+0.1212828453526912D3*t1356*t433-0.4851313814107647D3
     #*t1066*t1298+0.1212828453526912D3*t284*t1311
      t1365 = t158*t1363*t149
      t1368 = t287*t149
      t1369 = t450*t1368
      t1372 = t158*t433
      t1373 = t1372*t1368
      t1376 = t153*t1087
      t1377 = t1372*t273
      t1380 = t294*t1311
      t1384 = t458*t287*t149
      t1387 = t1092*t273
      t1390 = 0.3808092365862222D0*t850*t1331-0.1269364121954074D0
     #*t276*t142*t1311+0.296184961789284D0*t276*t441*t273
     #+0.2173290372447189D-1*t317*t1341+0.4346580744894379D-1*t860
     #*t1345-0.1086645186223595D-1*t280*t1365-0.1086645186223595D-1
     #*t280*t1369+0.4346580744894379D-1*t860*t1373
     #+0.2173290372447189D0*t1376*t1377-0.4346580744894379D-1*t153
     #*t1380+0.5071010869043442D-1*t280*t1384+0.2028404347617377D0
     #*t153*t1387
      t1395 = t298*t302
      t1417 = t163*t155
      t1440 = t169*t1087
      t1449 = 0.3424219000457648D0*t1144*t465*t1340
     #+0.3424219000457648D0*t1135*t465*t1344-0.1712109500228824D0*t305
     #*t142*t1363*t149-0.1712109500228824D0*t305*t465*t1368
     #+0.3424219000457648D0*t1135*t436*t1368+0.1027265700137294D1
     #*t1417*t1331-0.3424219000457648D0*t163*t310*t1311
     #+0.3994922167200589D0*t305*t441*t287*t149+0.7989844334401178D0
     #*t163*t1151*t273+0.1758791364464276D0*t1119*t1341
     #+0.2345055152619034D0*t1124*t1345-0.5862637881547585D-1*t317
     #*t1365-0.5862637881547585D-1*t317*t1369+0.2345055152619034D0
     #*t1124*t1373+0.5862637881547585D0*t1440*t1377
     #-0.1172527576309517D0*t169*t1380+0.273589767805554D0*t317*t1384
     #+0.547179535611108D0*t169*t1387
      t1455 = 0.2473556743557577D-1*t137*(0.2697586091519874D1*t1390
     #*t173-0.2697586091519874D1*t1107*t322-0.2697586091519874D1*t1395
     #*t481+0.5395172183039748D1*t1112*t481*t322-0.2697586091519874D1
     #*t303*t1449)*t327
      t1456 = t330*sigma
      t1458 = 0.1D1*t1456*t525
      t1459 = t336*t523
      t1460 = t273*t198
      t1463 = 0.522423459704672D1*t334*t1459*t1460
      t1466 = 0.1D1*t502*t273*t199
      t1468 = 0.2333333333333333D1*t330*t510
      t1471 = t334*t986*t273*t198
      t1475 = 0.1D1*t190*t1311*t199
      t1477 = t502*t136*t152
      t1479 = 0.522423459704672D1*t1477*t338
      t1480 = t506*t152
      t1481 = t336*t135
      t1483 = t1480*t1481*t1460
      t1485 = t1297+t1300+t1313-t1316+0.1D1*t513*t142*(
     #-0.522423459704672D1*t273*t194*t515-0.522423459704672D1*t514
     #*sigma*t1311+0.1393129225879125D2*t814*sigma*t273)*t198+t1455
     #+t1458-t1463+t1466-t1468+0.1218988072644235D2*t1471+t1475-t1479
     #-0.522423459704672D1*t1483+t1350
      t1487 = rho*(t1294+t1485)
      t1494 = t1297+t1300+t1313-t1316+t1455+t1458-t1463+t1466-t1468
     #+0.261211729852336D2*t1471+t1475-t1479-0.522423459704672D1*t334
     #*t336*t1311*t198-0.1044846919409344D2*t1483+t1350
      t1496 = rho*(t1294+t1494)
      t1504 = 0.4444444444444444D0*t966*t344+0.4444444444444444D0*t972
     #*t344
      t1507 = 0.3799552353702395D-1*t91*t1504*t110
      t1510 = t91*t251*t255*t107
      t1511 = 0.3039641882961916D0*t1510
      t1514 = t91*t102*t103*t107
      t1515 = 0.4559462824442873D0*t1514
      t1518 = 0.1923661050931536D1*t127*t1504*t108
      t1519 = t260*t263
      t1520 = 0.1538928840745229D2*t1519
      t1522 = t128*t103*t107
      t1523 = 0.2308393261117844D2*t1522
      t1524 = t273**2
      t1533 = -0.1111111111111111D0*t817*t344-0.1111111111111111D0
     #*t824*t344
      t1535 = 0.7420670230672731D-1*t266*t1533
      t1541 = 0.1269364121954074D0*t276*t142*t1533
      t1542 = t287**2
      t1543 = t158*t1542
      t1544 = t1543*t1079
      t1547 = t288*t1344
      t1558 = 0.1212828453526912D3*t284*t1533
      t1559 = -0.4042761511756372D2*(t1507-t1511-t1515+t1518+t1520
     #+t1523)*t146+0.2425656907053823D3*t1356*t273
     #-0.4851313814107647D3*t1066*t1524+t1558
      t1561 = t158*t1559*t149
      t1564 = t1543*t149
      t1567 = t1088*t1524
      t1570 = t294*t1533
      t1572 = 0.4346580744894379D-1*t153*t1570
      t1578 = t322**2
      t1581 = t142*t1542
      t1600 = 0.3424219000457648D0*t163*t310*t1533
      t1612 = 0.1172527576309517D0*t169*t1570
      t1613 = 0.3424219000457648D0*t1144*t1581*t1079
     #+0.6848438000915295D0*t1135*t306*t1344-0.1712109500228824D0*t305
     #*t142*t1559*t149-0.1712109500228824D0*t305*t1581*t149
     #+0.1027265700137294D1*t163*t1158*t1524-t1600
     #+0.1758791364464276D0*t1119*t1544+0.4690110305238068D0*t1124
     #*t1547-0.5862637881547585D-1*t317*t1561-0.5862637881547585D-1
     #*t317*t1564+0.5862637881547585D0*t169*t1567-t1612
      t1620 = t325**2
      t1626 = 0.1D1*t190*t1533*t199
      t1629 = t1481*t198
      t1635 = 0.522423459704672D1*t334*t336*t1533*t198
      t1637 = t679*t152*sigma
      t1639 = 1/t156/t1025
      t1644 = t1507-t1511-t1515+t1518+t1520+t1523+0.1484134046134546D0
     #*t1212*t1524+0.1484134046134546D0*t1295*t1268+t1535
     #+0.2473556743557577D-1*t137*(0.2697586091519874D1*
     #(0.3808092365862222D0*t850*t142*t1524-t1541
     #+0.2173290372447189D-1*t317*t1544+0.8693161489788758D-1*t860
     #*t1547-0.1086645186223595D-1*t280*t1561-0.1086645186223595D-1
     #*t280*t1564+0.2173290372447189D0*t153*t1567-t1572)*t173
     #-0.5395172183039748D1*t1395*t322+0.5395172183039748D1*t1112
     #*t1578-0.2697586091519874D1*t303*t1613)*t327
     #-0.2473556743557577D-1*t137*t1620*t807+t1626
     #-0.1567270379114016D2*t190*t1524*t152*t1629-t1635
     #+0.272926271249799D2*t1637*t1639*t1524*t198
      t1646 = -t729-t730+t731+0.1525333333333333D1*t4*t244+0.572D0*t5*
     #(-1.D0*(0.4165333333333333D-1*t736-0.2316960637004517D-1*t736
     #*t13+0.9358098696468651D-1*t743*t13-0.4562593008900494D-1*t213
     #*sigmaaa/t747/t6*t13-0.1798826666666667D-4*t755
     #-0.1157333333333333D-4*t759)*t27+2.D0*t764*t242-2.D0*t769*t770
     #+t232*(0.7952D-1*t16*t758*t22+0.1704D0*t736*t238-0.4544D-1*t743
     #*t779+0.1933129408891288D-4*t755+0.1243741347632263D-4*t759))
     #+t789+t790+t791-t792+t793+t1238+t1487+t1496+0.2542222222222222D0
     #/t7*t30+rho*t1644
      v2rhoa2(i) = t728+t1646
      t1651 = -0.1538928840745229D2*t264+t716+0.3039641882961916D0
     #*t258+t720+t721-t724+t725+t726+t727-t729-t730+t731+t789
     #+0.7599104707404789D-1*t575+0.3847322101863073D1*t579
      t1653 = 0.3496297015595589D-2*t1262
      t1654 = 0.1519820941480958D0*t1273
      t1655 = t327*t582
      t1658 = -t1253
      t1661 = 0.3799552353702395D-1*t91*t1658*t110
      t1664 = 0.1923661050931536D1*t417*t573*t108
      t1665 = t433*t582
      t1670 = 0.1923661050931536D1*t127*t1658*t108
      t1671 = 0.6079283765923831D0*t1280
      t1672 = 0.7694644203726145D1*t1282
      t1673 = 0.7694644203726145D1*t1287
      t1674 = 0.3077857681490458D2*t1292
      t1675 = -t1311
      t1681 = 0.8740742538988973D-3*t345*t90*t573*t110
      t1685 = 0.1519820941480958D0*t91*t573*t104*t336
      t1686 = -t1653+t1654+0.7420670230672731D-1*t1218*t1655+t1661
     #+t1664+0.1484134046134546D0*t1212*t1665+t1670-t1671-t1672-t1673
     #+t1674+0.7420670230672731D-1*t266*t1675-t1681+t1685
      t1690 = 0.1124999956683108D1*t381*t382*t573*t110
      t1691 = t582*t198
      t1692 = t1481*t1691
      t1693 = t1480*t1692
      t1697 = 0.1D1*t190*t1675*t199
      t1700 = t334*t986*t582*t198
      t1703 = 0.2333333333333333D1*t622*t510
      t1706 = 0.522423459704672D1*t334*t1459*t1691
      t1707 = t807*t618
      t1709 = 0.2473556743557577D-1*t485*t1707
      t1714 = t436*t582
      t1723 = t1079*t593
      t1724 = t450*t1723
      t1727 = t149*t582
      t1728 = t450*t1727
      t1731 = 0.4499999826732431D1*t1349
      t1733 = 0.7694644203726145D1*t578*t424
      t1734 = -t1681-t1653-t1690-t1731+t1661+t1654+t1685-t1671+t1664
     #-t1672+t1670-t1673-t1733+t1674
      t1739 = t588*t155
      t1746 = -0.4042761511756372D2*t1734*t146+0.1212828453526912D3
     #*t1063*t582+0.1212828453526912D3*t1739*t433-0.4851313814107647D3
     #*t1066*t1665+0.1212828453526912D3*t284*t1675
      t1748 = t158*t1746*t149
      t1751 = t593*t149
      t1752 = t450*t1751
      t1755 = t1372*t1751
      t1758 = t1372*t582
      t1761 = t294*t1675
      t1765 = t458*t593*t149
      t1768 = t1092*t582
      t1771 = 0.3808092365862222D0*t850*t1714-0.1269364121954074D0
     #*t276*t142*t1675+0.296184961789284D0*t276*t441*t582
     #+0.2173290372447189D-1*t317*t1724+0.4346580744894379D-1*t860
     #*t1728-0.1086645186223595D-1*t280*t1748-0.1086645186223595D-1
     #*t280*t1752+0.4346580744894379D-1*t860*t1755
     #+0.2173290372447189D0*t1376*t1758-0.4346580744894379D-1*t153
     #*t1761+0.5071010869043442D-1*t280*t1765+0.2028404347617377D0
     #*t153*t1768
      t1776 = t601*t302
      t1828 = 0.3424219000457648D0*t1144*t465*t1723
     #+0.3424219000457648D0*t1135*t465*t1727-0.1712109500228824D0*t305
     #*t142*t1746*t149-0.1712109500228824D0*t305*t465*t1751
     #+0.3424219000457648D0*t1135*t436*t1751+0.1027265700137294D1
     #*t1417*t1714-0.3424219000457648D0*t163*t310*t1675
     #+0.3994922167200589D0*t305*t441*t593*t149+0.7989844334401178D0
     #*t163*t1151*t582+0.1758791364464276D0*t1119*t1724
     #+0.2345055152619034D0*t1124*t1728-0.5862637881547585D-1*t317
     #*t1748-0.5862637881547585D-1*t317*t1752+0.2345055152619034D0
     #*t1124*t1755+0.5862637881547585D0*t1440*t1758
     #-0.1172527576309517D0*t169*t1761+0.273589767805554D0*t317*t1765
     #+0.547179535611108D0*t169*t1768
      t1834 = 0.2473556743557577D-1*t137*(0.2697586091519874D1*t1771
     #*t173-0.2697586091519874D1*t1107*t615-0.2697586091519874D1*t1776
     #*t481+0.5395172183039748D1*t1112*t481*t615-0.2697586091519874D1
     #*t303*t1828)*t327
      t1835 = t136*t618
      t1837 = 0.7420670230672731D-1*t1835*t1219
      t1839 = 0.522423459704672D1*t1477*t626
      t1840 = t622*sigma
      t1842 = 0.1D1*t1840*t525
      t1845 = 0.1D1*t502*t582*t199
      t1846 = -t1690-0.1044846919409344D2*t1693+t1697
     #+0.261211729852336D2*t1700-t1703-t1706-t1709-0.522423459704672D1
     #*t334*t336*t1675*t198+t1834-t1733+t1837-t1839+t1842-t1731+t1845
      t1848 = rho*(t1686+t1846)
      t1868 = -t1690-0.522423459704672D1*t1693+t1697
     #+0.1218988072644235D2*t1700-t1703+0.1D1*t513*t142*(
     #-0.522423459704672D1*t582*t194*t515-0.522423459704672D1*t514
     #*sigma*t1675+0.1393129225879125D2*t814*sigma*t582)*t198-t1706
     #-t1709+t1834-t1733+t1837-t1839+t1842-t1731+t1845
      t1870 = rho*(t1686+t1868)
      t1878 = t91*t573*t255*t107
      t1879 = 0.3039641882961916D0*t1878
      t1880 = t578*t263
      t1881 = 0.1538928840745229D2*t1880
      t1882 = t582**2
      t1890 = t593**2
      t1891 = t158*t1890
      t1892 = t1891*t1079
      t1895 = t594*t1727
      t1905 = -0.4042761511756372D2*(t1507+t1879-t1515+t1518-t1881
     #+t1523)*t146+0.2425656907053823D3*t1739*t582
     #-0.4851313814107647D3*t1066*t1882+t1558
      t1907 = t158*t1905*t149
      t1910 = t1891*t149
      t1913 = t1088*t1882
      t1921 = t615**2
      t1924 = t142*t1890
      t1951 = 0.3424219000457648D0*t1144*t1924*t1079
     #+0.6848438000915295D0*t1135*t604*t1727-0.1712109500228824D0*t305
     #*t142*t1905*t149-0.1712109500228824D0*t305*t1924*t149
     #+0.1027265700137294D1*t163*t1158*t1882-t1600
     #+0.1758791364464276D0*t1119*t1892+0.4690110305238068D0*t1124
     #*t1895-0.5862637881547585D-1*t317*t1907-0.5862637881547585D-1
     #*t317*t1910+0.5862637881547585D0*t169*t1913-t1612
      t1958 = t618**2
      t1970 = t1507+t1879-t1515+t1518-t1881+t1523+0.1484134046134546D0
     #*t1212*t1882+0.1484134046134546D0*t1835*t1655+t1535
     #+0.2473556743557577D-1*t137*(0.2697586091519874D1*
     #(0.3808092365862222D0*t850*t142*t1882-t1541
     #+0.2173290372447189D-1*t317*t1892+0.8693161489788758D-1*t860
     #*t1895-0.1086645186223595D-1*t280*t1907-0.1086645186223595D-1
     #*t280*t1910+0.2173290372447189D0*t153*t1913-t1572)*t173
     #-0.5395172183039748D1*t1776*t615+0.5395172183039748D1*t1112
     #*t1921-0.2697586091519874D1*t303*t1951)*t327
     #-0.2473556743557577D-1*t137*t1958*t807+t1626
     #-0.1567270379114016D2*t190*t1882*t152*t1629-t1635
     #+0.272926271249799D2*t1637*t1639*t1882*t198
      t1973 = 1/t36/t540
      t1974 = sigmabb*t1973
      t1981 = t539/t33/t540/t532
      t1985 = t540**2
      t1991 = t47**0.172D1
      t1993 = t1991*sigmabb*t1973
      t1996 = 1/t33/t532
      t1997 = t548*t1996
      t2002 = t553*t557
      t2007 = t50/t556/t55
      t2008 = t568**2
      t2017 = 1/t563/t562
      t2027 = t790+t791-t792+t793+0.1484134046134546D0*t583+t1238
     #+t1848+0.4947113487115154D-1*t620-0.1044846919409344D2*t627
     #+0.2D1*t623+t1870+0.1525333333333333D1*t33*t570
     #+0.2542222222222222D0/t36*t59+rho*t1970+0.572D0*t34*(-1.D0*
     #(0.4165333333333333D-1*t1974-0.2316960637004517D-1*t1974*t42
     #+0.9358098696468651D-1*t1981*t42-0.4562593008900494D-1*t539
     #*sigmabb/t1985/t35*t42-0.1798826666666667D-4*t1993
     #-0.1157333333333333D-4*t1997)*t56+2.D0*t2002*t568-2.D0*t2007
     #*t2008+t558*(0.7952D-1*t45*t1996*t51+0.1704D0*t1974*t564
     #-0.4544D-1*t1981*t2017+0.1933129408891288D-4*t1993
     #+0.1243741347632263D-4*t1997))
      v2rhob2(i) = t1651+t2027
      t2029 = 0.3799552353702395D-1*t253+t262+t716+t275+t329+t720+t721
     #+t332-t340-t724+t725+t726+t727-t729-t730+t731
      t2030 = -t1504
      t2033 = 0.3799552353702395D-1*t91*t2030*t110
      t2034 = 0.1519820941480958D0*t1510
      t2035 = 0.1519820941480958D0*t1878
      t2036 = 0.4559462824442873D0*t1514
      t2039 = 0.1923661050931536D1*t127*t2030*t108
      t2040 = 0.7694644203726145D1*t1519
      t2041 = 0.7694644203726145D1*t1880
      t2042 = 0.2308393261117844D2*t1522
      t2043 = t273*t582
      t2048 = -t1533
      t2053 = t277*t582
      t2059 = t288*t1723
      t2062 = t288*t1727
      t2076 = -0.4042761511756372D2*(t2033+t2034-t2035+t2036+t2039
     #-t2040+t2041-t2042)*t146+0.1212828453526912D3*t1356*t582
     #+0.1212828453526912D3*t1739*t273-0.4851313814107647D3*t1066
     #*t2043+0.1212828453526912D3*t284*t2048
      t2078 = t158*t2076*t149
      t2081 = t288*t1751
      t2084 = t158*t273
      t2085 = t2084*t1751
      t2088 = t2084*t582
      t2091 = t294*t2048
      t2139 = 0.3424219000457648D0*t1144*t306*t1723
     #+0.3424219000457648D0*t1135*t306*t1727-0.1712109500228824D0*t305
     #*t142*t2076*t149-0.1712109500228824D0*t305*t306*t1751
     #+0.3424219000457648D0*t1135*t277*t1751+0.1027265700137294D1
     #*t1417*t2053-0.3424219000457648D0*t163*t310*t2048
     #+0.1758791364464276D0*t1119*t2059+0.2345055152619034D0*t1124
     #*t2062-0.5862637881547585D-1*t317*t2078-0.5862637881547585D-1
     #*t317*t2081+0.2345055152619034D0*t1124*t2085
     #+0.5862637881547585D0*t1440*t2088-0.1172527576309517D0*t169*t2091
      t2158 = t1639*t273
      s1 = t2033+t2034-t2035+t2036+t2039-t2040+t2041-t2042
     #+0.1484134046134546D0*t1212*t2043
      s2 = s1+0.7420670230672731D-1*t1835*t1268+0.7420670230672731D-1
     #*t266*t2048+0.7420670230672731D-1*t1295*t1655
     #+0.2473556743557577D-1*t137*(0.2697586091519874D1*
     #(0.3808092365862222D0*t850*t2053-0.1269364121954074D0*t276*t142
     #*t2048+0.2173290372447189D-1*t317*t2059+0.4346580744894379D-1
     #*t860*t2062-0.1086645186223595D-1*t280*t2078
     #-0.1086645186223595D-1*t280*t2081+0.4346580744894379D-1*t860
     #*t2085+0.2173290372447189D0*t1376*t2088-0.4346580744894379D-1
     #*t153*t2091)*t173-0.2697586091519874D1*t1395*t615
     #-0.2697586091519874D1*t1776*t322+0.5395172183039748D1*t1112*t322
     #*t615-0.2697586091519874D1*t303*t2139)*t327
      t2162 = s2-0.2473556743557577D-1*t326*t1707+0.1D1*t190*t2048
     #*t199-0.1567270379114016D2*t330*t152*t1692-0.522423459704672D1
     #*t334*t336*t2048*t198+0.272926271249799D2*t1637*t2158*t1691
      t2169 = rho*t2162+t789+0.3799552353702395D-1*t575+t580+t790+t791
     #-t792+t793+t584+t1238+0.5D0*t1848+t621-t628+t624+0.5D0*t1487
     #+0.5D0*t1870+0.5D0*t1496
      v2rhoab(i) = t2029+t2169
      t2175 = sigmaaa*t217
      t2183 = t753*t208
      t2185 = t641*t224
      t2191 = t644*t231
      t2210 = t136*t672
      t2214 = t304*t155
      t2224 = t661*t302
      t2230 = t168*t138
      t2233 = t151*t146
      t2236 = t1143*t155
      t2248 = t807*t672
      t2254 = t336*t136*t198
      t2258 = t190*t154*t152
      t2263 = rho*(0.7420670230672731D-1*t2210*t1268
     #+0.2473556743557577D-1*t137*(0.2697586091519874D1*(
     #-0.1269364121954074D0*t311-0.2173290372447189D-1*t2214*t289
     #-0.8693161489788758D-1*t163*t295)*t173-0.2697586091519874D1
     #*t1395*t669-0.2697586091519874D1*t2224*t322+0.5395172183039748D1
     #*t1112*t322*t669-0.2697586091519874D1*t303*(
     #-0.1712109500228824D0*t2230*t307-0.3424219000457648D0*t2233*t277
     #-0.1172527576309517D0*t2236*t289-0.2345055152619034D0*t304*t295)
     #)*t327-0.2473556743557577D-1*t326*t2248+0.1D1*t330*t676
     #-0.130605864926168D2*t1456*t2254+0.1364631356248995D2*t2258
     #*t2158*t198)
      s1 = 0.7420670230672731D-1*t2210*t1219+0.2473556743557577D-1
     #*t137*(0.2697586091519874D1*(-0.1269364121954074D0*t469
     #-0.148092480894642D0*t472-0.2173290372447189D-1*t2214*t451
     #-0.8693161489788758D-1*t163*t454-0.1014202173808688D0*t163*t459)
     #*t173-0.2697586091519874D1*t1107*t669-0.2697586091519874D1*t2224
     #*t481+0.5395172183039748D1*t1112*t481*t669-0.2697586091519874D1
     #*t303*(-0.1712109500228824D0*t2230*t466-0.3424219000457648D0
     #*t2233*t436-0.3994922167200589D0*t664*t441-0.1172527576309517D0
     #*t2236*t451-0.2345055152619034D0*t304*t454-0.273589767805554D0
     #*t304*t459))*t327-0.2473556743557577D-1*t485*t2248+0.1D1*t503
     #*t676-0.261211729852336D1*t502*t137*t681+0.1D1*t506*t676
      t2335 = s1-0.261211729852336D1*t796*t2254-0.2333333333333333D1
     #*t191*t441*t198+0.6094940363221173D1*t679*sigma*t986*t198+0.1D1
     #*t191*t525+0.1D1*t513*t142*(-0.522423459704672D1*t514*t433
     #+0.6965646129395627D1*t520)*t198-0.261211729852336D1*t679*sigma
     #*t1459*t198
      t2336 = rho*t2335
      v2rhoasigmaaa(i) = 0.7626666666666667D0*t4*t655+0.572D0*t5*(
     #-1.D0*(-0.1136D-1*t208+0.6318983555466863D-2*t208*t13
     #-0.3119366232156217D-1*t2175*t13+0.1710972378337685D-1*t213/t747
     #/rhoa*t13+0.67456D-5*t2183+0.248D-5*t2185)*t27+t764*t653+t2191
     #*t242-2.D0*t769*t242*t653+t232*(-0.1704D-1*t640*t224*t22
     #-0.5112D-1*t208*t238+0.1704D-1*t2175*t779-0.7249235283342332D-5
     #*t2183-0.2665160030640563D-5*t2185))+t2263+t675+t678-t683+t2336
      t2338 = 0.4947113487115154D-1*t674
      t2339 = 0.2D1*t677
      t2340 = 0.522423459704672D1*t682
      t2341 = 2.D0*t2336
      v2rhoasigmaab(i) = 2.D0*t2263+t2338+t2339-t2340+t2341
      v2rhoasigmabb(i) = t2263+t675+t678-t683+t2336
      t2385 = rho*(0.7420670230672731D-1*t2210*t1655
     #+0.2473556743557577D-1*t137*(0.2697586091519874D1*(
     #-0.1269364121954074D0*t608-0.2173290372447189D-1*t2214*t595
     #-0.8693161489788758D-1*t163*t598)*t173-0.2697586091519874D1
     #*t1776*t669-0.2697586091519874D1*t2224*t615+0.5395172183039748D1
     #*t1112*t615*t669-0.2697586091519874D1*t303*(
     #-0.1712109500228824D0*t2230*t605-0.3424219000457648D0*t2233*t585
     #-0.1172527576309517D0*t2236*t595-0.2345055152619034D0*t304*t598)
     #)*t327-0.2473556743557577D-1*t619*t2248+0.1D1*t622*t676
     #-0.130605864926168D2*t1840*t2254+0.1364631356248995D2*t2258
     #*t1639*t582*t198)
      v2rhobsigmaaa(i) = t2385+t675+t678-t683+t2336
      v2rhobsigmaab(i) = 2.D0*t2385+t2338+t2339-t2340+t2341
      t2392 = sigmabb*t543
      t2400 = t1991*t534
      t2402 = t696*t550
      t2408 = t699*t557
      v2rhobsigmabb(i) = 0.7626666666666667D0*t33*t710+0.572D0*t34*(
     #-1.D0*(-0.1136D-1*t534+0.6318983555466863D-2*t534*t42
     #-0.3119366232156217D-1*t2392*t42+0.1710972378337685D-1*t539
     #/t1985/rhob*t42+0.67456D-5*t2400+0.248D-5*t2402)*t56+t2002*t708
     #+t2408*t568-2.D0*t2007*t568*t708+t558*(-0.1704D-1*t695*t550*t51
     #-0.5112D-1*t534*t564+0.1704D-1*t2392*t2017-0.7249235283342332D-5
     #*t2400-0.2665160030640563D-5*t2402))+t2385+t675+t678-t683+t2336
      t2433 = 1/sigmaaa
      t2435 = t753*t2433*t9
      t2438 = 1/t16/sigmaaa
      t2440 = t221*t2438*t17
      t2447 = t653**2
      t2471 = t669**2
      t2482 = t672**2
      t2495 = rho*(0.2473556743557577D-1*t137*(0.5862637881547585D-1
     #*t151*t155*t158*t173-0.5395172183039748D1*t2224*t669
     #+0.5395172183039748D1*t1112*t2471-0.1581497040888031D0*t303*t168
     #*t155*t158)*t327-0.2473556743557577D-1*t137*t2482*t807
     #-0.522423459704672D1*t679*t336*t198+0.6823156781244976D1*t190
     #*t292*sigma*t1639*t198)
      v2sigmaaa2(i) = 0.572D0*t5*(-1.D0*(0.7798415580390543D-2*t636
     #*t13-0.6416146418766319D-2*sigmaaa/t747*t13-0.25296D-5*t2435
     #+0.93D-6*t2440)*t27+2.D0*t2191*t653-2.D0*t769*t2447+t232*(
     #-0.639D-2*t2438*t17*t22+0.639D-2*t2433*t9*t238-0.639D-2*t636
     #*t779+0.2718463231253374D-5*t2435-0.9994350114902112D-6*t2440))
     #+t2495
      v2sigmaaaab(i) = 2.D0*t2495
      v2sigmaaabb(i) = t2495
      v2sigmaab2(i) = 4.D0*v2sigmaaabb(i)
      v2sigmaabbb(i) = v2sigmaaaab(i)
      t2502 = 1/sigmabb
      t2504 = t1991*t2502*t38
      t2507 = 1/t45/sigmabb
      t2509 = t547*t2507*t46
      t2516 = t708**2
      v2sigmabb2(i) = 0.572D0*t34*(-1.D0*(0.7798415580390543D-2*t691
     #*t42-0.6416146418766319D-2*sigmabb/t1985*t42-0.25296D-5*t2504
     #+0.93D-6*t2509)*t56+2.D0*t2408*t708-2.D0*t2007*t2516+t558*(
     #-0.639D-2*t2507*t46*t51+0.639D-2*t2502*t38*t564-0.639D-2*t691
     #*t2017+0.2718463231253374D-5*t2504-0.9994350114902112D-6*t2509))
     #+v2sigmaaabb(i)
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      v2rhob2(i) = 0.0d0
      v2rhoab(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2rhoasigmaab(i) = 0.0d0
      v2rhoasigmabb(i) = 0.0d0
      v2rhobsigmaaa(i) = 0.0d0
      v2rhobsigmaab(i) = 0.0d0
      v2rhobsigmabb(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      v2sigmaab2(i) = 0.0d0
      v2sigmabb2(i) = 0.0d0
      v2sigmaaaab(i) = 0.0d0
      v2sigmaaabb(i) = 0.0d0
      v2sigmaabbb(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end
      
      
      subroutine rks_xc_mpw1k
     & (ideriv,npt,rhoa1,sigmaaa1,
     &  zk,vrhoa,vsigmaaa,
     &  v2rhoa2,v2rhoasigmaaa,v2sigmaaa2)
c
c     B.J. Lynch, P.L. Fast, M. Harris, D.G. Truhlar
c     Adiabatic connection for kinetics
c     J.Phys.Chem.A 104 (2000) 4811-4815
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt)
      REAL sigmaaa1(npt)
      REAL zk(npt),vrhoa(npt),vsigmaaa(npt)
      REAL v2rhoa2(npt),v2rhoasigmaaa(npt),v2sigmaaa2(npt)
      parameter(tol=1.0d-20)
      
      if(ideriv.eq.0) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t3 = t2*rho
      t4 = rho**2
      t5 = t2**2
      t8 = 1/t5/t4*sigma
      t11 = dexp(-0.2612068431013672D1*t8)
      t14 = dsqrt(sigma)
      t16 = t14/t3
      t17 = t16**0.372D1
      t21 = dlog(0.1259921049894873D1*t16+dsqrt(1+0.1587401051968199D1
     #*t16**2))
      t32 = 1/rho
      t33 = t32**(1.D0/3.D0)
      t36 = t32**(1.D0/6.D0)
      t39 = dsqrt(t32)
      t41 = t33**2
      t47 = dlog(1.D0+0.1608197949869254D2/(0.598255043577108D1*t36
     #+0.2225569421150687D1*t33+0.8004286349993634D0*t39
     #+0.1897004325747559D0*t41))
      t48 = (1.D0+0.1325688999052018D0*t33)*t47
      t51 = 1/t2/t4
      t55 = dexp(0.2513845706671277D1*t48)
      t56 = t55-1.D0
      t57 = 1/t56
      t58 = sigma**2
      t60 = t4**2
      t62 = 1/t5/t60
      t69 = t56**2
      t79 = dlog(1.D0+0.2697586091519874D1*(0.634682060977037D-1*sigma
     #*t51+0.1086645186223595D-1*t57*t58*t62)/(1.D0
     #+0.1712109500228824D0*t57*sigma*t51+0.2931318940773793D-1/t69
     #*t58*t62))
      t94 = dexp(-0.261211729852336D1*t8)
      zk(i) = 0.453996700862905D0*t3*(-0.9305257363491D0-1.D0*
     #(0.676232848138453D-2*t8-0.3761535428744195D-2*t8*t11
     #-0.2361985322859061D-5*t17)/(1.D0+0.3220358203531296D-1*t16*t21
     #+0.25383342239692D-5*t17))+rho*(-0.621814D-1*t48
     #+0.2473556743557577D-1*t79+0.1D1*(0.1D-2*(0.2568D1
     #+0.1443307452126544D2*t33+0.2843543831490386D-2*t41)/(1.D0
     #+0.5411317332115466D1*t33+0.1816419932959077D0*t41
     #+0.1763993811759022D-1*t32)-0.1853571428571429D-2)*sigma*t51*t94)
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t3 = t2*rho
      t4 = rho**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = t7*sigma
      t11 = dexp(-0.2612068431013672D1*t8)
      t14 = dsqrt(sigma)
      t15 = 1/t3
      t16 = t14*t15
      t17 = t16**0.372D1
      t19 = 0.676232848138453D-2*t8-0.3761535428744195D-2*t8*t11
     #-0.2361985322859061D-5*t17
      t21 = dlog(0.1259921049894873D1*t16+dsqrt(1+0.1587401051968199D1
     #*t16**2))
      t25 = 1.D0+0.3220358203531296D-1*t16*t21+0.25383342239692D-5*t17
      t26 = 1/t25
      t29 = -0.9305257363491D0-1.D0*t19*t26
      t32 = 1/rho
      t33 = t32**(1.D0/3.D0)
      t35 = 1.D0+0.1325688999052018D0*t33
      t36 = t32**(1.D0/6.D0)
      t39 = dsqrt(t32)
      t41 = t33**2
      t43 = 0.598255043577108D1*t36+0.2225569421150687D1*t33
     #+0.8004286349993634D0*t39+0.1897004325747559D0*t41
      t46 = 1.D0+0.1608197949869254D2/t43
      t47 = dlog(t46)
      t48 = t35*t47
      t49 = 0.621814D-1*t48
      t51 = 1/t2/t4
      t55 = dexp(0.2513845706671277D1*t48)
      t56 = t55-1.D0
      t57 = 1/t56
      t58 = sigma**2
      t59 = t57*t58
      t60 = t4**2
      t62 = 1/t5/t60
      t65 = 0.634682060977037D-1*sigma*t51+0.1086645186223595D-1*t59*t62
      t66 = t57*sigma
      t69 = t56**2
      t70 = 1/t69
      t71 = t70*t58
      t74 = 1.D0+0.1712109500228824D0*t66*t51+0.2931318940773793D-1
     #*t71*t62
      t75 = 1/t74
      t78 = 1.D0+0.2697586091519874D1*t65*t75
      t79 = dlog(t78)
      t80 = 0.2473556743557577D-1*t79
      t83 = 0.2568D1+0.1443307452126544D2*t33+0.2843543831490386D-2*t41
      t87 = 1.D0+0.5411317332115466D1*t33+0.1816419932959077D0*t41
     #+0.1763993811759022D-1*t32
      t88 = 1/t87
      t91 = 0.1D-2*t83*t88-0.1853571428571429D-2
      t92 = t91*sigma
      t94 = dexp(-0.261211729852336D1*t8)
      t95 = t51*t94
      t97 = 0.1D1*t92*t95
      zk(i) = 0.453996700862905D0*t3*t29+rho*(-t49+t80+t97)
      t102 = t4*rho
      t105 = 1/t5/t102*sigma
      t109 = t60*t4
      t115 = t16**0.272D1
      t117 = t115*t14*t51
      t122 = t25**2
      t124 = t19/t122
      t130 = dsqrt(1.D0+0.1587401051968199D1*t8)
      t131 = 1/t130
      t141 = 1/t4
      t142 = 1/t41*t141
      t143 = t142*t47
      t145 = t43**2
      t148 = t36**2
      t149 = t148**2
      t159 = 1/t33*t141
      t164 = t35/t145*(-0.99709173929518D0/t149/t36*t141
     #-0.7418564737168958D0*t142-0.4002143174996817D0/t39*t141
     #-0.1264669550498372D0*t159)/t46
      t167 = 1/t2/t102
      t172 = -0.1110859199549419D0*t143-0.4042761511756372D2*t164
      t174 = t62*t172*t55
      t177 = t60*rho
      t179 = 1/t5/t177
      t185 = t74**2
      t187 = t65/t185
      t188 = t70*sigma
      t206 = 1/t78
      t214 = t87**2
      s1 = 0.6053289344838734D0*t2*t29+0.2269983504314525D0*t3*(-1.D0*
     #(-0.3606575190071749D-1*t105+0.200615222866357D-1*t105*t11
     #-0.5240206904299834D-1*t58/t2/t109*t11+0.2343089440276188D-4
     #*t117)*t26+t124*(-0.8587621876083455D-1*t14*t51*t21
     #-0.1081972557021525D0*t105*t131-0.2518027550177446D-4*t117))-t49
      vrhoa(i) = s1+t80+t97+rho*(0.2747773264188438D-2*t143+0.1D1*t164
     #+0.2473556743557577D-1*(0.2697586091519874D1*(
     #-0.148092480894642D0*sigma*t167-0.1086645186223595D-1*t71*t174
     #-0.5071010869043442D-1*t59*t179)*t75-0.2697586091519874D1*t187*(
     #-0.1712109500228824D0*t188*t51*t172*t55-0.3994922167200589D0*t66
     #*t167-0.5862637881547585D-1/t69/t56*t58*t174-0.136794883902777D0
     #*t71*t179))*t206+0.1D1*(0.1D-2*(-0.4811024840421814D1*t142
     #-0.1895695887660258D-2*t159)*t88-0.1D-2*t83/t214*(
     #-0.1803772444038489D1*t142-0.1210946621972718D0*t159
     #-0.1763993811759022D-1*t141))*sigma*t95-0.2333333333333333D1*t92
     #*t167*t94+0.6965646129395627D1*t91*t58/t109*t94)
      t245 = 1/t14
      t247 = t115*t245*t15
      vsigmaaa(i) = 0.453996700862905D0*t3*(-1.D0*
     #(0.2704931392553812D-1*t7-0.1504614171497678D-1*t7*t11
     #+0.3930155178224876D-1*sigma/t2/t177*t11-0.1757317080207141D-4
     #*t247)*t26+t124*(0.6440716407062592D-1*t245*t15*t21
     #+0.8114794177661436D-1*t7*t131+0.1888520662633084D-4*t247))+4.D0
     #*rho*(0.2473556743557577D-1*(0.2697586091519874D1*
     #(0.634682060977037D-1*t51+0.2173290372447189D-1*t66*t62)*t75
     #-0.2697586091519874D1*t187*(0.1712109500228824D0*t57*t51
     #+0.5862637881547585D-1*t188*t62))*t206+0.1D1*t91*t51*t94
     #-0.261211729852336D1*t92/t177*t94)
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t3 = t2*rho
      t4 = rho**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = t7*sigma
      t11 = dexp(-0.2612068431013672D1*t8)
      t14 = dsqrt(sigma)
      t15 = 1/t3
      t16 = t14*t15
      t17 = t16**0.372D1
      t19 = 0.676232848138453D-2*t8-0.3761535428744195D-2*t8*t11
     #-0.2361985322859061D-5*t17
      t21 = dlog(0.1259921049894873D1*t16+dsqrt(1+0.1587401051968199D1
     #*t16**2))
      t25 = 1.D0+0.3220358203531296D-1*t16*t21+0.25383342239692D-5*t17
      t26 = 1/t25
      t29 = -0.9305257363491D0-1.D0*t19*t26
      t32 = 1/rho
      t33 = t32**(1.D0/3.D0)
      t35 = 1.D0+0.1325688999052018D0*t33
      t36 = t32**(1.D0/6.D0)
      t39 = dsqrt(t32)
      t41 = t33**2
      t43 = 0.598255043577108D1*t36+0.2225569421150687D1*t33
     #+0.8004286349993634D0*t39+0.1897004325747559D0*t41
      t46 = 1.D0+0.1608197949869254D2/t43
      t47 = dlog(t46)
      t48 = t35*t47
      t49 = 0.621814D-1*t48
      t51 = 1/t2/t4
      t55 = dexp(0.2513845706671277D1*t48)
      t56 = t55-1.D0
      t57 = 1/t56
      t58 = sigma**2
      t59 = t57*t58
      t60 = t4**2
      t62 = 1/t5/t60
      t65 = 0.634682060977037D-1*sigma*t51+0.1086645186223595D-1*t59*t62
      t66 = t57*sigma
      t69 = t56**2
      t70 = 1/t69
      t71 = t70*t58
      t74 = 1.D0+0.1712109500228824D0*t66*t51+0.2931318940773793D-1
     #*t71*t62
      t75 = 1/t74
      t78 = 1.D0+0.2697586091519874D1*t65*t75
      t79 = dlog(t78)
      t80 = 0.2473556743557577D-1*t79
      t83 = 0.2568D1+0.1443307452126544D2*t33+0.2843543831490386D-2*t41
      t87 = 1.D0+0.5411317332115466D1*t33+0.1816419932959077D0*t41
     #+0.1763993811759022D-1*t32
      t88 = 1/t87
      t91 = 0.1D-2*t83*t88-0.1853571428571429D-2
      t92 = t91*sigma
      t94 = dexp(-0.261211729852336D1*t8)
      t95 = t51*t94
      t97 = 0.1D1*t92*t95
      zk(i) = 0.453996700862905D0*t3*t29+rho*(-t49+t80+t97)
      t102 = t4*rho
      t104 = 1/t5/t102
      t105 = sigma*t104
      t109 = t60*t4
      t111 = 1/t2/t109
      t115 = t16**0.272D1
      t116 = t115*t14
      t117 = t116*t51
      t119 = -0.3606575190071749D-1*t105+0.200615222866357D-1*t105*t11
     #-0.5240206904299834D-1*t58*t111*t11+0.2343089440276188D-4*t117
      t122 = t25**2
      t123 = 1/t122
      t124 = t19*t123
      t129 = 1.D0+0.1587401051968199D1*t8
      t130 = dsqrt(t129)
      t131 = 1/t130
      t135 = -0.8587621876083455D-1*t14*t51*t21-0.1081972557021525D0
     #*t105*t131-0.2518027550177446D-4*t117
      t137 = -1.D0*t119*t26+t124*t135
      t140 = 1/t41
      t141 = 1/t4
      t142 = t140*t141
      t143 = t142*t47
      t145 = t43**2
      t146 = 1/t145
      t147 = t35*t146
      t148 = t36**2
      t149 = t148**2
      t150 = t149*t36
      t151 = 1/t150
      t155 = 1/t39
      t158 = 1/t33
      t159 = t158*t141
      t161 = -0.99709173929518D0*t151*t141-0.7418564737168958D0*t142
     #-0.4002143174996817D0*t155*t141-0.1264669550498372D0*t159
      t162 = 1/t46
      t164 = t147*t161*t162
      t167 = 1/t2/t102
      t172 = -0.1110859199549419D0*t143-0.4042761511756372D2*t164
      t174 = t62*t172*t55
      t177 = t60*rho
      t179 = 1/t5/t177
      t182 = -0.148092480894642D0*sigma*t167-0.1086645186223595D-1*t71
     #*t174-0.5071010869043442D-1*t59*t179
      t185 = t74**2
      t186 = 1/t185
      t187 = t65*t186
      t188 = t70*sigma
      t196 = 1/t69/t56
      t197 = t196*t58
      t202 = -0.1712109500228824D0*t188*t51*t172*t55
     #-0.3994922167200589D0*t66*t167-0.5862637881547585D-1*t197*t174
     #-0.136794883902777D0*t71*t179
      t205 = 0.2697586091519874D1*t182*t75-0.2697586091519874D1*t187
     #*t202
      t206 = 1/t78
      t207 = t205*t206
      t211 = -0.4811024840421814D1*t142-0.1895695887660258D-2*t159
      t214 = t87**2
      t215 = 1/t214
      t216 = t83*t215
      t220 = -0.1803772444038489D1*t142-0.1210946621972718D0*t159
     #-0.1763993811759022D-1*t141
      t223 = 0.1D-2*t211*t88-0.1D-2*t216*t220
      t224 = t223*sigma
      t225 = t224*t95
      t227 = t167*t94
      t228 = t92*t227
      t230 = t91*t58
      t232 = 1/t109*t94
      t233 = t230*t232
      vrhoa(i) = 0.6053289344838734D0*t2*t29+0.2269983504314525D0*t3
     #*t137-t49+t80+t97+rho*(0.2747773264188438D-2*t143+0.1D1*t164
     #+0.2473556743557577D-1*t207+0.1D1*t225-0.2333333333333333D1*t228
     #+0.6965646129395627D1*t233)
      t241 = 1/t2/t177
      t245 = 1/t14
      t246 = t115*t245
      t247 = t246*t15
      t249 = 0.2704931392553812D-1*t7-0.1504614171497678D-1*t7*t11
     #+0.3930155178224876D-1*sigma*t241*t11-0.1757317080207141D-4*t247
      t258 = 0.6440716407062592D-1*t245*t15*t21+0.8114794177661436D-1
     #*t7*t131+0.1888520662633084D-4*t247
      t260 = -1.D0*t249*t26+t124*t258
      t266 = 0.634682060977037D-1*t51+0.2173290372447189D-1*t66*t62
      t273 = 0.1712109500228824D0*t57*t51+0.5862637881547585D-1*t188*t62
      t276 = 0.2697586091519874D1*t266*t75-0.2697586091519874D1*t187
     #*t273
      t277 = t276*t206
      t280 = t91*t51*t94
      t282 = 1/t177
      t283 = t282*t94
      t284 = t92*t283
      vsigmaaa(i) = 0.453996700862905D0*t3*t260+4.D0*rho*
     #(0.2473556743557577D-1*t277+0.1D1*t280-0.261211729852336D1*t284)
      t297 = sigma*t62
      t301 = t60*t102
      t304 = t58/t2/t301
      t307 = t58*sigma
      t308 = t60**2
      t314 = t16**0.172D1
      t316 = t314*sigma*t62
      t318 = t116*t167
      t323 = t119*t123
      t328 = t19/t122/t25
      t329 = t135**2
      t338 = 1/t130/t129
      t351 = 1/t102
      t352 = t140*t351
      t353 = t352*t47
      t355 = t145**2
      t358 = t161**2
      t359 = t46**2
      t362 = t35/t355*t358/t359
      t366 = 1/t60
      t373 = 1/t41/t32*t366
      t384 = 1/t33/t32*t366
      t386 = t158*t351
      t390 = t147*(-0.8309097827459833D0/t150/t32*t366
     #+0.199418347859036D1*t151*t351-0.4945709824779306D0*t373
     #+0.1483712947433792D1*t352-0.2001071587498409D0/t39/t32*t366
     #+0.8004286349993634D0*t155*t351-0.4215565168327908D-1*t384
     #+0.2529339100996745D0*t386)*t162
      t396 = t35/t145/t43*t358*t162
      t398 = t373*t47
      t402 = t142*t146*t161*t162
      t406 = t230/t301*t94
      t426 = t220**2
      t442 = t308*rho
      t449 = 1/t2/t60
      t450 = sigma*t449
      t453 = t179*t172*t55
      t462 = 0.2221718399098838D0*t353-0.6501560775016922D3*t362
     #-0.4042761511756372D2*t390+0.8085523023512745D2*t396
     #-0.7405727996996128D-1*t398+0.3572962974617552D1*t402
      t464 = t62*t462*t55
      t467 = t172**2
      t468 = t62*t467
      t470 = dexp(0.5027691413342554D1*t48)
      t471 = t468*t470
      t474 = t468*t55
      t478 = 1/t5/t109
      t479 = t59*t478
      t484 = t182*t186
      t489 = t65/t185/t74
      t490 = t202**2
      t501 = t196*sigma
      t502 = t51*t467
      t506 = t66*t449
      t513 = t69**2
      t522 = t71*t478
      t530 = t205**2
      t531 = t78**2
      t532 = 1/t531
      t536 = t92*t449*t94
      s1 = -0.5495546528376876D-2*t353+0.1608197949869254D2*t362+0.1D1
     #*t390-0.2D1*t396+0.1831848842792292D-2*t398
     #-0.8837926660346786D-1*t402-0.5804705107829689D2*t406
      s2 = s1-0.4666666666666667D1*t224*t227+0.1393129225879125D2*t223
     #*t58*t232+0.1D1*(0.1D-2*(-0.3207349893614542D1*t373
     #+0.9622049680843627D1*t352-0.6318986292200858D-3*t384
     #+0.3791391775320515D-2*t386)*t88-0.2D-2*t211*t215*t220+0.2D-2
     #*t83/t214/t87*t426-0.1D-2*t216*(-0.1202514962692326D1*t373
     #+0.3607544888076978D1*t352-0.4036488739909061D-1*t384
     #+0.2421893243945437D0*t386+0.3527987623518044D-1*t351))*sigma*t95
      t538 = s2+0.4852022599996427D2*t91*t307/t5/t442*t94
     #+0.2473556743557577D-1*(0.2697586091519874D1*
     #(0.4936416029821399D0*t450+0.1014202173808688D0*t71*t453
     #-0.1086645186223595D-1*t71*t464+0.2173290372447189D-1*t197*t471
     #-0.1086645186223595D-1*t71*t474+0.2873572825791284D0*t479)*t75
     #-0.5395172183039748D1*t484*t202+0.5395172183039748D1*t489*t490
     #-0.2697586091519874D1*t187*(0.7989844334401178D0*t188*t167*t172
     #*t55-0.1712109500228824D0*t188*t51*t462*t55+0.3424219000457648D0
     #*t501*t502*t470+0.1331640722400196D1*t506-0.1712109500228824D0
     #*t188*t502*t55-0.5862637881547585D-1*t197*t464
     #+0.1758791364464276D0/t513*t58*t471+0.547179535611108D0*t197
     #*t453-0.5862637881547585D-1*t197*t474+0.7751710087824029D0*t522)
     #)*t206-0.2473556743557577D-1*t530*t532+0.7777777777777778D1*t536
      t551 = dlog(1.D0+0.2960874997779344D2/(0.8157414703487641D1*t36
     #+0.2247591863577616D1*t33+0.4300972471276643D0*t39
     #+0.1911512595127338D0*t41))
      t553 = (1.D0+0.6901399211255825D-1*t33)*t551*t141
      t555 = t79*t141
      t561 = 0.1365394134884567D1*t553-0.1675897137780851D1*t48*t141
      t563 = t62*t561*t55
      t591 = -t561
      t593 = t62*t591*t55
      s1 = 0.1099109305675375D-1*t143+0.4D1*t164+0.2786258451758251D2
     #*t233+0.9894226974230308D-1*t207+0.4D1*t225-0.9333333333333333D1
     #*t228
      s2 = s1+0.1210657868967747D1*t2*t137+0.2269983504314525D0*t3*(
     #-1.D0*(0.2644821806052616D0*t297-0.1471178301019952D0*t297*t11
     #+0.9432372427739702D0*t304*t11-0.730014881424079D0*t307/t308/t4
     #*t11-0.1699520874013662D-3*t316-0.1093441738795555D-3*t318)*t26
     #+2.D0*t323*t135-2.D0*t328*t329+t124*(0.4007556875505613D0*t14
     #*t167*t21+0.1081972557021525D1*t297*t131-0.4580065000577843D0
     #*t304*t338+0.1826409316395374D-3*t316+0.1175079523416141D-3*t318))
      s3 = s2+0.4035526229892489D0/t5*t29
      s4 = s3+2.D0*rho*t538
      s5 = s4
      s6 = rho*(-0.3377379869957684D-1*t553+0.1649037829038385D-1*t555
     #+0.2473556743557577D-1*(0.2697586091519874D1*(
     #-0.2820809159897942D-1*t450-0.1086645186223595D-1*t71*t563
     #-0.9659068321987509D-2*t479)*t75-0.2697586091519874D1*t187*(
     #-0.1712109500228824D0*t188*t51*t561*t55-0.760937555657255D-1
     #*t506-0.5862637881547585D-1*t197*t563-0.2605616836243371D-1*t522
     #))*t206+0.2222222222222222D0*t536-0.1160941021565938D1*t406)+rho
     #*(0.3377379869957684D-1*t553-0.1649037829038385D-1*t555
     #+0.2473556743557577D-1*(0.2697586091519874D1*
     #(0.2820809159897942D-1*t450-0.1086645186223595D-1*t71*t593
     #+0.9659068321987509D-2*t479)*t75-0.2697586091519874D1*t187*(
     #-0.1712109500228824D0*t188*t51*t591*t55+0.760937555657255D-1
     #*t506-0.5862637881547585D-1*t197*t593+0.2605616836243371D-1*t522
     #))*t206-0.2222222222222222D0*t536+0.1160941021565938D1*t406)
      v2rhoa2(i) = s5+s6
      t623 = sigma*t111
      t630 = t314*t104
      t632 = t246*t51
      t638 = t249*t123
      t670 = t266*t186
      s1 = 0.6053289344838734D0*t2*t260+0.2269983504314525D0*t3*(-1.D0
     #*(-0.14426300760287D0*t104+0.8024608914654282D-1*t104*t11
     #-0.6288248285159801D0*t623*t11+0.5475111610680592D0*t58/t442*t11
     #+0.1274640655510246D-3*t630+0.4686178880552377D-4*t632)*t26+t323
     #*t258+t638*t135-2.D0*t328*t135*t258+t124*(-0.1717524375216691D0
     #*t245*t51*t21-0.6491835342129149D0*t104*t131
     #+0.3435048750433382D0*t623*t338-0.1369806987296531D-3*t630
     #-0.5036055100354892D-4*t632))+0.9894226974230308D-1*t277
      v2rhoasigmaaa(i) = s1+0.4D1*t280-0.1044846919409344D2*t284+4.D0
     #*rho*(0.2473556743557577D-1*(0.2697586091519874D1*(
     #-0.148092480894642D0*t167-0.2173290372447189D-1*t188*t174
     #-0.1014202173808688D0*t66*t179)*t75-0.2697586091519874D1*t484
     #*t273-0.2697586091519874D1*t670*t202+0.5395172183039748D1*t489
     #*t202*t273-0.2697586091519874D1*t187*(-0.1712109500228824D0*t70
     #*t51*t172*t55-0.3994922167200589D0*t57*t167-0.1172527576309517D0
     #*t501*t174-0.273589767805554D0*t188*t179))*t206
     #-0.2473556743557577D-1*t205*t532*t276+0.1D1*t223*t51*t94
     #-0.261211729852336D1*t224*t283-0.2333333333333333D1*t91*t167*t94
     #+0.2002623262201243D2*t92*t232-0.181950847499866D2*t230/t5/t308
     #*t94)
      t719 = 1/sigma
      t721 = t314*t719*t7
      t724 = 1/t14/sigma
      t726 = t115*t724*t15
      t733 = t258**2
      t756 = t273**2
      t765 = t276**2
      v2sigmaaa2(i) = 0.453996700862905D0*t3*(-1.D0*
     #(0.3144124142579901D0*t241*t11-0.4106333708010444D0*sigma/t308
     #*t11-0.9559804916326848D-4*t721+0.3514634160414282D-4*t726)*t26
     #+2.D0*t638*t258-2.D0*t328*t733+t124*(-0.1288143281412518D0*t724
     #*t15*t21+0.1622958835532287D0*t719*t7*t131-0.2576286562825037D0
     #*t241*t338+0.1027355240472398D-3*t721-0.3777041325266169D-4*t726
     #))+16.D0*rho*(0.2473556743557577D-1*(0.5862637881547585D-1*t57
     #*t62*t75-0.5395172183039748D1*t670*t273+0.5395172183039748D1
     #*t489*t756-0.1581497040888031D0*t187*t70*t62)*t206
     #-0.2473556743557577D-1*t765*t532-0.522423459704672D1*t91*t282
     #*t94+0.6823156781244976D1*t92/t5/t301*t94)
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end

c:XC_MPW1Ksubrend
_ENDIF
_IF(ccpdft,all,xc_mpwb1k)
c:XC_MPWB1Ksubrstart

c    Generated: Wed Jul 18 15:34:37 BST 2007

      subroutine uks_xc_mpwb1k
     & (ideriv,npt,rhoa1,rhob1,sigmaaa1,sigmabb1,sigmaab1,
     &  taua1,taub1,
     &  zk,vrhoa,vrhob,vsigmaaa,vsigmabb,vsigmaab,
     &  vtaua,vtaub,
     &  v2rhoa2,v2rhob2,v2rhoab,
     &  v2rhoasigmaaa,v2rhoasigmaab,v2rhoasigmabb,
     &  v2rhobsigmabb,v2rhobsigmaab,v2rhobsigmaaa,
     &  v2sigmaaa2,v2sigmaaaab,v2sigmaaabb,
     &  v2sigmaab2,v2sigmaabbb,v2sigmabb2,
     &  v2rhoataua,v2rhoataub,v2rhobtaua,v2rhobtaub,
     &  v2sigmaaataua,v2sigmaaataub,
     &  v2sigmaabtaua,v2sigmaabtaub,
     &  v2sigmabbtaua,v2sigmabbtaub,
     &  v2taua2,v2taub2,v2tauab)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt),rhob1(npt)
      REAL sigmaaa1(npt),sigmabb1(npt),sigmaab1(npt)
      REAL taua1(npt),taub1(npt)
      REAL zk(npt),vrhoa(npt),vrhob(npt)
      REAL vsigmaaa(npt),vsigmabb(npt),vsigmaab(npt)
      REAL vtaua(npt),vtaub(npt)
      REAL v2rhoa2(npt),v2rhob2(npt),v2rhoab(npt)
      REAL v2rhoasigmaaa(npt),v2rhoasigmaab(npt)
      REAL v2rhoasigmabb(npt),v2rhobsigmabb(npt)
      REAL v2rhobsigmaab(npt),v2rhobsigmaaa(npt)
      REAL v2sigmaaa2(npt),v2sigmaaaab(npt),v2sigmaaabb(npt)
      REAL v2sigmaab2(npt),v2sigmaabbb(npt),v2sigmabb2(npt)
      REAL v2rhoataua(npt),v2rhoataub(npt)
      REAL v2rhobtaua(npt),v2rhobtaub(npt)
      REAL v2sigmaaataua(npt),v2sigmaaataub(npt)
      REAL v2sigmaabtaua(npt),v2sigmaabtaub(npt)
      REAL v2sigmabbtaua(npt),v2sigmabbtaub(npt)
      REAL v2taua2(npt),v2taub2(npt),v2tauab(npt)
      parameter(tol=1.0d-20)
      
      if (ideriv.eq.0) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      taub = dmax1(0.D0,taub1(i))
      tau = taub
      t3 = rhob**(1.D0/3.D0)
      t4 = t3*rhob
      t5 = rhob**2
      t6 = t3**2
      t9 = sigmabb/t6/t5
      t12 = dexp(-0.16455D1*t9)
      t15 = dsqrt(sigmabb)
      t17 = t15/t4
      t18 = t17**0.372D1
      t21 = dlog(t17+dsqrt(1+t17**2))
      t34 = (1.D0+0.38D-1*t9)**2
      t36 = 1/rhob
      t42 = t36**(1.D0/3.D0)
      t46 = t36**(1.D0/6.D0)
      t49 = dsqrt(t36)
      t51 = t42**2
      t57 = dlog(1.D0+0.3216395899738507D2/(0.1112037486309468D2*t46
     #+0.3844746237447211D1*t42+0.1644733775567609D1*t49
     #+0.2405871291288192D0*t51))
      zk(i) = 0.56D0*t4*(-0.9305257363491D0-1.D0*(0.426D-2*t9
     #-0.2369618833300074D-2*t9*t12-0.1D-5*t18)/(1.D0+0.2556D-1*t17
     #*t21+0.1074661302677646D-5*t18))-0.3410713597655142D-2/t34*(taub
     #-0.25D0*sigmabb*t36)/t6*(1.D0+0.1274696188700087D0*t42)*t57
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      taua = dmax1(0.D0,taua1(i))
      tau = taua
      t3 = rhoa**(1.D0/3.D0)
      t4 = t3*rhoa
      t5 = rhoa**2
      t6 = t3**2
      t9 = sigmaaa/t6/t5
      t12 = dexp(-0.16455D1*t9)
      t15 = dsqrt(sigmaaa)
      t17 = t15/t4
      t18 = t17**0.372D1
      t21 = dlog(t17+dsqrt(1+t17**2))
      t34 = (1.D0+0.38D-1*t9)**2
      t36 = 1/rhoa
      t42 = t36**(1.D0/3.D0)
      t46 = t36**(1.D0/6.D0)
      t49 = dsqrt(t36)
      t51 = t42**2
      t57 = dlog(1.D0+0.3216395899738507D2/(0.1112037486309468D2*t46
     #+0.3844746237447211D1*t42+0.1644733775567609D1*t49
     #+0.2405871291288192D0*t51))
      zk(i) = 0.56D0*t4*(-0.9305257363491D0-1.D0*(0.426D-2*t9
     #-0.2369618833300074D-2*t9*t12-0.1D-5*t18)/(1.D0+0.2556D-1*t17
     #*t21+0.1074661302677646D-5*t18))-0.3410713597655142D-2/t34*(taua
     #-0.25D0*sigmaaa*t36)/t6*(1.D0+0.1274696188700087D0*t42)*t57
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      taua = dmax1(0.D0,taua1(i))
      taub = dmax1(0.D0,taub1(i))
      tau = taua+taub
      t6 = rhoa**(1.D0/3.D0)
      t7 = t6*rhoa
      t8 = rhoa**2
      t9 = t6**2
      t12 = sigmaaa/t9/t8
      t15 = dexp(-0.16455D1*t12)
      t18 = dsqrt(sigmaaa)
      t20 = t18/t7
      t21 = t20**0.372D1
      t24 = dlog(t20+dsqrt(1+t20**2))
      t37 = (1.D0+0.38D-1*t12)**2
      t39 = 1/rhoa
      t45 = t39**(1.D0/3.D0)
      t47 = 1.D0+0.1274696188700087D0*t45
      t49 = t39**(1.D0/6.D0)
      t52 = dsqrt(t39)
      t54 = t45**2
      t60 = dlog(1.D0+0.3216395899738507D2/(0.1112037486309468D2*t49
     #+0.3844746237447211D1*t45+0.1644733775567609D1*t52
     #+0.2405871291288192D0*t54))
      t64 = rhob**(1.D0/3.D0)
      t65 = t64*rhob
      t66 = rhob**2
      t67 = t64**2
      t70 = sigmabb/t67/t66
      t73 = dexp(-0.16455D1*t70)
      t76 = dsqrt(sigmabb)
      t78 = t76/t65
      t79 = t78**0.372D1
      t82 = dlog(t78+dsqrt(1+t78**2))
      t95 = (1.D0+0.38D-1*t70)**2
      t97 = 1/rhob
      t103 = t97**(1.D0/3.D0)
      t105 = 1.D0+0.1274696188700087D0*t103
      t107 = t97**(1.D0/6.D0)
      t110 = dsqrt(t97)
      t112 = t103**2
      t118 = dlog(1.D0+0.3216395899738507D2/(0.1112037486309468D2*t107
     #+0.3844746237447211D1*t103+0.1644733775567609D1*t110
     #+0.2405871291288192D0*t112))
      t126 = rhoa+rhob
      t127 = 1/t126
      t128 = t127**(1.D0/3.D0)
      t131 = t127**(1.D0/6.D0)
      t134 = dsqrt(t127)
      t136 = t128**2
      t142 = dlog(1.D0+0.1608197949869254D2/(0.598255043577108D1*t131
     #+0.2225569421150687D1*t128+0.8004286349993634D0*t134
     #+0.1897004325747559D0*t136))
      t144 = 0.621814D-1*(1.D0+0.1325688999052018D0*t128)*t142
      t155 = dlog(1.D0+0.2960874997779344D2/(0.8157414703487641D1*t131
     #+0.2247591863577616D1*t128+0.4300972471276643D0*t134
     #+0.1911512595127338D0*t136))
      t158 = rhoa-1.D0*rhob
      t159 = t158*t127
      t160 = 1.D0+t159
      t161 = t160**(1.D0/3.D0)
      t164 = 1.D0-1.D0*t159
      t165 = t164**(1.D0/3.D0)
      t167 = t161*t160+t165*t164-2.D0
      t168 = t158**2
      t169 = t168**2
      t170 = t126**2
      t171 = t170**2
      t173 = t169/t171
      t189 = dlog(1.D0+0.3216395899738507D2/(0.1112037486309468D2*t131
     #+0.3844746237447211D1*t128+0.1644733775567609D1*t134
     #+0.2405871291288192D0*t136))
      zk(i) = 0.56D0*t7*(-0.9305257363491D0-1.D0*(0.426D-2*t12
     #-0.2369618833300074D-2*t12*t15-0.1D-5*t21)/(1.D0+0.2556D-1*t20
     #*t24+0.1074661302677646D-5*t21))-0.3410713597655142D-2/t37*(taua
     #-0.25D0*sigmaaa*t39)/t9*t47*t60+0.56D0*t65*(-0.9305257363491D0
     #-1.D0*(0.426D-2*t70-0.2369618833300074D-2*t70*t73-0.1D-5*t79)/
     #(1.D0+0.2556D-1*t78*t82+0.1074661302677646D-5*t79))
     #-0.3410713597655142D-2/t95*(taub-0.25D0*sigmabb*t97)/t67*t105
     #*t118+1/(1.D0+0.31D-2*t12+0.31D-2*t70)*(t126*(-t144
     #+0.3799552353702395D-1*(1.D0+0.6901399211255825D-1*t128)*t155
     #*t167*(1.D0-1.D0*t173)+0.1923661050931536D1*(-0.310907D-1*(1.D0
     #+0.1274696188700087D0*t128)*t189+t144)*t167*t173)+0.310907D-1
     #*rhoa*t47*t60+0.310907D-1*rhob*t105*t118)
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      taub = dmax1(0.D0,taub1(i))
      tau = taub
      t3 = rhob**(1.D0/3.D0)
      t4 = t3*rhob
      t5 = rhob**2
      t6 = t3**2
      t8 = 1/t6/t5
      t9 = sigmabb*t8
      t12 = dexp(-0.16455D1*t9)
      t15 = dsqrt(sigmabb)
      t16 = 1/t4
      t17 = t15*t16
      t18 = t17**0.372D1
      t20 = 0.426D-2*t9-0.2369618833300074D-2*t9*t12-0.1D-5*t18
      t21 = dlog(t17+dsqrt(1+t17**2))
      t25 = 1.D0+0.2556D-1*t17*t21+0.1074661302677646D-5*t18
      t26 = 1/t25
      t29 = -0.9305257363491D0-1.D0*t20*t26
      t33 = 1.D0+0.38D-1*t9
      t34 = t33**2
      t35 = 1/t34
      t36 = 1/rhob
      t39 = taub-0.25D0*sigmabb*t36
      t40 = t35*t39
      t41 = 1/t6
      t42 = t36**(1.D0/3.D0)
      t44 = 1.D0+0.1274696188700087D0*t42
      t46 = t36**(1.D0/6.D0)
      t49 = dsqrt(t36)
      t51 = t42**2
      t53 = 0.1112037486309468D2*t46+0.3844746237447211D1*t42
     #+0.1644733775567609D1*t49+0.2405871291288192D0*t51
      t56 = 1.D0+0.3216395899738507D2/t53
      t57 = dlog(t56)
      zk(i) = 0.56D0*t4*t29-0.3410713597655142D-2*t40*t41*t44*t57
      vrhoa(i) = 0.D0
      t63 = t5*rhob
      t66 = sigmabb/t6/t63
      t70 = sigmabb**2
      t71 = t5**2
      t78 = t17**0.272D1
      t81 = 1/t3/t5
      t82 = t78*t15*t81
      t87 = t25**2
      t89 = t20/t87
      t94 = dsqrt(1.D0+t9)
      t95 = 1/t94
      t106 = 1/t34/t33*t39
      t110 = t44*t57
      t120 = 1/t6/rhob
      t125 = 1/t51
      t131 = t53**2
      t134 = t46**2
      t135 = t134**2
      t138 = 1/t5
      vrhob(i) = 0.7466666666666667D0*t3*t29+0.56D0*t4*(-1.D0*(
     #-0.1136D-1*t66+0.6318983555466863D-2*t66*t12
     #-0.1039788744052072D-1*t70/t3/t71/t5*t12+0.496D-5*t82)*t26+t89*(
     #-0.3408D-1*t15*t81*t21-0.3408D-1*t66*t95-0.5330320061281126D-5
     #*t82))-0.6912379557914422D-3*t106/t3/t71*t110*sigmabb
     #-0.8526783994137856D-3*t35*sigmabb*t8*t44*t57
     #+0.2273809065103428D-2*t40*t120*t44*t57+0.1449207874559524D-3
     #*t40*t8*t125*t57+0.1097020523068037D0*t40*t41*t44/t131*(
     #-0.1853395810515781D1/t135/t46*t138-0.128158207914907D1*t125
     #*t138-0.8223668877838045D0/t49*t138-0.1603914194192128D0/t42
     #*t138)/t56
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      t164 = 1/t15
      t166 = t78*t164*t16
      vsigmabb(i) = 0.56D0*t4*(-1.D0*(0.426D-2*t8
     #-0.2369618833300074D-2*t8*t12+0.3899207790195271D-2*sigmabb/t3
     #/t71/rhob*t12-0.186D-5*t166)*t26+t89*(0.1278D-1*t164*t16*t21
     #+0.1278D-1*t8*t95+0.1998870022980422D-5*t166))
     #+0.2592142334217908D-3*t106/t3/t63*t44*t57+0.8526783994137856D-3
     #*t35*t120*t110
      vtaua(i) = 0.D0
      vtaub(i) = -0.3410713597655142D-2*t35*t41*t110
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      taua = dmax1(0.D0,taua1(i))
      tau = taua
      t3 = rhoa**(1.D0/3.D0)
      t4 = t3*rhoa
      t5 = rhoa**2
      t6 = t3**2
      t8 = 1/t6/t5
      t9 = sigmaaa*t8
      t12 = dexp(-0.16455D1*t9)
      t15 = dsqrt(sigmaaa)
      t16 = 1/t4
      t17 = t15*t16
      t18 = t17**0.372D1
      t20 = 0.426D-2*t9-0.2369618833300074D-2*t9*t12-0.1D-5*t18
      t21 = dlog(t17+dsqrt(1+t17**2))
      t25 = 1.D0+0.2556D-1*t17*t21+0.1074661302677646D-5*t18
      t26 = 1/t25
      t29 = -0.9305257363491D0-1.D0*t20*t26
      t33 = 1.D0+0.38D-1*t9
      t34 = t33**2
      t35 = 1/t34
      t36 = 1/rhoa
      t39 = taua-0.25D0*sigmaaa*t36
      t40 = t35*t39
      t41 = 1/t6
      t42 = t36**(1.D0/3.D0)
      t44 = 1.D0+0.1274696188700087D0*t42
      t46 = t36**(1.D0/6.D0)
      t49 = dsqrt(t36)
      t51 = t42**2
      t53 = 0.1112037486309468D2*t46+0.3844746237447211D1*t42
     #+0.1644733775567609D1*t49+0.2405871291288192D0*t51
      t56 = 1.D0+0.3216395899738507D2/t53
      t57 = dlog(t56)
      zk(i) = 0.56D0*t4*t29-0.3410713597655142D-2*t40*t41*t44*t57
      t63 = t5*rhoa
      t66 = sigmaaa/t6/t63
      t70 = sigmaaa**2
      t71 = t5**2
      t78 = t17**0.272D1
      t81 = 1/t3/t5
      t82 = t78*t15*t81
      t87 = t25**2
      t89 = t20/t87
      t94 = dsqrt(1.D0+t9)
      t95 = 1/t94
      t106 = 1/t34/t33*t39
      t110 = t44*t57
      t120 = 1/t6/rhoa
      t125 = 1/t51
      t131 = t53**2
      t134 = t46**2
      t135 = t134**2
      t138 = 1/t5
      vrhoa(i) = 0.7466666666666667D0*t3*t29+0.56D0*t4*(-1.D0*(
     #-0.1136D-1*t66+0.6318983555466863D-2*t66*t12
     #-0.1039788744052072D-1*t70/t3/t71/t5*t12+0.496D-5*t82)*t26+t89*(
     #-0.3408D-1*t15*t81*t21-0.3408D-1*t66*t95-0.5330320061281126D-5
     #*t82))-0.6912379557914422D-3*t106/t3/t71*t110*sigmaaa
     #-0.8526783994137856D-3*t35*sigmaaa*t8*t44*t57
     #+0.2273809065103428D-2*t40*t120*t44*t57+0.1449207874559524D-3
     #*t40*t8*t125*t57+0.1097020523068037D0*t40*t41*t44/t131*(
     #-0.1853395810515781D1/t135/t46*t138-0.128158207914907D1*t125
     #*t138-0.8223668877838045D0/t49*t138-0.1603914194192128D0/t42
     #*t138)/t56
      vrhob(i) = 0.D0
      t164 = 1/t15
      t166 = t78*t164*t16
      vsigmaaa(i) = 0.56D0*t4*(-1.D0*(0.426D-2*t8
     #-0.2369618833300074D-2*t8*t12+0.3899207790195271D-2*sigmaaa/t3
     #/t71/rhoa*t12-0.186D-5*t166)*t26+t89*(0.1278D-1*t164*t16*t21
     #+0.1278D-1*t8*t95+0.1998870022980422D-5*t166))
     #+0.2592142334217908D-3*t106/t3/t63*t44*t57+0.8526783994137856D-3
     #*t35*t120*t110
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      vtaua(i) = -0.3410713597655142D-2*t35*t41*t110
      vtaub(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      taua = dmax1(0.D0,taua1(i))
      taub = dmax1(0.D0,taub1(i))
      tau = taua+taub
      t6 = rhoa**(1.D0/3.D0)
      t7 = t6*rhoa
      t8 = rhoa**2
      t9 = t6**2
      t11 = 1/t9/t8
      t12 = sigmaaa*t11
      t15 = dexp(-0.16455D1*t12)
      t18 = dsqrt(sigmaaa)
      t19 = 1/t7
      t20 = t18*t19
      t21 = t20**0.372D1
      t23 = 0.426D-2*t12-0.2369618833300074D-2*t12*t15-0.1D-5*t21
      t24 = dlog(t20+dsqrt(1+t20**2))
      t28 = 1.D0+0.2556D-1*t20*t24+0.1074661302677646D-5*t21
      t29 = 1/t28
      t32 = -0.9305257363491D0-1.D0*t23*t29
      t36 = 1.D0+0.38D-1*t12
      t37 = t36**2
      t38 = 1/t37
      t39 = 1/rhoa
      t42 = taua-0.25D0*sigmaaa*t39
      t43 = t38*t42
      t44 = 1/t9
      t45 = t39**(1.D0/3.D0)
      t47 = 1.D0+0.1274696188700087D0*t45
      t49 = t39**(1.D0/6.D0)
      t52 = dsqrt(t39)
      t54 = t45**2
      t56 = 0.1112037486309468D2*t49+0.3844746237447211D1*t45
     #+0.1644733775567609D1*t52+0.2405871291288192D0*t54
      t59 = 1.D0+0.3216395899738507D2/t56
      t60 = dlog(t59)
      t64 = rhob**(1.D0/3.D0)
      t65 = t64*rhob
      t66 = rhob**2
      t67 = t64**2
      t69 = 1/t67/t66
      t70 = sigmabb*t69
      t73 = dexp(-0.16455D1*t70)
      t76 = dsqrt(sigmabb)
      t77 = 1/t65
      t78 = t76*t77
      t79 = t78**0.372D1
      t81 = 0.426D-2*t70-0.2369618833300074D-2*t70*t73-0.1D-5*t79
      t82 = dlog(t78+dsqrt(1+t78**2))
      t86 = 1.D0+0.2556D-1*t78*t82+0.1074661302677646D-5*t79
      t87 = 1/t86
      t90 = -0.9305257363491D0-1.D0*t81*t87
      t94 = 1.D0+0.38D-1*t70
      t95 = t94**2
      t96 = 1/t95
      t97 = 1/rhob
      t100 = taub-0.25D0*sigmabb*t97
      t101 = t96*t100
      t102 = 1/t67
      t103 = t97**(1.D0/3.D0)
      t105 = 1.D0+0.1274696188700087D0*t103
      t107 = t97**(1.D0/6.D0)
      t110 = dsqrt(t97)
      t112 = t103**2
      t114 = 0.1112037486309468D2*t107+0.3844746237447211D1*t103
     #+0.1644733775567609D1*t110+0.2405871291288192D0*t112
      t117 = 1.D0+0.3216395899738507D2/t114
      t118 = dlog(t117)
      t124 = 1.D0+0.31D-2*t12+0.31D-2*t70
      t125 = 1/t124
      t126 = rhoa+rhob
      t127 = 1/t126
      t128 = t127**(1.D0/3.D0)
      t130 = 1.D0+0.1325688999052018D0*t128
      t131 = t127**(1.D0/6.D0)
      t134 = dsqrt(t127)
      t136 = t128**2
      t138 = 0.598255043577108D1*t131+0.2225569421150687D1*t128
     #+0.8004286349993634D0*t134+0.1897004325747559D0*t136
      t141 = 1.D0+0.1608197949869254D2/t138
      t142 = dlog(t141)
      t144 = 0.621814D-1*t130*t142
      t146 = 1.D0+0.6901399211255825D-1*t128
      t151 = 0.8157414703487641D1*t131+0.2247591863577616D1*t128
     #+0.4300972471276643D0*t134+0.1911512595127338D0*t136
      t154 = 1.D0+0.2960874997779344D2/t151
      t155 = dlog(t154)
      t156 = t146*t155
      t158 = rhoa-1.D0*rhob
      t159 = t158*t127
      t160 = 1.D0+t159
      t161 = t160**(1.D0/3.D0)
      t164 = 1.D0-1.D0*t159
      t165 = t164**(1.D0/3.D0)
      t167 = t161*t160+t165*t164-2.D0
      t168 = t158**2
      t169 = t168**2
      t170 = t126**2
      t171 = t170**2
      t172 = 1/t171
      t173 = t169*t172
      t175 = 1.D0-1.D0*t173
      t178 = 0.3799552353702395D-1*t156*t167*t175
      t180 = 1.D0+0.1274696188700087D0*t128
      t185 = 0.1112037486309468D2*t131+0.3844746237447211D1*t128
     #+0.1644733775567609D1*t134+0.2405871291288192D0*t136
      t188 = 1.D0+0.3216395899738507D2/t185
      t189 = dlog(t188)
      t192 = -0.310907D-1*t180*t189+t144
      t193 = t192*t167
      t195 = 0.1923661050931536D1*t193*t173
      t198 = rhoa*t47
      t201 = rhob*t105
      t204 = t126*(-t144+t178+t195)+0.310907D-1*t198*t60+0.310907D-1
     #*t201*t118
      zk(i) = 0.56D0*t7*t32-0.3410713597655142D-2*t43*t44*t47*t60
     #+0.56D0*t65*t90-0.3410713597655142D-2*t101*t102*t105*t118+t125
     #*t204
      t208 = t8*rhoa
      t211 = sigmaaa/t9/t208
      t215 = sigmaaa**2
      t216 = t8**2
      t223 = t20**0.272D1
      t226 = 1/t6/t8
      t227 = t223*t18*t226
      t232 = t28**2
      t234 = t23/t232
      t239 = dsqrt(1.D0+t12)
      t240 = 1/t239
      t251 = 1/t37/t36*t42
      t255 = t47*t60
      t265 = 1/t9/rhoa
      t270 = 1/t54
      t276 = t56**2
      t277 = 1/t276
      t279 = t49**2
      t280 = t279**2
      t283 = 1/t8
      t294 = -0.1853395810515781D1/t280/t49*t283-0.128158207914907D1
     #*t270*t283-0.8223668877838045D0/t52*t283-0.1603914194192128D0
     #/t45*t283
      t295 = 1/t59
      t300 = t124**2
      t302 = 1/t300*t204
      t306 = 1/t170
      t307 = 1/t136*t306
      t308 = t307*t142
      t309 = 0.2747773264188438D-2*t308
      t310 = t138**2
      t313 = t131**2
      t314 = t313**2
      t317 = 1/t314/t131*t306
      t321 = 1/t134*t306
      t324 = 1/t128*t306
      t329 = t130/t310*(-0.99709173929518D0*t317-0.7418564737168958D0
     #*t307-0.4002143174996817D0*t321-0.1264669550498372D0*t324)/t141
      t330 = 0.1D1*t329
      t334 = 0.8740742538988973D-3*t307*t155*t167*t175
      t335 = t151**2
      t348 = 0.1124999956683108D1*t146/t335*(-0.135956911724794D1*t317
     #-0.7491972878592054D0*t307-0.2150486235638321D0*t321
     #-0.1274341730084892D0*t324)/t154*t167*t175
      t349 = t158*t306
      t350 = 1.D0*t349
      t354 = 1.D0*t127
      t358 = 0.1333333333333333D1*t161*(t127-t350)
     #+0.1333333333333333D1*t165*(-t354+t349)
      t363 = t168*t158*t172
      t364 = 4.D0*t363
      t367 = t169/t171/t126
      t368 = 4.D0*t367
      t375 = t185**2
      t392 = 0.1923661050931536D1*(0.1321039893133927D-2*t307*t189
     #+0.1D1*t180/t375*(-0.1853395810515781D1*t317-0.128158207914907D1
     #*t307-0.8223668877838045D0*t321-0.1603914194192128D0*t324)/t188
     #-0.2747773264188438D-2*t308-0.1D1*t329)*t167*t173
      t396 = t193*t363
      t399 = 0.7694644203726145D1*t193*t367
      s1 = 0.7466666666666667D0*t6*t32+0.56D0*t7*(-1.D0*(-0.1136D-1
     #*t211+0.6318983555466863D-2*t211*t15-0.1039788744052072D-1*t215
     #/t6/t216/t8*t15+0.496D-5*t227)*t29+t234*(-0.3408D-1*t18*t226*t24
     #-0.3408D-1*t211*t240-0.5330320061281126D-5*t227))
     #-0.6912379557914422D-3*t251/t6/t216*t255*sigmaaa
     #-0.8526783994137856D-3*t38*sigmaaa*t11*t47*t60
      vrhoa(i) = s1+0.2273809065103428D-2*t43*t265*t47*t60
     #+0.1449207874559524D-3*t43*t11*t270*t60+0.1097020523068037D0*t43
     #*t44*t47*t277*t294*t295+0.8266666666666667D-2*t302*t211+t125*(
     #-t144+t178+t195+t126*(t309+t330-t334-t348+0.3799552353702395D-1
     #*t156*t358*t175+0.3799552353702395D-1*t156*t167*(-t364+t368)
     #+t392+0.1923661050931536D1*t192*t358*t173+0.7694644203726145D1
     #*t396-t399)+0.310907D-1*t255-0.1321039893133927D-2*t39*t270*t60
     #-0.1D1*t198*t277*t294*t295)
      t414 = t66*rhob
      t417 = sigmabb/t67/t414
      t421 = sigmabb**2
      t422 = t66**2
      t429 = t78**0.272D1
      t432 = 1/t64/t66
      t433 = t429*t76*t432
      t438 = t86**2
      t440 = t81/t438
      t445 = dsqrt(1.D0+t70)
      t446 = 1/t445
      t457 = 1/t95/t94*t100
      t461 = t105*t118
      t471 = 1/t67/rhob
      t476 = 1/t112
      t482 = t114**2
      t483 = 1/t482
      t485 = t107**2
      t486 = t485**2
      t489 = 1/t66
      t500 = -0.1853395810515781D1/t486/t107*t489-0.128158207914907D1
     #*t476*t489-0.8223668877838045D0/t110*t489-0.1603914194192128D0
     #/t103*t489
      t501 = 1/t117
      t514 = 0.1333333333333333D1*t161*(-t354-t350)
     #+0.1333333333333333D1*t165*(t127+t349)
      s1 = 0.7466666666666667D0*t64*t90+0.56D0*t65*(-1.D0*(-0.1136D-1
     #*t417+0.6318983555466863D-2*t417*t73-0.1039788744052072D-1*t421
     #/t64/t422/t66*t73+0.496D-5*t433)*t87+t440*(-0.3408D-1*t76*t432
     #*t82-0.3408D-1*t417*t446-0.5330320061281126D-5*t433))
     #-0.6912379557914422D-3*t457/t64/t422*t461*sigmabb
     #-0.8526783994137856D-3*t96*sigmabb*t69*t105*t118
      vrhob(i) = s1+0.2273809065103428D-2*t101*t471*t105*t118
     #+0.1449207874559524D-3*t101*t69*t476*t118+0.1097020523068037D0
     #*t101*t102*t105*t483*t500*t501+0.8266666666666667D-2*t302*t417
     #+t125*(-t144+t178+t195+t126*(t309+t330-t334-t348
     #+0.3799552353702395D-1*t156*t514*t175+0.3799552353702395D-1*t156
     #*t167*(t364+t368)+t392+0.1923661050931536D1*t192*t514*t173
     #-0.7694644203726145D1*t396-t399)+0.310907D-1*t461
     #-0.1321039893133927D-2*t97*t476*t118-0.1D1*t201*t483*t500*t501)
      t547 = 1/t18
      t549 = t223*t547*t19
      vsigmaaa(i) = 0.56D0*t7*(-1.D0*(0.426D-2*t11
     #-0.2369618833300074D-2*t11*t15+0.3899207790195271D-2*sigmaaa/t6
     #/t216/rhoa*t15-0.186D-5*t549)*t29+t234*(0.1278D-1*t547*t19*t24
     #+0.1278D-1*t11*t240+0.1998870022980422D-5*t549))
     #+0.2592142334217908D-3*t251/t6/t208*t47*t60
     #+0.8526783994137856D-3*t38*t265*t255-0.31D-2*t302*t11
      vsigmaab(i) = 0.D0
      t585 = 1/t76
      t587 = t429*t585*t77
      vsigmabb(i) = 0.56D0*t65*(-1.D0*(0.426D-2*t69
     #-0.2369618833300074D-2*t69*t73+0.3899207790195271D-2*sigmabb/t64
     #/t422/rhob*t73-0.186D-5*t587)*t87+t440*(0.1278D-1*t585*t77*t82
     #+0.1278D-1*t69*t446+0.1998870022980422D-5*t587))
     #+0.2592142334217908D-3*t457/t64/t414*t105*t118
     #+0.8526783994137856D-3*t96*t471*t461-0.31D-2*t302*t69
      vtaua(i) = -0.3410713597655142D-2*t38*t44*t255
      vtaub(i) = -0.3410713597655142D-2*t96*t102*t461
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      vtaua(i) = 0.0d0
      vtaub(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      taub = dmax1(0.D0,taub1(i))
      tau = taub
      t3 = rhob**(1.D0/3.D0)
      t4 = t3*rhob
      t5 = rhob**2
      t6 = t3**2
      t8 = 1/t6/t5
      t9 = sigmabb*t8
      t12 = dexp(-0.16455D1*t9)
      t15 = dsqrt(sigmabb)
      t16 = 1/t4
      t17 = t15*t16
      t18 = t17**0.372D1
      t20 = 0.426D-2*t9-0.2369618833300074D-2*t9*t12-0.1D-5*t18
      t21 = dlog(t17+dsqrt(1+t17**2))
      t25 = 1.D0+0.2556D-1*t17*t21+0.1074661302677646D-5*t18
      t26 = 1/t25
      t29 = -0.9305257363491D0-1.D0*t20*t26
      t33 = 1.D0+0.38D-1*t9
      t34 = t33**2
      t35 = 1/t34
      t36 = 1/rhob
      t39 = taub-0.25D0*sigmabb*t36
      t40 = t35*t39
      t41 = 1/t6
      t42 = t36**(1.D0/3.D0)
      t44 = 1.D0+0.1274696188700087D0*t42
      t46 = t36**(1.D0/6.D0)
      t49 = dsqrt(t36)
      t51 = t42**2
      t53 = 0.1112037486309468D2*t46+0.3844746237447211D1*t42
     #+0.1644733775567609D1*t49+0.2405871291288192D0*t51
      t56 = 1.D0+0.3216395899738507D2/t53
      t57 = dlog(t56)
      zk(i) = 0.56D0*t4*t29-0.3410713597655142D-2*t40*t41*t44*t57
      vrhoa(i) = 0.D0
      t63 = t5*rhob
      t65 = 1/t6/t63
      t66 = sigmabb*t65
      t70 = sigmabb**2
      t71 = t5**2
      t72 = t71*t5
      t74 = 1/t3/t72
      t78 = t17**0.272D1
      t79 = t78*t15
      t81 = 1/t3/t5
      t82 = t79*t81
      t84 = -0.1136D-1*t66+0.6318983555466863D-2*t66*t12
     #-0.1039788744052072D-1*t70*t74*t12+0.496D-5*t82
      t87 = t25**2
      t88 = 1/t87
      t89 = t20*t88
      t93 = 1.D0+t9
      t94 = dsqrt(t93)
      t95 = 1/t94
      t99 = -0.3408D-1*t15*t81*t21-0.3408D-1*t66*t95
     #-0.5330320061281126D-5*t82
      t101 = -1.D0*t84*t26+t89*t99
      t105 = 1/t34/t33
      t106 = t105*t39
      t108 = 1/t3/t71
      t110 = t44*t57
      t111 = t110*sigmabb
      t114 = t35*sigmabb
      t116 = t8*t44*t57
      t120 = 1/t6/rhob
      t125 = 1/t51
      t130 = t40*t41
      t131 = t53**2
      t132 = 1/t131
      t133 = t44*t132
      t134 = t46**2
      t135 = t134**2
      t136 = t135*t46
      t137 = 1/t136
      t138 = 1/t5
      t143 = 1/t49
      t146 = 1/t42
      t149 = -0.1853395810515781D1*t137*t138-0.128158207914907D1*t125
     #*t138-0.8223668877838045D0*t143*t138-0.1603914194192128D0*t146
     #*t138
      t150 = 1/t56
      t151 = t149*t150
      t152 = t133*t151
      vrhob(i) = 0.7466666666666667D0*t3*t29+0.56D0*t4*t101
     #-0.6912379557914422D-3*t106*t108*t111-0.8526783994137856D-3*t114
     #*t116+0.2273809065103428D-2*t40*t120*t44*t57
     #+0.1449207874559524D-3*t40*t8*t125*t57+0.1097020523068037D0*t130
     #*t152
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      t160 = 1/t3/t71/rhob
      t164 = 1/t15
      t166 = t78*t164*t16
      t168 = 0.426D-2*t8-0.2369618833300074D-2*t8*t12
     #+0.3899207790195271D-2*sigmabb*t160*t12-0.186D-5*t166
      t177 = 0.1278D-1*t164*t16*t21+0.1278D-1*t8*t95
     #+0.1998870022980422D-5*t166
      t183 = 1/t3/t63
      t189 = t35*t120*t110
      vsigmabb(i) = 0.56D0*t4*(-1.D0*t168*t26+t89*t177)
     #+0.2592142334217908D-3*t106*t183*t44*t57+0.8526783994137856D-3
     #*t189
      vtaua(i) = 0.D0
      t191 = t35*t41
      vtaub(i) = -0.3410713597655142D-2*t191*t110
      v2rhoa2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t204 = t125*t57
      t213 = t34**2
      t215 = 1/t213*t39
      t216 = t71**2
      t217 = 1/t216
      t224 = t132*t149
      t233 = 1/t6/t71
      t249 = 1/t71
      t252 = 1/t63
      t256 = 1/t51/t36
      t281 = t149**2
      t295 = t131**2
      t298 = t56**2
      t304 = sigmabb*t233
      t311 = t70/t3/t71/t63
      t320 = t17**0.172D1
      t322 = t320*sigmabb*t233
      t324 = t79*t183
      t334 = t20/t87/t25
      t335 = t99**2
      t344 = 1/t94/t93
      s1 = 0.2488888888888889D0*t41*t29+0.3456189778957211D-2*t106
     #*t160*t111+0.2842261331379285D-2*t114*t65*t44*t57
     #+0.5874122584881271D-4*t106*t74*t204*sigmabb
     #-0.3456189778957211D-3*t105*t70*t74*t44*t57
     #-0.2101363385605984D-3*t215*t217*t110*t70+0.4446589853502444D-1
     #*t106*t108*t44*t224*t150*sigmabb+0.5485102615340186D-1*t114*t8
     #*t152+0.7246039372797621D-4*t114*t233*t125*t57
      s2 = s1-0.1462694030757383D0*t40*t120*t152-0.4830692915198414D-3
     #*t40*t65*t125*t57-0.378968177517238D-2*t40*t116
     #+0.1097020523068037D0*t130*t133*(-0.1544496508763151D1/t136/t36
     #*t249+0.3706791621031562D1*t137*t252-0.854388052766047D0*t256
     #*t249+0.2563164158298141D1*t125*t252-0.4111834438919023D0/t49
     #/t36*t249+0.1644733775567609D1*t143*t252-0.5346380647307093D-1
     #/t42/t36*t249+0.3207828388384256D0*t146*t252)*t150
      v2rhob2(i) = s2-0.2194041046136074D0*t130*t44/t131/t53*t281*t150
     #+0.9661385830396828D-4*t40*t233*t256*t57-0.932245253120402D-2
     #*t40*t8*t125*t132*t151+0.3528452312325027D1*t130*t44/t295*t281
     #/t298+0.56D0*t4*(-1.D0*(0.4165333333333333D-1*t304
     #-0.2316960637004517D-1*t304*t12+0.9358098696468651D-1*t311*t12
     #-0.4562593008900494D-1*t70*sigmabb/t216/t5*t12
     #-0.1798826666666667D-4*t322-0.1157333333333333D-4*t324)*t26+2.D0
     #*t84*t88*t99-2.D0*t334*t335+t89*(0.7952D-1*t15*t183*t21+0.1704D0
     #*t304*t95-0.4544D-1*t311*t344+0.1933129408891288D-4*t322
     #+0.1243741347632263D-4*t324))+0.1493333333333333D1*t3*t101
      v2sigmaaa2(i) = 0.D0
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      t361 = 1/sigmabb
      t363 = t320*t361*t8
      t366 = 1/t15/sigmabb
      t368 = t78*t366*t16
      t376 = t177**2
      t399 = t105*t108
      v2sigmabb2(i) = 0.56D0*t4*(-1.D0*(0.7798415580390543D-2*t160*t12
     #-0.6416146418766319D-2*sigmabb*t217*t12-0.25296D-5*t363+0.93D-6
     #*t368)*t26+2.D0*t168*t88*t177-2.D0*t334*t376+t89*(-0.639D-2*t366
     #*t16*t21+0.639D-2*t361*t8*t95-0.639D-2*t160*t344
     #+0.2718463231253374D-5*t363-0.9994350114902112D-6*t368))
     #-0.2955042261008415D-4*t215/t72*t44*t57-0.1296071167108954D-3
     #*t399*t110
      v2taua2(i) = 0.D0
      v2taub2(i) = 0.D0
      v2tauab(i) = 0.D0
      v2rhoataua(i) = 0.D0
      v2rhoataub(i) = 0.D0
      v2rhobtaua(i) = 0.D0
      v2rhobtaub(i) = -0.6912379557914422D-3*t399*t111
     #+0.2273809065103428D-2*t189+0.1449207874559524D-3*t35*t8*t204
     #+0.1097020523068037D0*t191*t44*t224*t150
      v2sigmaaataua(i) = 0.D0
      v2sigmaaataub(i) = 0.D0
      v2sigmaabtaua(i) = 0.D0
      v2sigmaabtaub(i) = 0.D0
      v2sigmabbtaua(i) = 0.D0
      v2sigmabbtaub(i) = 0.2592142334217908D-3*t105*t183*t110
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      taua = dmax1(0.D0,taua1(i))
      tau = taua
      t3 = rhoa**(1.D0/3.D0)
      t4 = t3*rhoa
      t5 = rhoa**2
      t6 = t3**2
      t8 = 1/t6/t5
      t9 = sigmaaa*t8
      t12 = dexp(-0.16455D1*t9)
      t15 = dsqrt(sigmaaa)
      t16 = 1/t4
      t17 = t15*t16
      t18 = t17**0.372D1
      t20 = 0.426D-2*t9-0.2369618833300074D-2*t9*t12-0.1D-5*t18
      t21 = dlog(t17+dsqrt(1+t17**2))
      t25 = 1.D0+0.2556D-1*t17*t21+0.1074661302677646D-5*t18
      t26 = 1/t25
      t29 = -0.9305257363491D0-1.D0*t20*t26
      t33 = 1.D0+0.38D-1*t9
      t34 = t33**2
      t35 = 1/t34
      t36 = 1/rhoa
      t39 = taua-0.25D0*sigmaaa*t36
      t40 = t35*t39
      t41 = 1/t6
      t42 = t36**(1.D0/3.D0)
      t44 = 1.D0+0.1274696188700087D0*t42
      t46 = t36**(1.D0/6.D0)
      t49 = dsqrt(t36)
      t51 = t42**2
      t53 = 0.1112037486309468D2*t46+0.3844746237447211D1*t42
     #+0.1644733775567609D1*t49+0.2405871291288192D0*t51
      t56 = 1.D0+0.3216395899738507D2/t53
      t57 = dlog(t56)
      zk(i) = 0.56D0*t4*t29-0.3410713597655142D-2*t40*t41*t44*t57
      t63 = t5*rhoa
      t65 = 1/t6/t63
      t66 = sigmaaa*t65
      t70 = sigmaaa**2
      t71 = t5**2
      t72 = t71*t5
      t74 = 1/t3/t72
      t78 = t17**0.272D1
      t79 = t78*t15
      t81 = 1/t3/t5
      t82 = t79*t81
      t84 = -0.1136D-1*t66+0.6318983555466863D-2*t66*t12
     #-0.1039788744052072D-1*t70*t74*t12+0.496D-5*t82
      t87 = t25**2
      t88 = 1/t87
      t89 = t20*t88
      t93 = 1.D0+t9
      t94 = dsqrt(t93)
      t95 = 1/t94
      t99 = -0.3408D-1*t15*t81*t21-0.3408D-1*t66*t95
     #-0.5330320061281126D-5*t82
      t101 = -1.D0*t84*t26+t89*t99
      t105 = 1/t34/t33
      t106 = t105*t39
      t108 = 1/t3/t71
      t110 = t44*t57
      t111 = t110*sigmaaa
      t114 = t35*sigmaaa
      t116 = t8*t44*t57
      t120 = 1/t6/rhoa
      t125 = 1/t51
      t130 = t40*t41
      t131 = t53**2
      t132 = 1/t131
      t133 = t44*t132
      t134 = t46**2
      t135 = t134**2
      t136 = t135*t46
      t137 = 1/t136
      t138 = 1/t5
      t143 = 1/t49
      t146 = 1/t42
      t149 = -0.1853395810515781D1*t137*t138-0.128158207914907D1*t125
     #*t138-0.8223668877838045D0*t143*t138-0.1603914194192128D0*t146
     #*t138
      t150 = 1/t56
      t151 = t149*t150
      t152 = t133*t151
      vrhoa(i) = 0.7466666666666667D0*t3*t29+0.56D0*t4*t101
     #-0.6912379557914422D-3*t106*t108*t111-0.8526783994137856D-3*t114
     #*t116+0.2273809065103428D-2*t40*t120*t44*t57
     #+0.1449207874559524D-3*t40*t8*t125*t57+0.1097020523068037D0*t130
     #*t152
      vrhob(i) = 0.D0
      t160 = 1/t3/t71/rhoa
      t164 = 1/t15
      t166 = t78*t164*t16
      t168 = 0.426D-2*t8-0.2369618833300074D-2*t8*t12
     #+0.3899207790195271D-2*sigmaaa*t160*t12-0.186D-5*t166
      t177 = 0.1278D-1*t164*t16*t21+0.1278D-1*t8*t95
     #+0.1998870022980422D-5*t166
      t183 = 1/t3/t63
      t189 = t35*t120*t110
      vsigmaaa(i) = 0.56D0*t4*(-1.D0*t168*t26+t89*t177)
     #+0.2592142334217908D-3*t106*t183*t44*t57+0.8526783994137856D-3
     #*t189
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      t191 = t35*t41
      vtaua(i) = -0.3410713597655142D-2*t191*t110
      vtaub(i) = 0.D0
      t199 = 1/t6/t71
      t200 = sigmaaa*t199
      t207 = t70/t3/t71/t63
      t211 = t71**2
      t217 = t17**0.172D1
      t219 = t217*sigmaaa*t199
      t221 = t79*t183
      t231 = t20/t87/t25
      t232 = t99**2
      t241 = 1/t94/t93
      t263 = t34**2
      t265 = 1/t263*t39
      t266 = 1/t211
      t277 = t125*t57
      t283 = t132*t149
      t292 = t131**2
      t295 = t149**2
      t296 = t56**2
      t304 = 1/t71
      t307 = 1/t63
      t311 = 1/t51/t36
      s1 = 0.2488888888888889D0*t41*t29+0.1493333333333333D1*t3*t101
     #+0.56D0*t4*(-1.D0*(0.4165333333333333D-1*t200
     #-0.2316960637004517D-1*t200*t12+0.9358098696468651D-1*t207*t12
     #-0.4562593008900494D-1*t70*sigmaaa/t211/t5*t12
     #-0.1798826666666667D-4*t219-0.1157333333333333D-4*t221)*t26+2.D0
     #*t84*t88*t99-2.D0*t231*t232+t89*(0.7952D-1*t15*t183*t21+0.1704D0
     #*t200*t95-0.4544D-1*t207*t241+0.1933129408891288D-4*t219
     #+0.1243741347632263D-4*t221))+0.7246039372797621D-4*t114*t199
     #*t125*t57+0.5485102615340186D-1*t114*t8*t152
     #-0.378968177517238D-2*t40*t116+0.3456189778957211D-2*t106*t160
     #*t111-0.2101363385605984D-3*t265*t266*t110*t70
     #-0.3456189778957211D-3*t105*t70*t74*t44*t57
      v2rhoa2(i) = s1+0.5874122584881271D-4*t106*t74*t277*sigmaaa
     #+0.4446589853502444D-1*t106*t108*t44*t283*t150*sigmaaa
     #+0.2842261331379285D-2*t114*t65*t44*t57+0.3528452312325027D1
     #*t130*t44/t292*t295/t296+0.1097020523068037D0*t130*t133*(
     #-0.1544496508763151D1/t136/t36*t304+0.3706791621031562D1*t137
     #*t307-0.854388052766047D0*t311*t304+0.2563164158298141D1*t125
     #*t307-0.4111834438919023D0/t49/t36*t304+0.1644733775567609D1
     #*t143*t307-0.5346380647307093D-1/t42/t36*t304
     #+0.3207828388384256D0*t146*t307)*t150+0.9661385830396828D-4*t40
     #*t199*t311*t57-0.932245253120402D-2*t40*t8*t125*t132*t151
     #-0.2194041046136074D0*t130*t44/t131/t53*t295*t150
     #-0.4830692915198414D-3*t40*t65*t125*t57-0.1462694030757383D0*t40
     #*t120*t152
      v2rhob2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t361 = 1/sigmaaa
      t363 = t217*t361*t8
      t366 = 1/t15/sigmaaa
      t368 = t78*t366*t16
      t376 = t177**2
      t399 = t105*t108
      v2sigmaaa2(i) = 0.56D0*t4*(-1.D0*(0.7798415580390543D-2*t160*t12
     #-0.6416146418766319D-2*sigmaaa*t266*t12-0.25296D-5*t363+0.93D-6
     #*t368)*t26+2.D0*t168*t88*t177-2.D0*t231*t376+t89*(-0.639D-2*t366
     #*t16*t21+0.639D-2*t361*t8*t95-0.639D-2*t160*t241
     #+0.2718463231253374D-5*t363-0.9994350114902112D-6*t368))
     #-0.2955042261008415D-4*t265/t72*t44*t57-0.1296071167108954D-3
     #*t399*t110
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      v2sigmabb2(i) = 0.D0
      v2taua2(i) = 0.D0
      v2taub2(i) = 0.D0
      v2tauab(i) = 0.D0
      v2rhoataua(i) = -0.6912379557914422D-3*t399*t111
     #+0.2273809065103428D-2*t189+0.1449207874559524D-3*t35*t8*t277
     #+0.1097020523068037D0*t191*t44*t283*t150
      v2rhoataub(i) = 0.D0
      v2rhobtaua(i) = 0.D0
      v2rhobtaub(i) = 0.D0
      v2sigmaaataua(i) = 0.2592142334217908D-3*t105*t183*t110
      v2sigmaaataub(i) = 0.D0
      v2sigmaabtaua(i) = 0.D0
      v2sigmaabtaub(i) = 0.D0
      v2sigmabbtaua(i) = 0.D0
      v2sigmabbtaub(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      taua = dmax1(0.D0,taua1(i))
      taub = dmax1(0.D0,taub1(i))
      tau = taua+taub
      t6 = rhoa**(1.D0/3.D0)
      t7 = t6*rhoa
      t8 = rhoa**2
      t9 = t6**2
      t11 = 1/t9/t8
      t12 = sigmaaa*t11
      t15 = dexp(-0.16455D1*t12)
      t18 = dsqrt(sigmaaa)
      t19 = 1/t7
      t20 = t18*t19
      t21 = t20**0.372D1
      t23 = 0.426D-2*t12-0.2369618833300074D-2*t12*t15-0.1D-5*t21
      t24 = dlog(t20+dsqrt(1+t20**2))
      t28 = 1.D0+0.2556D-1*t20*t24+0.1074661302677646D-5*t21
      t29 = 1/t28
      t32 = -0.9305257363491D0-1.D0*t23*t29
      t36 = 1.D0+0.38D-1*t12
      t37 = t36**2
      t38 = 1/t37
      t39 = 1/rhoa
      t42 = taua-0.25D0*sigmaaa*t39
      t43 = t38*t42
      t44 = 1/t9
      t45 = t39**(1.D0/3.D0)
      t47 = 1.D0+0.1274696188700087D0*t45
      t49 = t39**(1.D0/6.D0)
      t52 = dsqrt(t39)
      t54 = t45**2
      t56 = 0.1112037486309468D2*t49+0.3844746237447211D1*t45
     #+0.1644733775567609D1*t52+0.2405871291288192D0*t54
      t59 = 1.D0+0.3216395899738507D2/t56
      t60 = dlog(t59)
      t64 = rhob**(1.D0/3.D0)
      t65 = t64*rhob
      t66 = rhob**2
      t67 = t64**2
      t69 = 1/t67/t66
      t70 = sigmabb*t69
      t73 = dexp(-0.16455D1*t70)
      t76 = dsqrt(sigmabb)
      t77 = 1/t65
      t78 = t76*t77
      t79 = t78**0.372D1
      t81 = 0.426D-2*t70-0.2369618833300074D-2*t70*t73-0.1D-5*t79
      t82 = dlog(t78+dsqrt(1+t78**2))
      t86 = 1.D0+0.2556D-1*t78*t82+0.1074661302677646D-5*t79
      t87 = 1/t86
      t90 = -0.9305257363491D0-1.D0*t81*t87
      t94 = 1.D0+0.38D-1*t70
      t95 = t94**2
      t96 = 1/t95
      t97 = 1/rhob
      t100 = taub-0.25D0*sigmabb*t97
      t101 = t96*t100
      t102 = 1/t67
      t103 = t97**(1.D0/3.D0)
      t105 = 1.D0+0.1274696188700087D0*t103
      t107 = t97**(1.D0/6.D0)
      t110 = dsqrt(t97)
      t112 = t103**2
      t114 = 0.1112037486309468D2*t107+0.3844746237447211D1*t103
     #+0.1644733775567609D1*t110+0.2405871291288192D0*t112
      t117 = 1.D0+0.3216395899738507D2/t114
      t118 = dlog(t117)
      t124 = 1.D0+0.31D-2*t12+0.31D-2*t70
      t125 = 1/t124
      t126 = rhoa+rhob
      t127 = 1/t126
      t128 = t127**(1.D0/3.D0)
      t130 = 1.D0+0.1325688999052018D0*t128
      t131 = t127**(1.D0/6.D0)
      t134 = dsqrt(t127)
      t136 = t128**2
      t138 = 0.598255043577108D1*t131+0.2225569421150687D1*t128
     #+0.8004286349993634D0*t134+0.1897004325747559D0*t136
      t141 = 1.D0+0.1608197949869254D2/t138
      t142 = dlog(t141)
      t144 = 0.621814D-1*t130*t142
      t146 = 1.D0+0.6901399211255825D-1*t128
      t151 = 0.8157414703487641D1*t131+0.2247591863577616D1*t128
     #+0.4300972471276643D0*t134+0.1911512595127338D0*t136
      t154 = 1.D0+0.2960874997779344D2/t151
      t155 = dlog(t154)
      t156 = t146*t155
      t158 = rhoa-1.D0*rhob
      t159 = t158*t127
      t160 = 1.D0+t159
      t161 = t160**(1.D0/3.D0)
      t164 = 1.D0-1.D0*t159
      t165 = t164**(1.D0/3.D0)
      t167 = t161*t160+t165*t164-2.D0
      t168 = t158**2
      t169 = t168**2
      t170 = t126**2
      t171 = t170**2
      t172 = 1/t171
      t173 = t169*t172
      t175 = 1.D0-1.D0*t173
      t176 = t167*t175
      t178 = 0.3799552353702395D-1*t156*t176
      t180 = 1.D0+0.1274696188700087D0*t128
      t185 = 0.1112037486309468D2*t131+0.3844746237447211D1*t128
     #+0.1644733775567609D1*t134+0.2405871291288192D0*t136
      t188 = 1.D0+0.3216395899738507D2/t185
      t189 = dlog(t188)
      t192 = -0.310907D-1*t180*t189+t144
      t193 = t192*t167
      t195 = 0.1923661050931536D1*t193*t173
      t198 = rhoa*t47
      t201 = rhob*t105
      t204 = t126*(-t144+t178+t195)+0.310907D-1*t198*t60+0.310907D-1
     #*t201*t118
      zk(i) = 0.56D0*t7*t32-0.3410713597655142D-2*t43*t44*t47*t60
     #+0.56D0*t65*t90-0.3410713597655142D-2*t101*t102*t105*t118+t125
     #*t204
      t208 = t8*rhoa
      t210 = 1/t9/t208
      t211 = sigmaaa*t210
      t215 = sigmaaa**2
      t216 = t8**2
      t217 = t216*t8
      t219 = 1/t6/t217
      t223 = t20**0.272D1
      t224 = t223*t18
      t226 = 1/t6/t8
      t227 = t224*t226
      t229 = -0.1136D-1*t211+0.6318983555466863D-2*t211*t15
     #-0.1039788744052072D-1*t215*t219*t15+0.496D-5*t227
      t232 = t28**2
      t233 = 1/t232
      t234 = t23*t233
      t238 = 1.D0+t12
      t239 = dsqrt(t238)
      t240 = 1/t239
      t244 = -0.3408D-1*t18*t226*t24-0.3408D-1*t211*t240
     #-0.5330320061281126D-5*t227
      t246 = -1.D0*t229*t29+t234*t244
      t250 = 1/t37/t36
      t251 = t250*t42
      t253 = 1/t6/t216
      t255 = t47*t60
      t256 = t255*sigmaaa
      t259 = t38*sigmaaa
      t261 = t11*t47*t60
      t265 = 1/t9/rhoa
      t270 = 1/t54
      t275 = t43*t44
      t276 = t56**2
      t277 = 1/t276
      t278 = t47*t277
      t279 = t49**2
      t280 = t279**2
      t281 = t280*t49
      t282 = 1/t281
      t283 = 1/t8
      t288 = 1/t52
      t291 = 1/t45
      t294 = -0.1853395810515781D1*t282*t283-0.128158207914907D1*t270
     #*t283-0.8223668877838045D0*t288*t283-0.1603914194192128D0*t291
     #*t283
      t295 = 1/t59
      t296 = t294*t295
      t297 = t278*t296
      t300 = t124**2
      t301 = 1/t300
      t302 = t301*t204
      t305 = 1/t136
      t306 = 1/t170
      t307 = t305*t306
      t308 = t307*t142
      t309 = 0.2747773264188438D-2*t308
      t310 = t138**2
      t311 = 1/t310
      t312 = t130*t311
      t313 = t131**2
      t314 = t313**2
      t315 = t314*t131
      t316 = 1/t315
      t317 = t316*t306
      t320 = 1/t134
      t321 = t320*t306
      t323 = 1/t128
      t324 = t323*t306
      t326 = -0.99709173929518D0*t317-0.7418564737168958D0*t307
     #-0.4002143174996817D0*t321-0.1264669550498372D0*t324
      t327 = 1/t141
      t329 = t312*t326*t327
      t330 = 0.1D1*t329
      t331 = t155*t167
      t332 = t331*t175
      t333 = t307*t332
      t334 = 0.8740742538988973D-3*t333
      t335 = t151**2
      t336 = 1/t335
      t337 = t146*t336
      t342 = -0.135956911724794D1*t317-0.7491972878592054D0*t307
     #-0.2150486235638321D0*t321-0.1274341730084892D0*t324
      t343 = t337*t342
      t344 = 1/t154
      t345 = t344*t167
      t346 = t345*t175
      t347 = t343*t346
      t348 = 0.1124999956683108D1*t347
      t349 = t158*t306
      t350 = 1.D0*t349
      t351 = t127-t350
      t354 = 1.D0*t127
      t355 = -t354+t349
      t358 = 0.1333333333333333D1*t161*t351+0.1333333333333333D1*t165
     #*t355
      t360 = t156*t358*t175
      t361 = 0.3799552353702395D-1*t360
      t362 = t168*t158
      t363 = t362*t172
      t364 = 4.D0*t363
      t366 = 1/t171/t126
      t367 = t169*t366
      t368 = 4.D0*t367
      t369 = -t364+t368
      t371 = t156*t167*t369
      t372 = 0.3799552353702395D-1*t371
      t375 = t185**2
      t376 = 1/t375
      t377 = t180*t376
      t382 = -0.1853395810515781D1*t317-0.128158207914907D1*t307
     #-0.8223668877838045D0*t321-0.1603914194192128D0*t324
      t383 = 1/t188
      t389 = 0.1321039893133927D-2*t307*t189+0.1D1*t377*t382*t383
     #-0.2747773264188438D-2*t308-0.1D1*t329
      t390 = t389*t167
      t391 = t390*t173
      t392 = 0.1923661050931536D1*t391
      t393 = t192*t358
      t394 = t393*t173
      t395 = 0.1923661050931536D1*t394
      t396 = t193*t363
      t398 = t193*t367
      t399 = 0.7694644203726145D1*t398
      t403 = t39*t270
      t406 = t277*t294
      t407 = t406*t295
      t410 = -t144+t178+t195+t126*(t309+t330-t334-t348+t361+t372+t392
     #+t395+0.7694644203726145D1*t396-t399)+0.310907D-1*t255
     #-0.1321039893133927D-2*t403*t60-0.1D1*t198*t407
      vrhoa(i) = 0.7466666666666667D0*t6*t32+0.56D0*t7*t246
     #-0.6912379557914422D-3*t251*t253*t256-0.8526783994137856D-3*t259
     #*t261+0.2273809065103428D-2*t43*t265*t47*t60
     #+0.1449207874559524D-3*t43*t11*t270*t60+0.1097020523068037D0
     #*t275*t297+0.8266666666666667D-2*t302*t211+t125*t410
      t414 = t66*rhob
      t416 = 1/t67/t414
      t417 = sigmabb*t416
      t421 = sigmabb**2
      t422 = t66**2
      t423 = t422*t66
      t425 = 1/t64/t423
      t429 = t78**0.272D1
      t430 = t429*t76
      t432 = 1/t64/t66
      t433 = t430*t432
      t435 = -0.1136D-1*t417+0.6318983555466863D-2*t417*t73
     #-0.1039788744052072D-1*t421*t425*t73+0.496D-5*t433
      t438 = t86**2
      t439 = 1/t438
      t440 = t81*t439
      t444 = 1.D0+t70
      t445 = dsqrt(t444)
      t446 = 1/t445
      t450 = -0.3408D-1*t76*t432*t82-0.3408D-1*t417*t446
     #-0.5330320061281126D-5*t433
      t452 = -1.D0*t435*t87+t440*t450
      t456 = 1/t95/t94
      t457 = t456*t100
      t459 = 1/t64/t422
      t461 = t105*t118
      t462 = t461*sigmabb
      t465 = t96*sigmabb
      t467 = t69*t105*t118
      t471 = 1/t67/rhob
      t476 = 1/t112
      t481 = t101*t102
      t482 = t114**2
      t483 = 1/t482
      t484 = t105*t483
      t485 = t107**2
      t486 = t485**2
      t487 = t486*t107
      t488 = 1/t487
      t489 = 1/t66
      t494 = 1/t110
      t497 = 1/t103
      t500 = -0.1853395810515781D1*t488*t489-0.128158207914907D1*t476
     #*t489-0.8223668877838045D0*t494*t489-0.1603914194192128D0*t497
     #*t489
      t501 = 1/t117
      t502 = t500*t501
      t503 = t484*t502
      t508 = -t354-t350
      t511 = t127+t349
      t514 = 0.1333333333333333D1*t161*t508+0.1333333333333333D1*t165
     #*t511
      t516 = t156*t514*t175
      t517 = 0.3799552353702395D-1*t516
      t518 = t364+t368
      t520 = t156*t167*t518
      t521 = 0.3799552353702395D-1*t520
      t522 = t192*t514
      t523 = t522*t173
      t524 = 0.1923661050931536D1*t523
      t529 = t97*t476
      t532 = t483*t500
      t533 = t532*t501
      t536 = -t144+t178+t195+t126*(t309+t330-t334-t348+t517+t521+t392
     #+t524-0.7694644203726145D1*t396-t399)+0.310907D-1*t461
     #-0.1321039893133927D-2*t529*t118-0.1D1*t201*t533
      vrhob(i) = 0.7466666666666667D0*t64*t90+0.56D0*t65*t452
     #-0.6912379557914422D-3*t457*t459*t462-0.8526783994137856D-3*t465
     #*t467+0.2273809065103428D-2*t101*t471*t105*t118
     #+0.1449207874559524D-3*t101*t69*t476*t118+0.1097020523068037D0
     #*t481*t503+0.8266666666666667D-2*t302*t417+t125*t536
      t543 = 1/t6/t216/rhoa
      t547 = 1/t18
      t548 = t223*t547
      t549 = t548*t19
      t551 = 0.426D-2*t11-0.2369618833300074D-2*t11*t15
     #+0.3899207790195271D-2*sigmaaa*t543*t15-0.186D-5*t549
      t560 = 0.1278D-1*t547*t19*t24+0.1278D-1*t11*t240
     #+0.1998870022980422D-5*t549
      t562 = -1.D0*t551*t29+t234*t560
      t566 = 1/t6/t208
      t571 = t38*t265
      t572 = t571*t255
      vsigmaaa(i) = 0.56D0*t7*t562+0.2592142334217908D-3*t251*t566*t47
     #*t60+0.8526783994137856D-3*t572-0.31D-2*t302*t11
      vsigmaab(i) = 0.D0
      t581 = 1/t64/t422/rhob
      t585 = 1/t76
      t586 = t429*t585
      t587 = t586*t77
      t589 = 0.426D-2*t69-0.2369618833300074D-2*t69*t73
     #+0.3899207790195271D-2*sigmabb*t581*t73-0.186D-5*t587
      t598 = 0.1278D-1*t585*t77*t82+0.1278D-1*t69*t446
     #+0.1998870022980422D-5*t587
      t600 = -1.D0*t589*t87+t440*t598
      t604 = 1/t64/t414
      t609 = t96*t471
      t610 = t609*t461
      vsigmabb(i) = 0.56D0*t65*t600+0.2592142334217908D-3*t457*t604
     #*t105*t118+0.8526783994137856D-3*t610-0.31D-2*t302*t69
      t614 = t38*t44
      vtaua(i) = -0.3410713597655142D-2*t614*t255
      t617 = t96*t102
      vtaub(i) = -0.3410713597655142D-2*t617*t461
      t621 = 1/t9/t216
      t622 = sigmaaa*t621
      t626 = t216*t208
      t629 = t215/t6/t626
      t633 = t216**2
      t639 = t20**0.172D1
      t641 = t639*sigmaaa*t621
      t643 = t224*t566
      t648 = t229*t233
      t653 = t23/t232/t28
      t654 = t244**2
      t663 = 1/t239/t238
      t681 = t270*t60
      t685 = t253*t47
      t696 = t37**2
      t698 = 1/t696*t42
      t699 = 1/t633
      s1 = 0.56D0*t7*(-1.D0*(0.4165333333333333D-1*t622
     #-0.2316960637004517D-1*t622*t15+0.9358098696468651D-1*t629*t15
     #-0.4562593008900494D-1*t215*sigmaaa/t633/t8*t15
     #-0.1798826666666667D-4*t641-0.1157333333333333D-4*t643)*t29+2.D0
     #*t648*t244-2.D0*t653*t654+t234*(0.7952D-1*t18*t566*t24+0.1704D0
     #*t622*t240-0.4544D-1*t629*t663+0.1933129408891288D-4*t641
     #+0.1243741347632263D-4*t643))+0.2488888888888889D0*t44*t32
     #+0.1493333333333333D1*t6*t246+0.3456189778957211D-2*t251*t543
     #*t256+0.5874122584881271D-4*t251*t219*t681*sigmaaa
      t715 = s1+0.4446589853502444D-1*t251*t685*t406*t295*sigmaaa
     #-0.3456189778957211D-3*t250*t215*t219*t47*t60
     #-0.2101363385605984D-3*t698*t699*t255*t215+0.2842261331379285D-2
     #*t259*t210*t47*t60+0.7246039372797621D-4*t259*t621*t270*t60
     #-0.1462694030757383D0*t43*t265*t297
      t727 = 1/t216
      t730 = 1/t208
      t734 = 1/t54/t39
      t751 = -0.1544496508763151D1/t281/t39*t727+0.3706791621031562D1
     #*t282*t730-0.854388052766047D0*t734*t727+0.2563164158298141D1
     #*t270*t730-0.4111834438919023D0/t52/t39*t727
     #+0.1644733775567609D1*t288*t730-0.5346380647307093D-1/t45/t39
     #*t727+0.3207828388384256D0*t291*t730
      t757 = 1/t276/t56
      t759 = t294**2
      t773 = t301*t410
      t776 = t276**2
      t777 = 1/t776
      t779 = t59**2
      t780 = 1/t779
      t789 = 1/t300/t124*t204
      t810 = 0.5495546528376876D-2*t308
      t811 = 0.2D1*t329
      t813 = 0.3847322101863073D1*t391
      t814 = 0.2249999913366216D1*t347
      t815 = 0.1748148507797795D-2*t333
      t818 = 0.1538928840745229D2*t398
      t822 = 1/t136/t127*t172
      t823 = t822*t142
      t824 = 0.1831848842792292D-2*t823
      t826 = 1/t170/t126
      t827 = t305*t826
      t829 = 0.1748148507797795D-2*t827*t332
      t830 = t310**2
      t833 = t326**2
      t834 = t141**2
      t837 = t130/t830*t833/t834
      t838 = 0.1608197949869254D2*t837
      t840 = 0.5827161692659315D-3*t822*t332
      t843 = 1/t315/t127*t172
      t845 = t316*t826
      t851 = 1/t134/t127*t172
      t853 = t320*t826
      t857 = 1/t128/t127*t172
      t859 = t323*t826
      t864 = 0.1124999956683108D1*t337*(-0.1132974264373283D1*t843
     #+0.271913823449588D1*t845-0.4994648585728036D0*t822
     #+0.1498394575718411D1*t827-0.1075243117819161D0*t851
     #+0.4300972471276643D0*t853-0.4247805766949639D-1*t857
     #+0.2548683460169784D0*t859)*t346
      t866 = t343*t345*t369
      t870 = t307*t311*t326*t327
      t871 = 0.8837926660346786D-1*t870
      t876 = 0.5176049209143758D-1*t307*t336*t342*t344*t176
      t878 = t307*t331*t369
      t882 = t343*t344*t358*t175
      t894 = t312*(-0.8309097827459833D0*t843+0.199418347859036D1*t845
     #-0.4945709824779306D0*t822+0.1483712947433792D1*t827
     #-0.2001071587498409D0*t851+0.8004286349993634D0*t853
     #-0.4215565168327908D-1*t857+0.2529339100996745D0*t859)*t327
      t895 = 0.1D1*t894
      t896 = t168*t172
      t897 = 12.D0*t896
      t898 = t362*t366
      t899 = 32.D0*t898
      t902 = t169/t171/t170
      t903 = 20.D0*t902
      t908 = t390*t363
      t910 = t335**2
      t913 = t342**2
      t915 = t154**2
      t920 = 0.3330984244245859D2*t146/t910*t913/t915*t167*t175
      t921 = t824+t829+t838-t840-t864-0.2249999913366216D1*t866-t871
     #+t876-0.1748148507797795D-2*t878-0.2249999913366216D1*t882+t895
     #+0.3799552353702395D-1*t156*t167*(-t897+t899-t903)
     #+0.1538928840745229D2*t908-t920
      t925 = t161**2
      t926 = 1/t925
      t927 = t351**2
      t930 = 2.D0*t306
      t932 = 2.D0*t158*t826
      t933 = -t930+t932
      t936 = t165**2
      t937 = 1/t936
      t938 = t355**2
      t944 = 0.4444444444444444D0*t926*t927+0.1333333333333333D1*t161
     #*t933+0.4444444444444444D0*t937*t938-0.1333333333333333D1*t165
     #*t933
      t950 = t307*t155*t358*t175
      t957 = 0.2249999913366216D1*t146/t335/t151*t913*t346
      t959 = t389*t358*t173
      t962 = 0.3847322101863073D2*t193*t902
      t963 = t193*t896
      t964 = 0.2308393261117844D2*t963
      t966 = 0.1538928840745229D2*t390*t367
      t974 = t130/t310/t138*t833*t327
      t975 = 0.2D1*t974
      t976 = t193*t898
      t978 = t393*t363
      t991 = t382**2
      t1007 = t375**2
      t1010 = t188**2
      t1016 = t827*t142
      t1022 = 0.8806932620892844D-3*t822*t189-0.2642079786267853D-2
     #*t827*t189-0.8497974591333914D-1*t307*t376*t382*t383-0.2D1*t180
     #/t375/t185*t991*t383+0.1D1*t377*(-0.1544496508763151D1*t843
     #+0.3706791621031562D1*t845-0.854388052766047D0*t822
     #+0.2563164158298141D1*t827-0.4111834438919023D0*t851
     #+0.1644733775567609D1*t853-0.5346380647307093D-1*t857
     #+0.3207828388384256D0*t859)*t383+0.3216395899738507D2*t180/t1007
     #*t991/t1010-0.1831848842792292D-2*t823+0.5495546528376876D-2
     #*t1016+0.8837926660346786D-1*t870+0.2D1*t974-0.1D1*t894
     #-0.1608197949869254D2*t837
      t1025 = 0.1923661050931536D1*t1022*t167*t173
      t1026 = t393*t367
      t1028 = 0.5495546528376876D-2*t1016
      t1029 = 0.7599104707404789D-1*t156*t358*t369
     #+0.3799552353702395D-1*t156*t944*t175-0.1748148507797795D-2*t950
     #+t957+0.3847322101863073D1*t959+t962+t964-t966
     #+0.1923661050931536D1*t192*t944*t173-t975-0.6155715362980916D2
     #*t976+0.1538928840745229D2*t978+t1025-0.1538928840745229D2*t1026
     #-t1028
      t1032 = -0.2D1*t297-0.1D1*t198*t277*t751*t295+0.2D1*t198*t757
     #*t759*t295-0.8806932620892844D-3*t730*t734*t60
     #+0.8497974591333914D-1*t403*t407-0.3216395899738507D2*t198*t777
     #*t759*t780+t810+t811+0.7599104707404789D-1*t360+t813-t814-t815
     #+0.7599104707404789D-1*t371+0.1538928840745229D2*t396-t818
     #+0.3847322101863073D1*t394+t126*(t921+t1029)
      t1034 = -0.4830692915198414D-3*t43*t210*t270*t60
     #-0.378968177517238D-2*t43*t261+0.5485102615340186D-1*t259*t11
     #*t297+0.1097020523068037D0*t275*t278*t751*t295
     #-0.2194041046136074D0*t275*t47*t757*t759*t295
     #+0.9661385830396828D-4*t43*t621*t734*t60-0.932245253120402D-2
     #*t43*t11*t270*t277*t296+0.1653333333333333D-1*t773*t211
     #+0.3528452312325027D1*t275*t47*t777*t759*t780
     #-0.3031111111111111D-1*t302*t622+0.1366755555555556D-3*t789*t629
     #+t125*t1032
      v2rhoa2(i) = t715+t1034
      t1038 = 1/t67/t422
      t1039 = sigmabb*t1038
      t1043 = t422*t414
      t1046 = t421/t64/t1043
      t1050 = t422**2
      t1056 = t78**0.172D1
      t1058 = t1056*sigmabb*t1038
      t1060 = t430*t604
      t1065 = t435*t439
      t1070 = t81/t438/t86
      t1071 = t450**2
      t1080 = 1/t445/t444
      t1095 = t95**2
      t1097 = 1/t1095*t100
      t1098 = 1/t1050
      t1109 = t476*t118
      t1113 = t459*t105
      t1123 = t301*t536
      s1 = 0.1493333333333333D1*t64*t452+0.56D0*t65*(-1.D0*
     #(0.4165333333333333D-1*t1039-0.2316960637004517D-1*t1039*t73
     #+0.9358098696468651D-1*t1046*t73-0.4562593008900494D-1*t421
     #*sigmabb/t1050/t66*t73-0.1798826666666667D-4*t1058
     #-0.1157333333333333D-4*t1060)*t87+2.D0*t1065*t450-2.D0*t1070
     #*t1071+t440*(0.7952D-1*t76*t604*t82+0.1704D0*t1039*t446
     #-0.4544D-1*t1046*t1080+0.1933129408891288D-4*t1058
     #+0.1243741347632263D-4*t1060))+0.2488888888888889D0*t102*t90
     #+0.3456189778957211D-2*t457*t581*t462-0.2101363385605984D-3
     #*t1097*t1098*t461*t421
      t1130 = s1-0.3456189778957211D-3*t456*t421*t425*t105*t118
     #+0.5874122584881271D-4*t457*t425*t1109*sigmabb
     #+0.4446589853502444D-1*t457*t1113*t532*t501*sigmabb
     #+0.2842261331379285D-2*t465*t416*t105*t118+0.1653333333333333D-1
     #*t1123*t417+0.7246039372797621D-4*t465*t1038*t476*t118
      t1144 = 1/t112/t97
      t1155 = 1/t482/t114
      t1157 = t500**2
      t1164 = 1/t422
      t1167 = 1/t414
      t1186 = -0.1544496508763151D1/t487/t97*t1164
     #+0.3706791621031562D1*t488*t1167-0.854388052766047D0*t1144*t1164
     #+0.2563164158298141D1*t476*t1167-0.4111834438919023D0/t110/t97
     #*t1164+0.1644733775567609D1*t494*t1167-0.5346380647307093D-1
     #/t103/t97*t1164+0.3207828388384256D0*t497*t1167
      t1191 = t482**2
      t1192 = 1/t1191
      t1194 = t117**2
      t1195 = 1/t1194
      t1207 = t824+t829+t838-t840-t864-t871+t876+t895
     #-0.1538928840745229D2*t908-t920+t957+t962+t964-t966
      t1210 = t389*t514*t173
      t1212 = t522*t367
      t1214 = t508**2
      t1217 = t930+t932
      t1220 = t511**2
      t1226 = 0.4444444444444444D0*t926*t1214+0.1333333333333333D1
     #*t161*t1217+0.4444444444444444D0*t937*t1220-0.1333333333333333D1
     #*t165*t1217
      t1242 = t307*t155*t514*t175
      t1244 = t522*t363
      t1248 = t343*t344*t514*t175
      t1251 = t307*t331*t518
      t1254 = t343*t345*t518
      t1256 = -t975+0.6155715362980916D2*t976+t1025
     #+0.3847322101863073D1*t1210-0.1538928840745229D2*t1212
     #+0.1923661050931536D1*t192*t1226*t173-t1028
     #+0.3799552353702395D-1*t156*t1226*t175+0.7599104707404789D-1
     #*t156*t514*t518+0.3799552353702395D-1*t156*t167*(-t897-t899-t903
     #)-0.1748148507797795D-2*t1242-0.1538928840745229D2*t1244
     #-0.2249999913366216D1*t1248-0.1748148507797795D-2*t1251
     #-0.2249999913366216D1*t1254
      t1277 = t810+t811+t813-t814-t815-0.1538928840745229D2*t396-t818
     #+0.7599104707404789D-1*t516+0.7599104707404789D-1*t520
     #+0.3847322101863073D1*t523+t126*(t1207+t1256)-0.2D1*t503
     #-0.8806932620892844D-3*t1167*t1144*t118+0.8497974591333914D-1
     #*t529*t533+0.2D1*t201*t1155*t1157*t501-0.1D1*t201*t483*t1186
     #*t501-0.3216395899738507D2*t201*t1192*t1157*t1195
      t1281 = 0.5485102615340186D-1*t465*t69*t503-0.378968177517238D-2
     #*t101*t467-0.4830692915198414D-3*t101*t416*t476*t118
     #-0.1462694030757383D0*t101*t471*t503+0.9661385830396828D-4*t101
     #*t1038*t1144*t118-0.932245253120402D-2*t101*t69*t476*t483*t502
     #-0.2194041046136074D0*t481*t105*t1155*t1157*t501
     #+0.1097020523068037D0*t481*t484*t1186*t501+0.3528452312325027D1
     #*t481*t105*t1192*t1157*t1195+0.1366755555555556D-3*t789*t1046
     #+t125*t1277-0.3031111111111111D-1*t302*t1039
      v2rhob2(i) = t1130+t1281
      t1307 = 0.4444444444444444D0*t926*t351*t508+0.2666666666666667D1
     #*t161*t158*t826+0.4444444444444444D0*t937*t355*t511
     #-0.2666666666666667D1*t165*t158*t826
      t1318 = t824+t829+t838-t840-t864+0.3799552353702395D-1*t156*t167
     #*(t897-t903)+0.3799552353702395D-1*t156*t1307*t175
     #-0.1124999956683108D1*t866-t871+t876-0.8740742538988973D-3*t878
     #-0.1124999956683108D1*t882+t895-t920+0.3799552353702395D-1*t156
     #*t514*t369-0.8740742538988973D-3*t950+t957
      t1336 = 0.3799552353702395D-1*t156*t358*t518
     #+0.1923661050931536D1*t192*t1307*t173+0.1923661050931536D1*t959
     #+t962-0.2308393261117844D2*t963-t966-t975-0.7694644203726145D1
     #*t978+t1025-0.7694644203726145D1*t1026+0.1923661050931536D1
     #*t1210-0.7694644203726145D1*t1212-t1028-0.8740742538988973D-3
     #*t1242+0.7694644203726145D1*t1244-0.1124999956683108D1*t1248
     #-0.8740742538988973D-3*t1251-0.1124999956683108D1*t1254
      t1339 = t810+t811-t815-t814+t517+t521+t813+t524-t818+t361+t372
     #+t395+t126*(t1318+t1336)
      v2rhoab(i) = 0.1366755555555556D-3*t789*sigmaaa*t210*sigmabb
     #*t416+0.8266666666666667D-2*t1123*t211+0.8266666666666667D-2
     #*t773*t417+t125*t1339
      t1346 = sigmaaa*t219
      t1354 = t639*t210
      t1356 = t548*t226
      t1362 = t551*t233
      t1391 = t38*t11
      s1 = 0.7466666666666667D0*t6*t562+0.56D0*t7*(-1.D0*(-0.1136D-1
     #*t210+0.6318983555466863D-2*t210*t15-0.3119366232156217D-1*t1346
     #*t15+0.1710972378337685D-1*t215/t633/rhoa*t15+0.67456D-5*t1354
     #+0.248D-5*t1356)*t29+t648*t560+t1362*t244-2.D0*t653*t244*t560
     #+t234*(-0.1704D-1*t547*t226*t24-0.5112D-1*t210*t240+0.1704D-1
     #*t1346*t663-0.7249235283342332D-5*t1354-0.2665160030640563D-5
     #*t1356))+0.7880112696022441D-4*t698/t626*t256
     #+0.2376130473033082D-3*t250*t543*t256-0.8640474447393027D-3*t251
     #*t685*t60-0.1421130665689643D-2*t1391*t255
      v2rhoasigmaaa(i) = s1-0.1101397984665238D-4*t251*t543*t270*t60
     #-0.362301968639881D-4*t38*t210*t681-0.8337355975317082D-2*t251
     #*t566*t297-0.2742551307670093D-1*t571*t47*t407
     #-0.5125333333333333D-4*t789*t1346+0.8266666666666667D-2*t302
     #*t210-0.31D-2*t773*t11
      v2rhoasigmaab(i) = 0.D0
      v2rhoasigmabb(i) = -0.5125333333333333D-4*t789*t211*t69-0.31D-2
     #*t773*t69
      v2rhobsigmaaa(i) = -0.5125333333333333D-4*t789*t417*t11-0.31D-2
     #*t1123*t11
      v2rhobsigmaab(i) = 0.D0
      t1428 = sigmabb*t425
      t1436 = t1056*t416
      t1438 = t586*t432
      t1444 = t589*t439
      t1473 = t96*t69
      s1 = 0.7466666666666667D0*t64*t600+0.56D0*t65*(-1.D0*(-0.1136D-1
     #*t416+0.6318983555466863D-2*t416*t73-0.3119366232156217D-1*t1428
     #*t73+0.1710972378337685D-1*t421/t1050/rhob*t73+0.67456D-5*t1436
     #+0.248D-5*t1438)*t87+t1065*t598+t1444*t450-2.D0*t1070*t450*t598
     #+t440*(-0.1704D-1*t585*t432*t82-0.5112D-1*t416*t446+0.1704D-1
     #*t1428*t1080-0.7249235283342332D-5*t1436-0.2665160030640563D-5
     #*t1438))+0.7880112696022441D-4*t1097/t1043*t462
     #+0.2376130473033082D-3*t456*t581*t462-0.8640474447393027D-3*t457
     #*t1113*t118-0.1421130665689643D-2*t1473*t461
      v2rhobsigmabb(i) = s1-0.1101397984665238D-4*t457*t581*t476*t118
     #-0.362301968639881D-4*t96*t416*t1109-0.8337355975317082D-2*t457
     #*t604*t503-0.2742551307670093D-1*t609*t105*t533
     #-0.5125333333333333D-4*t789*t1428+0.8266666666666667D-2*t302
     #*t416-0.31D-2*t1123*t69
      t1500 = 1/sigmaaa
      t1502 = t639*t1500*t11
      t1505 = 1/t18/sigmaaa
      t1507 = t223*t1505*t19
      t1514 = t560**2
      t1537 = t250*t253
      v2sigmaaa2(i) = 0.56D0*t7*(-1.D0*(0.7798415580390543D-2*t543*t15
     #-0.6416146418766319D-2*sigmaaa*t699*t15-0.25296D-5*t1502+0.93D-6
     #*t1507)*t29+2.D0*t1362*t560-2.D0*t653*t1514+t234*(-0.639D-2
     #*t1505*t19*t24+0.639D-2*t1500*t11*t240-0.639D-2*t543*t663
     #+0.2718463231253374D-5*t1502-0.9994350114902112D-6*t1507))
     #-0.2955042261008415D-4*t698/t217*t47*t60-0.1296071167108954D-3
     #*t1537*t255+0.1922D-4*t789*t543
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.1922D-4*t789*t11*t69
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      t1549 = 1/sigmabb
      t1551 = t1056*t1549*t69
      t1554 = 1/t76/sigmabb
      t1556 = t429*t1554*t77
      t1563 = t598**2
      t1586 = t456*t459
      v2sigmabb2(i) = 0.56D0*t65*(-1.D0*(0.7798415580390543D-2*t581
     #*t73-0.6416146418766319D-2*sigmabb*t1098*t73-0.25296D-5*t1551
     #+0.93D-6*t1556)*t87+2.D0*t1444*t598-2.D0*t1070*t1563+t440*(
     #-0.639D-2*t1554*t77*t82+0.639D-2*t1549*t69*t446-0.639D-2*t581
     #*t1080+0.2718463231253374D-5*t1551-0.9994350114902112D-6*t1556))
     #-0.2955042261008415D-4*t1097/t423*t105*t118
     #-0.1296071167108954D-3*t1586*t461+0.1922D-4*t789*t581
      v2taua2(i) = 0.D0
      v2taub2(i) = 0.D0
      v2tauab(i) = 0.D0
      v2rhoataua(i) = -0.6912379557914422D-3*t1537*t256
     #+0.2273809065103428D-2*t572+0.1449207874559524D-3*t1391*t681
     #+0.1097020523068037D0*t614*t47*t407
      v2rhoataub(i) = 0.D0
      v2rhobtaua(i) = 0.D0
      v2rhobtaub(i) = -0.6912379557914422D-3*t1586*t462
     #+0.2273809065103428D-2*t610+0.1449207874559524D-3*t1473*t1109
     #+0.1097020523068037D0*t617*t105*t533
      v2sigmaaataua(i) = 0.2592142334217908D-3*t250*t566*t255
      v2sigmaabtaua(i) = 0.D0
      v2sigmabbtaua(i) = 0.D0
      v2sigmaaataub(i) = 0.D0
      v2sigmaabtaub(i) = 0.D0
      v2sigmabbtaub(i) = 0.2592142334217908D-3*t456*t604*t461
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      v2rhob2(i) = 0.0d0
      v2rhoab(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2rhoasigmaab(i) = 0.0d0
      v2rhoasigmabb(i) = 0.0d0
      v2rhobsigmaaa(i) = 0.0d0
      v2rhobsigmaab(i) = 0.0d0
      v2rhobsigmabb(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      v2sigmaab2(i) = 0.0d0
      v2sigmabb2(i) = 0.0d0
      v2sigmaaaab(i) = 0.0d0
      v2sigmaaabb(i) = 0.0d0
      v2sigmaabbb(i) = 0.0d0
      vtaua(i) = 0.0d0
      vtaub(i) = 0.0d0
      v2rhoataua(i) = 0.0d0
      v2rhoataub(i) = 0.0d0
      v2rhobtaua(i) = 0.0d0
      v2rhobtaub(i) = 0.0d0
      v2taua2(i) = 0.0d0
      v2taub2(i) = 0.0d0
      v2tauab(i) = 0.0d0
      v2sigmaaataua(i) = 0.0d0
      v2sigmaaataub(i) = 0.0d0
      v2sigmaabtaua(i) = 0.0d0
      v2sigmaabtaub(i) = 0.0d0
      v2sigmabbtaua(i) = 0.0d0
      v2sigmabbtaub(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end
      
      
      subroutine rks_xc_mpwb1k
     & (ideriv,npt,rhoa1,sigmaaa1,taua1,
     &  zk,vrhoa,vsigmaaa,vtaua,
     &  v2rhoa2,v2rhoasigmaaa,v2sigmaaa2,
     &  v2rhoataua,v2sigmaaataua,v2taua2)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt)
      REAL sigmaaa1(npt)
      REAL taua1(npt)
      REAL zk(npt),vrhoa(npt),vsigmaaa(npt),vtaua(npt)
      REAL v2rhoa2(npt),v2rhoasigmaaa(npt),v2sigmaaa2(npt)
      REAL v2rhoataua(npt),v2sigmaaataua(npt),v2taua2(npt)
      parameter(tol=1.0d-20)
      
      if(ideriv.eq.0) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      tau = dmax1(0.D0,taua1(i))
      t3 = rho**(1.D0/3.D0)
      t4 = t3*rho
      t5 = rho**2
      t6 = t3**2
      t9 = sigma/t6/t5
      t12 = dexp(-0.2612068431013672D1*t9)
      t15 = dsqrt(sigma)
      t17 = t15/t4
      t18 = t17**0.372D1
      t22 = dlog(0.1259921049894873D1*t17+dsqrt(1+0.1587401051968199D1
     #*t17**2))
      t35 = (1.D0+0.6032123997479158D-1*t9)**2
      t38 = 1/rho
      t44 = t38**(1.D0/3.D0)
      t46 = 1.D0+0.1606016560364007D0*t44
      t48 = t38**(1.D0/6.D0)
      t51 = dsqrt(t38)
      t53 = t44**2
      t59 = dlog(1.D0+0.3216395899738507D2/(0.1248219874679732D2*t48
     #+0.4844076716063854D1*t44+0.2326004811900819D1*t51
     #+0.3819082618690966D0*t53))
      t77 = dlog(1.D0+0.1608197949869254D2/(0.598255043577108D1*t48
     #+0.2225569421150687D1*t44+0.8004286349993634D0*t51
     #+0.1897004325747559D0*t53))
      zk(i) = 0.4444722945510959D0*t4*(-0.9305257363491D0-1.D0*
     #(0.676232848138453D-2*t9-0.3761535428744195D-2*t9*t12
     #-0.2361985322859061D-5*t18)/(1.D0+0.3220358203531296D-1*t17*t22
     #+0.25383342239692D-5*t18))-0.1082834070576003D-1/t35*(0.5D0*tau
     #-0.125D0*sigma*t38)/t6*t46*t59+1/(1.D0+0.9841886522202837D-2*t9)
     #*(-0.621814D-1*rho*(1.D0+0.1325688999052018D0*t44)*t77
     #+0.310907D-1*rho*t46*t59)
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      tau = dmax1(0.D0,taua1(i))
      t3 = rho**(1.D0/3.D0)
      t4 = t3*rho
      t5 = rho**2
      t6 = t3**2
      t8 = 1/t6/t5
      t9 = sigma*t8
      t12 = dexp(-0.2612068431013672D1*t9)
      t15 = dsqrt(sigma)
      t16 = 1/t4
      t17 = t15*t16
      t18 = t17**0.372D1
      t20 = 0.676232848138453D-2*t9-0.3761535428744195D-2*t9*t12
     #-0.2361985322859061D-5*t18
      t22 = dlog(0.1259921049894873D1*t17+dsqrt(1+0.1587401051968199D1
     #*t17**2))
      t26 = 1.D0+0.3220358203531296D-1*t17*t22+0.25383342239692D-5*t18
      t27 = 1/t26
      t30 = -0.9305257363491D0-1.D0*t20*t27
      t34 = 1.D0+0.6032123997479158D-1*t9
      t35 = t34**2
      t36 = 1/t35
      t38 = 1/rho
      t41 = 0.5D0*tau-0.125D0*sigma*t38
      t42 = t36*t41
      t43 = 1/t6
      t44 = t38**(1.D0/3.D0)
      t46 = 1.D0+0.1606016560364007D0*t44
      t48 = t38**(1.D0/6.D0)
      t51 = dsqrt(t38)
      t53 = t44**2
      t55 = 0.1248219874679732D2*t48+0.4844076716063854D1*t44
     #+0.2326004811900819D1*t51+0.3819082618690966D0*t53
      t58 = 1.D0+0.3216395899738507D2/t55
      t59 = dlog(t58)
      t64 = 1.D0+0.9841886522202837D-2*t9
      t65 = 1/t64
      t67 = 1.D0+0.1325688999052018D0*t44
      t73 = 0.598255043577108D1*t48+0.2225569421150687D1*t44
     #+0.8004286349993634D0*t51+0.1897004325747559D0*t53
      t76 = 1.D0+0.1608197949869254D2/t73
      t77 = dlog(t76)
      t80 = rho*t46
      t83 = -0.621814D-1*rho*t67*t77+0.310907D-1*t80*t59
      zk(i) = 0.4444722945510959D0*t4*t30-0.1082834070576003D-1*t42
     #*t43*t46*t59+t65*t83
      t87 = t5*rho
      t90 = sigma/t6/t87
      t94 = sigma**2
      t95 = t5**2
      t102 = t17**0.272D1
      t105 = 1/t3/t5
      t106 = t102*t15*t105
      t111 = t26**2
      t113 = t20/t111
      t119 = dsqrt(1.D0+0.1587401051968199D1*t9)
      t120 = 1/t119
      t131 = 1/t35/t34*t41
      t135 = t46*t59
      t145 = 1/t6/rho
      t150 = 1/t53
      t156 = t55**2
      t157 = 1/t156
      t159 = t48**2
      t160 = t159**2
      t163 = 1/t5
      t164 = 1/t160/t48*t163
      t166 = t150*t163
      t169 = 1/t51*t163
      t172 = 1/t44*t163
      t174 = -0.4160732915599108D1*t164-0.3229384477375903D1*t166
     #-0.2326004811900819D1*t169-0.5092110158254621D0*t172
      t175 = 1/t58
      t180 = t64**2
      t182 = 1/t180*t83
      t189 = t73**2
      s1 = 0.5926297260681278D0*t3*t30+0.2222361472755479D0*t4*(-1.D0*
     #(-0.3606575190071749D-1*t90+0.200615222866357D-1*t90*t12
     #-0.5240206904299834D-1*t94/t3/t95/t5*t12+0.2343089440276188D-4
     #*t106)*t27+t113*(-0.8587621876083455D-1*t15*t105*t22
     #-0.1081972557021525D0*t90*t120-0.2518027550177446D-4*t106))
     #-0.3483621003951759D-2*t131/t3/t95*t135*sigma
     #-0.1353542588220004D-2*t36*sigma*t8*t46*t59
      vrhoa(i) = s1+0.721889380384002D-2*t42*t145*t46*t59
     #+0.5796831498238097D-3*t42*t8*t150*t59+0.1741411532348907D0*t42
     #*t43*t46*t157*t174*t175+0.2624503072587423D-1*t182*t90+t65*(
     #-0.621814D-1*t67*t77+rho*(0.2747773264188438D-2*t166*t77+0.1D1
     #*t67/t189*(-0.99709173929518D0*t164-0.7418564737168958D0*t166
     #-0.4002143174996817D0*t169-0.1264669550498372D0*t172)/t76)
     #+0.310907D-1*t135-0.1664405969110308D-2*t38*t150*t59-0.5D0*t80
     #*t157*t174*t175)
      t222 = 1/t15
      t224 = t102*t222*t16
      vsigmaaa(i) = 0.4444722945510959D0*t4*(-1.D0*
     #(0.2704931392553812D-1*t8-0.1504614171497678D-1*t8*t12
     #+0.3930155178224876D-1*sigma/t3/t95/rho*t12
     #-0.1757317080207141D-4*t224)*t27+t113*(0.6440716407062592D-1
     #*t222*t16*t22+0.8114794177661436D-1*t8*t120
     #+0.1888520662633084D-4*t224))+0.5225431505927638D-2*t131/t3/t87
     #*t46*t59+0.5414170352880015D-2*t36*t145*t135
     #-0.3936754608881135D-1*t182*t8
      vtaua(i) = -0.5414170352880015D-2*t36*t43*t135
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vtaua(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      tau = dmax1(0.D0,taua1(i))
      t3 = rho**(1.D0/3.D0)
      t4 = t3*rho
      t5 = rho**2
      t6 = t3**2
      t8 = 1/t6/t5
      t9 = sigma*t8
      t12 = dexp(-0.2612068431013672D1*t9)
      t15 = dsqrt(sigma)
      t16 = 1/t4
      t17 = t15*t16
      t18 = t17**0.372D1
      t20 = 0.676232848138453D-2*t9-0.3761535428744195D-2*t9*t12
     #-0.2361985322859061D-5*t18
      t22 = dlog(0.1259921049894873D1*t17+dsqrt(1+0.1587401051968199D1
     #*t17**2))
      t26 = 1.D0+0.3220358203531296D-1*t17*t22+0.25383342239692D-5*t18
      t27 = 1/t26
      t30 = -0.9305257363491D0-1.D0*t20*t27
      t34 = 1.D0+0.6032123997479158D-1*t9
      t35 = t34**2
      t36 = 1/t35
      t38 = 1/rho
      t41 = 0.5D0*tau-0.125D0*sigma*t38
      t42 = t36*t41
      t43 = 1/t6
      t44 = t38**(1.D0/3.D0)
      t46 = 1.D0+0.1606016560364007D0*t44
      t48 = t38**(1.D0/6.D0)
      t51 = dsqrt(t38)
      t53 = t44**2
      t55 = 0.1248219874679732D2*t48+0.4844076716063854D1*t44
     #+0.2326004811900819D1*t51+0.3819082618690966D0*t53
      t58 = 1.D0+0.3216395899738507D2/t55
      t59 = dlog(t58)
      t64 = 1.D0+0.9841886522202837D-2*t9
      t65 = 1/t64
      t67 = 1.D0+0.1325688999052018D0*t44
      t73 = 0.598255043577108D1*t48+0.2225569421150687D1*t44
     #+0.8004286349993634D0*t51+0.1897004325747559D0*t53
      t76 = 1.D0+0.1608197949869254D2/t73
      t77 = dlog(t76)
      t80 = rho*t46
      t83 = -0.621814D-1*rho*t67*t77+0.310907D-1*t80*t59
      zk(i) = 0.4444722945510959D0*t4*t30-0.1082834070576003D-1*t42
     #*t43*t46*t59+t65*t83
      t87 = t5*rho
      t89 = 1/t6/t87
      t90 = sigma*t89
      t94 = sigma**2
      t95 = t5**2
      t96 = t95*t5
      t98 = 1/t3/t96
      t102 = t17**0.272D1
      t103 = t102*t15
      t105 = 1/t3/t5
      t106 = t103*t105
      t108 = -0.3606575190071749D-1*t90+0.200615222866357D-1*t90*t12
     #-0.5240206904299834D-1*t94*t98*t12+0.2343089440276188D-4*t106
      t111 = t26**2
      t112 = 1/t111
      t113 = t20*t112
      t118 = 1.D0+0.1587401051968199D1*t9
      t119 = dsqrt(t118)
      t120 = 1/t119
      t124 = -0.8587621876083455D-1*t15*t105*t22-0.1081972557021525D0
     #*t90*t120-0.2518027550177446D-4*t106
      t126 = -1.D0*t108*t27+t113*t124
      t130 = 1/t35/t34
      t131 = t130*t41
      t133 = 1/t3/t95
      t135 = t46*t59
      t136 = t135*sigma
      t139 = t36*sigma
      t141 = t8*t46*t59
      t145 = 1/t6/rho
      t150 = 1/t53
      t155 = t42*t43
      t156 = t55**2
      t157 = 1/t156
      t158 = t46*t157
      t159 = t48**2
      t160 = t159**2
      t161 = t160*t48
      t162 = 1/t161
      t163 = 1/t5
      t164 = t162*t163
      t166 = t150*t163
      t168 = 1/t51
      t169 = t168*t163
      t171 = 1/t44
      t172 = t171*t163
      t174 = -0.4160732915599108D1*t164-0.3229384477375903D1*t166
     #-0.2326004811900819D1*t169-0.5092110158254621D0*t172
      t175 = 1/t58
      t176 = t174*t175
      t177 = t158*t176
      t180 = t64**2
      t181 = 1/t180
      t182 = t181*t83
      t187 = t166*t77
      t189 = t73**2
      t190 = 1/t189
      t191 = t67*t190
      t196 = -0.99709173929518D0*t164-0.7418564737168958D0*t166
     #-0.4002143174996817D0*t169-0.1264669550498372D0*t172
      t197 = 1/t76
      t199 = t191*t196*t197
      t204 = t38*t150
      t207 = t157*t174
      t208 = t207*t175
      t211 = -0.621814D-1*t67*t77+rho*(0.2747773264188438D-2*t187
     #+0.1D1*t199)+0.310907D-1*t135-0.1664405969110308D-2*t204*t59
     #-0.5D0*t80*t208
      vrhoa(i) = 0.5926297260681278D0*t3*t30+0.2222361472755479D0*t4
     #*t126-0.3483621003951759D-2*t131*t133*t136-0.1353542588220004D-2
     #*t139*t141+0.721889380384002D-2*t42*t145*t46*t59
     #+0.5796831498238097D-3*t42*t8*t150*t59+0.1741411532348907D0*t155
     #*t177+0.2624503072587423D-1*t182*t90+t65*t211
      t218 = 1/t3/t95/rho
      t222 = 1/t15
      t223 = t102*t222
      t224 = t223*t16
      t226 = 0.2704931392553812D-1*t8-0.1504614171497678D-1*t8*t12
     #+0.3930155178224876D-1*sigma*t218*t12-0.1757317080207141D-4*t224
      t235 = 0.6440716407062592D-1*t222*t16*t22+0.8114794177661436D-1
     #*t8*t120+0.1888520662633084D-4*t224
      t237 = -1.D0*t226*t27+t113*t235
      t241 = 1/t3/t87
      t246 = t36*t145
      t247 = t246*t135
      vsigmaaa(i) = 0.4444722945510959D0*t4*t237+0.5225431505927638D-2
     #*t131*t241*t46*t59+0.5414170352880015D-2*t247
     #-0.3936754608881135D-1*t182*t8
      t251 = t36*t43
      vtaua(i) = -0.5414170352880015D-2*t251*t135
      t254 = 0.5495546528376876D-2*t187
      t255 = 0.2D1*t199
      t259 = t196**2
      t262 = 0.2D1*t67/t189/t73*t259*t197
      t263 = t189**2
      t266 = t76**2
      t270 = 0.1608197949869254D2*t67/t263*t259/t266
      t273 = 1/t95
      t274 = 1/t161/t38*t273
      t276 = 1/t87
      t277 = t162*t276
      t280 = 1/t53/t38
      t281 = t280*t273
      t283 = t150*t276
      t287 = 1/t51/t38*t273
      t289 = t168*t276
      t293 = 1/t44/t38*t273
      t295 = t171*t276
      t300 = 0.1D1*t191*(-0.8309097827459833D0*t274
     #+0.199418347859036D1*t277-0.4945709824779306D0*t281
     #+0.1483712947433792D1*t283-0.2001071587498409D0*t287
     #+0.8004286349993634D0*t289-0.4215565168327908D-1*t293
     #+0.2529339100996745D0*t295)*t197
      t302 = 0.1831848842792292D-2*t281*t77
      t304 = 0.5495546528376876D-2*t283*t77
      t308 = 0.8837926660346786D-1*t166*t190*t196*t197
      t319 = dlog(1.D0+0.2960874997779344D2/(0.8157414703487641D1*t48
     #+0.2247591863577616D1*t44+0.4300972471276643D0*t51
     #+0.1911512595127338D0*t53))
      t321 = (1.D0+0.6901399211255825D-1*t44)*t319*t163
      t332 = 1/t6/t95
      t333 = sigma*t332
      t337 = t95*t87
      t340 = t94/t3/t337
      t344 = t95**2
      t350 = t17**0.172D1
      t352 = t350*sigma*t332
      t354 = t103*t241
      t359 = t108*t112
      t364 = t20/t111/t26
      t365 = t124**2
      t374 = 1/t119/t118
      t394 = 1/t156/t55
      t396 = t174**2
      t418 = -0.6934554859331846D1*t274+0.1664293166239643D2*t277
     #-0.4305845969834537D1*t281+0.1291753790950361D2*t283
     #-0.2326004811900819D1*t287+0.9304019247603276D1*t289
     #-0.3394740105503081D0*t293+0.2036844063301848D1*t295
      t423 = t156**2
      t424 = 1/t423
      t426 = t58**2
      t427 = 1/t426
      s1 = t65*(t254+t255+rho*(-t262+t270+t300+t302-t304-t308
     #-0.3377379869957684D-1*t321))+0.3950864840454185D0*t43*t30
     #+0.1185259452136256D1*t3*t126+0.2222361472755479D0*t4*(-1.D0*
     #(0.2644821806052616D0*t333-0.1471178301019952D0*t333*t12
     #+0.9432372427739702D0*t340*t12-0.730014881424079D0*t94*sigma
     #/t344/t5*t12-0.1699520874013662D-3*t352-0.1093441738795555D-3
     #*t354)*t27+2.D0*t359*t124-2.D0*t364*t365+t113*
     #(0.4007556875505613D0*t15*t241*t22+0.1081972557021525D1*t333
     #*t120-0.4580065000577843D0*t340*t374+0.1826409316395374D-3*t352
     #+0.1175079523416141D-3*t354))-0.3864554332158731D-2*t42*t89*t150
     #*t59-0.240629793461334D-1*t42*t141
      t432 = s1-0.4643764086263751D0*t42*t145*t177
     #-0.3482823064697813D0*t155*t46*t394*t396*t175
     #+0.7729108664317462D-3*t42*t332*t280*t59-0.3728981012481608D-1
     #*t42*t8*t150*t157*t176+0.1741411532348907D0*t155*t158*t418*t175
     #+0.5601068912404374D1*t155*t46*t424*t396*t427
      t463 = t133*t46
      t475 = t150*t59
      t479 = t35**2
      t481 = 1/t479*t41
      t482 = 1/t344
      t496 = t181*t211
      t501 = 1/t180/t64*t83
      t504 = t65*(rho*(-t262+t270+t300+t302-t304-t308
     #+0.3377379869957684D-1*t321)-0.2D1*t177+0.1D1*t80*t394*t396*t175
     #-0.5D0*t80*t157*t418*t175-0.2219207958813744D-2*t276*t280*t59
     #+0.1070677706909338D0*t204*t208-0.1608197949869254D2*t80*t424
     #*t396*t427+t254+t255)+0.3483621003951759D-1*t131*t218*t136
     #+0.9023617254800025D-2*t139*t89*t46*t59+0.2240940862670676D0
     #*t131*t463*t207*t175*sigma-0.1741810501975879D-2*t130*t94*t98
     #*t46*t59+0.7459670696504551D-3*t131*t98*t475*sigma
     #-0.3362181416969575D-2*t481*t482*t135*t94+0.2898415749119048D-3
     #*t139*t332*t150*t59+0.8707057661744533D-1*t139*t8*t177
     #-0.192463558656411D0*t182*t333+0.1049801229034969D0*t496*t90
     #+0.275520655120833D-2*t501*t340
      v2rhoa2(i) = t432+t504
      t510 = sigma*t98
      t518 = t350*t89
      t520 = t223*t105
      t526 = t226*t112
      t555 = t36*t8
      s1 = 0.5926297260681278D0*t3*t237+0.2222361472755479D0*t4*(-1.D0
     #*(-0.14426300760287D0*t89+0.8024608914654282D-1*t89*t12
     #-0.6288248285159801D0*t510*t12+0.5475111610680592D0*t94/t344/rho
     #*t12+0.1274640655510246D-3*t518+0.4686178880552377D-4*t520)*t27
     #+t359*t235+t526*t124-2.D0*t364*t124*t235+t113*(
     #-0.1717524375216691D0*t222*t105*t22-0.6491835342129149D0*t89
     #*t120+0.3435048750433382D0*t510*t374-0.1369806987296531D-3*t518
     #-0.5036055100354892D-4*t520))+0.2521636062727181D-2*t481/t337
     #*t136+0.2394989440216834D-2*t130*t218*t136-0.1741810501975879D-1
     #*t131*t463*t59-0.9023617254800025D-2*t555*t135
      v2rhoasigmaaa(i) = s1-0.2797376511189207D-3*t131*t218*t150*t59
     #-0.2898415749119048D-3*t36*t89*t475-0.8403528235015034D-1*t131
     #*t241*t177-0.8707057661744533D-1*t246*t46*t208
     #-0.2066404913406247D-2*t501*t510+0.1049801229034969D0*t182*t89
     #-0.3936754608881135D-1*t496*t8
      t582 = 1/sigma
      t584 = t350*t582*t8
      t587 = 1/t15/sigma
      t589 = t102*t587*t16
      t596 = t235**2
      t619 = t130*t133
      v2sigmaaa2(i) = 0.4444722945510959D0*t4*(-1.D0*
     #(0.3144124142579901D0*t218*t12-0.4106333708010444D0*sigma*t482
     #*t12-0.9559804916326848D-4*t584+0.3514634160414282D-4*t589)*t27
     #+2.D0*t526*t235-2.D0*t364*t596+t113*(-0.1288143281412518D0*t587
     #*t16*t22+0.1622958835532287D0*t582*t8*t120-0.2576286562825037D0
     #*t218*t374+0.1027355240472398D-3*t584-0.3777041325266169D-4*t589
     #))-0.3782454094090772D-2*t481/t96*t46*t59-0.5225431505927638D-2
     #*t619*t135+0.3099607370109371D-2*t501*t218
      v2taua2(i) = 0.D0
      v2rhoataua(i) = -0.3483621003951759D-2*t619*t136
     #+0.721889380384002D-2*t247+0.5796831498238097D-3*t555*t475
     #+0.1741411532348907D0*t251*t46*t208
      v2sigmaaataua(i) = 0.2612715752963819D-2*t130*t241*t135
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      vtaua(i) = 0.0d0
      v2rhoataua(i) = 0.0d0
      v2taua2(i) = 0.0d0
      v2sigmaaataua(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end

c:XC_MPWB1Ksubrend
_ENDIF
_IF(ccpdft,all,xc_pbe)
c:XC_PBEsubrstart

c    Generated: Fri Mar 12 10:09:03 GMT 2004

      subroutine uks_xc_pbe
     & (ideriv,npt,rhoa1,rhob1,sigmaaa1,sigmabb1,sigmaab1,
     &  zk,vrhoa,vrhob,vsigmaaa,vsigmabb,vsigmaab,
     &  v2rhoa2,v2rhob2,v2rhoab,
     &  v2rhoasigmaaa,v2rhoasigmaab,v2rhoasigmabb,
     &  v2rhobsigmabb,v2rhobsigmaab,v2rhobsigmaaa,
     &  v2sigmaaa2,v2sigmaaaab,v2sigmaaabb,
     &  v2sigmaab2,v2sigmaabbb,v2sigmabb2)
c
c     J.P. Perdew, K. Burke, and M. Ernzerhof
c     Generalized gradient approximation made simple
c     Phys. Rev. Lett. 77 (1996) 3865-3868
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt),rhob1(npt)
      REAL sigmaaa1(npt),sigmabb1(npt),sigmaab1(npt)
      REAL zk(npt),vrhoa(npt),vrhob(npt)
      REAL vsigmaaa(npt),vsigmabb(npt),vsigmaab(npt)
      REAL v2rhoa2(npt),v2rhob2(npt),v2rhoab(npt)
      REAL v2rhoasigmaaa(npt),v2rhoasigmaab(npt)
      REAL v2rhoasigmabb(npt),v2rhobsigmabb(npt)
      REAL v2rhobsigmaab(npt),v2rhobsigmaaa(npt)
      REAL v2sigmaaa2(npt),v2sigmaaaab(npt),v2sigmaaabb(npt)
      REAL v2sigmaab2(npt),v2sigmaabbb(npt),v2sigmabb2(npt)
      parameter(tol=1.0d-20)
      
      if (ideriv.eq.0) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t4 = rhob**2
      t5 = t2**2
      t16 = 1/rhob
      t17 = t16**(1.D0/3.D0)
      t20 = t16**(1.D0/6.D0)
      t23 = dsqrt(t16)
      t25 = t17**2
      t31 = dlog(1.D0+0.3216395899738507D2/(0.1112037486309468D2*t20
     #+0.3844746237447211D1*t17+0.1644733775567609D1*t23
     #+0.2405871291288192D0*t25))
      t32 = (1.D0+0.1274696188700087D0*t17)*t31
      t35 = 1/t2/t4
      t38 = dexp(0.2000000587336264D1*t32)
      t39 = t38-1.D0
      t43 = 0.2162211495206379D0/t39*sigmabb*t35
      t45 = t39**2
      t47 = sigmabb**2
      t49 = t4**2
      t60 = dlog(1.D0+0.2162211495206379D0*sigmabb*t35*(1.D0+t43)/
     #(1.D0+t43+0.4675158550002605D-1/t45*t47/t5/t49))
      zk(i) = -0.9305257363491D0*t2*rhob*(0.1804D1-0.804D0/(1.D0
     #+0.449276922095889D-2*sigmabb/t5/t4))+rhob*(-0.310907D-1*t32
     #+0.1554534543482745D-1*t60)
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t4 = rhoa**2
      t5 = t2**2
      t16 = 1/rhoa
      t17 = t16**(1.D0/3.D0)
      t20 = t16**(1.D0/6.D0)
      t23 = dsqrt(t16)
      t25 = t17**2
      t31 = dlog(1.D0+0.3216395899738507D2/(0.1112037486309468D2*t20
     #+0.3844746237447211D1*t17+0.1644733775567609D1*t23
     #+0.2405871291288192D0*t25))
      t32 = (1.D0+0.1274696188700087D0*t17)*t31
      t35 = 1/t2/t4
      t38 = dexp(0.2000000587336264D1*t32)
      t39 = t38-1.D0
      t43 = 0.2162211495206379D0/t39*sigmaaa*t35
      t45 = t39**2
      t47 = sigmaaa**2
      t49 = t4**2
      t60 = dlog(1.D0+0.2162211495206379D0*sigmaaa*t35*(1.D0+t43)/
     #(1.D0+t43+0.4675158550002605D-1/t45*t47/t5/t49))
      zk(i) = -0.9305257363491D0*t2*rhoa*(0.1804D1-0.804D0/(1.D0
     #+0.449276922095889D-2*sigmaaa/t5/t4))+rhoa*(-0.310907D-1*t32
     #+0.1554534543482745D-1*t60)
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t6 = rhoa**2
      t7 = t4**2
      t18 = rhob**(1.D0/3.D0)
      t20 = rhob**2
      t21 = t18**2
      t32 = 1/rho
      t33 = t32**(1.D0/3.D0)
      t36 = t32**(1.D0/6.D0)
      t39 = dsqrt(t32)
      t41 = t33**2
      t47 = dlog(1.D0+0.1608197949869254D2/(0.598255043577108D1*t36
     #+0.2225569421150687D1*t33+0.8004286349993634D0*t39
     #+0.1897004325747559D0*t41))
      t49 = 0.621814D-1*(1.D0+0.1325688999052018D0*t33)*t47
      t60 = dlog(1.D0+0.2960874997779344D2/(0.8157414703487641D1*t36
     #+0.2247591863577616D1*t33+0.4300972471276643D0*t39
     #+0.1911512595127338D0*t41))
      t63 = rhoa-1.D0*rhob
      t64 = t63*t32
      t65 = 1.D0+t64
      t66 = t65**(1.D0/3.D0)
      t69 = 1.D0-1.D0*t64
      t70 = t69**(1.D0/3.D0)
      t72 = t66*t65+t70*t69-2.D0
      t73 = t63**2
      t74 = t73**2
      t75 = rho**2
      t76 = t75**2
      t78 = t74/t76
      t83 = 0.37995525D-1*(1.D0+0.6901399211255825D-1*t33)*t60*t72*
     #(1.D0-1.D0*t78)
      t94 = dlog(1.D0+0.3216395899738507D2/(0.1112037486309468D2*t36
     #+0.3844746237447211D1*t33+0.1644733775567609D1*t39
     #+0.2405871291288192D0*t41))
      t100 = 0.1923661050931536D1*(-0.310907D-1*(1.D0
     #+0.1274696188700087D0*t33)*t94+t49)*t72*t78
      t101 = t66**2
      t103 = t70**2
      t105 = 0.5D0*t101+0.5D0*t103
      t106 = t105**2
      t107 = t106*t105
      t108 = 1/t106
      t110 = rho**(1.D0/3.D0)
      t112 = 1/t110/t75
      t117 = dexp(-0.3216396844291482D2*(-t49+t83+t100)/t107)
      t118 = t117-1.D0
      t123 = 0.1362107888567592D0/t118*sigma*t108*t112
      t126 = t118**2
      t128 = sigma**2
      t130 = t106**2
      t132 = t110**2
      t144 = dlog(1.D0+0.1362107888567592D0*sigma*t108*t112*(1.D0+t123
     #)/(1.D0+t123+0.1855337900098064D-1/t126*t128/t130/t132/t76))
      zk(i) = -0.9305257363491D0*t4*rhoa*(0.1804D1-0.804D0/(1.D0
     #+0.449276922095889D-2*sigmaaa/t7/t6))-0.9305257363491D0*t18*rhob
     #*(0.1804D1-0.804D0/(1.D0+0.449276922095889D-2*sigmabb/t21/t20))
     #+rho*(-t49+t83+t100+0.310906908696549D-1*t107*t144)
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t3 = t2*rhob
      t4 = rhob**2
      t5 = t2**2
      t10 = 1.D0+0.449276922095889D-2*sigmabb/t5/t4
      t13 = 0.1804D1-0.804D0/t10
      t16 = 1/rhob
      t17 = t16**(1.D0/3.D0)
      t19 = 1.D0+0.1274696188700087D0*t17
      t20 = t16**(1.D0/6.D0)
      t23 = dsqrt(t16)
      t25 = t17**2
      t27 = 0.1112037486309468D2*t20+0.3844746237447211D1*t17
     #+0.1644733775567609D1*t23+0.2405871291288192D0*t25
      t30 = 1.D0+0.3216395899738507D2/t27
      t31 = dlog(t30)
      t32 = t19*t31
      t33 = 0.310907D-1*t32
      t35 = 1/t2/t4
      t36 = sigmabb*t35
      t38 = dexp(0.2000000587336264D1*t32)
      t39 = t38-1.D0
      t40 = 1/t39
      t41 = t40*sigmabb
      t43 = 0.2162211495206379D0*t41*t35
      t44 = 1.D0+t43
      t45 = t39**2
      t46 = 1/t45
      t47 = sigmabb**2
      t48 = t46*t47
      t49 = t4**2
      t51 = 1/t5/t49
      t52 = t48*t51
      t54 = 1.D0+t43+0.4675158550002605D-1*t52
      t55 = 1/t54
      t56 = t44*t55
      t59 = 1.D0+0.2162211495206379D0*t36*t56
      t60 = dlog(t59)
      t61 = 0.1554534543482745D-1*t60
      zk(i) = -0.9305257363491D0*t3*t13+rhob*(-t33+t61)
      vrhoa(i) = 0.D0
      t66 = t10**2
      t67 = 1/t66
      t73 = 1/t2/t4/rhob
      t79 = 1/t5/t49/rhob
      t81 = t40*t55
      t84 = t54**2
      t86 = t44/t84
      t97 = 1/t59
      t101 = 1/t4
      t102 = 1/t25*t101
      t103 = t102*t31
      t105 = t27**2
      t108 = t20**2
      t109 = t108**2
      t124 = t19/t105*(-0.1853395810515781D1/t109/t20*t101
     #-0.128158207914907D1*t102-0.8223668877838045D0/t23*t101
     #-0.1603914194192128D0/t17*t101)/t30
      t128 = -0.8497977086918237D-1*t103-0.6432793688582964D2*t124
      t133 = t46*sigmabb
      vrhob(i) = -0.12407009817988D1*t2*t13+0.8963286558970112D-2*t35
     #*t67*sigmabb-t33+t61+0.1554534543482745D-1*rhob*(
     #-0.5045160155481551D0*sigmabb*t73*t56-0.1090870328333941D0*t47
     #*t79*t81-0.2162211495206379D0*t36*t86*(-0.5045160155481551D0*t41
     #*t73-0.2181740656667882D0*t48*t79))*t97+rhob*
     #(0.1321039893133927D-2*t103+0.1D1*t124+0.1554534543482745D-1*(
     #-0.4675158550002605D-1*t52*t128*t38*t55-0.2162211495206379D0*t36
     #*t86*(-0.2162211495206379D0*t133*t35*t128*t38
     #-0.935031710000521D-1/t45/t39*t47*t51*t128*t38))*t97)
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      vsigmabb(i) = -0.3361232459613792D-2/t3*t67
     #+0.1554534543482745D-1*rhob*(0.2162211495206379D0*t35*t44*t55
     #+0.4675158550002605D-1*sigmabb*t51*t81-0.2162211495206379D0*t36
     #*t86*(0.2162211495206379D0*t40*t35+0.935031710000521D-1*t133*t51
     #))*t97
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t3 = t2*rhoa
      t4 = rhoa**2
      t5 = t2**2
      t10 = 1.D0+0.449276922095889D-2*sigmaaa/t5/t4
      t13 = 0.1804D1-0.804D0/t10
      t16 = 1/rhoa
      t17 = t16**(1.D0/3.D0)
      t19 = 1.D0+0.1274696188700087D0*t17
      t20 = t16**(1.D0/6.D0)
      t23 = dsqrt(t16)
      t25 = t17**2
      t27 = 0.1112037486309468D2*t20+0.3844746237447211D1*t17
     #+0.1644733775567609D1*t23+0.2405871291288192D0*t25
      t30 = 1.D0+0.3216395899738507D2/t27
      t31 = dlog(t30)
      t32 = t19*t31
      t33 = 0.310907D-1*t32
      t35 = 1/t2/t4
      t36 = sigmaaa*t35
      t38 = dexp(0.2000000587336264D1*t32)
      t39 = t38-1.D0
      t40 = 1/t39
      t41 = t40*sigmaaa
      t43 = 0.2162211495206379D0*t41*t35
      t44 = 1.D0+t43
      t45 = t39**2
      t46 = 1/t45
      t47 = sigmaaa**2
      t48 = t46*t47
      t49 = t4**2
      t51 = 1/t5/t49
      t52 = t48*t51
      t54 = 1.D0+t43+0.4675158550002605D-1*t52
      t55 = 1/t54
      t56 = t44*t55
      t59 = 1.D0+0.2162211495206379D0*t36*t56
      t60 = dlog(t59)
      t61 = 0.1554534543482745D-1*t60
      zk(i) = -0.9305257363491D0*t3*t13+rhoa*(-t33+t61)
      t66 = t10**2
      t67 = 1/t66
      t73 = 1/t2/t4/rhoa
      t79 = 1/t5/t49/rhoa
      t81 = t40*t55
      t84 = t54**2
      t86 = t44/t84
      t97 = 1/t59
      t101 = 1/t4
      t102 = 1/t25*t101
      t103 = t102*t31
      t105 = t27**2
      t108 = t20**2
      t109 = t108**2
      t124 = t19/t105*(-0.1853395810515781D1/t109/t20*t101
     #-0.128158207914907D1*t102-0.8223668877838045D0/t23*t101
     #-0.1603914194192128D0/t17*t101)/t30
      t128 = -0.8497977086918237D-1*t103-0.6432793688582964D2*t124
      t133 = t46*sigmaaa
      vrhoa(i) = -0.12407009817988D1*t2*t13+0.8963286558970112D-2*t35
     #*t67*sigmaaa-t33+t61+0.1554534543482745D-1*rhoa*(
     #-0.5045160155481551D0*sigmaaa*t73*t56-0.1090870328333941D0*t47
     #*t79*t81-0.2162211495206379D0*t36*t86*(-0.5045160155481551D0*t41
     #*t73-0.2181740656667882D0*t48*t79))*t97+rhoa*
     #(0.1321039893133927D-2*t103+0.1D1*t124+0.1554534543482745D-1*(
     #-0.4675158550002605D-1*t52*t128*t38*t55-0.2162211495206379D0*t36
     #*t86*(-0.2162211495206379D0*t133*t35*t128*t38
     #-0.935031710000521D-1/t45/t39*t47*t51*t128*t38))*t97)
      vrhob(i) = 0.D0
      vsigmaaa(i) = -0.3361232459613792D-2/t3*t67
     #+0.1554534543482745D-1*rhoa*(0.2162211495206379D0*t35*t44*t55
     #+0.4675158550002605D-1*sigmaaa*t51*t81-0.2162211495206379D0*t36
     #*t86*(0.2162211495206379D0*t40*t35+0.935031710000521D-1*t133*t51
     #))*t97
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t5 = t4*rhoa
      t6 = rhoa**2
      t7 = t4**2
      t12 = 1.D0+0.449276922095889D-2*sigmaaa/t7/t6
      t15 = 0.1804D1-0.804D0/t12
      t18 = rhob**(1.D0/3.D0)
      t19 = t18*rhob
      t20 = rhob**2
      t21 = t18**2
      t26 = 1.D0+0.449276922095889D-2*sigmabb/t21/t20
      t29 = 0.1804D1-0.804D0/t26
      t32 = 1/rho
      t33 = t32**(1.D0/3.D0)
      t35 = 1.D0+0.1325688999052018D0*t33
      t36 = t32**(1.D0/6.D0)
      t39 = dsqrt(t32)
      t41 = t33**2
      t43 = 0.598255043577108D1*t36+0.2225569421150687D1*t33
     #+0.8004286349993634D0*t39+0.1897004325747559D0*t41
      t46 = 1.D0+0.1608197949869254D2/t43
      t47 = dlog(t46)
      t49 = 0.621814D-1*t35*t47
      t51 = 1.D0+0.6901399211255825D-1*t33
      t56 = 0.8157414703487641D1*t36+0.2247591863577616D1*t33
     #+0.4300972471276643D0*t39+0.1911512595127338D0*t41
      t59 = 1.D0+0.2960874997779344D2/t56
      t60 = dlog(t59)
      t61 = t51*t60
      t63 = rhoa-1.D0*rhob
      t64 = t63*t32
      t65 = 1.D0+t64
      t66 = t65**(1.D0/3.D0)
      t69 = 1.D0-1.D0*t64
      t70 = t69**(1.D0/3.D0)
      t72 = t66*t65+t70*t69-2.D0
      t73 = t63**2
      t74 = t73**2
      t75 = rho**2
      t76 = t75**2
      t77 = 1/t76
      t78 = t74*t77
      t80 = 1.D0-1.D0*t78
      t83 = 0.37995525D-1*t61*t72*t80
      t85 = 1.D0+0.1274696188700087D0*t33
      t90 = 0.1112037486309468D2*t36+0.3844746237447211D1*t33
     #+0.1644733775567609D1*t39+0.2405871291288192D0*t41
      t93 = 1.D0+0.3216395899738507D2/t90
      t94 = dlog(t93)
      t97 = -0.310907D-1*t85*t94+t49
      t98 = t97*t72
      t100 = 0.1923661050931536D1*t98*t78
      t101 = t66**2
      t103 = t70**2
      t105 = 0.5D0*t101+0.5D0*t103
      t106 = t105**2
      t107 = t106*t105
      t108 = 1/t106
      t109 = sigma*t108
      t110 = rho**(1.D0/3.D0)
      t112 = 1/t110/t75
      t113 = -t49+t83+t100
      t114 = 1/t107
      t117 = dexp(-0.3216396844291482D2*t113*t114)
      t118 = t117-1.D0
      t119 = 1/t118
      t120 = t119*sigma
      t121 = t108*t112
      t123 = 0.1362107888567592D0*t120*t121
      t124 = 1.D0+t123
      t126 = t118**2
      t127 = 1/t126
      t128 = sigma**2
      t129 = t127*t128
      t130 = t106**2
      t131 = 1/t130
      t132 = t110**2
      t134 = 1/t132/t76
      t135 = t131*t134
      t138 = 1.D0+t123+0.1855337900098064D-1*t129*t135
      t139 = 1/t138
      t143 = 1.D0+0.1362107888567592D0*t109*t112*t124*t139
      t144 = dlog(t143)
      t146 = 0.310906908696549D-1*t107*t144
      zk(i) = -0.9305257363491D0*t5*t15-0.9305257363491D0*t19*t29+rho*
     #(-t49+t83+t100+t146)
      t153 = t12**2
      t154 = 1/t153
      t162 = 0.1333333333333333D1*t66*t32-0.1333333333333333D1*t70*t32
      t165 = 0.37995525D-1*t61*t162*t80
      t166 = t73*t63
      t169 = t61*t72*t166*t77
      t170 = 0.1519821D0*t169
      t173 = 0.1923661050931536D1*t97*t162*t78
      t175 = t98*t166*t77
      t176 = 0.7694644203726145D1*t175
      t177 = t106*t144
      t178 = 1/t66
      t181 = 1/t70
      t184 = 0.3333333333333333D0*t178*t32-0.3333333333333333D0*t181*t32
      t188 = sigma*t114*t112
      t189 = t124*t139
      t193 = t127*sigma
      t194 = t193*t108
      t198 = t113*t131
      t201 = -0.3216396844291482D2*(t165-t170+t173+t176)*t114
     #+0.9649190532874446D2*t198*t184
      t205 = 0.1362107888567592D0*t194*t112*t201*t117
      t206 = t114*t112
      t209 = 0.2724215777135184D0*t120*t206*t184
      t215 = t109*t112
      t216 = t138**2
      t218 = t124/t216
      t222 = 1/t126/t118*t128*t131
      t229 = 1/t130/t105*t134
      t239 = 1/t143
      t245 = 1/t75
      t246 = 1/t41*t245
      t247 = t246*t47
      t248 = 0.2747773264188438D-2*t247
      t249 = t43**2
      t252 = t36**2
      t253 = t252**2
      t256 = 1/t253/t36*t245
      t260 = 1/t39*t245
      t263 = 1/t33*t245
      t268 = t35/t249*(-0.99709173929518D0*t256-0.7418564737168958D0
     #*t246-0.4002143174996817D0*t260-0.1264669550498372D0*t263)/t46
      t269 = 0.1D1*t268
      t273 = 0.87407428755417D-3*t246*t60*t72*t80
      t274 = t56**2
      t287 = 0.1125D1*t51/t274*(-0.135956911724794D1*t256
     #-0.7491972878592054D0*t246-0.2150486235638321D0*t260
     #-0.1274341730084892D0*t263)/t59*t72*t80
      t294 = -0.1333333333333333D1*t66*t63*t245+0.1333333333333333D1
     #*t70*t63*t245
      t297 = 0.37995525D-1*t61*t294*t80
      t299 = t76*rho
      t300 = 1/t299
      t303 = 0.1519821D0*t61*t72*t74*t300
      t306 = t90**2
      t323 = 0.1923661050931536D1*(0.1321039893133927D-2*t246*t94
     #+0.1D1*t85/t306*(-0.1853395810515781D1*t256-0.128158207914907D1
     #*t246-0.8223668877838045D0*t260-0.1603914194192128D0*t263)/t93
     #-0.2747773264188438D-2*t247-0.1D1*t268)*t72*t78
      t326 = 0.1923661050931536D1*t97*t294*t78
      t329 = 0.7694644203726145D1*t98*t74*t300
      t336 = -0.3333333333333333D0*t178*t63*t245+0.3333333333333333D0
     #*t181*t63*t245
      t344 = 1/t110/t75/rho
      t354 = -0.3216396844291482D2*(t248+t269-t273-t287+t297+t303+t323
     #+t326-t329)*t114+0.9649190532874446D2*t198*t336
      t358 = 0.1362107888567592D0*t194*t112*t354*t117
      t361 = 0.2724215777135184D0*t120*t206*t336
      t364 = 0.3178251739991049D0*t120*t108*t344
      t390 = t248+t269-t273-t287+t297+t303+t323+t326-t329
     #+0.9327207260896469D-1*t177*t336+0.310906908696549D-1*t107*(
     #-0.2724215777135184D0*t188*t189*t336-0.3178251739991049D0*t109
     #*t344*t124*t139+0.1362107888567592D0*t109*t112*(-t358-t361-t364)
     #*t139-0.1362107888567592D0*t215*t218*(-t358-t361-t364
     #-0.3710675800196129D-1*t222*t134*t354*t117-0.7421351600392257D-1
     #*t129*t229*t336-0.8658243533790967D-1*t129*t131/t132/t299))*t239
      t391 = rho*t390
      vrhoa(i) = -0.12407009817988D1*t4*t15+0.8963286558970112D-2/t4
     #/t6*t154*sigmaaa+rho*(t165-t170+t173+t176+0.9327207260896469D-1
     #*t177*t184+0.310906908696549D-1*t107*(-0.2724215777135184D0*t188
     #*t189*t184+0.1362107888567592D0*t109*t112*(-t205-t209)*t139
     #-0.1362107888567592D0*t215*t218*(-t205-t209
     #-0.3710675800196129D-1*t222*t134*t201*t117-0.7421351600392257D-1
     #*t129*t229*t184))*t239)-t49+t83+t100+t146+t391
      t396 = t26**2
      t397 = 1/t396
      t401 = -t162
      t404 = 0.37995525D-1*t61*t401*t80
      t405 = 0.1519821D0*t169
      t408 = 0.1923661050931536D1*t97*t401*t78
      t409 = 0.7694644203726145D1*t175
      t410 = -t184
      t421 = -0.3216396844291482D2*(t404+t405+t408-t409)*t114
     #+0.9649190532874446D2*t198*t410
      t425 = 0.1362107888567592D0*t194*t112*t421*t117
      t428 = 0.2724215777135184D0*t120*t206*t410
      vrhob(i) = -0.12407009817988D1*t18*t29+0.8963286558970112D-2/t18
     #/t20*t397*sigmabb+rho*(t404+t405+t408-t409+0.9327207260896469D-1
     #*t177*t410+0.310906908696549D-1*t107*(-0.2724215777135184D0*t188
     #*t189*t410+0.1362107888567592D0*t109*t112*(-t425-t428)*t139
     #-0.1362107888567592D0*t215*t218*(-t425-t428
     #-0.3710675800196129D-1*t222*t134*t421*t117-0.7421351600392257D-1
     #*t129*t229*t410))*t239)-t49+t83+t100+t146+t391
      t473 = rho*t107*(0.1362107888567592D0*t121*t189
     #+0.1855337900098064D-1*sigma*t131*t134*t119*t139
     #-0.1362107888567592D0*t215*t218*(0.1362107888567592D0*t119*t108
     #*t112+0.3710675800196129D-1*t193*t135))*t239
      t474 = 0.310906908696549D-1*t473
      vsigmaaa(i) = -0.3361232459613792D-2/t5*t154+t474
      vsigmaab(i) = 0.6218138173930979D-1*t473
      vsigmabb(i) = -0.3361232459613792D-2/t19*t397+t474
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t3 = t2*rhob
      t4 = rhob**2
      t5 = t2**2
      t10 = 1.D0+0.449276922095889D-2*sigmabb/t5/t4
      t13 = 0.1804D1-0.804D0/t10
      t16 = 1/rhob
      t17 = t16**(1.D0/3.D0)
      t19 = 1.D0+0.1274696188700087D0*t17
      t20 = t16**(1.D0/6.D0)
      t23 = dsqrt(t16)
      t25 = t17**2
      t27 = 0.1112037486309468D2*t20+0.3844746237447211D1*t17
     #+0.1644733775567609D1*t23+0.2405871291288192D0*t25
      t30 = 1.D0+0.3216395899738507D2/t27
      t31 = dlog(t30)
      t32 = t19*t31
      t33 = 0.310907D-1*t32
      t35 = 1/t2/t4
      t36 = sigmabb*t35
      t38 = dexp(0.2000000587336264D1*t32)
      t39 = t38-1.D0
      t40 = 1/t39
      t41 = t40*sigmabb
      t43 = 0.2162211495206379D0*t41*t35
      t44 = 1.D0+t43
      t45 = t39**2
      t46 = 1/t45
      t47 = sigmabb**2
      t48 = t46*t47
      t49 = t4**2
      t51 = 1/t5/t49
      t52 = t48*t51
      t54 = 1.D0+t43+0.4675158550002605D-1*t52
      t55 = 1/t54
      t56 = t44*t55
      t59 = 1.D0+0.2162211495206379D0*t36*t56
      t60 = dlog(t59)
      t61 = 0.1554534543482745D-1*t60
      zk(i) = -0.9305257363491D0*t3*t13+rhob*(-t33+t61)
      vrhoa(i) = 0.D0
      t66 = t10**2
      t67 = 1/t66
      t71 = t4*rhob
      t73 = 1/t2/t71
      t74 = sigmabb*t73
      t79 = 1/t5/t49/rhob
      t80 = t47*t79
      t81 = t40*t55
      t84 = t54**2
      t85 = 1/t84
      t86 = t44*t85
      t89 = t48*t79
      t91 = -0.5045160155481551D0*t41*t73-0.2181740656667882D0*t89
      t92 = t86*t91
      t95 = -0.5045160155481551D0*t74*t56-0.1090870328333941D0*t80*t81
     #-0.2162211495206379D0*t36*t92
      t96 = rhob*t95
      t97 = 1/t59
      t100 = 1/t25
      t101 = 1/t4
      t102 = t100*t101
      t103 = t102*t31
      t105 = t27**2
      t106 = 1/t105
      t107 = t19*t106
      t108 = t20**2
      t109 = t108**2
      t110 = t109*t20
      t111 = 1/t110
      t115 = 1/t23
      t118 = 1/t17
      t121 = -0.1853395810515781D1*t111*t101-0.128158207914907D1*t102
     #-0.8223668877838045D0*t115*t101-0.1603914194192128D0*t118*t101
      t122 = 1/t30
      t124 = t107*t121*t122
      t128 = -0.8497977086918237D-1*t103-0.6432793688582964D2*t124
      t129 = t128*t38
      t130 = t129*t55
      t133 = t46*sigmabb
      t139 = 1/t45/t39
      t140 = t139*t47
      t145 = -0.2162211495206379D0*t133*t35*t128*t38
     #-0.935031710000521D-1*t140*t51*t128*t38
      t146 = t86*t145
      t149 = -0.4675158550002605D-1*t52*t130-0.2162211495206379D0*t36
     #*t146
      t150 = t149*t97
      vrhob(i) = -0.12407009817988D1*t2*t13+0.8963286558970112D-2*t35
     #*t67*sigmabb-t33+t61+0.1554534543482745D-1*t96*t97+rhob*
     #(0.1321039893133927D-2*t103+0.1D1*t124+0.1554534543482745D-1*t150)
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      t157 = t35*t44
      t160 = sigmabb*t51
      t167 = 0.2162211495206379D0*t40*t35+0.935031710000521D-1*t133*t51
      t171 = 0.2162211495206379D0*t157*t55+0.4675158550002605D-1*t160
     #*t81-0.2162211495206379D0*t36*t86*t167
      vsigmabb(i) = -0.3361232459613792D-2/t3*t67
     #+0.1554534543482745D-1*rhob*t171*t97
      v2rhoa2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t181 = t49*t4
      t184 = 1/t66/t10
      t191 = 1/t2/t49
      t196 = 1/t5/t181
      t202 = t40*t85
      t207 = 1/t84/t54
      t208 = t44*t207
      t209 = t91**2
      t225 = t95**2
      t227 = t59**2
      t228 = 1/t227
      t234 = t89*t130
      t239 = 0.4675158550002605D-1*t52*t129*t85*t91
      t241 = 0.5045160155481551D0*t74*t146
      t244 = 0.1090870328333941D0*t80*t202*t145
      t249 = 0.4324422990412758D0*t36*t44*t207*t145*t91
      t261 = 0.2162211495206379D0*t36*t86*(0.5045160155481551D0*t133
     #*t73*t128*t38+0.4363481313335765D0*t140*t79*t128*t38)
      t265 = t149*t228
      t279 = 1/t49
      t280 = 1/t25/t16*t279
      t281 = t280*t31
      t283 = 1/t71
      t284 = t100*t283
      t285 = t284*t31
      t289 = t102*t106*t121*t122
      t294 = t121**2
      t296 = t19/t105/t27*t294*t122
      t320 = t107*(-0.1544496508763151D1/t110/t16*t279
     #+0.3706791621031562D1*t111*t283-0.854388052766047D0*t280
     #+0.2563164158298141D1*t284-0.4111834438919023D0/t23/t16*t279
     #+0.1644733775567609D1*t115*t283-0.5346380647307093D-1/t17/t16
     #*t279+0.3207828388384256D0*t118*t283)*t122
      t322 = t105**2
      t325 = t30**2
      t328 = t19/t322*t294/t325
      t332 = t128**2
      t334 = dexp(0.4000001174672527D1*t32)
      t345 = -0.5665318057945491D-1*t281+0.1699595417383647D0*t285
     #+0.546657173168712D1*t289+0.1286558737716593D3*t296
     #-0.6432793688582964D2*t320-0.2069041124382199D4*t328
      t358 = t145**2
      t363 = t35*t332
      t374 = t45**2
      t377 = t51*t332
      t395 = t149**2
      s1 = -0.4135669939329333D0/t5*t13-0.8963286558970112D-2*t73*t67
     #*sigmabb+0.2147732158441357D-3/t181*t184*t47
     #+0.310906908696549D-1*t95*t97+0.1554534543482745D-1*rhob*
     #(0.1681720051827184D1*sigmabb*t191*t56+0.8726962626671529D0*t47
     #*t196*t81+0.100903203109631D1*t74*t92+0.2181740656667882D0*t80
     #*t202*t91+0.4324422990412758D0*t36*t208*t209
     #-0.2162211495206379D0*t36*t86*(0.1681720051827184D1*t41*t191
     #+0.1236319705445133D1*t48*t196))*t97-0.1554534543482745D-1*rhob
     #*t225*t228
      s2 = s1+0.2642079786267853D-2*t103+0.2D1*t124
     #+0.310906908696549D-1*t150
      s3 = s2+rhob*(0.1554534543482745D-1*(0.2181740656667882D0*t234
     #+t239+t241+t244+t249-t261)*t97-0.1554534543482745D-1*t265*t95)
      s4 = s3+0.1554534543482745D-1*rhob*(0.2181740656667882D0*t234
     #+t241+t244+t239+t249-t261)*t97
      v2rhob2(i) = s4-0.1554534543482745D-1*t96*t265+rhob*
     #(0.8806932620892844D-3*t281-0.2642079786267853D-2*t285
     #-0.8497974591333914D-1*t289-0.2D1*t296+0.1D1*t320
     #+0.3216395899738507D2*t328+0.1554534543482745D-1*
     #(0.935031710000521D-1*t47*t51*t139*t332*t334*t55
     #-0.4675158550002605D-1*t52*t345*t38*t55-0.4675158550002605D-1
     #*t52*t332*t38*t55+0.935031710000521D-1*t52*t129*t85*t145
     #+0.4324422990412758D0*t36*t208*t358-0.2162211495206379D0*t36*t86
     #*(0.4324422990412758D0*t139*sigmabb*t363*t334
     #-0.2162211495206379D0*t133*t35*t345*t38-0.2162211495206379D0
     #*t133*t363*t38+0.2805095130001563D0/t374*t47*t377*t334
     #-0.935031710000521D-1*t140*t51*t345*t38-0.935031710000521D-1
     #*t140*t377*t38))*t97-0.1554534543482745D-1*t395*t228)
      v2sigmaaa2(i) = 0.D0
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      t411 = t167**2
      t425 = t171**2
      v2sigmabb2(i) = 0.3020248347808158D-4*t279*t184
     #+0.1554534543482745D-1*rhob*(0.935031710000521D-1*t51*t40*t55
     #-0.4324422990412758D0*t157*t85*t167-0.935031710000521D-1*t160
     #*t202*t167+0.4324422990412758D0*t36*t208*t411
     #-0.2021736311745604D-1*sigmabb/t49/t71*t86*t46)*t97
     #-0.1554534543482745D-1*rhob*t425*t228
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t3 = t2*rhoa
      t4 = rhoa**2
      t5 = t2**2
      t10 = 1.D0+0.449276922095889D-2*sigmaaa/t5/t4
      t13 = 0.1804D1-0.804D0/t10
      t16 = 1/rhoa
      t17 = t16**(1.D0/3.D0)
      t19 = 1.D0+0.1274696188700087D0*t17
      t20 = t16**(1.D0/6.D0)
      t23 = dsqrt(t16)
      t25 = t17**2
      t27 = 0.1112037486309468D2*t20+0.3844746237447211D1*t17
     #+0.1644733775567609D1*t23+0.2405871291288192D0*t25
      t30 = 1.D0+0.3216395899738507D2/t27
      t31 = dlog(t30)
      t32 = t19*t31
      t33 = 0.310907D-1*t32
      t35 = 1/t2/t4
      t36 = sigmaaa*t35
      t38 = dexp(0.2000000587336264D1*t32)
      t39 = t38-1.D0
      t40 = 1/t39
      t41 = t40*sigmaaa
      t43 = 0.2162211495206379D0*t41*t35
      t44 = 1.D0+t43
      t45 = t39**2
      t46 = 1/t45
      t47 = sigmaaa**2
      t48 = t46*t47
      t49 = t4**2
      t51 = 1/t5/t49
      t52 = t48*t51
      t54 = 1.D0+t43+0.4675158550002605D-1*t52
      t55 = 1/t54
      t56 = t44*t55
      t59 = 1.D0+0.2162211495206379D0*t36*t56
      t60 = dlog(t59)
      t61 = 0.1554534543482745D-1*t60
      zk(i) = -0.9305257363491D0*t3*t13+rhoa*(-t33+t61)
      t66 = t10**2
      t67 = 1/t66
      t71 = t4*rhoa
      t73 = 1/t2/t71
      t74 = sigmaaa*t73
      t79 = 1/t5/t49/rhoa
      t80 = t47*t79
      t81 = t40*t55
      t84 = t54**2
      t85 = 1/t84
      t86 = t44*t85
      t89 = t48*t79
      t91 = -0.5045160155481551D0*t41*t73-0.2181740656667882D0*t89
      t92 = t86*t91
      t95 = -0.5045160155481551D0*t74*t56-0.1090870328333941D0*t80*t81
     #-0.2162211495206379D0*t36*t92
      t96 = rhoa*t95
      t97 = 1/t59
      t100 = 1/t25
      t101 = 1/t4
      t102 = t100*t101
      t103 = t102*t31
      t105 = t27**2
      t106 = 1/t105
      t107 = t19*t106
      t108 = t20**2
      t109 = t108**2
      t110 = t109*t20
      t111 = 1/t110
      t115 = 1/t23
      t118 = 1/t17
      t121 = -0.1853395810515781D1*t111*t101-0.128158207914907D1*t102
     #-0.8223668877838045D0*t115*t101-0.1603914194192128D0*t118*t101
      t122 = 1/t30
      t124 = t107*t121*t122
      t128 = -0.8497977086918237D-1*t103-0.6432793688582964D2*t124
      t129 = t128*t38
      t130 = t129*t55
      t133 = t46*sigmaaa
      t139 = 1/t45/t39
      t140 = t139*t47
      t145 = -0.2162211495206379D0*t133*t35*t128*t38
     #-0.935031710000521D-1*t140*t51*t128*t38
      t146 = t86*t145
      t149 = -0.4675158550002605D-1*t52*t130-0.2162211495206379D0*t36
     #*t146
      t150 = t149*t97
      vrhoa(i) = -0.12407009817988D1*t2*t13+0.8963286558970112D-2*t35
     #*t67*sigmaaa-t33+t61+0.1554534543482745D-1*t96*t97+rhoa*
     #(0.1321039893133927D-2*t103+0.1D1*t124+0.1554534543482745D-1*t150)
      vrhob(i) = 0.D0
      t157 = t35*t44
      t160 = sigmaaa*t51
      t167 = 0.2162211495206379D0*t40*t35+0.935031710000521D-1*t133*t51
      t171 = 0.2162211495206379D0*t157*t55+0.4675158550002605D-1*t160
     #*t81-0.2162211495206379D0*t36*t86*t167
      vsigmaaa(i) = -0.3361232459613792D-2/t3*t67
     #+0.1554534543482745D-1*rhoa*t171*t97
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      t181 = t49*t4
      t184 = 1/t66/t10
      t191 = 1/t2/t49
      t196 = 1/t5/t181
      t202 = t40*t85
      t207 = 1/t84/t54
      t208 = t44*t207
      t209 = t91**2
      t225 = t95**2
      t227 = t59**2
      t228 = 1/t227
      t234 = t89*t130
      t239 = 0.4675158550002605D-1*t52*t129*t85*t91
      t241 = 0.5045160155481551D0*t74*t146
      t244 = 0.1090870328333941D0*t80*t202*t145
      t249 = 0.4324422990412758D0*t36*t44*t207*t145*t91
      t261 = 0.2162211495206379D0*t36*t86*(0.5045160155481551D0*t133
     #*t73*t128*t38+0.4363481313335765D0*t140*t79*t128*t38)
      t265 = t149*t228
      t279 = 1/t49
      t280 = 1/t25/t16*t279
      t281 = t280*t31
      t283 = 1/t71
      t284 = t100*t283
      t285 = t284*t31
      t289 = t102*t106*t121*t122
      t294 = t121**2
      t296 = t19/t105/t27*t294*t122
      t320 = t107*(-0.1544496508763151D1/t110/t16*t279
     #+0.3706791621031562D1*t111*t283-0.854388052766047D0*t280
     #+0.2563164158298141D1*t284-0.4111834438919023D0/t23/t16*t279
     #+0.1644733775567609D1*t115*t283-0.5346380647307093D-1/t17/t16
     #*t279+0.3207828388384256D0*t118*t283)*t122
      t322 = t105**2
      t325 = t30**2
      t328 = t19/t322*t294/t325
      t332 = t128**2
      t334 = dexp(0.4000001174672527D1*t32)
      t345 = -0.5665318057945491D-1*t281+0.1699595417383647D0*t285
     #+0.546657173168712D1*t289+0.1286558737716593D3*t296
     #-0.6432793688582964D2*t320-0.2069041124382199D4*t328
      t358 = t145**2
      t363 = t35*t332
      t374 = t45**2
      t377 = t51*t332
      t395 = t149**2
      s1 = -0.4135669939329333D0/t5*t13-0.8963286558970112D-2*t73*t67
     #*sigmaaa+0.2147732158441357D-3/t181*t184*t47
     #+0.310906908696549D-1*t95*t97+0.1554534543482745D-1*rhoa*
     #(0.1681720051827184D1*sigmaaa*t191*t56+0.8726962626671529D0*t47
     #*t196*t81+0.100903203109631D1*t74*t92+0.2181740656667882D0*t80
     #*t202*t91+0.4324422990412758D0*t36*t208*t209
     #-0.2162211495206379D0*t36*t86*(0.1681720051827184D1*t41*t191
     #+0.1236319705445133D1*t48*t196))*t97-0.1554534543482745D-1*rhoa
     #*t225*t228
      s2 = s1+0.2642079786267853D-2*t103+0.2D1*t124
     #+0.310906908696549D-1*t150
      s3 = s2+rhoa*(0.1554534543482745D-1*(0.2181740656667882D0*t234
     #+t239+t241+t244+t249-t261)*t97-0.1554534543482745D-1*t265*t95)
      s4 = s3+0.1554534543482745D-1*rhoa*(0.2181740656667882D0*t234
     #+t241+t244+t239+t249-t261)*t97
      v2rhoa2(i) = s4-0.1554534543482745D-1*t96*t265+rhoa*
     #(0.8806932620892844D-3*t281-0.2642079786267853D-2*t285
     #-0.8497974591333914D-1*t289-0.2D1*t296+0.1D1*t320
     #+0.3216395899738507D2*t328+0.1554534543482745D-1*
     #(0.935031710000521D-1*t47*t51*t139*t332*t334*t55
     #-0.4675158550002605D-1*t52*t345*t38*t55-0.4675158550002605D-1
     #*t52*t332*t38*t55+0.935031710000521D-1*t52*t129*t85*t145
     #+0.4324422990412758D0*t36*t208*t358-0.2162211495206379D0*t36*t86
     #*(0.4324422990412758D0*t139*sigmaaa*t363*t334
     #-0.2162211495206379D0*t133*t35*t345*t38-0.2162211495206379D0
     #*t133*t363*t38+0.2805095130001563D0/t374*t47*t377*t334
     #-0.935031710000521D-1*t140*t51*t345*t38-0.935031710000521D-1
     #*t140*t377*t38))*t97-0.1554534543482745D-1*t395*t228)
      v2rhob2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t411 = t167**2
      t425 = t171**2
      v2sigmaaa2(i) = 0.3020248347808158D-4*t279*t184
     #+0.1554534543482745D-1*rhoa*(0.935031710000521D-1*t51*t40*t55
     #-0.4324422990412758D0*t157*t85*t167-0.935031710000521D-1*t160
     #*t202*t167+0.4324422990412758D0*t36*t208*t411
     #-0.2021736311745604D-1*sigmaaa/t49/t71*t86*t46)*t97
     #-0.1554534543482745D-1*rhoa*t425*t228
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      v2sigmabb2(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t5 = t4*rhoa
      t6 = rhoa**2
      t7 = t4**2
      t12 = 1.D0+0.449276922095889D-2*sigmaaa/t7/t6
      t15 = 0.1804D1-0.804D0/t12
      t18 = rhob**(1.D0/3.D0)
      t19 = t18*rhob
      t20 = rhob**2
      t21 = t18**2
      t26 = 1.D0+0.449276922095889D-2*sigmabb/t21/t20
      t29 = 0.1804D1-0.804D0/t26
      t32 = 1/rho
      t33 = t32**(1.D0/3.D0)
      t35 = 1.D0+0.1325688999052018D0*t33
      t36 = t32**(1.D0/6.D0)
      t39 = dsqrt(t32)
      t41 = t33**2
      t43 = 0.598255043577108D1*t36+0.2225569421150687D1*t33
     #+0.8004286349993634D0*t39+0.1897004325747559D0*t41
      t46 = 1.D0+0.1608197949869254D2/t43
      t47 = dlog(t46)
      t49 = 0.621814D-1*t35*t47
      t51 = 1.D0+0.6901399211255825D-1*t33
      t56 = 0.8157414703487641D1*t36+0.2247591863577616D1*t33
     #+0.4300972471276643D0*t39+0.1911512595127338D0*t41
      t59 = 1.D0+0.2960874997779344D2/t56
      t60 = dlog(t59)
      t61 = t51*t60
      t63 = rhoa-1.D0*rhob
      t64 = t63*t32
      t65 = 1.D0+t64
      t66 = t65**(1.D0/3.D0)
      t67 = t66*t65
      t69 = 1.D0-1.D0*t64
      t70 = t69**(1.D0/3.D0)
      t71 = t70*t69
      t72 = t67+t71-2.D0
      t73 = t63**2
      t74 = t73**2
      t75 = rho**2
      t76 = t75**2
      t77 = 1/t76
      t78 = t74*t77
      t80 = 1.D0-1.D0*t78
      t81 = t72*t80
      t83 = 0.37995525D-1*t61*t81
      t85 = 1.D0+0.1274696188700087D0*t33
      t90 = 0.1112037486309468D2*t36+0.3844746237447211D1*t33
     #+0.1644733775567609D1*t39+0.2405871291288192D0*t41
      t93 = 1.D0+0.3216395899738507D2/t90
      t94 = dlog(t93)
      t97 = -0.310907D-1*t85*t94+t49
      t98 = t97*t72
      t100 = 0.1923661050931536D1*t98*t78
      t101 = t66**2
      t103 = t70**2
      t105 = 0.5D0*t101+0.5D0*t103
      t106 = t105**2
      t107 = t106*t105
      t108 = 1/t106
      t109 = sigma*t108
      t110 = rho**(1.D0/3.D0)
      t112 = 1/t110/t75
      t113 = -t49+t83+t100
      t114 = 1/t107
      t115 = t113*t114
      t117 = dexp(-0.3216396844291482D2*t115)
      t118 = t117-1.D0
      t119 = 1/t118
      t120 = t119*sigma
      t121 = t108*t112
      t123 = 0.1362107888567592D0*t120*t121
      t124 = 1.D0+t123
      t126 = t118**2
      t127 = 1/t126
      t128 = sigma**2
      t129 = t127*t128
      t130 = t106**2
      t131 = 1/t130
      t132 = t110**2
      t134 = 1/t132/t76
      t135 = t131*t134
      t138 = 1.D0+t123+0.1855337900098064D-1*t129*t135
      t139 = 1/t138
      t143 = 1.D0+0.1362107888567592D0*t109*t112*t124*t139
      t144 = dlog(t143)
      t146 = 0.310906908696549D-1*t107*t144
      zk(i) = -0.9305257363491D0*t5*t15-0.9305257363491D0*t19*t29+rho*
     #(-t49+t83+t100+t146)
      t153 = t12**2
      t154 = 1/t153
      t155 = 1/t4/t6*t154
      t162 = 0.1333333333333333D1*t66*t32-0.1333333333333333D1*t70*t32
      t164 = t61*t162*t80
      t165 = 0.37995525D-1*t164
      t166 = t73*t63
      t167 = t72*t166
      t169 = t61*t167*t77
      t170 = 0.1519821D0*t169
      t171 = t97*t162
      t172 = t171*t78
      t173 = 0.1923661050931536D1*t172
      t174 = t166*t77
      t175 = t98*t174
      t176 = 0.7694644203726145D1*t175
      t177 = t106*t144
      t178 = 1/t66
      t181 = 1/t70
      t184 = 0.3333333333333333D0*t178*t32-0.3333333333333333D0*t181*t32
      t185 = t177*t184
      t186 = 0.9327207260896469D-1*t185
      t187 = sigma*t114
      t188 = t187*t112
      t189 = t124*t139
      t190 = t189*t184
      t193 = t127*sigma
      t194 = t193*t108
      t195 = t165-t170+t173+t176
      t198 = t113*t131
      t201 = -0.3216396844291482D2*t195*t114+0.9649190532874446D2*t198
     #*t184
      t202 = t112*t201
      t203 = t202*t117
      t205 = 0.1362107888567592D0*t194*t203
      t206 = t114*t112
      t209 = 0.2724215777135184D0*t120*t206*t184
      t210 = -t205-t209
      t215 = t109*t112
      t216 = t138**2
      t217 = 1/t216
      t218 = t124*t217
      t220 = 1/t126/t118
      t221 = t220*t128
      t222 = t221*t131
      t223 = t134*t201
      t224 = t223*t117
      t228 = 1/t130/t105
      t229 = t228*t134
      t230 = t229*t184
      t233 = -t205-t209-0.3710675800196129D-1*t222*t224
     #-0.7421351600392257D-1*t129*t230
      t234 = t218*t233
      t237 = -0.2724215777135184D0*t188*t190+0.1362107888567592D0*t109
     #*t112*t210*t139-0.1362107888567592D0*t215*t234
      t238 = t107*t237
      t239 = 1/t143
      t240 = t238*t239
      t241 = 0.310906908696549D-1*t240
      t244 = 1/t41
      t245 = 1/t75
      t246 = t244*t245
      t247 = t246*t47
      t248 = 0.2747773264188438D-2*t247
      t249 = t43**2
      t250 = 1/t249
      t251 = t35*t250
      t252 = t36**2
      t253 = t252**2
      t254 = t253*t36
      t255 = 1/t254
      t256 = t255*t245
      t259 = 1/t39
      t260 = t259*t245
      t262 = 1/t33
      t263 = t262*t245
      t265 = -0.99709173929518D0*t256-0.7418564737168958D0*t246
     #-0.4002143174996817D0*t260-0.1264669550498372D0*t263
      t266 = 1/t46
      t268 = t251*t265*t266
      t269 = 0.1D1*t268
      t270 = t60*t72
      t271 = t270*t80
      t272 = t246*t271
      t273 = 0.87407428755417D-3*t272
      t274 = t56**2
      t275 = 1/t274
      t276 = t51*t275
      t281 = -0.135956911724794D1*t256-0.7491972878592054D0*t246
     #-0.2150486235638321D0*t260-0.1274341730084892D0*t263
      t282 = t276*t281
      t283 = 1/t59
      t284 = t283*t72
      t285 = t284*t80
      t286 = t282*t285
      t287 = 0.1125D1*t286
      t288 = t66*t63
      t291 = t70*t63
      t294 = -0.1333333333333333D1*t288*t245+0.1333333333333333D1*t291
     #*t245
      t296 = t61*t294*t80
      t297 = 0.37995525D-1*t296
      t298 = t72*t74
      t299 = t76*rho
      t300 = 1/t299
      t302 = t61*t298*t300
      t303 = 0.1519821D0*t302
      t306 = t90**2
      t307 = 1/t306
      t308 = t85*t307
      t313 = -0.1853395810515781D1*t256-0.128158207914907D1*t246
     #-0.8223668877838045D0*t260-0.1603914194192128D0*t263
      t314 = 1/t93
      t320 = 0.1321039893133927D-2*t246*t94+0.1D1*t308*t313*t314
     #-0.2747773264188438D-2*t247-0.1D1*t268
      t321 = t320*t72
      t322 = t321*t78
      t323 = 0.1923661050931536D1*t322
      t324 = t97*t294
      t325 = t324*t78
      t326 = 0.1923661050931536D1*t325
      t327 = t74*t300
      t328 = t98*t327
      t329 = 0.7694644203726145D1*t328
      t330 = t178*t63
      t333 = t181*t63
      t336 = -0.3333333333333333D0*t330*t245+0.3333333333333333D0*t333
     #*t245
      t337 = t177*t336
      t339 = t189*t336
      t342 = t75*rho
      t344 = 1/t110/t342
      t349 = t248+t269-t273-t287+t297+t303+t323+t326-t329
      t354 = -0.3216396844291482D2*t349*t114+0.9649190532874446D2*t198
     #*t336
      t355 = t112*t354
      t356 = t355*t117
      t358 = 0.1362107888567592D0*t194*t356
      t361 = 0.2724215777135184D0*t120*t206*t336
      t362 = t108*t344
      t364 = 0.3178251739991049D0*t120*t362
      t365 = -t358-t361-t364
      t370 = t134*t354
      t371 = t370*t117
      t374 = t229*t336
      t378 = 1/t132/t299
      t379 = t131*t378
      t382 = -t358-t361-t364-0.3710675800196129D-1*t222*t371
     #-0.7421351600392257D-1*t129*t374-0.8658243533790967D-1*t129*t379
      t383 = t218*t382
      t386 = -0.2724215777135184D0*t188*t339-0.3178251739991049D0*t109
     #*t344*t124*t139+0.1362107888567592D0*t109*t112*t365*t139
     #-0.1362107888567592D0*t215*t383
      t387 = t107*t386
      t388 = t387*t239
      t390 = t248+t269-t273-t287+t297+t303+t323+t326-t329
     #+0.9327207260896469D-1*t337+0.310906908696549D-1*t388
      t391 = rho*t390
      vrhoa(i) = -0.12407009817988D1*t4*t15+0.8963286558970112D-2*t155
     #*sigmaaa+rho*(t165-t170+t173+t176+t186+t241)-t49+t83+t100+t146
     #+t391
      t396 = t26**2
      t397 = 1/t396
      t398 = 1/t18/t20*t397
      t401 = -t162
      t403 = t61*t401*t80
      t404 = 0.37995525D-1*t403
      t405 = 0.1519821D0*t169
      t406 = t97*t401
      t407 = t406*t78
      t408 = 0.1923661050931536D1*t407
      t409 = 0.7694644203726145D1*t175
      t410 = -t184
      t411 = t177*t410
      t412 = 0.9327207260896469D-1*t411
      t413 = t189*t410
      t416 = t404+t405+t408-t409
      t421 = -0.3216396844291482D2*t416*t114+0.9649190532874446D2*t198
     #*t410
      t422 = t112*t421
      t423 = t422*t117
      t425 = 0.1362107888567592D0*t194*t423
      t428 = 0.2724215777135184D0*t120*t206*t410
      t429 = -t425-t428
      t434 = t134*t421
      t435 = t434*t117
      t438 = t229*t410
      t441 = -t425-t428-0.3710675800196129D-1*t222*t435
     #-0.7421351600392257D-1*t129*t438
      t442 = t218*t441
      t445 = -0.2724215777135184D0*t188*t413+0.1362107888567592D0*t109
     #*t112*t429*t139-0.1362107888567592D0*t215*t442
      t446 = t107*t445
      t447 = t446*t239
      t448 = 0.310906908696549D-1*t447
      vrhob(i) = -0.12407009817988D1*t18*t29+0.8963286558970112D-2
     #*t398*sigmabb+rho*(t404+t405+t408-t409+t412+t448)-t49+t83+t100
     #+t146+t391
      t454 = rho*t107
      t457 = sigma*t131
      t462 = t119*t108
      t467 = 0.1362107888567592D0*t462*t112+0.3710675800196129D-1*t193
     #*t135
      t468 = t218*t467
      t471 = 0.1362107888567592D0*t121*t189+0.1855337900098064D-1*t457
     #*t134*t119*t139-0.1362107888567592D0*t215*t468
      t473 = t454*t471*t239
      t474 = 0.310906908696549D-1*t473
      vsigmaaa(i) = -0.3361232459613792D-2/t5*t154+t474
      vsigmaab(i) = 0.6218138173930979D-1*t473
      vsigmabb(i) = -0.3361232459613792D-2/t19*t397+t474
      t484 = 0.5495546528376876D-2*t247
      t485 = 0.2D1*t268
      t486 = 0.7599105D-1*t296
      t487 = 0.225D1*t286
      t488 = 0.174814857510834D-2*t272
      t489 = 0.3039642D0*t302
      t490 = 0.7599105D-1*t164-0.3039642D0*t169+0.3847322101863073D1
     #*t172+0.1538928840745229D2*t175+0.6218138173930979D-1*t240
     #+0.1865441452179294D0*t185+t484+t485+t486-t487-t488+t489
      t491 = 0.3847322101863073D1*t322
      t492 = 0.1538928840745229D2*t328
      t493 = 0.3847322101863073D1*t325
      t494 = 0.1865441452179294D0*t337
      t495 = 0.6218138173930979D-1*t388
      t496 = 1/t101
      t499 = 1/t103
      t502 = 0.4444444444444444D0*t496*t245+0.4444444444444444D0*t499
     #*t245
      t505 = 0.37995525D-1*t61*t502*t80
      t508 = t61*t162*t166*t77
      t509 = 0.3039642D0*t508
      t512 = t61*t72*t73*t77
      t513 = 0.4559463D0*t512
      t516 = 0.1923661050931536D1*t97*t502*t78
      t517 = t171*t174
      t518 = 0.1538928840745229D2*t517
      t520 = t98*t73*t77
      t521 = 0.2308393261117844D2*t520
      t522 = t105*t144
      t523 = t184**2
      t526 = t106*t237
      t527 = t239*t184
      t530 = 1/t67
      t533 = 1/t71
      t536 = -0.1111111111111111D0*t530*t245-0.1111111111111111D0*t533
     #*t245
      t538 = 0.9327207260896469D-1*t177*t536
      t539 = t457*t112
      t543 = t210*t139
      t553 = 0.2724215777135184D0*t188*t189*t536
      t554 = t220*sigma
      t555 = t554*t108
      t556 = t201**2
      t557 = t112*t556
      t559 = dexp(-0.6432793688582964D2*t115)
      t562 = 0.2724215777135184D0*t555*t557*t559
      t563 = t193*t114
      t564 = t117*t184
      t567 = 0.5448431554270369D0*t563*t202*t564
      t571 = t195*t131
      t574 = t113*t228
      t578 = 0.9649190532874446D2*t198*t536
      t579 = -0.3216396844291482D2*(t505-t509-t513+t516+t518+t521)
     #*t114+0.1929838106574889D3*t571*t184-0.3859676213149779D3*t574
     #*t523+t578
      t583 = 0.1362107888567592D0*t194*t112*t579*t117
      t586 = 0.1362107888567592D0*t194*t557*t117
      t587 = t131*t112
      t590 = 0.8172647331405553D0*t120*t587*t523
      t593 = 0.2724215777135184D0*t120*t206*t536
      t599 = t210*t217
      t605 = t124/t216/t138
      t606 = t233**2
      t610 = t126**2
      t613 = 1/t610*t128*t131
      t614 = t134*t556
      t618 = t221*t228
      t630 = 1/t130/t106
      t631 = t630*t134
      t637 = 0.7421351600392257D-1*t129*t229*t536
      t638 = t562+t567-t583-t586+t590-t593+0.1113202740058839D0*t613
     #*t614*t559+0.2968540640156903D0*t618*t223*t564
     #-0.3710675800196129D-1*t222*t134*t579*t117-0.3710675800196129D-1
     #*t222*t614*t117+0.3710675800196129D0*t129*t631*t523-t637
      t646 = t237**2
      t648 = t143**2
      t649 = 1/t648
      t652 = t505-t509-t513+t516+t518+t521+0.1865441452179294D0*t522
     #*t523+0.1865441452179294D0*t526*t527+t538+0.310906908696549D-1
     #*t107*(0.8172647331405553D0*t539*t189*t523-0.5448431554270369D0
     #*t188*t543*t184+0.5448431554270369D0*t188*t218*t184*t233-t553
     #+0.1362107888567592D0*t109*t112*(t562+t567-t583-t586+t590-t593)
     #*t139-0.2724215777135184D0*t215*t599*t233+0.2724215777135184D0
     #*t215*t605*t606-0.1362107888567592D0*t215*t218*t638)*t239
     #-0.310906908696549D-1*t107*t646*t649
      t663 = t265**2
      t665 = t35/t249/t43*t663*t266
      t666 = 0.2D1*t665
      t669 = 1/t254/t32*t77
      t671 = 1/t342
      t672 = t255*t671
      t676 = 1/t41/t32*t77
      t678 = t244*t671
      t682 = 1/t39/t32*t77
      t684 = t259*t671
      t688 = 1/t33/t32*t77
      t690 = t262*t671
      t694 = t251*(-0.8309097827459833D0*t669+0.199418347859036D1*t672
     #-0.4945709824779306D0*t676+0.1483712947433792D1*t678
     #-0.2001071587498409D0*t682+0.8004286349993634D0*t684
     #-0.4215565168327908D-1*t688+0.2529339100996745D0*t690)*t266
      t695 = 0.1D1*t694
      t696 = t249**2
      t699 = t46**2
      t702 = t35/t696*t663/t699
      t703 = 0.1608197949869254D2*t702
      t715 = t313**2
      t731 = t306**2
      t734 = t93**2
      t739 = t676*t47
      t741 = t678*t47
      t745 = t246*t250*t265*t266
      t750 = 0.8806932620892844D-3*t676*t94-0.2642079786267853D-2*t678
     #*t94-0.8497974591333914D-1*t246*t307*t313*t314-0.2D1*t85/t306
     #/t90*t715*t314+0.1D1*t308*(-0.1544496508763151D1*t669
     #+0.3706791621031562D1*t672-0.854388052766047D0*t676
     #+0.2563164158298141D1*t678-0.4111834438919023D0*t682
     #+0.1644733775567609D1*t684-0.5346380647307093D-1*t688
     #+0.3207828388384256D0*t690)*t314+0.3216395899738507D2*t85/t731
     #*t715/t734-0.1831848842792292D-2*t739+0.5495546528376876D-2*t741
     #+0.8837926660346786D-1*t745+0.2D1*t665-0.1D1*t694
     #-0.1608197949869254D2*t702
      t753 = 0.1923661050931536D1*t750*t72*t78
      t754 = t76*t75
      t755 = 1/t754
      t758 = 0.3847322101863073D2*t98*t74*t755
      t759 = t336**2
      t772 = -0.1111111111111111D0*t530*t73*t77+0.6666666666666667D0
     #*t330*t671-0.1111111111111111D0*t533*t73*t77
     #-0.6666666666666667D0*t333*t671
      t775 = 0.1831848842792292D-2*t739
      t776 = 0.5495546528376876D-2*t741
      t780 = 0.174814857510834D-2*t246*t60*t294*t80
      t784 = 0.3039642D0*t61*t294*t74*t300
      t787 = 0.7599105D0*t61*t298*t755
      t799 = 0.1125D1*t276*(-0.1132974264373283D1*t669
     #+0.271913823449588D1*t672-0.4994648585728036D0*t676
     #+0.1498394575718411D1*t678-0.1075243117819161D0*t682
     #+0.4300972471276643D0*t684-0.4247805766949639D-1*t688
     #+0.2548683460169784D0*t690)*t285
      t800 = 0.8837926660346786D-1*t745
      t805 = 0.5176049408441869D-1*t246*t275*t281*t283*t81
      t806 = -t666+t695+t703+t753+t758+0.1865441452179294D0*t522*t759
     #+0.9327207260896469D-1*t177*t772+t775-t776-t780+t784-t787-t799
     #-t800+t805
      t808 = 1/t76/t342
      t812 = 0.699259430043336D-2*t244*t808*t270*t74
      t814 = 0.58271619170278D-3*t676*t271
      t816 = 0.174814857510834D-2*t678*t271
      t820 = 0.225D1*t282*t283*t294*t80
      t831 = 0.4444444444444444D0*t496*t73*t77+0.2666666666666667D1
     #*t288*t671+0.4444444444444444D0*t499*t73*t77
     #-0.2666666666666667D1*t291*t671
      t834 = 0.37995525D-1*t61*t831*t80
      t836 = 0.1538928840745229D2*t324*t327
      t839 = 0.1923661050931536D1*t97*t831*t78
      t842 = 0.3847322101863073D1*t320*t294*t78
      t844 = 0.1538928840745229D2*t321*t327
      t848 = t281**2
      t851 = 0.225D1*t51/t274/t56*t848*t285
      t854 = 0.9D1*t282*t284*t327
      t855 = t274**2
      t859 = t59**2
      t864 = 0.3330984372501762D2*t51/t855*t848/t859*t72*t80
      t865 = t106*t386
      t866 = t239*t336
      t869 = t386**2
      t874 = 1/t110/t76
      t886 = t187*t344
      t889 = t365*t139
      t900 = t109*t344
      t903 = t354**2
      t904 = t112*t903
      t907 = 0.2724215777135184D0*t555*t904*t559
      t908 = t117*t336
      t911 = 0.5448431554270369D0*t563*t355*t908
      t915 = 0.6356503479982097D0*t194*t344*t354*t117
      t916 = -t666+t695+t703+t753+t758+t775-t776-t780+t784-t787-t799
     #-t800
      t917 = t805-t812-t814+t816-t820+t834-t836+t839+t842-t844+t851
     #-t854-t864
      t921 = t349*t131
      t928 = -0.3216396844291482D2*(t916+t917)*t114
     #+0.1929838106574889D3*t921*t336-0.3859676213149779D3*t574*t759
     #+0.9649190532874446D2*t198*t772
      t932 = 0.1362107888567592D0*t194*t112*t928*t117
      t935 = 0.1362107888567592D0*t194*t904*t117
      t938 = 0.8172647331405553D0*t120*t587*t759
      t939 = t114*t344
      t942 = 0.1271300695996419D1*t120*t939*t336
      t945 = 0.2724215777135184D0*t120*t206*t772
      t948 = 0.1059417246663683D1*t120*t108*t874
      t954 = t365*t217
      t958 = t382**2
      t974 = t134*t903
      t981 = t228*t378
      t995 = 0.3710675800196129D0*t129*t631*t759+t907+t911+t915
     #+0.3463297413516387D0*t222*t378*t354*t117-t932-t935+t938+t942
     #-t945+t948+0.4906338002481548D0*t129*t131/t132/t754
     #-0.3710675800196129D-1*t222*t974*t117+0.2968540640156903D0*t618
     #*t370*t908+0.6926594827032773D0*t129*t981*t336
     #-0.3710675800196129D-1*t222*t134*t928*t117-0.7421351600392257D-1
     #*t129*t229*t772+0.1113202740058839D0*t613*t974*t559
      t999 = 0.1059417246663683D1*t109*t874*t124*t139
     #+0.5448431554270369D0*t188*t218*t336*t382+0.8172647331405553D0
     #*t539*t189*t759+0.1271300695996419D1*t886*t339
     #-0.5448431554270369D0*t188*t889*t336-0.6356503479982097D0*t109
     #*t344*t365*t139-0.2724215777135184D0*t188*t189*t772
     #+0.6356503479982097D0*t900*t383+0.1362107888567592D0*t109*t112*
     #(t907+t911+t915-t932-t935+t938+t942-t945+t948)*t139
     #-0.2724215777135184D0*t215*t954*t382+0.2724215777135184D0*t215
     #*t605*t958-0.1362107888567592D0*t215*t218*t995
      t1003 = -t812-t814+t816-t820+t834-t836+t839+t842-t844+t851-t854
     #-t864+0.1865441452179294D0*t865*t866-0.310906908696549D-1*t107
     #*t869*t649+0.310906908696549D-1*t107*t999*t239
      t1005 = rho*(t806+t1003)
      t1009 = t6**2
      t1013 = 1/t153/t12
      t1015 = sigmaaa**2
      t1021 = 0.87407428755417D-3*t246*t60*t162*t80
      t1024 = t244*t755*t270*t166
      t1025 = 0.349629715021668D-2*t1024
      t1029 = 0.1125D1*t282*t283*t162*t80
      t1031 = t282*t284*t174
      t1032 = 0.45D1*t1031
      t1043 = -0.4444444444444444D0*t496*t63*t671-0.1333333333333333D1
     #*t66*t245-0.4444444444444444D0*t499*t63*t671
     #+0.1333333333333333D1*t70*t245
      t1046 = 0.37995525D-1*t61*t1043*t80
      t1049 = t61*t294*t166*t77
      t1050 = 0.1519821D0*t1049
      t1054 = 0.1519821D0*t61*t162*t74*t300
      t1056 = t61*t167*t300
      t1057 = 0.6079284D0*t1056
      t1060 = 0.1923661050931536D1*t320*t162*t78
      t1061 = t321*t174
      t1062 = 0.7694644203726145D1*t1061
      t1065 = 0.1923661050931536D1*t97*t1043*t78
      t1066 = t324*t174
      t1067 = 0.7694644203726145D1*t1066
      t1069 = 0.7694644203726145D1*t171*t327
      t1071 = t98*t166*t300
      t1072 = 0.3077857681490458D2*t1071
      t1073 = t336*t184
      t1075 = 0.1865441452179294D0*t522*t1073
      t1077 = 0.9327207260896469D-1*t526*t866
      t1088 = 0.1111111111111111D0*t530*t63*t671-0.3333333333333333D0
     #*t178*t245+0.1111111111111111D0*t533*t63*t671
     #+0.3333333333333333D0*t181*t245
      t1090 = 0.9327207260896469D-1*t177*t1088
      t1092 = 0.9327207260896469D-1*t865*t527
      t1095 = 0.8172647331405553D0*t539*t189*t1073
      t1098 = 0.2724215777135184D0*t188*t543*t336
      t1102 = 0.2724215777135184D0*t188*t218*t336*t233
      t1105 = 0.2724215777135184D0*t188*t189*t1088
      t1107 = 0.6356503479982097D0*t886*t190
      t1111 = 0.3178251739991049D0*t109*t344*t210*t139
      t1113 = 0.3178251739991049D0*t900*t234
      t1116 = 0.2724215777135184D0*t188*t889*t184
      t1117 = t559*t201
      t1120 = 0.2724215777135184D0*t555*t355*t1117
      t1123 = 0.2724215777135184D0*t563*t355*t564
      t1124 = -t1021+t1025-t1029+t1032+t1046-t1050+t1054+t1057+t1060
     #+t1062+t1065+t1067-t1069-t1072
      t1128 = 0.9649190532874446D2*t921*t184
      t1130 = 0.9649190532874446D2*t571*t336
      t1132 = 0.3859676213149779D3*t574*t1073
      t1134 = 0.9649190532874446D2*t198*t1088
      t1135 = -0.3216396844291482D2*t1124*t114+t1128+t1130-t1132+t1134
      t1139 = 0.1362107888567592D0*t194*t112*t1135*t117
      t1140 = t201*t117
      t1143 = 0.1362107888567592D0*t194*t355*t1140
      t1144 = t112*t336
      t1147 = 0.2724215777135184D0*t563*t1144*t1140
      t1148 = t120*t131
      t1151 = 0.8172647331405553D0*t1148*t1144*t184
      t1154 = 0.2724215777135184D0*t120*t206*t1088
      t1158 = 0.3178251739991049D0*t194*t344*t201*t117
      t1161 = 0.6356503479982097D0*t120*t939*t184
      t1169 = 0.1362107888567592D0*t215*t954*t233
      t1173 = 0.2724215777135184D0*t188*t218*t382*t184
      t1176 = 0.1362107888567592D0*t215*t599*t382
      t1180 = 0.2724215777135184D0*t215*t605*t382*t233
      t1183 = 0.1113202740058839D0*t613*t370*t1117
      t1186 = 0.1484270320078451D0*t618*t370*t564
      t1193 = 0.3710675800196129D-1*t222*t370*t1140
      t1194 = t134*t336
      t1197 = 0.1484270320078451D0*t618*t1194*t1140
      t1198 = t129*t630
      t1201 = 0.3710675800196129D0*t1198*t1194*t184
      t1204 = 0.7421351600392257D-1*t129*t229*t1088
      t1208 = 0.1731648706758193D0*t222*t378*t201*t117
      t1211 = 0.3463297413516387D0*t129*t981*t184
      t1212 = t1120+t1123-t1139-t1143+t1147+t1151-t1154+t1158+t1161
     #+t1183+t1186-0.3710675800196129D-1*t222*t134*t1135*t117-t1193
     #+t1197+t1201-t1204+t1208+t1211
      t1216 = t1095-t1098+t1102-t1105+t1107-t1111+t1113-t1116
     #+0.1362107888567592D0*t109*t112*(t1120+t1123-t1139-t1143+t1147
     #+t1151-t1154+t1158+t1161)*t139-t1169+t1173-t1176+t1180
     #-0.1362107888567592D0*t215*t218*t1212
      t1222 = 0.310906908696549D-1*t387*t649*t237
      t1223 = -t1021+t1025-t1029+t1032+t1046-t1050+t1054+t1057+t1060
     #+t1062+t1065+t1067-t1069-t1072+t1075+t1077+t1090+t1092
     #+0.310906908696549D-1*t107*t1216*t239-t1222
      t1224 = rho*t1223
      t1225 = 0.45D1*t1031
      t1226 = -t1021-t1029+t1046+t1054+t1025+t1225-t1050+t1057+t1060
     #+t1065-t1069+t1062+t1067-t1072
      t1229 = -0.3216396844291482D2*t1226*t114+t1130+t1128-t1132+t1134
      t1233 = 0.1362107888567592D0*t194*t112*t1229*t117
      t1243 = t1120+t1147+t1158-t1233-t1143+t1123+t1151+t1161-t1154
     #+t1183+t1197+t1208-0.3710675800196129D-1*t222*t134*t1229*t117
     #-t1193+t1186+t1201+t1211-t1204
      t1247 = t1095+t1107-t1116+t1173-t1105-t1098-t1111
     #+0.1362107888567592D0*t109*t112*(t1120+t1147+t1158-t1233-t1143
     #+t1123+t1151+t1161-t1154)*t139-t1176+t1102+t1113-t1169+t1180
     #-0.1362107888567592D0*t215*t218*t1243
      t1251 = -t1021-t1029+t1046+t1054+t1025+t1225-t1050+t1057+t1060
     #+t1065-t1069+t1062+t1067-t1072+t1075+t1092+t1090+t1077
     #+0.310906908696549D-1*t107*t1247*t239-t1222
      t1252 = rho*t1251
      t1253 = t491-t492+t493+t494+t495+rho*t652-0.8963286558970112D-2
     #/t4/t6/rhoa*t154*sigmaaa+t1005-0.4135669939329333D0/t7*t15
     #+0.2147732158441357D-3/t1009/t6*t1013*t1015+t1224+t1252
      v2rhoa2(i) = t490+t1253
      t1257 = 0.3039642D0*t169-0.1538928840745229D2*t175
     #+0.6218138173930979D-1*t447+t484+t485+t486-t487-t488+t489+t491
     #-t492+t493
      t1264 = t20**2
      t1268 = 1/t396/t26
      t1270 = sigmabb**2
      t1281 = t61*t401*t166*t77
      t1282 = 0.3039642D0*t1281
      t1283 = t406*t174
      t1284 = 0.1538928840745229D2*t1283
      t1285 = t410**2
      t1288 = t106*t445
      t1289 = t239*t410
      t1295 = t429*t139
      t1303 = t421**2
      t1304 = t112*t1303
      t1307 = 0.2724215777135184D0*t555*t1304*t559
      t1308 = t117*t410
      t1311 = 0.5448431554270369D0*t563*t422*t1308
      t1315 = t416*t131
      t1320 = -0.3216396844291482D2*(t505+t1282-t513+t516-t1284+t521)
     #*t114+0.1929838106574889D3*t1315*t410-0.3859676213149779D3*t574
     #*t1285+t578
      t1324 = 0.1362107888567592D0*t194*t112*t1320*t117
      t1327 = 0.1362107888567592D0*t194*t1304*t117
      t1330 = 0.8172647331405553D0*t120*t587*t1285
      t1336 = t429*t217
      t1340 = t441**2
      t1344 = t134*t1303
      t1361 = t1307+t1311-t1324-t1327+t1330-t593+0.1113202740058839D0
     #*t613*t1344*t559+0.2968540640156903D0*t618*t434*t1308
     #-0.3710675800196129D-1*t222*t134*t1320*t117
     #-0.3710675800196129D-1*t222*t1344*t117+0.3710675800196129D0*t129
     #*t631*t1285-t637
      t1369 = t445**2
      t1373 = t505+t1282-t513+t516-t1284+t521+0.1865441452179294D0
     #*t522*t1285+0.1865441452179294D0*t1288*t1289+t538
     #+0.310906908696549D-1*t107*(0.8172647331405553D0*t539*t189*t1285
     #-0.5448431554270369D0*t188*t1295*t410+0.5448431554270369D0*t188
     #*t218*t410*t441-t553+0.1362107888567592D0*t109*t112*(t1307+t1311
     #-t1324-t1327+t1330-t593)*t139-0.2724215777135184D0*t215*t1336
     #*t441+0.2724215777135184D0*t215*t605*t1340-0.1362107888567592D0
     #*t215*t218*t1361)*t239-0.310906908696549D-1*t107*t1369*t649
      t1378 = 0.87407428755417D-3*t246*t60*t401*t80
      t1379 = 0.349629715021668D-2*t1024
      t1383 = 0.1125D1*t282*t283*t401*t80
      t1384 = 0.45D1*t1031
      t1385 = -t1043
      t1388 = 0.37995525D-1*t61*t1385*t80
      t1389 = 0.1519821D0*t1049
      t1393 = 0.1519821D0*t61*t401*t74*t300
      t1394 = 0.6079284D0*t1056
      t1397 = 0.1923661050931536D1*t320*t401*t78
      t1398 = 0.7694644203726145D1*t1061
      t1401 = 0.1923661050931536D1*t97*t1385*t78
      t1402 = 0.7694644203726145D1*t1066
      t1404 = 0.7694644203726145D1*t406*t327
      t1405 = 0.3077857681490458D2*t1071
      t1406 = t336*t410
      t1411 = -t1088
      t1440 = t559*t421
      t1443 = 0.2724215777135184D0*t555*t355*t1440
      t1446 = 0.2724215777135184D0*t563*t355*t1308
      t1447 = -t1378-t1379-t1383-t1384+t1388+t1389+t1393-t1394+t1397
     #-t1398+t1401-t1402-t1404+t1405
      t1458 = -0.3216396844291482D2*t1447*t114+0.9649190532874446D2
     #*t921*t410+0.9649190532874446D2*t1315*t336-0.3859676213149779D3
     #*t574*t1406+0.9649190532874446D2*t198*t1411
      t1462 = 0.1362107888567592D0*t194*t112*t1458*t117
      t1463 = t421*t117
      t1466 = 0.1362107888567592D0*t194*t355*t1463
      t1469 = 0.2724215777135184D0*t563*t1144*t1463
      t1472 = 0.8172647331405553D0*t1148*t1144*t410
      t1475 = 0.2724215777135184D0*t120*t206*t1411
      t1479 = 0.3178251739991049D0*t194*t344*t421*t117
      t1482 = 0.6356503479982097D0*t120*t939*t410
      t1531 = t1443+t1446-t1462-t1466+t1469+t1472-t1475+t1479+t1482
     #+0.1113202740058839D0*t613*t370*t1440+0.1484270320078451D0*t618
     #*t370*t1308-0.3710675800196129D-1*t222*t134*t1458*t117
     #-0.3710675800196129D-1*t222*t370*t1463+0.1484270320078451D0*t618
     #*t1194*t1463+0.3710675800196129D0*t1198*t1194*t410
     #-0.7421351600392257D-1*t129*t229*t1411+0.1731648706758193D0*t222
     #*t378*t421*t117+0.3463297413516387D0*t129*t981*t410
      t1535 = 0.8172647331405553D0*t539*t189*t1406
     #-0.2724215777135184D0*t188*t1295*t336+0.2724215777135184D0*t188
     #*t218*t336*t441-0.2724215777135184D0*t188*t189*t1411
     #+0.6356503479982097D0*t886*t413-0.3178251739991049D0*t109*t344
     #*t429*t139+0.3178251739991049D0*t900*t442-0.2724215777135184D0
     #*t188*t889*t410+0.1362107888567592D0*t109*t112*(t1443+t1446
     #-t1462-t1466+t1469+t1472-t1475+t1479+t1482)*t139
     #-0.1362107888567592D0*t215*t954*t441+0.2724215777135184D0*t188
     #*t218*t382*t410-0.1362107888567592D0*t215*t1336*t382
     #+0.2724215777135184D0*t215*t605*t382*t441-0.1362107888567592D0
     #*t215*t218*t1531
      t1539 = t649*t445
      t1542 = -t1378-t1379-t1383-t1384+t1388+t1389+t1393-t1394+t1397
     #-t1398+t1401-t1402-t1404+t1405+0.1865441452179294D0*t522*t1406
     #+0.9327207260896469D-1*t1288*t866+0.9327207260896469D-1*t177
     #*t1411+0.9327207260896469D-1*t865*t1289+0.310906908696549D-1
     #*t107*t1535*t239-0.310906908696549D-1*t387*t1539
      t1543 = rho*t1542
      t1544 = t494+t495+0.7599105D-1*t403+0.3847322101863073D1*t407
     #+0.1865441452179294D0*t411-0.4135669939329333D0/t21*t29
     #+0.2147732158441357D-3/t1264/t20*t1268*t1270
     #-0.8963286558970112D-2/t18/t20/rhob*t397*sigmabb+t1005+rho*t1373
     #+2*t1543
      v2rhob2(i) = t1257+t1544
      t1545 = 0.5D0*t1543
      t1546 = t485+t486+t491+t493-t492+t173+t186+t165+t241+t484+t494
     #+t1545
      t1547 = -t502
      t1550 = 0.37995525D-1*t61*t1547*t80
      t1551 = 0.1519821D0*t508
      t1552 = 0.1519821D0*t1281
      t1553 = 0.4559463D0*t512
      t1556 = 0.1923661050931536D1*t97*t1547*t78
      t1557 = 0.7694644203726145D1*t517
      t1558 = 0.7694644203726145D1*t1283
      t1559 = 0.2308393261117844D2*t520
      t1560 = t184*t410
      t1565 = -t536
      t1588 = 0.2724215777135184D0*t555*t202*t1440
      t1591 = 0.2724215777135184D0*t563*t202*t1308
      t1603 = -0.3216396844291482D2*(t1550+t1551-t1552+t1553+t1556
     #-t1557+t1558-t1559)*t114+0.9649190532874446D2*t571*t410
     #+0.9649190532874446D2*t1315*t184-0.3859676213149779D3*t574*t1560
     #+0.9649190532874446D2*t198*t1565
      t1607 = 0.1362107888567592D0*t194*t112*t1603*t117
      t1610 = 0.1362107888567592D0*t194*t202*t1463
      t1611 = t112*t184
      t1614 = 0.2724215777135184D0*t563*t1611*t1463
      t1617 = 0.8172647331405553D0*t1148*t1611*t410
      t1620 = 0.2724215777135184D0*t120*t206*t1565
      t1653 = t134*t184
      t1663 = t1588+t1591-t1607-t1610+t1614+t1617-t1620
     #+0.1113202740058839D0*t613*t223*t1440+0.1484270320078451D0*t618
     #*t223*t1308-0.3710675800196129D-1*t222*t134*t1603*t117
     #-0.3710675800196129D-1*t222*t223*t1463+0.1484270320078451D0*t618
     #*t1653*t1463+0.3710675800196129D0*t1198*t1653*t410
     #-0.7421351600392257D-1*t129*t229*t1565
      t1667 = 0.8172647331405553D0*t539*t189*t1560
     #-0.2724215777135184D0*t188*t1295*t184+0.2724215777135184D0*t188
     #*t218*t184*t441-0.2724215777135184D0*t188*t189*t1565
     #-0.2724215777135184D0*t188*t543*t410+0.1362107888567592D0*t109
     #*t112*(t1588+t1591-t1607-t1610+t1614+t1617-t1620)*t139
     #-0.1362107888567592D0*t215*t599*t441+0.2724215777135184D0*t188
     #*t218*t233*t410-0.1362107888567592D0*t215*t1336*t233
     #+0.2724215777135184D0*t215*t605*t233*t441-0.1362107888567592D0
     #*t215*t218*t1663
      t1673 = t1550+t1551-t1552+t1553+t1556-t1557+t1558-t1559
     #+0.1865441452179294D0*t522*t1560+0.9327207260896469D-1*t1288
     #*t527+0.9327207260896469D-1*t177*t1565+0.9327207260896469D-1
     #*t526*t1289+0.310906908696549D-1*t107*t1667*t239
     #-0.310906908696549D-1*t238*t1539
      t1677 = -t488-t487+t489+rho*t1673+t495+t412+t404+t408+t1005+t448
     #+0.5D0*t1252+0.5D0*t1224+t1545
      v2rhoab(i) = t1546+t1677
      t1684 = t106*t471
      t1690 = sigma*t228*t134
      t1691 = t119*t139
      t1701 = t127*t108
      t1703 = 0.1362107888567592D0*t1701*t203
      t1704 = t119*t114
      t1706 = 0.2724215777135184D0*t1704*t1611
      t1717 = t457*t134
      t1718 = t119*t217
      t1726 = t554*t131
      t1739 = t649*t471
      t1743 = rho*(0.9327207260896469D-1*t1684*t527
     #+0.310906908696549D-1*t107*(-0.2724215777135184D0*t206*t190
     #-0.3710675800196129D-1*t1690*t1691*t184+0.2724215777135184D0
     #*t188*t218*t184*t467+0.1362107888567592D0*t121*t543
     #+0.1362107888567592D0*t109*t112*(-t1703-t1706)*t139
     #-0.1362107888567592D0*t215*t599*t467-0.1362107888567592D0*t121
     #*t234-0.1855337900098064D-1*t1717*t1718*t233
     #+0.2724215777135184D0*t215*t605*t233*t467-0.1362107888567592D0
     #*t215*t218*(-t1703-t1706-0.7421351600392257D-1*t1726*t224
     #-0.1484270320078451D0*t193*t230))*t239-0.310906908696549D-1*t238
     #*t1739)
      t1745 = t107*t471*t239
      t1746 = 0.310906908696549D-1*t1745
      t1769 = 0.1362107888567592D0*t1701*t356
      t1771 = 0.2724215777135184D0*t1704*t1144
      t1773 = 0.3178251739991049D0*t462*t344
      t1801 = -0.2724215777135184D0*t206*t339-0.3710675800196129D-1
     #*t1690*t1691*t336+0.2724215777135184D0*t188*t218*t336*t467
     #-0.3178251739991049D0*t362*t189-0.4329121766895483D-1*t457*t378
     #*t119*t139+0.3178251739991049D0*t900*t468+0.1362107888567592D0
     #*t121*t889+0.1362107888567592D0*t109*t112*(-t1769-t1771-t1773)
     #*t139-0.1362107888567592D0*t215*t954*t467-0.1362107888567592D0
     #*t121*t383-0.1855337900098064D-1*t1717*t1718*t382
     #+0.2724215777135184D0*t215*t605*t382*t467-0.1362107888567592D0
     #*t215*t218*(-t1769-t1771-t1773-0.7421351600392257D-1*t1726*t371
     #-0.1484270320078451D0*t193*t374-0.1731648706758193D0*t193*t379)
      t1808 = rho*(0.9327207260896469D-1*t1684*t866
     #+0.310906908696549D-1*t107*t1801*t239-0.310906908696549D-1*t387
     #*t1739)
      v2rhoasigmaaa(i) = 0.4481643279485056D-2*t155
     #-0.8053995594155087D-4/t1009/rhoa*t1013*sigmaaa+t1743+t1746+t1808
      t1810 = 0.6218138173930979D-1*t1745
      t1811 = 2.D0*t1808
      v2rhoasigmaab(i) = 2.D0*t1743+t1810+t1811
      v2rhoasigmabb(i) = t1743+t1746+t1808
      t1826 = 0.1362107888567592D0*t1701*t423
      t1829 = 0.2724215777135184D0*t1704*t112*t410
      t1862 = rho*(0.9327207260896469D-1*t1684*t1289
     #+0.310906908696549D-1*t107*(-0.2724215777135184D0*t206*t413
     #-0.3710675800196129D-1*t1690*t1691*t410+0.2724215777135184D0
     #*t188*t218*t410*t467+0.1362107888567592D0*t121*t1295
     #+0.1362107888567592D0*t109*t112*(-t1826-t1829)*t139
     #-0.1362107888567592D0*t215*t1336*t467-0.1362107888567592D0*t121
     #*t442-0.1855337900098064D-1*t1717*t1718*t441
     #+0.2724215777135184D0*t215*t605*t441*t467-0.1362107888567592D0
     #*t215*t218*(-t1826-t1829-0.7421351600392257D-1*t1726*t435
     #-0.1484270320078451D0*t193*t438))*t239-0.310906908696549D-1*t446
     #*t1739)
      v2rhobsigmaaa(i) = t1862+t1746+t1808
      v2rhobsigmaab(i) = 2.D0*t1862+t1810+t1811
      v2rhobsigmabb(i) = 0.4481643279485056D-2*t398
     #-0.8053995594155087D-4/t1264/rhob*t1268*sigmabb+t1862+t1746+t1808
      t1880 = t467**2
      t1891 = t454*(0.3710675800196129D-1*t135*t1691
     #-0.2724215777135184D0*t121*t468-0.3710675800196129D-1*t1717
     #*t1718*t467+0.2724215777135184D0*t215*t605*t1880
     #-0.5054340779364009D-2*sigma*t630*t808*t218*t127)*t239
      t1892 = 0.310906908696549D-1*t1891
      t1893 = t471**2
      t1895 = t454*t1893*t649
      t1896 = 0.310906908696549D-1*t1895
      v2sigmaaa2(i) = 0.3020248347808158D-4/t1009*t1013+t1892-t1896
      v2sigmaaaab(i) = 0.6218138173930979D-1*t1891
     #-0.6218138173930979D-1*t1895
      v2sigmaaabb(i) = t1892-t1896
      v2sigmaab2(i) = 0.1243627634786196D0*t1891-0.1243627634786196D0
     #*t1895
      v2sigmaabbb(i) = v2sigmaaaab(i)
      v2sigmabb2(i) = 0.3020248347808158D-4/t1264*t1268+t1892-t1896
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      v2rhob2(i) = 0.0d0
      v2rhoab(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2rhoasigmaab(i) = 0.0d0
      v2rhoasigmabb(i) = 0.0d0
      v2rhobsigmaaa(i) = 0.0d0
      v2rhobsigmaab(i) = 0.0d0
      v2rhobsigmabb(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      v2sigmaab2(i) = 0.0d0
      v2sigmabb2(i) = 0.0d0
      v2sigmaaaab(i) = 0.0d0
      v2sigmaaabb(i) = 0.0d0
      v2sigmaabbb(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end
      
      
      subroutine rks_xc_pbe
     & (ideriv,npt,rhoa1,sigmaaa1,
     &  zk,vrhoa,vsigmaaa,
     &  v2rhoa2,v2rhoasigmaaa,v2sigmaaa2)
c
c     J.P. Perdew, K. Burke, and M. Ernzerhof
c     Generalized gradient approximation made simple
c     Phys. Rev. Lett. 77 (1996) 3865-3868
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt)
      REAL sigmaaa1(npt)
      REAL zk(npt),vrhoa(npt),vsigmaaa(npt)
      REAL v2rhoa2(npt),v2rhoasigmaaa(npt),v2sigmaaa2(npt)
      parameter(tol=1.0d-20)
      
      if(ideriv.eq.0) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t4 = rho**2
      t5 = t2**2
      t16 = 1/rho
      t17 = t16**(1.D0/3.D0)
      t20 = t16**(1.D0/6.D0)
      t23 = dsqrt(t16)
      t25 = t17**2
      t31 = dlog(1.D0+0.1608197949869254D2/(0.598255043577108D1*t20
     #+0.2225569421150687D1*t17+0.8004286349993634D0*t23
     #+0.1897004325747559D0*t25))
      t32 = (1.D0+0.1325688999052018D0*t17)*t31
      t35 = 1/t2/t4
      t38 = dexp(0.2000000587336264D1*t32)
      t39 = t38-1.D0
      t43 = 0.1362107888567592D0/t39*sigma*t35
      t45 = t39**2
      t47 = sigma**2
      t49 = t4**2
      t60 = dlog(1.D0+0.1362107888567592D0*sigma*t35*(1.D0+t43)/(1.D0
     #+t43+0.1855337900098064D-1/t45*t47/t5/t49))
      zk(i) = -0.7385587663820224D0*t2*rho*(0.1804D1-0.804D0/(1.D0
     #+0.7131826587600489D-2*sigma/t5/t4))+rho*(-0.621814D-1*t32
     #+0.310906908696549D-1*t60)
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t3 = t2*rho
      t4 = rho**2
      t5 = t2**2
      t10 = 1.D0+0.7131826587600489D-2*sigma/t5/t4
      t13 = 0.1804D1-0.804D0/t10
      t16 = 1/rho
      t17 = t16**(1.D0/3.D0)
      t19 = 1.D0+0.1325688999052018D0*t17
      t20 = t16**(1.D0/6.D0)
      t23 = dsqrt(t16)
      t25 = t17**2
      t27 = 0.598255043577108D1*t20+0.2225569421150687D1*t17
     #+0.8004286349993634D0*t23+0.1897004325747559D0*t25
      t30 = 1.D0+0.1608197949869254D2/t27
      t31 = dlog(t30)
      t32 = t19*t31
      t33 = 0.621814D-1*t32
      t35 = 1/t2/t4
      t36 = sigma*t35
      t38 = dexp(0.2000000587336264D1*t32)
      t39 = t38-1.D0
      t40 = 1/t39
      t41 = t40*sigma
      t43 = 0.1362107888567592D0*t41*t35
      t44 = 1.D0+t43
      t45 = t39**2
      t46 = 1/t45
      t47 = sigma**2
      t48 = t46*t47
      t49 = t4**2
      t51 = 1/t5/t49
      t54 = 1.D0+t43+0.1855337900098064D-1*t48*t51
      t55 = 1/t54
      t56 = t44*t55
      t59 = 1.D0+0.1362107888567592D0*t36*t56
      t60 = dlog(t59)
      t61 = 0.310906908696549D-1*t60
      zk(i) = -0.7385587663820224D0*t3*t13+rho*(-t33+t61)
      t66 = t10**2
      t67 = 1/t66
      t72 = 1/t4
      t73 = 1/t25*t72
      t74 = t73*t31
      t76 = t27**2
      t79 = t20**2
      t80 = t79**2
      t95 = t19/t76*(-0.99709173929518D0/t80/t20*t72
     #-0.7418564737168958D0*t73-0.4002143174996817D0/t23*t72
     #-0.1264669550498372D0/t17*t72)/t30
      t99 = 1/t2/t4/rho
      t103 = t46*sigma
      t106 = -0.8837929255764197D-1*t74-0.3216396844291482D2*t95
      t110 = 0.1362107888567592D0*t103*t35*t106*t38
      t112 = 0.3178251739991049D0*t41*t99
      t117 = t54**2
      t119 = t44/t117
      t137 = 1/t59
      vrhoa(i) = -0.9847450218426965D0*t2*t13+0.1129303341188623D-1
     #*t35*t67*sigma-t33+t61+rho*(0.2747773264188438D-2*t74+0.1D1*t95
     #+0.310906908696549D-1*(-0.3178251739991049D0*sigma*t99*t56
     #+0.1362107888567592D0*t36*(-t110-t112)*t55-0.1362107888567592D0
     #*t36*t119*(-t110-t112-0.3710675800196129D-1/t45/t39*t47*t51*t106
     #*t38-0.8658243533790967D-1*t48/t5/t49/rho))*t137)
      vsigmaaa(i) = -0.1693955011782934D-1/t3*t67+0.1243627634786196D0
     #*rho*(0.1362107888567592D0*t35*t44*t55+0.1855337900098064D-1
     #*sigma*t51*t40*t55-0.1362107888567592D0*t36*t119*
     #(0.1362107888567592D0*t40*t35+0.3710675800196129D-1*t103*t51))
     #*t137
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t3 = t2*rho
      t4 = rho**2
      t5 = t2**2
      t10 = 1.D0+0.7131826587600489D-2*sigma/t5/t4
      t13 = 0.1804D1-0.804D0/t10
      t16 = 1/rho
      t17 = t16**(1.D0/3.D0)
      t19 = 1.D0+0.1325688999052018D0*t17
      t20 = t16**(1.D0/6.D0)
      t23 = dsqrt(t16)
      t25 = t17**2
      t27 = 0.598255043577108D1*t20+0.2225569421150687D1*t17
     #+0.8004286349993634D0*t23+0.1897004325747559D0*t25
      t30 = 1.D0+0.1608197949869254D2/t27
      t31 = dlog(t30)
      t32 = t19*t31
      t33 = 0.621814D-1*t32
      t35 = 1/t2/t4
      t36 = sigma*t35
      t38 = dexp(0.2000000587336264D1*t32)
      t39 = t38-1.D0
      t40 = 1/t39
      t41 = t40*sigma
      t43 = 0.1362107888567592D0*t41*t35
      t44 = 1.D0+t43
      t45 = t39**2
      t46 = 1/t45
      t47 = sigma**2
      t48 = t46*t47
      t49 = t4**2
      t51 = 1/t5/t49
      t54 = 1.D0+t43+0.1855337900098064D-1*t48*t51
      t55 = 1/t54
      t56 = t44*t55
      t59 = 1.D0+0.1362107888567592D0*t36*t56
      t60 = dlog(t59)
      t61 = 0.310906908696549D-1*t60
      zk(i) = -0.7385587663820224D0*t3*t13+rho*(-t33+t61)
      t66 = t10**2
      t67 = 1/t66
      t68 = t35*t67
      t71 = 1/t25
      t72 = 1/t4
      t73 = t71*t72
      t74 = t73*t31
      t76 = t27**2
      t77 = 1/t76
      t78 = t19*t77
      t79 = t20**2
      t80 = t79**2
      t81 = t80*t20
      t82 = 1/t81
      t86 = 1/t23
      t89 = 1/t17
      t92 = -0.99709173929518D0*t82*t72-0.7418564737168958D0*t73
     #-0.4002143174996817D0*t86*t72-0.1264669550498372D0*t89*t72
      t93 = 1/t30
      t95 = t78*t92*t93
      t97 = t4*rho
      t99 = 1/t2/t97
      t100 = sigma*t99
      t103 = t46*sigma
      t106 = -0.8837929255764197D-1*t74-0.3216396844291482D2*t95
      t110 = 0.1362107888567592D0*t103*t35*t106*t38
      t112 = 0.3178251739991049D0*t41*t99
      t113 = -t110-t112
      t114 = t113*t55
      t117 = t54**2
      t118 = 1/t117
      t119 = t44*t118
      t121 = 1/t45/t39
      t122 = t121*t47
      t124 = t51*t106*t38
      t127 = t49*rho
      t129 = 1/t5/t127
      t132 = -t110-t112-0.3710675800196129D-1*t122*t124
     #-0.8658243533790967D-1*t48*t129
      t133 = t119*t132
      t136 = -0.3178251739991049D0*t100*t56+0.1362107888567592D0*t36
     #*t114-0.1362107888567592D0*t36*t133
      t137 = 1/t59
      t138 = t136*t137
      vrhoa(i) = -0.9847450218426965D0*t2*t13+0.1129303341188623D-1
     #*t68*sigma-t33+t61+rho*(0.2747773264188438D-2*t74+0.1D1*t95
     #+0.310906908696549D-1*t138)
      t145 = t35*t44
      t148 = sigma*t51
      t149 = t40*t55
      t156 = 0.1362107888567592D0*t40*t35+0.3710675800196129D-1*t103*t51
      t157 = t119*t156
      t160 = 0.1362107888567592D0*t145*t55+0.1855337900098064D-1*t148
     #*t149-0.1362107888567592D0*t36*t157
      vsigmaaa(i) = -0.1693955011782934D-1/t3*t67+0.1243627634786196D0
     #*rho*t160*t137
      t170 = t49*t4
      t173 = 1/t66/t10
      t190 = dlog(1.D0+0.2960874997779344D2/(0.8157414703487641D1*t20
     #+0.2247591863577616D1*t17+0.4300972471276643D0*t23
     #+0.1911512595127338D0*t25))
      t192 = (1.D0+0.6901399211255825D-1*t17)*t190*t72
      t194 = t60*t72
      t197 = 1/t2/t49
      t199 = sigma*t197*t56
      t204 = 0.1086299437397317D1*t192-0.1333333724890842D1*t32*t72
      t208 = 0.1362107888567592D0*t103*t35*t204*t38
      t209 = t41*t197
      t210 = 0.6053812838078188D-1*t209
      t221 = t48/t5/t170
      t232 = t76**2
      t235 = t92**2
      t236 = t30**2
      t239 = t19/t232*t235/t236
      t243 = 1/t49
      t244 = 1/t25/t16*t243
      t245 = t244*t31
      t251 = t19/t76/t27*t235*t93
      t257 = 1/t97
      t261 = t71*t257
      t277 = t78*(-0.8309097827459833D0/t81/t16*t243
     #+0.199418347859036D1*t82*t257-0.4945709824779306D0*t244
     #+0.1483712947433792D1*t261-0.2001071587498409D0/t23/t16*t243
     #+0.8004286349993634D0*t86*t257-0.4215565168327908D-1/t17/t16
     #*t243+0.2529339100996745D0*t89*t257)*t93
      t281 = t73*t77*t92*t93
      t283 = t261*t31
      t285 = t136**2
      t286 = t59**2
      t287 = 1/t286
      t295 = t121*sigma
      t296 = t106**2
      t297 = t35*t296
      t299 = dexp(0.4000001174672527D1*t32)
      t302 = 0.2724215777135184D0*t295*t297*t299
      t306 = 0.6356503479982097D0*t103*t99*t106*t38
      t313 = -0.5172602810955498D3*t239-0.5891952837176131D-1*t245
     #+0.6432793688582964D2*t251-0.3216396844291482D2*t277
     #+0.2842627942041896D1*t281+0.1767585851152839D0*t283
      t317 = 0.1362107888567592D0*t103*t35*t313*t38
      t320 = 0.1362107888567592D0*t103*t297*t38
      t321 = 0.1059417246663683D1*t209
      t326 = t113*t118
      t331 = 1/t117/t54
      t332 = t44*t331
      t333 = t132**2
      t341 = t45**2
      t344 = t51*t296
      t369 = -t204
      t373 = 0.1362107888567592D0*t103*t35*t369*t38
      t374 = 0.6053812838078188D-1*t209
      s1 = 0.4D1*t95+0.1099109305675375D-1*t74+0.1243627634786196D0
     #*t138-0.6564966812284644D0/t5*t13
      s2 = s1+0.8590928633765426D-3/t170*t173*t47
     #-0.2258606682377246D-1*t99*t67*sigma
      s3 = s2+rho*(-0.337738D-1*t192+0.207271272464366D-1*t194
     #+0.310906908696549D-1*(-0.6053812838078188D-1*t199
     #+0.1362107888567592D0*t36*(-t208-t210)*t55-0.1362107888567592D0
     #*t36*t119*(-t208-t210-0.3710675800196129D-1*t122*t51*t204*t38
     #-0.1649189244531613D-1*t221))*t137)
      s4 = s3
      s6 = 2.D0*rho*(0.1608197949869254D2*t239+0.1831848842792292D-2
     #*t245-0.2D1*t251+0.1D1*t277-0.8837926660346786D-1*t281
     #-0.5495546528376876D-2*t283-0.310906908696549D-1*t285*t287
     #+0.310906908696549D-1*(0.6356503479982097D0*t100*t133
     #+0.1059417246663683D1*t199-0.6356503479982097D0*t100*t114
     #+0.1362107888567592D0*t36*(t302+t306-t317-t320+t321)*t55
     #-0.2724215777135184D0*t36*t326*t132+0.2724215777135184D0*t36
     #*t332*t333-0.1362107888567592D0*t36*t119*(t302+t306-t317-t320
     #+t321+0.3463297413516387D0*t122*t129*t106*t38
     #+0.1113202740058839D0/t341*t47*t344*t299-0.3710675800196129D-1
     #*t122*t51*t313*t38-0.3710675800196129D-1*t122*t344*t38
     #+0.4906338002481548D0*t221))*t137)
      s7 = rho*(0.337738D-1*t192-0.207271272464366D-1*t194
     #+0.310906908696549D-1*(0.6053812838078188D-1*t199
     #+0.1362107888567592D0*t36*(-t373+t374)*t55-0.1362107888567592D0
     #*t36*t119*(-t373+t374-0.3710675800196129D-1*t122*t51*t369*t38
     #+0.1649189244531613D-1*t221))*t137)
      s5 = s6+s7
      v2rhoa2(i) = s4+s5
      t414 = 0.1362107888567592D0*t46*t35*t106*t38
      t416 = 0.3178251739991049D0*t40*t99
      t427 = t40*t118
      v2rhoasigmaaa(i) = 0.2258606682377246D-1*t68
     #-0.644319647532407D-3/t127*t173*sigma+0.1243627634786196D0*t160
     #*t137+4.D0*rho*(0.310906908696549D-1*(-0.3178251739991049D0*t99
     #*t44*t55-0.4329121766895483D-1*sigma*t129*t149
     #+0.3178251739991049D0*t100*t157+0.1362107888567592D0*t35*t113
     #*t55+0.1362107888567592D0*t36*(-t414-t416)*t55
     #-0.1362107888567592D0*t36*t326*t156-0.1362107888567592D0*t145
     #*t118*t132-0.1855337900098064D-1*t148*t427*t132
     #+0.2724215777135184D0*t36*t44*t331*t132*t156
     #-0.1362107888567592D0*t36*t119*(-t414-t416-0.7421351600392257D-1
     #*t295*t124-0.1731648706758193D0*t103*t129))*t137
     #-0.310906908696549D-1*t136*t287*t160)
      t464 = t156**2
      t478 = t160**2
      v2sigmaaa2(i) = 0.9664794712986105D-3*t243*t173
     #+0.4974510539144783D0*rho*(0.3710675800196129D-1*t51*t40*t55
     #-0.2724215777135184D0*t145*t118*t156-0.3710675800196129D-1*t148
     #*t427*t156+0.2724215777135184D0*t36*t332*t464
     #-0.5054340779364009D-2*sigma/t49/t97*t119*t46)*t137
     #-0.4974510539144783D0*rho*t478*t287
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end

c:XC_PBEsubrend
_ENDIF
_IF(ccpdft,all,xc_revpbe)
c:XC_REVPBEsubrstart
c    Generated: Fri Aug 14 17:02:11 BST 2009

      subroutine uks_xc_revpbe
     & (ideriv,npt,rhoa1,rhob1,sigmaaa1,sigmabb1,sigmaab1,
     &  zk,vrhoa,vrhob,vsigmaaa,vsigmabb,vsigmaab,
     &  v2rhoa2,v2rhob2,v2rhoab,
     &  v2rhoasigmaaa,v2rhoasigmaab,v2rhoasigmabb,
     &  v2rhobsigmabb,v2rhobsigmaab,v2rhobsigmaaa,
     &  v2sigmaaa2,v2sigmaaaab,v2sigmaaabb,
     &  v2sigmaab2,v2sigmaabbb,v2sigmabb2)
c
c     Y. Zhang, and W. Yang
c     Comment on: Generalized gradient approximation made simple
c     Phys. Rev. Lett. 80 (1998) 890-890
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt),rhob1(npt)
      REAL sigmaaa1(npt),sigmabb1(npt),sigmaab1(npt)
      REAL zk(npt),vrhoa(npt),vrhob(npt)
      REAL vsigmaaa(npt),vsigmabb(npt),vsigmaab(npt)
      REAL v2rhoa2(npt),v2rhob2(npt),v2rhoab(npt)
      REAL v2rhoasigmaaa(npt),v2rhoasigmaab(npt)
      REAL v2rhoasigmabb(npt),v2rhobsigmabb(npt)
      REAL v2rhobsigmaab(npt),v2rhobsigmaaa(npt)
      REAL v2sigmaaa2(npt),v2sigmaaaab(npt),v2sigmaaabb(npt)
      REAL v2sigmaab2(npt),v2sigmaabbb(npt),v2sigmabb2(npt)
      parameter(tol=1.0d-20)
      
      if (ideriv.eq.0) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t4 = rhob**2
      t5 = t2**2
      t16 = 1/rhob
      t17 = t16**(1.D0/3.D0)
      t20 = t16**(1.D0/6.D0)
      t23 = dsqrt(t16)
      t25 = t17**2
      t31 = dlog(1.D0+0.3216395899738507D2/(0.1112037486309468D2*t20
     #+0.3844746237447211D1*t17+0.1644733775567609D1*t23
     #+0.2405871291288192D0*t25))
      t32 = (1.D0+0.1274696188700087D0*t17)*t31
      t35 = 1/t2/t4
      t38 = dexp(0.2000000587336264D1*t32)
      t39 = t38-1.D0
      t43 = 0.2162211495206379D0/t39*sigmabb*t35
      t45 = t39**2
      t47 = sigmabb**2
      t49 = t4**2
      t60 = dlog(1.D0+0.2162211495206379D0*sigmabb*t35*(1.D0+t43)/
     #(1.D0+t43+0.4675158550002605D-1/t45*t47/t5/t49))
      zk(i) = -0.9305257363491D0*t2*rhob*(0.2245D1-0.1245D1/(1.D0
     #+0.2901354581245741D-2*sigmabb/t5/t4))+rhob*(-0.310907D-1*t32
     #+0.1554534543482745D-1*t60)
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t4 = rhoa**2
      t5 = t2**2
      t16 = 1/rhoa
      t17 = t16**(1.D0/3.D0)
      t20 = t16**(1.D0/6.D0)
      t23 = dsqrt(t16)
      t25 = t17**2
      t31 = dlog(1.D0+0.3216395899738507D2/(0.1112037486309468D2*t20
     #+0.3844746237447211D1*t17+0.1644733775567609D1*t23
     #+0.2405871291288192D0*t25))
      t32 = (1.D0+0.1274696188700087D0*t17)*t31
      t35 = 1/t2/t4
      t38 = dexp(0.2000000587336264D1*t32)
      t39 = t38-1.D0
      t43 = 0.2162211495206379D0/t39*sigmaaa*t35
      t45 = t39**2
      t47 = sigmaaa**2
      t49 = t4**2
      t60 = dlog(1.D0+0.2162211495206379D0*sigmaaa*t35*(1.D0+t43)/
     #(1.D0+t43+0.4675158550002605D-1/t45*t47/t5/t49))
      zk(i) = -0.9305257363491D0*t2*rhoa*(0.2245D1-0.1245D1/(1.D0
     #+0.2901354581245741D-2*sigmaaa/t5/t4))+rhoa*(-0.310907D-1*t32
     #+0.1554534543482745D-1*t60)
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t6 = rhoa**2
      t7 = t4**2
      t18 = rhob**(1.D0/3.D0)
      t20 = rhob**2
      t21 = t18**2
      t32 = 1/rho
      t33 = t32**(1.D0/3.D0)
      t36 = t32**(1.D0/6.D0)
      t39 = dsqrt(t32)
      t41 = t33**2
      t47 = dlog(1.D0+0.1608197949869254D2/(0.598255043577108D1*t36
     #+0.2225569421150687D1*t33+0.8004286349993634D0*t39
     #+0.1897004325747559D0*t41))
      t49 = 0.621814D-1*(1.D0+0.1325688999052018D0*t33)*t47
      t60 = dlog(1.D0+0.2960874997779344D2/(0.8157414703487641D1*t36
     #+0.2247591863577616D1*t33+0.4300972471276643D0*t39
     #+0.1911512595127338D0*t41))
      t63 = rhoa-1.D0*rhob
      t64 = t63*t32
      t65 = 1.D0+t64
      t66 = t65**(1.D0/3.D0)
      t69 = 1.D0-1.D0*t64
      t70 = t69**(1.D0/3.D0)
      t72 = t66*t65+t70*t69-2.D0
      t73 = t63**2
      t74 = t73**2
      t75 = rho**2
      t76 = t75**2
      t78 = t74/t76
      t83 = 0.37995525D-1*(1.D0+0.6901399211255825D-1*t33)*t60*t72*
     #(1.D0-1.D0*t78)
      t94 = dlog(1.D0+0.3216395899738507D2/(0.1112037486309468D2*t36
     #+0.3844746237447211D1*t33+0.1644733775567609D1*t39
     #+0.2405871291288192D0*t41))
      t100 = 0.1923661050931536D1*(-0.310907D-1*(1.D0
     #+0.1274696188700087D0*t33)*t94+t49)*t72*t78
      t101 = t66**2
      t103 = t70**2
      t105 = 0.5D0*t101+0.5D0*t103
      t106 = t105**2
      t107 = t106*t105
      t108 = 1/t106
      t110 = rho**(1.D0/3.D0)
      t112 = 1/t110/t75
      t117 = dexp(-0.3216396844291482D2*(-t49+t83+t100)/t107)
      t118 = t117-1.D0
      t123 = 0.1362107888567592D0/t118*sigma*t108*t112
      t126 = t118**2
      t128 = sigma**2
      t130 = t106**2
      t132 = t110**2
      t144 = dlog(1.D0+0.1362107888567592D0*sigma*t108*t112*(1.D0+t123
     #)/(1.D0+t123+0.1855337900098064D-1/t126*t128/t130/t132/t76))
      zk(i) = -0.9305257363491D0*t4*rhoa*(0.2245D1-0.1245D1/(1.D0
     #+0.2901354581245741D-2*sigmaaa/t7/t6))-0.9305257363491D0*t18
     #*rhob*(0.2245D1-0.1245D1/(1.D0+0.2901354581245741D-2*sigmabb/t21
     #/t20))+rho*(-t49+t83+t100+0.310906908696549D-1*t107*t144)
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t3 = t2*rhob
      t4 = rhob**2
      t5 = t2**2
      t10 = 1.D0+0.2901354581245741D-2*sigmabb/t5/t4
      t13 = 0.2245D1-0.1245D1/t10
      t16 = 1/rhob
      t17 = t16**(1.D0/3.D0)
      t19 = 1.D0+0.1274696188700087D0*t17
      t20 = t16**(1.D0/6.D0)
      t23 = dsqrt(t16)
      t25 = t17**2
      t27 = 0.1112037486309468D2*t20+0.3844746237447211D1*t17
     #+0.1644733775567609D1*t23+0.2405871291288192D0*t25
      t30 = 1.D0+0.3216395899738507D2/t27
      t31 = dlog(t30)
      t32 = t19*t31
      t33 = 0.310907D-1*t32
      t35 = 1/t2/t4
      t36 = sigmabb*t35
      t38 = dexp(0.2000000587336264D1*t32)
      t39 = t38-1.D0
      t40 = 1/t39
      t41 = t40*sigmabb
      t43 = 0.2162211495206379D0*t41*t35
      t44 = 1.D0+t43
      t45 = t39**2
      t46 = 1/t45
      t47 = sigmabb**2
      t48 = t46*t47
      t49 = t4**2
      t51 = 1/t5/t49
      t52 = t48*t51
      t54 = 1.D0+t43+0.4675158550002605D-1*t52
      t55 = 1/t54
      t56 = t44*t55
      t59 = 1.D0+0.2162211495206379D0*t36*t56
      t60 = dlog(t59)
      t61 = 0.1554534543482745D-1*t60
      zk(i) = -0.9305257363491D0*t3*t13+rhob*(-t33+t61)
      vrhoa(i) = 0.D0
      t66 = t10**2
      t67 = 1/t66
      t73 = 1/t2/t4/rhob
      t79 = 1/t5/t49/rhob
      t81 = t40*t55
      t84 = t54**2
      t86 = t44/t84
      t97 = 1/t59
      t101 = 1/t4
      t102 = 1/t25*t101
      t103 = t102*t31
      t105 = t27**2
      t108 = t20**2
      t109 = t108**2
      t124 = t19/t105*(-0.1853395810515781D1/t109/t20*t101
     #-0.128158207914907D1*t102-0.8223668877838045D0/t23*t101
     #-0.1603914194192128D0/t17*t101)/t30
      t128 = -0.8497977086918237D-1*t103-0.6432793688582964D2*t124
      t133 = t46*sigmabb
      vrhob(i) = -0.12407009817988D1*t2*t13+0.8963286558970112D-2*t35
     #*t67*sigmabb-t33+t61+0.1554534543482745D-1*rhob*(
     #-0.5045160155481551D0*sigmabb*t73*t56-0.1090870328333941D0*t47
     #*t79*t81-0.2162211495206379D0*t36*t86*(-0.5045160155481551D0*t41
     #*t73-0.2181740656667882D0*t48*t79))*t97+rhob*
     #(0.1321039893133927D-2*t103+0.1D1*t124+0.1554534543482745D-1*(
     #-0.4675158550002605D-1*t52*t128*t38*t55-0.2162211495206379D0*t36
     #*t86*(-0.2162211495206379D0*t133*t35*t128*t38
     #-0.935031710000521D-1/t45/t39*t47*t51*t128*t38))*t97)
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      vsigmabb(i) = -0.3361232459613792D-2/t3*t67
     #+0.1554534543482745D-1*rhob*(0.2162211495206379D0*t35*t44*t55
     #+0.4675158550002605D-1*sigmabb*t51*t81-0.2162211495206379D0*t36
     #*t86*(0.2162211495206379D0*t40*t35+0.935031710000521D-1*t133*t51
     #))*t97
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t3 = t2*rhoa
      t4 = rhoa**2
      t5 = t2**2
      t10 = 1.D0+0.2901354581245741D-2*sigmaaa/t5/t4
      t13 = 0.2245D1-0.1245D1/t10
      t16 = 1/rhoa
      t17 = t16**(1.D0/3.D0)
      t19 = 1.D0+0.1274696188700087D0*t17
      t20 = t16**(1.D0/6.D0)
      t23 = dsqrt(t16)
      t25 = t17**2
      t27 = 0.1112037486309468D2*t20+0.3844746237447211D1*t17
     #+0.1644733775567609D1*t23+0.2405871291288192D0*t25
      t30 = 1.D0+0.3216395899738507D2/t27
      t31 = dlog(t30)
      t32 = t19*t31
      t33 = 0.310907D-1*t32
      t35 = 1/t2/t4
      t36 = sigmaaa*t35
      t38 = dexp(0.2000000587336264D1*t32)
      t39 = t38-1.D0
      t40 = 1/t39
      t41 = t40*sigmaaa
      t43 = 0.2162211495206379D0*t41*t35
      t44 = 1.D0+t43
      t45 = t39**2
      t46 = 1/t45
      t47 = sigmaaa**2
      t48 = t46*t47
      t49 = t4**2
      t51 = 1/t5/t49
      t52 = t48*t51
      t54 = 1.D0+t43+0.4675158550002605D-1*t52
      t55 = 1/t54
      t56 = t44*t55
      t59 = 1.D0+0.2162211495206379D0*t36*t56
      t60 = dlog(t59)
      t61 = 0.1554534543482745D-1*t60
      zk(i) = -0.9305257363491D0*t3*t13+rhoa*(-t33+t61)
      t66 = t10**2
      t67 = 1/t66
      t73 = 1/t2/t4/rhoa
      t79 = 1/t5/t49/rhoa
      t81 = t40*t55
      t84 = t54**2
      t86 = t44/t84
      t97 = 1/t59
      t101 = 1/t4
      t102 = 1/t25*t101
      t103 = t102*t31
      t105 = t27**2
      t108 = t20**2
      t109 = t108**2
      t124 = t19/t105*(-0.1853395810515781D1/t109/t20*t101
     #-0.128158207914907D1*t102-0.8223668877838045D0/t23*t101
     #-0.1603914194192128D0/t17*t101)/t30
      t128 = -0.8497977086918237D-1*t103-0.6432793688582964D2*t124
      t133 = t46*sigmaaa
      vrhoa(i) = -0.12407009817988D1*t2*t13+0.8963286558970112D-2*t35
     #*t67*sigmaaa-t33+t61+0.1554534543482745D-1*rhoa*(
     #-0.5045160155481551D0*sigmaaa*t73*t56-0.1090870328333941D0*t47
     #*t79*t81-0.2162211495206379D0*t36*t86*(-0.5045160155481551D0*t41
     #*t73-0.2181740656667882D0*t48*t79))*t97+rhoa*
     #(0.1321039893133927D-2*t103+0.1D1*t124+0.1554534543482745D-1*(
     #-0.4675158550002605D-1*t52*t128*t38*t55-0.2162211495206379D0*t36
     #*t86*(-0.2162211495206379D0*t133*t35*t128*t38
     #-0.935031710000521D-1/t45/t39*t47*t51*t128*t38))*t97)
      vrhob(i) = 0.D0
      vsigmaaa(i) = -0.3361232459613792D-2/t3*t67
     #+0.1554534543482745D-1*rhoa*(0.2162211495206379D0*t35*t44*t55
     #+0.4675158550002605D-1*sigmaaa*t51*t81-0.2162211495206379D0*t36
     #*t86*(0.2162211495206379D0*t40*t35+0.935031710000521D-1*t133*t51
     #))*t97
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t5 = t4*rhoa
      t6 = rhoa**2
      t7 = t4**2
      t12 = 1.D0+0.2901354581245741D-2*sigmaaa/t7/t6
      t15 = 0.2245D1-0.1245D1/t12
      t18 = rhob**(1.D0/3.D0)
      t19 = t18*rhob
      t20 = rhob**2
      t21 = t18**2
      t26 = 1.D0+0.2901354581245741D-2*sigmabb/t21/t20
      t29 = 0.2245D1-0.1245D1/t26
      t32 = 1/rho
      t33 = t32**(1.D0/3.D0)
      t35 = 1.D0+0.1325688999052018D0*t33
      t36 = t32**(1.D0/6.D0)
      t39 = dsqrt(t32)
      t41 = t33**2
      t43 = 0.598255043577108D1*t36+0.2225569421150687D1*t33
     #+0.8004286349993634D0*t39+0.1897004325747559D0*t41
      t46 = 1.D0+0.1608197949869254D2/t43
      t47 = dlog(t46)
      t49 = 0.621814D-1*t35*t47
      t51 = 1.D0+0.6901399211255825D-1*t33
      t56 = 0.8157414703487641D1*t36+0.2247591863577616D1*t33
     #+0.4300972471276643D0*t39+0.1911512595127338D0*t41
      t59 = 1.D0+0.2960874997779344D2/t56
      t60 = dlog(t59)
      t61 = t51*t60
      t63 = rhoa-1.D0*rhob
      t64 = t63*t32
      t65 = 1.D0+t64
      t66 = t65**(1.D0/3.D0)
      t69 = 1.D0-1.D0*t64
      t70 = t69**(1.D0/3.D0)
      t72 = t66*t65+t70*t69-2.D0
      t73 = t63**2
      t74 = t73**2
      t75 = rho**2
      t76 = t75**2
      t77 = 1/t76
      t78 = t74*t77
      t80 = 1.D0-1.D0*t78
      t83 = 0.37995525D-1*t61*t72*t80
      t85 = 1.D0+0.1274696188700087D0*t33
      t90 = 0.1112037486309468D2*t36+0.3844746237447211D1*t33
     #+0.1644733775567609D1*t39+0.2405871291288192D0*t41
      t93 = 1.D0+0.3216395899738507D2/t90
      t94 = dlog(t93)
      t97 = -0.310907D-1*t85*t94+t49
      t98 = t97*t72
      t100 = 0.1923661050931536D1*t98*t78
      t101 = t66**2
      t103 = t70**2
      t105 = 0.5D0*t101+0.5D0*t103
      t106 = t105**2
      t107 = t106*t105
      t108 = 1/t106
      t109 = sigma*t108
      t110 = rho**(1.D0/3.D0)
      t112 = 1/t110/t75
      t113 = -t49+t83+t100
      t114 = 1/t107
      t117 = dexp(-0.3216396844291482D2*t113*t114)
      t118 = t117-1.D0
      t119 = 1/t118
      t120 = t119*sigma
      t121 = t108*t112
      t123 = 0.1362107888567592D0*t120*t121
      t124 = 1.D0+t123
      t126 = t118**2
      t127 = 1/t126
      t128 = sigma**2
      t129 = t127*t128
      t130 = t106**2
      t131 = 1/t130
      t132 = t110**2
      t134 = 1/t132/t76
      t135 = t131*t134
      t138 = 1.D0+t123+0.1855337900098064D-1*t129*t135
      t139 = 1/t138
      t143 = 1.D0+0.1362107888567592D0*t109*t112*t124*t139
      t144 = dlog(t143)
      t146 = 0.310906908696549D-1*t107*t144
      zk(i) = -0.9305257363491D0*t5*t15-0.9305257363491D0*t19*t29+rho*
     #(-t49+t83+t100+t146)
      t153 = t12**2
      t154 = 1/t153
      t162 = 0.1333333333333333D1*t66*t32-0.1333333333333333D1*t70*t32
      t165 = 0.37995525D-1*t61*t162*t80
      t166 = t73*t63
      t169 = t61*t72*t166*t77
      t170 = 0.1519821D0*t169
      t173 = 0.1923661050931536D1*t97*t162*t78
      t175 = t98*t166*t77
      t176 = 0.7694644203726145D1*t175
      t177 = t106*t144
      t178 = 1/t66
      t181 = 1/t70
      t184 = 0.3333333333333333D0*t178*t32-0.3333333333333333D0*t181*t32
      t188 = sigma*t114*t112
      t189 = t124*t139
      t193 = t127*sigma
      t194 = t193*t108
      t198 = t113*t131
      t201 = -0.3216396844291482D2*(t165-t170+t173+t176)*t114
     #+0.9649190532874446D2*t198*t184
      t205 = 0.1362107888567592D0*t194*t112*t201*t117
      t206 = t114*t112
      t209 = 0.2724215777135184D0*t120*t206*t184
      t215 = t109*t112
      t216 = t138**2
      t218 = t124/t216
      t222 = 1/t126/t118*t128*t131
      t229 = 1/t130/t105*t134
      t239 = 1/t143
      t245 = 1/t75
      t246 = 1/t41*t245
      t247 = t246*t47
      t248 = 0.2747773264188438D-2*t247
      t249 = t43**2
      t252 = t36**2
      t253 = t252**2
      t256 = 1/t253/t36*t245
      t260 = 1/t39*t245
      t263 = 1/t33*t245
      t268 = t35/t249*(-0.99709173929518D0*t256-0.7418564737168958D0
     #*t246-0.4002143174996817D0*t260-0.1264669550498372D0*t263)/t46
      t269 = 0.1D1*t268
      t273 = 0.87407428755417D-3*t246*t60*t72*t80
      t274 = t56**2
      t287 = 0.1125D1*t51/t274*(-0.135956911724794D1*t256
     #-0.7491972878592054D0*t246-0.2150486235638321D0*t260
     #-0.1274341730084892D0*t263)/t59*t72*t80
      t294 = -0.1333333333333333D1*t66*t63*t245+0.1333333333333333D1
     #*t70*t63*t245
      t297 = 0.37995525D-1*t61*t294*t80
      t299 = t76*rho
      t300 = 1/t299
      t303 = 0.1519821D0*t61*t72*t74*t300
      t306 = t90**2
      t323 = 0.1923661050931536D1*(0.1321039893133927D-2*t246*t94
     #+0.1D1*t85/t306*(-0.1853395810515781D1*t256-0.128158207914907D1
     #*t246-0.8223668877838045D0*t260-0.1603914194192128D0*t263)/t93
     #-0.2747773264188438D-2*t247-0.1D1*t268)*t72*t78
      t326 = 0.1923661050931536D1*t97*t294*t78
      t329 = 0.7694644203726145D1*t98*t74*t300
      t336 = -0.3333333333333333D0*t178*t63*t245+0.3333333333333333D0
     #*t181*t63*t245
      t344 = 1/t110/t75/rho
      t354 = -0.3216396844291482D2*(t248+t269-t273-t287+t297+t303+t323
     #+t326-t329)*t114+0.9649190532874446D2*t198*t336
      t358 = 0.1362107888567592D0*t194*t112*t354*t117
      t361 = 0.2724215777135184D0*t120*t206*t336
      t364 = 0.3178251739991049D0*t120*t108*t344
      t390 = t248+t269-t273-t287+t297+t303+t323+t326-t329
     #+0.9327207260896469D-1*t177*t336+0.310906908696549D-1*t107*(
     #-0.2724215777135184D0*t188*t189*t336-0.3178251739991049D0*t109
     #*t344*t124*t139+0.1362107888567592D0*t109*t112*(-t358-t361-t364)
     #*t139-0.1362107888567592D0*t215*t218*(-t358-t361-t364
     #-0.3710675800196129D-1*t222*t134*t354*t117-0.7421351600392257D-1
     #*t129*t229*t336-0.8658243533790967D-1*t129*t131/t132/t299))*t239
      t391 = rho*t390
      vrhoa(i) = -0.12407009817988D1*t4*t15+0.8963286558970112D-2/t4
     #/t6*t154*sigmaaa+rho*(t165-t170+t173+t176+0.9327207260896469D-1
     #*t177*t184+0.310906908696549D-1*t107*(-0.2724215777135184D0*t188
     #*t189*t184+0.1362107888567592D0*t109*t112*(-t205-t209)*t139
     #-0.1362107888567592D0*t215*t218*(-t205-t209
     #-0.3710675800196129D-1*t222*t134*t201*t117-0.7421351600392257D-1
     #*t129*t229*t184))*t239)-t49+t83+t100+t146+t391
      t396 = t26**2
      t397 = 1/t396
      t401 = -t162
      t404 = 0.37995525D-1*t61*t401*t80
      t405 = 0.1519821D0*t169
      t408 = 0.1923661050931536D1*t97*t401*t78
      t409 = 0.7694644203726145D1*t175
      t410 = -t184
      t421 = -0.3216396844291482D2*(t404+t405+t408-t409)*t114
     #+0.9649190532874446D2*t198*t410
      t425 = 0.1362107888567592D0*t194*t112*t421*t117
      t428 = 0.2724215777135184D0*t120*t206*t410
      vrhob(i) = -0.12407009817988D1*t18*t29+0.8963286558970112D-2/t18
     #/t20*t397*sigmabb+rho*(t404+t405+t408-t409+0.9327207260896469D-1
     #*t177*t410+0.310906908696549D-1*t107*(-0.2724215777135184D0*t188
     #*t189*t410+0.1362107888567592D0*t109*t112*(-t425-t428)*t139
     #-0.1362107888567592D0*t215*t218*(-t425-t428
     #-0.3710675800196129D-1*t222*t134*t421*t117-0.7421351600392257D-1
     #*t129*t229*t410))*t239)-t49+t83+t100+t146+t391
      t473 = rho*t107*(0.1362107888567592D0*t121*t189
     #+0.1855337900098064D-1*sigma*t131*t134*t119*t139
     #-0.1362107888567592D0*t215*t218*(0.1362107888567592D0*t119*t108
     #*t112+0.3710675800196129D-1*t193*t135))*t239
      t474 = 0.310906908696549D-1*t473
      vsigmaaa(i) = -0.3361232459613792D-2/t5*t154+t474
      vsigmaab(i) = 0.6218138173930979D-1*t473
      vsigmabb(i) = -0.3361232459613792D-2/t19*t397+t474
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t3 = t2*rhob
      t4 = rhob**2
      t5 = t2**2
      t10 = 1.D0+0.2901354581245741D-2*sigmabb/t5/t4
      t13 = 0.2245D1-0.1245D1/t10
      t16 = 1/rhob
      t17 = t16**(1.D0/3.D0)
      t19 = 1.D0+0.1274696188700087D0*t17
      t20 = t16**(1.D0/6.D0)
      t23 = dsqrt(t16)
      t25 = t17**2
      t27 = 0.1112037486309468D2*t20+0.3844746237447211D1*t17
     #+0.1644733775567609D1*t23+0.2405871291288192D0*t25
      t30 = 1.D0+0.3216395899738507D2/t27
      t31 = dlog(t30)
      t32 = t19*t31
      t33 = 0.310907D-1*t32
      t35 = 1/t2/t4
      t36 = sigmabb*t35
      t38 = dexp(0.2000000587336264D1*t32)
      t39 = t38-1.D0
      t40 = 1/t39
      t41 = t40*sigmabb
      t43 = 0.2162211495206379D0*t41*t35
      t44 = 1.D0+t43
      t45 = t39**2
      t46 = 1/t45
      t47 = sigmabb**2
      t48 = t46*t47
      t49 = t4**2
      t51 = 1/t5/t49
      t52 = t48*t51
      t54 = 1.D0+t43+0.4675158550002605D-1*t52
      t55 = 1/t54
      t56 = t44*t55
      t59 = 1.D0+0.2162211495206379D0*t36*t56
      t60 = dlog(t59)
      t61 = 0.1554534543482745D-1*t60
      zk(i) = -0.9305257363491D0*t3*t13+rhob*(-t33+t61)
      vrhoa(i) = 0.D0
      t66 = t10**2
      t67 = 1/t66
      t71 = t4*rhob
      t73 = 1/t2/t71
      t74 = sigmabb*t73
      t79 = 1/t5/t49/rhob
      t80 = t47*t79
      t81 = t40*t55
      t84 = t54**2
      t85 = 1/t84
      t86 = t44*t85
      t89 = t48*t79
      t91 = -0.5045160155481551D0*t41*t73-0.2181740656667882D0*t89
      t92 = t86*t91
      t95 = -0.5045160155481551D0*t74*t56-0.1090870328333941D0*t80*t81
     #-0.2162211495206379D0*t36*t92
      t96 = rhob*t95
      t97 = 1/t59
      t100 = 1/t25
      t101 = 1/t4
      t102 = t100*t101
      t103 = t102*t31
      t105 = t27**2
      t106 = 1/t105
      t107 = t19*t106
      t108 = t20**2
      t109 = t108**2
      t110 = t109*t20
      t111 = 1/t110
      t115 = 1/t23
      t118 = 1/t17
      t121 = -0.1853395810515781D1*t111*t101-0.128158207914907D1*t102
     #-0.8223668877838045D0*t115*t101-0.1603914194192128D0*t118*t101
      t122 = 1/t30
      t124 = t107*t121*t122
      t128 = -0.8497977086918237D-1*t103-0.6432793688582964D2*t124
      t129 = t128*t38
      t130 = t129*t55
      t133 = t46*sigmabb
      t139 = 1/t45/t39
      t140 = t139*t47
      t145 = -0.2162211495206379D0*t133*t35*t128*t38
     #-0.935031710000521D-1*t140*t51*t128*t38
      t146 = t86*t145
      t149 = -0.4675158550002605D-1*t52*t130-0.2162211495206379D0*t36
     #*t146
      t150 = t149*t97
      vrhob(i) = -0.12407009817988D1*t2*t13+0.8963286558970112D-2*t35
     #*t67*sigmabb-t33+t61+0.1554534543482745D-1*t96*t97+rhob*
     #(0.1321039893133927D-2*t103+0.1D1*t124+0.1554534543482745D-1*t150)
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      t157 = t35*t44
      t160 = sigmabb*t51
      t167 = 0.2162211495206379D0*t40*t35+0.935031710000521D-1*t133*t51
      t171 = 0.2162211495206379D0*t157*t55+0.4675158550002605D-1*t160
     #*t81-0.2162211495206379D0*t36*t86*t167
      vsigmabb(i) = -0.3361232459613792D-2/t3*t67
     #+0.1554534543482745D-1*rhob*t171*t97
      v2rhoa2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t181 = t49*t4
      t184 = 1/t66/t10
      t191 = 1/t2/t49
      t196 = 1/t5/t181
      t202 = t40*t85
      t207 = 1/t84/t54
      t208 = t44*t207
      t209 = t91**2
      t225 = t95**2
      t227 = t59**2
      t228 = 1/t227
      t234 = t89*t130
      t239 = 0.4675158550002605D-1*t52*t129*t85*t91
      t241 = 0.5045160155481551D0*t74*t146
      t244 = 0.1090870328333941D0*t80*t202*t145
      t249 = 0.4324422990412758D0*t36*t44*t207*t145*t91
      t261 = 0.2162211495206379D0*t36*t86*(0.5045160155481551D0*t133
     #*t73*t128*t38+0.4363481313335765D0*t140*t79*t128*t38)
      t265 = t149*t228
      t279 = 1/t49
      t280 = 1/t25/t16*t279
      t281 = t280*t31
      t283 = 1/t71
      t284 = t100*t283
      t285 = t284*t31
      t289 = t102*t106*t121*t122
      t294 = t121**2
      t296 = t19/t105/t27*t294*t122
      t320 = t107*(-0.1544496508763151D1/t110/t16*t279
     #+0.3706791621031562D1*t111*t283-0.854388052766047D0*t280
     #+0.2563164158298141D1*t284-0.4111834438919023D0/t23/t16*t279
     #+0.1644733775567609D1*t115*t283-0.5346380647307093D-1/t17/t16
     #*t279+0.3207828388384256D0*t118*t283)*t122
      t322 = t105**2
      t325 = t30**2
      t328 = t19/t322*t294/t325
      t332 = t128**2
      t334 = dexp(0.4000001174672527D1*t32)
      t345 = -0.5665318057945491D-1*t281+0.1699595417383647D0*t285
     #+0.546657173168712D1*t289+0.1286558737716593D3*t296
     #-0.6432793688582964D2*t320-0.2069041124382199D4*t328
      t358 = t145**2
      t363 = t35*t332
      t374 = t45**2
      t377 = t51*t332
      t395 = t149**2
      s1 = -0.4135669939329333D0/t5*t13-0.8963286558970112D-2*t73*t67
     #*sigmabb+0.1386969201113936D-3/t181*t184*t47
     #+0.310906908696549D-1*t95*t97+0.1554534543482745D-1*rhob*
     #(0.1681720051827184D1*sigmabb*t191*t56+0.8726962626671529D0*t47
     #*t196*t81+0.100903203109631D1*t74*t92+0.2181740656667882D0*t80
     #*t202*t91+0.4324422990412758D0*t36*t208*t209
     #-0.2162211495206379D0*t36*t86*(0.1681720051827184D1*t41*t191
     #+0.1236319705445133D1*t48*t196))*t97-0.1554534543482745D-1*rhob
     #*t225*t228
      s2 = s1+0.2642079786267853D-2*t103+0.2D1*t124
     #+0.310906908696549D-1*t150
      s3 = s2+rhob*(0.1554534543482745D-1*(0.2181740656667882D0*t234
     #+t239+t241+t244+t249-t261)*t97-0.1554534543482745D-1*t265*t95)
      s4 = s3+0.1554534543482745D-1*rhob*(0.2181740656667882D0*t234
     #+t241+t244+t239+t249-t261)*t97
      v2rhob2(i) = s4-0.1554534543482745D-1*t96*t265+rhob*
     #(0.8806932620892844D-3*t281-0.2642079786267853D-2*t285
     #-0.8497974591333914D-1*t289-0.2D1*t296+0.1D1*t320
     #+0.3216395899738507D2*t328+0.1554534543482745D-1*
     #(0.935031710000521D-1*t47*t51*t139*t332*t334*t55
     #-0.4675158550002605D-1*t52*t345*t38*t55-0.4675158550002605D-1
     #*t52*t332*t38*t55+0.935031710000521D-1*t52*t129*t85*t145
     #+0.4324422990412758D0*t36*t208*t358-0.2162211495206379D0*t36*t86
     #*(0.4324422990412758D0*t139*sigmabb*t363*t334
     #-0.2162211495206379D0*t133*t35*t345*t38-0.2162211495206379D0
     #*t133*t363*t38+0.2805095130001563D0/t374*t47*t377*t334
     #-0.935031710000521D-1*t140*t51*t345*t38-0.935031710000521D-1
     #*t140*t377*t38))*t97-0.1554534543482745D-1*t395*t228)
      v2sigmaaa2(i) = 0.D0
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      t411 = t167**2
      t425 = t171**2
      v2sigmabb2(i) = 0.1950425439066473D-4*t279*t184
     #+0.1554534543482745D-1*rhob*(0.935031710000521D-1*t51*t40*t55
     #-0.4324422990412758D0*t157*t85*t167-0.935031710000521D-1*t160
     #*t202*t167+0.4324422990412758D0*t36*t208*t411
     #-0.2021736311745604D-1*sigmabb/t49/t71*t86*t46)*t97
     #-0.1554534543482745D-1*rhob*t425*t228
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t3 = t2*rhoa
      t4 = rhoa**2
      t5 = t2**2
      t10 = 1.D0+0.2901354581245741D-2*sigmaaa/t5/t4
      t13 = 0.2245D1-0.1245D1/t10
      t16 = 1/rhoa
      t17 = t16**(1.D0/3.D0)
      t19 = 1.D0+0.1274696188700087D0*t17
      t20 = t16**(1.D0/6.D0)
      t23 = dsqrt(t16)
      t25 = t17**2
      t27 = 0.1112037486309468D2*t20+0.3844746237447211D1*t17
     #+0.1644733775567609D1*t23+0.2405871291288192D0*t25
      t30 = 1.D0+0.3216395899738507D2/t27
      t31 = dlog(t30)
      t32 = t19*t31
      t33 = 0.310907D-1*t32
      t35 = 1/t2/t4
      t36 = sigmaaa*t35
      t38 = dexp(0.2000000587336264D1*t32)
      t39 = t38-1.D0
      t40 = 1/t39
      t41 = t40*sigmaaa
      t43 = 0.2162211495206379D0*t41*t35
      t44 = 1.D0+t43
      t45 = t39**2
      t46 = 1/t45
      t47 = sigmaaa**2
      t48 = t46*t47
      t49 = t4**2
      t51 = 1/t5/t49
      t52 = t48*t51
      t54 = 1.D0+t43+0.4675158550002605D-1*t52
      t55 = 1/t54
      t56 = t44*t55
      t59 = 1.D0+0.2162211495206379D0*t36*t56
      t60 = dlog(t59)
      t61 = 0.1554534543482745D-1*t60
      zk(i) = -0.9305257363491D0*t3*t13+rhoa*(-t33+t61)
      t66 = t10**2
      t67 = 1/t66
      t71 = t4*rhoa
      t73 = 1/t2/t71
      t74 = sigmaaa*t73
      t79 = 1/t5/t49/rhoa
      t80 = t47*t79
      t81 = t40*t55
      t84 = t54**2
      t85 = 1/t84
      t86 = t44*t85
      t89 = t48*t79
      t91 = -0.5045160155481551D0*t41*t73-0.2181740656667882D0*t89
      t92 = t86*t91
      t95 = -0.5045160155481551D0*t74*t56-0.1090870328333941D0*t80*t81
     #-0.2162211495206379D0*t36*t92
      t96 = rhoa*t95
      t97 = 1/t59
      t100 = 1/t25
      t101 = 1/t4
      t102 = t100*t101
      t103 = t102*t31
      t105 = t27**2
      t106 = 1/t105
      t107 = t19*t106
      t108 = t20**2
      t109 = t108**2
      t110 = t109*t20
      t111 = 1/t110
      t115 = 1/t23
      t118 = 1/t17
      t121 = -0.1853395810515781D1*t111*t101-0.128158207914907D1*t102
     #-0.8223668877838045D0*t115*t101-0.1603914194192128D0*t118*t101
      t122 = 1/t30
      t124 = t107*t121*t122
      t128 = -0.8497977086918237D-1*t103-0.6432793688582964D2*t124
      t129 = t128*t38
      t130 = t129*t55
      t133 = t46*sigmaaa
      t139 = 1/t45/t39
      t140 = t139*t47
      t145 = -0.2162211495206379D0*t133*t35*t128*t38
     #-0.935031710000521D-1*t140*t51*t128*t38
      t146 = t86*t145
      t149 = -0.4675158550002605D-1*t52*t130-0.2162211495206379D0*t36
     #*t146
      t150 = t149*t97
      vrhoa(i) = -0.12407009817988D1*t2*t13+0.8963286558970112D-2*t35
     #*t67*sigmaaa-t33+t61+0.1554534543482745D-1*t96*t97+rhoa*
     #(0.1321039893133927D-2*t103+0.1D1*t124+0.1554534543482745D-1*t150)
      vrhob(i) = 0.D0
      t157 = t35*t44
      t160 = sigmaaa*t51
      t167 = 0.2162211495206379D0*t40*t35+0.935031710000521D-1*t133*t51
      t171 = 0.2162211495206379D0*t157*t55+0.4675158550002605D-1*t160
     #*t81-0.2162211495206379D0*t36*t86*t167
      vsigmaaa(i) = -0.3361232459613792D-2/t3*t67
     #+0.1554534543482745D-1*rhoa*t171*t97
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      t181 = t49*t4
      t184 = 1/t66/t10
      t191 = 1/t2/t49
      t196 = 1/t5/t181
      t202 = t40*t85
      t207 = 1/t84/t54
      t208 = t44*t207
      t209 = t91**2
      t225 = t95**2
      t227 = t59**2
      t228 = 1/t227
      t234 = t89*t130
      t239 = 0.4675158550002605D-1*t52*t129*t85*t91
      t241 = 0.5045160155481551D0*t74*t146
      t244 = 0.1090870328333941D0*t80*t202*t145
      t249 = 0.4324422990412758D0*t36*t44*t207*t145*t91
      t261 = 0.2162211495206379D0*t36*t86*(0.5045160155481551D0*t133
     #*t73*t128*t38+0.4363481313335765D0*t140*t79*t128*t38)
      t265 = t149*t228
      t279 = 1/t49
      t280 = 1/t25/t16*t279
      t281 = t280*t31
      t283 = 1/t71
      t284 = t100*t283
      t285 = t284*t31
      t289 = t102*t106*t121*t122
      t294 = t121**2
      t296 = t19/t105/t27*t294*t122
      t320 = t107*(-0.1544496508763151D1/t110/t16*t279
     #+0.3706791621031562D1*t111*t283-0.854388052766047D0*t280
     #+0.2563164158298141D1*t284-0.4111834438919023D0/t23/t16*t279
     #+0.1644733775567609D1*t115*t283-0.5346380647307093D-1/t17/t16
     #*t279+0.3207828388384256D0*t118*t283)*t122
      t322 = t105**2
      t325 = t30**2
      t328 = t19/t322*t294/t325
      t332 = t128**2
      t334 = dexp(0.4000001174672527D1*t32)
      t345 = -0.5665318057945491D-1*t281+0.1699595417383647D0*t285
     #+0.546657173168712D1*t289+0.1286558737716593D3*t296
     #-0.6432793688582964D2*t320-0.2069041124382199D4*t328
      t358 = t145**2
      t363 = t35*t332
      t374 = t45**2
      t377 = t51*t332
      t395 = t149**2
      s1 = -0.4135669939329333D0/t5*t13-0.8963286558970112D-2*t73*t67
     #*sigmaaa+0.1386969201113936D-3/t181*t184*t47
     #+0.310906908696549D-1*t95*t97+0.1554534543482745D-1*rhoa*
     #(0.1681720051827184D1*sigmaaa*t191*t56+0.8726962626671529D0*t47
     #*t196*t81+0.100903203109631D1*t74*t92+0.2181740656667882D0*t80
     #*t202*t91+0.4324422990412758D0*t36*t208*t209
     #-0.2162211495206379D0*t36*t86*(0.1681720051827184D1*t41*t191
     #+0.1236319705445133D1*t48*t196))*t97-0.1554534543482745D-1*rhoa
     #*t225*t228
      s2 = s1+0.2642079786267853D-2*t103+0.2D1*t124
     #+0.310906908696549D-1*t150
      s3 = s2+rhoa*(0.1554534543482745D-1*(0.2181740656667882D0*t234
     #+t239+t241+t244+t249-t261)*t97-0.1554534543482745D-1*t265*t95)
      s4 = s3+0.1554534543482745D-1*rhoa*(0.2181740656667882D0*t234
     #+t241+t244+t239+t249-t261)*t97
      v2rhoa2(i) = s4-0.1554534543482745D-1*t96*t265+rhoa*
     #(0.8806932620892844D-3*t281-0.2642079786267853D-2*t285
     #-0.8497974591333914D-1*t289-0.2D1*t296+0.1D1*t320
     #+0.3216395899738507D2*t328+0.1554534543482745D-1*
     #(0.935031710000521D-1*t47*t51*t139*t332*t334*t55
     #-0.4675158550002605D-1*t52*t345*t38*t55-0.4675158550002605D-1
     #*t52*t332*t38*t55+0.935031710000521D-1*t52*t129*t85*t145
     #+0.4324422990412758D0*t36*t208*t358-0.2162211495206379D0*t36*t86
     #*(0.4324422990412758D0*t139*sigmaaa*t363*t334
     #-0.2162211495206379D0*t133*t35*t345*t38-0.2162211495206379D0
     #*t133*t363*t38+0.2805095130001563D0/t374*t47*t377*t334
     #-0.935031710000521D-1*t140*t51*t345*t38-0.935031710000521D-1
     #*t140*t377*t38))*t97-0.1554534543482745D-1*t395*t228)
      v2rhob2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t411 = t167**2
      t425 = t171**2
      v2sigmaaa2(i) = 0.1950425439066473D-4*t279*t184
     #+0.1554534543482745D-1*rhoa*(0.935031710000521D-1*t51*t40*t55
     #-0.4324422990412758D0*t157*t85*t167-0.935031710000521D-1*t160
     #*t202*t167+0.4324422990412758D0*t36*t208*t411
     #-0.2021736311745604D-1*sigmaaa/t49/t71*t86*t46)*t97
     #-0.1554534543482745D-1*rhoa*t425*t228
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      v2sigmabb2(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t5 = t4*rhoa
      t6 = rhoa**2
      t7 = t4**2
      t12 = 1.D0+0.2901354581245741D-2*sigmaaa/t7/t6
      t15 = 0.2245D1-0.1245D1/t12
      t18 = rhob**(1.D0/3.D0)
      t19 = t18*rhob
      t20 = rhob**2
      t21 = t18**2
      t26 = 1.D0+0.2901354581245741D-2*sigmabb/t21/t20
      t29 = 0.2245D1-0.1245D1/t26
      t32 = 1/rho
      t33 = t32**(1.D0/3.D0)
      t35 = 1.D0+0.1325688999052018D0*t33
      t36 = t32**(1.D0/6.D0)
      t39 = dsqrt(t32)
      t41 = t33**2
      t43 = 0.598255043577108D1*t36+0.2225569421150687D1*t33
     #+0.8004286349993634D0*t39+0.1897004325747559D0*t41
      t46 = 1.D0+0.1608197949869254D2/t43
      t47 = dlog(t46)
      t49 = 0.621814D-1*t35*t47
      t51 = 1.D0+0.6901399211255825D-1*t33
      t56 = 0.8157414703487641D1*t36+0.2247591863577616D1*t33
     #+0.4300972471276643D0*t39+0.1911512595127338D0*t41
      t59 = 1.D0+0.2960874997779344D2/t56
      t60 = dlog(t59)
      t61 = t51*t60
      t63 = rhoa-1.D0*rhob
      t64 = t63*t32
      t65 = 1.D0+t64
      t66 = t65**(1.D0/3.D0)
      t67 = t66*t65
      t69 = 1.D0-1.D0*t64
      t70 = t69**(1.D0/3.D0)
      t71 = t70*t69
      t72 = t67+t71-2.D0
      t73 = t63**2
      t74 = t73**2
      t75 = rho**2
      t76 = t75**2
      t77 = 1/t76
      t78 = t74*t77
      t80 = 1.D0-1.D0*t78
      t81 = t72*t80
      t83 = 0.37995525D-1*t61*t81
      t85 = 1.D0+0.1274696188700087D0*t33
      t90 = 0.1112037486309468D2*t36+0.3844746237447211D1*t33
     #+0.1644733775567609D1*t39+0.2405871291288192D0*t41
      t93 = 1.D0+0.3216395899738507D2/t90
      t94 = dlog(t93)
      t97 = -0.310907D-1*t85*t94+t49
      t98 = t97*t72
      t100 = 0.1923661050931536D1*t98*t78
      t101 = t66**2
      t103 = t70**2
      t105 = 0.5D0*t101+0.5D0*t103
      t106 = t105**2
      t107 = t106*t105
      t108 = 1/t106
      t109 = sigma*t108
      t110 = rho**(1.D0/3.D0)
      t112 = 1/t110/t75
      t113 = -t49+t83+t100
      t114 = 1/t107
      t115 = t113*t114
      t117 = dexp(-0.3216396844291482D2*t115)
      t118 = t117-1.D0
      t119 = 1/t118
      t120 = t119*sigma
      t121 = t108*t112
      t123 = 0.1362107888567592D0*t120*t121
      t124 = 1.D0+t123
      t126 = t118**2
      t127 = 1/t126
      t128 = sigma**2
      t129 = t127*t128
      t130 = t106**2
      t131 = 1/t130
      t132 = t110**2
      t134 = 1/t132/t76
      t135 = t131*t134
      t138 = 1.D0+t123+0.1855337900098064D-1*t129*t135
      t139 = 1/t138
      t143 = 1.D0+0.1362107888567592D0*t109*t112*t124*t139
      t144 = dlog(t143)
      t146 = 0.310906908696549D-1*t107*t144
      zk(i) = -0.9305257363491D0*t5*t15-0.9305257363491D0*t19*t29+rho*
     #(-t49+t83+t100+t146)
      t153 = t12**2
      t154 = 1/t153
      t155 = 1/t4/t6*t154
      t162 = 0.1333333333333333D1*t66*t32-0.1333333333333333D1*t70*t32
      t164 = t61*t162*t80
      t165 = 0.37995525D-1*t164
      t166 = t73*t63
      t167 = t72*t166
      t169 = t61*t167*t77
      t170 = 0.1519821D0*t169
      t171 = t97*t162
      t172 = t171*t78
      t173 = 0.1923661050931536D1*t172
      t174 = t166*t77
      t175 = t98*t174
      t176 = 0.7694644203726145D1*t175
      t177 = t106*t144
      t178 = 1/t66
      t181 = 1/t70
      t184 = 0.3333333333333333D0*t178*t32-0.3333333333333333D0*t181*t32
      t185 = t177*t184
      t186 = 0.9327207260896469D-1*t185
      t187 = sigma*t114
      t188 = t187*t112
      t189 = t124*t139
      t190 = t189*t184
      t193 = t127*sigma
      t194 = t193*t108
      t195 = t165-t170+t173+t176
      t198 = t113*t131
      t201 = -0.3216396844291482D2*t195*t114+0.9649190532874446D2*t198
     #*t184
      t202 = t112*t201
      t203 = t202*t117
      t205 = 0.1362107888567592D0*t194*t203
      t206 = t114*t112
      t209 = 0.2724215777135184D0*t120*t206*t184
      t210 = -t205-t209
      t215 = t109*t112
      t216 = t138**2
      t217 = 1/t216
      t218 = t124*t217
      t220 = 1/t126/t118
      t221 = t220*t128
      t222 = t221*t131
      t223 = t134*t201
      t224 = t223*t117
      t228 = 1/t130/t105
      t229 = t228*t134
      t230 = t229*t184
      t233 = -t205-t209-0.3710675800196129D-1*t222*t224
     #-0.7421351600392257D-1*t129*t230
      t234 = t218*t233
      t237 = -0.2724215777135184D0*t188*t190+0.1362107888567592D0*t109
     #*t112*t210*t139-0.1362107888567592D0*t215*t234
      t238 = t107*t237
      t239 = 1/t143
      t240 = t238*t239
      t241 = 0.310906908696549D-1*t240
      t244 = 1/t41
      t245 = 1/t75
      t246 = t244*t245
      t247 = t246*t47
      t248 = 0.2747773264188438D-2*t247
      t249 = t43**2
      t250 = 1/t249
      t251 = t35*t250
      t252 = t36**2
      t253 = t252**2
      t254 = t253*t36
      t255 = 1/t254
      t256 = t255*t245
      t259 = 1/t39
      t260 = t259*t245
      t262 = 1/t33
      t263 = t262*t245
      t265 = -0.99709173929518D0*t256-0.7418564737168958D0*t246
     #-0.4002143174996817D0*t260-0.1264669550498372D0*t263
      t266 = 1/t46
      t268 = t251*t265*t266
      t269 = 0.1D1*t268
      t270 = t60*t72
      t271 = t270*t80
      t272 = t246*t271
      t273 = 0.87407428755417D-3*t272
      t274 = t56**2
      t275 = 1/t274
      t276 = t51*t275
      t281 = -0.135956911724794D1*t256-0.7491972878592054D0*t246
     #-0.2150486235638321D0*t260-0.1274341730084892D0*t263
      t282 = t276*t281
      t283 = 1/t59
      t284 = t283*t72
      t285 = t284*t80
      t286 = t282*t285
      t287 = 0.1125D1*t286
      t288 = t66*t63
      t291 = t70*t63
      t294 = -0.1333333333333333D1*t288*t245+0.1333333333333333D1*t291
     #*t245
      t296 = t61*t294*t80
      t297 = 0.37995525D-1*t296
      t298 = t72*t74
      t299 = t76*rho
      t300 = 1/t299
      t302 = t61*t298*t300
      t303 = 0.1519821D0*t302
      t306 = t90**2
      t307 = 1/t306
      t308 = t85*t307
      t313 = -0.1853395810515781D1*t256-0.128158207914907D1*t246
     #-0.8223668877838045D0*t260-0.1603914194192128D0*t263
      t314 = 1/t93
      t320 = 0.1321039893133927D-2*t246*t94+0.1D1*t308*t313*t314
     #-0.2747773264188438D-2*t247-0.1D1*t268
      t321 = t320*t72
      t322 = t321*t78
      t323 = 0.1923661050931536D1*t322
      t324 = t97*t294
      t325 = t324*t78
      t326 = 0.1923661050931536D1*t325
      t327 = t74*t300
      t328 = t98*t327
      t329 = 0.7694644203726145D1*t328
      t330 = t178*t63
      t333 = t181*t63
      t336 = -0.3333333333333333D0*t330*t245+0.3333333333333333D0*t333
     #*t245
      t337 = t177*t336
      t339 = t189*t336
      t342 = t75*rho
      t344 = 1/t110/t342
      t349 = t248+t269-t273-t287+t297+t303+t323+t326-t329
      t354 = -0.3216396844291482D2*t349*t114+0.9649190532874446D2*t198
     #*t336
      t355 = t112*t354
      t356 = t355*t117
      t358 = 0.1362107888567592D0*t194*t356
      t361 = 0.2724215777135184D0*t120*t206*t336
      t362 = t108*t344
      t364 = 0.3178251739991049D0*t120*t362
      t365 = -t358-t361-t364
      t370 = t134*t354
      t371 = t370*t117
      t374 = t229*t336
      t378 = 1/t132/t299
      t379 = t131*t378
      t382 = -t358-t361-t364-0.3710675800196129D-1*t222*t371
     #-0.7421351600392257D-1*t129*t374-0.8658243533790967D-1*t129*t379
      t383 = t218*t382
      t386 = -0.2724215777135184D0*t188*t339-0.3178251739991049D0*t109
     #*t344*t124*t139+0.1362107888567592D0*t109*t112*t365*t139
     #-0.1362107888567592D0*t215*t383
      t387 = t107*t386
      t388 = t387*t239
      t390 = t248+t269-t273-t287+t297+t303+t323+t326-t329
     #+0.9327207260896469D-1*t337+0.310906908696549D-1*t388
      t391 = rho*t390
      vrhoa(i) = -0.12407009817988D1*t4*t15+0.8963286558970112D-2*t155
     #*sigmaaa+rho*(t165-t170+t173+t176+t186+t241)-t49+t83+t100+t146
     #+t391
      t396 = t26**2
      t397 = 1/t396
      t398 = 1/t18/t20*t397
      t401 = -t162
      t403 = t61*t401*t80
      t404 = 0.37995525D-1*t403
      t405 = 0.1519821D0*t169
      t406 = t97*t401
      t407 = t406*t78
      t408 = 0.1923661050931536D1*t407
      t409 = 0.7694644203726145D1*t175
      t410 = -t184
      t411 = t177*t410
      t412 = 0.9327207260896469D-1*t411
      t413 = t189*t410
      t416 = t404+t405+t408-t409
      t421 = -0.3216396844291482D2*t416*t114+0.9649190532874446D2*t198
     #*t410
      t422 = t112*t421
      t423 = t422*t117
      t425 = 0.1362107888567592D0*t194*t423
      t428 = 0.2724215777135184D0*t120*t206*t410
      t429 = -t425-t428
      t434 = t134*t421
      t435 = t434*t117
      t438 = t229*t410
      t441 = -t425-t428-0.3710675800196129D-1*t222*t435
     #-0.7421351600392257D-1*t129*t438
      t442 = t218*t441
      t445 = -0.2724215777135184D0*t188*t413+0.1362107888567592D0*t109
     #*t112*t429*t139-0.1362107888567592D0*t215*t442
      t446 = t107*t445
      t447 = t446*t239
      t448 = 0.310906908696549D-1*t447
      vrhob(i) = -0.12407009817988D1*t18*t29+0.8963286558970112D-2
     #*t398*sigmabb+rho*(t404+t405+t408-t409+t412+t448)-t49+t83+t100
     #+t146+t391
      t454 = rho*t107
      t457 = sigma*t131
      t462 = t119*t108
      t467 = 0.1362107888567592D0*t462*t112+0.3710675800196129D-1*t193
     #*t135
      t468 = t218*t467
      t471 = 0.1362107888567592D0*t121*t189+0.1855337900098064D-1*t457
     #*t134*t119*t139-0.1362107888567592D0*t215*t468
      t473 = t454*t471*t239
      t474 = 0.310906908696549D-1*t473
      vsigmaaa(i) = -0.3361232459613792D-2/t5*t154+t474
      vsigmaab(i) = 0.6218138173930979D-1*t473
      vsigmabb(i) = -0.3361232459613792D-2/t19*t397+t474
      t478 = 0.5495546528376876D-2*t247
      t481 = 0.7599105D-1*t296
      t482 = 0.3847322101863073D1*t322
      t484 = 0.225D1*t286
      t485 = 0.1865441452179294D0*t337
      t486 = 0.6218138173930979D-1*t388
      t487 = 0.174814857510834D-2*t272
      t488 = 0.2D1*t268
      t489 = 0.3039642D0*t302
      t490 = t478+0.7599105D-1*t164+0.3847322101863073D1*t172+t481
     #+t482-0.3039642D0*t169-t484+t485+t486-t487+t488+t489
      t491 = 0.3847322101863073D1*t325
      t492 = 0.1538928840745229D2*t328
      t499 = 0.87407428755417D-3*t246*t60*t162*t80
      t500 = t76*t75
      t501 = 1/t500
      t504 = t244*t501*t270*t166
      t505 = 0.349629715021668D-2*t504
      t509 = 0.1125D1*t282*t283*t162*t80
      t511 = t282*t284*t174
      t512 = 0.45D1*t511
      t513 = 1/t101
      t515 = 1/t342
      t520 = 1/t103
      t526 = -0.4444444444444444D0*t513*t63*t515-0.1333333333333333D1
     #*t66*t245-0.4444444444444444D0*t520*t63*t515
     #+0.1333333333333333D1*t70*t245
      t529 = 0.37995525D-1*t61*t526*t80
      t532 = t61*t294*t166*t77
      t533 = 0.1519821D0*t532
      t537 = 0.1519821D0*t61*t162*t74*t300
      t539 = t61*t167*t300
      t540 = 0.6079284D0*t539
      t543 = 0.1923661050931536D1*t320*t162*t78
      t544 = t321*t174
      t545 = 0.7694644203726145D1*t544
      t548 = 0.1923661050931536D1*t97*t526*t78
      t549 = t324*t174
      t550 = 0.7694644203726145D1*t549
      t552 = 0.7694644203726145D1*t171*t327
      t554 = t98*t166*t300
      t555 = 0.3077857681490458D2*t554
      t556 = t105*t144
      t557 = t336*t184
      t559 = 0.1865441452179294D0*t556*t557
      t560 = t106*t237
      t561 = t239*t336
      t563 = 0.9327207260896469D-1*t560*t561
      t564 = 1/t67
      t570 = 1/t71
      t576 = 0.1111111111111111D0*t564*t63*t515-0.3333333333333333D0
     #*t178*t245+0.1111111111111111D0*t570*t63*t515
     #+0.3333333333333333D0*t181*t245
      t578 = 0.9327207260896469D-1*t177*t576
      t579 = t106*t386
      t580 = t239*t184
      t582 = 0.9327207260896469D-1*t579*t580
      t583 = t457*t112
      t586 = 0.8172647331405553D0*t583*t189*t557
      t587 = t210*t139
      t590 = 0.2724215777135184D0*t188*t587*t336
      t594 = 0.2724215777135184D0*t188*t218*t336*t233
      t597 = 0.2724215777135184D0*t188*t189*t576
      t598 = t187*t344
      t600 = 0.6356503479982097D0*t598*t190
      t604 = 0.3178251739991049D0*t109*t344*t210*t139
      t605 = t109*t344
      t607 = 0.3178251739991049D0*t605*t234
      t608 = t365*t139
      t611 = 0.2724215777135184D0*t188*t608*t184
      t612 = t220*sigma
      t613 = t612*t108
      t615 = dexp(-0.6432793688582964D2*t115)
      t616 = t615*t201
      t619 = 0.2724215777135184D0*t613*t355*t616
      t620 = t193*t114
      t621 = t117*t184
      t624 = 0.2724215777135184D0*t620*t355*t621
      t625 = -t499+t505-t509+t512+t529-t533+t537+t540+t543+t545+t548
     #+t550-t552-t555
      t628 = t349*t131
      t630 = 0.9649190532874446D2*t628*t184
      t631 = t195*t131
      t633 = 0.9649190532874446D2*t631*t336
      t634 = t113*t228
      t636 = 0.3859676213149779D3*t634*t557
      t638 = 0.9649190532874446D2*t198*t576
      t639 = -0.3216396844291482D2*t625*t114+t630+t633-t636+t638
      t643 = 0.1362107888567592D0*t194*t112*t639*t117
      t644 = t201*t117
      t647 = 0.1362107888567592D0*t194*t355*t644
      t648 = t112*t336
      t651 = 0.2724215777135184D0*t620*t648*t644
      t652 = t120*t131
      t655 = 0.8172647331405553D0*t652*t648*t184
      t658 = 0.2724215777135184D0*t120*t206*t576
      t662 = 0.3178251739991049D0*t194*t344*t201*t117
      t663 = t114*t344
      t666 = 0.6356503479982097D0*t120*t663*t184
      t672 = t365*t217
      t675 = 0.1362107888567592D0*t215*t672*t233
      t679 = 0.2724215777135184D0*t188*t218*t382*t184
      t680 = t210*t217
      t683 = 0.1362107888567592D0*t215*t680*t382
      t686 = t124/t216/t138
      t690 = 0.2724215777135184D0*t215*t686*t382*t233
      t691 = t126**2
      t694 = 1/t691*t128*t131
      t697 = 0.1113202740058839D0*t694*t370*t616
      t698 = t221*t228
      t701 = 0.1484270320078451D0*t698*t370*t621
      t708 = 0.3710675800196129D-1*t222*t370*t644
      t709 = t134*t336
      t712 = 0.1484270320078451D0*t698*t709*t644
      t714 = 1/t130/t106
      t715 = t129*t714
      t718 = 0.3710675800196129D0*t715*t709*t184
      t721 = 0.7421351600392257D-1*t129*t229*t576
      t725 = 0.1731648706758193D0*t222*t378*t201*t117
      t726 = t228*t378
      t729 = 0.3463297413516387D0*t129*t726*t184
      t730 = t619+t624-t643-t647+t651+t655-t658+t662+t666+t697+t701
     #-0.3710675800196129D-1*t222*t134*t639*t117-t708+t712+t718-t721
     #+t725+t729
      t734 = t586-t590+t594-t597+t600-t604+t607-t611
     #+0.1362107888567592D0*t109*t112*(t619+t624-t643-t647+t651+t655
     #-t658+t662+t666)*t139-t675+t679-t683+t690-0.1362107888567592D0
     #*t215*t218*t730
      t738 = t143**2
      t739 = 1/t738
      t742 = 0.310906908696549D-1*t387*t739*t237
      t743 = -t499+t505-t509+t512+t529-t533+t537+t540+t543+t545+t548
     #+t550-t552-t555+t559+t563+t578+t582+0.310906908696549D-1*t107
     #*t734*t239-t742
      t744 = rho*t743
      t758 = 0.4444444444444444D0*t513*t245+0.4444444444444444D0*t520
     #*t245
      t761 = 0.37995525D-1*t61*t758*t80
      t764 = t61*t162*t166*t77
      t765 = 0.3039642D0*t764
      t768 = t61*t72*t73*t77
      t769 = 0.4559463D0*t768
      t772 = 0.1923661050931536D1*t97*t758*t78
      t773 = t171*t174
      t774 = 0.1538928840745229D2*t773
      t776 = t98*t73*t77
      t777 = 0.2308393261117844D2*t776
      t778 = t184**2
      t787 = -0.1111111111111111D0*t564*t245-0.1111111111111111D0*t570
     #*t245
      t789 = 0.9327207260896469D-1*t177*t787
      t802 = 0.2724215777135184D0*t188*t189*t787
      t803 = t201**2
      t804 = t112*t803
      t807 = 0.2724215777135184D0*t613*t804*t615
      t810 = 0.5448431554270369D0*t620*t202*t621
      t819 = 0.9649190532874446D2*t198*t787
      t820 = -0.3216396844291482D2*(t761-t765-t769+t772+t774+t777)
     #*t114+0.1929838106574889D3*t631*t184-0.3859676213149779D3*t634
     #*t778+t819
      t824 = 0.1362107888567592D0*t194*t112*t820*t117
      t827 = 0.1362107888567592D0*t194*t804*t117
      t828 = t131*t112
      t831 = 0.8172647331405553D0*t120*t828*t778
      t834 = 0.2724215777135184D0*t120*t206*t787
      t843 = t233**2
      t847 = t134*t803
      t861 = t714*t134
      t867 = 0.7421351600392257D-1*t129*t229*t787
      t868 = t807+t810-t824-t827+t831-t834+0.1113202740058839D0*t694
     #*t847*t615+0.2968540640156903D0*t698*t223*t621
     #-0.3710675800196129D-1*t222*t134*t820*t117-0.3710675800196129D-1
     #*t222*t847*t117+0.3710675800196129D0*t129*t861*t778-t867
      t876 = t237**2
      t880 = t761-t765-t769+t772+t774+t777+0.1865441452179294D0*t556
     #*t778+0.1865441452179294D0*t560*t580+t789+0.310906908696549D-1
     #*t107*(0.8172647331405553D0*t583*t189*t778-0.5448431554270369D0
     #*t188*t587*t184+0.5448431554270369D0*t188*t218*t184*t233-t802
     #+0.1362107888567592D0*t109*t112*(t807+t810-t824-t827+t831-t834)
     #*t139-0.2724215777135184D0*t215*t680*t233+0.2724215777135184D0
     #*t215*t686*t843-0.1362107888567592D0*t215*t218*t868)*t239
     #-0.310906908696549D-1*t107*t876*t739
      t882 = 0.45D1*t511
      t883 = -t499-t509+t529+t537+t505+t882-t533+t540+t543+t548-t552
     #+t545+t550-t555
      t886 = -0.3216396844291482D2*t883*t114+t633+t630-t636+t638
      t890 = 0.1362107888567592D0*t194*t112*t886*t117
      t900 = t619+t651+t662-t890-t647+t624+t655+t666-t658+t697+t712
     #+t725-0.3710675800196129D-1*t222*t134*t886*t117-t708+t701+t718
     #+t729-t721
      t904 = t586+t600-t611+t679-t597-t590-t604+0.1362107888567592D0
     #*t109*t112*(t619+t651+t662-t890-t647+t624+t655+t666-t658)*t139
     #-t683+t594+t607-t675+t690-0.1362107888567592D0*t215*t218*t900
      t908 = -t499-t509+t529+t537+t505+t882-t533+t540+t543+t548-t552
     #+t545+t550-t555+t559+t582+t578+t563+0.310906908696549D-1*t107
     #*t904*t239-t742
      t909 = rho*t908
      t911 = 1/t76/t342
      t915 = 0.699259430043336D-2*t244*t911*t270*t74
      t918 = 0.7599105D0*t61*t298*t501
      t922 = 0.3039642D0*t61*t294*t74*t300
      t926 = 0.174814857510834D-2*t246*t60*t294*t80
      t930 = t265**2
      t932 = t35/t249/t43*t930*t266
      t933 = 0.2D1*t932
      t936 = 1/t254/t32*t77
      t938 = t255*t515
      t942 = 1/t41/t32*t77
      t944 = t244*t515
      t948 = 1/t39/t32*t77
      t950 = t259*t515
      t954 = 1/t33/t32*t77
      t956 = t262*t515
      t960 = t251*(-0.8309097827459833D0*t936+0.199418347859036D1*t938
     #-0.4945709824779306D0*t942+0.1483712947433792D1*t944
     #-0.2001071587498409D0*t948+0.8004286349993634D0*t950
     #-0.4215565168327908D-1*t954+0.2529339100996745D0*t956)*t266
      t961 = 0.1D1*t960
      t964 = 0.3847322101863073D2*t98*t74*t501
      t966 = 0.1538928840745229D2*t324*t327
      t977 = 0.4444444444444444D0*t513*t73*t77+0.2666666666666667D1
     #*t288*t515+0.4444444444444444D0*t520*t73*t77
     #-0.2666666666666667D1*t291*t515
      t980 = 0.1923661050931536D1*t97*t977*t78
      t981 = t249**2
      t984 = t46**2
      t987 = t35/t981*t930/t984
      t988 = 0.1608197949869254D2*t987
      t1000 = t313**2
      t1016 = t306**2
      t1019 = t93**2
      t1024 = t942*t47
      t1026 = t944*t47
      t1030 = t246*t250*t265*t266
      t1035 = 0.8806932620892844D-3*t942*t94-0.2642079786267853D-2
     #*t944*t94-0.8497974591333914D-1*t246*t307*t313*t314-0.2D1*t85
     #/t306/t90*t1000*t314+0.1D1*t308*(-0.1544496508763151D1*t936
     #+0.3706791621031562D1*t938-0.854388052766047D0*t942
     #+0.2563164158298141D1*t944-0.4111834438919023D0*t948
     #+0.1644733775567609D1*t950-0.5346380647307093D-1*t954
     #+0.3207828388384256D0*t956)*t314+0.3216395899738507D2*t85/t1016
     #*t1000/t1019-0.1831848842792292D-2*t1024+0.5495546528376876D-2
     #*t1026+0.8837926660346786D-1*t1030+0.2D1*t932-0.1D1*t960
     #-0.1608197949869254D2*t987
      t1038 = 0.1923661050931536D1*t1035*t72*t78
      t1041 = 0.37995525D-1*t61*t977*t80
      t1042 = 0.5495546528376876D-2*t1026
      t1043 = 0.8837926660346786D-1*t1030
      t1047 = 0.225D1*t282*t283*t294*t80
      t1048 = -t915-t918+t922-t926-t933+t961+t964-t966+t980+t988+t1038
     #+t1041-t1042-t1043-t1047
      t1049 = t274**2
      t1052 = t281**2
      t1054 = t59**2
      t1059 = 0.3330984372501762D2*t51/t1049*t1052/t1054*t72*t80
      t1073 = 0.1125D1*t276*(-0.1132974264373283D1*t936
     #+0.271913823449588D1*t938-0.4994648585728036D0*t942
     #+0.1498394575718411D1*t944-0.1075243117819161D0*t948
     #+0.4300972471276643D0*t950-0.4247805766949639D-1*t954
     #+0.2548683460169784D0*t956)*t285
      t1075 = 0.174814857510834D-2*t944*t271
      t1076 = t336**2
      t1085 = t354**2
      t1086 = t112*t1085
      t1089 = 0.2724215777135184D0*t613*t1086*t615
      t1090 = t117*t336
      t1093 = 0.5448431554270369D0*t620*t355*t1090
      t1097 = 0.6356503479982097D0*t194*t344*t354*t117
      t1098 = -t915-t918+t922-t926-t933+t961+t964-t966+t980+t988+t1038
     #+t1041
      t1101 = 0.3847322101863073D1*t320*t294*t78
      t1103 = 0.1538928840745229D2*t321*t327
      t1105 = 0.58271619170278D-3*t942*t271
      t1108 = 0.9D1*t282*t284*t327
      t1113 = 0.5176049408441869D-1*t246*t275*t281*t283*t81
      t1114 = 0.1831848842792292D-2*t1024
      t1120 = 0.225D1*t51/t274/t56*t1052*t285
      t1121 = -t1042-t1043-t1047-t1059-t1073+t1075+t1101-t1103-t1105
     #-t1108+t1113+t1114+t1120
      t1139 = -0.1111111111111111D0*t564*t73*t77+0.6666666666666667D0
     #*t330*t515-0.1111111111111111D0*t570*t73*t77
     #-0.6666666666666667D0*t333*t515
      t1142 = -0.3216396844291482D2*(t1098+t1121)*t114
     #+0.1929838106574889D3*t628*t336-0.3859676213149779D3*t634*t1076
     #+0.9649190532874446D2*t198*t1139
      t1146 = 0.1362107888567592D0*t194*t112*t1142*t117
      t1149 = 0.1362107888567592D0*t194*t1086*t117
      t1152 = 0.8172647331405553D0*t120*t828*t1076
      t1155 = 0.1271300695996419D1*t120*t663*t336
      t1158 = 0.2724215777135184D0*t120*t206*t1139
      t1160 = 1/t110/t76
      t1163 = 0.1059417246663683D1*t120*t108*t1160
      t1201 = t134*t1085
      t1214 = -t1146+t1089+t1093+t1097-t1149+t1152+t1155+t1163-t1158
     #+0.4906338002481548D0*t129*t131/t132/t500-0.3710675800196129D-1
     #*t222*t134*t1142*t117+0.2968540640156903D0*t698*t370*t1090
     #+0.3463297413516387D0*t222*t378*t354*t117+0.3710675800196129D0
     #*t129*t861*t1076+0.1113202740058839D0*t694*t1201*t615
     #-0.3710675800196129D-1*t222*t1201*t117+0.6926594827032773D0*t129
     #*t726*t336-0.7421351600392257D-1*t129*t229*t1139
      t1221 = t382**2
      t1229 = 0.8172647331405553D0*t583*t189*t1076
     #+0.1271300695996419D1*t598*t339-0.5448431554270369D0*t188*t608
     #*t336+0.1362107888567592D0*t109*t112*(t1089+t1093+t1097-t1146
     #-t1149+t1152+t1155-t1158+t1163)*t139+0.1059417246663683D1*t109
     #*t1160*t124*t139-0.6356503479982097D0*t109*t344*t365*t139
     #-0.2724215777135184D0*t215*t672*t382+0.6356503479982097D0*t605
     #*t383-0.1362107888567592D0*t215*t218*t1214-0.2724215777135184D0
     #*t188*t189*t1139+0.2724215777135184D0*t215*t686*t1221
     #+0.5448431554270369D0*t188*t218*t336*t382
      t1237 = t386**2
      t1241 = -t1059+0.1865441452179294D0*t579*t561-t1073+t1075
     #+0.310906908696549D-1*t107*t1229*t239+0.9327207260896469D-1*t177
     #*t1139+0.1865441452179294D0*t556*t1076-0.310906908696549D-1*t107
     #*t1237*t739+t1101-t1103-t1105-t1108+t1113+t1114+t1120
      t1243 = rho*(t1048+t1241)
      t1244 = t6**2
      t1248 = 1/t153/t12
      t1250 = sigmaaa**2
      t1253 = t491-t492+0.1538928840745229D2*t175
     #+0.6218138173930979D-1*t240+0.1865441452179294D0*t185+t744
     #-0.4135669939329333D0/t7*t15-0.8963286558970112D-2/t4/t6/rhoa
     #*t154*sigmaaa+rho*t880+t909+t1243+0.1386969201113936D-3/t1244/t6
     #*t1248*t1250
      v2rhoa2(i) = t490+t1253
      t1258 = t478+t481+t482+0.3039642D0*t169+0.7599105D-1*t403
     #+0.3847322101863073D1*t407-t484+t485+t486-t487
     #+0.6218138173930979D-1*t447+t488
      t1261 = t20**2
      t1265 = 1/t396/t26
      t1267 = sigmabb**2
      t1281 = t61*t401*t166*t77
      t1282 = 0.3039642D0*t1281
      t1283 = t406*t174
      t1284 = 0.1538928840745229D2*t1283
      t1285 = t410**2
      t1288 = t106*t445
      t1289 = t239*t410
      t1295 = t429*t139
      t1303 = t421**2
      t1304 = t112*t1303
      t1307 = 0.2724215777135184D0*t613*t1304*t615
      t1308 = t117*t410
      t1311 = 0.5448431554270369D0*t620*t422*t1308
      t1315 = t416*t131
      t1320 = -0.3216396844291482D2*(t761+t1282-t769+t772-t1284+t777)
     #*t114+0.1929838106574889D3*t1315*t410-0.3859676213149779D3*t634
     #*t1285+t819
      t1324 = 0.1362107888567592D0*t194*t112*t1320*t117
      t1327 = 0.1362107888567592D0*t194*t1304*t117
      t1330 = 0.8172647331405553D0*t120*t828*t1285
      t1336 = t429*t217
      t1340 = t441**2
      t1344 = t134*t1303
      t1361 = t1307+t1311-t1324-t1327+t1330-t834+0.1113202740058839D0
     #*t694*t1344*t615+0.2968540640156903D0*t698*t434*t1308
     #-0.3710675800196129D-1*t222*t134*t1320*t117
     #-0.3710675800196129D-1*t222*t1344*t117+0.3710675800196129D0*t129
     #*t861*t1285-t867
      t1369 = t445**2
      t1373 = t761+t1282-t769+t772-t1284+t777+0.1865441452179294D0
     #*t556*t1285+0.1865441452179294D0*t1288*t1289+t789
     #+0.310906908696549D-1*t107*(0.8172647331405553D0*t583*t189*t1285
     #-0.5448431554270369D0*t188*t1295*t410+0.5448431554270369D0*t188
     #*t218*t410*t441-t802+0.1362107888567592D0*t109*t112*(t1307+t1311
     #-t1324-t1327+t1330-t834)*t139-0.2724215777135184D0*t215*t1336
     #*t441+0.2724215777135184D0*t215*t686*t1340-0.1362107888567592D0
     #*t215*t218*t1361)*t239-0.310906908696549D-1*t107*t1369*t739
      t1378 = 0.87407428755417D-3*t246*t60*t401*t80
      t1379 = 0.349629715021668D-2*t504
      t1383 = 0.1125D1*t282*t283*t401*t80
      t1384 = 0.45D1*t511
      t1385 = -t526
      t1388 = 0.37995525D-1*t61*t1385*t80
      t1389 = 0.1519821D0*t532
      t1393 = 0.1519821D0*t61*t401*t74*t300
      t1394 = 0.6079284D0*t539
      t1397 = 0.1923661050931536D1*t320*t401*t78
      t1398 = 0.7694644203726145D1*t544
      t1401 = 0.1923661050931536D1*t97*t1385*t78
      t1402 = 0.7694644203726145D1*t549
      t1404 = 0.7694644203726145D1*t406*t327
      t1405 = 0.3077857681490458D2*t554
      t1406 = t336*t410
      t1411 = -t576
      t1440 = t615*t421
      t1443 = 0.2724215777135184D0*t613*t355*t1440
      t1446 = 0.2724215777135184D0*t620*t355*t1308
      t1447 = -t1378-t1379-t1383-t1384+t1388+t1389+t1393-t1394+t1397
     #-t1398+t1401-t1402-t1404+t1405
      t1458 = -0.3216396844291482D2*t1447*t114+0.9649190532874446D2
     #*t628*t410+0.9649190532874446D2*t1315*t336-0.3859676213149779D3
     #*t634*t1406+0.9649190532874446D2*t198*t1411
      t1462 = 0.1362107888567592D0*t194*t112*t1458*t117
      t1463 = t421*t117
      t1466 = 0.1362107888567592D0*t194*t355*t1463
      t1469 = 0.2724215777135184D0*t620*t648*t1463
      t1472 = 0.8172647331405553D0*t652*t648*t410
      t1475 = 0.2724215777135184D0*t120*t206*t1411
      t1479 = 0.3178251739991049D0*t194*t344*t421*t117
      t1482 = 0.6356503479982097D0*t120*t663*t410
      t1531 = t1443+t1446-t1462-t1466+t1469+t1472-t1475+t1479+t1482
     #+0.1113202740058839D0*t694*t370*t1440+0.1484270320078451D0*t698
     #*t370*t1308-0.3710675800196129D-1*t222*t134*t1458*t117
     #-0.3710675800196129D-1*t222*t370*t1463+0.1484270320078451D0*t698
     #*t709*t1463+0.3710675800196129D0*t715*t709*t410
     #-0.7421351600392257D-1*t129*t229*t1411+0.1731648706758193D0*t222
     #*t378*t421*t117+0.3463297413516387D0*t129*t726*t410
      t1535 = 0.8172647331405553D0*t583*t189*t1406
     #-0.2724215777135184D0*t188*t1295*t336+0.2724215777135184D0*t188
     #*t218*t336*t441-0.2724215777135184D0*t188*t189*t1411
     #+0.6356503479982097D0*t598*t413-0.3178251739991049D0*t109*t344
     #*t429*t139+0.3178251739991049D0*t605*t442-0.2724215777135184D0
     #*t188*t608*t410+0.1362107888567592D0*t109*t112*(t1443+t1446
     #-t1462-t1466+t1469+t1472-t1475+t1479+t1482)*t139
     #-0.1362107888567592D0*t215*t672*t441+0.2724215777135184D0*t188
     #*t218*t382*t410-0.1362107888567592D0*t215*t1336*t382
     #+0.2724215777135184D0*t215*t686*t382*t441-0.1362107888567592D0
     #*t215*t218*t1531
      t1539 = t739*t445
      t1542 = -t1378-t1379-t1383-t1384+t1388+t1389+t1393-t1394+t1397
     #-t1398+t1401-t1402-t1404+t1405+0.1865441452179294D0*t556*t1406
     #+0.9327207260896469D-1*t1288*t561+0.9327207260896469D-1*t177
     #*t1411+0.9327207260896469D-1*t579*t1289+0.310906908696549D-1
     #*t107*t1535*t239-0.310906908696549D-1*t387*t1539
      t1543 = rho*t1542
      t1544 = t489+t491-t492-0.1538928840745229D2*t175
     #+0.1865441452179294D0*t411+0.1386969201113936D-3/t1261/t20*t1265
     #*t1267+t1243-0.4135669939329333D0/t21*t29-0.8963286558970112D-2
     #/t18/t20/rhob*t397*sigmabb+rho*t1373+2*t1543
      v2rhob2(i) = t1258+t1544
      t1545 = -t758
      t1548 = 0.37995525D-1*t61*t1545*t80
      t1549 = 0.1519821D0*t764
      t1550 = 0.1519821D0*t1281
      t1551 = 0.4559463D0*t768
      t1554 = 0.1923661050931536D1*t97*t1545*t78
      t1555 = 0.7694644203726145D1*t773
      t1556 = 0.7694644203726145D1*t1283
      t1557 = 0.2308393261117844D2*t776
      t1558 = t184*t410
      t1563 = -t787
      t1586 = 0.2724215777135184D0*t613*t202*t1440
      t1589 = 0.2724215777135184D0*t620*t202*t1308
      t1601 = -0.3216396844291482D2*(t1548+t1549-t1550+t1551+t1554
     #-t1555+t1556-t1557)*t114+0.9649190532874446D2*t631*t410
     #+0.9649190532874446D2*t1315*t184-0.3859676213149779D3*t634*t1558
     #+0.9649190532874446D2*t198*t1563
      t1605 = 0.1362107888567592D0*t194*t112*t1601*t117
      t1608 = 0.1362107888567592D0*t194*t202*t1463
      t1609 = t112*t184
      t1612 = 0.2724215777135184D0*t620*t1609*t1463
      t1615 = 0.8172647331405553D0*t652*t1609*t410
      t1618 = 0.2724215777135184D0*t120*t206*t1563
      t1651 = t134*t184
      t1661 = t1586+t1589-t1605-t1608+t1612+t1615-t1618
     #+0.1113202740058839D0*t694*t223*t1440+0.1484270320078451D0*t698
     #*t223*t1308-0.3710675800196129D-1*t222*t134*t1601*t117
     #-0.3710675800196129D-1*t222*t223*t1463+0.1484270320078451D0*t698
     #*t1651*t1463+0.3710675800196129D0*t715*t1651*t410
     #-0.7421351600392257D-1*t129*t229*t1563
      t1665 = 0.8172647331405553D0*t583*t189*t1558
     #-0.2724215777135184D0*t188*t1295*t184+0.2724215777135184D0*t188
     #*t218*t184*t441-0.2724215777135184D0*t188*t189*t1563
     #-0.2724215777135184D0*t188*t587*t410+0.1362107888567592D0*t109
     #*t112*(t1586+t1589-t1605-t1608+t1612+t1615-t1618)*t139
     #-0.1362107888567592D0*t215*t680*t441+0.2724215777135184D0*t188
     #*t218*t233*t410-0.1362107888567592D0*t215*t1336*t233
     #+0.2724215777135184D0*t215*t686*t233*t441-0.1362107888567592D0
     #*t215*t218*t1661
      t1671 = t1548+t1549-t1550+t1551+t1554-t1555+t1556-t1557
     #+0.1865441452179294D0*t556*t1558+0.9327207260896469D-1*t1288
     #*t580+0.9327207260896469D-1*t177*t1563+0.9327207260896469D-1
     #*t560*t1289+0.310906908696549D-1*t107*t1665*t239
     #-0.310906908696549D-1*t238*t1539
      t1673 = rho*t1671-t484+t488+t481+t482+t491-t492-t487+t404+t408
     #+t486+t412
      t1677 = t186+t1243+t489+0.5D0*t744+0.1D1*t1543+t448+t165+t173
     #+0.5D0*t909+t241+t478+t485
      v2rhoab(i) = t1673+t1677
      t1684 = t106*t471
      t1690 = sigma*t228*t134
      t1691 = t119*t139
      t1701 = t127*t108
      t1703 = 0.1362107888567592D0*t1701*t203
      t1704 = t119*t114
      t1706 = 0.2724215777135184D0*t1704*t1609
      t1717 = t457*t134
      t1718 = t119*t217
      t1726 = t612*t131
      t1739 = t739*t471
      t1743 = rho*(0.9327207260896469D-1*t1684*t580
     #+0.310906908696549D-1*t107*(-0.2724215777135184D0*t206*t190
     #-0.3710675800196129D-1*t1690*t1691*t184+0.2724215777135184D0
     #*t188*t218*t184*t467+0.1362107888567592D0*t121*t587
     #+0.1362107888567592D0*t109*t112*(-t1703-t1706)*t139
     #-0.1362107888567592D0*t215*t680*t467-0.1362107888567592D0*t121
     #*t234-0.1855337900098064D-1*t1717*t1718*t233
     #+0.2724215777135184D0*t215*t686*t233*t467-0.1362107888567592D0
     #*t215*t218*(-t1703-t1706-0.7421351600392257D-1*t1726*t224
     #-0.1484270320078451D0*t193*t230))*t239-0.310906908696549D-1*t238
     #*t1739)
      t1745 = t107*t471*t239
      t1746 = 0.310906908696549D-1*t1745
      t1769 = 0.1362107888567592D0*t1701*t356
      t1771 = 0.2724215777135184D0*t1704*t648
      t1773 = 0.3178251739991049D0*t462*t344
      t1801 = -0.2724215777135184D0*t206*t339-0.3710675800196129D-1
     #*t1690*t1691*t336+0.2724215777135184D0*t188*t218*t336*t467
     #-0.3178251739991049D0*t362*t189-0.4329121766895483D-1*t457*t378
     #*t119*t139+0.3178251739991049D0*t605*t468+0.1362107888567592D0
     #*t121*t608+0.1362107888567592D0*t109*t112*(-t1769-t1771-t1773)
     #*t139-0.1362107888567592D0*t215*t672*t467-0.1362107888567592D0
     #*t121*t383-0.1855337900098064D-1*t1717*t1718*t382
     #+0.2724215777135184D0*t215*t686*t382*t467-0.1362107888567592D0
     #*t215*t218*(-t1769-t1771-t1773-0.7421351600392257D-1*t1726*t371
     #-0.1484270320078451D0*t193*t374-0.1731648706758193D0*t193*t379)
      t1808 = rho*(0.9327207260896469D-1*t1684*t561
     #+0.310906908696549D-1*t107*t1801*t239-0.310906908696549D-1*t387
     #*t1739)
      v2rhoasigmaaa(i) = 0.4481643279485056D-2*t155
     #-0.5201134504177261D-4/t1244/rhoa*t1248*sigmaaa+t1743+t1746+t1808
      t1810 = 0.6218138173930979D-1*t1745
      t1811 = 2.D0*t1808
      v2rhoasigmaab(i) = 2.D0*t1743+t1810+t1811
      v2rhoasigmabb(i) = t1743+t1746+t1808
      t1826 = 0.1362107888567592D0*t1701*t423
      t1829 = 0.2724215777135184D0*t1704*t112*t410
      t1862 = rho*(0.9327207260896469D-1*t1684*t1289
     #+0.310906908696549D-1*t107*(-0.2724215777135184D0*t206*t413
     #-0.3710675800196129D-1*t1690*t1691*t410+0.2724215777135184D0
     #*t188*t218*t410*t467+0.1362107888567592D0*t121*t1295
     #+0.1362107888567592D0*t109*t112*(-t1826-t1829)*t139
     #-0.1362107888567592D0*t215*t1336*t467-0.1362107888567592D0*t121
     #*t442-0.1855337900098064D-1*t1717*t1718*t441
     #+0.2724215777135184D0*t215*t686*t441*t467-0.1362107888567592D0
     #*t215*t218*(-t1826-t1829-0.7421351600392257D-1*t1726*t435
     #-0.1484270320078451D0*t193*t438))*t239-0.310906908696549D-1*t446
     #*t1739)
      v2rhobsigmaaa(i) = t1862+t1746+t1808
      v2rhobsigmaab(i) = 2.D0*t1862+t1810+t1811
      v2rhobsigmabb(i) = 0.4481643279485056D-2*t398
     #-0.5201134504177261D-4/t1261/rhob*t1265*sigmabb+t1862+t1746+t1808
      t1880 = t467**2
      t1891 = t454*(0.3710675800196129D-1*t135*t1691
     #-0.2724215777135184D0*t121*t468-0.3710675800196129D-1*t1717
     #*t1718*t467+0.2724215777135184D0*t215*t686*t1880
     #-0.5054340779364009D-2*sigma*t714*t911*t218*t127)*t239
      t1892 = 0.310906908696549D-1*t1891
      t1893 = t471**2
      t1895 = t454*t1893*t739
      t1896 = 0.310906908696549D-1*t1895
      v2sigmaaa2(i) = 0.1950425439066473D-4/t1244*t1248+t1892-t1896
      v2sigmaaaab(i) = 0.6218138173930979D-1*t1891
     #-0.6218138173930979D-1*t1895
      v2sigmaaabb(i) = t1892-t1896
      v2sigmaab2(i) = 0.1243627634786196D0*t1891-0.1243627634786196D0
     #*t1895
      v2sigmaabbb(i) = v2sigmaaaab(i)
      v2sigmabb2(i) = 0.1950425439066473D-4/t1261*t1265+t1892-t1896
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      v2rhob2(i) = 0.0d0
      v2rhoab(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2rhoasigmaab(i) = 0.0d0
      v2rhoasigmabb(i) = 0.0d0
      v2rhobsigmaaa(i) = 0.0d0
      v2rhobsigmaab(i) = 0.0d0
      v2rhobsigmabb(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      v2sigmaab2(i) = 0.0d0
      v2sigmabb2(i) = 0.0d0
      v2sigmaaaab(i) = 0.0d0
      v2sigmaaabb(i) = 0.0d0
      v2sigmaabbb(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end
      
      
      subroutine rks_xc_revpbe
     & (ideriv,npt,rhoa1,sigmaaa1,
     &  zk,vrhoa,vsigmaaa,
     &  v2rhoa2,v2rhoasigmaaa,v2sigmaaa2)
c
c     Y. Zhang, and W. Yang
c     Comment on: Generalized gradient approximation made simple
c     Phys. Rev. Lett. 80 (1998) 890-890
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt)
      REAL sigmaaa1(npt)
      REAL zk(npt),vrhoa(npt),vsigmaaa(npt)
      REAL v2rhoa2(npt),v2rhoasigmaaa(npt),v2sigmaaa2(npt)
      parameter(tol=1.0d-20)
      
      if(ideriv.eq.0) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t4 = rho**2
      t5 = t2**2
      t16 = 1/rho
      t17 = t16**(1.D0/3.D0)
      t20 = t16**(1.D0/6.D0)
      t23 = dsqrt(t16)
      t25 = t17**2
      t31 = dlog(1.D0+0.1608197949869254D2/(0.598255043577108D1*t20
     #+0.2225569421150687D1*t17+0.8004286349993634D0*t23
     #+0.1897004325747559D0*t25))
      t32 = (1.D0+0.1325688999052018D0*t17)*t31
      t35 = 1/t2/t4
      t38 = dexp(0.2000000587336264D1*t32)
      t39 = t38-1.D0
      t43 = 0.1362107888567592D0/t39*sigma*t35
      t45 = t39**2
      t47 = sigma**2
      t49 = t4**2
      t60 = dlog(1.D0+0.1362107888567592D0*sigma*t35*(1.D0+t43)/(1.D0
     #+t43+0.1855337900098064D-1/t45*t47/t5/t49))
      zk(i) = -0.7385587663820224D0*t2*rho*(0.2245D1-0.1245D1/(1.D0
     #+0.4605613314402244D-2*sigma/t5/t4))+rho*(-0.621814D-1*t32
     #+0.310906908696549D-1*t60)
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t3 = t2*rho
      t4 = rho**2
      t5 = t2**2
      t10 = 1.D0+0.4605613314402244D-2*sigma/t5/t4
      t13 = 0.2245D1-0.1245D1/t10
      t16 = 1/rho
      t17 = t16**(1.D0/3.D0)
      t19 = 1.D0+0.1325688999052018D0*t17
      t20 = t16**(1.D0/6.D0)
      t23 = dsqrt(t16)
      t25 = t17**2
      t27 = 0.598255043577108D1*t20+0.2225569421150687D1*t17
     #+0.8004286349993634D0*t23+0.1897004325747559D0*t25
      t30 = 1.D0+0.1608197949869254D2/t27
      t31 = dlog(t30)
      t32 = t19*t31
      t33 = 0.621814D-1*t32
      t35 = 1/t2/t4
      t36 = sigma*t35
      t38 = dexp(0.2000000587336264D1*t32)
      t39 = t38-1.D0
      t40 = 1/t39
      t41 = t40*sigma
      t43 = 0.1362107888567592D0*t41*t35
      t44 = 1.D0+t43
      t45 = t39**2
      t46 = 1/t45
      t47 = sigma**2
      t48 = t46*t47
      t49 = t4**2
      t51 = 1/t5/t49
      t54 = 1.D0+t43+0.1855337900098064D-1*t48*t51
      t55 = 1/t54
      t56 = t44*t55
      t59 = 1.D0+0.1362107888567592D0*t36*t56
      t60 = dlog(t59)
      t61 = 0.310906908696549D-1*t60
      zk(i) = -0.7385587663820224D0*t3*t13+rho*(-t33+t61)
      t66 = t10**2
      t67 = 1/t66
      t72 = 1/t4
      t73 = 1/t25*t72
      t74 = t73*t31
      t76 = t27**2
      t79 = t20**2
      t80 = t79**2
      t95 = t19/t76*(-0.99709173929518D0/t80/t20*t72
     #-0.7418564737168958D0*t73-0.4002143174996817D0/t23*t72
     #-0.1264669550498372D0/t17*t72)/t30
      t99 = 1/t2/t4/rho
      t103 = t46*sigma
      t106 = -0.8837929255764197D-1*t74-0.3216396844291482D2*t95
      t110 = 0.1362107888567592D0*t103*t35*t106*t38
      t112 = 0.3178251739991049D0*t41*t99
      t117 = t54**2
      t119 = t44/t117
      t137 = 1/t59
      vrhoa(i) = -0.9847450218426965D0*t2*t13+0.1129303341188623D-1
     #*t35*t67*sigma-t33+t61+rho*(0.2747773264188438D-2*t74+0.1D1*t95
     #+0.310906908696549D-1*(-0.3178251739991049D0*sigma*t99*t56
     #+0.1362107888567592D0*t36*(-t110-t112)*t55-0.1362107888567592D0
     #*t36*t119*(-t110-t112-0.3710675800196129D-1/t45/t39*t47*t51*t106
     #*t38-0.8658243533790967D-1*t48/t5/t49/rho))*t137)
      vsigmaaa(i) = -0.1693955011782934D-1/t3*t67+0.1243627634786196D0
     #*rho*(0.1362107888567592D0*t35*t44*t55+0.1855337900098064D-1
     #*sigma*t51*t40*t55-0.1362107888567592D0*t36*t119*
     #(0.1362107888567592D0*t40*t35+0.3710675800196129D-1*t103*t51))
     #*t137
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t3 = t2*rho
      t4 = rho**2
      t5 = t2**2
      t10 = 1.D0+0.4605613314402244D-2*sigma/t5/t4
      t13 = 0.2245D1-0.1245D1/t10
      t16 = 1/rho
      t17 = t16**(1.D0/3.D0)
      t19 = 1.D0+0.1325688999052018D0*t17
      t20 = t16**(1.D0/6.D0)
      t23 = dsqrt(t16)
      t25 = t17**2
      t27 = 0.598255043577108D1*t20+0.2225569421150687D1*t17
     #+0.8004286349993634D0*t23+0.1897004325747559D0*t25
      t30 = 1.D0+0.1608197949869254D2/t27
      t31 = dlog(t30)
      t32 = t19*t31
      t33 = 0.621814D-1*t32
      t35 = 1/t2/t4
      t36 = sigma*t35
      t38 = dexp(0.2000000587336264D1*t32)
      t39 = t38-1.D0
      t40 = 1/t39
      t41 = t40*sigma
      t43 = 0.1362107888567592D0*t41*t35
      t44 = 1.D0+t43
      t45 = t39**2
      t46 = 1/t45
      t47 = sigma**2
      t48 = t46*t47
      t49 = t4**2
      t51 = 1/t5/t49
      t54 = 1.D0+t43+0.1855337900098064D-1*t48*t51
      t55 = 1/t54
      t56 = t44*t55
      t59 = 1.D0+0.1362107888567592D0*t36*t56
      t60 = dlog(t59)
      t61 = 0.310906908696549D-1*t60
      zk(i) = -0.7385587663820224D0*t3*t13+rho*(-t33+t61)
      t66 = t10**2
      t67 = 1/t66
      t68 = t35*t67
      t71 = 1/t25
      t72 = 1/t4
      t73 = t71*t72
      t74 = t73*t31
      t76 = t27**2
      t77 = 1/t76
      t78 = t19*t77
      t79 = t20**2
      t80 = t79**2
      t81 = t80*t20
      t82 = 1/t81
      t86 = 1/t23
      t89 = 1/t17
      t92 = -0.99709173929518D0*t82*t72-0.7418564737168958D0*t73
     #-0.4002143174996817D0*t86*t72-0.1264669550498372D0*t89*t72
      t93 = 1/t30
      t95 = t78*t92*t93
      t97 = t4*rho
      t99 = 1/t2/t97
      t100 = sigma*t99
      t103 = t46*sigma
      t106 = -0.8837929255764197D-1*t74-0.3216396844291482D2*t95
      t110 = 0.1362107888567592D0*t103*t35*t106*t38
      t112 = 0.3178251739991049D0*t41*t99
      t113 = -t110-t112
      t114 = t113*t55
      t117 = t54**2
      t118 = 1/t117
      t119 = t44*t118
      t121 = 1/t45/t39
      t122 = t121*t47
      t124 = t51*t106*t38
      t127 = t49*rho
      t129 = 1/t5/t127
      t132 = -t110-t112-0.3710675800196129D-1*t122*t124
     #-0.8658243533790967D-1*t48*t129
      t133 = t119*t132
      t136 = -0.3178251739991049D0*t100*t56+0.1362107888567592D0*t36
     #*t114-0.1362107888567592D0*t36*t133
      t137 = 1/t59
      t138 = t136*t137
      vrhoa(i) = -0.9847450218426965D0*t2*t13+0.1129303341188623D-1
     #*t68*sigma-t33+t61+rho*(0.2747773264188438D-2*t74+0.1D1*t95
     #+0.310906908696549D-1*t138)
      t145 = t35*t44
      t148 = sigma*t51
      t149 = t40*t55
      t156 = 0.1362107888567592D0*t40*t35+0.3710675800196129D-1*t103*t51
      t157 = t119*t156
      t160 = 0.1362107888567592D0*t145*t55+0.1855337900098064D-1*t148
     #*t149-0.1362107888567592D0*t36*t157
      vsigmaaa(i) = -0.1693955011782934D-1/t3*t67+0.1243627634786196D0
     #*rho*t160*t137
      t181 = dlog(1.D0+0.2960874997779344D2/(0.8157414703487641D1*t20
     #+0.2247591863577616D1*t17+0.4300972471276643D0*t23
     #+0.1911512595127338D0*t25))
      t183 = (1.D0+0.6901399211255825D-1*t17)*t181*t72
      t185 = t60*t72
      t188 = 1/t2/t49
      t190 = sigma*t188*t56
      t195 = 0.1086299437397317D1*t183-0.1333333724890842D1*t32*t72
      t199 = 0.1362107888567592D0*t103*t35*t195*t38
      t200 = t41*t188
      t201 = 0.6053812838078188D-1*t200
      t210 = t49*t4
      t213 = t48/t5/t210
      t227 = 0.6356503479982097D0*t103*t99*t106*t38
      t228 = t106**2
      t229 = t35*t228
      t232 = 0.1362107888567592D0*t103*t229*t38
      t235 = 1/t49
      t236 = 1/t25/t16*t235
      t237 = t236*t31
      t242 = t92**2
      t244 = t19/t76/t27*t242*t93
      t250 = 1/t97
      t254 = t71*t250
      t270 = t78*(-0.8309097827459833D0/t81/t16*t235
     #+0.199418347859036D1*t82*t250-0.4945709824779306D0*t236
     #+0.1483712947433792D1*t254-0.2001071587498409D0/t23/t16*t235
     #+0.8004286349993634D0*t86*t250-0.4215565168327908D-1/t17/t16
     #*t235+0.2529339100996745D0*t89*t250)*t93
      t272 = t76**2
      t275 = t30**2
      t278 = t19/t272*t242/t275
      t282 = t73*t77*t92*t93
      t284 = t254*t31
      t286 = -0.5891952837176131D-1*t237+0.6432793688582964D2*t244
     #-0.3216396844291482D2*t270-0.5172602810955498D3*t278
     #+0.2842627942041896D1*t282+0.1767585851152839D0*t284
      t291 = t51*t228
      t296 = 0.1059417246663683D1*t200
      t297 = t45**2
      t301 = dexp(0.4000001174672527D1*t32)
      t309 = t121*sigma
      t312 = 0.2724215777135184D0*t309*t229*t301
      t316 = 0.1362107888567592D0*t103*t35*t286*t38
      t325 = t113*t118
      t335 = 1/t117/t54
      t336 = t44*t335
      t337 = t132**2
      t344 = t136**2
      t345 = t59**2
      t346 = 1/t345
      t361 = 1/t66/t10
      t369 = -t195
      t373 = 0.1362107888567592D0*t103*t35*t369*t38
      t374 = 0.6053812838078188D-1*t200
      s1 = 0.1099109305675375D-1*t74-0.2258606682377246D-1*t99*t67
     #*sigma-0.6564966812284644D0/t5*t13+rho*(-0.337738D-1*t183
     #+0.207271272464366D-1*t185+0.310906908696549D-1*(
     #-0.6053812838078188D-1*t190+0.1362107888567592D0*t36*(-t199-t201
     #)*t55-0.1362107888567592D0*t36*t119*(-t199-t201
     #-0.3710675800196129D-1*t122*t51*t195*t38-0.1649189244531613D-1
     #*t213))*t137)
      s2 = s1+2.D0*rho*(0.310906908696549D-1*(-0.1362107888567592D0
     #*t36*t119*(t227-t232-0.3710675800196129D-1*t122*t51*t286*t38
     #-0.3710675800196129D-1*t122*t291*t38+0.4906338002481548D0*t213
     #+t296+0.1113202740058839D0/t297*t47*t291*t301
     #+0.3463297413516387D0*t122*t129*t106*t38+t312-t316)
     #+0.1362107888567592D0*t36*(t312+t227-t316-t232+t296)*t55
     #-0.2724215777135184D0*t36*t325*t132+0.1059417246663683D1*t190
     #-0.6356503479982097D0*t100*t114+0.6356503479982097D0*t100*t133
     #+0.2724215777135184D0*t36*t336*t337)*t137-0.310906908696549D-1
     #*t344*t346+0.1831848842792292D-2*t237-0.2D1*t244+0.1D1*t270
     #+0.1608197949869254D2*t278-0.8837926660346786D-1*t282
     #-0.5495546528376876D-2*t284)+0.4D1*t95
      v2rhoa2(i) = s2+0.5547876804455745D-3/t210*t361*t47
     #+0.1243627634786196D0*t138+rho*(0.337738D-1*t183
     #-0.207271272464366D-1*t185+0.310906908696549D-1*
     #(0.6053812838078188D-1*t190+0.1362107888567592D0*t36*(-t373+t374
     #)*t55-0.1362107888567592D0*t36*t119*(-t373+t374
     #-0.3710675800196129D-1*t122*t51*t369*t38+0.1649189244531613D-1
     #*t213))*t137)
      t414 = 0.1362107888567592D0*t46*t35*t106*t38
      t416 = 0.3178251739991049D0*t40*t99
      t427 = t40*t118
      v2rhoasigmaaa(i) = 0.2258606682377246D-1*t68
     #-0.4160907603341809D-3/t127*t361*sigma+0.1243627634786196D0*t160
     #*t137+4.D0*rho*(0.310906908696549D-1*(-0.3178251739991049D0*t99
     #*t44*t55-0.4329121766895483D-1*sigma*t129*t149
     #+0.3178251739991049D0*t100*t157+0.1362107888567592D0*t35*t113
     #*t55+0.1362107888567592D0*t36*(-t414-t416)*t55
     #-0.1362107888567592D0*t36*t325*t156-0.1362107888567592D0*t145
     #*t118*t132-0.1855337900098064D-1*t148*t427*t132
     #+0.2724215777135184D0*t36*t44*t335*t132*t156
     #-0.1362107888567592D0*t36*t119*(-t414-t416-0.7421351600392257D-1
     #*t309*t124-0.1731648706758193D0*t103*t129))*t137
     #-0.310906908696549D-1*t136*t346*t160)
      t464 = t156**2
      t478 = t160**2
      v2sigmaaa2(i) = 0.6241361405012713D-3*t235*t361
     #+0.4974510539144783D0*rho*(0.3710675800196129D-1*t51*t40*t55
     #-0.2724215777135184D0*t145*t118*t156-0.3710675800196129D-1*t148
     #*t427*t156+0.2724215777135184D0*t36*t336*t464
     #-0.5054340779364009D-2*sigma/t49/t97*t119*t46)*t137
     #-0.4974510539144783D0*rho*t478*t346
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end

c:XC_REVPBEsubrend
_ENDIF
_IF(ccpdft,all,xc_rpbe)
c:XC_RPBEsubrstart

c    Generated: Fri Aug 14 17:06:30 BST 2009

      subroutine uks_xc_rpbe
     & (ideriv,npt,rhoa1,rhob1,sigmaaa1,sigmabb1,sigmaab1,
     &  zk,vrhoa,vrhob,vsigmaaa,vsigmabb,vsigmaab,
     &  v2rhoa2,v2rhob2,v2rhoab,
     &  v2rhoasigmaaa,v2rhoasigmaab,v2rhoasigmabb,
     &  v2rhobsigmabb,v2rhobsigmaab,v2rhobsigmaaa,
     &  v2sigmaaa2,v2sigmaaaab,v2sigmaaabb,
     &  v2sigmaab2,v2sigmaabbb,v2sigmabb2)
c
c     B. Hammer, L.B. Hansen, and J.K. Noerskov
c     Improved adsorption energetics within density functional theory
c     using revised PBE functionals
c     Phys. Rev. B. 59 (1999) 7413-7421
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt),rhob1(npt)
      REAL sigmaaa1(npt),sigmabb1(npt),sigmaab1(npt)
      REAL zk(npt),vrhoa(npt),vrhob(npt)
      REAL vsigmaaa(npt),vsigmabb(npt),vsigmaab(npt)
      REAL v2rhoa2(npt),v2rhob2(npt),v2rhoab(npt)
      REAL v2rhoasigmaaa(npt),v2rhoasigmaab(npt)
      REAL v2rhoasigmabb(npt),v2rhobsigmabb(npt)
      REAL v2rhobsigmaab(npt),v2rhobsigmaaa(npt)
      REAL v2sigmaaa2(npt),v2sigmaaaab(npt),v2sigmaaabb(npt)
      REAL v2sigmaab2(npt),v2sigmaabbb(npt),v2sigmabb2(npt)
      parameter(tol=1.0d-20)
      
      if (ideriv.eq.0) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t4 = rhob**2
      t5 = t2**2
      t10 = dexp(-0.449276922095889D-2*sigmabb/t5/t4)
      t15 = 1/rhob
      t16 = t15**(1.D0/3.D0)
      t19 = t15**(1.D0/6.D0)
      t22 = dsqrt(t15)
      t24 = t16**2
      t30 = dlog(1.D0+0.3216395899738507D2/(0.1112037486309468D2*t19
     #+0.3844746237447211D1*t16+0.1644733775567609D1*t22
     #+0.2405871291288192D0*t24))
      t31 = (1.D0+0.1274696188700087D0*t16)*t30
      t34 = 1/t2/t4
      t37 = dexp(0.2000000587336264D1*t31)
      t38 = t37-1.D0
      t42 = 0.2162211495206379D0/t38*sigmabb*t34
      t44 = t38**2
      t46 = sigmabb**2
      t48 = t4**2
      t59 = dlog(1.D0+0.2162211495206379D0*sigmabb*t34*(1.D0+t42)/
     #(1.D0+t42+0.4675158550002605D-1/t44*t46/t5/t48))
      zk(i) = -0.9305257363491D0*t2*rhob*(0.1804D1-0.804D0*t10)+rhob*(
     #-0.310907D-1*t31+0.1554534543482745D-1*t59)
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t4 = rhoa**2
      t5 = t2**2
      t10 = dexp(-0.449276922095889D-2*sigmaaa/t5/t4)
      t15 = 1/rhoa
      t16 = t15**(1.D0/3.D0)
      t19 = t15**(1.D0/6.D0)
      t22 = dsqrt(t15)
      t24 = t16**2
      t30 = dlog(1.D0+0.3216395899738507D2/(0.1112037486309468D2*t19
     #+0.3844746237447211D1*t16+0.1644733775567609D1*t22
     #+0.2405871291288192D0*t24))
      t31 = (1.D0+0.1274696188700087D0*t16)*t30
      t34 = 1/t2/t4
      t37 = dexp(0.2000000587336264D1*t31)
      t38 = t37-1.D0
      t42 = 0.2162211495206379D0/t38*sigmaaa*t34
      t44 = t38**2
      t46 = sigmaaa**2
      t48 = t4**2
      t59 = dlog(1.D0+0.2162211495206379D0*sigmaaa*t34*(1.D0+t42)/
     #(1.D0+t42+0.4675158550002605D-1/t44*t46/t5/t48))
      zk(i) = -0.9305257363491D0*t2*rhoa*(0.1804D1-0.804D0*t10)+rhoa*(
     #-0.310907D-1*t31+0.1554534543482745D-1*t59)
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t6 = rhoa**2
      t7 = t4**2
      t12 = dexp(-0.449276922095889D-2*sigmaaa/t7/t6)
      t17 = rhob**(1.D0/3.D0)
      t19 = rhob**2
      t20 = t17**2
      t25 = dexp(-0.449276922095889D-2*sigmabb/t20/t19)
      t30 = 1/rho
      t31 = t30**(1.D0/3.D0)
      t34 = t30**(1.D0/6.D0)
      t37 = dsqrt(t30)
      t39 = t31**2
      t45 = dlog(1.D0+0.1608197949869254D2/(0.598255043577108D1*t34
     #+0.2225569421150687D1*t31+0.8004286349993634D0*t37
     #+0.1897004325747559D0*t39))
      t47 = 0.621814D-1*(1.D0+0.1325688999052018D0*t31)*t45
      t58 = dlog(1.D0+0.2960874997779344D2/(0.8157414703487641D1*t34
     #+0.2247591863577616D1*t31+0.4300972471276643D0*t37
     #+0.1911512595127338D0*t39))
      t61 = rhoa-1.D0*rhob
      t62 = t61*t30
      t63 = 1.D0+t62
      t64 = t63**(1.D0/3.D0)
      t67 = 1.D0-1.D0*t62
      t68 = t67**(1.D0/3.D0)
      t70 = t64*t63+t68*t67-2.D0
      t71 = t61**2
      t72 = t71**2
      t73 = rho**2
      t74 = t73**2
      t76 = t72/t74
      t81 = 0.37995525D-1*(1.D0+0.6901399211255825D-1*t31)*t58*t70*
     #(1.D0-1.D0*t76)
      t92 = dlog(1.D0+0.3216395899738507D2/(0.1112037486309468D2*t34
     #+0.3844746237447211D1*t31+0.1644733775567609D1*t37
     #+0.2405871291288192D0*t39))
      t98 = 0.1923661050931536D1*(-0.310907D-1*(1.D0
     #+0.1274696188700087D0*t31)*t92+t47)*t70*t76
      t99 = t64**2
      t101 = t68**2
      t103 = 0.5D0*t99+0.5D0*t101
      t104 = t103**2
      t105 = t104*t103
      t106 = 1/t104
      t108 = rho**(1.D0/3.D0)
      t110 = 1/t108/t73
      t115 = dexp(-0.3216396844291482D2*(-t47+t81+t98)/t105)
      t116 = t115-1.D0
      t121 = 0.1362107888567592D0/t116*sigma*t106*t110
      t124 = t116**2
      t126 = sigma**2
      t128 = t104**2
      t130 = t108**2
      t142 = dlog(1.D0+0.1362107888567592D0*sigma*t106*t110*(1.D0+t121
     #)/(1.D0+t121+0.1855337900098064D-1/t124*t126/t128/t130/t74))
      zk(i) = -0.9305257363491D0*t4*rhoa*(0.1804D1-0.804D0*t12)
     #-0.9305257363491D0*t17*rhob*(0.1804D1-0.804D0*t25)+rho*(-t47+t81
     #+t98+0.310906908696549D-1*t105*t142)
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t3 = t2*rhob
      t4 = rhob**2
      t5 = t2**2
      t10 = dexp(-0.449276922095889D-2*sigmabb/t5/t4)
      t12 = 0.1804D1-0.804D0*t10
      t15 = 1/rhob
      t16 = t15**(1.D0/3.D0)
      t18 = 1.D0+0.1274696188700087D0*t16
      t19 = t15**(1.D0/6.D0)
      t22 = dsqrt(t15)
      t24 = t16**2
      t26 = 0.1112037486309468D2*t19+0.3844746237447211D1*t16
     #+0.1644733775567609D1*t22+0.2405871291288192D0*t24
      t29 = 1.D0+0.3216395899738507D2/t26
      t30 = dlog(t29)
      t31 = t18*t30
      t32 = 0.310907D-1*t31
      t34 = 1/t2/t4
      t35 = sigmabb*t34
      t37 = dexp(0.2000000587336264D1*t31)
      t38 = t37-1.D0
      t39 = 1/t38
      t40 = t39*sigmabb
      t42 = 0.2162211495206379D0*t40*t34
      t43 = 1.D0+t42
      t44 = t38**2
      t45 = 1/t44
      t46 = sigmabb**2
      t47 = t45*t46
      t48 = t4**2
      t50 = 1/t5/t48
      t51 = t47*t50
      t53 = 1.D0+t42+0.4675158550002605D-1*t51
      t54 = 1/t53
      t55 = t43*t54
      t58 = 1.D0+0.2162211495206379D0*t35*t55
      t59 = dlog(t58)
      t60 = 0.1554534543482745D-1*t59
      zk(i) = -0.9305257363491D0*t3*t12+rhob*(-t32+t60)
      vrhoa(i) = 0.D0
      t69 = 1/t2/t4/rhob
      t75 = 1/t5/t48/rhob
      t77 = t39*t54
      t80 = t53**2
      t82 = t43/t80
      t93 = 1/t58
      t97 = 1/t4
      t98 = 1/t24*t97
      t99 = t98*t30
      t101 = t26**2
      t104 = t19**2
      t105 = t104**2
      t120 = t18/t101*(-0.1853395810515781D1/t105/t19*t97
     #-0.128158207914907D1*t98-0.8223668877838045D0/t22*t97
     #-0.1603914194192128D0/t16*t97)/t29
      t124 = -0.8497977086918237D-1*t99-0.6432793688582964D2*t120
      t129 = t45*sigmabb
      vrhob(i) = -0.12407009817988D1*t2*t12+0.8963286558970112D-2*t35
     #*t10-t32+t60+0.1554534543482745D-1*rhob*(-0.5045160155481551D0
     #*sigmabb*t69*t55-0.1090870328333941D0*t46*t75*t77
     #-0.2162211495206379D0*t35*t82*(-0.5045160155481551D0*t40*t69
     #-0.2181740656667882D0*t47*t75))*t93+rhob*(0.1321039893133927D-2
     #*t99+0.1D1*t120+0.1554534543482745D-1*(-0.4675158550002605D-1
     #*t51*t124*t37*t54-0.2162211495206379D0*t35*t82*(
     #-0.2162211495206379D0*t129*t34*t124*t37-0.935031710000521D-1/t44
     #/t38*t46*t50*t124*t37))*t93)
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      vsigmabb(i) = -0.3361232459613792D-2/t3*t10
     #+0.1554534543482745D-1*rhob*(0.2162211495206379D0*t34*t43*t54
     #+0.4675158550002605D-1*sigmabb*t50*t77-0.2162211495206379D0*t35
     #*t82*(0.2162211495206379D0*t39*t34+0.935031710000521D-1*t129*t50
     #))*t93
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t3 = t2*rhoa
      t4 = rhoa**2
      t5 = t2**2
      t10 = dexp(-0.449276922095889D-2*sigmaaa/t5/t4)
      t12 = 0.1804D1-0.804D0*t10
      t15 = 1/rhoa
      t16 = t15**(1.D0/3.D0)
      t18 = 1.D0+0.1274696188700087D0*t16
      t19 = t15**(1.D0/6.D0)
      t22 = dsqrt(t15)
      t24 = t16**2
      t26 = 0.1112037486309468D2*t19+0.3844746237447211D1*t16
     #+0.1644733775567609D1*t22+0.2405871291288192D0*t24
      t29 = 1.D0+0.3216395899738507D2/t26
      t30 = dlog(t29)
      t31 = t18*t30
      t32 = 0.310907D-1*t31
      t34 = 1/t2/t4
      t35 = sigmaaa*t34
      t37 = dexp(0.2000000587336264D1*t31)
      t38 = t37-1.D0
      t39 = 1/t38
      t40 = t39*sigmaaa
      t42 = 0.2162211495206379D0*t40*t34
      t43 = 1.D0+t42
      t44 = t38**2
      t45 = 1/t44
      t46 = sigmaaa**2
      t47 = t45*t46
      t48 = t4**2
      t50 = 1/t5/t48
      t51 = t47*t50
      t53 = 1.D0+t42+0.4675158550002605D-1*t51
      t54 = 1/t53
      t55 = t43*t54
      t58 = 1.D0+0.2162211495206379D0*t35*t55
      t59 = dlog(t58)
      t60 = 0.1554534543482745D-1*t59
      zk(i) = -0.9305257363491D0*t3*t12+rhoa*(-t32+t60)
      t69 = 1/t2/t4/rhoa
      t75 = 1/t5/t48/rhoa
      t77 = t39*t54
      t80 = t53**2
      t82 = t43/t80
      t93 = 1/t58
      t97 = 1/t4
      t98 = 1/t24*t97
      t99 = t98*t30
      t101 = t26**2
      t104 = t19**2
      t105 = t104**2
      t120 = t18/t101*(-0.1853395810515781D1/t105/t19*t97
     #-0.128158207914907D1*t98-0.8223668877838045D0/t22*t97
     #-0.1603914194192128D0/t16*t97)/t29
      t124 = -0.8497977086918237D-1*t99-0.6432793688582964D2*t120
      t129 = t45*sigmaaa
      vrhoa(i) = -0.12407009817988D1*t2*t12+0.8963286558970112D-2*t35
     #*t10-t32+t60+0.1554534543482745D-1*rhoa*(-0.5045160155481551D0
     #*sigmaaa*t69*t55-0.1090870328333941D0*t46*t75*t77
     #-0.2162211495206379D0*t35*t82*(-0.5045160155481551D0*t40*t69
     #-0.2181740656667882D0*t47*t75))*t93+rhoa*(0.1321039893133927D-2
     #*t99+0.1D1*t120+0.1554534543482745D-1*(-0.4675158550002605D-1
     #*t51*t124*t37*t54-0.2162211495206379D0*t35*t82*(
     #-0.2162211495206379D0*t129*t34*t124*t37-0.935031710000521D-1/t44
     #/t38*t46*t50*t124*t37))*t93)
      vrhob(i) = 0.D0
      vsigmaaa(i) = -0.3361232459613792D-2/t3*t10
     #+0.1554534543482745D-1*rhoa*(0.2162211495206379D0*t34*t43*t54
     #+0.4675158550002605D-1*sigmaaa*t50*t77-0.2162211495206379D0*t35
     #*t82*(0.2162211495206379D0*t39*t34+0.935031710000521D-1*t129*t50
     #))*t93
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t5 = t4*rhoa
      t6 = rhoa**2
      t7 = t4**2
      t12 = dexp(-0.449276922095889D-2*sigmaaa/t7/t6)
      t14 = 0.1804D1-0.804D0*t12
      t17 = rhob**(1.D0/3.D0)
      t18 = t17*rhob
      t19 = rhob**2
      t20 = t17**2
      t25 = dexp(-0.449276922095889D-2*sigmabb/t20/t19)
      t27 = 0.1804D1-0.804D0*t25
      t30 = 1/rho
      t31 = t30**(1.D0/3.D0)
      t33 = 1.D0+0.1325688999052018D0*t31
      t34 = t30**(1.D0/6.D0)
      t37 = dsqrt(t30)
      t39 = t31**2
      t41 = 0.598255043577108D1*t34+0.2225569421150687D1*t31
     #+0.8004286349993634D0*t37+0.1897004325747559D0*t39
      t44 = 1.D0+0.1608197949869254D2/t41
      t45 = dlog(t44)
      t47 = 0.621814D-1*t33*t45
      t49 = 1.D0+0.6901399211255825D-1*t31
      t54 = 0.8157414703487641D1*t34+0.2247591863577616D1*t31
     #+0.4300972471276643D0*t37+0.1911512595127338D0*t39
      t57 = 1.D0+0.2960874997779344D2/t54
      t58 = dlog(t57)
      t59 = t49*t58
      t61 = rhoa-1.D0*rhob
      t62 = t61*t30
      t63 = 1.D0+t62
      t64 = t63**(1.D0/3.D0)
      t67 = 1.D0-1.D0*t62
      t68 = t67**(1.D0/3.D0)
      t70 = t64*t63+t68*t67-2.D0
      t71 = t61**2
      t72 = t71**2
      t73 = rho**2
      t74 = t73**2
      t75 = 1/t74
      t76 = t72*t75
      t78 = 1.D0-1.D0*t76
      t81 = 0.37995525D-1*t59*t70*t78
      t83 = 1.D0+0.1274696188700087D0*t31
      t88 = 0.1112037486309468D2*t34+0.3844746237447211D1*t31
     #+0.1644733775567609D1*t37+0.2405871291288192D0*t39
      t91 = 1.D0+0.3216395899738507D2/t88
      t92 = dlog(t91)
      t95 = -0.310907D-1*t83*t92+t47
      t96 = t95*t70
      t98 = 0.1923661050931536D1*t96*t76
      t99 = t64**2
      t101 = t68**2
      t103 = 0.5D0*t99+0.5D0*t101
      t104 = t103**2
      t105 = t104*t103
      t106 = 1/t104
      t107 = sigma*t106
      t108 = rho**(1.D0/3.D0)
      t110 = 1/t108/t73
      t111 = -t47+t81+t98
      t112 = 1/t105
      t115 = dexp(-0.3216396844291482D2*t111*t112)
      t116 = t115-1.D0
      t117 = 1/t116
      t118 = t117*sigma
      t119 = t106*t110
      t121 = 0.1362107888567592D0*t118*t119
      t122 = 1.D0+t121
      t124 = t116**2
      t125 = 1/t124
      t126 = sigma**2
      t127 = t125*t126
      t128 = t104**2
      t129 = 1/t128
      t130 = t108**2
      t132 = 1/t130/t74
      t133 = t129*t132
      t136 = 1.D0+t121+0.1855337900098064D-1*t127*t133
      t137 = 1/t136
      t141 = 1.D0+0.1362107888567592D0*t107*t110*t122*t137
      t142 = dlog(t141)
      t144 = 0.310906908696549D-1*t105*t142
      zk(i) = -0.9305257363491D0*t5*t14-0.9305257363491D0*t18*t27+rho*
     #(-t47+t81+t98+t144)
      t158 = 0.1333333333333333D1*t64*t30-0.1333333333333333D1*t68*t30
      t161 = 0.37995525D-1*t59*t158*t78
      t162 = t71*t61
      t165 = t59*t70*t162*t75
      t166 = 0.1519821D0*t165
      t169 = 0.1923661050931536D1*t95*t158*t76
      t171 = t96*t162*t75
      t172 = 0.7694644203726145D1*t171
      t173 = t104*t142
      t174 = 1/t64
      t177 = 1/t68
      t180 = 0.3333333333333333D0*t174*t30-0.3333333333333333D0*t177*t30
      t184 = sigma*t112*t110
      t185 = t122*t137
      t189 = t125*sigma
      t190 = t189*t106
      t194 = t111*t129
      t197 = -0.3216396844291482D2*(t161-t166+t169+t172)*t112
     #+0.9649190532874446D2*t194*t180
      t201 = 0.1362107888567592D0*t190*t110*t197*t115
      t202 = t112*t110
      t205 = 0.2724215777135184D0*t118*t202*t180
      t211 = t107*t110
      t212 = t136**2
      t214 = t122/t212
      t218 = 1/t124/t116*t126*t129
      t225 = 1/t128/t103*t132
      t235 = 1/t141
      t241 = 1/t73
      t242 = 1/t39*t241
      t243 = t242*t45
      t244 = 0.2747773264188438D-2*t243
      t245 = t41**2
      t248 = t34**2
      t249 = t248**2
      t252 = 1/t249/t34*t241
      t256 = 1/t37*t241
      t259 = 1/t31*t241
      t264 = t33/t245*(-0.99709173929518D0*t252-0.7418564737168958D0
     #*t242-0.4002143174996817D0*t256-0.1264669550498372D0*t259)/t44
      t265 = 0.1D1*t264
      t269 = 0.87407428755417D-3*t242*t58*t70*t78
      t270 = t54**2
      t283 = 0.1125D1*t49/t270*(-0.135956911724794D1*t252
     #-0.7491972878592054D0*t242-0.2150486235638321D0*t256
     #-0.1274341730084892D0*t259)/t57*t70*t78
      t290 = -0.1333333333333333D1*t64*t61*t241+0.1333333333333333D1
     #*t68*t61*t241
      t293 = 0.37995525D-1*t59*t290*t78
      t295 = t74*rho
      t296 = 1/t295
      t299 = 0.1519821D0*t59*t70*t72*t296
      t302 = t88**2
      t319 = 0.1923661050931536D1*(0.1321039893133927D-2*t242*t92
     #+0.1D1*t83/t302*(-0.1853395810515781D1*t252-0.128158207914907D1
     #*t242-0.8223668877838045D0*t256-0.1603914194192128D0*t259)/t91
     #-0.2747773264188438D-2*t243-0.1D1*t264)*t70*t76
      t322 = 0.1923661050931536D1*t95*t290*t76
      t325 = 0.7694644203726145D1*t96*t72*t296
      t332 = -0.3333333333333333D0*t174*t61*t241+0.3333333333333333D0
     #*t177*t61*t241
      t340 = 1/t108/t73/rho
      t350 = -0.3216396844291482D2*(t244+t265-t269-t283+t293+t299+t319
     #+t322-t325)*t112+0.9649190532874446D2*t194*t332
      t354 = 0.1362107888567592D0*t190*t110*t350*t115
      t357 = 0.2724215777135184D0*t118*t202*t332
      t360 = 0.3178251739991049D0*t118*t106*t340
      t386 = t244+t265-t269-t283+t293+t299+t319+t322-t325
     #+0.9327207260896469D-1*t173*t332+0.310906908696549D-1*t105*(
     #-0.2724215777135184D0*t184*t185*t332-0.3178251739991049D0*t107
     #*t340*t122*t137+0.1362107888567592D0*t107*t110*(-t354-t357-t360)
     #*t137-0.1362107888567592D0*t211*t214*(-t354-t357-t360
     #-0.3710675800196129D-1*t218*t132*t350*t115-0.7421351600392257D-1
     #*t127*t225*t332-0.8658243533790967D-1*t127*t129/t130/t295))*t235
      t387 = rho*t386
      vrhoa(i) = -0.12407009817988D1*t4*t14+0.8963286558970112D-2/t4
     #/t6*sigmaaa*t12+rho*(t161-t166+t169+t172+0.9327207260896469D-1
     #*t173*t180+0.310906908696549D-1*t105*(-0.2724215777135184D0*t184
     #*t185*t180+0.1362107888567592D0*t107*t110*(-t201-t205)*t137
     #-0.1362107888567592D0*t211*t214*(-t201-t205
     #-0.3710675800196129D-1*t218*t132*t197*t115-0.7421351600392257D-1
     #*t127*t225*t180))*t235)-t47+t81+t98+t144+t387
      t395 = -t158
      t398 = 0.37995525D-1*t59*t395*t78
      t399 = 0.1519821D0*t165
      t402 = 0.1923661050931536D1*t95*t395*t76
      t403 = 0.7694644203726145D1*t171
      t404 = -t180
      t415 = -0.3216396844291482D2*(t398+t399+t402-t403)*t112
     #+0.9649190532874446D2*t194*t404
      t419 = 0.1362107888567592D0*t190*t110*t415*t115
      t422 = 0.2724215777135184D0*t118*t202*t404
      vrhob(i) = -0.12407009817988D1*t17*t27+0.8963286558970112D-2/t17
     #/t19*sigmabb*t25+rho*(t398+t399+t402-t403+0.9327207260896469D-1
     #*t173*t404+0.310906908696549D-1*t105*(-0.2724215777135184D0*t184
     #*t185*t404+0.1362107888567592D0*t107*t110*(-t419-t422)*t137
     #-0.1362107888567592D0*t211*t214*(-t419-t422
     #-0.3710675800196129D-1*t218*t132*t415*t115-0.7421351600392257D-1
     #*t127*t225*t404))*t235)-t47+t81+t98+t144+t387
      t467 = rho*t105*(0.1362107888567592D0*t119*t185
     #+0.1855337900098064D-1*sigma*t129*t132*t117*t137
     #-0.1362107888567592D0*t211*t214*(0.1362107888567592D0*t117*t106
     #*t110+0.3710675800196129D-1*t189*t133))*t235
      t468 = 0.310906908696549D-1*t467
      vsigmaaa(i) = -0.3361232459613792D-2/t5*t12+t468
      vsigmaab(i) = 0.6218138173930979D-1*t467
      vsigmabb(i) = -0.3361232459613792D-2/t18*t25+t468
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t3 = t2*rhob
      t4 = rhob**2
      t5 = t2**2
      t10 = dexp(-0.449276922095889D-2*sigmabb/t5/t4)
      t12 = 0.1804D1-0.804D0*t10
      t15 = 1/rhob
      t16 = t15**(1.D0/3.D0)
      t18 = 1.D0+0.1274696188700087D0*t16
      t19 = t15**(1.D0/6.D0)
      t22 = dsqrt(t15)
      t24 = t16**2
      t26 = 0.1112037486309468D2*t19+0.3844746237447211D1*t16
     #+0.1644733775567609D1*t22+0.2405871291288192D0*t24
      t29 = 1.D0+0.3216395899738507D2/t26
      t30 = dlog(t29)
      t31 = t18*t30
      t32 = 0.310907D-1*t31
      t34 = 1/t2/t4
      t35 = sigmabb*t34
      t37 = dexp(0.2000000587336264D1*t31)
      t38 = t37-1.D0
      t39 = 1/t38
      t40 = t39*sigmabb
      t42 = 0.2162211495206379D0*t40*t34
      t43 = 1.D0+t42
      t44 = t38**2
      t45 = 1/t44
      t46 = sigmabb**2
      t47 = t45*t46
      t48 = t4**2
      t50 = 1/t5/t48
      t51 = t47*t50
      t53 = 1.D0+t42+0.4675158550002605D-1*t51
      t54 = 1/t53
      t55 = t43*t54
      t58 = 1.D0+0.2162211495206379D0*t35*t55
      t59 = dlog(t58)
      t60 = 0.1554534543482745D-1*t59
      zk(i) = -0.9305257363491D0*t3*t12+rhob*(-t32+t60)
      vrhoa(i) = 0.D0
      t67 = t4*rhob
      t69 = 1/t2/t67
      t70 = sigmabb*t69
      t75 = 1/t5/t48/rhob
      t76 = t46*t75
      t77 = t39*t54
      t80 = t53**2
      t81 = 1/t80
      t82 = t43*t81
      t85 = t47*t75
      t87 = -0.5045160155481551D0*t40*t69-0.2181740656667882D0*t85
      t88 = t82*t87
      t91 = -0.5045160155481551D0*t70*t55-0.1090870328333941D0*t76*t77
     #-0.2162211495206379D0*t35*t88
      t92 = rhob*t91
      t93 = 1/t58
      t96 = 1/t24
      t97 = 1/t4
      t98 = t96*t97
      t99 = t98*t30
      t101 = t26**2
      t102 = 1/t101
      t103 = t18*t102
      t104 = t19**2
      t105 = t104**2
      t106 = t105*t19
      t107 = 1/t106
      t111 = 1/t22
      t114 = 1/t16
      t117 = -0.1853395810515781D1*t107*t97-0.128158207914907D1*t98
     #-0.8223668877838045D0*t111*t97-0.1603914194192128D0*t114*t97
      t118 = 1/t29
      t120 = t103*t117*t118
      t124 = -0.8497977086918237D-1*t99-0.6432793688582964D2*t120
      t125 = t124*t37
      t126 = t125*t54
      t129 = t45*sigmabb
      t135 = 1/t44/t38
      t136 = t135*t46
      t141 = -0.2162211495206379D0*t129*t34*t124*t37
     #-0.935031710000521D-1*t136*t50*t124*t37
      t142 = t82*t141
      t145 = -0.4675158550002605D-1*t51*t126-0.2162211495206379D0*t35
     #*t142
      t146 = t145*t93
      vrhob(i) = -0.12407009817988D1*t2*t12+0.8963286558970112D-2*t35
     #*t10-t32+t60+0.1554534543482745D-1*t92*t93+rhob*
     #(0.1321039893133927D-2*t99+0.1D1*t120+0.1554534543482745D-1*t146)
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      t153 = t34*t43
      t156 = sigmabb*t50
      t163 = 0.2162211495206379D0*t39*t34+0.935031710000521D-1*t129*t50
      t167 = 0.2162211495206379D0*t153*t54+0.4675158550002605D-1*t156
     #*t77-0.2162211495206379D0*t35*t82*t163
      vsigmabb(i) = -0.3361232459613792D-2/t3*t10
     #+0.1554534543482745D-1*rhob*t167*t93
      v2rhoa2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t176 = t48*t4
      t184 = 1/t2/t48
      t189 = 1/t5/t176
      t195 = t39*t81
      t200 = 1/t80/t53
      t201 = t43*t200
      t202 = t87**2
      t218 = t91**2
      t220 = t58**2
      t221 = 1/t220
      t227 = t85*t126
      t232 = 0.4675158550002605D-1*t51*t125*t81*t87
      t234 = 0.5045160155481551D0*t70*t142
      t237 = 0.1090870328333941D0*t76*t195*t141
      t242 = 0.4324422990412758D0*t35*t43*t200*t141*t87
      t254 = 0.2162211495206379D0*t35*t82*(0.5045160155481551D0*t129
     #*t69*t124*t37+0.4363481313335765D0*t136*t75*t124*t37)
      t258 = t145*t221
      t272 = 1/t48
      t273 = 1/t24/t15*t272
      t274 = t273*t30
      t276 = 1/t67
      t277 = t96*t276
      t278 = t277*t30
      t282 = t98*t102*t117*t118
      t287 = t117**2
      t289 = t18/t101/t26*t287*t118
      t313 = t103*(-0.1544496508763151D1/t106/t15*t272
     #+0.3706791621031562D1*t107*t276-0.854388052766047D0*t273
     #+0.2563164158298141D1*t277-0.4111834438919023D0/t22/t15*t272
     #+0.1644733775567609D1*t111*t276-0.5346380647307093D-1/t16/t15
     #*t272+0.3207828388384256D0*t114*t276)*t118
      t315 = t101**2
      t318 = t29**2
      t321 = t18/t315*t287/t318
      t325 = t124**2
      t327 = dexp(0.4000001174672527D1*t31)
      t338 = -0.5665318057945491D-1*t274+0.1699595417383647D0*t278
     #+0.546657173168712D1*t282+0.1286558737716593D3*t289
     #-0.6432793688582964D2*t313-0.2069041124382199D4*t321
      t351 = t141**2
      t356 = t34*t325
      t367 = t44**2
      t370 = t50*t325
      t388 = t145**2
      s1 = -0.4135669939329333D0/t5*t12-0.8963286558970112D-2*t70*t10
     #+0.1073866079220678D-3/t176*t46*t10+0.310906908696549D-1*t91*t93
     #+0.1554534543482745D-1*rhob*(0.1681720051827184D1*sigmabb*t184
     #*t55+0.8726962626671529D0*t46*t189*t77+0.100903203109631D1*t70
     #*t88+0.2181740656667882D0*t76*t195*t87+0.4324422990412758D0*t35
     #*t201*t202-0.2162211495206379D0*t35*t82*(0.1681720051827184D1
     #*t40*t184+0.1236319705445133D1*t47*t189))*t93
     #-0.1554534543482745D-1*rhob*t218*t221
      s2 = s1+0.2642079786267853D-2*t99+0.2D1*t120
     #+0.310906908696549D-1*t146
      s3 = s2+rhob*(0.1554534543482745D-1*(0.2181740656667882D0*t227
     #+t232+t234+t237+t242-t254)*t93-0.1554534543482745D-1*t258*t91)
      s4 = s3+0.1554534543482745D-1*rhob*(0.2181740656667882D0*t227
     #+t234+t237+t232+t242-t254)*t93
      v2rhob2(i) = s4-0.1554534543482745D-1*t92*t258+rhob*
     #(0.8806932620892844D-3*t274-0.2642079786267853D-2*t278
     #-0.8497974591333914D-1*t282-0.2D1*t289+0.1D1*t313
     #+0.3216395899738507D2*t321+0.1554534543482745D-1*
     #(0.935031710000521D-1*t46*t50*t135*t325*t327*t54
     #-0.4675158550002605D-1*t51*t338*t37*t54-0.4675158550002605D-1
     #*t51*t325*t37*t54+0.935031710000521D-1*t51*t125*t81*t141
     #+0.4324422990412758D0*t35*t201*t351-0.2162211495206379D0*t35*t82
     #*(0.4324422990412758D0*t135*sigmabb*t356*t327
     #-0.2162211495206379D0*t129*t34*t338*t37-0.2162211495206379D0
     #*t129*t356*t37+0.2805095130001563D0/t367*t46*t370*t327
     #-0.935031710000521D-1*t136*t50*t338*t37-0.935031710000521D-1
     #*t136*t370*t37))*t93-0.1554534543482745D-1*t388*t221)
      v2sigmaaa2(i) = 0.D0
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      t404 = t163**2
      t418 = t167**2
      v2sigmabb2(i) = 0.1510124173904079D-4*t272*t10
     #+0.1554534543482745D-1*rhob*(0.935031710000521D-1*t50*t39*t54
     #-0.4324422990412758D0*t153*t81*t163-0.935031710000521D-1*t156
     #*t195*t163+0.4324422990412758D0*t35*t201*t404
     #-0.2021736311745604D-1*sigmabb/t48/t67*t82*t45)*t93
     #-0.1554534543482745D-1*rhob*t418*t221
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t3 = t2*rhoa
      t4 = rhoa**2
      t5 = t2**2
      t10 = dexp(-0.449276922095889D-2*sigmaaa/t5/t4)
      t12 = 0.1804D1-0.804D0*t10
      t15 = 1/rhoa
      t16 = t15**(1.D0/3.D0)
      t18 = 1.D0+0.1274696188700087D0*t16
      t19 = t15**(1.D0/6.D0)
      t22 = dsqrt(t15)
      t24 = t16**2
      t26 = 0.1112037486309468D2*t19+0.3844746237447211D1*t16
     #+0.1644733775567609D1*t22+0.2405871291288192D0*t24
      t29 = 1.D0+0.3216395899738507D2/t26
      t30 = dlog(t29)
      t31 = t18*t30
      t32 = 0.310907D-1*t31
      t34 = 1/t2/t4
      t35 = sigmaaa*t34
      t37 = dexp(0.2000000587336264D1*t31)
      t38 = t37-1.D0
      t39 = 1/t38
      t40 = t39*sigmaaa
      t42 = 0.2162211495206379D0*t40*t34
      t43 = 1.D0+t42
      t44 = t38**2
      t45 = 1/t44
      t46 = sigmaaa**2
      t47 = t45*t46
      t48 = t4**2
      t50 = 1/t5/t48
      t51 = t47*t50
      t53 = 1.D0+t42+0.4675158550002605D-1*t51
      t54 = 1/t53
      t55 = t43*t54
      t58 = 1.D0+0.2162211495206379D0*t35*t55
      t59 = dlog(t58)
      t60 = 0.1554534543482745D-1*t59
      zk(i) = -0.9305257363491D0*t3*t12+rhoa*(-t32+t60)
      t67 = t4*rhoa
      t69 = 1/t2/t67
      t70 = sigmaaa*t69
      t75 = 1/t5/t48/rhoa
      t76 = t46*t75
      t77 = t39*t54
      t80 = t53**2
      t81 = 1/t80
      t82 = t43*t81
      t85 = t47*t75
      t87 = -0.5045160155481551D0*t40*t69-0.2181740656667882D0*t85
      t88 = t82*t87
      t91 = -0.5045160155481551D0*t70*t55-0.1090870328333941D0*t76*t77
     #-0.2162211495206379D0*t35*t88
      t92 = rhoa*t91
      t93 = 1/t58
      t96 = 1/t24
      t97 = 1/t4
      t98 = t96*t97
      t99 = t98*t30
      t101 = t26**2
      t102 = 1/t101
      t103 = t18*t102
      t104 = t19**2
      t105 = t104**2
      t106 = t105*t19
      t107 = 1/t106
      t111 = 1/t22
      t114 = 1/t16
      t117 = -0.1853395810515781D1*t107*t97-0.128158207914907D1*t98
     #-0.8223668877838045D0*t111*t97-0.1603914194192128D0*t114*t97
      t118 = 1/t29
      t120 = t103*t117*t118
      t124 = -0.8497977086918237D-1*t99-0.6432793688582964D2*t120
      t125 = t124*t37
      t126 = t125*t54
      t129 = t45*sigmaaa
      t135 = 1/t44/t38
      t136 = t135*t46
      t141 = -0.2162211495206379D0*t129*t34*t124*t37
     #-0.935031710000521D-1*t136*t50*t124*t37
      t142 = t82*t141
      t145 = -0.4675158550002605D-1*t51*t126-0.2162211495206379D0*t35
     #*t142
      t146 = t145*t93
      vrhoa(i) = -0.12407009817988D1*t2*t12+0.8963286558970112D-2*t35
     #*t10-t32+t60+0.1554534543482745D-1*t92*t93+rhoa*
     #(0.1321039893133927D-2*t99+0.1D1*t120+0.1554534543482745D-1*t146)
      vrhob(i) = 0.D0
      t153 = t34*t43
      t156 = sigmaaa*t50
      t163 = 0.2162211495206379D0*t39*t34+0.935031710000521D-1*t129*t50
      t167 = 0.2162211495206379D0*t153*t54+0.4675158550002605D-1*t156
     #*t77-0.2162211495206379D0*t35*t82*t163
      vsigmaaa(i) = -0.3361232459613792D-2/t3*t10
     #+0.1554534543482745D-1*rhoa*t167*t93
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      t176 = t48*t4
      t184 = 1/t2/t48
      t189 = 1/t5/t176
      t195 = t39*t81
      t200 = 1/t80/t53
      t201 = t43*t200
      t202 = t87**2
      t218 = t91**2
      t220 = t58**2
      t221 = 1/t220
      t227 = t85*t126
      t232 = 0.4675158550002605D-1*t51*t125*t81*t87
      t234 = 0.5045160155481551D0*t70*t142
      t237 = 0.1090870328333941D0*t76*t195*t141
      t242 = 0.4324422990412758D0*t35*t43*t200*t141*t87
      t254 = 0.2162211495206379D0*t35*t82*(0.5045160155481551D0*t129
     #*t69*t124*t37+0.4363481313335765D0*t136*t75*t124*t37)
      t258 = t145*t221
      t272 = 1/t48
      t273 = 1/t24/t15*t272
      t274 = t273*t30
      t276 = 1/t67
      t277 = t96*t276
      t278 = t277*t30
      t282 = t98*t102*t117*t118
      t287 = t117**2
      t289 = t18/t101/t26*t287*t118
      t313 = t103*(-0.1544496508763151D1/t106/t15*t272
     #+0.3706791621031562D1*t107*t276-0.854388052766047D0*t273
     #+0.2563164158298141D1*t277-0.4111834438919023D0/t22/t15*t272
     #+0.1644733775567609D1*t111*t276-0.5346380647307093D-1/t16/t15
     #*t272+0.3207828388384256D0*t114*t276)*t118
      t315 = t101**2
      t318 = t29**2
      t321 = t18/t315*t287/t318
      t325 = t124**2
      t327 = dexp(0.4000001174672527D1*t31)
      t338 = -0.5665318057945491D-1*t274+0.1699595417383647D0*t278
     #+0.546657173168712D1*t282+0.1286558737716593D3*t289
     #-0.6432793688582964D2*t313-0.2069041124382199D4*t321
      t351 = t141**2
      t356 = t34*t325
      t367 = t44**2
      t370 = t50*t325
      t388 = t145**2
      s1 = -0.4135669939329333D0/t5*t12-0.8963286558970112D-2*t70*t10
     #+0.1073866079220678D-3/t176*t46*t10+0.310906908696549D-1*t91*t93
     #+0.1554534543482745D-1*rhoa*(0.1681720051827184D1*sigmaaa*t184
     #*t55+0.8726962626671529D0*t46*t189*t77+0.100903203109631D1*t70
     #*t88+0.2181740656667882D0*t76*t195*t87+0.4324422990412758D0*t35
     #*t201*t202-0.2162211495206379D0*t35*t82*(0.1681720051827184D1
     #*t40*t184+0.1236319705445133D1*t47*t189))*t93
     #-0.1554534543482745D-1*rhoa*t218*t221
      s2 = s1+0.2642079786267853D-2*t99+0.2D1*t120
     #+0.310906908696549D-1*t146
      s3 = s2+rhoa*(0.1554534543482745D-1*(0.2181740656667882D0*t227
     #+t232+t234+t237+t242-t254)*t93-0.1554534543482745D-1*t258*t91)
      s4 = s3+0.1554534543482745D-1*rhoa*(0.2181740656667882D0*t227
     #+t234+t237+t232+t242-t254)*t93
      v2rhoa2(i) = s4-0.1554534543482745D-1*t92*t258+rhoa*
     #(0.8806932620892844D-3*t274-0.2642079786267853D-2*t278
     #-0.8497974591333914D-1*t282-0.2D1*t289+0.1D1*t313
     #+0.3216395899738507D2*t321+0.1554534543482745D-1*
     #(0.935031710000521D-1*t46*t50*t135*t325*t327*t54
     #-0.4675158550002605D-1*t51*t338*t37*t54-0.4675158550002605D-1
     #*t51*t325*t37*t54+0.935031710000521D-1*t51*t125*t81*t141
     #+0.4324422990412758D0*t35*t201*t351-0.2162211495206379D0*t35*t82
     #*(0.4324422990412758D0*t135*sigmaaa*t356*t327
     #-0.2162211495206379D0*t129*t34*t338*t37-0.2162211495206379D0
     #*t129*t356*t37+0.2805095130001563D0/t367*t46*t370*t327
     #-0.935031710000521D-1*t136*t50*t338*t37-0.935031710000521D-1
     #*t136*t370*t37))*t93-0.1554534543482745D-1*t388*t221)
      v2rhob2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t404 = t163**2
      t418 = t167**2
      v2sigmaaa2(i) = 0.1510124173904079D-4*t272*t10
     #+0.1554534543482745D-1*rhoa*(0.935031710000521D-1*t50*t39*t54
     #-0.4324422990412758D0*t153*t81*t163-0.935031710000521D-1*t156
     #*t195*t163+0.4324422990412758D0*t35*t201*t404
     #-0.2021736311745604D-1*sigmaaa/t48/t67*t82*t45)*t93
     #-0.1554534543482745D-1*rhoa*t418*t221
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      v2sigmabb2(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t5 = t4*rhoa
      t6 = rhoa**2
      t7 = t4**2
      t12 = dexp(-0.449276922095889D-2*sigmaaa/t7/t6)
      t14 = 0.1804D1-0.804D0*t12
      t17 = rhob**(1.D0/3.D0)
      t18 = t17*rhob
      t19 = rhob**2
      t20 = t17**2
      t25 = dexp(-0.449276922095889D-2*sigmabb/t20/t19)
      t27 = 0.1804D1-0.804D0*t25
      t30 = 1/rho
      t31 = t30**(1.D0/3.D0)
      t33 = 1.D0+0.1325688999052018D0*t31
      t34 = t30**(1.D0/6.D0)
      t37 = dsqrt(t30)
      t39 = t31**2
      t41 = 0.598255043577108D1*t34+0.2225569421150687D1*t31
     #+0.8004286349993634D0*t37+0.1897004325747559D0*t39
      t44 = 1.D0+0.1608197949869254D2/t41
      t45 = dlog(t44)
      t47 = 0.621814D-1*t33*t45
      t49 = 1.D0+0.6901399211255825D-1*t31
      t54 = 0.8157414703487641D1*t34+0.2247591863577616D1*t31
     #+0.4300972471276643D0*t37+0.1911512595127338D0*t39
      t57 = 1.D0+0.2960874997779344D2/t54
      t58 = dlog(t57)
      t59 = t49*t58
      t61 = rhoa-1.D0*rhob
      t62 = t61*t30
      t63 = 1.D0+t62
      t64 = t63**(1.D0/3.D0)
      t65 = t64*t63
      t67 = 1.D0-1.D0*t62
      t68 = t67**(1.D0/3.D0)
      t69 = t68*t67
      t70 = t65+t69-2.D0
      t71 = t61**2
      t72 = t71**2
      t73 = rho**2
      t74 = t73**2
      t75 = 1/t74
      t76 = t72*t75
      t78 = 1.D0-1.D0*t76
      t79 = t70*t78
      t81 = 0.37995525D-1*t59*t79
      t83 = 1.D0+0.1274696188700087D0*t31
      t88 = 0.1112037486309468D2*t34+0.3844746237447211D1*t31
     #+0.1644733775567609D1*t37+0.2405871291288192D0*t39
      t91 = 1.D0+0.3216395899738507D2/t88
      t92 = dlog(t91)
      t95 = -0.310907D-1*t83*t92+t47
      t96 = t95*t70
      t98 = 0.1923661050931536D1*t96*t76
      t99 = t64**2
      t101 = t68**2
      t103 = 0.5D0*t99+0.5D0*t101
      t104 = t103**2
      t105 = t104*t103
      t106 = 1/t104
      t107 = sigma*t106
      t108 = rho**(1.D0/3.D0)
      t110 = 1/t108/t73
      t111 = -t47+t81+t98
      t112 = 1/t105
      t113 = t111*t112
      t115 = dexp(-0.3216396844291482D2*t113)
      t116 = t115-1.D0
      t117 = 1/t116
      t118 = t117*sigma
      t119 = t106*t110
      t121 = 0.1362107888567592D0*t118*t119
      t122 = 1.D0+t121
      t124 = t116**2
      t125 = 1/t124
      t126 = sigma**2
      t127 = t125*t126
      t128 = t104**2
      t129 = 1/t128
      t130 = t108**2
      t132 = 1/t130/t74
      t133 = t129*t132
      t136 = 1.D0+t121+0.1855337900098064D-1*t127*t133
      t137 = 1/t136
      t141 = 1.D0+0.1362107888567592D0*t107*t110*t122*t137
      t142 = dlog(t141)
      t144 = 0.310906908696549D-1*t105*t142
      zk(i) = -0.9305257363491D0*t5*t14-0.9305257363491D0*t18*t27+rho*
     #(-t47+t81+t98+t144)
      t150 = 1/t4/t6
      t158 = 0.1333333333333333D1*t64*t30-0.1333333333333333D1*t68*t30
      t160 = t59*t158*t78
      t161 = 0.37995525D-1*t160
      t162 = t71*t61
      t163 = t70*t162
      t165 = t59*t163*t75
      t166 = 0.1519821D0*t165
      t167 = t95*t158
      t168 = t167*t76
      t169 = 0.1923661050931536D1*t168
      t170 = t162*t75
      t171 = t96*t170
      t172 = 0.7694644203726145D1*t171
      t173 = t104*t142
      t174 = 1/t64
      t177 = 1/t68
      t180 = 0.3333333333333333D0*t174*t30-0.3333333333333333D0*t177*t30
      t181 = t173*t180
      t182 = 0.9327207260896469D-1*t181
      t183 = sigma*t112
      t184 = t183*t110
      t185 = t122*t137
      t186 = t185*t180
      t189 = t125*sigma
      t190 = t189*t106
      t191 = t161-t166+t169+t172
      t194 = t111*t129
      t197 = -0.3216396844291482D2*t191*t112+0.9649190532874446D2*t194
     #*t180
      t198 = t110*t197
      t199 = t198*t115
      t201 = 0.1362107888567592D0*t190*t199
      t202 = t112*t110
      t205 = 0.2724215777135184D0*t118*t202*t180
      t206 = -t201-t205
      t211 = t107*t110
      t212 = t136**2
      t213 = 1/t212
      t214 = t122*t213
      t216 = 1/t124/t116
      t217 = t216*t126
      t218 = t217*t129
      t219 = t132*t197
      t220 = t219*t115
      t224 = 1/t128/t103
      t225 = t224*t132
      t226 = t225*t180
      t229 = -t201-t205-0.3710675800196129D-1*t218*t220
     #-0.7421351600392257D-1*t127*t226
      t230 = t214*t229
      t233 = -0.2724215777135184D0*t184*t186+0.1362107888567592D0*t107
     #*t110*t206*t137-0.1362107888567592D0*t211*t230
      t234 = t105*t233
      t235 = 1/t141
      t236 = t234*t235
      t237 = 0.310906908696549D-1*t236
      t240 = 1/t39
      t241 = 1/t73
      t242 = t240*t241
      t243 = t242*t45
      t244 = 0.2747773264188438D-2*t243
      t245 = t41**2
      t246 = 1/t245
      t247 = t33*t246
      t248 = t34**2
      t249 = t248**2
      t250 = t249*t34
      t251 = 1/t250
      t252 = t251*t241
      t255 = 1/t37
      t256 = t255*t241
      t258 = 1/t31
      t259 = t258*t241
      t261 = -0.99709173929518D0*t252-0.7418564737168958D0*t242
     #-0.4002143174996817D0*t256-0.1264669550498372D0*t259
      t262 = 1/t44
      t264 = t247*t261*t262
      t265 = 0.1D1*t264
      t266 = t58*t70
      t267 = t266*t78
      t268 = t242*t267
      t269 = 0.87407428755417D-3*t268
      t270 = t54**2
      t271 = 1/t270
      t272 = t49*t271
      t277 = -0.135956911724794D1*t252-0.7491972878592054D0*t242
     #-0.2150486235638321D0*t256-0.1274341730084892D0*t259
      t278 = t272*t277
      t279 = 1/t57
      t280 = t279*t70
      t281 = t280*t78
      t282 = t278*t281
      t283 = 0.1125D1*t282
      t284 = t64*t61
      t287 = t68*t61
      t290 = -0.1333333333333333D1*t284*t241+0.1333333333333333D1*t287
     #*t241
      t292 = t59*t290*t78
      t293 = 0.37995525D-1*t292
      t294 = t70*t72
      t295 = t74*rho
      t296 = 1/t295
      t298 = t59*t294*t296
      t299 = 0.1519821D0*t298
      t302 = t88**2
      t303 = 1/t302
      t304 = t83*t303
      t309 = -0.1853395810515781D1*t252-0.128158207914907D1*t242
     #-0.8223668877838045D0*t256-0.1603914194192128D0*t259
      t310 = 1/t91
      t316 = 0.1321039893133927D-2*t242*t92+0.1D1*t304*t309*t310
     #-0.2747773264188438D-2*t243-0.1D1*t264
      t317 = t316*t70
      t318 = t317*t76
      t319 = 0.1923661050931536D1*t318
      t320 = t95*t290
      t321 = t320*t76
      t322 = 0.1923661050931536D1*t321
      t323 = t72*t296
      t324 = t96*t323
      t325 = 0.7694644203726145D1*t324
      t326 = t174*t61
      t329 = t177*t61
      t332 = -0.3333333333333333D0*t326*t241+0.3333333333333333D0*t329
     #*t241
      t333 = t173*t332
      t335 = t185*t332
      t338 = t73*rho
      t340 = 1/t108/t338
      t345 = t244+t265-t269-t283+t293+t299+t319+t322-t325
      t350 = -0.3216396844291482D2*t345*t112+0.9649190532874446D2*t194
     #*t332
      t351 = t110*t350
      t352 = t351*t115
      t354 = 0.1362107888567592D0*t190*t352
      t357 = 0.2724215777135184D0*t118*t202*t332
      t358 = t106*t340
      t360 = 0.3178251739991049D0*t118*t358
      t361 = -t354-t357-t360
      t366 = t132*t350
      t367 = t366*t115
      t370 = t225*t332
      t374 = 1/t130/t295
      t375 = t129*t374
      t378 = -t354-t357-t360-0.3710675800196129D-1*t218*t367
     #-0.7421351600392257D-1*t127*t370-0.8658243533790967D-1*t127*t375
      t379 = t214*t378
      t382 = -0.2724215777135184D0*t184*t335-0.3178251739991049D0*t107
     #*t340*t122*t137+0.1362107888567592D0*t107*t110*t361*t137
     #-0.1362107888567592D0*t211*t379
      t383 = t105*t382
      t384 = t383*t235
      t386 = t244+t265-t269-t283+t293+t299+t319+t322-t325
     #+0.9327207260896469D-1*t333+0.310906908696549D-1*t384
      t387 = rho*t386
      vrhoa(i) = -0.12407009817988D1*t4*t14+0.8963286558970112D-2*t150
     #*sigmaaa*t12+rho*(t161-t166+t169+t172+t182+t237)-t47+t81+t98
     #+t144+t387
      t391 = 1/t17/t19
      t395 = -t158
      t397 = t59*t395*t78
      t398 = 0.37995525D-1*t397
      t399 = 0.1519821D0*t165
      t400 = t95*t395
      t401 = t400*t76
      t402 = 0.1923661050931536D1*t401
      t403 = 0.7694644203726145D1*t171
      t404 = -t180
      t405 = t173*t404
      t406 = 0.9327207260896469D-1*t405
      t407 = t185*t404
      t410 = t398+t399+t402-t403
      t415 = -0.3216396844291482D2*t410*t112+0.9649190532874446D2*t194
     #*t404
      t416 = t110*t415
      t417 = t416*t115
      t419 = 0.1362107888567592D0*t190*t417
      t422 = 0.2724215777135184D0*t118*t202*t404
      t423 = -t419-t422
      t428 = t132*t415
      t429 = t428*t115
      t432 = t225*t404
      t435 = -t419-t422-0.3710675800196129D-1*t218*t429
     #-0.7421351600392257D-1*t127*t432
      t436 = t214*t435
      t439 = -0.2724215777135184D0*t184*t407+0.1362107888567592D0*t107
     #*t110*t423*t137-0.1362107888567592D0*t211*t436
      t440 = t105*t439
      t441 = t440*t235
      t442 = 0.310906908696549D-1*t441
      vrhob(i) = -0.12407009817988D1*t17*t27+0.8963286558970112D-2
     #*t391*sigmabb*t25+rho*(t398+t399+t402-t403+t406+t442)-t47+t81
     #+t98+t144+t387
      t448 = rho*t105
      t451 = sigma*t129
      t456 = t117*t106
      t461 = 0.1362107888567592D0*t456*t110+0.3710675800196129D-1*t189
     #*t133
      t462 = t214*t461
      t465 = 0.1362107888567592D0*t119*t185+0.1855337900098064D-1*t451
     #*t132*t117*t137-0.1362107888567592D0*t211*t462
      t467 = t448*t465*t235
      t468 = 0.310906908696549D-1*t467
      vsigmaaa(i) = -0.3361232459613792D-2/t5*t12+t468
      vsigmaab(i) = 0.6218138173930979D-1*t467
      vsigmabb(i) = -0.3361232459613792D-2/t18*t25+t468
      t472 = 0.5495546528376876D-2*t243
      t473 = 0.6218138173930979D-1*t384
      t476 = 0.3039642D0*t298
      t480 = 0.174814857510834D-2*t268
      t482 = 0.1865441452179294D0*t333
      t483 = 0.225D1*t282
      t484 = t472+t473+0.6218138173930979D-1*t236+0.1865441452179294D0
     #*t181+t476+0.7599105D-1*t160+0.3847322101863073D1*t168
     #+0.1538928840745229D2*t171-t480-0.3039642D0*t165+t482-t483
      t488 = 0.2D1*t264
      t489 = 0.7599105D-1*t292
      t490 = 0.3847322101863073D1*t318
      t491 = 0.3847322101863073D1*t321
      t492 = 0.1538928840745229D2*t324
      t499 = 1/t99
      t502 = 1/t101
      t505 = 0.4444444444444444D0*t499*t241+0.4444444444444444D0*t502
     #*t241
      t508 = 0.37995525D-1*t59*t505*t78
      t511 = t59*t158*t162*t75
      t512 = 0.3039642D0*t511
      t515 = t59*t70*t71*t75
      t516 = 0.4559463D0*t515
      t519 = 0.1923661050931536D1*t95*t505*t76
      t520 = t167*t170
      t521 = 0.1538928840745229D2*t520
      t523 = t96*t71*t75
      t524 = 0.2308393261117844D2*t523
      t525 = t103*t142
      t526 = t180**2
      t529 = t104*t233
      t530 = t235*t180
      t533 = 1/t65
      t536 = 1/t69
      t539 = -0.1111111111111111D0*t533*t241-0.1111111111111111D0*t536
     #*t241
      t541 = 0.9327207260896469D-1*t173*t539
      t542 = t451*t110
      t546 = t206*t137
      t556 = 0.2724215777135184D0*t184*t185*t539
      t557 = t216*sigma
      t558 = t557*t106
      t559 = t197**2
      t560 = t110*t559
      t562 = dexp(-0.6432793688582964D2*t113)
      t565 = 0.2724215777135184D0*t558*t560*t562
      t566 = t189*t112
      t567 = t115*t180
      t570 = 0.5448431554270369D0*t566*t198*t567
      t574 = t191*t129
      t577 = t111*t224
      t581 = 0.9649190532874446D2*t194*t539
      t582 = -0.3216396844291482D2*(t508-t512-t516+t519+t521+t524)
     #*t112+0.1929838106574889D3*t574*t180-0.3859676213149779D3*t577
     #*t526+t581
      t586 = 0.1362107888567592D0*t190*t110*t582*t115
      t589 = 0.1362107888567592D0*t190*t560*t115
      t590 = t129*t110
      t593 = 0.8172647331405553D0*t118*t590*t526
      t596 = 0.2724215777135184D0*t118*t202*t539
      t602 = t206*t213
      t608 = t122/t212/t136
      t609 = t229**2
      t613 = t124**2
      t616 = 1/t613*t126*t129
      t617 = t132*t559
      t621 = t217*t224
      t633 = 1/t128/t104
      t634 = t633*t132
      t640 = 0.7421351600392257D-1*t127*t225*t539
      t641 = t565+t570-t586-t589+t593-t596+0.1113202740058839D0*t616
     #*t617*t562+0.2968540640156903D0*t621*t219*t567
     #-0.3710675800196129D-1*t218*t132*t582*t115-0.3710675800196129D-1
     #*t218*t617*t115+0.3710675800196129D0*t127*t634*t526-t640
      t649 = t233**2
      t651 = t141**2
      t652 = 1/t651
      t655 = t508-t512-t516+t519+t521+t524+0.1865441452179294D0*t525
     #*t526+0.1865441452179294D0*t529*t530+t541+0.310906908696549D-1
     #*t105*(0.8172647331405553D0*t542*t185*t526-0.5448431554270369D0
     #*t184*t546*t180+0.5448431554270369D0*t184*t214*t180*t229-t556
     #+0.1362107888567592D0*t107*t110*(t565+t570-t586-t589+t593-t596)
     #*t137-0.2724215777135184D0*t211*t602*t229+0.2724215777135184D0
     #*t211*t608*t609-0.1362107888567592D0*t211*t214*t641)*t235
     #-0.310906908696549D-1*t105*t649*t652
      t657 = t6**2
      t660 = sigmaaa**2
      t667 = 0.87407428755417D-3*t242*t58*t158*t78
      t671 = 0.1125D1*t278*t279*t158*t78
      t673 = 1/t338
      t683 = -0.4444444444444444D0*t499*t61*t673-0.1333333333333333D1
     #*t64*t241-0.4444444444444444D0*t502*t61*t673
     #+0.1333333333333333D1*t68*t241
      t686 = 0.37995525D-1*t59*t683*t78
      t690 = 0.1519821D0*t59*t158*t72*t296
      t691 = t74*t73
      t692 = 1/t691
      t695 = t240*t692*t266*t162
      t696 = 0.349629715021668D-2*t695
      t698 = t278*t280*t170
      t699 = 0.45D1*t698
      t702 = t59*t290*t162*t75
      t703 = 0.1519821D0*t702
      t705 = t59*t163*t296
      t706 = 0.6079284D0*t705
      t709 = 0.1923661050931536D1*t316*t158*t76
      t712 = 0.1923661050931536D1*t95*t683*t76
      t714 = 0.7694644203726145D1*t167*t323
      t715 = t317*t170
      t716 = 0.7694644203726145D1*t715
      t717 = t320*t170
      t718 = 0.7694644203726145D1*t717
      t720 = t96*t162*t296
      t721 = 0.3077857681490458D2*t720
      t722 = t332*t180
      t724 = 0.1865441452179294D0*t525*t722
      t725 = t104*t382
      t727 = 0.9327207260896469D-1*t725*t530
      t738 = 0.1111111111111111D0*t533*t61*t673-0.3333333333333333D0
     #*t174*t241+0.1111111111111111D0*t536*t61*t673
     #+0.3333333333333333D0*t177*t241
      t740 = 0.9327207260896469D-1*t173*t738
      t741 = t235*t332
      t743 = 0.9327207260896469D-1*t529*t741
      t746 = 0.8172647331405553D0*t542*t185*t722
      t747 = t183*t340
      t749 = 0.6356503479982097D0*t747*t186
      t750 = t361*t137
      t753 = 0.2724215777135184D0*t184*t750*t180
      t757 = 0.2724215777135184D0*t184*t214*t378*t180
      t760 = 0.2724215777135184D0*t184*t185*t738
      t763 = 0.2724215777135184D0*t184*t546*t332
      t767 = 0.3178251739991049D0*t107*t340*t206*t137
      t768 = t562*t197
      t771 = 0.2724215777135184D0*t558*t351*t768
      t772 = t110*t332
      t773 = t197*t115
      t776 = 0.2724215777135184D0*t566*t772*t773
      t780 = 0.3178251739991049D0*t190*t340*t197*t115
      t781 = -t667-t671+t686+t690+t696+t699-t703+t706+t709+t712-t714
     #+t716+t718-t721
      t785 = 0.9649190532874446D2*t574*t332
      t786 = t345*t129
      t788 = 0.9649190532874446D2*t786*t180
      t790 = 0.3859676213149779D3*t577*t722
      t792 = 0.9649190532874446D2*t194*t738
      t793 = -0.3216396844291482D2*t781*t112+t785+t788-t790+t792
      t797 = 0.1362107888567592D0*t190*t110*t793*t115
      t800 = 0.1362107888567592D0*t190*t351*t773
      t803 = 0.2724215777135184D0*t566*t351*t567
      t804 = t118*t129
      t807 = 0.8172647331405553D0*t804*t772*t180
      t808 = t112*t340
      t811 = 0.6356503479982097D0*t118*t808*t180
      t814 = 0.2724215777135184D0*t118*t202*t738
      t822 = 0.1362107888567592D0*t211*t602*t378
      t826 = 0.2724215777135184D0*t184*t214*t332*t229
      t827 = t107*t340
      t829 = 0.3178251739991049D0*t827*t230
      t830 = t361*t213
      t833 = 0.1362107888567592D0*t211*t830*t229
      t837 = 0.2724215777135184D0*t211*t608*t378*t229
      t840 = 0.1113202740058839D0*t616*t366*t768
      t841 = t132*t332
      t844 = 0.1484270320078451D0*t621*t841*t773
      t848 = 0.1731648706758193D0*t218*t374*t197*t115
      t855 = 0.3710675800196129D-1*t218*t366*t773
      t858 = 0.1484270320078451D0*t621*t366*t567
      t859 = t127*t633
      t862 = 0.3710675800196129D0*t859*t841*t180
      t863 = t224*t374
      t866 = 0.3463297413516387D0*t127*t863*t180
      t869 = 0.7421351600392257D-1*t127*t225*t738
      t870 = t771+t776+t780-t797-t800+t803+t807+t811-t814+t840+t844
     #+t848-0.3710675800196129D-1*t218*t132*t793*t115-t855+t858+t862
     #+t866-t869
      t874 = t746+t749-t753+t757-t760-t763-t767+0.1362107888567592D0
     #*t107*t110*(t771+t776+t780-t797-t800+t803+t807+t811-t814)*t137
     #-t822+t826+t829-t833+t837-0.1362107888567592D0*t211*t214*t870
      t880 = 0.310906908696549D-1*t383*t652*t233
      t881 = -t667-t671+t686+t690+t696+t699-t703+t706+t709+t712-t714
     #+t716+t718-t721+t724+t727+t740+t743+0.310906908696549D-1*t105
     #*t874*t235-t880
      t882 = rho*t881
      t883 = 0.45D1*t698
      t884 = -t667+t696-t671+t883+t686-t703+t690+t706+t709+t716+t712
     #+t718-t714-t721
      t887 = -0.3216396844291482D2*t884*t112+t788+t785-t790+t792
      t891 = 0.1362107888567592D0*t190*t110*t887*t115
      t901 = t771+t803-t891-t800+t776+t807-t814+t780+t811+t840+t858
     #-0.3710675800196129D-1*t218*t132*t887*t115-t855+t844+t862-t869
     #+t848+t866
      t905 = t746-t763+t826-t760+t749-t767+t829-t753
     #+0.1362107888567592D0*t107*t110*(t771+t803-t891-t800+t776+t807
     #-t814+t780+t811)*t137-t833+t757-t822+t837-0.1362107888567592D0
     #*t211*t214*t901
      t909 = -t667+t696-t671+t883+t686-t703+t690+t706+t709+t716+t712
     #+t718-t714-t721+t724+t743+t740+t727+0.310906908696549D-1*t105
     #*t905*t235-t880
      t910 = rho*t909
      t911 = t240*t673
      t913 = 0.174814857510834D-2*t911*t267
      t917 = 0.174814857510834D-2*t242*t58*t290*t78
      t918 = t911*t45
      t919 = 0.5495546528376876D-2*t918
      t922 = 1/t39/t30*t75
      t923 = t922*t45
      t924 = 0.1831848842792292D-2*t923
      t925 = t332**2
      t931 = 1/t74/t338
      t935 = 0.699259430043336D-2*t240*t931*t266*t72
      t939 = t277**2
      t942 = 0.225D1*t49/t270/t54*t939*t281
      t954 = t309**2
      t960 = 1/t250/t30*t75
      t962 = t251*t673
      t968 = 1/t37/t30*t75
      t970 = t255*t673
      t974 = 1/t31/t30*t75
      t976 = t258*t673
      t982 = t302**2
      t985 = t91**2
      t994 = t242*t246*t261*t262
      t999 = t261**2
      t1001 = t33/t245/t41*t999*t262
      t1013 = t247*(-0.8309097827459833D0*t960+0.199418347859036D1
     #*t962-0.4945709824779306D0*t922+0.1483712947433792D1*t911
     #-0.2001071587498409D0*t968+0.8004286349993634D0*t970
     #-0.4215565168327908D-1*t974+0.2529339100996745D0*t976)*t262
      t1015 = t245**2
      t1018 = t44**2
      t1021 = t33/t1015*t999/t1018
      t1023 = 0.8806932620892844D-3*t922*t92-0.2642079786267853D-2
     #*t911*t92-0.8497974591333914D-1*t242*t303*t309*t310-0.2D1*t83
     #/t302/t88*t954*t310+0.1D1*t304*(-0.1544496508763151D1*t960
     #+0.3706791621031562D1*t962-0.854388052766047D0*t922
     #+0.2563164158298141D1*t911-0.4111834438919023D0*t968
     #+0.1644733775567609D1*t970-0.5346380647307093D-1*t974
     #+0.3207828388384256D0*t976)*t310+0.3216395899738507D2*t83/t982
     #*t954/t985-0.1831848842792292D-2*t923+0.5495546528376876D-2*t918
     #+0.8837926660346786D-1*t994+0.2D1*t1001-0.1D1*t1013
     #-0.1608197949869254D2*t1021
      t1026 = 0.1923661050931536D1*t1023*t70*t76
      t1037 = 0.4444444444444444D0*t499*t71*t75+0.2666666666666667D1
     #*t284*t673+0.4444444444444444D0*t502*t71*t75
     #-0.2666666666666667D1*t287*t673
      t1040 = 0.1923661050931536D1*t95*t1037*t76
      t1041 = t270**2
      t1045 = t57**2
      t1050 = 0.3330984372501762D2*t49/t1041*t939/t1045*t70*t78
      t1053 = 0.9D1*t278*t280*t323
      t1056 = 0.7599105D0*t59*t294*t692
      t1057 = 0.2D1*t1001
      t1058 = 0.1D1*t1013
      t1059 = t913-t917-t919+t924+0.1865441452179294D0*t525*t925
     #+0.1865441452179294D0*t725*t741-t935+t942+t1026+t1040-t1050
     #-t1053-t1056-t1057+t1058
      t1060 = 0.1608197949869254D2*t1021
      t1071 = -0.1111111111111111D0*t533*t71*t75+0.6666666666666667D0
     #*t326*t673-0.1111111111111111D0*t536*t71*t75
     #-0.6666666666666667D0*t329*t673
      t1085 = 0.1125D1*t272*(-0.1132974264373283D1*t960
     #+0.271913823449588D1*t962-0.4994648585728036D0*t922
     #+0.1498394575718411D1*t911-0.1075243117819161D0*t968
     #+0.4300972471276643D0*t970-0.4247805766949639D-1*t974
     #+0.2548683460169784D0*t976)*t281
      t1089 = 1/t108/t74
      t1107 = t350**2
      t1108 = t110*t1107
      t1111 = 0.1362107888567592D0*t190*t1108*t115
      t1112 = t132*t1107
      t1122 = 0.6356503479982097D0*t190*t340*t350*t115
      t1125 = 0.1059417246663683D1*t118*t106*t1089
      t1128 = 0.8172647331405553D0*t118*t590*t925
      t1131 = 0.2724215777135184D0*t558*t1108*t562
      t1135 = t913-t917-t919+t924-t935+t942+t1026+t1040-t1050-t1053
     #-t1056-t1057
      t1136 = 0.8837926660346786D-1*t994
      t1138 = 0.58271619170278D-3*t922*t267
      t1143 = 0.5176049408441869D-1*t242*t271*t277*t279*t79
      t1147 = 0.3039642D0*t59*t290*t72*t296
      t1151 = 0.225D1*t278*t279*t290*t78
      t1153 = 0.1538928840745229D2*t320*t323
      t1156 = 0.3847322101863073D1*t316*t290*t76
      t1158 = 0.1538928840745229D2*t317*t323
      t1161 = 0.37995525D-1*t59*t1037*t78
      t1164 = 0.3847322101863073D2*t96*t72*t692
      t1165 = t1058+t1060-t1085-t1136-t1138+t1143+t1147-t1151-t1153
     #+t1156-t1158+t1161+t1164
      t1175 = -0.3216396844291482D2*(t1135+t1165)*t112
     #+0.1929838106574889D3*t786*t332-0.3859676213149779D3*t577*t925
     #+0.9649190532874446D2*t194*t1071
      t1179 = 0.1362107888567592D0*t190*t110*t1175*t115
      t1187 = 0.1271300695996419D1*t118*t808*t332
      t1190 = 0.2724215777135184D0*t118*t202*t1071
      t1194 = t115*t332
      t1208 = 0.5448431554270369D0*t566*t351*t1194
      t1209 = 0.6926594827032773D0*t127*t863*t332-t1111
     #-0.3710675800196129D-1*t218*t1112*t115-0.7421351600392257D-1
     #*t127*t225*t1071+t1122+t1125+t1128+t1131+0.3710675800196129D0
     #*t127*t634*t925-t1179+0.4906338002481548D0*t127*t129/t130/t691
     #+t1187-t1190+0.1113202740058839D0*t616*t1112*t562
     #+0.2968540640156903D0*t621*t366*t1194-0.3710675800196129D-1*t218
     #*t132*t1175*t115+0.3463297413516387D0*t218*t374*t350*t115+t1208
      t1226 = t378**2
      t1234 = 0.6356503479982097D0*t827*t379+0.1059417246663683D1*t107
     #*t1089*t122*t137-0.2724215777135184D0*t184*t185*t1071
     #-0.6356503479982097D0*t107*t340*t361*t137-0.2724215777135184D0
     #*t211*t830*t378-0.1362107888567592D0*t211*t214*t1209
     #+0.1362107888567592D0*t107*t110*(t1131+t1208+t1122-t1179-t1111
     #+t1128+t1187-t1190+t1125)*t137+0.8172647331405553D0*t542*t185
     #*t925+0.1271300695996419D1*t747*t335-0.5448431554270369D0*t184
     #*t750*t332+0.2724215777135184D0*t211*t608*t1226
     #+0.5448431554270369D0*t184*t214*t332*t378
      t1238 = t382**2
      t1242 = t1060+0.9327207260896469D-1*t173*t1071-t1085
     #+0.310906908696549D-1*t105*t1234*t235-t1136-t1138+t1143+t1147
     #-0.310906908696549D-1*t105*t1238*t652-t1151-t1153+t1156-t1158
     #+t1161+t1164
      t1244 = rho*(t1059+t1242)
      t1245 = -0.4135669939329333D0/t7*t14+t488+t489+t490+t491-t492
     #-0.8963286558970112D-2/t4/t6/rhoa*sigmaaa*t12+rho*t655
     #+0.1073866079220678D-3/t657/t6*t660*t12+t882+t910+t1244
      v2rhoa2(i) = t484+t1245
      t1252 = t472+0.7599105D-1*t397+0.3847322101863073D1*t401
     #+0.6218138173930979D-1*t441+0.1865441452179294D0*t405+t473+t476
     #-0.1538928840745229D2*t171-t480+0.3039642D0*t165+t482-t483
      t1262 = 0.87407428755417D-3*t242*t58*t395*t78
      t1266 = 0.1125D1*t278*t279*t395*t78
      t1267 = -t683
      t1270 = 0.37995525D-1*t59*t1267*t78
      t1274 = 0.1519821D0*t59*t395*t72*t296
      t1275 = 0.349629715021668D-2*t695
      t1276 = 0.45D1*t698
      t1277 = 0.1519821D0*t702
      t1278 = 0.6079284D0*t705
      t1281 = 0.1923661050931536D1*t316*t395*t76
      t1284 = 0.1923661050931536D1*t95*t1267*t76
      t1286 = 0.7694644203726145D1*t400*t323
      t1287 = 0.7694644203726145D1*t715
      t1288 = 0.7694644203726145D1*t717
      t1289 = 0.3077857681490458D2*t720
      t1290 = t332*t404
      t1293 = t235*t404
      t1296 = -t738
      t1299 = t104*t439
      t1317 = t423*t137
      t1325 = t562*t415
      t1328 = 0.2724215777135184D0*t558*t351*t1325
      t1329 = t415*t115
      t1332 = 0.2724215777135184D0*t566*t772*t1329
      t1336 = 0.3178251739991049D0*t190*t340*t415*t115
      t1337 = -t1262-t1266+t1270+t1274-t1275-t1276+t1277-t1278+t1281
     #+t1284-t1286-t1287-t1288+t1289
      t1340 = t410*t129
      t1349 = -0.3216396844291482D2*t1337*t112+0.9649190532874446D2
     #*t1340*t332+0.9649190532874446D2*t786*t404-0.3859676213149779D3
     #*t577*t1290+0.9649190532874446D2*t194*t1296
      t1353 = 0.1362107888567592D0*t190*t110*t1349*t115
      t1356 = 0.1362107888567592D0*t190*t351*t1329
      t1357 = t115*t404
      t1360 = 0.2724215777135184D0*t566*t351*t1357
      t1363 = 0.8172647331405553D0*t804*t772*t404
      t1366 = 0.6356503479982097D0*t118*t808*t404
      t1369 = 0.2724215777135184D0*t118*t202*t1296
      t1375 = t423*t213
      t1421 = t1328+t1332+t1336-t1353-t1356+t1360+t1363+t1366-t1369
     #+0.1113202740058839D0*t616*t366*t1325+0.1484270320078451D0*t621
     #*t841*t1329+0.1731648706758193D0*t218*t374*t415*t115
     #-0.3710675800196129D-1*t218*t132*t1349*t115
     #-0.3710675800196129D-1*t218*t366*t1329+0.1484270320078451D0*t621
     #*t366*t1357+0.3710675800196129D0*t859*t841*t404
     #+0.3463297413516387D0*t127*t863*t404-0.7421351600392257D-1*t127
     #*t225*t1296
      t1425 = 0.8172647331405553D0*t542*t185*t1290
     #+0.6356503479982097D0*t747*t407-0.2724215777135184D0*t184*t750
     #*t404+0.2724215777135184D0*t184*t214*t378*t404
     #-0.2724215777135184D0*t184*t185*t1296-0.2724215777135184D0*t184
     #*t1317*t332-0.3178251739991049D0*t107*t340*t423*t137
     #+0.1362107888567592D0*t107*t110*(t1328+t1332+t1336-t1353-t1356
     #+t1360+t1363+t1366-t1369)*t137-0.1362107888567592D0*t211*t1375
     #*t378+0.2724215777135184D0*t184*t214*t332*t435
     #+0.3178251739991049D0*t827*t436-0.1362107888567592D0*t211*t830
     #*t435+0.2724215777135184D0*t211*t608*t378*t435
     #-0.1362107888567592D0*t211*t214*t1421
      t1429 = t652*t439
      t1432 = -t1262-t1266+t1270+t1274-t1275-t1276+t1277-t1278+t1281
     #+t1284-t1286-t1287-t1288+t1289+0.1865441452179294D0*t525*t1290
     #+0.9327207260896469D-1*t725*t1293+0.9327207260896469D-1*t173
     #*t1296+0.9327207260896469D-1*t1299*t741+0.310906908696549D-1
     #*t105*t1425*t235-0.310906908696549D-1*t383*t1429
      t1433 = rho*t1432
      t1437 = t19**2
      t1440 = sigmabb**2
      t1446 = t59*t395*t162*t75
      t1447 = 0.3039642D0*t1446
      t1448 = t400*t170
      t1449 = 0.1538928840745229D2*t1448
      t1450 = t404**2
      t1465 = t415**2
      t1466 = t110*t1465
      t1469 = 0.2724215777135184D0*t558*t1466*t562
      t1472 = 0.5448431554270369D0*t566*t416*t1357
      t1480 = -0.3216396844291482D2*(t508+t1447-t516+t519-t1449+t524)
     #*t112+0.1929838106574889D3*t1340*t404-0.3859676213149779D3*t577
     #*t1450+t581
      t1484 = 0.1362107888567592D0*t190*t110*t1480*t115
      t1487 = 0.1362107888567592D0*t190*t1466*t115
      t1490 = 0.8172647331405553D0*t118*t590*t1450
      t1499 = t435**2
      t1503 = t132*t1465
      t1520 = t1469+t1472-t1484-t1487+t1490-t596+0.1113202740058839D0
     #*t616*t1503*t562+0.2968540640156903D0*t621*t428*t1357
     #-0.3710675800196129D-1*t218*t132*t1480*t115
     #-0.3710675800196129D-1*t218*t1503*t115+0.3710675800196129D0*t127
     #*t634*t1450-t640
      t1528 = t439**2
      t1532 = t508+t1447-t516+t519-t1449+t524+0.1865441452179294D0
     #*t525*t1450+0.1865441452179294D0*t1299*t1293+t541
     #+0.310906908696549D-1*t105*(0.8172647331405553D0*t542*t185*t1450
     #-0.5448431554270369D0*t184*t1317*t404+0.5448431554270369D0*t184
     #*t214*t404*t435-t556+0.1362107888567592D0*t107*t110*(t1469+t1472
     #-t1484-t1487+t1490-t596)*t137-0.2724215777135184D0*t211*t1375
     #*t435+0.2724215777135184D0*t211*t608*t1499-0.1362107888567592D0
     #*t211*t214*t1520)*t235-0.310906908696549D-1*t105*t1528*t652
      t1534 = t488+t489+t490+t491-t492-0.8963286558970112D-2/t17/t19
     #/rhob*sigmabb*t25+2*t1433-0.4135669939329333D0/t20*t27
     #+0.1073866079220678D-3/t1437/t19*t1440*t25+t1244+rho*t1532
      v2rhob2(i) = t1252+t1534
      t1537 = -t505
      t1540 = 0.37995525D-1*t59*t1537*t78
      t1541 = 0.1519821D0*t511
      t1542 = 0.1519821D0*t1446
      t1543 = 0.4559463D0*t515
      t1546 = 0.1923661050931536D1*t95*t1537*t76
      t1547 = 0.7694644203726145D1*t520
      t1548 = 0.7694644203726145D1*t1448
      t1549 = 0.2308393261117844D2*t523
      t1550 = t180*t404
      t1555 = -t539
      t1578 = 0.2724215777135184D0*t558*t198*t1325
      t1581 = 0.2724215777135184D0*t566*t198*t1357
      t1593 = -0.3216396844291482D2*(t1540+t1541-t1542+t1543+t1546
     #-t1547+t1548-t1549)*t112+0.9649190532874446D2*t574*t404
     #+0.9649190532874446D2*t1340*t180-0.3859676213149779D3*t577*t1550
     #+0.9649190532874446D2*t194*t1555
      t1597 = 0.1362107888567592D0*t190*t110*t1593*t115
      t1600 = 0.1362107888567592D0*t190*t198*t1329
      t1601 = t110*t180
      t1604 = 0.2724215777135184D0*t566*t1601*t1329
      t1607 = 0.8172647331405553D0*t804*t1601*t404
      t1610 = 0.2724215777135184D0*t118*t202*t1555
      t1643 = t132*t180
      t1653 = t1578+t1581-t1597-t1600+t1604+t1607-t1610
     #+0.1113202740058839D0*t616*t219*t1325+0.1484270320078451D0*t621
     #*t219*t1357-0.3710675800196129D-1*t218*t132*t1593*t115
     #-0.3710675800196129D-1*t218*t219*t1329+0.1484270320078451D0*t621
     #*t1643*t1329+0.3710675800196129D0*t859*t1643*t404
     #-0.7421351600392257D-1*t127*t225*t1555
      t1657 = 0.8172647331405553D0*t542*t185*t1550
     #-0.2724215777135184D0*t184*t1317*t180+0.2724215777135184D0*t184
     #*t214*t180*t435-0.2724215777135184D0*t184*t185*t1555
     #-0.2724215777135184D0*t184*t546*t404+0.1362107888567592D0*t107
     #*t110*(t1578+t1581-t1597-t1600+t1604+t1607-t1610)*t137
     #-0.1362107888567592D0*t211*t602*t435+0.2724215777135184D0*t184
     #*t214*t229*t404-0.1362107888567592D0*t211*t1375*t229
     #+0.2724215777135184D0*t211*t608*t229*t435-0.1362107888567592D0
     #*t211*t214*t1653
      t1663 = t1540+t1541-t1542+t1543+t1546-t1547+t1548-t1549
     #+0.1865441452179294D0*t525*t1550+0.9327207260896469D-1*t1299
     #*t530+0.9327207260896469D-1*t173*t1555+0.9327207260896469D-1
     #*t529*t1293+0.310906908696549D-1*t105*t1657*t235
     #-0.310906908696549D-1*t234*t1429
      t1666 = 0.1D1*t1433+0.5D0*t910+t442+t1244+t406+t237+t472+t182
     #+t473+rho*t1663+0.5D0*t882
      t1667 = -t480+t482-t483+t398+t402+t161+t169+t488+t489+t476+t490
     #+t491-t492
      v2rhoab(i) = t1666+t1667
      t1675 = t104*t465
      t1681 = sigma*t224*t132
      t1682 = t117*t137
      t1692 = t125*t106
      t1694 = 0.1362107888567592D0*t1692*t199
      t1695 = t117*t112
      t1697 = 0.2724215777135184D0*t1695*t1601
      t1708 = t451*t132
      t1709 = t117*t213
      t1717 = t557*t129
      t1730 = t652*t465
      t1734 = rho*(0.9327207260896469D-1*t1675*t530
     #+0.310906908696549D-1*t105*(-0.2724215777135184D0*t202*t186
     #-0.3710675800196129D-1*t1681*t1682*t180+0.2724215777135184D0
     #*t184*t214*t180*t461+0.1362107888567592D0*t119*t546
     #+0.1362107888567592D0*t107*t110*(-t1694-t1697)*t137
     #-0.1362107888567592D0*t211*t602*t461-0.1362107888567592D0*t119
     #*t230-0.1855337900098064D-1*t1708*t1709*t229
     #+0.2724215777135184D0*t211*t608*t229*t461-0.1362107888567592D0
     #*t211*t214*(-t1694-t1697-0.7421351600392257D-1*t1717*t220
     #-0.1484270320078451D0*t189*t226))*t235-0.310906908696549D-1*t234
     #*t1730)
      t1736 = t105*t465*t235
      t1737 = 0.310906908696549D-1*t1736
      t1760 = 0.1362107888567592D0*t1692*t352
      t1762 = 0.2724215777135184D0*t1695*t772
      t1764 = 0.3178251739991049D0*t456*t340
      t1792 = -0.2724215777135184D0*t202*t335-0.3710675800196129D-1
     #*t1681*t1682*t332+0.2724215777135184D0*t184*t214*t332*t461
     #-0.3178251739991049D0*t358*t185-0.4329121766895483D-1*t451*t374
     #*t117*t137+0.3178251739991049D0*t827*t462+0.1362107888567592D0
     #*t119*t750+0.1362107888567592D0*t107*t110*(-t1760-t1762-t1764)
     #*t137-0.1362107888567592D0*t211*t830*t461-0.1362107888567592D0
     #*t119*t379-0.1855337900098064D-1*t1708*t1709*t378
     #+0.2724215777135184D0*t211*t608*t378*t461-0.1362107888567592D0
     #*t211*t214*(-t1760-t1762-t1764-0.7421351600392257D-1*t1717*t367
     #-0.1484270320078451D0*t189*t370-0.1731648706758193D0*t189*t375)
      t1799 = rho*(0.9327207260896469D-1*t1675*t741
     #+0.310906908696549D-1*t105*t1792*t235-0.310906908696549D-1*t383
     #*t1730)
      v2rhoasigmaaa(i) = 0.4481643279485056D-2*t150*t12
     #-0.4026997797077544D-4/t657/rhoa*sigmaaa*t12+t1734+t1737+t1799
      t1801 = 0.6218138173930979D-1*t1736
      t1802 = 2.D0*t1799
      v2rhoasigmaab(i) = 2.D0*t1734+t1801+t1802
      v2rhoasigmabb(i) = t1734+t1737+t1799
      t1817 = 0.1362107888567592D0*t1692*t417
      t1820 = 0.2724215777135184D0*t1695*t110*t404
      t1853 = rho*(0.9327207260896469D-1*t1675*t1293
     #+0.310906908696549D-1*t105*(-0.2724215777135184D0*t202*t407
     #-0.3710675800196129D-1*t1681*t1682*t404+0.2724215777135184D0
     #*t184*t214*t404*t461+0.1362107888567592D0*t119*t1317
     #+0.1362107888567592D0*t107*t110*(-t1817-t1820)*t137
     #-0.1362107888567592D0*t211*t1375*t461-0.1362107888567592D0*t119
     #*t436-0.1855337900098064D-1*t1708*t1709*t435
     #+0.2724215777135184D0*t211*t608*t435*t461-0.1362107888567592D0
     #*t211*t214*(-t1817-t1820-0.7421351600392257D-1*t1717*t429
     #-0.1484270320078451D0*t189*t432))*t235-0.310906908696549D-1*t440
     #*t1730)
      v2rhobsigmaaa(i) = t1853+t1737+t1799
      v2rhobsigmaab(i) = 2.D0*t1853+t1801+t1802
      v2rhobsigmabb(i) = 0.4481643279485056D-2*t391*t25
     #-0.4026997797077544D-4/t1437/rhob*sigmabb*t25+t1853+t1737+t1799
      t1872 = t461**2
      t1883 = t448*(0.3710675800196129D-1*t133*t1682
     #-0.2724215777135184D0*t119*t462-0.3710675800196129D-1*t1708
     #*t1709*t461+0.2724215777135184D0*t211*t608*t1872
     #-0.5054340779364009D-2*sigma*t633*t931*t214*t125)*t235
      t1884 = 0.310906908696549D-1*t1883
      t1885 = t465**2
      t1887 = t448*t1885*t652
      t1888 = 0.310906908696549D-1*t1887
      v2sigmaaa2(i) = 0.1510124173904079D-4/t657*t12+t1884-t1888
      v2sigmaaaab(i) = 0.6218138173930979D-1*t1883
     #-0.6218138173930979D-1*t1887
      v2sigmaaabb(i) = t1884-t1888
      v2sigmaab2(i) = 0.1243627634786196D0*t1883-0.1243627634786196D0
     #*t1887
      v2sigmaabbb(i) = v2sigmaaaab(i)
      v2sigmabb2(i) = 0.1510124173904079D-4/t1437*t25+t1884-t1888
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      v2rhob2(i) = 0.0d0
      v2rhoab(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2rhoasigmaab(i) = 0.0d0
      v2rhoasigmabb(i) = 0.0d0
      v2rhobsigmaaa(i) = 0.0d0
      v2rhobsigmaab(i) = 0.0d0
      v2rhobsigmabb(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      v2sigmaab2(i) = 0.0d0
      v2sigmabb2(i) = 0.0d0
      v2sigmaaaab(i) = 0.0d0
      v2sigmaaabb(i) = 0.0d0
      v2sigmaabbb(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end
      
      
      subroutine rks_xc_rpbe
     & (ideriv,npt,rhoa1,sigmaaa1,
     &  zk,vrhoa,vsigmaaa,
     &  v2rhoa2,v2rhoasigmaaa,v2sigmaaa2)
c
c     B. Hammer, L.B. Hansen, and J.K. Noerskov
c     Improved adsorption energetics within density functional theory
c     using revised PBE functionals
c     Phys. Rev. B. 59 (1999) 7413-7421
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt)
      REAL sigmaaa1(npt)
      REAL zk(npt),vrhoa(npt),vsigmaaa(npt)
      REAL v2rhoa2(npt),v2rhoasigmaaa(npt),v2sigmaaa2(npt)
      parameter(tol=1.0d-20)
      
      if(ideriv.eq.0) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t4 = rho**2
      t5 = t2**2
      t10 = dexp(-0.7131826587600489D-2*sigma/t5/t4)
      t15 = 1/rho
      t16 = t15**(1.D0/3.D0)
      t19 = t15**(1.D0/6.D0)
      t22 = dsqrt(t15)
      t24 = t16**2
      t30 = dlog(1.D0+0.1608197949869254D2/(0.598255043577108D1*t19
     #+0.2225569421150687D1*t16+0.8004286349993634D0*t22
     #+0.1897004325747559D0*t24))
      t31 = (1.D0+0.1325688999052018D0*t16)*t30
      t34 = 1/t2/t4
      t37 = dexp(0.2000000587336264D1*t31)
      t38 = t37-1.D0
      t42 = 0.1362107888567592D0/t38*sigma*t34
      t44 = t38**2
      t46 = sigma**2
      t48 = t4**2
      t59 = dlog(1.D0+0.1362107888567592D0*sigma*t34*(1.D0+t42)/(1.D0
     #+t42+0.1855337900098064D-1/t44*t46/t5/t48))
      zk(i) = -0.7385587663820224D0*t2*rho*(0.1804D1-0.804D0*t10)+rho*
     #(-0.621814D-1*t31+0.310906908696549D-1*t59)
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t3 = t2*rho
      t4 = rho**2
      t5 = t2**2
      t10 = dexp(-0.7131826587600489D-2*sigma/t5/t4)
      t12 = 0.1804D1-0.804D0*t10
      t15 = 1/rho
      t16 = t15**(1.D0/3.D0)
      t18 = 1.D0+0.1325688999052018D0*t16
      t19 = t15**(1.D0/6.D0)
      t22 = dsqrt(t15)
      t24 = t16**2
      t26 = 0.598255043577108D1*t19+0.2225569421150687D1*t16
     #+0.8004286349993634D0*t22+0.1897004325747559D0*t24
      t29 = 1.D0+0.1608197949869254D2/t26
      t30 = dlog(t29)
      t31 = t18*t30
      t32 = 0.621814D-1*t31
      t34 = 1/t2/t4
      t35 = sigma*t34
      t37 = dexp(0.2000000587336264D1*t31)
      t38 = t37-1.D0
      t39 = 1/t38
      t40 = t39*sigma
      t42 = 0.1362107888567592D0*t40*t34
      t43 = 1.D0+t42
      t44 = t38**2
      t45 = 1/t44
      t46 = sigma**2
      t47 = t45*t46
      t48 = t4**2
      t50 = 1/t5/t48
      t53 = 1.D0+t42+0.1855337900098064D-1*t47*t50
      t54 = 1/t53
      t55 = t43*t54
      t58 = 1.D0+0.1362107888567592D0*t35*t55
      t59 = dlog(t58)
      t60 = 0.310906908696549D-1*t59
      zk(i) = -0.7385587663820224D0*t3*t12+rho*(-t32+t60)
      t68 = 1/t4
      t69 = 1/t24*t68
      t70 = t69*t30
      t72 = t26**2
      t75 = t19**2
      t76 = t75**2
      t91 = t18/t72*(-0.99709173929518D0/t76/t19*t68
     #-0.7418564737168958D0*t69-0.4002143174996817D0/t22*t68
     #-0.1264669550498372D0/t16*t68)/t29
      t95 = 1/t2/t4/rho
      t99 = t45*sigma
      t102 = -0.8837929255764197D-1*t70-0.3216396844291482D2*t91
      t106 = 0.1362107888567592D0*t99*t34*t102*t37
      t108 = 0.3178251739991049D0*t40*t95
      t113 = t53**2
      t115 = t43/t113
      t133 = 1/t58
      vrhoa(i) = -0.9847450218426965D0*t2*t12+0.1129303341188623D-1
     #*t35*t10-t32+t60+rho*(0.2747773264188438D-2*t70+0.1D1*t91
     #+0.310906908696549D-1*(-0.3178251739991049D0*sigma*t95*t55
     #+0.1362107888567592D0*t35*(-t106-t108)*t54-0.1362107888567592D0
     #*t35*t115*(-t106-t108-0.3710675800196129D-1/t44/t38*t46*t50*t102
     #*t37-0.8658243533790967D-1*t47/t5/t48/rho))*t133)
      vsigmaaa(i) = -0.1693955011782934D-1/t3*t10+0.1243627634786196D0
     #*rho*(0.1362107888567592D0*t34*t43*t54+0.1855337900098064D-1
     #*sigma*t50*t39*t54-0.1362107888567592D0*t35*t115*
     #(0.1362107888567592D0*t39*t34+0.3710675800196129D-1*t99*t50))*t133
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t3 = t2*rho
      t4 = rho**2
      t5 = t2**2
      t10 = dexp(-0.7131826587600489D-2*sigma/t5/t4)
      t12 = 0.1804D1-0.804D0*t10
      t15 = 1/rho
      t16 = t15**(1.D0/3.D0)
      t18 = 1.D0+0.1325688999052018D0*t16
      t19 = t15**(1.D0/6.D0)
      t22 = dsqrt(t15)
      t24 = t16**2
      t26 = 0.598255043577108D1*t19+0.2225569421150687D1*t16
     #+0.8004286349993634D0*t22+0.1897004325747559D0*t24
      t29 = 1.D0+0.1608197949869254D2/t26
      t30 = dlog(t29)
      t31 = t18*t30
      t32 = 0.621814D-1*t31
      t34 = 1/t2/t4
      t35 = sigma*t34
      t37 = dexp(0.2000000587336264D1*t31)
      t38 = t37-1.D0
      t39 = 1/t38
      t40 = t39*sigma
      t42 = 0.1362107888567592D0*t40*t34
      t43 = 1.D0+t42
      t44 = t38**2
      t45 = 1/t44
      t46 = sigma**2
      t47 = t45*t46
      t48 = t4**2
      t50 = 1/t5/t48
      t53 = 1.D0+t42+0.1855337900098064D-1*t47*t50
      t54 = 1/t53
      t55 = t43*t54
      t58 = 1.D0+0.1362107888567592D0*t35*t55
      t59 = dlog(t58)
      t60 = 0.310906908696549D-1*t59
      zk(i) = -0.7385587663820224D0*t3*t12+rho*(-t32+t60)
      t67 = 1/t24
      t68 = 1/t4
      t69 = t67*t68
      t70 = t69*t30
      t72 = t26**2
      t73 = 1/t72
      t74 = t18*t73
      t75 = t19**2
      t76 = t75**2
      t77 = t76*t19
      t78 = 1/t77
      t82 = 1/t22
      t85 = 1/t16
      t88 = -0.99709173929518D0*t78*t68-0.7418564737168958D0*t69
     #-0.4002143174996817D0*t82*t68-0.1264669550498372D0*t85*t68
      t89 = 1/t29
      t91 = t74*t88*t89
      t93 = t4*rho
      t95 = 1/t2/t93
      t96 = sigma*t95
      t99 = t45*sigma
      t102 = -0.8837929255764197D-1*t70-0.3216396844291482D2*t91
      t106 = 0.1362107888567592D0*t99*t34*t102*t37
      t108 = 0.3178251739991049D0*t40*t95
      t109 = -t106-t108
      t110 = t109*t54
      t113 = t53**2
      t114 = 1/t113
      t115 = t43*t114
      t117 = 1/t44/t38
      t118 = t117*t46
      t120 = t50*t102*t37
      t123 = t48*rho
      t125 = 1/t5/t123
      t128 = -t106-t108-0.3710675800196129D-1*t118*t120
     #-0.8658243533790967D-1*t47*t125
      t129 = t115*t128
      t132 = -0.3178251739991049D0*t96*t55+0.1362107888567592D0*t35
     #*t110-0.1362107888567592D0*t35*t129
      t133 = 1/t58
      t134 = t132*t133
      vrhoa(i) = -0.9847450218426965D0*t2*t12+0.1129303341188623D-1
     #*t35*t10-t32+t60+rho*(0.2747773264188438D-2*t70+0.1D1*t91
     #+0.310906908696549D-1*t134)
      t141 = t34*t43
      t144 = sigma*t50
      t145 = t39*t54
      t152 = 0.1362107888567592D0*t39*t34+0.3710675800196129D-1*t99*t50
      t153 = t115*t152
      t156 = 0.1362107888567592D0*t141*t54+0.1855337900098064D-1*t144
     #*t145-0.1362107888567592D0*t35*t153
      vsigmaaa(i) = -0.1693955011782934D-1/t3*t10+0.1243627634786196D0
     #*rho*t156*t133
      t168 = t48*t4
      t173 = 1/t93
      t174 = t67*t173
      t175 = t174*t30
      t179 = 1/t48
      t180 = 1/t24/t15*t179
      t181 = t180*t30
      t185 = t69*t73*t88*t89
      t190 = t88**2
      t192 = t18/t72/t26*t190*t89
      t216 = t74*(-0.8309097827459833D0/t77/t15*t179
     #+0.199418347859036D1*t78*t173-0.4945709824779306D0*t180
     #+0.1483712947433792D1*t174-0.2001071587498409D0/t22/t15*t179
     #+0.8004286349993634D0*t82*t173-0.4215565168327908D-1/t16/t15
     #*t179+0.2529339100996745D0*t85*t173)*t89
      t218 = t72**2
      t221 = t29**2
      t224 = t18/t218*t190/t221
      t226 = t132**2
      t227 = t58**2
      t228 = 1/t227
      t231 = t102**2
      t232 = t34*t231
      t235 = 0.1362107888567592D0*t99*t232*t37
      t236 = t50*t231
      t243 = 0.6356503479982097D0*t99*t95*t102*t37
      t245 = 1/t2/t48
      t246 = t40*t245
      t247 = 0.1059417246663683D1*t246
      t248 = t44**2
      t252 = dexp(0.4000001174672527D1*t31)
      t258 = t47/t5/t168
      t266 = 0.1767585851152839D0*t175-0.5891952837176131D-1*t181
     #+0.2842627942041896D1*t185+0.6432793688582964D2*t192
     #-0.3216396844291482D2*t216-0.5172602810955498D3*t224
      t275 = t117*sigma
      t278 = 0.2724215777135184D0*t275*t232*t252
      t282 = 0.1362107888567592D0*t99*t34*t266*t37
      t288 = sigma*t245*t55
      t293 = 1/t113/t53
      t294 = t43*t293
      t295 = t128**2
      t305 = t109*t114
      t325 = dlog(1.D0+0.2960874997779344D2/(0.8157414703487641D1*t19
     #+0.2247591863577616D1*t16+0.4300972471276643D0*t22
     #+0.1911512595127338D0*t24))
      t327 = (1.D0+0.6901399211255825D-1*t16)*t325*t68
      t329 = t59*t68
      t335 = -0.1086299437397317D1*t327+0.1333333724890842D1*t31*t68
      t339 = 0.1362107888567592D0*t99*t34*t335*t37
      t340 = 0.6053812838078188D-1*t246
      t362 = -t335
      t366 = 0.1362107888567592D0*t99*t34*t362*t37
      t367 = 0.6053812838078188D-1*t246
      s1 = 0.1099109305675375D-1*t70+0.4D1*t91+0.1243627634786196D0
     #*t134-0.2258606682377246D-1*t96*t10
      s2 = s1-0.6564966812284644D0/t5*t12+0.4295464316882713D-3/t168
     #*t46*t10
      s3 = s2+2.D0*rho*(-0.5495546528376876D-2*t175
     #+0.1831848842792292D-2*t181-0.8837926660346786D-1*t185-0.2D1
     #*t192+0.1D1*t216+0.1608197949869254D2*t224-0.310906908696549D-1
     #*t226*t228+0.310906908696549D-1*(-0.1362107888567592D0*t35*t115*
     #(-t235-0.3710675800196129D-1*t118*t236*t37+t243+t247
     #+0.1113202740058839D0/t248*t46*t236*t252+0.4906338002481548D0
     #*t258-0.3710675800196129D-1*t118*t50*t266*t37
     #+0.3463297413516387D0*t118*t125*t102*t37+t278-t282)
     #+0.1059417246663683D1*t288-0.6356503479982097D0*t96*t110
     #+0.2724215777135184D0*t35*t294*t295+0.1362107888567592D0*t35*
     #(t278+t243-t282-t235+t247)*t54+0.6356503479982097D0*t96*t129
     #-0.2724215777135184D0*t35*t305*t128)*t133)
      v2rhoa2(i) = s3+rho*(0.337738D-1*t327-0.207271272464366D-1*t329
     #+0.310906908696549D-1*(0.6053812838078188D-1*t288
     #+0.1362107888567592D0*t35*(-t339+t340)*t54-0.1362107888567592D0
     #*t35*t115*(-t339+t340-0.3710675800196129D-1*t118*t50*t335*t37
     #+0.1649189244531613D-1*t258))*t133)+rho*(-0.337738D-1*t327
     #+0.207271272464366D-1*t329+0.310906908696549D-1*(
     #-0.6053812838078188D-1*t288+0.1362107888567592D0*t35*(-t366-t367
     #)*t54-0.1362107888567592D0*t35*t115*(-t366-t367
     #-0.3710675800196129D-1*t118*t50*t362*t37-0.1649189244531613D-1
     #*t258))*t133)
      t408 = 0.1362107888567592D0*t45*t34*t102*t37
      t410 = 0.3178251739991049D0*t39*t95
      t421 = t39*t114
      v2rhoasigmaaa(i) = 0.2258606682377246D-1*t34*t10
     #-0.3221598237662035D-3/t123*sigma*t10+0.1243627634786196D0*t156
     #*t133+4.D0*rho*(0.310906908696549D-1*(-0.3178251739991049D0*t95
     #*t43*t54-0.4329121766895483D-1*sigma*t125*t145
     #+0.3178251739991049D0*t96*t153+0.1362107888567592D0*t34*t109*t54
     #+0.1362107888567592D0*t35*(-t408-t410)*t54-0.1362107888567592D0
     #*t35*t305*t152-0.1362107888567592D0*t141*t114*t128
     #-0.1855337900098064D-1*t144*t421*t128+0.2724215777135184D0*t35
     #*t43*t293*t128*t152-0.1362107888567592D0*t35*t115*(-t408-t410
     #-0.7421351600392257D-1*t275*t120-0.1731648706758193D0*t99*t125))
     #*t133-0.310906908696549D-1*t132*t228*t156)
      t458 = t152**2
      t472 = t156**2
      v2sigmaaa2(i) = 0.4832397356493052D-3*t179*t10
     #+0.4974510539144783D0*rho*(0.3710675800196129D-1*t50*t39*t54
     #-0.2724215777135184D0*t141*t114*t152-0.3710675800196129D-1*t144
     #*t421*t152+0.2724215777135184D0*t35*t294*t458
     #-0.5054340779364009D-2*sigma/t48/t93*t115*t45)*t133
     #-0.4974510539144783D0*rho*t472*t228
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end

c:XC_RPBEsubrend
_ENDIF
_IF(ccpdft,all,xc_pw91)
c:XC_PW91subrstart

c    Generated: Mon Nov 19 16:11:21 GMT 2007

      subroutine uks_xc_pw91
     & (ideriv,npt,rhoa1,rhob1,sigmaaa1,sigmabb1,sigmaab1,
     &  zk,vrhoa,vrhob,vsigmaaa,vsigmabb,vsigmaab,
     &  v2rhoa2,v2rhob2,v2rhoab,
     &  v2rhoasigmaaa,v2rhoasigmaab,v2rhoasigmabb,
     &  v2rhobsigmabb,v2rhobsigmaab,v2rhobsigmaaa,
     &  v2sigmaaa2,v2sigmaaaab,v2sigmaaabb,
     &  v2sigmaab2,v2sigmaabbb,v2sigmabb2)
c
c     J.P. Perdew, J.A. Chevary, S.H. Vosko, K.A. Jackson,
c     M.R. Pederson, D.J. Singh, C. Fiolhais
c     Atoms, molecules, solids and surfaces:
c     Applications of the generalized gradient approximation
c     for exchange and correlation
c     Phys. Rev. B 46 (1992) 6671--6687
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt),rhob1(npt)
      REAL sigmaaa1(npt),sigmabb1(npt),sigmaab1(npt)
      REAL zk(npt),vrhoa(npt),vrhob(npt)
      REAL vsigmaaa(npt),vsigmabb(npt),vsigmaab(npt)
      REAL v2rhoa2(npt),v2rhob2(npt),v2rhoab(npt)
      REAL v2rhoasigmaaa(npt),v2rhoasigmaab(npt)
      REAL v2rhoasigmabb(npt),v2rhobsigmabb(npt)
      REAL v2rhobsigmaab(npt),v2rhobsigmaaa(npt)
      REAL v2sigmaaa2(npt),v2sigmaaaab(npt),v2sigmaaabb(npt)
      REAL v2sigmaab2(npt),v2sigmaabbb(npt),v2sigmabb2(npt)
      parameter(tol=1.0d-20)
      
      if (ideriv.eq.0) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t3 = t2*rhob
      t4 = dsqrt(sigmabb)
      t6 = t4/t3
      t8 = dlog(0.1000005877780776D1*t6+dsqrt(1+0.10000117555961D1*t6*
     #*2))
      t10 = 0.2520026100493014D-1*t6*t8
      t11 = rhob**2
      t12 = t2**2
      t14 = 1/t12/t11
      t17 = dexp(-0.1645530784602056D1*sigmabb*t14)
      t25 = sigmabb**2
      t26 = t11**2
      t36 = 1/rhob
      t37 = t36**(1.D0/3.D0)
      t40 = t36**(1.D0/6.D0)
      t43 = dsqrt(t36)
      t45 = t37**2
      t51 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t40
     #+0.3844746237447211D1*t37+0.1644733775567609D1*t43
     #+0.2405871291288192D0*t45))
      t52 = (1.D0+0.1274696188700087D0*t37)*t51
      t55 = 1/t2/t11
      t59 = dexp(0.2513789108010112D1*t52)
      t60 = t59-1.D0
      t61 = 1/t60
      t64 = 1/t12/t26
      t71 = t60**2
      t81 = dlog(1.D0+0.2697586091519874D1*(0.1007494971260294D0
     #*sigmabb*t55+0.2738174287780083D-1*t61*t25*t64)/(1.D0
     #+0.2717804421747983D0*t61*sigmabb*t55+0.7386460874872889D-1/t71
     #*t25*t64))
      zk(i) = -0.9305257363491D0*t3*(1.D0+t10+0.1645530784602056D-1*
     #(0.2743D0-0.1508D0*t17)*sigmabb*t14)/(1.D0+t10
     #+0.1083108625229223D-5*t25/t2/t26/rhob)+rhob*(-0.3109D-1*t52
     #+0.1236778371778789D-1*t81+0.7937005259840997D0*(0.1D-2*
     #(0.2568D1+0.1443307452126544D2*t37+0.2843543831490386D-2*t45)/
     #(1.D0+0.5411317332115466D1*t37+0.1816419932959077D0*t45
     #+0.1763993811759022D-1*t36)-0.1853571428571429D-2)*sigmabb*t55
     #*t17)
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t3 = t2*rhoa
      t4 = dsqrt(sigmaaa)
      t6 = t4/t3
      t8 = dlog(0.1000005877780776D1*t6+dsqrt(1+0.10000117555961D1*t6*
     #*2))
      t10 = 0.2520026100493014D-1*t6*t8
      t11 = rhoa**2
      t12 = t2**2
      t14 = 1/t12/t11
      t17 = dexp(-0.1645530784602056D1*sigmaaa*t14)
      t25 = sigmaaa**2
      t26 = t11**2
      t36 = 1/rhoa
      t37 = t36**(1.D0/3.D0)
      t40 = t36**(1.D0/6.D0)
      t43 = dsqrt(t36)
      t45 = t37**2
      t51 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t40
     #+0.3844746237447211D1*t37+0.1644733775567609D1*t43
     #+0.2405871291288192D0*t45))
      t52 = (1.D0+0.1274696188700087D0*t37)*t51
      t55 = 1/t2/t11
      t59 = dexp(0.2513789108010112D1*t52)
      t60 = t59-1.D0
      t61 = 1/t60
      t64 = 1/t12/t26
      t71 = t60**2
      t81 = dlog(1.D0+0.2697586091519874D1*(0.1007494971260294D0
     #*sigmaaa*t55+0.2738174287780083D-1*t61*t25*t64)/(1.D0
     #+0.2717804421747983D0*t61*sigmaaa*t55+0.7386460874872889D-1/t71
     #*t25*t64))
      zk(i) = -0.9305257363491D0*t3*(1.D0+t10+0.1645530784602056D-1*
     #(0.2743D0-0.1508D0*t17)*sigmaaa*t14)/(1.D0+t10
     #+0.1083108625229223D-5*t25/t2/t26/rhoa)+rhoa*(-0.3109D-1*t52
     #+0.1236778371778789D-1*t81+0.7937005259840997D0*(0.1D-2*
     #(0.2568D1+0.1443307452126544D2*t37+0.2843543831490386D-2*t45)/
     #(1.D0+0.5411317332115466D1*t37+0.1816419932959077D0*t45
     #+0.1763993811759022D-1*t36)-0.1853571428571429D-2)*sigmaaa*t55
     #*t17)
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t5 = t4*rhoa
      t6 = dsqrt(sigmaaa)
      t8 = t6/t5
      t10 = dlog(0.1000005877780776D1*t8+dsqrt(1+0.10000117555961D1*t8
     #**2))
      t12 = 0.2520026100493014D-1*t8*t10
      t13 = rhoa**2
      t14 = t4**2
      t16 = 1/t14/t13
      t19 = dexp(-0.1645530784602056D1*sigmaaa*t16)
      t27 = sigmaaa**2
      t28 = t13**2
      t38 = rhob**(1.D0/3.D0)
      t39 = t38*rhob
      t40 = dsqrt(sigmabb)
      t42 = t40/t39
      t44 = dlog(0.1000005877780776D1*t42+dsqrt(1+0.10000117555961D1
     #*t42**2))
      t46 = 0.2520026100493014D-1*t42*t44
      t47 = rhob**2
      t48 = t38**2
      t50 = 1/t48/t47
      t53 = dexp(-0.1645530784602056D1*sigmabb*t50)
      t61 = sigmabb**2
      t62 = t47**2
      t72 = 1/rho
      t73 = t72**(1.D0/3.D0)
      t76 = t72**(1.D0/6.D0)
      t79 = dsqrt(t72)
      t81 = t73**2
      t87 = dlog(1.D0+0.160818243221511D2/(0.598255043577108D1*t76
     #+0.2225569421150687D1*t73+0.8004286349993634D0*t79
     #+0.1897004325747559D0*t81))
      t89 = 0.62182D-1*(1.D0+0.1325688999052018D0*t73)*t87
      t100 = dlog(1.D0+0.2960857464321668D2/(0.8157414703487641D1*t76
     #+0.2247591863577616D1*t73+0.4300972471276643D0*t79
     #+0.1911512595127338D0*t81))
      t103 = rhoa-1.D0*rhob
      t104 = t103*t72
      t105 = 1.D0+t104
      t106 = t105**(1.D0/3.D0)
      t109 = 1.D0-1.D0*t104
      t110 = t109**(1.D0/3.D0)
      t112 = t106*t105+t110*t109-2.D0
      t113 = t103**2
      t114 = t113**2
      t115 = rho**2
      t116 = t115**2
      t118 = t114/t116
      t123 = 0.3799574853701528D-1*(1.D0+0.6901399211255825D-1*t73)
     #*t100*t112*(1.D0-1.D0*t118)
      t134 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t76
     #+0.3844746237447211D1*t73+0.1644733775567609D1*t79
     #+0.2405871291288192D0*t81))
      t140 = 0.1923661050931536D1*(-0.3109D-1*(1.D0
     #+0.1274696188700087D0*t73)*t134+t89)*t112*t118
      t141 = t106**2
      t143 = t110**2
      t145 = 0.5D0*t141+0.5D0*t143
      t146 = t145**2
      t147 = t146*t145
      t148 = 1/t146
      t150 = rho**(1.D0/3.D0)
      t152 = 1/t150/t115
      t159 = dexp(-0.4042761511756372D2*(-t89+t123+t140)/t147)
      t160 = t159-1.D0
      t161 = 1/t160
      t162 = sigma**2
      t164 = t146**2
      t166 = t150**2
      t169 = 1/t164/t166/t116
      t177 = t160**2
      t187 = dlog(1.D0+0.2697586091519874D1*(0.634682060977037D-1
     #*sigma*t148*t152+0.1086645186223595D-1*t161*t162*t169)/(1.D0
     #+0.1712109500228824D0*t161*sigma*t148*t152+0.2931318940773793D-1
     #/t177*t162*t169))
      t208 = dexp(-0.261211729852336D1*t146/t166/t115*sigma)
      zk(i) = -0.9305257363491D0*t5*(1.D0+t12+0.1645530784602056D-1*
     #(0.2743D0-0.1508D0*t19)*sigmaaa*t16)/(1.D0+t12
     #+0.1083108625229223D-5*t27/t4/t28/rhoa)-0.9305257363491D0*t39*
     #(1.D0+t46+0.1645530784602056D-1*(0.2743D0-0.1508D0*t53)*sigmabb
     #*t50)/(1.D0+t46+0.1083108625229223D-5*t61/t38/t62/rhob)+rho*(
     #-t89+t123+t140+0.2473556743557577D-1*t147*t187+0.1D1*(0.1D-2*
     #(0.2568D1+0.1443307452126544D2*t73+0.2843543831490386D-2*t81)/
     #(1.D0+0.5411317332115466D1*t73+0.1816419932959077D0*t81
     #+0.1763993811759022D-1*t72)-0.1853571428571429D-2)*t145*sigma
     #*t152*t208)
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t3 = t2*rhob
      t4 = dsqrt(sigmabb)
      t5 = 1/t3
      t6 = t4*t5
      t8 = dlog(0.1000005877780776D1*t6+dsqrt(1+0.10000117555961D1*t6*
     #*2))
      t10 = 0.2520026100493014D-1*t6*t8
      t11 = rhob**2
      t12 = t2**2
      t14 = 1/t12/t11
      t15 = sigmabb*t14
      t17 = dexp(-0.1645530784602056D1*t15)
      t19 = 0.2743D0-0.1508D0*t17
      t20 = t19*sigmabb
      t23 = 1.D0+t10+0.1645530784602056D-1*t20*t14
      t24 = t3*t23
      t25 = sigmabb**2
      t26 = t11**2
      t27 = t26*rhob
      t29 = 1/t2/t27
      t32 = 1.D0+t10+0.1083108625229223D-5*t25*t29
      t33 = 1/t32
      t36 = 1/rhob
      t37 = t36**(1.D0/3.D0)
      t39 = 1.D0+0.1274696188700087D0*t37
      t40 = t36**(1.D0/6.D0)
      t43 = dsqrt(t36)
      t45 = t37**2
      t47 = 0.1112037486309468D2*t40+0.3844746237447211D1*t37
     #+0.1644733775567609D1*t43+0.2405871291288192D0*t45
      t50 = 1.D0+0.321646831778707D2/t47
      t51 = dlog(t50)
      t52 = t39*t51
      t53 = 0.3109D-1*t52
      t55 = 1/t2/t11
      t59 = dexp(0.2513789108010112D1*t52)
      t60 = t59-1.D0
      t61 = 1/t60
      t62 = t61*t25
      t64 = 1/t12/t26
      t67 = 0.1007494971260294D0*sigmabb*t55+0.2738174287780083D-1*t62
     #*t64
      t68 = t61*sigmabb
      t71 = t60**2
      t72 = 1/t71
      t73 = t72*t25
      t76 = 1.D0+0.2717804421747983D0*t68*t55+0.7386460874872889D-1
     #*t73*t64
      t77 = 1/t76
      t80 = 1.D0+0.2697586091519874D1*t67*t77
      t81 = dlog(t80)
      t82 = 0.1236778371778789D-1*t81
      t85 = 0.2568D1+0.1443307452126544D2*t37+0.2843543831490386D-2*t45
      t89 = 1.D0+0.5411317332115466D1*t37+0.1816419932959077D0*t45
     #+0.1763993811759022D-1*t36
      t90 = 1/t89
      t93 = 0.1D-2*t85*t90-0.1853571428571429D-2
      t94 = t93*sigmabb
      t95 = t55*t17
      t97 = 0.7937005259840997D0*t94*t95
      zk(i) = -0.9305257363491D0*t24*t33+rhob*(-t53+t82+t97)
      vrhoa(i) = 0.D0
      t105 = 0.3360034800657352D-1*t4*t55*t8
      t106 = t11*rhob
      t108 = 1/t12/t106
      t112 = dsqrt(1.D0+0.10000117555961D1*t15)
      t113 = 1/t112
      t115 = 0.3360054550205309D-1*sigmabb*t108*t113
      t116 = t26*t11
      t119 = t25/t2/t116
      t128 = t32**2
      t129 = 1/t128
      t136 = 1/t11
      t137 = 1/t45*t136
      t139 = 0.1321010150222857D-2*t137*t51
      t140 = t47**2
      t143 = t40**2
      t144 = t143**2
      t154 = 1/t37*t136
      t160 = 0.1D1*t39/t140*(-0.1853395810515781D1/t144/t40*t136
     #-0.128158207914907D1*t137-0.8223668877838045D0/t43*t136
     #-0.1603914194192128D0*t154)/t50
      t162 = 1/t2/t106
      t165 = t139+t160
      t167 = t64*t165*t59
      t171 = 1/t12/t27
      t177 = t76**2
      t179 = t67/t177
      t180 = t72*sigmabb
      t198 = 1/t80
      t206 = t89**2
      s1 = -0.12407009817988D1*t2*t23*t33-0.9305257363491D0*t3*(-t105
     #-t115-0.1088885204563779D-1*t119*t17-0.4388082092272149D-1*t20
     #*t108)*t33+0.9305257363491D0*t24*t129*(-t105-t115
     #-0.5776579334555855D-5*t119)
      vrhob(i) = s1-t53+t82+t97+rhob*(t139+t160+0.1236778371778789D-1*
     #(0.2697586091519874D1*(-0.2350821599607352D0*sigmabb*t162
     #+0.2213957124623647D1*t73*t167-0.1277814667630705D0*t62*t171)
     #*t77-0.2697586091519874D1*t179*(0.2197487022544806D2*t180*t55
     #*t165*t59-0.6341543650745294D0*t68*t162+0.1194467989321217D2/t71
     #/t60*t25*t167-0.3447015074940681D0*t73*t171))*t198
     #+0.7937005259840997D0*(0.1D-2*(-0.4811024840421814D1*t137
     #-0.1895695887660258D-2*t154)*t90-0.1D-2*t85/t206*(
     #-0.1803772444038489D1*t137-0.1210946621972718D0*t154
     #-0.1763993811759022D-1*t136))*sigmabb*t95-0.1851967893962899D1
     #*t94*t162*t17+0.3482823064697813D1*t93*t25/t116*t17)
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      t232 = 0.1260013050246507D-1/t4*t5*t8
      t234 = 0.1260020456326991D-1*t14*t113
      vsigmabb(i) = -0.9305257363491D0*t3*(t232+t234
     #+0.408331951711417D-2*t29*t17*sigmabb+0.1645530784602056D-1*t19
     #*t14)*t33+0.9305257363491D0*t24*t129*(t232+t234
     #+0.2166217250458446D-5*sigmabb*t29)+rhob*(0.1236778371778789D-1*
     #(0.2697586091519874D1*(0.1007494971260294D0*t55
     #+0.5476348575560166D-1*t68*t64)*t77-0.2697586091519874D1*t179*
     #(0.2717804421747983D0*t61*t55+0.1477292174974578D0*t180*t64))
     #*t198+0.7937005259840997D0*t93*t55*t17-0.130605864926168D1*t94
     #/t27*t17)
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t3 = t2*rhoa
      t4 = dsqrt(sigmaaa)
      t5 = 1/t3
      t6 = t4*t5
      t8 = dlog(0.1000005877780776D1*t6+dsqrt(1+0.10000117555961D1*t6*
     #*2))
      t10 = 0.2520026100493014D-1*t6*t8
      t11 = rhoa**2
      t12 = t2**2
      t14 = 1/t12/t11
      t15 = sigmaaa*t14
      t17 = dexp(-0.1645530784602056D1*t15)
      t19 = 0.2743D0-0.1508D0*t17
      t20 = t19*sigmaaa
      t23 = 1.D0+t10+0.1645530784602056D-1*t20*t14
      t24 = t3*t23
      t25 = sigmaaa**2
      t26 = t11**2
      t27 = t26*rhoa
      t29 = 1/t2/t27
      t32 = 1.D0+t10+0.1083108625229223D-5*t25*t29
      t33 = 1/t32
      t36 = 1/rhoa
      t37 = t36**(1.D0/3.D0)
      t39 = 1.D0+0.1274696188700087D0*t37
      t40 = t36**(1.D0/6.D0)
      t43 = dsqrt(t36)
      t45 = t37**2
      t47 = 0.1112037486309468D2*t40+0.3844746237447211D1*t37
     #+0.1644733775567609D1*t43+0.2405871291288192D0*t45
      t50 = 1.D0+0.321646831778707D2/t47
      t51 = dlog(t50)
      t52 = t39*t51
      t53 = 0.3109D-1*t52
      t55 = 1/t2/t11
      t59 = dexp(0.2513789108010112D1*t52)
      t60 = t59-1.D0
      t61 = 1/t60
      t62 = t61*t25
      t64 = 1/t12/t26
      t67 = 0.1007494971260294D0*sigmaaa*t55+0.2738174287780083D-1*t62
     #*t64
      t68 = t61*sigmaaa
      t71 = t60**2
      t72 = 1/t71
      t73 = t72*t25
      t76 = 1.D0+0.2717804421747983D0*t68*t55+0.7386460874872889D-1
     #*t73*t64
      t77 = 1/t76
      t80 = 1.D0+0.2697586091519874D1*t67*t77
      t81 = dlog(t80)
      t82 = 0.1236778371778789D-1*t81
      t85 = 0.2568D1+0.1443307452126544D2*t37+0.2843543831490386D-2*t45
      t89 = 1.D0+0.5411317332115466D1*t37+0.1816419932959077D0*t45
     #+0.1763993811759022D-1*t36
      t90 = 1/t89
      t93 = 0.1D-2*t85*t90-0.1853571428571429D-2
      t94 = t93*sigmaaa
      t95 = t55*t17
      t97 = 0.7937005259840997D0*t94*t95
      zk(i) = -0.9305257363491D0*t24*t33+rhoa*(-t53+t82+t97)
      t105 = 0.3360034800657352D-1*t4*t55*t8
      t106 = t11*rhoa
      t108 = 1/t12/t106
      t112 = dsqrt(1.D0+0.10000117555961D1*t15)
      t113 = 1/t112
      t115 = 0.3360054550205309D-1*sigmaaa*t108*t113
      t116 = t26*t11
      t119 = t25/t2/t116
      t128 = t32**2
      t129 = 1/t128
      t136 = 1/t11
      t137 = 1/t45*t136
      t139 = 0.1321010150222857D-2*t137*t51
      t140 = t47**2
      t143 = t40**2
      t144 = t143**2
      t154 = 1/t37*t136
      t160 = 0.1D1*t39/t140*(-0.1853395810515781D1/t144/t40*t136
     #-0.128158207914907D1*t137-0.8223668877838045D0/t43*t136
     #-0.1603914194192128D0*t154)/t50
      t162 = 1/t2/t106
      t165 = t139+t160
      t167 = t64*t165*t59
      t171 = 1/t12/t27
      t177 = t76**2
      t179 = t67/t177
      t180 = t72*sigmaaa
      t198 = 1/t80
      t206 = t89**2
      s1 = -0.12407009817988D1*t2*t23*t33-0.9305257363491D0*t3*(-t105
     #-t115-0.1088885204563779D-1*t119*t17-0.4388082092272149D-1*t20
     #*t108)*t33+0.9305257363491D0*t24*t129*(-t105-t115
     #-0.5776579334555855D-5*t119)
      vrhoa(i) = s1-t53+t82+t97+rhoa*(t139+t160+0.1236778371778789D-1*
     #(0.2697586091519874D1*(-0.2350821599607352D0*sigmaaa*t162
     #+0.2213957124623647D1*t73*t167-0.1277814667630705D0*t62*t171)
     #*t77-0.2697586091519874D1*t179*(0.2197487022544806D2*t180*t55
     #*t165*t59-0.6341543650745294D0*t68*t162+0.1194467989321217D2/t71
     #/t60*t25*t167-0.3447015074940681D0*t73*t171))*t198
     #+0.7937005259840997D0*(0.1D-2*(-0.4811024840421814D1*t137
     #-0.1895695887660258D-2*t154)*t90-0.1D-2*t85/t206*(
     #-0.1803772444038489D1*t137-0.1210946621972718D0*t154
     #-0.1763993811759022D-1*t136))*sigmaaa*t95-0.1851967893962899D1
     #*t94*t162*t17+0.3482823064697813D1*t93*t25/t116*t17)
      vrhob(i) = 0.D0
      t232 = 0.1260013050246507D-1/t4*t5*t8
      t234 = 0.1260020456326991D-1*t14*t113
      vsigmaaa(i) = -0.9305257363491D0*t3*(t232+t234
     #+0.408331951711417D-2*t29*t17*sigmaaa+0.1645530784602056D-1*t19
     #*t14)*t33+0.9305257363491D0*t24*t129*(t232+t234
     #+0.2166217250458446D-5*sigmaaa*t29)+rhoa*(0.1236778371778789D-1*
     #(0.2697586091519874D1*(0.1007494971260294D0*t55
     #+0.5476348575560166D-1*t68*t64)*t77-0.2697586091519874D1*t179*
     #(0.2717804421747983D0*t61*t55+0.1477292174974578D0*t180*t64))
     #*t198+0.7937005259840997D0*t93*t55*t17-0.130605864926168D1*t94
     #/t27*t17)
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t5 = t4*rhoa
      t6 = dsqrt(sigmaaa)
      t7 = 1/t5
      t8 = t6*t7
      t10 = dlog(0.1000005877780776D1*t8+dsqrt(1+0.10000117555961D1*t8
     #**2))
      t12 = 0.2520026100493014D-1*t8*t10
      t13 = rhoa**2
      t14 = t4**2
      t16 = 1/t14/t13
      t17 = sigmaaa*t16
      t19 = dexp(-0.1645530784602056D1*t17)
      t21 = 0.2743D0-0.1508D0*t19
      t22 = t21*sigmaaa
      t25 = 1.D0+t12+0.1645530784602056D-1*t22*t16
      t26 = t5*t25
      t27 = sigmaaa**2
      t28 = t13**2
      t31 = 1/t4/t28/rhoa
      t34 = 1.D0+t12+0.1083108625229223D-5*t27*t31
      t35 = 1/t34
      t38 = rhob**(1.D0/3.D0)
      t39 = t38*rhob
      t40 = dsqrt(sigmabb)
      t41 = 1/t39
      t42 = t40*t41
      t44 = dlog(0.1000005877780776D1*t42+dsqrt(1+0.10000117555961D1
     #*t42**2))
      t46 = 0.2520026100493014D-1*t42*t44
      t47 = rhob**2
      t48 = t38**2
      t50 = 1/t48/t47
      t51 = sigmabb*t50
      t53 = dexp(-0.1645530784602056D1*t51)
      t55 = 0.2743D0-0.1508D0*t53
      t56 = t55*sigmabb
      t59 = 1.D0+t46+0.1645530784602056D-1*t56*t50
      t60 = t39*t59
      t61 = sigmabb**2
      t62 = t47**2
      t65 = 1/t38/t62/rhob
      t68 = 1.D0+t46+0.1083108625229223D-5*t61*t65
      t69 = 1/t68
      t72 = 1/rho
      t73 = t72**(1.D0/3.D0)
      t75 = 1.D0+0.1325688999052018D0*t73
      t76 = t72**(1.D0/6.D0)
      t79 = dsqrt(t72)
      t81 = t73**2
      t83 = 0.598255043577108D1*t76+0.2225569421150687D1*t73
     #+0.8004286349993634D0*t79+0.1897004325747559D0*t81
      t86 = 1.D0+0.160818243221511D2/t83
      t87 = dlog(t86)
      t89 = 0.62182D-1*t75*t87
      t91 = 1.D0+0.6901399211255825D-1*t73
      t96 = 0.8157414703487641D1*t76+0.2247591863577616D1*t73
     #+0.4300972471276643D0*t79+0.1911512595127338D0*t81
      t99 = 1.D0+0.2960857464321668D2/t96
      t100 = dlog(t99)
      t101 = t91*t100
      t103 = rhoa-1.D0*rhob
      t104 = t103*t72
      t105 = 1.D0+t104
      t106 = t105**(1.D0/3.D0)
      t109 = 1.D0-1.D0*t104
      t110 = t109**(1.D0/3.D0)
      t112 = t106*t105+t110*t109-2.D0
      t113 = t103**2
      t114 = t113**2
      t115 = rho**2
      t116 = t115**2
      t117 = 1/t116
      t118 = t114*t117
      t120 = 1.D0-1.D0*t118
      t123 = 0.3799574853701528D-1*t101*t112*t120
      t125 = 1.D0+0.1274696188700087D0*t73
      t130 = 0.1112037486309468D2*t76+0.3844746237447211D1*t73
     #+0.1644733775567609D1*t79+0.2405871291288192D0*t81
      t133 = 1.D0+0.321646831778707D2/t130
      t134 = dlog(t133)
      t137 = -0.3109D-1*t125*t134+t89
      t138 = t137*t112
      t140 = 0.1923661050931536D1*t138*t118
      t141 = t106**2
      t143 = t110**2
      t145 = 0.5D0*t141+0.5D0*t143
      t146 = t145**2
      t147 = t146*t145
      t148 = 1/t146
      t149 = sigma*t148
      t150 = rho**(1.D0/3.D0)
      t152 = 1/t150/t115
      t155 = -t89+t123+t140
      t156 = 1/t147
      t159 = dexp(-0.4042761511756372D2*t155*t156)
      t160 = t159-1.D0
      t161 = 1/t160
      t162 = sigma**2
      t163 = t161*t162
      t164 = t146**2
      t165 = 1/t164
      t166 = t150**2
      t168 = 1/t166/t116
      t169 = t165*t168
      t172 = 0.634682060977037D-1*t149*t152+0.1086645186223595D-1*t163
     #*t169
      t173 = t161*sigma
      t174 = t148*t152
      t177 = t160**2
      t178 = 1/t177
      t179 = t178*t162
      t182 = 1.D0+0.1712109500228824D0*t173*t174+0.2931318940773793D-1
     #*t179*t169
      t183 = 1/t182
      t186 = 1.D0+0.2697586091519874D1*t172*t183
      t187 = dlog(t186)
      t189 = 0.2473556743557577D-1*t147*t187
      t192 = 0.2568D1+0.1443307452126544D2*t73+0.2843543831490386D-2*t81
      t196 = 1.D0+0.5411317332115466D1*t73+0.1816419932959077D0*t81
     #+0.1763993811759022D-1*t72
      t197 = 1/t196
      t200 = 0.1D-2*t192*t197-0.1853571428571429D-2
      t201 = t200*t145
      t204 = 1/t166/t115
      t208 = dexp(-0.261211729852336D1*t146*t204*sigma)
      t209 = sigma*t152*t208
      t211 = 0.1D1*t201*t209
      zk(i) = -0.9305257363491D0*t26*t35-0.9305257363491D0*t60*t69+rho
     #*(-t89+t123+t140+t189+t211)
      t221 = 0.3360034800657352D-1*t6/t4/t13*t10
      t224 = 1/t14/t13/rhoa
      t228 = dsqrt(1.D0+0.10000117555961D1*t17)
      t229 = 1/t228
      t231 = 0.3360054550205309D-1*sigmaaa*t224*t229
      t235 = t27/t4/t28/t13
      t244 = t34**2
      t245 = 1/t244
      t255 = 0.1333333333333333D1*t106*t72-0.1333333333333333D1*t110*t72
      t258 = 0.3799574853701528D-1*t101*t255*t120
      t259 = t113*t103
      t262 = t101*t112*t259*t117
      t263 = 0.1519829941480611D0*t262
      t266 = 0.1923661050931536D1*t137*t255*t118
      t268 = t138*t259*t117
      t269 = 0.7694644203726145D1*t268
      t270 = t146*t187
      t271 = 1/t106
      t274 = 1/t110
      t277 = 0.3333333333333333D0*t271*t72-0.3333333333333333D0*t274*t72
      t280 = sigma*t156
      t284 = t179*t165
      t288 = t155*t165
      t291 = -0.4042761511756372D2*(t258-t263+t266+t269)*t156
     #+0.1212828453526912D3*t288*t277
      t293 = t168*t291*t159
      t298 = 1/t164/t145*t168
      t299 = t298*t277
      t305 = t182**2
      t307 = t172/t305
      t308 = t178*sigma
      t309 = t308*t148
      t314 = t156*t152
      t321 = 1/t177/t160*t162*t165
      t331 = 1/t186
      t338 = t200*t146*t162
      t339 = t116*rho
      t340 = 1/t339
      t348 = 1/t115
      t349 = 1/t81*t348
      t350 = t349*t87
      t351 = 0.2747799777968419D-2*t350
      t352 = t83**2
      t355 = t76**2
      t356 = t355**2
      t359 = 1/t356/t76*t348
      t363 = 1/t79*t348
      t366 = 1/t73*t348
      t371 = t75/t352*(-0.99709173929518D0*t359-0.7418564737168958D0
     #*t349-0.4002143174996817D0*t363-0.1264669550498372D0*t366)/t86
      t372 = 0.1D1*t371
      t376 = 0.8740794299481065D-3*t349*t100*t112*t120
      t377 = t96**2
      t390 = 0.1124999956683108D1*t91/t377*(-0.135956911724794D1*t359
     #-0.7491972878592054D0*t349-0.2150486235638321D0*t363
     #-0.1274341730084892D0*t366)/t99*t112*t120
      t397 = -0.1333333333333333D1*t106*t103*t348+0.1333333333333333D1
     #*t110*t103*t348
      t400 = 0.3799574853701528D-1*t101*t397*t120
      t404 = 0.1519829941480611D0*t101*t112*t114*t340
      t407 = t130**2
      t424 = 0.1923661050931536D1*(0.1321010150222857D-2*t349*t134
     #+0.1D1*t125/t407*(-0.1853395810515781D1*t359-0.128158207914907D1
     #*t349-0.8223668877838045D0*t363-0.1603914194192128D0*t366)/t133
     #-0.2747799777968419D-2*t350-0.1D1*t371)*t112*t118
      t427 = 0.1923661050931536D1*t137*t397*t118
      t430 = 0.7694644203726145D1*t138*t114*t340
      t437 = -0.3333333333333333D0*t271*t103*t348+0.3333333333333333D0
     #*t274*t103*t348
      t443 = t115*rho
      t445 = 1/t150/t443
      t453 = -0.4042761511756372D2*(t351+t372-t376-t390+t400+t404+t424
     #+t427-t430)*t156+0.1212828453526912D3*t288*t437
      t455 = t168*t453*t159
      t458 = t298*t437
      t463 = t165/t166/t339
      t497 = t196**2
      s1 = t351+t372-t376-t390+t400+t404+t424
      s2 = s1+t427-t430+0.7420670230672731D-1*t270*t437
      s3 = s2+0.2473556743557577D-1*t147*(0.2697586091519874D1*(
     #-0.1269364121954074D0*t280*t152*t437-0.148092480894642D0*t149
     #*t445-0.1086645186223595D-1*t284*t455-0.4346580744894379D-1*t163
     #*t458-0.5071010869043442D-1*t163*t463)*t183-0.2697586091519874D1
     #*t307*(-0.1712109500228824D0*t309*t152*t453*t159
     #-0.3424219000457648D0*t173*t314*t437-0.3994922167200589D0*t173
     #*t148*t445-0.5862637881547585D-1*t321*t455-0.1172527576309517D0
     #*t179*t458-0.136794883902777D0*t179*t463))*t331+0.1D1*(0.1D-2*(
     #-0.4811024840421814D1*t349-0.1895695887660258D-2*t366)*t197
     #-0.1D-2*t192/t497*(-0.1803772444038489D1*t349
     #-0.1210946621972718D0*t366-0.1763993811759022D-1*t348))*t145*t209
      t532 = s3+0.1D1*t200*t437*t209-0.2333333333333333D1*t201*sigma
     #*t445*t208+0.1D1*t201*sigma*t152*(-0.522423459704672D1*t145*t204
     #*sigma*t437+0.6965646129395627D1*t146/t166/t443*sigma)*t208
      t533 = rho*t532
      vrhoa(i) = -0.12407009817988D1*t4*t25*t35-0.9305257363491D0*t5*(
     #-t221-t231-0.1088885204563779D-1*t235*t19-0.4388082092272149D-1
     #*t22*t224)*t35+0.9305257363491D0*t26*t245*(-t221-t231
     #-0.5776579334555855D-5*t235)+rho*(t258-t263+t266+t269
     #+0.7420670230672731D-1*t270*t277+0.2473556743557577D-1*t147*
     #(0.2697586091519874D1*(-0.1269364121954074D0*t280*t152*t277
     #-0.1086645186223595D-1*t284*t293-0.4346580744894379D-1*t163*t299
     #)*t183-0.2697586091519874D1*t307*(-0.1712109500228824D0*t309
     #*t152*t291*t159-0.3424219000457648D0*t173*t314*t277
     #-0.5862637881547585D-1*t321*t293-0.1172527576309517D0*t179*t299)
     #)*t331+0.1D1*t200*t277*t209-0.522423459704672D1*t338*t340*t277
     #*t208)-t89+t123+t140+t189+t211+t533
      t541 = 0.3360034800657352D-1*t40/t38/t47*t44
      t544 = 1/t48/t47/rhob
      t548 = dsqrt(1.D0+0.10000117555961D1*t51)
      t549 = 1/t548
      t551 = 0.3360054550205309D-1*sigmabb*t544*t549
      t555 = t61/t38/t62/t47
      t564 = t68**2
      t565 = 1/t564
      t571 = -t255
      t574 = 0.3799574853701528D-1*t101*t571*t120
      t575 = 0.1519829941480611D0*t262
      t578 = 0.1923661050931536D1*t137*t571*t118
      t579 = 0.7694644203726145D1*t268
      t580 = -t277
      t591 = -0.4042761511756372D2*(t574+t575+t578-t579)*t156
     #+0.1212828453526912D3*t288*t580
      t593 = t168*t591*t159
      t596 = t298*t580
      vrhob(i) = -0.12407009817988D1*t38*t59*t69-0.9305257363491D0*t39
     #*(-t541-t551-0.1088885204563779D-1*t555*t53
     #-0.4388082092272149D-1*t56*t544)*t69+0.9305257363491D0*t60*t565*
     #(-t541-t551-0.5776579334555855D-5*t555)+rho*(t574+t575+t578-t579
     #+0.7420670230672731D-1*t270*t580+0.2473556743557577D-1*t147*
     #(0.2697586091519874D1*(-0.1269364121954074D0*t280*t152*t580
     #-0.1086645186223595D-1*t284*t593-0.4346580744894379D-1*t163*t596
     #)*t183-0.2697586091519874D1*t307*(-0.1712109500228824D0*t309
     #*t152*t591*t159-0.3424219000457648D0*t173*t314*t580
     #-0.5862637881547585D-1*t321*t593-0.1172527576309517D0*t179*t596)
     #)*t331+0.1D1*t200*t580*t209-0.522423459704672D1*t338*t340*t580
     #*t208)-t89+t123+t140+t189+t211+t533
      t632 = 0.1260013050246507D-1/t6*t7*t10
      t634 = 0.1260020456326991D-1*t16*t229
      t677 = rho*(0.2473556743557577D-1*t147*(0.2697586091519874D1*
     #(0.634682060977037D-1*t174+0.2173290372447189D-1*t173*t169)*t183
     #-0.2697586091519874D1*t307*(0.1712109500228824D0*t161*t148*t152
     #+0.5862637881547585D-1*t308*t169))*t331+0.1D1*t201*t152*t208
     #-0.261211729852336D1*t200*t147*sigma*t340*t208)
      vsigmaaa(i) = -0.9305257363491D0*t5*(t632+t634
     #+0.408331951711417D-2*t31*t19*sigmaaa+0.1645530784602056D-1*t21
     #*t16)*t35+0.9305257363491D0*t26*t245*(t632+t634
     #+0.2166217250458446D-5*sigmaaa*t31)+t677
      vsigmaab(i) = 2.D0*t677
      t681 = 0.1260013050246507D-1/t40*t41*t44
      t683 = 0.1260020456326991D-1*t50*t549
      vsigmabb(i) = -0.9305257363491D0*t39*(t681+t683
     #+0.408331951711417D-2*t65*t53*sigmabb+0.1645530784602056D-1*t55
     #*t50)*t69+0.9305257363491D0*t60*t565*(t681+t683
     #+0.2166217250458446D-5*sigmabb*t65)+t677
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t3 = t2*rhob
      t4 = dsqrt(sigmabb)
      t5 = 1/t3
      t6 = t4*t5
      t8 = dlog(0.1000005877780776D1*t6+dsqrt(1+0.10000117555961D1*t6*
     #*2))
      t10 = 0.2520026100493014D-1*t6*t8
      t11 = rhob**2
      t12 = t2**2
      t14 = 1/t12/t11
      t15 = sigmabb*t14
      t17 = dexp(-0.1645530784602056D1*t15)
      t19 = 0.2743D0-0.1508D0*t17
      t20 = t19*sigmabb
      t23 = 1.D0+t10+0.1645530784602056D-1*t20*t14
      t24 = t3*t23
      t25 = sigmabb**2
      t26 = t11**2
      t27 = t26*rhob
      t29 = 1/t2/t27
      t32 = 1.D0+t10+0.1083108625229223D-5*t25*t29
      t33 = 1/t32
      t36 = 1/rhob
      t37 = t36**(1.D0/3.D0)
      t39 = 1.D0+0.1274696188700087D0*t37
      t40 = t36**(1.D0/6.D0)
      t43 = dsqrt(t36)
      t45 = t37**2
      t47 = 0.1112037486309468D2*t40+0.3844746237447211D1*t37
     #+0.1644733775567609D1*t43+0.2405871291288192D0*t45
      t50 = 1.D0+0.321646831778707D2/t47
      t51 = dlog(t50)
      t52 = t39*t51
      t53 = 0.3109D-1*t52
      t55 = 1/t2/t11
      t59 = dexp(0.2513789108010112D1*t52)
      t60 = t59-1.D0
      t61 = 1/t60
      t62 = t61*t25
      t64 = 1/t12/t26
      t67 = 0.1007494971260294D0*sigmabb*t55+0.2738174287780083D-1*t62
     #*t64
      t68 = t61*sigmabb
      t71 = t60**2
      t72 = 1/t71
      t73 = t72*t25
      t76 = 1.D0+0.2717804421747983D0*t68*t55+0.7386460874872889D-1
     #*t73*t64
      t77 = 1/t76
      t80 = 1.D0+0.2697586091519874D1*t67*t77
      t81 = dlog(t80)
      t82 = 0.1236778371778789D-1*t81
      t85 = 0.2568D1+0.1443307452126544D2*t37+0.2843543831490386D-2*t45
      t89 = 1.D0+0.5411317332115466D1*t37+0.1816419932959077D0*t45
     #+0.1763993811759022D-1*t36
      t90 = 1/t89
      t93 = 0.1D-2*t85*t90-0.1853571428571429D-2
      t94 = t93*sigmabb
      t95 = t55*t17
      t97 = 0.7937005259840997D0*t94*t95
      zk(i) = -0.9305257363491D0*t24*t33+rhob*(-t53+t82+t97)
      vrhoa(i) = 0.D0
      t100 = t2*t23
      t105 = 0.3360034800657352D-1*t4*t55*t8
      t106 = t11*rhob
      t108 = 1/t12/t106
      t111 = 1.D0+0.10000117555961D1*t15
      t112 = dsqrt(t111)
      t113 = 1/t112
      t115 = 0.3360054550205309D-1*sigmabb*t108*t113
      t116 = t26*t11
      t119 = t25/t2/t116
      t124 = -t105-t115-0.1088885204563779D-1*t119*t17
     #-0.4388082092272149D-1*t20*t108
      t125 = t3*t124
      t128 = t32**2
      t129 = 1/t128
      t131 = -t105-t115-0.5776579334555855D-5*t119
      t132 = t129*t131
      t135 = 1/t45
      t136 = 1/t11
      t137 = t135*t136
      t138 = t137*t51
      t139 = 0.1321010150222857D-2*t138
      t140 = t47**2
      t141 = 1/t140
      t142 = t39*t141
      t143 = t40**2
      t144 = t143**2
      t145 = t144*t40
      t146 = 1/t145
      t150 = 1/t43
      t153 = 1/t37
      t154 = t153*t136
      t156 = -0.1853395810515781D1*t146*t136-0.128158207914907D1*t137
     #-0.8223668877838045D0*t150*t136-0.1603914194192128D0*t154
      t157 = 1/t50
      t159 = t142*t156*t157
      t160 = 0.1D1*t159
      t162 = 1/t2/t106
      t165 = t139+t160
      t167 = t64*t165*t59
      t171 = 1/t12/t27
      t174 = -0.2350821599607352D0*sigmabb*t162+0.2213957124623647D1
     #*t73*t167-0.1277814667630705D0*t62*t171
      t177 = t76**2
      t178 = 1/t177
      t179 = t67*t178
      t180 = t72*sigmabb
      t188 = 1/t71/t60
      t189 = t188*t25
      t194 = 0.2197487022544806D2*t180*t55*t165*t59
     #-0.6341543650745294D0*t68*t162+0.1194467989321217D2*t189*t167
     #-0.3447015074940681D0*t73*t171
      t197 = 0.2697586091519874D1*t174*t77-0.2697586091519874D1*t179
     #*t194
      t198 = 1/t80
      t199 = t197*t198
      t203 = -0.4811024840421814D1*t137-0.1895695887660258D-2*t154
      t206 = t89**2
      t207 = 1/t206
      t208 = t85*t207
      t212 = -0.1803772444038489D1*t137-0.1210946621972718D0*t154
     #-0.1763993811759022D-1*t136
      t215 = 0.1D-2*t203*t90-0.1D-2*t208*t212
      t216 = t215*sigmabb
      t217 = t216*t95
      t219 = t162*t17
      t220 = t94*t219
      t222 = t93*t25
      t224 = 1/t116*t17
      t225 = t222*t224
      vrhob(i) = -0.12407009817988D1*t100*t33-0.9305257363491D0*t125
     #*t33+0.9305257363491D0*t24*t132-t53+t82+t97+rhob*(t139+t160
     #+0.1236778371778789D-1*t199+0.7937005259840997D0*t217
     #-0.1851967893962899D1*t220+0.3482823064697813D1*t225)
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      t232 = 0.1260013050246507D-1/t4*t5*t8
      t234 = 0.1260020456326991D-1*t14*t113
      t235 = t29*t17
      t241 = t3*(t232+t234+0.408331951711417D-2*t235*sigmabb
     #+0.1645530784602056D-1*t19*t14)
      t246 = t232+t234+0.2166217250458446D-5*sigmabb*t29
      t247 = t129*t246
      t253 = 0.1007494971260294D0*t55+0.5476348575560166D-1*t68*t64
      t260 = 0.2717804421747983D0*t61*t55+0.1477292174974578D0*t180*t64
      t263 = 0.2697586091519874D1*t253*t77-0.2697586091519874D1*t179
     #*t260
      t269 = 1/t27
      vsigmabb(i) = -0.9305257363491D0*t241*t33+0.9305257363491D0*t24
     #*t247+rhob*(0.1236778371778789D-1*t263*t198+0.7937005259840997D0
     #*t93*t55*t17-0.130605864926168D1*t94*t269*t17)
      v2rhoa2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t286 = 0.7840081201533821D-1*t4*t162*t8
      t289 = 0.1680027275102654D0*sigmabb*t64*t113
      t290 = t26*t106
      t293 = t25/t2/t290
      t295 = 1/t112/t111
      t297 = 0.4480125399532632D-1*t293*t295
      t300 = t25*sigmabb
      t301 = t26**2
      t316 = 1/t128/t32
      t317 = t131**2
      t334 = dlog(1.D0+0.160818243221511D2/(0.598255043577108D1*t40
     #+0.2225569421150687D1*t37+0.8004286349993634D0*t43
     #+0.1897004325747559D0*t45))
      t346 = t156**2
      t349 = 0.2D1*t39/t140/t47*t346*t157
      t353 = 0.8497974591333914D-1*t137*t141*t156*t157
      t356 = 1/t26
      t359 = 1/t106
      t364 = 1/t45/t36*t356
      t366 = t135*t359
      t376 = 1/t37/t36*t356
      t378 = t153*t359
      t383 = 0.1D1*t142*(-0.1544496508763151D1/t145/t36*t356
     #+0.3706791621031562D1*t146*t359-0.854388052766047D0*t364
     #+0.2563164158298141D1*t366-0.4111834438919023D0/t43/t36*t356
     #+0.1644733775567609D1*t150*t359-0.5346380647307093D-1*t376
     #+0.3207828388384256D0*t378)*t157
      t384 = t140**2
      t387 = t50**2
      t391 = 0.321646831778707D2*t39/t384*t346/t387
      t397 = 0.8806734334819047D-3*t364*t51
      t399 = 0.1D-22*t366*t334
      t401 = 0.2642020300445714D-2*t366*t51
      t403 = 1/t2/t26
      t406 = t165**2
      t407 = t64*t406
      t409 = dexp(0.5027578216020225D1*t52)
      t410 = t407*t409
      t414 = t171*t165*t59
      t417 = -t399+t397-t401-t353-t349+t383+t391
      t419 = t64*t417*t59
      t422 = t407*t59
      t426 = 1/t12/t116
      t437 = t67/t177/t76
      t438 = t194**2
      t442 = t55*t406
      t459 = t71**2
      t499 = t212**2
      t514 = t197**2
      t515 = t80**2
      t516 = 1/t515
      s1 = -t349-t353+t383+t391-0.2902352553914844D2*t222/t290*t17
     #+t397-t399
      s2 = s1-t401+0.1236778371778789D-1*(0.2697586091519874D1*
     #(0.7836071998691172D0*sigmabb*t403+0.3580200260842915D3*t189
     #*t410-0.2066359982982071D2*t73*t414+0.2213957124623647D1*t73
     #*t419-0.1790100130421458D3*t73*t422+0.7240949783240664D0*t62
     #*t426)*t77-0.5395172183039748D1*t174*t178*t194
     #+0.5395172183039748D1*t437*t438-0.2697586091519874D1*t179*
     #(0.35535663829313D4*t188*sigmabb*t442*t409-0.1025493943854243D3
     #*t180*t162*t165*t59+0.2197487022544806D2*t180*t55*t417*t59
     #-0.177678319146565D4*t180*t442*t59+0.2113847883581765D1*t68*t403
     #+0.2897369528551702D4/t459*t25*t410-0.1114836790033136D3*t189
     #*t414+0.1194467989321217D2*t189*t419-0.9657898428505673D3*t189
     #*t422+0.1953308542466386D1*t73*t426))*t198-0.3703935787925799D1
     #*t216*t219
      t526 = s2+0.6965646129395627D1*t215*t25*t224
     #+0.6173226313209665D1*t94*t403*t17+0.7937005259840997D0*(0.1D-2*
     #(-0.3207349893614542D1*t364+0.9622049680843627D1*t366
     #-0.6318986292200858D-3*t376+0.3791391775320515D-2*t378)*t90
     #-0.2D-2*t203*t207*t212+0.2D-2*t85/t206/t89*t499-0.1D-2*t208*(
     #-0.1202514962692326D1*t364+0.3607544888076978D1*t366
     #-0.4036488739909061D-1*t376+0.2421893243945437D0*t378
     #+0.3527987623518044D-1*t359))*sigmabb*t95-0.1236778371778789D-1
     #*t514*t516+0.1528291352075288D2*t93*t300/t12/t301/rhob*t17
      v2rhob2(i) = -0.4135669939329333D0/t12*t23*t33
     #-0.24814019635976D1*t2*t124*t33+0.24814019635976D1*t100*t132
     #-0.9305257363491D0*t3*(t286+t289-t297+0.9799966841074009D-1*t293
     #*t17-0.4778117666686413D-1*t300/t301/t11*t17
     #+0.1608963433833121D0*t20*t64)*t33+0.18610514726982D1*t125*t132
     #-0.18610514726982D1*t24*t316*t317+0.9305257363491D0*t24*t129*
     #(t286+t289-t297+0.3658500245218708D-4*t293)-0.1D-22*t137*t334
     #+0.2642020300445714D-2*t138+0.2D1*t159+0.2473556743557577D-1
     #*t199+0.1587401051968199D1*t217-0.3703935787925799D1*t220
     #+0.6965646129395627D1*t225+rhob*t526
      v2sigmaaa2(i) = 0.D0
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      t532 = 0.6300065251232535D-2/t4/sigmabb*t5*t8
      t536 = 0.6300102281634954D-2/sigmabb*t14*t113
      t538 = 0.6300176343092764D-2*t29*t295
      t550 = t246**2
      t565 = t260**2
      t574 = t263**2
      v2sigmabb2(i) = -0.9305257363491D0*t3*(-t532+t536-t538
     #-0.6719227968777768D-2/t301*t17*sigmabb+0.8166639034228341D-2
     #*t235)*t33+0.18610514726982D1*t241*t247-0.18610514726982D1*t24
     #*t316*t550+0.9305257363491D0*t24*t129*(-t532+t536-t538
     #+0.2166217250458446D-5*t29)+rhob*(0.1236778371778789D-1*
     #(0.1477292174974578D0*t61*t64*t77-0.5395172183039748D1*t253*t178
     #*t260+0.5395172183039748D1*t437*t565-0.3985122824322565D0*t179
     #*t72*t64)*t198-0.1236778371778789D-1*t574*t516
     #-0.261211729852336D1*t93*t269*t17+0.2149159713855873D1*t94/t12
     #/t290*t17)
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t3 = t2*rhoa
      t4 = dsqrt(sigmaaa)
      t5 = 1/t3
      t6 = t4*t5
      t8 = dlog(0.1000005877780776D1*t6+dsqrt(1+0.10000117555961D1*t6*
     #*2))
      t10 = 0.2520026100493014D-1*t6*t8
      t11 = rhoa**2
      t12 = t2**2
      t14 = 1/t12/t11
      t15 = sigmaaa*t14
      t17 = dexp(-0.1645530784602056D1*t15)
      t19 = 0.2743D0-0.1508D0*t17
      t20 = t19*sigmaaa
      t23 = 1.D0+t10+0.1645530784602056D-1*t20*t14
      t24 = t3*t23
      t25 = sigmaaa**2
      t26 = t11**2
      t27 = t26*rhoa
      t29 = 1/t2/t27
      t32 = 1.D0+t10+0.1083108625229223D-5*t25*t29
      t33 = 1/t32
      t36 = 1/rhoa
      t37 = t36**(1.D0/3.D0)
      t39 = 1.D0+0.1274696188700087D0*t37
      t40 = t36**(1.D0/6.D0)
      t43 = dsqrt(t36)
      t45 = t37**2
      t47 = 0.1112037486309468D2*t40+0.3844746237447211D1*t37
     #+0.1644733775567609D1*t43+0.2405871291288192D0*t45
      t50 = 1.D0+0.321646831778707D2/t47
      t51 = dlog(t50)
      t52 = t39*t51
      t53 = 0.3109D-1*t52
      t55 = 1/t2/t11
      t59 = dexp(0.2513789108010112D1*t52)
      t60 = t59-1.D0
      t61 = 1/t60
      t62 = t61*t25
      t64 = 1/t12/t26
      t67 = 0.1007494971260294D0*sigmaaa*t55+0.2738174287780083D-1*t62
     #*t64
      t68 = t61*sigmaaa
      t71 = t60**2
      t72 = 1/t71
      t73 = t72*t25
      t76 = 1.D0+0.2717804421747983D0*t68*t55+0.7386460874872889D-1
     #*t73*t64
      t77 = 1/t76
      t80 = 1.D0+0.2697586091519874D1*t67*t77
      t81 = dlog(t80)
      t82 = 0.1236778371778789D-1*t81
      t85 = 0.2568D1+0.1443307452126544D2*t37+0.2843543831490386D-2*t45
      t89 = 1.D0+0.5411317332115466D1*t37+0.1816419932959077D0*t45
     #+0.1763993811759022D-1*t36
      t90 = 1/t89
      t93 = 0.1D-2*t85*t90-0.1853571428571429D-2
      t94 = t93*sigmaaa
      t95 = t55*t17
      t97 = 0.7937005259840997D0*t94*t95
      zk(i) = -0.9305257363491D0*t24*t33+rhoa*(-t53+t82+t97)
      t100 = t2*t23
      t105 = 0.3360034800657352D-1*t4*t55*t8
      t106 = t11*rhoa
      t108 = 1/t12/t106
      t111 = 1.D0+0.10000117555961D1*t15
      t112 = dsqrt(t111)
      t113 = 1/t112
      t115 = 0.3360054550205309D-1*sigmaaa*t108*t113
      t116 = t26*t11
      t119 = t25/t2/t116
      t124 = -t105-t115-0.1088885204563779D-1*t119*t17
     #-0.4388082092272149D-1*t20*t108
      t125 = t3*t124
      t128 = t32**2
      t129 = 1/t128
      t131 = -t105-t115-0.5776579334555855D-5*t119
      t132 = t129*t131
      t135 = 1/t45
      t136 = 1/t11
      t137 = t135*t136
      t138 = t137*t51
      t139 = 0.1321010150222857D-2*t138
      t140 = t47**2
      t141 = 1/t140
      t142 = t39*t141
      t143 = t40**2
      t144 = t143**2
      t145 = t144*t40
      t146 = 1/t145
      t150 = 1/t43
      t153 = 1/t37
      t154 = t153*t136
      t156 = -0.1853395810515781D1*t146*t136-0.128158207914907D1*t137
     #-0.8223668877838045D0*t150*t136-0.1603914194192128D0*t154
      t157 = 1/t50
      t159 = t142*t156*t157
      t160 = 0.1D1*t159
      t162 = 1/t2/t106
      t165 = t139+t160
      t167 = t64*t165*t59
      t171 = 1/t12/t27
      t174 = -0.2350821599607352D0*sigmaaa*t162+0.2213957124623647D1
     #*t73*t167-0.1277814667630705D0*t62*t171
      t177 = t76**2
      t178 = 1/t177
      t179 = t67*t178
      t180 = t72*sigmaaa
      t188 = 1/t71/t60
      t189 = t188*t25
      t194 = 0.2197487022544806D2*t180*t55*t165*t59
     #-0.6341543650745294D0*t68*t162+0.1194467989321217D2*t189*t167
     #-0.3447015074940681D0*t73*t171
      t197 = 0.2697586091519874D1*t174*t77-0.2697586091519874D1*t179
     #*t194
      t198 = 1/t80
      t199 = t197*t198
      t203 = -0.4811024840421814D1*t137-0.1895695887660258D-2*t154
      t206 = t89**2
      t207 = 1/t206
      t208 = t85*t207
      t212 = -0.1803772444038489D1*t137-0.1210946621972718D0*t154
     #-0.1763993811759022D-1*t136
      t215 = 0.1D-2*t203*t90-0.1D-2*t208*t212
      t216 = t215*sigmaaa
      t217 = t216*t95
      t219 = t162*t17
      t220 = t94*t219
      t222 = t93*t25
      t224 = 1/t116*t17
      t225 = t222*t224
      vrhoa(i) = -0.12407009817988D1*t100*t33-0.9305257363491D0*t125
     #*t33+0.9305257363491D0*t24*t132-t53+t82+t97+rhoa*(t139+t160
     #+0.1236778371778789D-1*t199+0.7937005259840997D0*t217
     #-0.1851967893962899D1*t220+0.3482823064697813D1*t225)
      vrhob(i) = 0.D0
      t232 = 0.1260013050246507D-1/t4*t5*t8
      t234 = 0.1260020456326991D-1*t14*t113
      t235 = t29*t17
      t241 = t3*(t232+t234+0.408331951711417D-2*t235*sigmaaa
     #+0.1645530784602056D-1*t19*t14)
      t246 = t232+t234+0.2166217250458446D-5*sigmaaa*t29
      t247 = t129*t246
      t253 = 0.1007494971260294D0*t55+0.5476348575560166D-1*t68*t64
      t260 = 0.2717804421747983D0*t61*t55+0.1477292174974578D0*t180*t64
      t263 = 0.2697586091519874D1*t253*t77-0.2697586091519874D1*t179
     #*t260
      t269 = 1/t27
      vsigmaaa(i) = -0.9305257363491D0*t241*t33+0.9305257363491D0*t24
     #*t247+rhoa*(0.1236778371778789D-1*t263*t198+0.7937005259840997D0
     #*t93*t55*t17-0.130605864926168D1*t94*t269*t17)
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      t286 = 0.7840081201533821D-1*t4*t162*t8
      t289 = 0.1680027275102654D0*sigmaaa*t64*t113
      t290 = t26*t106
      t293 = t25/t2/t290
      t295 = 1/t112/t111
      t297 = 0.4480125399532632D-1*t293*t295
      t300 = t25*sigmaaa
      t301 = t26**2
      t316 = 1/t128/t32
      t317 = t131**2
      t334 = dlog(1.D0+0.160818243221511D2/(0.598255043577108D1*t40
     #+0.2225569421150687D1*t37+0.8004286349993634D0*t43
     #+0.1897004325747559D0*t45))
      t346 = t156**2
      t349 = 0.2D1*t39/t140/t47*t346*t157
      t353 = 0.8497974591333914D-1*t137*t141*t156*t157
      t356 = 1/t26
      t359 = 1/t106
      t364 = 1/t45/t36*t356
      t366 = t135*t359
      t376 = 1/t37/t36*t356
      t378 = t153*t359
      t383 = 0.1D1*t142*(-0.1544496508763151D1/t145/t36*t356
     #+0.3706791621031562D1*t146*t359-0.854388052766047D0*t364
     #+0.2563164158298141D1*t366-0.4111834438919023D0/t43/t36*t356
     #+0.1644733775567609D1*t150*t359-0.5346380647307093D-1*t376
     #+0.3207828388384256D0*t378)*t157
      t384 = t140**2
      t387 = t50**2
      t391 = 0.321646831778707D2*t39/t384*t346/t387
      t397 = 0.8806734334819047D-3*t364*t51
      t399 = 0.1D-22*t366*t334
      t401 = 0.2642020300445714D-2*t366*t51
      t403 = 1/t2/t26
      t406 = t165**2
      t407 = t64*t406
      t409 = dexp(0.5027578216020225D1*t52)
      t410 = t407*t409
      t414 = t171*t165*t59
      t417 = -t399+t397-t401-t353-t349+t383+t391
      t419 = t64*t417*t59
      t422 = t407*t59
      t426 = 1/t12/t116
      t437 = t67/t177/t76
      t438 = t194**2
      t442 = t55*t406
      t459 = t71**2
      t499 = t212**2
      t514 = t197**2
      t515 = t80**2
      t516 = 1/t515
      s1 = -t349-t353+t383+t391-0.2902352553914844D2*t222/t290*t17
     #+t397-t399
      s2 = s1-t401+0.1236778371778789D-1*(0.2697586091519874D1*
     #(0.7836071998691172D0*sigmaaa*t403+0.3580200260842915D3*t189
     #*t410-0.2066359982982071D2*t73*t414+0.2213957124623647D1*t73
     #*t419-0.1790100130421458D3*t73*t422+0.7240949783240664D0*t62
     #*t426)*t77-0.5395172183039748D1*t174*t178*t194
     #+0.5395172183039748D1*t437*t438-0.2697586091519874D1*t179*
     #(0.35535663829313D4*t188*sigmaaa*t442*t409-0.1025493943854243D3
     #*t180*t162*t165*t59+0.2197487022544806D2*t180*t55*t417*t59
     #-0.177678319146565D4*t180*t442*t59+0.2113847883581765D1*t68*t403
     #+0.2897369528551702D4/t459*t25*t410-0.1114836790033136D3*t189
     #*t414+0.1194467989321217D2*t189*t419-0.9657898428505673D3*t189
     #*t422+0.1953308542466386D1*t73*t426))*t198-0.3703935787925799D1
     #*t216*t219
      t526 = s2+0.6965646129395627D1*t215*t25*t224
     #+0.6173226313209665D1*t94*t403*t17+0.7937005259840997D0*(0.1D-2*
     #(-0.3207349893614542D1*t364+0.9622049680843627D1*t366
     #-0.6318986292200858D-3*t376+0.3791391775320515D-2*t378)*t90
     #-0.2D-2*t203*t207*t212+0.2D-2*t85/t206/t89*t499-0.1D-2*t208*(
     #-0.1202514962692326D1*t364+0.3607544888076978D1*t366
     #-0.4036488739909061D-1*t376+0.2421893243945437D0*t378
     #+0.3527987623518044D-1*t359))*sigmaaa*t95-0.1236778371778789D-1
     #*t514*t516+0.1528291352075288D2*t93*t300/t12/t301/rhoa*t17
      v2rhoa2(i) = -0.4135669939329333D0/t12*t23*t33
     #-0.24814019635976D1*t2*t124*t33+0.24814019635976D1*t100*t132
     #-0.9305257363491D0*t3*(t286+t289-t297+0.9799966841074009D-1*t293
     #*t17-0.4778117666686413D-1*t300/t301/t11*t17
     #+0.1608963433833121D0*t20*t64)*t33+0.18610514726982D1*t125*t132
     #-0.18610514726982D1*t24*t316*t317+0.9305257363491D0*t24*t129*
     #(t286+t289-t297+0.3658500245218708D-4*t293)-0.1D-22*t137*t334
     #+0.2642020300445714D-2*t138+0.2D1*t159+0.2473556743557577D-1
     #*t199+0.1587401051968199D1*t217-0.3703935787925799D1*t220
     #+0.6965646129395627D1*t225+rhoa*t526
      v2rhob2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t532 = 0.6300065251232535D-2/t4/sigmaaa*t5*t8
      t536 = 0.6300102281634954D-2/sigmaaa*t14*t113
      t538 = 0.6300176343092764D-2*t29*t295
      t550 = t246**2
      t565 = t260**2
      t574 = t263**2
      v2sigmaaa2(i) = -0.9305257363491D0*t3*(-t532+t536-t538
     #-0.6719227968777768D-2/t301*t17*sigmaaa+0.8166639034228341D-2
     #*t235)*t33+0.18610514726982D1*t241*t247-0.18610514726982D1*t24
     #*t316*t550+0.9305257363491D0*t24*t129*(-t532+t536-t538
     #+0.2166217250458446D-5*t29)+rhoa*(0.1236778371778789D-1*
     #(0.1477292174974578D0*t61*t64*t77-0.5395172183039748D1*t253*t178
     #*t260+0.5395172183039748D1*t437*t565-0.3985122824322565D0*t179
     #*t72*t64)*t198-0.1236778371778789D-1*t574*t516
     #-0.261211729852336D1*t93*t269*t17+0.2149159713855873D1*t94/t12
     #/t290*t17)
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      v2sigmabb2(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t5 = t4*rhoa
      t6 = dsqrt(sigmaaa)
      t7 = 1/t5
      t8 = t6*t7
      t10 = dlog(0.1000005877780776D1*t8+dsqrt(1+0.10000117555961D1*t8
     #**2))
      t12 = 0.2520026100493014D-1*t8*t10
      t13 = rhoa**2
      t14 = t4**2
      t16 = 1/t14/t13
      t17 = sigmaaa*t16
      t19 = dexp(-0.1645530784602056D1*t17)
      t21 = 0.2743D0-0.1508D0*t19
      t22 = t21*sigmaaa
      t25 = 1.D0+t12+0.1645530784602056D-1*t22*t16
      t26 = t5*t25
      t27 = sigmaaa**2
      t28 = t13**2
      t31 = 1/t4/t28/rhoa
      t34 = 1.D0+t12+0.1083108625229223D-5*t27*t31
      t35 = 1/t34
      t38 = rhob**(1.D0/3.D0)
      t39 = t38*rhob
      t40 = dsqrt(sigmabb)
      t41 = 1/t39
      t42 = t40*t41
      t44 = dlog(0.1000005877780776D1*t42+dsqrt(1+0.10000117555961D1
     #*t42**2))
      t46 = 0.2520026100493014D-1*t42*t44
      t47 = rhob**2
      t48 = t38**2
      t50 = 1/t48/t47
      t51 = sigmabb*t50
      t53 = dexp(-0.1645530784602056D1*t51)
      t55 = 0.2743D0-0.1508D0*t53
      t56 = t55*sigmabb
      t59 = 1.D0+t46+0.1645530784602056D-1*t56*t50
      t60 = t39*t59
      t61 = sigmabb**2
      t62 = t47**2
      t65 = 1/t38/t62/rhob
      t68 = 1.D0+t46+0.1083108625229223D-5*t61*t65
      t69 = 1/t68
      t72 = 1/rho
      t73 = t72**(1.D0/3.D0)
      t75 = 1.D0+0.1325688999052018D0*t73
      t76 = t72**(1.D0/6.D0)
      t79 = dsqrt(t72)
      t81 = t73**2
      t83 = 0.598255043577108D1*t76+0.2225569421150687D1*t73
     #+0.8004286349993634D0*t79+0.1897004325747559D0*t81
      t86 = 1.D0+0.160818243221511D2/t83
      t87 = dlog(t86)
      t89 = 0.62182D-1*t75*t87
      t91 = 1.D0+0.6901399211255825D-1*t73
      t96 = 0.8157414703487641D1*t76+0.2247591863577616D1*t73
     #+0.4300972471276643D0*t79+0.1911512595127338D0*t81
      t99 = 1.D0+0.2960857464321668D2/t96
      t100 = dlog(t99)
      t101 = t91*t100
      t103 = rhoa-1.D0*rhob
      t104 = t103*t72
      t105 = 1.D0+t104
      t106 = t105**(1.D0/3.D0)
      t107 = t106*t105
      t109 = 1.D0-1.D0*t104
      t110 = t109**(1.D0/3.D0)
      t111 = t110*t109
      t112 = t107+t111-2.D0
      t113 = t103**2
      t114 = t113**2
      t115 = rho**2
      t116 = t115**2
      t117 = 1/t116
      t118 = t114*t117
      t120 = 1.D0-1.D0*t118
      t121 = t112*t120
      t123 = 0.3799574853701528D-1*t101*t121
      t125 = 1.D0+0.1274696188700087D0*t73
      t130 = 0.1112037486309468D2*t76+0.3844746237447211D1*t73
     #+0.1644733775567609D1*t79+0.2405871291288192D0*t81
      t133 = 1.D0+0.321646831778707D2/t130
      t134 = dlog(t133)
      t137 = -0.3109D-1*t125*t134+t89
      t138 = t137*t112
      t140 = 0.1923661050931536D1*t138*t118
      t141 = t106**2
      t143 = t110**2
      t145 = 0.5D0*t141+0.5D0*t143
      t146 = t145**2
      t147 = t146*t145
      t148 = 1/t146
      t149 = sigma*t148
      t150 = rho**(1.D0/3.D0)
      t152 = 1/t150/t115
      t155 = -t89+t123+t140
      t156 = 1/t147
      t157 = t155*t156
      t159 = dexp(-0.4042761511756372D2*t157)
      t160 = t159-1.D0
      t161 = 1/t160
      t162 = sigma**2
      t163 = t161*t162
      t164 = t146**2
      t165 = 1/t164
      t166 = t150**2
      t168 = 1/t166/t116
      t169 = t165*t168
      t172 = 0.634682060977037D-1*t149*t152+0.1086645186223595D-1*t163
     #*t169
      t173 = t161*sigma
      t174 = t148*t152
      t177 = t160**2
      t178 = 1/t177
      t179 = t178*t162
      t182 = 1.D0+0.1712109500228824D0*t173*t174+0.2931318940773793D-1
     #*t179*t169
      t183 = 1/t182
      t186 = 1.D0+0.2697586091519874D1*t172*t183
      t187 = dlog(t186)
      t189 = 0.2473556743557577D-1*t147*t187
      t192 = 0.2568D1+0.1443307452126544D2*t73+0.2843543831490386D-2*t81
      t196 = 1.D0+0.5411317332115466D1*t73+0.1816419932959077D0*t81
     #+0.1763993811759022D-1*t72
      t197 = 1/t196
      t200 = 0.1D-2*t192*t197-0.1853571428571429D-2
      t201 = t200*t145
      t204 = 1/t166/t115
      t208 = dexp(-0.261211729852336D1*t146*t204*sigma)
      t209 = sigma*t152*t208
      t211 = 0.1D1*t201*t209
      zk(i) = -0.9305257363491D0*t26*t35-0.9305257363491D0*t60*t69+rho
     #*(-t89+t123+t140+t189+t211)
      t214 = t4*t25
      t218 = 1/t4/t13
      t221 = 0.3360034800657352D-1*t6*t218*t10
      t222 = t13*rhoa
      t224 = 1/t14/t222
      t227 = 1.D0+0.10000117555961D1*t17
      t228 = dsqrt(t227)
      t229 = 1/t228
      t231 = 0.3360054550205309D-1*sigmaaa*t224*t229
      t234 = 1/t4/t28/t13
      t235 = t27*t234
      t240 = -t221-t231-0.1088885204563779D-1*t235*t19
     #-0.4388082092272149D-1*t22*t224
      t241 = t5*t240
      t244 = t34**2
      t245 = 1/t244
      t247 = -t221-t231-0.5776579334555855D-5*t235
      t248 = t245*t247
      t255 = 0.1333333333333333D1*t106*t72-0.1333333333333333D1*t110*t72
      t257 = t101*t255*t120
      t258 = 0.3799574853701528D-1*t257
      t259 = t113*t103
      t260 = t112*t259
      t262 = t101*t260*t117
      t263 = 0.1519829941480611D0*t262
      t264 = t137*t255
      t265 = t264*t118
      t266 = 0.1923661050931536D1*t265
      t267 = t259*t117
      t268 = t138*t267
      t269 = 0.7694644203726145D1*t268
      t270 = t146*t187
      t271 = 1/t106
      t274 = 1/t110
      t277 = 0.3333333333333333D0*t271*t72-0.3333333333333333D0*t274*t72
      t278 = t270*t277
      t279 = 0.7420670230672731D-1*t278
      t280 = sigma*t156
      t281 = t152*t277
      t284 = t179*t165
      t285 = t258-t263+t266+t269
      t288 = t155*t165
      t291 = -0.4042761511756372D2*t285*t156+0.1212828453526912D3*t288
     #*t277
      t292 = t168*t291
      t293 = t292*t159
      t296 = t164*t145
      t297 = 1/t296
      t298 = t297*t168
      t299 = t298*t277
      t302 = -0.1269364121954074D0*t280*t281-0.1086645186223595D-1
     #*t284*t293-0.4346580744894379D-1*t163*t299
      t305 = t182**2
      t306 = 1/t305
      t307 = t172*t306
      t308 = t178*sigma
      t309 = t308*t148
      t310 = t152*t291
      t311 = t310*t159
      t314 = t156*t152
      t315 = t314*t277
      t319 = 1/t177/t160
      t320 = t319*t162
      t321 = t320*t165
      t326 = -0.1712109500228824D0*t309*t311-0.3424219000457648D0*t173
     #*t315-0.5862637881547585D-1*t321*t293-0.1172527576309517D0*t179
     #*t299
      t329 = 0.2697586091519874D1*t302*t183-0.2697586091519874D1*t307
     #*t326
      t330 = t147*t329
      t331 = 1/t186
      t332 = t330*t331
      t333 = 0.2473556743557577D-1*t332
      t334 = t200*t277
      t335 = t334*t209
      t336 = 0.1D1*t335
      t338 = t200*t146*t162
      t339 = t116*rho
      t340 = 1/t339
      t342 = t340*t277*t208
      t343 = t338*t342
      t344 = 0.522423459704672D1*t343
      t347 = 1/t81
      t348 = 1/t115
      t349 = t347*t348
      t350 = t349*t87
      t351 = 0.2747799777968419D-2*t350
      t352 = t83**2
      t353 = 1/t352
      t354 = t75*t353
      t355 = t76**2
      t356 = t355**2
      t357 = t356*t76
      t358 = 1/t357
      t359 = t358*t348
      t362 = 1/t79
      t363 = t362*t348
      t365 = 1/t73
      t366 = t365*t348
      t368 = -0.99709173929518D0*t359-0.7418564737168958D0*t349
     #-0.4002143174996817D0*t363-0.1264669550498372D0*t366
      t369 = 1/t86
      t371 = t354*t368*t369
      t372 = 0.1D1*t371
      t373 = t100*t112
      t374 = t373*t120
      t375 = t349*t374
      t376 = 0.8740794299481065D-3*t375
      t377 = t96**2
      t378 = 1/t377
      t379 = t91*t378
      t384 = -0.135956911724794D1*t359-0.7491972878592054D0*t349
     #-0.2150486235638321D0*t363-0.1274341730084892D0*t366
      t385 = t379*t384
      t386 = 1/t99
      t387 = t386*t112
      t388 = t387*t120
      t389 = t385*t388
      t390 = 0.1124999956683108D1*t389
      t391 = t106*t103
      t394 = t110*t103
      t397 = -0.1333333333333333D1*t391*t348+0.1333333333333333D1*t394
     #*t348
      t399 = t101*t397*t120
      t400 = 0.3799574853701528D-1*t399
      t401 = t112*t114
      t403 = t101*t401*t340
      t404 = 0.1519829941480611D0*t403
      t407 = t130**2
      t408 = 1/t407
      t409 = t125*t408
      t414 = -0.1853395810515781D1*t359-0.128158207914907D1*t349
     #-0.8223668877838045D0*t363-0.1603914194192128D0*t366
      t415 = 1/t133
      t421 = 0.1321010150222857D-2*t349*t134+0.1D1*t409*t414*t415
     #-0.2747799777968419D-2*t350-0.1D1*t371
      t422 = t421*t112
      t423 = t422*t118
      t424 = 0.1923661050931536D1*t423
      t425 = t137*t397
      t426 = t425*t118
      t427 = 0.1923661050931536D1*t426
      t428 = t114*t340
      t429 = t138*t428
      t430 = 0.7694644203726145D1*t429
      t431 = t271*t103
      t434 = t274*t103
      t437 = -0.3333333333333333D0*t431*t348+0.3333333333333333D0*t434
     #*t348
      t438 = t270*t437
      t440 = t152*t437
      t443 = t115*rho
      t445 = 1/t150/t443
      t448 = t351+t372-t376-t390+t400+t404+t424+t427-t430
      t453 = -0.4042761511756372D2*t448*t156+0.1212828453526912D3*t288
     #*t437
      t454 = t168*t453
      t455 = t454*t159
      t458 = t298*t437
      t462 = 1/t166/t339
      t463 = t165*t462
      t466 = -0.1269364121954074D0*t280*t440-0.148092480894642D0*t149
     #*t445-0.1086645186223595D-1*t284*t455-0.4346580744894379D-1*t163
     #*t458-0.5071010869043442D-1*t163*t463
      t469 = t152*t453
      t470 = t469*t159
      t473 = t314*t437
      t476 = t148*t445
      t485 = -0.1712109500228824D0*t309*t470-0.3424219000457648D0*t173
     #*t473-0.3994922167200589D0*t173*t476-0.5862637881547585D-1*t321
     #*t455-0.1172527576309517D0*t179*t458-0.136794883902777D0*t179*t463
      t488 = 0.2697586091519874D1*t466*t183-0.2697586091519874D1*t307
     #*t485
      t489 = t147*t488
      t490 = t489*t331
      t494 = -0.4811024840421814D1*t349-0.1895695887660258D-2*t366
      t497 = t196**2
      t498 = 1/t497
      t499 = t192*t498
      t503 = -0.1803772444038489D1*t349-0.1210946621972718D0*t366
     #-0.1763993811759022D-1*t348
      t506 = 0.1D-2*t494*t197-0.1D-2*t499*t503
      t507 = t506*t145
      t508 = t507*t209
      t510 = t200*t437
      t511 = t510*t209
      t514 = sigma*t445*t208
      t515 = t201*t514
      t517 = t201*sigma
      t518 = t145*t204
      t519 = sigma*t437
      t523 = 1/t166/t443
      t524 = t146*t523
      t527 = -0.522423459704672D1*t518*t519+0.6965646129395627D1*t524
     #*sigma
      t529 = t152*t527*t208
      t530 = t517*t529
      t532 = t351+t372-t376-t390+t400+t404+t424+t427-t430
     #+0.7420670230672731D-1*t438+0.2473556743557577D-1*t490+0.1D1
     #*t508+0.1D1*t511-0.2333333333333333D1*t515+0.1D1*t530
      t533 = rho*t532
      vrhoa(i) = -0.12407009817988D1*t214*t35-0.9305257363491D0*t241
     #*t35+0.9305257363491D0*t26*t248+rho*(t258-t263+t266+t269+t279
     #+t333+t336-t344)-t89+t123+t140+t189+t211+t533
      t534 = t38*t59
      t538 = 1/t38/t47
      t541 = 0.3360034800657352D-1*t40*t538*t44
      t542 = t47*rhob
      t544 = 1/t48/t542
      t547 = 1.D0+0.10000117555961D1*t51
      t548 = dsqrt(t547)
      t549 = 1/t548
      t551 = 0.3360054550205309D-1*sigmabb*t544*t549
      t554 = 1/t38/t62/t47
      t555 = t61*t554
      t560 = -t541-t551-0.1088885204563779D-1*t555*t53
     #-0.4388082092272149D-1*t56*t544
      t561 = t39*t560
      t564 = t68**2
      t565 = 1/t564
      t567 = -t541-t551-0.5776579334555855D-5*t555
      t568 = t565*t567
      t571 = -t255
      t573 = t101*t571*t120
      t574 = 0.3799574853701528D-1*t573
      t575 = 0.1519829941480611D0*t262
      t576 = t137*t571
      t577 = t576*t118
      t578 = 0.1923661050931536D1*t577
      t579 = 0.7694644203726145D1*t268
      t580 = -t277
      t581 = t270*t580
      t582 = 0.7420670230672731D-1*t581
      t583 = t152*t580
      t586 = t574+t575+t578-t579
      t591 = -0.4042761511756372D2*t586*t156+0.1212828453526912D3*t288
     #*t580
      t592 = t168*t591
      t593 = t592*t159
      t596 = t298*t580
      t599 = -0.1269364121954074D0*t280*t583-0.1086645186223595D-1
     #*t284*t593-0.4346580744894379D-1*t163*t596
      t602 = t152*t591
      t603 = t602*t159
      t606 = t314*t580
      t613 = -0.1712109500228824D0*t309*t603-0.3424219000457648D0*t173
     #*t606-0.5862637881547585D-1*t321*t593-0.1172527576309517D0*t179
     #*t596
      t616 = 0.2697586091519874D1*t599*t183-0.2697586091519874D1*t307
     #*t613
      t617 = t147*t616
      t618 = t617*t331
      t619 = 0.2473556743557577D-1*t618
      t620 = t200*t580
      t621 = t620*t209
      t622 = 0.1D1*t621
      t624 = t340*t580*t208
      t625 = t338*t624
      t626 = 0.522423459704672D1*t625
      vrhob(i) = -0.12407009817988D1*t534*t69-0.9305257363491D0*t561
     #*t69+0.9305257363491D0*t60*t568+rho*(t574+t575+t578-t579+t582
     #+t619+t622-t626)-t89+t123+t140+t189+t211+t533
      t629 = 1/t6
      t632 = 0.1260013050246507D-1*t629*t7*t10
      t634 = 0.1260020456326991D-1*t16*t229
      t635 = t31*t19
      t640 = t632+t634+0.408331951711417D-2*t635*sigmaaa
     #+0.1645530784602056D-1*t21*t16
      t641 = t5*t640
      t646 = t632+t634+0.2166217250458446D-5*sigmaaa*t31
      t647 = t245*t646
      t653 = 0.634682060977037D-1*t174+0.2173290372447189D-1*t173*t169
      t656 = t161*t148
      t661 = 0.1712109500228824D0*t656*t152+0.5862637881547585D-1*t308
     #*t169
      t664 = 0.2697586091519874D1*t653*t183-0.2697586091519874D1*t307
     #*t661
      t666 = t147*t664*t331
      t667 = 0.2473556743557577D-1*t666
      t668 = t152*t208
      t669 = t201*t668
      t670 = 0.1D1*t669
      t671 = t200*t147
      t673 = sigma*t340*t208
      t674 = t671*t673
      t675 = 0.261211729852336D1*t674
      t677 = rho*(t667+t670-t675)
      vsigmaaa(i) = -0.9305257363491D0*t641*t35+0.9305257363491D0*t26
     #*t647+t677
      vsigmaab(i) = 2.D0*t677
      t678 = 1/t40
      t681 = 0.1260013050246507D-1*t678*t41*t44
      t683 = 0.1260020456326991D-1*t50*t549
      t684 = t65*t53
      t689 = t681+t683+0.408331951711417D-2*t684*sigmabb
     #+0.1645530784602056D-1*t55*t50
      t690 = t39*t689
      t695 = t681+t683+0.2166217250458446D-5*sigmabb*t65
      t696 = t565*t695
      vsigmabb(i) = -0.9305257363491D0*t690*t69+0.9305257363491D0*t60
     #*t696+t677
      t705 = 0.2D1*t371
      t706 = 0.7599149707403056D-1*t399
      t707 = 0.3847322101863073D1*t423
      t708 = 0.3847322101863073D1*t426
      t709 = 0.1538928840745229D2*t429
      t710 = t186**2
      t711 = 1/t710
      t715 = sigma*t165
      t716 = t440*t277
      t719 = 1/t107
      t721 = 1/t443
      t726 = 1/t111
      t732 = 0.1111111111111111D0*t719*t103*t721-0.3333333333333333D0
     #*t271*t348+0.1111111111111111D0*t726*t103*t721
     #+0.3333333333333333D0*t274*t348
      t740 = dexp(-0.8085523023512745D2*t157)
      t741 = t740*t291
      t742 = t454*t741
      t745 = t179*t297
      t746 = t159*t277
      t747 = t454*t746
      t753 = 0.8740794299481065D-3*t349*t100*t255*t120
      t754 = t116*t115
      t755 = 1/t754
      t758 = t347*t755*t373*t259
      t759 = 0.3496317719792426D-2*t758
      t763 = 0.1124999956683108D1*t385*t386*t255*t120
      t765 = t385*t387*t267
      t766 = 0.4499999826732431D1*t765
      t767 = 1/t141
      t773 = 1/t143
      t779 = -0.4444444444444444D0*t767*t103*t721-0.1333333333333333D1
     #*t106*t348-0.4444444444444444D0*t773*t103*t721
     #+0.1333333333333333D1*t110*t348
      t782 = 0.3799574853701528D-1*t101*t779*t120
      t785 = t101*t397*t259*t117
      t786 = 0.1519829941480611D0*t785
      t790 = 0.1519829941480611D0*t101*t255*t114*t340
      t792 = t101*t260*t340
      t793 = 0.6079319765922445D0*t792
      t796 = 0.1923661050931536D1*t421*t255*t118
      t797 = t422*t267
      t798 = 0.7694644203726145D1*t797
      t801 = 0.1923661050931536D1*t137*t779*t118
      t802 = t425*t267
      t803 = 0.7694644203726145D1*t802
      t805 = 0.7694644203726145D1*t264*t428
      t807 = t138*t259*t340
      t808 = 0.3077857681490458D2*t807
      t809 = -t753+t759-t763+t766+t782-t786+t790+t793+t796+t798+t801
     #+t803-t805-t808
      t812 = t448*t165
      t815 = t285*t165
      t818 = t155*t297
      t819 = t437*t277
      t824 = -0.4042761511756372D2*t809*t156+0.1212828453526912D3*t812
     #*t277+0.1212828453526912D3*t815*t437-0.4851313814107647D3*t818
     #*t819+0.1212828453526912D3*t288*t732
      t826 = t168*t824*t159
      t829 = t291*t159
      t830 = t454*t829
      t833 = t168*t437
      t834 = t833*t829
      t838 = 1/t164/t146
      t839 = t163*t838
      t840 = t833*t277
      t843 = t298*t732
      t847 = t462*t291*t159
      t850 = t297*t462
      t851 = t850*t277
      t854 = 0.3808092365862222D0*t715*t716-0.1269364121954074D0*t280
     #*t152*t732+0.296184961789284D0*t280*t445*t277
     #+0.2173290372447189D-1*t321*t742+0.4346580744894379D-1*t745*t747
     #-0.1086645186223595D-1*t284*t826-0.1086645186223595D-1*t284*t830
     #+0.4346580744894379D-1*t745*t834+0.2173290372447189D0*t839*t840
     #-0.4346580744894379D-1*t163*t843+0.5071010869043442D-1*t284*t847
     #+0.2028404347617377D0*t163*t851
      t857 = t466*t306
      t860 = t302*t306
      t865 = t172/t305/t182
      t869 = t319*sigma
      t870 = t869*t148
      t874 = t308*t156
      t888 = t173*t165
      t898 = t156*t445
      t902 = t177**2
      t905 = 1/t902*t162*t165
      t908 = t320*t297
      t917 = t179*t838
      t926 = 0.3424219000457648D0*t870*t469*t741+0.3424219000457648D0
     #*t874*t469*t746-0.1712109500228824D0*t309*t152*t824*t159
     #-0.1712109500228824D0*t309*t469*t829+0.3424219000457648D0*t874
     #*t440*t829+0.1027265700137294D1*t888*t716-0.3424219000457648D0
     #*t173*t314*t732+0.3994922167200589D0*t309*t445*t291*t159
     #+0.7989844334401178D0*t173*t898*t277+0.1758791364464276D0*t905
     #*t742+0.2345055152619034D0*t908*t747-0.5862637881547585D-1*t321
     #*t826-0.5862637881547585D-1*t321*t830+0.2345055152619034D0*t908
     #*t834+0.5862637881547585D0*t917*t840-0.1172527576309517D0*t179
     #*t843+0.273589767805554D0*t321*t847+0.547179535611108D0*t179*t851
      t936 = t146*t488
      t937 = t331*t277
      t940 = t146*t329
      t941 = t331*t437
      t944 = -0.2473556743557577D-1*t489*t711*t329
     #+0.2473556743557577D-1*t147*(0.2697586091519874D1*t854*t183
     #-0.2697586091519874D1*t857*t326-0.2697586091519874D1*t860*t485
     #+0.5395172183039748D1*t865*t485*t326-0.2697586091519874D1*t307
     #*t926)*t331+t782+t796+t798+t801+t803-t805-t808+0.1D1*t506*t277
     #*t209+0.7420670230672731D-1*t936*t937+0.7420670230672731D-1*t940
     #*t941-t786+t759
      t946 = 0.7420670230672731D-1*t270*t732
      t953 = t145*t523
      t962 = t334*sigma
      t964 = 0.1D1*t962*t529
      t965 = t340*t527
      t966 = t277*t208
      t969 = 0.522423459704672D1*t338*t965*t966
      t970 = t145*t187
      t972 = 0.1484134046134546D0*t970*t819
      t974 = 0.2333333333333333D1*t334*t514
      t975 = t510*t162
      t976 = t340*t145
      t978 = t975*t976*t966
      t981 = t506*t146*t162
      t983 = 0.522423459704672D1*t981*t342
      t986 = t338*t755*t277*t208
      t990 = 0.1D1*t200*t732*t209
      t991 = -t753+t766-t763+t790+t793+t946+0.1D1*t517*t152*(
     #-0.522423459704672D1*t277*t204*t519-0.522423459704672D1*t518
     #*sigma*t732+0.1393129225879125D2*t953*sigma*t277)*t208+t964-t969
     #+t972-t974-0.522423459704672D1*t978-t983+0.1218988072644235D2
     #*t986+t990
      t993 = rho*(t944+t991)
      t996 = 0.5495599555936838D-2*t350
      t997 = 0.1484134046134546D0*t438
      t1002 = 0.4444444444444444D0*t767*t348+0.4444444444444444D0*t773
     #*t348
      t1005 = 0.3799574853701528D-1*t101*t1002*t120
      t1008 = t101*t255*t259*t117
      t1009 = 0.3039659882961223D0*t1008
      t1012 = t101*t112*t113*t117
      t1013 = 0.4559489824441834D0*t1012
      t1016 = 0.1923661050931536D1*t137*t1002*t118
      t1017 = t264*t267
      t1018 = 0.1538928840745229D2*t1017
      t1020 = t138*t113*t117
      t1021 = 0.2308393261117844D2*t1020
      t1022 = t277**2
      t1031 = -0.1111111111111111D0*t719*t348-0.1111111111111111D0
     #*t726*t348
      t1033 = 0.7420670230672731D-1*t270*t1031
      t1039 = 0.1269364121954074D0*t280*t152*t1031
      t1040 = t291**2
      t1041 = t168*t1040
      t1042 = t1041*t740
      t1045 = t292*t746
      t1056 = 0.1212828453526912D3*t288*t1031
      t1057 = -0.4042761511756372D2*(t1005-t1009-t1013+t1016+t1018
     #+t1021)*t156+0.2425656907053823D3*t815*t277-0.4851313814107647D3
     #*t818*t1022+t1056
      t1059 = t168*t1057*t159
      t1062 = t1041*t159
      t1065 = t838*t168
      t1066 = t1065*t1022
      t1069 = t298*t1031
      t1071 = 0.4346580744894379D-1*t163*t1069
      t1077 = t326**2
      t1080 = t152*t1040
      t1094 = t165*t152
      t1100 = 0.3424219000457648D0*t173*t314*t1031
      t1112 = 0.1172527576309517D0*t179*t1069
      t1113 = 0.3424219000457648D0*t870*t1080*t740
     #+0.6848438000915295D0*t874*t310*t746-0.1712109500228824D0*t309
     #*t152*t1057*t159-0.1712109500228824D0*t309*t1080*t159
     #+0.1027265700137294D1*t173*t1094*t1022-t1100
     #+0.1758791364464276D0*t905*t1042+0.4690110305238068D0*t908*t1045
     #-0.5862637881547585D-1*t321*t1059-0.5862637881547585D-1*t321
     #*t1062+0.5862637881547585D0*t179*t1066-t1112
      t1120 = t329**2
      t1126 = 0.1D1*t200*t1031*t209
      t1129 = t976*t208
      t1135 = 0.522423459704672D1*t338*t340*t1031*t208
      t1137 = t671*t162*sigma
      t1138 = t116*t443
      t1140 = 1/t166/t1138
      t1145 = t1005-t1009-t1013+t1016+t1018+t1021+0.1484134046134546D0
     #*t970*t1022+0.1484134046134546D0*t940*t937+t1033
     #+0.2473556743557577D-1*t147*(0.2697586091519874D1*
     #(0.3808092365862222D0*t715*t152*t1022-t1039
     #+0.2173290372447189D-1*t321*t1042+0.8693161489788758D-1*t745
     #*t1045-0.1086645186223595D-1*t284*t1059-0.1086645186223595D-1
     #*t284*t1062+0.2173290372447189D0*t163*t1066-t1071)*t183
     #-0.5395172183039748D1*t860*t326+0.5395172183039748D1*t865*t1077
     #-0.2697586091519874D1*t307*t1113)*t331-0.2473556743557577D-1
     #*t147*t1120*t711+t1126-0.1567270379114016D2*t200*t1022*t162
     #*t1129-t1135+0.272926271249799D2*t1137*t1140*t1022*t208
      t1147 = 0.1484134046134546D0*t278+0.7599149707403056D-1*t257
     #+0.3847322101863073D1*t265+0.1538928840745229D2*t268
     #-0.3039659882961223D0*t262+0.4947113487115154D-1*t332+t705+t706
     #+t707+t708-t709+t993+0.2D1*t335-0.1044846919409344D2*t343+t996
     #+t997+rho*t1145
      t1148 = 0.1748158859896213D-2*t375
      t1149 = 0.2249999913366216D1*t389
      t1150 = 0.3039659882961223D0*t403
      t1151 = 0.2D1*t530
      t1158 = -t753+t766-t763+t790+t793+t946+t964-t969+t972
     #-0.522423459704672D1*t338*t340*t732*t208-t974
     #-0.1044846919409344D2*t978-t983+0.261211729852336D2*t986+t990
      t1160 = rho*(t944+t1158)
      t1161 = 0.4947113487115154D-1*t490
      t1162 = 0.2D1*t508
      t1163 = 0.2D1*t511
      t1164 = 0.4666666666666667D1*t515
      t1176 = 0.7840081201533821D-1*t6/t4/t222*t10
      t1178 = 1/t14/t28
      t1181 = 0.1680027275102654D0*sigmaaa*t1178*t229
      t1185 = t27/t4/t28/t222
      t1187 = 1/t228/t227
      t1189 = 0.4480125399532632D-1*t1185*t1187
      t1193 = t28**2
      t1217 = -0.1111111111111111D0*t719*t113*t117
     #+0.6666666666666667D0*t431*t721-0.1111111111111111D0*t726*t113
     #*t117-0.6666666666666667D0*t434*t721
      t1220 = t488**2
      t1227 = t462*t453*t159
      t1240 = 0.4444444444444444D0*t767*t113*t117+0.2666666666666667D1
     #*t391*t721+0.4444444444444444D0*t773*t113*t117
     #-0.2666666666666667D1*t394*t721
      t1243 = 0.3799574853701528D-1*t101*t1240*t120
      t1245 = 0.1538928840745229D2*t425*t428
      t1249 = 0.1748158859896213D-2*t349*t100*t397*t120
      t1250 = t347*t721
      t1252 = 0.1748158859896213D-2*t1250*t374
      t1257 = 0.6992635439584852D-2*t347/t1138*t373*t114
      t1260 = 0.1923661050931536D1*t137*t1240*t118
      t1263 = 0.7599149707403056D0*t101*t401*t755
      t1267 = 0.2249999913366216D1*t385*t386*t397*t120
      t1269 = 0.1538928840745229D2*t422*t428
      t1272 = 0.3847322101863073D1*t421*t397*t118
      t1275 = 0.3847322101863073D2*t138*t114*t755
      t1279 = t368**2
      t1281 = t75/t352/t83*t1279*t369
      t1282 = 0.2D1*t1281
      t1283 = t1243-t1245-t1249+t1252-t1257+t1260-t1263-t1267-t1269
     #+t1272+t1275-t1282
      t1286 = 1/t357/t72*t117
      t1288 = t358*t721
      t1292 = 1/t81/t72*t117
      t1297 = 1/t79/t72*t117
      t1299 = t362*t721
      t1303 = 1/t73/t72*t117
      t1305 = t365*t721
      t1309 = t354*(-0.8309097827459833D0*t1286+0.199418347859036D1
     #*t1288-0.4945709824779306D0*t1292+0.1483712947433792D1*t1250
     #-0.2001071587498409D0*t1297+0.8004286349993634D0*t1299
     #-0.4215565168327908D-1*t1303+0.2529339100996745D0*t1305)*t369
      t1310 = 0.1D1*t1309
      t1311 = t352**2
      t1314 = t86**2
      t1317 = t75/t1311*t1279/t1314
      t1318 = 0.160818243221511D2*t1317
      t1330 = t414**2
      t1346 = t407**2
      t1349 = t133**2
      t1354 = t1292*t87
      t1356 = t1250*t87
      t1360 = t349*t353*t368*t369
      t1365 = 0.8806734334819047D-3*t1292*t134-0.2642020300445714D-2
     #*t1250*t134-0.8497974591333914D-1*t349*t408*t414*t415-0.2D1*t125
     #/t407/t130*t1330*t415+0.1D1*t409*(-0.1544496508763151D1*t1286
     #+0.3706791621031562D1*t1288-0.854388052766047D0*t1292
     #+0.2563164158298141D1*t1250-0.4111834438919023D0*t1297
     #+0.1644733775567609D1*t1299-0.5346380647307093D-1*t1303
     #+0.3207828388384256D0*t1305)*t415+0.321646831778707D2*t125/t1346
     #*t1330/t1349-0.1831866518645613D-2*t1354+0.5495599555936838D-2
     #*t1356+0.8837926660346786D-1*t1360+0.2D1*t1281-0.1D1*t1309
     #-0.160818243221511D2*t1317
      t1368 = 0.1923661050931536D1*t1365*t112*t118
      t1369 = 0.8837926660346786D-1*t1360
      t1370 = 0.1831866518645613D-2*t1354
      t1371 = 0.5495599555936838D-2*t1356
      t1375 = t384**2
      t1378 = 0.2249999913366216D1*t91/t377/t96*t1375*t388
      t1380 = 0.5827196199654043D-3*t1292*t374
      t1384 = 0.3039659882961223D0*t101*t397*t114*t340
      t1389 = 0.5176049209143758D-1*t349*t378*t384*t386*t121
      t1390 = t377**2
      t1394 = t99**2
      t1399 = 0.3330964519106732D2*t91/t1390*t1375/t1394*t112*t120
      t1411 = 0.1124999956683108D1*t379*(-0.1132974264373283D1*t1286
     #+0.271913823449588D1*t1288-0.4994648585728036D0*t1292
     #+0.1498394575718411D1*t1250-0.1075243117819161D0*t1297
     #+0.4300972471276643D0*t1299-0.4247805766949639D-1*t1303
     #+0.2548683460169784D0*t1305)*t388
      t1414 = 0.8999999653464862D1*t385*t387*t428
      t1415 = t1310+t1318+t1368-t1369+t1370-t1371+t1378-t1380+t1384
     #+t1389-t1399-t1411-t1414
      t1421 = t437**2
      t1426 = -0.4042761511756372D2*(t1283+t1415)*t156
     #+0.2425656907053823D3*t812*t437-0.4851313814107647D3*t818*t1421
     #+0.1212828453526912D3*t288*t1217
      t1428 = t168*t1426*t159
      t1431 = t159*t437
      t1432 = t454*t1431
      t1445 = 1/t150/t116
      t1448 = t453**2
      t1449 = t168*t1448
      t1450 = t1449*t159
      t1453 = t1449*t740
      t1458 = t165/t166/t754
      t1461 = t850*t437
      t1464 = t298*t1217
      t1467 = t1065*t1421
      t1470 = 0.1014202173808688D0*t284*t1227-0.1086645186223595D-1
     #*t284*t1428+0.8693161489788758D-1*t745*t1432
     #+0.3808092365862222D0*t715*t152*t1421+0.5923699235785679D0*t280
     #*t445*t437-0.1269364121954074D0*t280*t152*t1217
     #+0.4936416029821399D0*t149*t1445-0.1086645186223595D-1*t284
     #*t1450+0.2173290372447189D-1*t321*t1453+0.2873572825791284D0
     #*t163*t1458+0.4056808695234754D0*t163*t1461
     #-0.4346580744894379D-1*t163*t1464+0.2173290372447189D0*t163*t1467
      t1475 = t485**2
      t1491 = t152*t1448
      t1526 = 0.6848438000915295D0*t874*t469*t1431
     #+0.7989844334401178D0*t309*t445*t453*t159-0.1712109500228824D0
     #*t309*t152*t1426*t159+0.547179535611108D0*t321*t1227
     #+0.3424219000457648D0*t870*t1491*t740+0.1758791364464276D0*t905
     #*t1453-0.1712109500228824D0*t309*t1491*t159+0.1331640722400196D1
     #*t173*t148*t1445+0.1027265700137294D1*t173*t1094*t1421
     #+0.1597968866880236D1*t173*t898*t437-0.3424219000457648D0*t173
     #*t314*t1217+0.4690110305238068D0*t908*t1432+0.7751710087824029D0
     #*t179*t1458-0.5862637881547585D-1*t321*t1428
     #+0.1094359071222216D1*t179*t1461-0.5862637881547585D-1*t321
     #*t1450-0.1172527576309517D0*t179*t1464+0.5862637881547585D0*t179
     #*t1467
      t1549 = t503**2
      t1584 = t527**2
      t1597 = t510*sigma
      s2 = 0.1484134046134546D0*t936*t941+0.7420670230672731D-1*t270
     #*t1217-0.2473556743557577D-1*t147*t1220*t711
     #-0.4666666666666667D1*t507*t514+0.2473556743557577D-1*t147*
     #(0.2697586091519874D1*t1470*t183-0.5395172183039748D1*t857*t485
     #+0.5395172183039748D1*t865*t1475-0.2697586091519874D1*t307*t1526
     #)*t331
      s1 = s2+0.2D1*t506*t437*t209+0.1D1*(0.1D-2*(
     #-0.3207349893614542D1*t1292+0.9622049680843627D1*t1250
     #-0.6318986292200858D-3*t1303+0.3791391775320515D-2*t1305)*t197
     #-0.2D-2*t494*t498*t503+0.2D-2*t192/t497/t196*t1549-0.1D-2*t499*(
     #-0.1202514962692326D1*t1292+0.3607544888076978D1*t1250
     #-0.4036488739909061D-1*t1303+0.2421893243945437D0*t1305
     #+0.3527987623518044D-1*t721))*t145*t209+0.1D1*t517*t152*(
     #-0.522423459704672D1*t1421*t204*sigma+0.2786258451758251D2*t953
     #*t519-0.522423459704672D1*t518*sigma*t1217-0.2554070247445063D2
     #*t146*t168*sigma)*t208+0.7777777777777778D1*t201*sigma*t1445
     #*t208+0.1D1*t517*t152*t1584*t208
      t1604 = s1+0.1D1*t200*t1217*t209-0.4666666666666667D1*t510*t514
     #+0.2D1*t507*sigma*t529+0.2D1*t1597*t529-0.4666666666666667D1
     #*t517*t445*t527*t208+t1243-t1245-t1249+t1252-t1257
      t1608 = -t1369+t1370-t1371+0.1484134046134546D0*t970*t1421+t1378
     #-t1380+t1384+t1389-t1399-t1411-t1414
      t1611 = rho*(t1604+t1260-t1263-t1267-t1269+t1272+t1275-t1282
     #+t1310+t1318+t1368+t1608)
      t1622 = 1/t244/t34
      t1623 = t247**2
      t1627 = -t1148-t1149+t1150+t1151+t1160+t1161+t1162+t1163-t1164
     #-0.4135669939329333D0/t14*t25*t35-0.24814019635976D1*t4*t240*t35
     #-0.9305257363491D0*t5*(t1176+t1181-t1189+0.9799966841074009D-1
     #*t1185*t19-0.4778117666686413D-1*t27*sigmaaa/t1193/t13*t19
     #+0.1608963433833121D0*t22*t1178)*t35+t1611+0.18610514726982D1
     #*t241*t248+0.24814019635976D1*t214*t248+0.9305257363491D0*t26
     #*t245*(t1176+t1181-t1189+0.3658500245218708D-4*t1185)
     #-0.18610514726982D1*t26*t1622*t1623
      v2rhoa2(i) = t1147+t1627
      t1631 = t338*t755*t580*t208
      t1633 = t580*t208
      t1636 = 0.522423459704672D1*t338*t965*t1633
      t1639 = 0.1D1*t506*t580*t209
      t1641 = 0.2333333333333333D1*t620*t514
      t1642 = t440*t580
      t1645 = -t732
      t1652 = t740*t591
      t1653 = t454*t1652
      t1656 = t159*t580
      t1657 = t454*t1656
      t1663 = 0.8740794299481065D-3*t349*t100*t571*t120
      t1664 = 0.3496317719792426D-2*t758
      t1668 = 0.1124999956683108D1*t385*t386*t571*t120
      t1669 = 0.4499999826732431D1*t765
      t1670 = -t779
      t1673 = 0.3799574853701528D-1*t101*t1670*t120
      t1674 = 0.1519829941480611D0*t785
      t1678 = 0.1519829941480611D0*t101*t571*t114*t340
      t1679 = 0.6079319765922445D0*t792
      t1682 = 0.1923661050931536D1*t421*t571*t118
      t1683 = 0.7694644203726145D1*t797
      t1686 = 0.1923661050931536D1*t137*t1670*t118
      t1687 = 0.7694644203726145D1*t802
      t1689 = 0.7694644203726145D1*t576*t428
      t1690 = 0.3077857681490458D2*t807
      t1691 = -t1663-t1664-t1668-t1669+t1673+t1674+t1678-t1679+t1682
     #-t1683+t1686-t1687-t1689+t1690
      t1696 = t586*t165
      t1699 = t437*t580
      t1704 = -0.4042761511756372D2*t1691*t156+0.1212828453526912D3
     #*t812*t580+0.1212828453526912D3*t1696*t437-0.4851313814107647D3
     #*t818*t1699+0.1212828453526912D3*t288*t1645
      t1706 = t168*t1704*t159
      t1709 = t591*t159
      t1710 = t454*t1709
      t1713 = t833*t1709
      t1716 = t833*t580
      t1719 = t298*t1645
      t1723 = t462*t591*t159
      t1726 = t850*t580
      t1729 = 0.3808092365862222D0*t715*t1642-0.1269364121954074D0
     #*t280*t152*t1645+0.296184961789284D0*t280*t445*t580
     #+0.2173290372447189D-1*t321*t1653+0.4346580744894379D-1*t745
     #*t1657-0.1086645186223595D-1*t284*t1706-0.1086645186223595D-1
     #*t284*t1710+0.4346580744894379D-1*t745*t1713
     #+0.2173290372447189D0*t839*t1716-0.4346580744894379D-1*t163
     #*t1719+0.5071010869043442D-1*t284*t1723+0.2028404347617377D0
     #*t163*t1726
      t1734 = t599*t306
      t1786 = 0.3424219000457648D0*t870*t469*t1652
     #+0.3424219000457648D0*t874*t469*t1656-0.1712109500228824D0*t309
     #*t152*t1704*t159-0.1712109500228824D0*t309*t469*t1709
     #+0.3424219000457648D0*t874*t440*t1709+0.1027265700137294D1*t888
     #*t1642-0.3424219000457648D0*t173*t314*t1645+0.3994922167200589D0
     #*t309*t445*t591*t159+0.7989844334401178D0*t173*t898*t580
     #+0.1758791364464276D0*t905*t1653+0.2345055152619034D0*t908*t1657
     #-0.5862637881547585D-1*t321*t1706-0.5862637881547585D-1*t321
     #*t1710+0.2345055152619034D0*t908*t1713+0.5862637881547585D0*t917
     #*t1716-0.1172527576309517D0*t179*t1719+0.273589767805554D0*t321
     #*t1723+0.547179535611108D0*t179*t1726
      t1792 = 0.2473556743557577D-1*t147*(0.2697586091519874D1*t1729
     #*t183-0.2697586091519874D1*t857*t613-0.2697586091519874D1*t1734
     #*t485+0.5395172183039748D1*t865*t485*t613-0.2697586091519874D1
     #*t307*t1786)*t331
      t1793 = t331*t580
      t1795 = 0.7420670230672731D-1*t936*t1793
      t1797 = 0.522423459704672D1*t981*t624
      t1798 = 0.1218988072644235D2*t1631-t1636+t1639-t1641+t1792+t1795
     #-t1797-t1663+t1682+t1673-t1683-t1687+t1690-t1668
      t1799 = t976*t1633
      t1800 = t975*t1799
      t1804 = 0.1D1*t200*t1645*t209
      t1805 = t146*t616
      t1807 = 0.7420670230672731D-1*t1805*t941
      t1809 = 0.1484134046134546D0*t970*t1699
      t1811 = 0.7420670230672731D-1*t270*t1645
      t1812 = t620*sigma
      t1814 = 0.1D1*t1812*t529
      t1815 = t711*t616
      t1817 = 0.2473556743557577D-1*t489*t1815
      t1832 = t1678-0.522423459704672D1*t1800+t1686-t1689+t1804+t1674
     #+t1807+t1809-t1664+t1811-t1669+t1814-t1679-t1817+0.1D1*t517*t152
     #*(-0.522423459704672D1*t580*t204*t519-0.522423459704672D1*t518
     #*sigma*t1645+0.1393129225879125D2*t953*sigma*t580)*t208
      t1834 = rho*(t1798+t1832)
      t1848 = 0.7840081201533821D-1*t40/t38/t542*t44
      t1850 = 1/t48/t62
      t1853 = 0.1680027275102654D0*sigmabb*t1850*t549
      t1857 = t61/t38/t62/t542
      t1859 = 1/t548/t547
      t1861 = 0.4480125399532632D-1*t1857*t1859
      t1865 = t62**2
      t1880 = -0.1538928840745229D2*t268+t1834+0.24814019635976D1*t534
     #*t568+0.3039659882961223D0*t262-0.4135669939329333D0/t48*t59*t69
     #+t705+t706+t707+t708-t709+0.18610514726982D1*t561*t568+t996+t997
     #-0.9305257363491D0*t39*(t1848+t1853-t1861+0.9799966841074009D-1
     #*t1857*t53-0.4778117666686413D-1*t61*sigmabb/t1865/t47*t53
     #+0.1608963433833121D0*t56*t1850)*t69-0.24814019635976D1*t38*t560
     #*t69-t1148-t1149
      t1886 = 0.261211729852336D2*t1631-t1636+t1639
     #-0.522423459704672D1*t338*t340*t1645*t208-t1641+t1792+t1795
     #-t1797-t1663+t1682+t1673-t1683-t1687+t1690
      t1888 = -t1668+t1678-0.1044846919409344D2*t1800+t1686-t1689
     #+t1804+t1674+t1807+t1809-t1664+t1811-t1669+t1814-t1679-t1817
      t1890 = rho*(t1886+t1888)
      t1899 = 1/t564/t68
      t1900 = t567**2
      t1907 = t101*t571*t259*t117
      t1908 = 0.3039659882961223D0*t1907
      t1909 = t576*t267
      t1910 = 0.1538928840745229D2*t1909
      t1911 = t580**2
      t1919 = t591**2
      t1920 = t168*t1919
      t1921 = t1920*t740
      t1924 = t592*t1656
      t1934 = -0.4042761511756372D2*(t1005+t1908-t1013+t1016-t1910
     #+t1021)*t156+0.2425656907053823D3*t1696*t580
     #-0.4851313814107647D3*t818*t1911+t1056
      t1936 = t168*t1934*t159
      t1939 = t1920*t159
      t1942 = t1065*t1911
      t1950 = t613**2
      t1953 = t152*t1919
      t1980 = 0.3424219000457648D0*t870*t1953*t740
     #+0.6848438000915295D0*t874*t602*t1656-0.1712109500228824D0*t309
     #*t152*t1934*t159-0.1712109500228824D0*t309*t1953*t159
     #+0.1027265700137294D1*t173*t1094*t1911-t1100
     #+0.1758791364464276D0*t905*t1921+0.4690110305238068D0*t908*t1924
     #-0.5862637881547585D-1*t321*t1936-0.5862637881547585D-1*t321
     #*t1939+0.5862637881547585D0*t179*t1942-t1112
      t1987 = t616**2
      t1999 = t1005+t1908-t1013+t1016-t1910+t1021+0.1484134046134546D0
     #*t970*t1911+0.1484134046134546D0*t1805*t1793+t1033
     #+0.2473556743557577D-1*t147*(0.2697586091519874D1*
     #(0.3808092365862222D0*t715*t152*t1911-t1039
     #+0.2173290372447189D-1*t321*t1921+0.8693161489788758D-1*t745
     #*t1924-0.1086645186223595D-1*t284*t1936-0.1086645186223595D-1
     #*t284*t1939+0.2173290372447189D0*t163*t1942-t1071)*t183
     #-0.5395172183039748D1*t1734*t613+0.5395172183039748D1*t865*t1950
     #-0.2697586091519874D1*t307*t1980)*t331-0.2473556743557577D-1
     #*t147*t1987*t711+t1126-0.1567270379114016D2*t200*t1911*t162
     #*t1129-t1135+0.272926271249799D2*t1137*t1140*t1911*t208
      t2004 = t1150+t1890+t1151+0.7599149707403056D-1*t573
     #+0.3847322101863073D1*t577+0.9305257363491D0*t60*t565*(t1848
     #+t1853-t1861+0.3658500245218708D-4*t1857)-0.18610514726982D1*t60
     #*t1899*t1900+t1161+0.1484134046134546D0*t581+rho*t1999+t1162
     #+t1163-t1164+0.4947113487115154D-1*t618+t1611+0.2D1*t621
     #-0.1044846919409344D2*t625
      v2rhob2(i) = t1880+t2004
      t2007 = t279+t258+t266+0.5D0*t1834+t333+t705+t706+t707+t708-t709
     #+0.5D0*t993+t336-t344+t996+t997-t1148
      t2010 = -t1002
      t2013 = 0.3799574853701528D-1*t101*t2010*t120
      t2014 = 0.1519829941480611D0*t1008
      t2015 = 0.1519829941480611D0*t1907
      t2016 = 0.4559489824441834D0*t1012
      t2019 = 0.1923661050931536D1*t137*t2010*t118
      t2020 = 0.7694644203726145D1*t1017
      t2021 = 0.7694644203726145D1*t1909
      t2022 = 0.2308393261117844D2*t1020
      t2023 = t277*t580
      t2028 = -t1031
      t2033 = t281*t580
      t2039 = t292*t1652
      t2042 = t292*t1656
      t2056 = -0.4042761511756372D2*(t2013+t2014-t2015+t2016+t2019
     #-t2020+t2021-t2022)*t156+0.1212828453526912D3*t815*t580
     #+0.1212828453526912D3*t1696*t277-0.4851313814107647D3*t818*t2023
     #+0.1212828453526912D3*t288*t2028
      t2058 = t168*t2056*t159
      t2061 = t292*t1709
      t2064 = t168*t277
      t2065 = t2064*t1709
      t2068 = t2064*t580
      t2071 = t298*t2028
      t2119 = 0.3424219000457648D0*t870*t310*t1652
     #+0.3424219000457648D0*t874*t310*t1656-0.1712109500228824D0*t309
     #*t152*t2056*t159-0.1712109500228824D0*t309*t310*t1709
     #+0.3424219000457648D0*t874*t281*t1709+0.1027265700137294D1*t888
     #*t2033-0.3424219000457648D0*t173*t314*t2028+0.1758791364464276D0
     #*t905*t2039+0.2345055152619034D0*t908*t2042
     #-0.5862637881547585D-1*t321*t2058-0.5862637881547585D-1*t321
     #*t2061+0.2345055152619034D0*t908*t2065+0.5862637881547585D0*t917
     #*t2068-0.1172527576309517D0*t179*t2071
      t2138 = t1140*t277
      s1 = t2013+t2014-t2015+t2016+t2019-t2020+t2021-t2022
     #+0.1484134046134546D0*t970*t2023
      s2 = s1+0.7420670230672731D-1*t1805*t937+0.7420670230672731D-1
     #*t270*t2028+0.7420670230672731D-1*t940*t1793
     #+0.2473556743557577D-1*t147*(0.2697586091519874D1*
     #(0.3808092365862222D0*t715*t2033-0.1269364121954074D0*t280*t152
     #*t2028+0.2173290372447189D-1*t321*t2039+0.4346580744894379D-1
     #*t745*t2042-0.1086645186223595D-1*t284*t2058
     #-0.1086645186223595D-1*t284*t2061+0.4346580744894379D-1*t745
     #*t2065+0.2173290372447189D0*t839*t2068-0.4346580744894379D-1
     #*t163*t2071)*t183-0.2697586091519874D1*t860*t613
     #-0.2697586091519874D1*t1734*t326+0.5395172183039748D1*t865*t326
     #*t613-0.2697586091519874D1*t307*t2119)*t331
      t2142 = s2-0.2473556743557577D-1*t330*t1815+0.1D1*t200*t2028
     #*t209-0.1567270379114016D2*t334*t162*t1799-0.522423459704672D1
     #*t338*t340*t2028*t208+0.272926271249799D2*t1137*t2138*t1633
      t2144 = -t1149+t1150+0.5D0*t1890+t1151+t574+t578+0.5D0*t1160
     #+t1161+t582+t1162+t1163-t1164+t619+t1611+t622-t626+rho*t2142
      v2rhoab(i) = t2007+t2144
      t2152 = 0.1680017400328676D-1*t629*t218*t10
      t2154 = 0.5040081825307963D-1*t224*t229
      t2155 = sigmaaa*t234
      t2157 = 0.1680047024824737D-1*t2155*t1187
      t2185 = t146*t664
      t2189 = t308*t165
      t2199 = t653*t306
      t2205 = t178*t148
      t2208 = t161*t156
      t2211 = t869*t165
      t2223 = t711*t664
      t2229 = t340*t146*t208
      t2233 = t200*t164*t162
      t2238 = rho*(0.7420670230672731D-1*t2185*t937
     #+0.2473556743557577D-1*t147*(0.2697586091519874D1*(
     #-0.1269364121954074D0*t315-0.2173290372447189D-1*t2189*t293
     #-0.8693161489788758D-1*t173*t299)*t183-0.2697586091519874D1*t860
     #*t661-0.2697586091519874D1*t2199*t326+0.5395172183039748D1*t865
     #*t326*t661-0.2697586091519874D1*t307*(-0.1712109500228824D0
     #*t2205*t311-0.3424219000457648D0*t2208*t281-0.1172527576309517D0
     #*t2211*t293-0.2345055152619034D0*t308*t299))*t331
     #-0.2473556743557577D-1*t330*t2223+0.1D1*t334*t668
     #-0.130605864926168D2*t962*t2229+0.1364631356248995D2*t2233*t2138
     #*t208)
      s1 = 0.7420670230672731D-1*t2185*t941+0.2473556743557577D-1*t147
     #*(0.2697586091519874D1*(-0.1269364121954074D0*t473
     #-0.148092480894642D0*t476-0.2173290372447189D-1*t2189*t455
     #-0.8693161489788758D-1*t173*t458-0.1014202173808688D0*t173*t463)
     #*t183-0.2697586091519874D1*t857*t661-0.2697586091519874D1*t2199
     #*t485+0.5395172183039748D1*t865*t485*t661-0.2697586091519874D1
     #*t307*(-0.1712109500228824D0*t2205*t470-0.3424219000457648D0
     #*t2208*t440-0.3994922167200589D0*t656*t445-0.1172527576309517D0
     #*t2211*t455-0.2345055152619034D0*t308*t458-0.273589767805554D0
     #*t308*t463))*t331-0.2473556743557577D-1*t489*t2223+0.1D1*t507
     #*t668-0.261211729852336D1*t506*t147*t673+0.1D1*t510*t668
      t2310 = s1-0.261211729852336D1*t1597*t2229-0.2333333333333333D1
     #*t201*t445*t208+0.6094940363221173D1*t671*sigma*t755*t208+0.1D1
     #*t201*t529+0.1D1*t517*t152*(-0.522423459704672D1*t518*t437
     #+0.6965646129395627D1*t524)*t208-0.261211729852336D1*t671*sigma
     #*t965*t208
      t2311 = rho*t2310
      v2rhoasigmaaa(i) = -0.12407009817988D1*t4*t640*t35
     #+0.12407009817988D1*t214*t647-0.9305257363491D0*t5*(-t2152-t2154
     #+t2157-0.3266655613691336D-1*t234*t19*sigmaaa
     #+0.1791794125007405D-1*t27/t1193/rhoa*t19-0.4388082092272149D-1
     #*t21*t224)*t35+0.9305257363491D0*t241*t647+0.9305257363491D0
     #*t641*t248-0.18610514726982D1*t26*t1622*t247*t646
     #+0.9305257363491D0*t26*t245*(-t2152-t2154+t2157
     #-0.1155315866911171D-4*t2155)+t2238+t667+t670-t675+t2311
      t2313 = 0.4947113487115154D-1*t666
      t2314 = 0.2D1*t669
      t2315 = 0.522423459704672D1*t674
      t2316 = 2.D0*t2311
      v2rhoasigmaab(i) = 2.D0*t2238+t2313+t2314-t2315+t2316
      v2rhoasigmabb(i) = t2238+t667+t670-t675+t2311
      t2360 = rho*(0.7420670230672731D-1*t2185*t1793
     #+0.2473556743557577D-1*t147*(0.2697586091519874D1*(
     #-0.1269364121954074D0*t606-0.2173290372447189D-1*t2189*t593
     #-0.8693161489788758D-1*t173*t596)*t183-0.2697586091519874D1
     #*t1734*t661-0.2697586091519874D1*t2199*t613+0.5395172183039748D1
     #*t865*t613*t661-0.2697586091519874D1*t307*(-0.1712109500228824D0
     #*t2205*t603-0.3424219000457648D0*t2208*t583-0.1172527576309517D0
     #*t2211*t593-0.2345055152619034D0*t308*t596))*t331
     #-0.2473556743557577D-1*t617*t2223+0.1D1*t620*t668
     #-0.130605864926168D2*t1812*t2229+0.1364631356248995D2*t2233
     #*t1140*t580*t208)
      v2rhobsigmaaa(i) = t2360+t667+t670-t675+t2311
      v2rhobsigmaab(i) = 2.D0*t2360+t2313+t2314-t2315+t2316
      t2369 = 0.1680017400328676D-1*t678*t538*t44
      t2371 = 0.5040081825307963D-1*t544*t549
      t2372 = sigmabb*t554
      t2374 = 0.1680047024824737D-1*t2372*t1859
      v2rhobsigmabb(i) = -0.12407009817988D1*t38*t689*t69
     #+0.12407009817988D1*t534*t696-0.9305257363491D0*t39*(-t2369
     #-t2371+t2374-0.3266655613691336D-1*t554*t53*sigmabb
     #+0.1791794125007405D-1*t61/t1865/rhob*t53-0.4388082092272149D-1
     #*t55*t544)*t69+0.9305257363491D0*t561*t696+0.9305257363491D0
     #*t690*t568-0.18610514726982D1*t60*t1899*t567*t695
     #+0.9305257363491D0*t60*t565*(-t2369-t2371+t2374
     #-0.1155315866911171D-4*t2372)+t2360+t667+t670-t675+t2311
      t2406 = 0.6300065251232535D-2/t6/sigmaaa*t7*t10
      t2410 = 0.6300102281634954D-2/sigmaaa*t16*t229
      t2412 = 0.6300176343092764D-2*t31*t1187
      t2424 = t646**2
      t2439 = t661**2
      t2450 = t664**2
      t2463 = rho*(0.2473556743557577D-1*t147*(0.5862637881547585D-1
     #*t161*t165*t168*t183-0.5395172183039748D1*t2199*t661
     #+0.5395172183039748D1*t865*t2439-0.1581497040888031D0*t307*t178
     #*t165*t168)*t331-0.2473556743557577D-1*t147*t2450*t711
     #-0.522423459704672D1*t671*t340*t208+0.6823156781244976D1*t200
     #*t296*sigma*t1140*t208)
      v2sigmaaa2(i) = -0.9305257363491D0*t5*(-t2406+t2410-t2412
     #-0.6719227968777768D-2/t1193*t19*sigmaaa+0.8166639034228341D-2
     #*t635)*t35+0.18610514726982D1*t641*t647-0.18610514726982D1*t26
     #*t1622*t2424+0.9305257363491D0*t26*t245*(-t2406+t2410-t2412
     #+0.2166217250458446D-5*t31)+t2463
      v2sigmaaaab(i) = 2.D0*t2463
      v2sigmaaabb(i) = t2463
      v2sigmaab2(i) = 4.D0*v2sigmaaabb(i)
      v2sigmaabbb(i) = v2sigmaaaab(i)
      t2468 = 0.6300065251232535D-2/t40/sigmabb*t41*t44
      t2472 = 0.6300102281634954D-2/sigmabb*t50*t549
      t2474 = 0.6300176343092764D-2*t65*t1859
      t2486 = t695**2
      v2sigmabb2(i) = -0.9305257363491D0*t39*(-t2468+t2472-t2474
     #-0.6719227968777768D-2/t1865*t53*sigmabb+0.8166639034228341D-2
     #*t684)*t69+0.18610514726982D1*t690*t696-0.18610514726982D1*t60
     #*t1899*t2486+0.9305257363491D0*t60*t565*(-t2468+t2472-t2474
     #+0.2166217250458446D-5*t65)+v2sigmaaabb(i)
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      v2rhob2(i) = 0.0d0
      v2rhoab(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2rhoasigmaab(i) = 0.0d0
      v2rhoasigmabb(i) = 0.0d0
      v2rhobsigmaaa(i) = 0.0d0
      v2rhobsigmaab(i) = 0.0d0
      v2rhobsigmabb(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      v2sigmaab2(i) = 0.0d0
      v2sigmabb2(i) = 0.0d0
      v2sigmaaaab(i) = 0.0d0
      v2sigmaaabb(i) = 0.0d0
      v2sigmaabbb(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end
      
      
      subroutine rks_xc_pw91
     & (ideriv,npt,rhoa1,sigmaaa1,
     &  zk,vrhoa,vsigmaaa,
     &  v2rhoa2,v2rhoasigmaaa,v2sigmaaa2)
c
c     J.P. Perdew, J.A. Chevary, S.H. Vosko, K.A. Jackson,
c     M.R. Pederson, D.J. Singh, C. Fiolhais
c     Atoms, molecules, solids and surfaces:
c     Applications of the generalized gradient approximation
c     for exchange and correlation
c     Phys. Rev. B 46 (1992) 6671--6687
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt)
      REAL sigmaaa1(npt)
      REAL zk(npt),vrhoa(npt),vsigmaaa(npt)
      REAL v2rhoa2(npt),v2rhoasigmaaa(npt),v2sigmaaa2(npt)
      parameter(tol=1.0d-20)
      
      if(ideriv.eq.0) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t3 = t2*rho
      t4 = dsqrt(sigma)
      t6 = t4/t3
      t8 = dlog(0.1259928455434599D1*t6+dsqrt(1+0.1587419712813814D1
     #*t6**2))
      t10 = 0.3175033930295641D-1*t6*t8
      t11 = rho**2
      t12 = t2**2
      t14 = 1/t12/t11
      t17 = dexp(-0.261211729852336D1*t14*sigma)
      t25 = sigma**2
      t26 = t11**2
      t36 = 1/rho
      t37 = t36**(1.D0/3.D0)
      t40 = t36**(1.D0/6.D0)
      t43 = dsqrt(t36)
      t45 = t37**2
      t51 = dlog(1.D0+0.160818243221511D2/(0.598255043577108D1*t40
     #+0.2225569421150687D1*t37+0.8004286349993634D0*t43
     #+0.1897004325747559D0*t45))
      t52 = (1.D0+0.1325688999052018D0*t37)*t51
      t55 = 1/t2/t11
      t59 = dexp(0.2513869963240348D1*t52)
      t60 = t59-1.D0
      t61 = 1/t60
      t64 = 1/t12/t26
      t71 = t60**2
      t81 = dlog(1.D0+0.2697586091519874D1*(0.634682060977037D-1*sigma
     #*t55+0.1086645186223595D-1*t61*t25*t64)/(1.D0
     #+0.1712109500228824D0*t61*sigma*t55+0.2931318940773793D-1/t71
     #*t25*t64))
      zk(i) = -0.7385587663820224D0*t3*(1.D0+t10+0.261211729852336D-1*
     #(0.2743D0-0.1508D0*t17)*sigma*t14)/(1.D0+t10
     #+0.272926271249799D-5*t25/t2/t26/rho)+rho*(-0.62182D-1*t52
     #+0.2473556743557577D-1*t81+0.1D1*(0.1D-2*(0.2568D1
     #+0.1443307452126544D2*t37+0.2843543831490386D-2*t45)/(1.D0
     #+0.5411317332115466D1*t37+0.1816419932959077D0*t45
     #+0.1763993811759022D-1*t36)-0.1853571428571429D-2)*sigma*t55*t17)
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t3 = t2*rho
      t4 = dsqrt(sigma)
      t5 = 1/t3
      t6 = t4*t5
      t8 = dlog(0.1259928455434599D1*t6+dsqrt(1+0.1587419712813814D1
     #*t6**2))
      t10 = 0.3175033930295641D-1*t6*t8
      t11 = rho**2
      t12 = t2**2
      t14 = 1/t12/t11
      t15 = t14*sigma
      t17 = dexp(-0.261211729852336D1*t15)
      t19 = 0.2743D0-0.1508D0*t17
      t20 = t19*sigma
      t23 = 1.D0+t10+0.261211729852336D-1*t20*t14
      t24 = t3*t23
      t25 = sigma**2
      t26 = t11**2
      t27 = t26*rho
      t29 = 1/t2/t27
      t32 = 1.D0+t10+0.272926271249799D-5*t25*t29
      t33 = 1/t32
      t36 = 1/rho
      t37 = t36**(1.D0/3.D0)
      t39 = 1.D0+0.1325688999052018D0*t37
      t40 = t36**(1.D0/6.D0)
      t43 = dsqrt(t36)
      t45 = t37**2
      t47 = 0.598255043577108D1*t40+0.2225569421150687D1*t37
     #+0.8004286349993634D0*t43+0.1897004325747559D0*t45
      t50 = 1.D0+0.160818243221511D2/t47
      t51 = dlog(t50)
      t52 = t39*t51
      t53 = 0.62182D-1*t52
      t55 = 1/t2/t11
      t59 = dexp(0.2513869963240348D1*t52)
      t60 = t59-1.D0
      t61 = 1/t60
      t62 = t61*t25
      t64 = 1/t12/t26
      t67 = 0.634682060977037D-1*sigma*t55+0.1086645186223595D-1*t62*t64
      t68 = t61*sigma
      t71 = t60**2
      t72 = 1/t71
      t73 = t72*t25
      t76 = 1.D0+0.1712109500228824D0*t68*t55+0.2931318940773793D-1
     #*t73*t64
      t77 = 1/t76
      t80 = 1.D0+0.2697586091519874D1*t67*t77
      t81 = dlog(t80)
      t82 = 0.2473556743557577D-1*t81
      t85 = 0.2568D1+0.1443307452126544D2*t37+0.2843543831490386D-2*t45
      t89 = 1.D0+0.5411317332115466D1*t37+0.1816419932959077D0*t45
     #+0.1763993811759022D-1*t36
      t90 = 1/t89
      t93 = 0.1D-2*t85*t90-0.1853571428571429D-2
      t94 = t93*sigma
      t95 = t55*t17
      t97 = 0.1D1*t94*t95
      zk(i) = -0.7385587663820224D0*t24*t33+rho*(-t53+t82+t97)
      t105 = 0.8466757147455043D-1*t4*t55*t8
      t106 = t11*rho
      t108 = 1/t12/t106
      t112 = dsqrt(1.D0+0.1587419712813815D1*t15)
      t113 = 1/t112
      t115 = 0.1066750825533289D0*sigma*t108*t113
      t116 = t26*t11
      t119 = t25/t2/t116
      t128 = t32**2
      t129 = 1/t128
      t136 = 1/t11
      t137 = 1/t45*t136
      t138 = t137*t51
      t140 = t47**2
      t143 = t40**2
      t144 = t143**2
      t154 = 1/t37*t136
      t159 = t39/t140*(-0.99709173929518D0/t144/t40*t136
     #-0.7418564737168958D0*t137-0.4002143174996817D0/t43*t136
     #-0.1264669550498372D0*t154)/t50
      t162 = 1/t2/t106
      t167 = -0.1110869918438343D0*t138-0.4042761511756372D2*t159
      t169 = t64*t167*t59
      t173 = 1/t12/t27
      t179 = t76**2
      t181 = t67/t179
      t182 = t72*sigma
      t200 = 1/t80
      t208 = t89**2
      s1 = -0.9847450218426965D0*t2*t23*t33-0.3692793831910112D0*t3*(
     #-t105-t115-0.5487637560595959D-1*t119*t17-0.1393129225879125D0
     #*t20*t108)*t33+0.3692793831910112D0*t24*t129*(-t105-t115
     #-0.2911213559997856D-4*t119)
      vrhoa(i) = s1-t53+t82+t97+rho*(0.2747799777968419D-2*t138+0.1D1
     #*t159+0.2473556743557577D-1*(0.2697586091519874D1*(
     #-0.148092480894642D0*sigma*t162-0.1086645186223595D-1*t73*t169
     #-0.5071010869043442D-1*t62*t173)*t77-0.2697586091519874D1*t181*(
     #-0.1712109500228824D0*t182*t55*t167*t59-0.3994922167200589D0*t68
     #*t162-0.5862637881547585D-1/t71/t60*t25*t169-0.136794883902777D0
     #*t73*t173))*t200+0.1D1*(0.1D-2*(-0.4811024840421814D1*t137
     #-0.1895695887660258D-2*t154)*t90-0.1D-2*t85/t208*(
     #-0.1803772444038489D1*t137-0.1210946621972718D0*t154
     #-0.1763993811759022D-1*t136))*sigma*t95-0.2333333333333333D1*t94
     #*t162*t17+0.6965646129395627D1*t93*t25/t116*t17)
      t234 = 0.6350067860591282D-1/t4*t5*t8
      t236 = 0.8000631191499664D-1*t14*t113
      vsigmaaa(i) = -0.7385587663820224D0*t3*(t234+t236
     #+0.411572817044697D-1*t29*t17*sigma+0.1044846919409344D0*t19*t14
     #)*t33+0.7385587663820224D0*t24*t129*(t234+t236
     #+0.2183410169998392D-4*sigma*t29)+4.D0*rho*
     #(0.2473556743557577D-1*(0.2697586091519874D1*
     #(0.634682060977037D-1*t55+0.2173290372447189D-1*t68*t64)*t77
     #-0.2697586091519874D1*t181*(0.1712109500228824D0*t61*t55
     #+0.5862637881547585D-1*t182*t64))*t200+0.1D1*t93*t55*t17
     #-0.261211729852336D1*t94/t27*t17)
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t3 = t2*rho
      t4 = dsqrt(sigma)
      t5 = 1/t3
      t6 = t4*t5
      t8 = dlog(0.1259928455434599D1*t6+dsqrt(1+0.1587419712813814D1
     #*t6**2))
      t10 = 0.3175033930295641D-1*t6*t8
      t11 = rho**2
      t12 = t2**2
      t14 = 1/t12/t11
      t15 = t14*sigma
      t17 = dexp(-0.261211729852336D1*t15)
      t19 = 0.2743D0-0.1508D0*t17
      t20 = t19*sigma
      t23 = 1.D0+t10+0.261211729852336D-1*t20*t14
      t24 = t3*t23
      t25 = sigma**2
      t26 = t11**2
      t27 = t26*rho
      t29 = 1/t2/t27
      t32 = 1.D0+t10+0.272926271249799D-5*t25*t29
      t33 = 1/t32
      t36 = 1/rho
      t37 = t36**(1.D0/3.D0)
      t39 = 1.D0+0.1325688999052018D0*t37
      t40 = t36**(1.D0/6.D0)
      t43 = dsqrt(t36)
      t45 = t37**2
      t47 = 0.598255043577108D1*t40+0.2225569421150687D1*t37
     #+0.8004286349993634D0*t43+0.1897004325747559D0*t45
      t50 = 1.D0+0.160818243221511D2/t47
      t51 = dlog(t50)
      t52 = t39*t51
      t53 = 0.62182D-1*t52
      t55 = 1/t2/t11
      t59 = dexp(0.2513869963240348D1*t52)
      t60 = t59-1.D0
      t61 = 1/t60
      t62 = t61*t25
      t64 = 1/t12/t26
      t67 = 0.634682060977037D-1*sigma*t55+0.1086645186223595D-1*t62*t64
      t68 = t61*sigma
      t71 = t60**2
      t72 = 1/t71
      t73 = t72*t25
      t76 = 1.D0+0.1712109500228824D0*t68*t55+0.2931318940773793D-1
     #*t73*t64
      t77 = 1/t76
      t80 = 1.D0+0.2697586091519874D1*t67*t77
      t81 = dlog(t80)
      t82 = 0.2473556743557577D-1*t81
      t85 = 0.2568D1+0.1443307452126544D2*t37+0.2843543831490386D-2*t45
      t89 = 1.D0+0.5411317332115466D1*t37+0.1816419932959077D0*t45
     #+0.1763993811759022D-1*t36
      t90 = 1/t89
      t93 = 0.1D-2*t85*t90-0.1853571428571429D-2
      t94 = t93*sigma
      t95 = t55*t17
      t97 = 0.1D1*t94*t95
      zk(i) = -0.7385587663820224D0*t24*t33+rho*(-t53+t82+t97)
      t100 = t2*t23
      t105 = 0.8466757147455043D-1*t4*t55*t8
      t106 = t11*rho
      t108 = 1/t12/t106
      t111 = 1.D0+0.1587419712813815D1*t15
      t112 = dsqrt(t111)
      t113 = 1/t112
      t115 = 0.1066750825533289D0*sigma*t108*t113
      t116 = t26*t11
      t118 = 1/t2/t116
      t119 = t25*t118
      t124 = -t105-t115-0.5487637560595959D-1*t119*t17
     #-0.1393129225879125D0*t20*t108
      t125 = t3*t124
      t128 = t32**2
      t129 = 1/t128
      t131 = -t105-t115-0.2911213559997856D-4*t119
      t132 = t129*t131
      t135 = 1/t45
      t136 = 1/t11
      t137 = t135*t136
      t138 = t137*t51
      t140 = t47**2
      t141 = 1/t140
      t142 = t39*t141
      t143 = t40**2
      t144 = t143**2
      t145 = t144*t40
      t146 = 1/t145
      t150 = 1/t43
      t153 = 1/t37
      t154 = t153*t136
      t156 = -0.99709173929518D0*t146*t136-0.7418564737168958D0*t137
     #-0.4002143174996817D0*t150*t136-0.1264669550498372D0*t154
      t157 = 1/t50
      t159 = t142*t156*t157
      t162 = 1/t2/t106
      t167 = -0.1110869918438343D0*t138-0.4042761511756372D2*t159
      t169 = t64*t167*t59
      t173 = 1/t12/t27
      t176 = -0.148092480894642D0*sigma*t162-0.1086645186223595D-1*t73
     #*t169-0.5071010869043442D-1*t62*t173
      t179 = t76**2
      t180 = 1/t179
      t181 = t67*t180
      t182 = t72*sigma
      t190 = 1/t71/t60
      t191 = t190*t25
      t196 = -0.1712109500228824D0*t182*t55*t167*t59
     #-0.3994922167200589D0*t68*t162-0.5862637881547585D-1*t191*t169
     #-0.136794883902777D0*t73*t173
      t199 = 0.2697586091519874D1*t176*t77-0.2697586091519874D1*t181
     #*t196
      t200 = 1/t80
      t201 = t199*t200
      t205 = -0.4811024840421814D1*t137-0.1895695887660258D-2*t154
      t208 = t89**2
      t209 = 1/t208
      t210 = t85*t209
      t214 = -0.1803772444038489D1*t137-0.1210946621972718D0*t154
     #-0.1763993811759022D-1*t136
      t217 = 0.1D-2*t205*t90-0.1D-2*t210*t214
      t218 = t217*sigma
      t219 = t218*t95
      t221 = t162*t17
      t222 = t94*t221
      t224 = t93*t25
      t226 = 1/t116*t17
      t227 = t224*t226
      vrhoa(i) = -0.9847450218426965D0*t100*t33-0.3692793831910112D0
     #*t125*t33+0.3692793831910112D0*t24*t132-t53+t82+t97+rho*
     #(0.2747799777968419D-2*t138+0.1D1*t159+0.2473556743557577D-1
     #*t201+0.1D1*t219-0.2333333333333333D1*t222+0.6965646129395627D1
     #*t227)
      t231 = 1/t4
      t234 = 0.6350067860591282D-1*t231*t5*t8
      t236 = 0.8000631191499664D-1*t14*t113
      t237 = t29*t17
      t242 = t234+t236+0.411572817044697D-1*t237*sigma
     #+0.1044846919409344D0*t19*t14
      t243 = t3*t242
      t248 = t234+t236+0.2183410169998392D-4*sigma*t29
      t249 = t129*t248
      t255 = 0.634682060977037D-1*t55+0.2173290372447189D-1*t68*t64
      t262 = 0.1712109500228824D0*t61*t55+0.5862637881547585D-1*t182*t64
      t265 = 0.2697586091519874D1*t255*t77-0.2697586091519874D1*t181
     #*t262
      t266 = t265*t200
      t269 = t93*t55*t17
      t271 = 1/t27
      t272 = t271*t17
      t273 = t94*t272
      vsigmaaa(i) = -0.7385587663820224D0*t243*t33
     #+0.7385587663820224D0*t24*t249+4.D0*rho*(0.2473556743557577D-1
     #*t266+0.1D1*t269-0.261211729852336D1*t273)
      t286 = 0.395115333547902D0*t4*t162*t8
      t289 = 0.1066750825533289D1*sigma*t64*t113
      t290 = t26*t106
      t293 = t25/t2/t290
      t295 = 1/t112/t111
      t297 = 0.4515683437631874D0*t293*t295
      t306 = 1/t128/t32
      t307 = t131**2
      t315 = t25*sigma
      t316 = t26**2
      t337 = 1/t26
      t338 = 1/t45/t36*t337
      t339 = t338*t51
      t341 = t140**2
      t344 = t156**2
      t345 = t50**2
      t348 = t39/t341*t344/t345
      t354 = 1/t106
      t358 = t135*t354
      t368 = 1/t37/t36*t337
      t370 = t153*t354
      t374 = t142*(-0.8309097827459833D0/t145/t36*t337
     #+0.199418347859036D1*t146*t354-0.4945709824779306D0*t338
     #+0.1483712947433792D1*t358-0.2001071587498409D0/t43/t36*t337
     #+0.8004286349993634D0*t150*t354-0.4215565168327908D-1*t368
     #+0.2529339100996745D0*t370)*t157
      t380 = t39/t140/t47*t344*t157
      t382 = t358*t51
      t386 = t137*t141*t156*t157
      t406 = t214**2
      t422 = t316*rho
      t430 = t224/t290*t17
      t433 = 1/t2/t26
      t435 = t94*t433*t17
      t437 = t199**2
      t438 = t80**2
      t439 = 1/t438
      t442 = sigma*t433
      t445 = t173*t167*t59
      t454 = -0.740579945625562D-1*t339-0.6501498040842D3*t348
     #-0.4042761511756372D2*t374+0.8085523023512745D2*t380
     #+0.2221739836876686D0*t382+0.3572962974617552D1*t386
      t456 = t64*t454*t59
      t459 = t167**2
      t460 = t64*t459
      t462 = dexp(0.5027739926480695D1*t52)
      t463 = t460*t462
      t466 = t460*t59
      t470 = 1/t12/t116
      t471 = t62*t470
      t476 = t176*t180
      t481 = t67/t179/t76
      t482 = t196**2
      t495 = t190*sigma
      t496 = t55*t459
      t503 = t68*t433
      t505 = t71**2
      t514 = t73*t470
      s1 = 0.1831866518645613D-2*t339+0.160818243221511D2*t348+0.1D1
     #*t374-0.2D1*t380-0.5495599555936838D-2*t382
     #-0.8837926660346786D-1*t386-0.4666666666666667D1*t218*t221
      s2 = s1+0.1393129225879125D2*t217*t25*t226+0.1D1*(0.1D-2*(
     #-0.3207349893614542D1*t338+0.9622049680843627D1*t358
     #-0.6318986292200858D-3*t368+0.3791391775320515D-2*t370)*t90
     #-0.2D-2*t205*t209*t214+0.2D-2*t85/t208/t89*t406-0.1D-2*t210*(
     #-0.1202514962692326D1*t338+0.3607544888076978D1*t358
     #-0.4036488739909061D-1*t368+0.2421893243945437D0*t370
     #+0.3527987623518044D-1*t354))*sigma*t95+0.4852022599996427D2*t93
     #*t315/t12/t422*t17
      t522 = s2-0.5804705107829689D2*t430+0.7777777777777778D1*t435
     #-0.2473556743557577D-1*t437*t439+0.2473556743557577D-1*
     #(0.2697586091519874D1*(0.4936416029821399D0*t442
     #+0.1014202173808688D0*t73*t445-0.1086645186223595D-1*t73*t456
     #+0.2173290372447189D-1*t191*t463-0.1086645186223595D-1*t73*t466
     #+0.2873572825791284D0*t471)*t77-0.5395172183039748D1*t476*t196
     #+0.5395172183039748D1*t481*t482-0.2697586091519874D1*t181*
     #(0.7989844334401178D0*t182*t162*t167*t59-0.1712109500228824D0
     #*t182*t55*t454*t59+0.547179535611108D0*t191*t445
     #+0.3424219000457648D0*t495*t496*t462-0.1712109500228824D0*t182
     #*t496*t59+0.1331640722400196D1*t503+0.1758791364464276D0/t505
     #*t25*t463-0.5862637881547585D-1*t191*t456-0.5862637881547585D-1
     #*t191*t466+0.7751710087824029D0*t514))*t200
      t535 = dlog(1.D0+0.2960857464321668D2/(0.8157414703487641D1*t40
     #+0.2247591863577616D1*t37+0.4300972471276643D0*t43
     #+0.1911512595127338D0*t45))
      t537 = (1.D0+0.6901399211255825D-1*t37)*t535*t136
      t539 = t81*t136
      t545 = 0.1365402220407279D1*t537-0.1675913308826898D1*t52*t136
      t547 = t64*t545*t59
      t575 = -t545
      t577 = t64*t575*t59
      s1 = 0.1099119911187368D-1*t138+0.4D1*t159+0.2786258451758251D2
     #*t227-0.9333333333333333D1*t222+0.4D1*t219+0.9894226974230308D-1
     #*t201+0.3692793831910112D0*t24*t129*(t286+t289-t297
     #+0.3687537175997285D-3*t293)+0.7385587663820224D0*t125*t132
      s2 = s1-0.7385587663820224D0*t24*t306*t307+0.1969490043685393D1
     #*t100*t132-0.3692793831910112D0*t3*(t286+t289-t297
     #+0.9877747609072727D0*t293*t17-0.764498826669826D0*t315/t316/t11
     #*t17+0.1021628098978025D1*t20*t64)*t33
      s3 = s2-0.6564966812284644D0/t12*t23*t33-0.1969490043685393D1*t2
     #*t124*t33
      s4 = s3+2.D0*rho*t522
      s5 = s4
      s6 = rho*(-0.3377399869956914D-1*t537+0.1649037829038385D-1*t539
     #+0.2473556743557577D-1*(0.2697586091519874D1*(
     #-0.2820809159897942D-1*t442-0.1086645186223595D-1*t73*t547
     #-0.9659068321987509D-2*t471)*t77-0.2697586091519874D1*t181*(
     #-0.1712109500228824D0*t182*t55*t545*t59-0.760937555657255D-1
     #*t503-0.5862637881547585D-1*t191*t547-0.2605616836243371D-1*t514
     #))*t200+0.2222222222222222D0*t435-0.1160941021565938D1*t430)+rho
     #*(0.3377399869956914D-1*t537-0.1649037829038385D-1*t539
     #+0.2473556743557577D-1*(0.2697586091519874D1*
     #(0.2820809159897942D-1*t442-0.1086645186223595D-1*t73*t577
     #+0.9659068321987509D-2*t471)*t77-0.2697586091519874D1*t181*(
     #-0.1712109500228824D0*t182*t55*t575*t59+0.760937555657255D-1
     #*t503-0.5862637881547585D-1*t191*t577+0.2605616836243371D-1*t514
     #))*t200-0.2222222222222222D0*t435+0.1160941021565938D1*t430)
      v2rhoa2(i) = s5+s6
      t609 = 0.1693351429491009D0*t231*t55*t8
      t611 = 0.6400504953199731D0*t108*t113
      t612 = sigma*t118
      t614 = 0.3386762578223905D0*t612*t295
      t654 = t255*t180
      s1 = -0.9847450218426965D0*t2*t242*t33+0.9847450218426965D0*t100
     #*t249-0.3692793831910112D0*t3*(-t609-t611+t614
     #-0.6585165072715151D0*t118*t17*sigma+0.5733741200023695D0*t25
     #/t422*t17-0.5572516903516501D0*t19*t108)*t33
     #+0.3692793831910112D0*t125*t249+0.3692793831910112D0*t243*t132
      s2 = s1-0.7385587663820224D0*t24*t306*t131*t248
     #+0.3692793831910112D0*t24*t129*(-t609-t611+t614
     #-0.2328970847998285D-3*t612)
      v2rhoasigmaaa(i) = s2+0.9894226974230308D-1*t266+0.4D1*t269
     #-0.1044846919409344D2*t273+4.D0*rho*(0.2473556743557577D-1*
     #(0.2697586091519874D1*(-0.148092480894642D0*t162
     #-0.2173290372447189D-1*t182*t169-0.1014202173808688D0*t68*t173)
     #*t77-0.2697586091519874D1*t476*t262-0.2697586091519874D1*t654
     #*t196+0.5395172183039748D1*t481*t196*t262-0.2697586091519874D1
     #*t181*(-0.1712109500228824D0*t72*t55*t167*t59
     #-0.3994922167200589D0*t61*t162-0.1172527576309517D0*t495*t169
     #-0.273589767805554D0*t182*t173))*t200-0.2473556743557577D-1*t199
     #*t439*t265+0.1D1*t217*t55*t17-0.261211729852336D1*t218*t272
     #-0.2333333333333333D1*t93*t162*t17+0.2002623262201243D2*t94*t226
     #-0.181950847499866D2*t224/t12/t316*t17)
      t701 = 0.1270013572118256D0/t4/sigma*t5*t8
      t705 = 0.1600126238299933D0/sigma*t14*t113
      t707 = 0.2540071933667929D0*t29*t295
      t719 = t248**2
      t733 = t262**2
      t742 = t265**2
      v2sigmaaa2(i) = -0.7385587663820224D0*t3*(-t701+t705-t707
     #-0.4300305900017772D0/t316*t17*sigma+0.3292582536357576D0*t237)
     #*t33+0.1477117532764045D1*t243*t249-0.1477117532764045D1*t24
     #*t306*t719+0.7385587663820224D0*t24*t129*(-t701+t705-t707
     #+0.8733640679993569D-4*t29)+16.D0*rho*(0.2473556743557577D-1*
     #(0.5862637881547585D-1*t61*t64*t77-0.5395172183039748D1*t654
     #*t262+0.5395172183039748D1*t481*t733-0.1581497040888031D0*t181
     #*t72*t64)*t200-0.2473556743557577D-1*t742*t439
     #-0.522423459704672D1*t93*t271*t17+0.6823156781244976D1*t94/t12
     #/t290*t17)
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end

c:XC_PW91subrend
_ENDIF
_IF(ccpdft,all,xc_kt1)
c:XC_KT1subrstart

c    Generated: Tue May  4 10:43:50 GMT 2004

      subroutine uks_xc_kt1
     & (ideriv,npt,rhoa1,rhob1,sigmaaa1,sigmabb1,sigmaab1,
     &  zk,vrhoa,vrhob,vsigmaaa,vsigmabb,vsigmaab,
     &  v2rhoa2,v2rhob2,v2rhoab,
     &  v2rhoasigmaaa,v2rhoasigmaab,v2rhoasigmabb,
     &  v2rhobsigmabb,v2rhobsigmaab,v2rhobsigmaaa,
     &  v2sigmaaa2,v2sigmaaaab,v2sigmaaabb,
     &  v2sigmaab2,v2sigmaabbb,v2sigmabb2)
c
c     T.W. Keal, and D.J. Tozer
c     The exchange-correlation potential in Kohn-Sham nuclear magnetic 
c     resonance shielding calculations
c     J. Chem. Phys. 119 (2003) 3015-3024
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt),rhob1(npt)
      REAL sigmaaa1(npt),sigmabb1(npt),sigmaab1(npt)
      REAL zk(npt),vrhoa(npt),vrhob(npt)
      REAL vsigmaaa(npt),vsigmabb(npt),vsigmaab(npt)
      REAL v2rhoa2(npt),v2rhob2(npt),v2rhoab(npt)
      REAL v2rhoasigmaaa(npt),v2rhoasigmaab(npt)
      REAL v2rhoasigmabb(npt),v2rhobsigmabb(npt)
      REAL v2rhobsigmaab(npt),v2rhobsigmaaa(npt)
      REAL v2sigmaaa2(npt),v2sigmaaaab(npt),v2sigmaaabb(npt)
      REAL v2sigmaab2(npt),v2sigmaabbb(npt),v2sigmabb2(npt)
      parameter(tol=1.0d-20)
      
      if (ideriv.eq.0) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t3 = t2*rhob
      t5 = 1/rhob
      t6 = t5**(1.D0/6.D0)
      t7 = 0.7876233178997433D0*t6
      t9 = (t7+0.10498D0)**2
      t10 = t5**(1.D0/3.D0)
      t11 = 0.6203504908994D0*t10
      t16 = dlog(t9/(t11+0.2935818660072219D1*t6+0.129352D2))
      t20 = 1/(t11+0.5560951426165705D1*t6+0.180578D2)
      t23 = dlog(0.6203504908994D0*t10*t20)
      t29 = datan(0.4730926909560113D1/(0.1575246635799487D1*t6
     #+0.706042D1))
      t32 = (t7+0.325D0)**2
      t34 = dlog(t32*t20)
      zk(i) = -0.9305257363491D0*t3+rhob*(0.1D-23*t16+0.1554535D-1*t23
     #+0.5249139316978094D-1*t29+0.2247867095542612D-2*t34)-0.6D-2
     #*sigmabb/(t3+0.1D0)
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t3 = t2*rhoa
      t5 = 1/rhoa
      t6 = t5**(1.D0/6.D0)
      t7 = 0.7876233178997433D0*t6
      t9 = (t7+0.10498D0)**2
      t10 = t5**(1.D0/3.D0)
      t11 = 0.6203504908994D0*t10
      t16 = dlog(t9/(t11+0.2935818660072219D1*t6+0.129352D2))
      t20 = 1/(t11+0.5560951426165705D1*t6+0.180578D2)
      t23 = dlog(0.6203504908994D0*t10*t20)
      t29 = datan(0.4730926909560113D1/(0.1575246635799487D1*t6
     #+0.706042D1))
      t32 = (t7+0.325D0)**2
      t34 = dlog(t32*t20)
      zk(i) = -0.9305257363491D0*t3+rhoa*(0.1D-23*t16+0.1554535D-1*t23
     #+0.5249139316978094D-1*t29+0.2247867095542612D-2*t34)-0.6D-2
     #*sigmaaa/(t3+0.1D0)
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t5 = t4*rhoa
      t11 = rhob**(1.D0/3.D0)
      t12 = t11*rhob
      t18 = 1/rho
      t19 = t18**(1.D0/3.D0)
      t20 = 0.6203504908994D0*t19
      t21 = t18**(1.D0/6.D0)
      t24 = 1/(t20+0.2935818660072219D1*t21+0.129352D2)
      t27 = dlog(0.6203504908994D0*t19*t24)
      t29 = 0.1575246635799487D1*t21
      t33 = datan(0.615199081975908D1/(t29+0.372744D1))
      t35 = 0.7876233178997433D0*t21
      t37 = (t35+0.10498D0)**2
      t39 = dlog(t37*t24)
      t43 = 1/(t20+0.8908571061768626D0*t21+0.130045D2)
      t46 = dlog(0.6203504908994D0*t19*t43)
      t50 = datan(0.7123108917818118D1/(t29+0.113107D1))
      t53 = (t35+0.47584D-2)**2
      t55 = dlog(t53*t43)
      t57 = t46+0.3177080047439415D0*t50+0.4140337942820627D-3*t55
      t59 = rhoa-1.D0*rhob
      t60 = t59*t18
      t61 = 1.D0+t60
      t62 = t61**(1.D0/3.D0)
      t65 = 1.D0-1.D0*t60
      t66 = t65**(1.D0/3.D0)
      t72 = 1/(t20+0.5560951426165705D1*t21+0.180578D2)
      t75 = dlog(0.6203504908994D0*t19*t72)
      t80 = datan(0.4730926909560113D1/(t29+0.706042D1))
      t83 = (t35+0.325D0)**2
      t85 = dlog(t83*t72)
      t95 = t59**2
      t96 = t95**2
      t98 = rho**2
      t99 = t98**2
      zk(i) = -0.9305257363491D0*t5-0.6D-2*sigmaaa/(t5+0.1D0)
     #-0.9305257363491D0*t12-0.6D-2*sigmabb/(t12+0.1D0)+rho*
     #(0.310907D-1*t27+0.3878329487811301D-1*t33+0.9690227711544374D-3
     #*t39-0.1899772193293833D-1*t57*(t62*t61+t66*t65-2.D0)*(1.D0+(
     #-0.101257459063883D3*(0.1554535D-1*t75+0.5249139316978094D-1*t80
     #+0.2247867095542612D-2*t85-0.310907D-1*t27-0.3878329487811301D-1
     #*t33-0.9690227711544374D-3*t39)/t57-1.D0)*t96/t99))
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t3 = t2*rhob
      t5 = 1/rhob
      t6 = t5**(1.D0/6.D0)
      t7 = 0.7876233178997433D0*t6
      t8 = t7+0.10498D0
      t9 = t8**2
      t10 = t5**(1.D0/3.D0)
      t11 = 0.6203504908994D0*t10
      t13 = t11+0.2935818660072219D1*t6+0.129352D2
      t14 = 1/t13
      t16 = dlog(t9*t14)
      t17 = 0.1D-23*t16
      t19 = t11+0.5560951426165705D1*t6+0.180578D2
      t20 = 1/t19
      t23 = dlog(0.6203504908994D0*t10*t20)
      t24 = 0.1554535D-1*t23
      t25 = 0.1575246635799487D1*t6
      t26 = t25+0.706042D1
      t29 = datan(0.4730926909560113D1/t26)
      t30 = 0.5249139316978094D-1*t29
      t31 = t7+0.325D0
      t32 = t31**2
      t34 = dlog(t32*t20)
      t35 = 0.2247867095542612D-2*t34
      t38 = t3+0.1D0
      t39 = 1/t38
      zk(i) = -0.9305257363491D0*t3+rhob*(t17+t24+t30+t35)-0.6D-2
     #*sigmabb*t39
      vrhoa(i) = 0.D0
      t43 = t38**2
      t48 = t10**2
      t49 = 1/t48
      t51 = rhob**2
      t52 = 1/t51
      t55 = t13**2
      t56 = 1/t55
      t59 = 0.2067834969664667D0*t49*t52
      t60 = t6**2
      t61 = t60**2
      t63 = 1/t61/t6
      t64 = t63*t52
      t66 = -t59-0.4893031100120365D0*t64
      t70 = 1/t10
      t75 = (t25+0.372744D1)**2
      t76 = 1/t75
      t98 = t19**2
      t99 = 1/t98
      t102 = -t59-0.9268252376942842D0*t64
      t109 = t26**2
      t110 = 1/t109
      vrhob(i) = -0.12407009817988D1*t2+0.8D-2*sigmabb/t43*t2+t17+t24
     #+t30+t35+rhob*(0.2D-21*(-0.2067834969664667D0*t49*t14*t52
     #-0.6203504908994D0*t10*t56*t66)*t70*t13-0.1D-21*t76*t63*t52/
     #(1.D0+0.378469910464D2*t76)+0.1D-23*(-0.2625411059665811D0*t8
     #*t14*t64-1.D0*t9*t56*t66)/t9*t13+0.2505897912236993D-1*(
     #-0.2067834969664667D0*t49*t20*t52-0.6203504908994D0*t10*t99*t102
     #)*t70*t19+0.6519760588836059D-1*t110*t63*t52/(1.D0
     #+0.223816694236D2*t110)+0.2247867095542612D-2*(
     #-0.2625411059665811D0*t31*t20*t64-1.D0*t32*t99*t102)/t32*t19)
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      vsigmabb(i) = -0.6D-2*t39
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t3 = t2*rhoa
      t5 = 1/rhoa
      t6 = t5**(1.D0/6.D0)
      t7 = 0.7876233178997433D0*t6
      t8 = t7+0.10498D0
      t9 = t8**2
      t10 = t5**(1.D0/3.D0)
      t11 = 0.6203504908994D0*t10
      t13 = t11+0.2935818660072219D1*t6+0.129352D2
      t14 = 1/t13
      t16 = dlog(t9*t14)
      t17 = 0.1D-23*t16
      t19 = t11+0.5560951426165705D1*t6+0.180578D2
      t20 = 1/t19
      t23 = dlog(0.6203504908994D0*t10*t20)
      t24 = 0.1554535D-1*t23
      t25 = 0.1575246635799487D1*t6
      t26 = t25+0.706042D1
      t29 = datan(0.4730926909560113D1/t26)
      t30 = 0.5249139316978094D-1*t29
      t31 = t7+0.325D0
      t32 = t31**2
      t34 = dlog(t32*t20)
      t35 = 0.2247867095542612D-2*t34
      t38 = t3+0.1D0
      t39 = 1/t38
      zk(i) = -0.9305257363491D0*t3+rhoa*(t17+t24+t30+t35)-0.6D-2
     #*sigmaaa*t39
      t43 = t38**2
      t48 = t10**2
      t49 = 1/t48
      t51 = rhoa**2
      t52 = 1/t51
      t55 = t13**2
      t56 = 1/t55
      t59 = 0.2067834969664667D0*t49*t52
      t60 = t6**2
      t61 = t60**2
      t63 = 1/t61/t6
      t64 = t63*t52
      t66 = -t59-0.4893031100120365D0*t64
      t70 = 1/t10
      t75 = (t25+0.372744D1)**2
      t76 = 1/t75
      t98 = t19**2
      t99 = 1/t98
      t102 = -t59-0.9268252376942842D0*t64
      t109 = t26**2
      t110 = 1/t109
      vrhoa(i) = -0.12407009817988D1*t2+0.8D-2*sigmaaa/t43*t2+t17+t24
     #+t30+t35+rhoa*(0.2D-21*(-0.2067834969664667D0*t49*t14*t52
     #-0.6203504908994D0*t10*t56*t66)*t70*t13-0.1D-21*t76*t63*t52/
     #(1.D0+0.378469910464D2*t76)+0.1D-23*(-0.2625411059665811D0*t8
     #*t14*t64-1.D0*t9*t56*t66)/t9*t13+0.2505897912236993D-1*(
     #-0.2067834969664667D0*t49*t20*t52-0.6203504908994D0*t10*t99*t102
     #)*t70*t19+0.6519760588836059D-1*t110*t63*t52/(1.D0
     #+0.223816694236D2*t110)+0.2247867095542612D-2*(
     #-0.2625411059665811D0*t31*t20*t64-1.D0*t32*t99*t102)/t32*t19)
      vrhob(i) = 0.D0
      vsigmaaa(i) = -0.6D-2*t39
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t5 = t4*rhoa
      t7 = t5+0.1D0
      t8 = 1/t7
      t11 = rhob**(1.D0/3.D0)
      t12 = t11*rhob
      t14 = t12+0.1D0
      t15 = 1/t14
      t18 = 1/rho
      t19 = t18**(1.D0/3.D0)
      t20 = 0.6203504908994D0*t19
      t21 = t18**(1.D0/6.D0)
      t23 = t20+0.2935818660072219D1*t21+0.129352D2
      t24 = 1/t23
      t27 = dlog(0.6203504908994D0*t19*t24)
      t28 = 0.310907D-1*t27
      t29 = 0.1575246635799487D1*t21
      t30 = t29+0.372744D1
      t33 = datan(0.615199081975908D1/t30)
      t34 = 0.3878329487811301D-1*t33
      t35 = 0.7876233178997433D0*t21
      t36 = t35+0.10498D0
      t37 = t36**2
      t39 = dlog(t37*t24)
      t40 = 0.9690227711544374D-3*t39
      t42 = t20+0.8908571061768626D0*t21+0.130045D2
      t43 = 1/t42
      t46 = dlog(0.6203504908994D0*t19*t43)
      t47 = t29+0.113107D1
      t50 = datan(0.7123108917818118D1/t47)
      t52 = t35+0.47584D-2
      t53 = t52**2
      t55 = dlog(t53*t43)
      t57 = t46+0.3177080047439415D0*t50+0.4140337942820627D-3*t55
      t59 = rhoa-1.D0*rhob
      t60 = t59*t18
      t61 = 1.D0+t60
      t62 = t61**(1.D0/3.D0)
      t65 = 1.D0-1.D0*t60
      t66 = t65**(1.D0/3.D0)
      t68 = t62*t61+t66*t65-2.D0
      t69 = t57*t68
      t71 = t20+0.5560951426165705D1*t21+0.180578D2
      t72 = 1/t71
      t75 = dlog(0.6203504908994D0*t19*t72)
      t77 = t29+0.706042D1
      t80 = datan(0.4730926909560113D1/t77)
      t82 = t35+0.325D0
      t83 = t82**2
      t85 = dlog(t83*t72)
      t90 = 0.1554535D-1*t75+0.5249139316978094D-1*t80
     #+0.2247867095542612D-2*t85-0.310907D-1*t27-0.3878329487811301D-1
     #*t33-0.9690227711544374D-3*t39
      t91 = 1/t57
      t94 = -0.101257459063883D3*t90*t91-1.D0
      t95 = t59**2
      t96 = t95**2
      t97 = t94*t96
      t98 = rho**2
      t99 = t98**2
      t100 = 1/t99
      t102 = 1.D0+t97*t100
      t104 = 0.1899772193293833D-1*t69*t102
      zk(i) = -0.9305257363491D0*t5-0.6D-2*sigmaaa*t8
     #-0.9305257363491D0*t12-0.6D-2*sigmabb*t15+rho*(t28+t34+t40-t104)
      t108 = t7**2
      t117 = 0.1333333333333333D1*t62*t18-0.1333333333333333D1*t66*t18
      t124 = t69*t94*t95*t59*t100
      t128 = t19**2
      t129 = 1/t128
      t131 = 1/t98
      t134 = t23**2
      t135 = 1/t134
      t138 = 0.2067834969664667D0*t129*t131
      t139 = t21**2
      t140 = t139**2
      t142 = 1/t140/t21
      t143 = t142*t131
      t145 = -t138-0.4893031100120365D0*t143
      t149 = 1/t19
      t151 = (-0.2067834969664667D0*t129*t24*t131-0.6203504908994D0
     #*t19*t135*t145)*t149*t23
      t153 = t30**2
      t154 = 1/t153
      t160 = t154*t142*t131/(1.D0+0.378469910464D2*t154)
      t171 = (-0.2625411059665811D0*t36*t24*t143-1.D0*t37*t135*t145)
     #/t37*t23
      t176 = t42**2
      t177 = 1/t176
      t180 = -t138-0.1484761843628104D0*t143
      t187 = t47**2
      t188 = 1/t187
      t207 = 0.161199195401647D1*(-0.2067834969664667D0*t129*t43*t131
     #-0.6203504908994D0*t19*t177*t180)*t149*t42+0.5941485651138659D0
     #*t188*t142*t131/(1.D0+0.507386806551D2*t188)
     #+0.4140337942820627D-3*(-0.2625411059665811D0*t52*t43*t143-1.D0
     #*t53*t177*t180)/t53*t42
      t224 = t71**2
      t225 = 1/t224
      t228 = -t138-0.9268252376942842D0*t143
      t235 = t77**2
      t236 = 1/t235
      t261 = t57**2
      t277 = rho*(0.5011795824473985D-1*t151+0.626408570946439D-1*t160
     #+0.9690227711544374D-3*t171-0.1899772193293833D-1*t207*t68*t102
     #-0.1899772193293833D-1*t57*(-0.1333333333333333D1*t62*t59*t131
     #+0.1333333333333333D1*t66*t59*t131)*t102-0.1899772193293833D-1
     #*t69*((-0.101257459063883D3*(0.2505897912236993D-1*(
     #-0.2067834969664667D0*t129*t72*t131-0.6203504908994D0*t19*t225
     #*t228)*t149*t71+0.6519760588836059D-1*t236*t142*t131/(1.D0
     #+0.223816694236D2*t236)+0.2247867095542612D-2*(
     #-0.2625411059665811D0*t82*t72*t143-1.D0*t83*t225*t228)/t83*t71
     #-0.5011795824473985D-1*t151-0.626408570946439D-1*t160
     #-0.9690227711544374D-3*t171)*t91+0.101257459063883D3*t90/t261
     #*t207)*t96*t100-4.D0*t97/t99/rho))
      vrhoa(i) = -0.12407009817988D1*t4+0.8D-2*sigmaaa/t108*t4+rho*(
     #-0.1899772193293833D-1*t57*t117*t102-0.7599088773175333D-1*t124)
     #+t28+t34+t40-t104+t277
      t279 = t14**2
      vrhob(i) = -0.12407009817988D1*t11+0.8D-2*sigmabb/t279*t11+rho*
     #(0.1899772193293833D-1*t57*t117*t102+0.7599088773175333D-1*t124)
     #+t28+t34+t40-t104+t277
      vsigmaaa(i) = -0.6D-2*t8
      vsigmaab(i) = 0.D0
      vsigmabb(i) = -0.6D-2*t15
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t3 = t2*rhob
      t5 = 1/rhob
      t6 = t5**(1.D0/6.D0)
      t7 = 0.7876233178997433D0*t6
      t8 = t7+0.10498D0
      t9 = t8**2
      t10 = t5**(1.D0/3.D0)
      t11 = 0.6203504908994D0*t10
      t13 = t11+0.2935818660072219D1*t6+0.129352D2
      t14 = 1/t13
      t16 = dlog(t9*t14)
      t17 = 0.1D-23*t16
      t19 = t11+0.5560951426165705D1*t6+0.180578D2
      t20 = 1/t19
      t23 = dlog(0.6203504908994D0*t10*t20)
      t24 = 0.1554535D-1*t23
      t25 = 0.1575246635799487D1*t6
      t26 = t25+0.706042D1
      t29 = datan(0.4730926909560113D1/t26)
      t30 = 0.5249139316978094D-1*t29
      t31 = t7+0.325D0
      t32 = t31**2
      t34 = dlog(t32*t20)
      t35 = 0.2247867095542612D-2*t34
      t38 = t3+0.1D0
      t39 = 1/t38
      zk(i) = -0.9305257363491D0*t3+rhob*(t17+t24+t30+t35)-0.6D-2
     #*sigmabb*t39
      vrhoa(i) = 0.D0
      t43 = t38**2
      t45 = sigmabb/t43
      t48 = t10**2
      t49 = 1/t48
      t50 = t49*t14
      t51 = rhob**2
      t52 = 1/t51
      t55 = t13**2
      t56 = 1/t55
      t57 = t10*t56
      t59 = 0.2067834969664667D0*t49*t52
      t60 = t6**2
      t61 = t60**2
      t62 = t61*t6
      t63 = 1/t62
      t64 = t63*t52
      t66 = -t59-0.4893031100120365D0*t64
      t70 = 1/t10
      t71 = (-0.2067834969664667D0*t50*t52-0.6203504908994D0*t57*t66)
     #*t70
      t75 = (t25+0.372744D1)**2
      t76 = 1/t75
      t80 = 1/(1.D0+0.378469910464D2*t76)
      t84 = t8*t14
      t87 = t9*t56
      t91 = 1/t9
      t92 = (-0.2625411059665811D0*t84*t64-1.D0*t87*t66)*t91
      t95 = t49*t20
      t98 = t19**2
      t99 = 1/t98
      t100 = t10*t99
      t102 = -t59-0.9268252376942842D0*t64
      t105 = -0.2067834969664667D0*t95*t52-0.6203504908994D0*t100*t102
      t106 = t105*t70
      t107 = t106*t19
      t109 = t26**2
      t110 = 1/t109
      t111 = t110*t63
      t113 = 1.D0+0.223816694236D2*t110
      t114 = 1/t113
      t116 = t111*t52*t114
      t118 = t31*t20
      t121 = t32*t99
      t124 = -0.2625411059665811D0*t118*t64-1.D0*t121*t102
      t125 = 1/t32
      t126 = t124*t125
      t127 = t126*t19
      vrhob(i) = -0.12407009817988D1*t2+0.8D-2*t45*t2+t17+t24+t30+t35
     #+rhob*(0.2D-21*t71*t13-0.1D-21*t76*t63*t52*t80+0.1D-23*t92*t13
     #+0.2505897912236993D-1*t107+0.6519760588836059D-1*t116
     #+0.2247867095542612D-2*t127)
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      vsigmabb(i) = -0.6D-2*t39
      v2rhoa2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t132 = t2**2
      t133 = 1/t132
      t146 = 1/t48/t5
      t148 = t51**2
      t149 = 1/t148
      t150 = t146*t14*t149
      t157 = 1/t51/rhob
      t161 = 1/t55/t13
      t163 = t66**2
      t167 = 0.1378556646443111D0*t146*t149
      t169 = 0.4135669939329333D0*t49*t157
      t171 = 1/t62/t5
      t172 = t171*t149
      t174 = t63*t157
      t176 = -t167+t169-0.4077525916766971D0*t172+0.978606220024073D0
     #*t174
      t218 = t149*t114
      t225 = t146*t20*t149
      t234 = 1/t98/t19
      t236 = t102**2
      t241 = -t167+t169-0.7723543647452368D0*t172+0.1853650475388568D1
     #*t174
      t253 = t109**2
      t257 = t113**2
      s1 = 0.2D-21*(-0.1378556646443111D0*t150+0.4135669939329333D0
     #*t49*t56*t52*t66+0.4135669939329333D0*t50*t157
     #+0.12407009817988D1*t10*t161*t163-0.6203504908994D0*t57*t176)
     #*t70*t13+0.1D-21*t76*t171*t149*t80+0.1D-23*
     #(0.3446391616107778D-1*t150+0.5250822119331622D0*t8*t56*t64*t66
     #-0.2187842549721509D0*t84*t172+0.5250822119331622D0*t84*t174
     #+2.D0*t9*t161*t163-1.D0*t87*t176)*t91*t13+0.2D-21*t71*t66
     #+0.1D-23*t92*t66+0.8352993040789975D-2*t105/t10/t5*t19*t52
     #+0.3423410311260694D-1/t109/t26*t146*t218
      t289 = s1+0.5433133824030049D-1*t110*t171*t218
     #+0.2505897912236993D-1*(-0.1378556646443111D0*t225
     #+0.4135669939329333D0*t49*t99*t52*t102+0.4135669939329333D0*t95
     #*t157+0.12407009817988D1*t10*t234*t236-0.6203504908994D0*t100
     #*t241)*t70*t19+0.2505897912236993D-1*t106*t102
     #-0.1303952117767212D0*t111*t157*t114-0.7662163788798043D0/t253
     #/t26*t146*t149/t257+0.2247867095542612D-2*(0.3446391616107778D-1
     #*t225+0.5250822119331622D0*t31*t99*t64*t102-0.2187842549721509D0
     #*t118*t172+0.5250822119331622D0*t118*t174+2.D0*t32*t234*t236
     #-1.D0*t121*t241)*t125*t19+0.5901575133296437D-3*t124/t32/t31*t19
     #*t63*t52+0.2247867095542612D-2*t126*t102
      v2rhob2(i) = -0.4135669939329333D0*t133-0.2133333333333333D-1
     #*sigmabb/t43/t38*t132+0.2666666666666667D-2*t45*t133
     #+0.5011795824473985D-1*t107+0.1303952117767212D0*t116
     #+0.4495734191085224D-2*t127+rhob*t289
      v2sigmaaa2(i) = 0.D0
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      v2sigmabb2(i) = 0.D0
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t3 = t2*rhoa
      t5 = 1/rhoa
      t6 = t5**(1.D0/6.D0)
      t7 = 0.7876233178997433D0*t6
      t8 = t7+0.10498D0
      t9 = t8**2
      t10 = t5**(1.D0/3.D0)
      t11 = 0.6203504908994D0*t10
      t13 = t11+0.2935818660072219D1*t6+0.129352D2
      t14 = 1/t13
      t16 = dlog(t9*t14)
      t17 = 0.1D-23*t16
      t19 = t11+0.5560951426165705D1*t6+0.180578D2
      t20 = 1/t19
      t23 = dlog(0.6203504908994D0*t10*t20)
      t24 = 0.1554535D-1*t23
      t25 = 0.1575246635799487D1*t6
      t26 = t25+0.706042D1
      t29 = datan(0.4730926909560113D1/t26)
      t30 = 0.5249139316978094D-1*t29
      t31 = t7+0.325D0
      t32 = t31**2
      t34 = dlog(t32*t20)
      t35 = 0.2247867095542612D-2*t34
      t38 = t3+0.1D0
      t39 = 1/t38
      zk(i) = -0.9305257363491D0*t3+rhoa*(t17+t24+t30+t35)-0.6D-2
     #*sigmaaa*t39
      t43 = t38**2
      t45 = sigmaaa/t43
      t48 = t10**2
      t49 = 1/t48
      t50 = t49*t14
      t51 = rhoa**2
      t52 = 1/t51
      t55 = t13**2
      t56 = 1/t55
      t57 = t10*t56
      t59 = 0.2067834969664667D0*t49*t52
      t60 = t6**2
      t61 = t60**2
      t62 = t61*t6
      t63 = 1/t62
      t64 = t63*t52
      t66 = -t59-0.4893031100120365D0*t64
      t70 = 1/t10
      t71 = (-0.2067834969664667D0*t50*t52-0.6203504908994D0*t57*t66)
     #*t70
      t75 = (t25+0.372744D1)**2
      t76 = 1/t75
      t80 = 1/(1.D0+0.378469910464D2*t76)
      t84 = t8*t14
      t87 = t9*t56
      t91 = 1/t9
      t92 = (-0.2625411059665811D0*t84*t64-1.D0*t87*t66)*t91
      t95 = t49*t20
      t98 = t19**2
      t99 = 1/t98
      t100 = t10*t99
      t102 = -t59-0.9268252376942842D0*t64
      t105 = -0.2067834969664667D0*t95*t52-0.6203504908994D0*t100*t102
      t106 = t105*t70
      t107 = t106*t19
      t109 = t26**2
      t110 = 1/t109
      t111 = t110*t63
      t113 = 1.D0+0.223816694236D2*t110
      t114 = 1/t113
      t116 = t111*t52*t114
      t118 = t31*t20
      t121 = t32*t99
      t124 = -0.2625411059665811D0*t118*t64-1.D0*t121*t102
      t125 = 1/t32
      t126 = t124*t125
      t127 = t126*t19
      vrhoa(i) = -0.12407009817988D1*t2+0.8D-2*t45*t2+t17+t24+t30+t35
     #+rhoa*(0.2D-21*t71*t13-0.1D-21*t76*t63*t52*t80+0.1D-23*t92*t13
     #+0.2505897912236993D-1*t107+0.6519760588836059D-1*t116
     #+0.2247867095542612D-2*t127)
      vrhob(i) = 0.D0
      vsigmaaa(i) = -0.6D-2*t39
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      t132 = t2**2
      t133 = 1/t132
      t146 = 1/t48/t5
      t148 = t51**2
      t149 = 1/t148
      t150 = t146*t14*t149
      t157 = 1/t51/rhoa
      t161 = 1/t55/t13
      t163 = t66**2
      t167 = 0.1378556646443111D0*t146*t149
      t169 = 0.4135669939329333D0*t49*t157
      t171 = 1/t62/t5
      t172 = t171*t149
      t174 = t63*t157
      t176 = -t167+t169-0.4077525916766971D0*t172+0.978606220024073D0
     #*t174
      t218 = t149*t114
      t225 = t146*t20*t149
      t234 = 1/t98/t19
      t236 = t102**2
      t241 = -t167+t169-0.7723543647452368D0*t172+0.1853650475388568D1
     #*t174
      t253 = t109**2
      t257 = t113**2
      s1 = 0.2D-21*(-0.1378556646443111D0*t150+0.4135669939329333D0
     #*t49*t56*t52*t66+0.4135669939329333D0*t50*t157
     #+0.12407009817988D1*t10*t161*t163-0.6203504908994D0*t57*t176)
     #*t70*t13+0.1D-21*t76*t171*t149*t80+0.1D-23*
     #(0.3446391616107778D-1*t150+0.5250822119331622D0*t8*t56*t64*t66
     #-0.2187842549721509D0*t84*t172+0.5250822119331622D0*t84*t174
     #+2.D0*t9*t161*t163-1.D0*t87*t176)*t91*t13+0.2D-21*t71*t66
     #+0.1D-23*t92*t66+0.8352993040789975D-2*t105/t10/t5*t19*t52
     #+0.3423410311260694D-1/t109/t26*t146*t218
      t289 = s1+0.5433133824030049D-1*t110*t171*t218
     #+0.2505897912236993D-1*(-0.1378556646443111D0*t225
     #+0.4135669939329333D0*t49*t99*t52*t102+0.4135669939329333D0*t95
     #*t157+0.12407009817988D1*t10*t234*t236-0.6203504908994D0*t100
     #*t241)*t70*t19+0.2505897912236993D-1*t106*t102
     #-0.1303952117767212D0*t111*t157*t114-0.7662163788798043D0/t253
     #/t26*t146*t149/t257+0.2247867095542612D-2*(0.3446391616107778D-1
     #*t225+0.5250822119331622D0*t31*t99*t64*t102-0.2187842549721509D0
     #*t118*t172+0.5250822119331622D0*t118*t174+2.D0*t32*t234*t236
     #-1.D0*t121*t241)*t125*t19+0.5901575133296437D-3*t124/t32/t31*t19
     #*t63*t52+0.2247867095542612D-2*t126*t102
      v2rhoa2(i) = -0.4135669939329333D0*t133-0.2133333333333333D-1
     #*sigmaaa/t43/t38*t132+0.2666666666666667D-2*t45*t133
     #+0.5011795824473985D-1*t107+0.1303952117767212D0*t116
     #+0.4495734191085224D-2*t127+rhoa*t289
      v2rhob2(i) = 0.D0
      v2rhoab(i) = 0.D0
      v2sigmaaa2(i) = 0.D0
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      v2sigmabb2(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t5 = t4*rhoa
      t7 = t5+0.1D0
      t8 = 1/t7
      t11 = rhob**(1.D0/3.D0)
      t12 = t11*rhob
      t14 = t12+0.1D0
      t15 = 1/t14
      t18 = 1/rho
      t19 = t18**(1.D0/3.D0)
      t20 = 0.6203504908994D0*t19
      t21 = t18**(1.D0/6.D0)
      t23 = t20+0.2935818660072219D1*t21+0.129352D2
      t24 = 1/t23
      t27 = dlog(0.6203504908994D0*t19*t24)
      t28 = 0.310907D-1*t27
      t29 = 0.1575246635799487D1*t21
      t30 = t29+0.372744D1
      t33 = datan(0.615199081975908D1/t30)
      t34 = 0.3878329487811301D-1*t33
      t35 = 0.7876233178997433D0*t21
      t36 = t35+0.10498D0
      t37 = t36**2
      t39 = dlog(t37*t24)
      t40 = 0.9690227711544374D-3*t39
      t42 = t20+0.8908571061768626D0*t21+0.130045D2
      t43 = 1/t42
      t46 = dlog(0.6203504908994D0*t19*t43)
      t47 = t29+0.113107D1
      t50 = datan(0.7123108917818118D1/t47)
      t52 = t35+0.47584D-2
      t53 = t52**2
      t55 = dlog(t53*t43)
      t57 = t46+0.3177080047439415D0*t50+0.4140337942820627D-3*t55
      t59 = rhoa-1.D0*rhob
      t60 = t59*t18
      t61 = 1.D0+t60
      t62 = t61**(1.D0/3.D0)
      t65 = 1.D0-1.D0*t60
      t66 = t65**(1.D0/3.D0)
      t68 = t62*t61+t66*t65-2.D0
      t69 = t57*t68
      t71 = t20+0.5560951426165705D1*t21+0.180578D2
      t72 = 1/t71
      t75 = dlog(0.6203504908994D0*t19*t72)
      t77 = t29+0.706042D1
      t80 = datan(0.4730926909560113D1/t77)
      t82 = t35+0.325D0
      t83 = t82**2
      t85 = dlog(t83*t72)
      t90 = 0.1554535D-1*t75+0.5249139316978094D-1*t80
     #+0.2247867095542612D-2*t85-0.310907D-1*t27-0.3878329487811301D-1
     #*t33-0.9690227711544374D-3*t39
      t91 = 1/t57
      t94 = -0.101257459063883D3*t90*t91-1.D0
      t95 = t59**2
      t96 = t95**2
      t97 = t94*t96
      t98 = rho**2
      t99 = t98**2
      t100 = 1/t99
      t102 = 1.D0+t97*t100
      t104 = 0.1899772193293833D-1*t69*t102
      zk(i) = -0.9305257363491D0*t5-0.6D-2*sigmaaa*t8
     #-0.9305257363491D0*t12-0.6D-2*sigmabb*t15+rho*(t28+t34+t40-t104)
      t108 = t7**2
      t109 = 1/t108
      t110 = sigmaaa*t109
      t117 = 0.1333333333333333D1*t62*t18-0.1333333333333333D1*t66*t18
      t118 = t57*t117
      t119 = t118*t102
      t120 = 0.1899772193293833D-1*t119
      t121 = t95*t59
      t122 = t94*t121
      t123 = t122*t100
      t124 = t69*t123
      t128 = t19**2
      t129 = 1/t128
      t130 = t129*t24
      t131 = 1/t98
      t134 = t23**2
      t135 = 1/t134
      t136 = t19*t135
      t138 = 0.2067834969664667D0*t129*t131
      t139 = t21**2
      t140 = t139**2
      t141 = t140*t21
      t142 = 1/t141
      t143 = t142*t131
      t145 = -t138-0.4893031100120365D0*t143
      t148 = -0.2067834969664667D0*t130*t131-0.6203504908994D0*t136*t145
      t149 = 1/t19
      t150 = t148*t149
      t151 = t150*t23
      t153 = t30**2
      t154 = 1/t153
      t155 = t154*t142
      t157 = 1.D0+0.378469910464D2*t154
      t158 = 1/t157
      t160 = t155*t131*t158
      t162 = t36*t24
      t165 = t37*t135
      t168 = -0.2625411059665811D0*t162*t143-1.D0*t165*t145
      t169 = 1/t37
      t170 = t168*t169
      t171 = t170*t23
      t173 = t129*t43
      t176 = t42**2
      t177 = 1/t176
      t178 = t19*t177
      t180 = -t138-0.1484761843628104D0*t143
      t183 = -0.2067834969664667D0*t173*t131-0.6203504908994D0*t178*t180
      t184 = t183*t149
      t187 = t47**2
      t188 = 1/t187
      t189 = t188*t142
      t191 = 1.D0+0.507386806551D2*t188
      t192 = 1/t191
      t196 = t52*t43
      t199 = t53*t177
      t202 = -0.2625411059665811D0*t196*t143-1.D0*t199*t180
      t203 = 1/t53
      t204 = t202*t203
      t207 = 0.161199195401647D1*t184*t42+0.5941485651138659D0*t189
     #*t131*t192+0.4140337942820627D-3*t204*t42
      t208 = t207*t68
      t209 = t208*t102
      t211 = t62*t59
      t214 = t66*t59
      t217 = -0.1333333333333333D1*t211*t131+0.1333333333333333D1*t214
     #*t131
      t218 = t57*t217
      t219 = t218*t102
      t221 = t129*t72
      t224 = t71**2
      t225 = 1/t224
      t226 = t19*t225
      t228 = -t138-0.9268252376942842D0*t143
      t231 = -0.2067834969664667D0*t221*t131-0.6203504908994D0*t226*t228
      t232 = t231*t149
      t235 = t77**2
      t236 = 1/t235
      t237 = t236*t142
      t239 = 1.D0+0.223816694236D2*t236
      t240 = 1/t239
      t244 = t82*t72
      t247 = t83*t225
      t250 = -0.2625411059665811D0*t244*t143-1.D0*t247*t228
      t251 = 1/t83
      t252 = t250*t251
      t258 = 0.2505897912236993D-1*t232*t71+0.6519760588836059D-1*t237
     #*t131*t240+0.2247867095542612D-2*t252*t71-0.5011795824473985D-1
     #*t151-0.626408570946439D-1*t160-0.9690227711544374D-3*t171
      t261 = t57**2
      t262 = 1/t261
      t263 = t90*t262
      t266 = -0.101257459063883D3*t258*t91+0.101257459063883D3*t263*t207
      t267 = t266*t96
      t270 = 1/t99/rho
      t273 = t267*t100-4.D0*t97*t270
      t274 = t69*t273
      t277 = rho*(0.5011795824473985D-1*t151+0.626408570946439D-1*t160
     #+0.9690227711544374D-3*t171-0.1899772193293833D-1*t209
     #-0.1899772193293833D-1*t219-0.1899772193293833D-1*t274)
      vrhoa(i) = -0.12407009817988D1*t4+0.8D-2*t110*t4+rho*(-t120
     #-0.7599088773175333D-1*t124)+t28+t34+t40-t104+t277
      t279 = t14**2
      t280 = 1/t279
      t281 = sigmabb*t280
      t284 = -t117
      t285 = t57*t284
      t286 = t285*t102
      t287 = 0.1899772193293833D-1*t286
      vrhob(i) = -0.12407009817988D1*t11+0.8D-2*t281*t11+rho*(-t287
     #+0.7599088773175333D-1*t124)+t28+t34+t40-t104+t277
      vsigmaaa(i) = -0.6D-2*t8
      vsigmaab(i) = 0.D0
      vsigmabb(i) = -0.6D-2*t15
      t293 = t4**2
      t294 = 1/t293
      t303 = t62**2
      t304 = 1/t303
      t307 = t66**2
      t308 = 1/t307
      t311 = 0.4444444444444444D0*t304*t131+0.4444444444444444D0*t308
     #*t131
      t314 = 0.1899772193293833D-1*t57*t311*t102
      t315 = t118*t123
      t319 = t69*t94*t95*t100
      t320 = 0.22797266319526D0*t319
      t327 = 0.1899772193293833D-1*t207*t117*t102
      t328 = t208*t123
      t329 = 0.7599088773175333D-1*t328
      t332 = 1/t98/rho
      t342 = -0.4444444444444444D0*t304*t59*t332-0.1333333333333333D1
     #*t62*t131-0.4444444444444444D0*t308*t59*t332
     #+0.1333333333333333D1*t66*t131
      t345 = 0.1899772193293833D-1*t57*t342*t102
      t346 = t218*t123
      t347 = 0.7599088773175333D-1*t346
      t349 = 0.1899772193293833D-1*t118*t273
      t351 = t266*t121*t100
      t353 = t122*t270
      t355 = 4.D0*t351-16.D0*t353
      t359 = rho*(-t327-t329-t345-t347-t349-0.1899772193293833D-1*t69
     #*t355)
      t360 = t69*t351
      t362 = t69*t353
      t365 = rho*(-t327-t345-t349-t329-t347-0.7599088773175333D-1*t360
     #+0.3039635509270133D0*t362)
      t366 = 0.1002359164894797D0*t151
      t367 = 0.1252817141892878D0*t160
      t368 = 0.1938045542308875D-2*t171
      t369 = 0.3799544386587666D-1*t209
      t370 = 0.3799544386587666D-1*t219
      t371 = 0.3799544386587666D-1*t274
      t373 = 1/t128/t18
      t375 = t373*t24*t100
      t384 = 1/t134/t23
      t386 = t145**2
      t390 = 0.1378556646443111D0*t373*t100
      t392 = 0.4135669939329333D0*t129*t332
      t394 = 1/t141/t18
      t395 = t394*t100
      t397 = t142*t332
      t399 = -t390+t392-0.4077525916766971D0*t395+0.978606220024073D0
     #*t397
      t404 = (-0.1378556646443111D0*t375+0.4135669939329333D0*t129
     #*t135*t131*t145+0.4135669939329333D0*t130*t332
     #+0.12407009817988D1*t19*t384*t386-0.6203504908994D0*t136*t399)
     #*t149*t23
      t407 = 1/t19/t18
      t410 = t148*t407*t23*t131
      t412 = t150*t145
      t417 = t100*t158
      t418 = 1/t153/t30*t373*t417
      t421 = t154*t394*t417
      t424 = t155*t332*t158
      t426 = t153**2
      t430 = t157**2
      t433 = 1/t426/t30*t373*t100/t430
      t451 = (0.3446391616107778D-1*t375+0.5250822119331622D0*t36*t135
     #*t143*t145-0.2187842549721509D0*t162*t395+0.5250822119331622D0
     #*t162*t397+2.D0*t37*t384*t386-1.D0*t165*t399)*t169*t23
      t458 = t168/t37/t36*t23*t142*t131
      t460 = t170*t145
      t463 = t373*t43*t100
      t472 = 1/t176/t42
      t474 = t180**2
      t479 = -t390+t392-0.1237301536356754D0*t395+0.2969523687256209D0
     #*t397
      t495 = t100*t192
      t504 = t187**2
      t508 = t191**2
      t540 = 0.161199195401647D1*(-0.1378556646443111D0*t463
     #+0.4135669939329333D0*t129*t177*t131*t180+0.4135669939329333D0
     #*t173*t332+0.12407009817988D1*t19*t472*t474-0.6203504908994D0
     #*t178*t479)*t149*t42+0.5373306513388232D0*t183*t407*t42*t131
     #+0.161199195401647D1*t184*t180+0.3119768427869032D0/t187/t47
     #*t373*t495+0.495123804261555D0*t188*t394*t495
     #-0.1188297130227732D1*t189*t332*t192-0.1582929339795102D2/t504
     #/t47*t373*t100/t508+0.4140337942820627D-3*(0.3446391616107778D-1
     #*t463+0.5250822119331622D0*t52*t177*t143*t180
     #-0.2187842549721509D0*t196*t395+0.5250822119331622D0*t196*t397
     #+2.D0*t53*t472*t474-1.D0*t199*t479)*t203*t42
     #+0.1087008902583527D-3*t202/t53/t52*t42*t142*t131
     #+0.4140337942820627D-3*t204*t180
      t566 = t373*t72*t100
      t575 = 1/t224/t71
      t577 = t228**2
      t582 = -t390+t392-0.7723543647452368D0*t395+0.1853650475388568D1
     #*t397
      t598 = t100*t240
      t607 = t235**2
      t611 = t239**2
      s1 = 0.2505897912236993D-1*(-0.1378556646443111D0*t566
     #+0.4135669939329333D0*t129*t225*t131*t228+0.4135669939329333D0
     #*t221*t332+0.12407009817988D1*t19*t575*t577-0.6203504908994D0
     #*t226*t582)*t149*t71+0.8352993040789975D-2*t231*t407*t71*t131
     #+0.2505897912236993D-1*t232*t228+0.3423410311260694D-1/t235/t77
     #*t373*t598+0.5433133824030049D-1*t236*t394*t598
     #-0.1303952117767212D0*t237*t332*t240-0.7662163788798043D0/t607
     #/t77*t373*t100/t611+0.2247867095542612D-2*(0.3446391616107778D-1
     #*t566+0.5250822119331622D0*t82*t225*t143*t228
     #-0.2187842549721509D0*t244*t395+0.5250822119331622D0*t244*t397
     #+2.D0*t83*t575*t577-1.D0*t247*t582)*t251*t71
     #+0.5901575133296437D-3*t250/t83/t82*t71*t142*t131
     #+0.2247867095542612D-2*t252*t228
      t653 = s1-0.5011795824473985D-1*t404-0.1670598608157995D-1*t410
     #-0.5011795824473985D-1*t412-0.3289159980064473D-1*t418
     #-0.5220071424553658D-1*t421+0.1252817141892878D0*t424
     #+0.1244848083156773D1*t433-0.9690227711544374D-3*t451
     #-0.2544083100456872D-3*t458-0.9690227711544374D-3*t460
      t662 = t207**2
      t679 = 0.5011795824473985D-1*t404+0.1670598608157995D-1*t410
     #+0.5011795824473985D-1*t412+0.3289159980064473D-1*t418
     #+0.5220071424553658D-1*t421-0.1252817141892878D0*t424
     #-0.1244848083156773D1*t433+0.9690227711544374D-3*t451
     #+0.2544083100456872D-3*t458+0.9690227711544374D-3*t460
     #-0.1899772193293833D-1*t540*t68*t102-0.3799544386587666D-1*t207
     #*t217*t102-0.3799544386587666D-1*t208*t273-0.1899772193293833D-1
     #*t57*(0.4444444444444444D0*t304*t95*t100+0.2666666666666667D1
     #*t211*t332+0.4444444444444444D0*t308*t95*t100
     #-0.2666666666666667D1*t214*t332)*t102-0.3799544386587666D-1*t218
     #*t273-0.1899772193293833D-1*t69*((-0.101257459063883D3*t653*t91
     #+0.2025149181277661D3*t258*t262*t207-0.2025149181277661D3*t90
     #/t261/t57*t662+0.101257459063883D3*t263*t540)*t96*t100-8.D0*t267
     #*t270+20.D0*t97/t99/t98)
      t680 = rho*t679
      v2rhoa2(i) = -0.4135669939329333D0*t294-0.2133333333333333D-1
     #*sigmaaa/t108/t7*t293+0.2666666666666667D-2*t110*t294+rho*(-t314
     #-0.1519817754635067D0*t315-t320)-0.3799544386587666D-1*t119
     #-0.1519817754635067D0*t124+t359+t365+t366+t367+t368-t369-t370
     #-t371+t680
      t681 = t11**2
      t682 = 1/t681
      t691 = t285*t123
      t699 = 0.1899772193293833D-1*t207*t284*t102
      t700 = 0.7599088773175333D-1*t328
      t704 = -0.1899772193293833D-1*t57*t342*t102
      t705 = 0.7599088773175333D-1*t346
      t707 = 0.1899772193293833D-1*t285*t273
      t712 = rho*(-t699+t700-t704+t705-t707+0.1899772193293833D-1*t69
     #*t355)
      t716 = rho*(-t699-t704-t707+t700+t705+0.7599088773175333D-1*t360
     #-0.3039635509270133D0*t362)
      v2rhob2(i) = -0.4135669939329333D0*t682-0.2133333333333333D-1
     #*sigmabb/t279/t14*t681+0.2666666666666667D-2*t281*t682+rho*(
     #-t314+0.1519817754635067D0*t691-t320)-0.3799544386587666D-1*t286
     #+0.1519817754635067D0*t124+t712+t716+t366+t367+t368-t369-t370
     #-t371+t680
      v2rhoab(i) = rho*(0.1899772193293833D-1*t57*t311*t102
     #+0.7599088773175333D-1*t315-0.7599088773175333D-1*t691
     #+0.22797266319526D0*t319)-t287+0.5D0*t712-t120+0.5D0*t365+t366
     #+t367+t368-t369-t370-t371+t680+0.5D0*t359+0.5D0*t716
      v2rhoasigmaaa(i) = 0.8D-2*t109*t4
      v2rhoasigmaab(i) = 0.D0
      v2rhoasigmabb(i) = 0.D0
      v2rhobsigmaaa(i) = 0.D0
      v2rhobsigmaab(i) = 0.D0
      v2rhobsigmabb(i) = 0.8D-2*t280*t11
      v2sigmaaa2(i) = 0.D0
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      v2sigmabb2(i) = 0.D0
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      v2rhob2(i) = 0.0d0
      v2rhoab(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2rhoasigmaab(i) = 0.0d0
      v2rhoasigmabb(i) = 0.0d0
      v2rhobsigmaaa(i) = 0.0d0
      v2rhobsigmaab(i) = 0.0d0
      v2rhobsigmabb(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      v2sigmaab2(i) = 0.0d0
      v2sigmabb2(i) = 0.0d0
      v2sigmaaaab(i) = 0.0d0
      v2sigmaaabb(i) = 0.0d0
      v2sigmaabbb(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end
      
      
      subroutine rks_xc_kt1
     & (ideriv,npt,rhoa1,sigmaaa1,
     &  zk,vrhoa,vsigmaaa,
     &  v2rhoa2,v2rhoasigmaaa,v2sigmaaa2)
c
c     T.W. Keal, and D.J. Tozer
c     The exchange-correlation potential in Kohn-Sham nuclear magnetic 
c     resonance shielding calculations
c     J. Chem. Phys. 119 (2003) 3015-3024
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt)
      REAL sigmaaa1(npt)
      REAL zk(npt),vrhoa(npt),vsigmaaa(npt)
      REAL v2rhoa2(npt),v2rhoasigmaaa(npt),v2sigmaaa2(npt)
      parameter(tol=1.0d-20)
      
      if(ideriv.eq.0) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t3 = t2*rho
      t10 = 1/rho
      t11 = t10**(1.D0/3.D0)
      t13 = t10**(1.D0/6.D0)
      t16 = 1/(0.6203504908994D0*t11+0.2935818660072219D1*t13
     #+0.129352D2)
      t19 = dlog(0.6203504908994D0*t11*t16)
      t25 = datan(0.615199081975908D1/(0.1575246635799487D1*t13
     #+0.372744D1))
      t29 = (0.7876233178997433D0*t13+0.10498D0)**2
      t31 = dlog(t29*t16)
      zk(i) = -0.7385587663820224D0*t3-0.3D-2*sigma/
     #(0.3968502629920499D0*t3+0.1D0)+rho*(0.310907D-1*t19
     #+0.3878329487811301D-1*t25+0.9690227711544374D-3*t31)
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t3 = t2*rho
      t6 = 0.3968502629920499D0*t3+0.1D0
      t7 = 1/t6
      t10 = 1/rho
      t11 = t10**(1.D0/3.D0)
      t13 = t10**(1.D0/6.D0)
      t15 = 0.6203504908994D0*t11+0.2935818660072219D1*t13+0.129352D2
      t16 = 1/t15
      t19 = dlog(0.6203504908994D0*t11*t16)
      t20 = 0.310907D-1*t19
      t22 = 0.1575246635799487D1*t13+0.372744D1
      t25 = datan(0.615199081975908D1/t22)
      t26 = 0.3878329487811301D-1*t25
      t28 = 0.7876233178997433D0*t13+0.10498D0
      t29 = t28**2
      t31 = dlog(t29*t16)
      t32 = 0.9690227711544374D-3*t31
      zk(i) = -0.7385587663820224D0*t3-0.3D-2*sigma*t7+rho*(t20+t26+t32)
      t36 = t6**2
      t41 = t11**2
      t42 = 1/t41
      t44 = rho**2
      t45 = 1/t44
      t48 = t15**2
      t49 = 1/t48
      t53 = t13**2
      t54 = t53**2
      t56 = 1/t54/t13
      t57 = t56*t45
      t59 = -0.2067834969664667D0*t42*t45-0.4893031100120365D0*t57
      t67 = t22**2
      t68 = 1/t67
      vrhoa(i) = -0.9847450218426965D0*t2+0.1587401051968199D-2*sigma
     #/t36*t2+t20+t26+t32+rho*(0.5011795824473985D-1*(
     #-0.2067834969664667D0*t42*t16*t45-0.6203504908994D0*t11*t49*t59)
     #/t11*t15+0.626408570946439D-1*t68*t56*t45/(1.D0+0.378469910464D2
     #*t68)+0.9690227711544374D-3*(-0.2625411059665811D0*t28*t16*t57
     #-1.D0*t29*t49*t59)/t29*t15)
      vsigmaaa(i) = -0.12D-1*t7
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t3 = t2*rho
      t6 = 0.3968502629920499D0*t3+0.1D0
      t7 = 1/t6
      t10 = 1/rho
      t11 = t10**(1.D0/3.D0)
      t13 = t10**(1.D0/6.D0)
      t15 = 0.6203504908994D0*t11+0.2935818660072219D1*t13+0.129352D2
      t16 = 1/t15
      t19 = dlog(0.6203504908994D0*t11*t16)
      t20 = 0.310907D-1*t19
      t22 = 0.1575246635799487D1*t13+0.372744D1
      t25 = datan(0.615199081975908D1/t22)
      t26 = 0.3878329487811301D-1*t25
      t28 = 0.7876233178997433D0*t13+0.10498D0
      t29 = t28**2
      t31 = dlog(t29*t16)
      t32 = 0.9690227711544374D-3*t31
      zk(i) = -0.7385587663820224D0*t3-0.3D-2*sigma*t7+rho*(t20+t26+t32)
      t36 = t6**2
      t37 = 1/t36
      t38 = sigma*t37
      t41 = t11**2
      t42 = 1/t41
      t43 = t42*t16
      t44 = rho**2
      t45 = 1/t44
      t48 = t15**2
      t49 = 1/t48
      t50 = t11*t49
      t53 = t13**2
      t54 = t53**2
      t55 = t54*t13
      t56 = 1/t55
      t57 = t56*t45
      t59 = -0.2067834969664667D0*t42*t45-0.4893031100120365D0*t57
      t62 = -0.2067834969664667D0*t43*t45-0.6203504908994D0*t50*t59
      t63 = 1/t11
      t64 = t62*t63
      t65 = t64*t15
      t67 = t22**2
      t68 = 1/t67
      t69 = t68*t56
      t71 = 1.D0+0.378469910464D2*t68
      t72 = 1/t71
      t74 = t69*t45*t72
      t76 = t28*t16
      t79 = t29*t49
      t82 = -0.2625411059665811D0*t76*t57-1.D0*t79*t59
      t83 = 1/t29
      t84 = t82*t83
      t85 = t84*t15
      vrhoa(i) = -0.9847450218426965D0*t2+0.1587401051968199D-2*t38*t2
     #+t20+t26+t32+rho*(0.5011795824473985D-1*t65+0.626408570946439D-1
     #*t74+0.9690227711544374D-3*t85)
      vsigmaaa(i) = -0.12D-1*t7
      t90 = t2**2
      t91 = 1/t90
      t104 = 1/t41/t10
      t106 = t44**2
      t107 = 1/t106
      t108 = t104*t16*t107
      t115 = 1/t44/rho
      t119 = 1/t48/t15
      t121 = t59**2
      t129 = 1/t55/t10
      t130 = t129*t107
      t132 = t56*t115
      t134 = -0.1378556646443111D0*t104*t107+0.4135669939329333D0*t42
     #*t115-0.4077525916766971D0*t130+0.978606220024073D0*t132
      t152 = t107*t72
      t161 = t67**2
      t165 = t71**2
      s1 = -0.6564966812284644D0*t91-0.3359789466386328D-2*sigma/t36
     #/t6*t90+0.10582673679788D-2*t38*t91
      s2 = s1+0.2004718329789594D0*t65
      s3 = s2+0.2505634283785756D0*t74
      v2rhoa2(i) = s3+0.387609108461775D-2*t85+2.D0*rho*
     #(0.5011795824473985D-1*(-0.1378556646443111D0*t108
     #+0.4135669939329333D0*t42*t49*t45*t59+0.4135669939329333D0*t43
     #*t115+0.12407009817988D1*t11*t119*t121-0.6203504908994D0*t50
     #*t134)*t63*t15+0.1670598608157995D-1*t62/t11/t10*t15*t45
     #+0.5011795824473985D-1*t64*t59+0.3289159980064473D-1/t67/t22
     #*t104*t152+0.5220071424553658D-1*t68*t129*t152
     #-0.1252817141892878D0*t69*t115*t72-0.1244848083156773D1/t161/t22
     #*t104*t107/t165+0.9690227711544374D-3*(0.3446391616107778D-1
     #*t108+0.5250822119331622D0*t28*t49*t57*t59-0.2187842549721509D0
     #*t76*t130+0.5250822119331622D0*t76*t132+2.D0*t29*t119*t121-1.D0
     #*t79*t134)*t83*t15+0.2544083100456872D-3*t82/t29/t28*t15*t56*t45
     #+0.9690227711544374D-3*t84*t59)
      v2rhoasigmaaa(i) = 0.6349604207872798D-2*t37*t2
      v2sigmaaa2(i) = 0.D0
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end

c:XC_KT1subrend
_ENDIF
_IF(ccpdft,all,xc_kt2)
c:XC_KT2subrstart

c    Generated: Tue May  4 10:45:43 GMT 2004

      subroutine uks_xc_kt2
     & (ideriv,npt,rhoa1,rhob1,sigmaaa1,sigmabb1,sigmaab1,
     &  zk,vrhoa,vrhob,vsigmaaa,vsigmabb,vsigmaab,
     &  v2rhoa2,v2rhob2,v2rhoab,
     &  v2rhoasigmaaa,v2rhoasigmaab,v2rhoasigmabb,
     &  v2rhobsigmabb,v2rhobsigmaab,v2rhobsigmaaa,
     &  v2sigmaaa2,v2sigmaaaab,v2sigmaaabb,
     &  v2sigmaab2,v2sigmaabbb,v2sigmabb2)
c
c     T.W. Keal, and D.J. Tozer
c     The exchange-correlation potential in Kohn-Sham nuclear magnetic
c     resonance shielding calculations
c     J. Chem. Phys. 119 (2003) 3015-3024
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt),rhob1(npt)
      REAL sigmaaa1(npt),sigmabb1(npt),sigmaab1(npt)
      REAL zk(npt),vrhoa(npt),vrhob(npt)
      REAL vsigmaaa(npt),vsigmabb(npt),vsigmaab(npt)
      REAL v2rhoa2(npt),v2rhob2(npt),v2rhoab(npt)
      REAL v2rhoasigmaaa(npt),v2rhoasigmaab(npt)
      REAL v2rhoasigmabb(npt),v2rhobsigmabb(npt)
      REAL v2rhobsigmaab(npt),v2rhobsigmaaa(npt)
      REAL v2sigmaaa2(npt),v2sigmaaaab(npt),v2sigmaaabb(npt)
      REAL v2sigmaab2(npt),v2sigmaabbb(npt),v2sigmabb2(npt)
      parameter(tol=1.0d-20)
      
      if (ideriv.eq.0) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t3 = t2*rhob
      t5 = 1/rhob
      t6 = t5**(1.D0/6.D0)
      t7 = 0.7876233178997433D0*t6
      t9 = (t7+0.10498D0)**2
      t10 = t5**(1.D0/3.D0)
      t11 = 0.6203504908994D0*t10
      t16 = dlog(t9/(t11+0.2935818660072219D1*t6+0.129352D2))
      t20 = 1/(t11+0.5560951426165705D1*t6+0.180578D2)
      t23 = dlog(0.6203504908994D0*t10*t20)
      t29 = datan(0.4730926909560113D1/(0.1575246635799487D1*t6
     #+0.706042D1))
      t32 = (t7+0.325D0)**2
      t34 = dlog(t32*t20)
      zk(i) = -0.997272347417421D0*t3+0.576727D0*rhob*(0.1D-23*t16
     #+0.1554535D-1*t23+0.5249139316978094D-1*t29
     #+0.2247867095542612D-2*t34)-0.6D-2*sigmabb/(t3+0.1D0)
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t3 = t2*rhoa
      t5 = 1/rhoa
      t6 = t5**(1.D0/6.D0)
      t7 = 0.7876233178997433D0*t6
      t9 = (t7+0.10498D0)**2
      t10 = t5**(1.D0/3.D0)
      t11 = 0.6203504908994D0*t10
      t16 = dlog(t9/(t11+0.2935818660072219D1*t6+0.129352D2))
      t20 = 1/(t11+0.5560951426165705D1*t6+0.180578D2)
      t23 = dlog(0.6203504908994D0*t10*t20)
      t29 = datan(0.4730926909560113D1/(0.1575246635799487D1*t6
     #+0.706042D1))
      t32 = (t7+0.325D0)**2
      t34 = dlog(t32*t20)
      zk(i) = -0.997272347417421D0*t3+0.576727D0*rhoa*(0.1D-23*t16
     #+0.1554535D-1*t23+0.5249139316978094D-1*t29
     #+0.2247867095542612D-2*t34)-0.6D-2*sigmaaa/(t3+0.1D0)
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t5 = t4*rhoa
      t11 = rhob**(1.D0/3.D0)
      t12 = t11*rhob
      t18 = 1/rho
      t19 = t18**(1.D0/3.D0)
      t20 = 0.6203504908994D0*t19
      t21 = t18**(1.D0/6.D0)
      t24 = 1/(t20+0.2935818660072219D1*t21+0.129352D2)
      t27 = dlog(0.6203504908994D0*t19*t24)
      t29 = 0.1575246635799487D1*t21
      t33 = datan(0.615199081975908D1/(t29+0.372744D1))
      t35 = 0.7876233178997433D0*t21
      t37 = (t35+0.10498D0)**2
      t39 = dlog(t37*t24)
      t43 = 1/(t20+0.8908571061768626D0*t21+0.130045D2)
      t46 = dlog(0.6203504908994D0*t19*t43)
      t50 = datan(0.7123108917818118D1/(t29+0.113107D1))
      t53 = (t35+0.47584D-2)**2
      t55 = dlog(t53*t43)
      t57 = t46+0.3177080047439415D0*t50+0.4140337942820627D-3*t55
      t59 = rhoa-1.D0*rhob
      t60 = t59*t18
      t61 = 1.D0+t60
      t62 = t61**(1.D0/3.D0)
      t65 = 1.D0-1.D0*t60
      t66 = t65**(1.D0/3.D0)
      t72 = 1/(t20+0.5560951426165705D1*t21+0.180578D2)
      t75 = dlog(0.6203504908994D0*t19*t72)
      t80 = datan(0.4730926909560113D1/(t29+0.706042D1))
      t83 = (t35+0.325D0)**2
      t85 = dlog(t83*t72)
      t95 = t59**2
      t96 = t95**2
      t98 = rho**2
      t99 = t98**2
      zk(i) = -0.997272347417421D0*t5-0.6D-2*sigmaaa/(t5+0.1D0)
     #-0.997272347417421D0*t12-0.6D-2*sigmabb/(t12+0.1D0)+0.576727D0
     #*rho*(0.310907D-1*t27+0.3878329487811301D-1*t33
     #+0.9690227711544374D-3*t39-0.1899772193293833D-1*t57*(t62*t61
     #+t66*t65-2.D0)*(1.D0+(-0.101257459063883D3*(0.1554535D-1*t75
     #+0.5249139316978094D-1*t80+0.2247867095542612D-2*t85-0.310907D-1
     #*t27-0.3878329487811301D-1*t33-0.9690227711544374D-3*t39)/t57
     #-1.D0)*t96/t99))
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t3 = t2*rhob
      t5 = 1/rhob
      t6 = t5**(1.D0/6.D0)
      t7 = 0.7876233178997433D0*t6
      t8 = t7+0.10498D0
      t9 = t8**2
      t10 = t5**(1.D0/3.D0)
      t11 = 0.6203504908994D0*t10
      t13 = t11+0.2935818660072219D1*t6+0.129352D2
      t14 = 1/t13
      t16 = dlog(t9*t14)
      t17 = 0.1D-23*t16
      t19 = t11+0.5560951426165705D1*t6+0.180578D2
      t20 = 1/t19
      t23 = dlog(0.6203504908994D0*t10*t20)
      t25 = 0.1575246635799487D1*t6
      t26 = t25+0.706042D1
      t29 = datan(0.4730926909560113D1/t26)
      t31 = t7+0.325D0
      t32 = t31**2
      t34 = dlog(t32*t20)
      t39 = t3+0.1D0
      t40 = 1/t39
      zk(i) = -0.997272347417421D0*t3+0.576727D0*rhob*(t17
     #+0.1554535D-1*t23+0.5249139316978094D-1*t29
     #+0.2247867095542612D-2*t34)-0.6D-2*sigmabb*t40
      vrhoa(i) = 0.D0
      t44 = t39**2
      t52 = t10**2
      t53 = 1/t52
      t55 = rhob**2
      t56 = 1/t55
      t59 = t13**2
      t60 = 1/t59
      t63 = 0.2067834969664667D0*t53*t56
      t64 = t6**2
      t65 = t64**2
      t67 = 1/t65/t6
      t68 = t67*t56
      t70 = -t63-0.4893031100120365D0*t68
      t74 = 1/t10
      t79 = (t25+0.372744D1)**2
      t80 = 1/t79
      t102 = t19**2
      t103 = 1/t102
      t106 = -t63-0.9268252376942842D0*t68
      t113 = t26**2
      t114 = 1/t113
      vrhob(i) = -0.1329696463223228D1*t2+0.8D-2*sigmabb/t44*t2+t17
     #+0.896542306945D-2*t23+0.3027320370862825D-1*t29
     #+0.1296405646411004D-2*t34+0.576727D0*rhob*(0.2D-21*(
     #-0.2067834969664667D0*t53*t14*t56-0.6203504908994D0*t10*t60*t70)
     #*t74*t13-0.1D-21*t80*t67*t56/(1.D0+0.378469910464D2*t80)+0.1D-23
     #*(-0.2625411059665811D0*t8*t14*t68-1.D0*t9*t60*t70)/t9*t13
     #+0.2505897912236993D-1*(-0.2067834969664667D0*t53*t20*t56
     #-0.6203504908994D0*t10*t103*t106)*t74*t19+0.6519760588836059D-1
     #*t114*t67*t56/(1.D0+0.223816694236D2*t114)+0.2247867095542612D-2
     #*(-0.2625411059665811D0*t31*t20*t68-1.D0*t32*t103*t106)/t32*t19)
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      vsigmabb(i) = -0.6D-2*t40
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t3 = t2*rhoa
      t5 = 1/rhoa
      t6 = t5**(1.D0/6.D0)
      t7 = 0.7876233178997433D0*t6
      t8 = t7+0.10498D0
      t9 = t8**2
      t10 = t5**(1.D0/3.D0)
      t11 = 0.6203504908994D0*t10
      t13 = t11+0.2935818660072219D1*t6+0.129352D2
      t14 = 1/t13
      t16 = dlog(t9*t14)
      t17 = 0.1D-23*t16
      t19 = t11+0.5560951426165705D1*t6+0.180578D2
      t20 = 1/t19
      t23 = dlog(0.6203504908994D0*t10*t20)
      t25 = 0.1575246635799487D1*t6
      t26 = t25+0.706042D1
      t29 = datan(0.4730926909560113D1/t26)
      t31 = t7+0.325D0
      t32 = t31**2
      t34 = dlog(t32*t20)
      t39 = t3+0.1D0
      t40 = 1/t39
      zk(i) = -0.997272347417421D0*t3+0.576727D0*rhoa*(t17
     #+0.1554535D-1*t23+0.5249139316978094D-1*t29
     #+0.2247867095542612D-2*t34)-0.6D-2*sigmaaa*t40
      t44 = t39**2
      t52 = t10**2
      t53 = 1/t52
      t55 = rhoa**2
      t56 = 1/t55
      t59 = t13**2
      t60 = 1/t59
      t63 = 0.2067834969664667D0*t53*t56
      t64 = t6**2
      t65 = t64**2
      t67 = 1/t65/t6
      t68 = t67*t56
      t70 = -t63-0.4893031100120365D0*t68
      t74 = 1/t10
      t79 = (t25+0.372744D1)**2
      t80 = 1/t79
      t102 = t19**2
      t103 = 1/t102
      t106 = -t63-0.9268252376942842D0*t68
      t113 = t26**2
      t114 = 1/t113
      vrhoa(i) = -0.1329696463223228D1*t2+0.8D-2*sigmaaa/t44*t2+t17
     #+0.896542306945D-2*t23+0.3027320370862825D-1*t29
     #+0.1296405646411004D-2*t34+0.576727D0*rhoa*(0.2D-21*(
     #-0.2067834969664667D0*t53*t14*t56-0.6203504908994D0*t10*t60*t70)
     #*t74*t13-0.1D-21*t80*t67*t56/(1.D0+0.378469910464D2*t80)+0.1D-23
     #*(-0.2625411059665811D0*t8*t14*t68-1.D0*t9*t60*t70)/t9*t13
     #+0.2505897912236993D-1*(-0.2067834969664667D0*t53*t20*t56
     #-0.6203504908994D0*t10*t103*t106)*t74*t19+0.6519760588836059D-1
     #*t114*t67*t56/(1.D0+0.223816694236D2*t114)+0.2247867095542612D-2
     #*(-0.2625411059665811D0*t31*t20*t68-1.D0*t32*t103*t106)/t32*t19)
      vrhob(i) = 0.D0
      vsigmaaa(i) = -0.6D-2*t40
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t5 = t4*rhoa
      t7 = t5+0.1D0
      t8 = 1/t7
      t11 = rhob**(1.D0/3.D0)
      t12 = t11*rhob
      t14 = t12+0.1D0
      t15 = 1/t14
      t18 = 1/rho
      t19 = t18**(1.D0/3.D0)
      t20 = 0.6203504908994D0*t19
      t21 = t18**(1.D0/6.D0)
      t23 = t20+0.2935818660072219D1*t21+0.129352D2
      t24 = 1/t23
      t27 = dlog(0.6203504908994D0*t19*t24)
      t29 = 0.1575246635799487D1*t21
      t30 = t29+0.372744D1
      t33 = datan(0.615199081975908D1/t30)
      t35 = 0.7876233178997433D0*t21
      t36 = t35+0.10498D0
      t37 = t36**2
      t39 = dlog(t37*t24)
      t42 = t20+0.8908571061768626D0*t21+0.130045D2
      t43 = 1/t42
      t46 = dlog(0.6203504908994D0*t19*t43)
      t47 = t29+0.113107D1
      t50 = datan(0.7123108917818118D1/t47)
      t52 = t35+0.47584D-2
      t53 = t52**2
      t55 = dlog(t53*t43)
      t57 = t46+0.3177080047439415D0*t50+0.4140337942820627D-3*t55
      t59 = rhoa-1.D0*rhob
      t60 = t59*t18
      t61 = 1.D0+t60
      t62 = t61**(1.D0/3.D0)
      t65 = 1.D0-1.D0*t60
      t66 = t65**(1.D0/3.D0)
      t68 = t62*t61+t66*t65-2.D0
      t69 = t57*t68
      t71 = t20+0.5560951426165705D1*t21+0.180578D2
      t72 = 1/t71
      t75 = dlog(0.6203504908994D0*t19*t72)
      t77 = t29+0.706042D1
      t80 = datan(0.4730926909560113D1/t77)
      t82 = t35+0.325D0
      t83 = t82**2
      t85 = dlog(t83*t72)
      t90 = 0.1554535D-1*t75+0.5249139316978094D-1*t80
     #+0.2247867095542612D-2*t85-0.310907D-1*t27-0.3878329487811301D-1
     #*t33-0.9690227711544374D-3*t39
      t91 = 1/t57
      t94 = -0.101257459063883D3*t90*t91-1.D0
      t95 = t59**2
      t96 = t95**2
      t97 = t94*t96
      t98 = rho**2
      t99 = t98**2
      t100 = 1/t99
      t102 = 1.D0+t97*t100
      t103 = t69*t102
      zk(i) = -0.997272347417421D0*t5-0.6D-2*sigmaaa*t8
     #-0.997272347417421D0*t12-0.6D-2*sigmabb*t15+0.576727D0*rho*
     #(0.310907D-1*t27+0.3878329487811301D-1*t33+0.9690227711544374D-3
     #*t39-0.1899772193293833D-1*t103)
      t109 = t7**2
      t118 = 0.1333333333333333D1*t62*t18-0.1333333333333333D1*t66*t18
      t125 = t69*t94*t95*t59*t100
      t130 = 0.179308461389D-1*t27
      t131 = 0.2236737330516948D-1*t33
      t132 = 0.5588615957395852D-3*t39
      t133 = 0.1095649917721773D-1*t103
      t134 = t19**2
      t135 = 1/t134
      t137 = 1/t98
      t140 = t23**2
      t141 = 1/t140
      t144 = 0.2067834969664667D0*t135*t137
      t145 = t21**2
      t146 = t145**2
      t148 = 1/t146/t21
      t149 = t148*t137
      t151 = -t144-0.4893031100120365D0*t149
      t155 = 1/t19
      t157 = (-0.2067834969664667D0*t135*t24*t137-0.6203504908994D0
     #*t19*t141*t151)*t155*t23
      t159 = t30**2
      t160 = 1/t159
      t166 = t160*t148*t137/(1.D0+0.378469910464D2*t160)
      t177 = (-0.2625411059665811D0*t36*t24*t149-1.D0*t37*t141*t151)
     #/t37*t23
      t182 = t42**2
      t183 = 1/t182
      t186 = -t144-0.1484761843628104D0*t149
      t193 = t47**2
      t194 = 1/t193
      t213 = 0.161199195401647D1*(-0.2067834969664667D0*t135*t43*t137
     #-0.6203504908994D0*t19*t183*t186)*t155*t42+0.5941485651138659D0
     #*t194*t148*t137/(1.D0+0.507386806551D2*t194)
     #+0.4140337942820627D-3*(-0.2625411059665811D0*t52*t43*t149-1.D0
     #*t53*t183*t186)/t53*t42
      t230 = t71**2
      t231 = 1/t230
      t234 = -t144-0.9268252376942842D0*t149
      t241 = t77**2
      t242 = 1/t241
      t267 = t57**2
      t284 = 0.576727D0*rho*(0.5011795824473985D-1*t157
     #+0.626408570946439D-1*t166+0.9690227711544374D-3*t177
     #-0.1899772193293833D-1*t213*t68*t102-0.1899772193293833D-1*t57*(
     #-0.1333333333333333D1*t62*t59*t137+0.1333333333333333D1*t66*t59
     #*t137)*t102-0.1899772193293833D-1*t69*((-0.101257459063883D3*
     #(0.2505897912236993D-1*(-0.2067834969664667D0*t135*t72*t137
     #-0.6203504908994D0*t19*t231*t234)*t155*t71+0.6519760588836059D-1
     #*t242*t148*t137/(1.D0+0.223816694236D2*t242)
     #+0.2247867095542612D-2*(-0.2625411059665811D0*t82*t72*t149-1.D0
     #*t83*t231*t234)/t83*t71-0.5011795824473985D-1*t157
     #-0.626408570946439D-1*t166-0.9690227711544374D-3*t177)*t91
     #+0.101257459063883D3*t90/t267*t213)*t96*t100-4.D0*t97/t99/rho))
      vrhoa(i) = -0.1329696463223228D1*t4+0.8D-2*sigmaaa/t109*t4
     #+0.576727D0*rho*(-0.1899772193293833D-1*t57*t118*t102
     #-0.7599088773175333D-1*t125)+t130+t131+t132-t133+t284
      t286 = t14**2
      vrhob(i) = -0.1329696463223228D1*t11+0.8D-2*sigmabb/t286*t11
     #+0.576727D0*rho*(0.1899772193293833D-1*t57*t118*t102
     #+0.7599088773175333D-1*t125)+t130+t131+t132-t133+t284
      vsigmaaa(i) = -0.6D-2*t8
      vsigmaab(i) = 0.D0
      vsigmabb(i) = -0.6D-2*t15
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t3 = t2*rhob
      t5 = 1/rhob
      t6 = t5**(1.D0/6.D0)
      t7 = 0.7876233178997433D0*t6
      t8 = t7+0.10498D0
      t9 = t8**2
      t10 = t5**(1.D0/3.D0)
      t11 = 0.6203504908994D0*t10
      t13 = t11+0.2935818660072219D1*t6+0.129352D2
      t14 = 1/t13
      t16 = dlog(t9*t14)
      t17 = 0.1D-23*t16
      t19 = t11+0.5560951426165705D1*t6+0.180578D2
      t20 = 1/t19
      t23 = dlog(0.6203504908994D0*t10*t20)
      t25 = 0.1575246635799487D1*t6
      t26 = t25+0.706042D1
      t29 = datan(0.4730926909560113D1/t26)
      t31 = t7+0.325D0
      t32 = t31**2
      t34 = dlog(t32*t20)
      t39 = t3+0.1D0
      t40 = 1/t39
      zk(i) = -0.997272347417421D0*t3+0.576727D0*rhob*(t17
     #+0.1554535D-1*t23+0.5249139316978094D-1*t29
     #+0.2247867095542612D-2*t34)-0.6D-2*sigmabb*t40
      vrhoa(i) = 0.D0
      t44 = t39**2
      t46 = sigmabb/t44
      t52 = t10**2
      t53 = 1/t52
      t54 = t53*t14
      t55 = rhob**2
      t56 = 1/t55
      t59 = t13**2
      t60 = 1/t59
      t61 = t10*t60
      t63 = 0.2067834969664667D0*t53*t56
      t64 = t6**2
      t65 = t64**2
      t66 = t65*t6
      t67 = 1/t66
      t68 = t67*t56
      t70 = -t63-0.4893031100120365D0*t68
      t74 = 1/t10
      t75 = (-0.2067834969664667D0*t54*t56-0.6203504908994D0*t61*t70)
     #*t74
      t76 = t75*t13
      t79 = (t25+0.372744D1)**2
      t80 = 1/t79
      t84 = 1/(1.D0+0.378469910464D2*t80)
      t86 = t80*t67*t56*t84
      t88 = t8*t14
      t91 = t9*t60
      t95 = 1/t9
      t96 = (-0.2625411059665811D0*t88*t68-1.D0*t91*t70)*t95
      t97 = t96*t13
      t99 = t53*t20
      t102 = t19**2
      t103 = 1/t102
      t104 = t10*t103
      t106 = -t63-0.9268252376942842D0*t68
      t109 = -0.2067834969664667D0*t99*t56-0.6203504908994D0*t104*t106
      t110 = t109*t74
      t111 = t110*t19
      t113 = t26**2
      t114 = 1/t113
      t115 = t114*t67
      t117 = 1.D0+0.223816694236D2*t114
      t118 = 1/t117
      t120 = t115*t56*t118
      t122 = t31*t20
      t125 = t32*t103
      t128 = -0.2625411059665811D0*t122*t68-1.D0*t125*t106
      t129 = 1/t32
      t130 = t128*t129
      t131 = t130*t19
      vrhob(i) = -0.1329696463223228D1*t2+0.8D-2*t46*t2+t17
     #+0.896542306945D-2*t23+0.3027320370862825D-1*t29
     #+0.1296405646411004D-2*t34+0.576727D0*rhob*(0.2D-21*t76-0.1D-21
     #*t86+0.1D-23*t97+0.2505897912236993D-1*t111
     #+0.6519760588836059D-1*t120+0.2247867095542612D-2*t131)
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      vsigmabb(i) = -0.6D-2*t40
      v2rhoa2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t137 = t2**2
      t138 = 1/t137
      t154 = 1/t52/t5
      t156 = t55**2
      t157 = 1/t156
      t158 = t154*t14*t157
      t165 = 1/t55/rhob
      t169 = 1/t59/t13
      t171 = t70**2
      t175 = 0.1378556646443111D0*t154*t157
      t177 = 0.4135669939329333D0*t53*t165
      t179 = 1/t66/t5
      t180 = t179*t157
      t182 = t67*t165
      t184 = -t175+t177-0.4077525916766971D0*t180+0.978606220024073D0
     #*t182
      t226 = t157*t118
      t230 = t154*t20*t157
      t239 = 1/t102/t19
      t241 = t106**2
      t246 = -t175+t177-0.7723543647452368D0*t180+0.1853650475388568D1
     #*t182
      t261 = t113**2
      t265 = t117**2
      s1 = 0.2D-21*(-0.1378556646443111D0*t158+0.4135669939329333D0
     #*t53*t60*t56*t70+0.4135669939329333D0*t54*t165
     #+0.12407009817988D1*t10*t169*t171-0.6203504908994D0*t61*t184)
     #*t74*t13+0.2D-21*t75*t70+0.1D-21*t80*t179*t157*t84+0.1D-23*
     #(0.3446391616107778D-1*t158+0.5250822119331622D0*t8*t60*t68*t70
     #-0.2187842549721509D0*t88*t180+0.5250822119331622D0*t88*t182
     #+2.D0*t9*t169*t171-1.D0*t91*t184)*t95*t13+0.1D-23*t96*t70
     #+0.8352993040789975D-2*t109/t10/t5*t19*t56+0.3423410311260694D-1
     #/t113/t26*t154*t226
      t297 = s1+0.2505897912236993D-1*(-0.1378556646443111D0*t230
     #+0.4135669939329333D0*t53*t103*t56*t106+0.4135669939329333D0*t99
     #*t165+0.12407009817988D1*t10*t239*t241-0.6203504908994D0*t104
     #*t246)*t74*t19+0.2505897912236993D-1*t110*t106
     #+0.5433133824030049D-1*t114*t179*t226-0.1303952117767212D0*t115
     #*t165*t118-0.7662163788798043D0/t261/t26*t154*t157/t265
     #+0.2247867095542612D-2*(0.3446391616107778D-1*t230
     #+0.5250822119331622D0*t31*t103*t68*t106-0.2187842549721509D0
     #*t122*t180+0.5250822119331622D0*t122*t182+2.D0*t32*t239*t241
     #-1.D0*t125*t246)*t129*t19+0.5901575133296437D-3*t128/t32/t31*t19
     #*t67*t56+0.2247867095542612D-2*t130*t106
      v2rhob2(i) = -0.4432321544077427D0*t138-0.2133333333333333D-1
     #*sigmabb/t44/t39*t137+0.2666666666666667D-2*t46*t138+0.3D-21*t76
     #-0.3D-21*t86+0.1D-22*t97+0.2890437970461408D-1*t111
     #+0.7520243930235308D-1*t120+0.2592811292822008D-2*t131
     #+0.576727D0*rhob*t297
      v2sigmaaa2(i) = 0.D0
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      v2sigmabb2(i) = 0.D0
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t3 = t2*rhoa
      t5 = 1/rhoa
      t6 = t5**(1.D0/6.D0)
      t7 = 0.7876233178997433D0*t6
      t8 = t7+0.10498D0
      t9 = t8**2
      t10 = t5**(1.D0/3.D0)
      t11 = 0.6203504908994D0*t10
      t13 = t11+0.2935818660072219D1*t6+0.129352D2
      t14 = 1/t13
      t16 = dlog(t9*t14)
      t17 = 0.1D-23*t16
      t19 = t11+0.5560951426165705D1*t6+0.180578D2
      t20 = 1/t19
      t23 = dlog(0.6203504908994D0*t10*t20)
      t25 = 0.1575246635799487D1*t6
      t26 = t25+0.706042D1
      t29 = datan(0.4730926909560113D1/t26)
      t31 = t7+0.325D0
      t32 = t31**2
      t34 = dlog(t32*t20)
      t39 = t3+0.1D0
      t40 = 1/t39
      zk(i) = -0.997272347417421D0*t3+0.576727D0*rhoa*(t17
     #+0.1554535D-1*t23+0.5249139316978094D-1*t29
     #+0.2247867095542612D-2*t34)-0.6D-2*sigmaaa*t40
      t44 = t39**2
      t46 = sigmaaa/t44
      t52 = t10**2
      t53 = 1/t52
      t54 = t53*t14
      t55 = rhoa**2
      t56 = 1/t55
      t59 = t13**2
      t60 = 1/t59
      t61 = t10*t60
      t63 = 0.2067834969664667D0*t53*t56
      t64 = t6**2
      t65 = t64**2
      t66 = t65*t6
      t67 = 1/t66
      t68 = t67*t56
      t70 = -t63-0.4893031100120365D0*t68
      t74 = 1/t10
      t75 = (-0.2067834969664667D0*t54*t56-0.6203504908994D0*t61*t70)
     #*t74
      t76 = t75*t13
      t79 = (t25+0.372744D1)**2
      t80 = 1/t79
      t84 = 1/(1.D0+0.378469910464D2*t80)
      t86 = t80*t67*t56*t84
      t88 = t8*t14
      t91 = t9*t60
      t95 = 1/t9
      t96 = (-0.2625411059665811D0*t88*t68-1.D0*t91*t70)*t95
      t97 = t96*t13
      t99 = t53*t20
      t102 = t19**2
      t103 = 1/t102
      t104 = t10*t103
      t106 = -t63-0.9268252376942842D0*t68
      t109 = -0.2067834969664667D0*t99*t56-0.6203504908994D0*t104*t106
      t110 = t109*t74
      t111 = t110*t19
      t113 = t26**2
      t114 = 1/t113
      t115 = t114*t67
      t117 = 1.D0+0.223816694236D2*t114
      t118 = 1/t117
      t120 = t115*t56*t118
      t122 = t31*t20
      t125 = t32*t103
      t128 = -0.2625411059665811D0*t122*t68-1.D0*t125*t106
      t129 = 1/t32
      t130 = t128*t129
      t131 = t130*t19
      vrhoa(i) = -0.1329696463223228D1*t2+0.8D-2*t46*t2+t17
     #+0.896542306945D-2*t23+0.3027320370862825D-1*t29
     #+0.1296405646411004D-2*t34+0.576727D0*rhoa*(0.2D-21*t76-0.1D-21
     #*t86+0.1D-23*t97+0.2505897912236993D-1*t111
     #+0.6519760588836059D-1*t120+0.2247867095542612D-2*t131)
      vrhob(i) = 0.D0
      vsigmaaa(i) = -0.6D-2*t40
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      t137 = t2**2
      t138 = 1/t137
      t154 = 1/t52/t5
      t156 = t55**2
      t157 = 1/t156
      t158 = t154*t14*t157
      t165 = 1/t55/rhoa
      t169 = 1/t59/t13
      t171 = t70**2
      t175 = 0.1378556646443111D0*t154*t157
      t177 = 0.4135669939329333D0*t53*t165
      t179 = 1/t66/t5
      t180 = t179*t157
      t182 = t67*t165
      t184 = -t175+t177-0.4077525916766971D0*t180+0.978606220024073D0
     #*t182
      t226 = t157*t118
      t230 = t154*t20*t157
      t239 = 1/t102/t19
      t241 = t106**2
      t246 = -t175+t177-0.7723543647452368D0*t180+0.1853650475388568D1
     #*t182
      t261 = t113**2
      t265 = t117**2
      s1 = 0.2D-21*(-0.1378556646443111D0*t158+0.4135669939329333D0
     #*t53*t60*t56*t70+0.4135669939329333D0*t54*t165
     #+0.12407009817988D1*t10*t169*t171-0.6203504908994D0*t61*t184)
     #*t74*t13+0.2D-21*t75*t70+0.1D-21*t80*t179*t157*t84+0.1D-23*
     #(0.3446391616107778D-1*t158+0.5250822119331622D0*t8*t60*t68*t70
     #-0.2187842549721509D0*t88*t180+0.5250822119331622D0*t88*t182
     #+2.D0*t9*t169*t171-1.D0*t91*t184)*t95*t13+0.1D-23*t96*t70
     #+0.8352993040789975D-2*t109/t10/t5*t19*t56+0.3423410311260694D-1
     #/t113/t26*t154*t226
      t297 = s1+0.2505897912236993D-1*(-0.1378556646443111D0*t230
     #+0.4135669939329333D0*t53*t103*t56*t106+0.4135669939329333D0*t99
     #*t165+0.12407009817988D1*t10*t239*t241-0.6203504908994D0*t104
     #*t246)*t74*t19+0.2505897912236993D-1*t110*t106
     #+0.5433133824030049D-1*t114*t179*t226-0.1303952117767212D0*t115
     #*t165*t118-0.7662163788798043D0/t261/t26*t154*t157/t265
     #+0.2247867095542612D-2*(0.3446391616107778D-1*t230
     #+0.5250822119331622D0*t31*t103*t68*t106-0.2187842549721509D0
     #*t122*t180+0.5250822119331622D0*t122*t182+2.D0*t32*t239*t241
     #-1.D0*t125*t246)*t129*t19+0.5901575133296437D-3*t128/t32/t31*t19
     #*t67*t56+0.2247867095542612D-2*t130*t106
      v2rhoa2(i) = -0.4432321544077427D0*t138-0.2133333333333333D-1
     #*sigmaaa/t44/t39*t137+0.2666666666666667D-2*t46*t138+0.3D-21*t76
     #-0.3D-21*t86+0.1D-22*t97+0.2890437970461408D-1*t111
     #+0.7520243930235308D-1*t120+0.2592811292822008D-2*t131
     #+0.576727D0*rhoa*t297
      v2rhob2(i) = 0.D0
      v2rhoab(i) = 0.D0
      v2sigmaaa2(i) = 0.D0
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      v2sigmabb2(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t5 = t4*rhoa
      t7 = t5+0.1D0
      t8 = 1/t7
      t11 = rhob**(1.D0/3.D0)
      t12 = t11*rhob
      t14 = t12+0.1D0
      t15 = 1/t14
      t18 = 1/rho
      t19 = t18**(1.D0/3.D0)
      t20 = 0.6203504908994D0*t19
      t21 = t18**(1.D0/6.D0)
      t23 = t20+0.2935818660072219D1*t21+0.129352D2
      t24 = 1/t23
      t27 = dlog(0.6203504908994D0*t19*t24)
      t29 = 0.1575246635799487D1*t21
      t30 = t29+0.372744D1
      t33 = datan(0.615199081975908D1/t30)
      t35 = 0.7876233178997433D0*t21
      t36 = t35+0.10498D0
      t37 = t36**2
      t39 = dlog(t37*t24)
      t42 = t20+0.8908571061768626D0*t21+0.130045D2
      t43 = 1/t42
      t46 = dlog(0.6203504908994D0*t19*t43)
      t47 = t29+0.113107D1
      t50 = datan(0.7123108917818118D1/t47)
      t52 = t35+0.47584D-2
      t53 = t52**2
      t55 = dlog(t53*t43)
      t57 = t46+0.3177080047439415D0*t50+0.4140337942820627D-3*t55
      t59 = rhoa-1.D0*rhob
      t60 = t59*t18
      t61 = 1.D0+t60
      t62 = t61**(1.D0/3.D0)
      t65 = 1.D0-1.D0*t60
      t66 = t65**(1.D0/3.D0)
      t68 = t62*t61+t66*t65-2.D0
      t69 = t57*t68
      t71 = t20+0.5560951426165705D1*t21+0.180578D2
      t72 = 1/t71
      t75 = dlog(0.6203504908994D0*t19*t72)
      t77 = t29+0.706042D1
      t80 = datan(0.4730926909560113D1/t77)
      t82 = t35+0.325D0
      t83 = t82**2
      t85 = dlog(t83*t72)
      t90 = 0.1554535D-1*t75+0.5249139316978094D-1*t80
     #+0.2247867095542612D-2*t85-0.310907D-1*t27-0.3878329487811301D-1
     #*t33-0.9690227711544374D-3*t39
      t91 = 1/t57
      t94 = -0.101257459063883D3*t90*t91-1.D0
      t95 = t59**2
      t96 = t95**2
      t97 = t94*t96
      t98 = rho**2
      t99 = t98**2
      t100 = 1/t99
      t102 = 1.D0+t97*t100
      t103 = t69*t102
      zk(i) = -0.997272347417421D0*t5-0.6D-2*sigmaaa*t8
     #-0.997272347417421D0*t12-0.6D-2*sigmabb*t15+0.576727D0*rho*
     #(0.310907D-1*t27+0.3878329487811301D-1*t33+0.9690227711544374D-3
     #*t39-0.1899772193293833D-1*t103)
      t109 = t7**2
      t110 = 1/t109
      t111 = sigmaaa*t110
      t118 = 0.1333333333333333D1*t62*t18-0.1333333333333333D1*t66*t18
      t119 = t57*t118
      t120 = t119*t102
      t122 = t95*t59
      t123 = t94*t122
      t124 = t123*t100
      t125 = t69*t124
      t130 = 0.179308461389D-1*t27
      t131 = 0.2236737330516948D-1*t33
      t132 = 0.5588615957395852D-3*t39
      t133 = 0.1095649917721773D-1*t103
      t134 = t19**2
      t135 = 1/t134
      t136 = t135*t24
      t137 = 1/t98
      t140 = t23**2
      t141 = 1/t140
      t142 = t19*t141
      t144 = 0.2067834969664667D0*t135*t137
      t145 = t21**2
      t146 = t145**2
      t147 = t146*t21
      t148 = 1/t147
      t149 = t148*t137
      t151 = -t144-0.4893031100120365D0*t149
      t154 = -0.2067834969664667D0*t136*t137-0.6203504908994D0*t142*t151
      t155 = 1/t19
      t156 = t154*t155
      t157 = t156*t23
      t159 = t30**2
      t160 = 1/t159
      t161 = t160*t148
      t163 = 1.D0+0.378469910464D2*t160
      t164 = 1/t163
      t166 = t161*t137*t164
      t168 = t36*t24
      t171 = t37*t141
      t174 = -0.2625411059665811D0*t168*t149-1.D0*t171*t151
      t175 = 1/t37
      t176 = t174*t175
      t177 = t176*t23
      t179 = t135*t43
      t182 = t42**2
      t183 = 1/t182
      t184 = t19*t183
      t186 = -t144-0.1484761843628104D0*t149
      t189 = -0.2067834969664667D0*t179*t137-0.6203504908994D0*t184*t186
      t190 = t189*t155
      t193 = t47**2
      t194 = 1/t193
      t195 = t194*t148
      t197 = 1.D0+0.507386806551D2*t194
      t198 = 1/t197
      t202 = t52*t43
      t205 = t53*t183
      t208 = -0.2625411059665811D0*t202*t149-1.D0*t205*t186
      t209 = 1/t53
      t210 = t208*t209
      t213 = 0.161199195401647D1*t190*t42+0.5941485651138659D0*t195
     #*t137*t198+0.4140337942820627D-3*t210*t42
      t214 = t213*t68
      t215 = t214*t102
      t217 = t62*t59
      t220 = t66*t59
      t223 = -0.1333333333333333D1*t217*t137+0.1333333333333333D1*t220
     #*t137
      t224 = t57*t223
      t225 = t224*t102
      t227 = t135*t72
      t230 = t71**2
      t231 = 1/t230
      t232 = t19*t231
      t234 = -t144-0.9268252376942842D0*t149
      t237 = -0.2067834969664667D0*t227*t137-0.6203504908994D0*t232*t234
      t238 = t237*t155
      t241 = t77**2
      t242 = 1/t241
      t243 = t242*t148
      t245 = 1.D0+0.223816694236D2*t242
      t246 = 1/t245
      t250 = t82*t72
      t253 = t83*t231
      t256 = -0.2625411059665811D0*t250*t149-1.D0*t253*t234
      t257 = 1/t83
      t258 = t256*t257
      t264 = 0.2505897912236993D-1*t238*t71+0.6519760588836059D-1*t243
     #*t137*t246+0.2247867095542612D-2*t258*t71-0.5011795824473985D-1
     #*t157-0.626408570946439D-1*t166-0.9690227711544374D-3*t177
      t267 = t57**2
      t268 = 1/t267
      t269 = t90*t268
      t272 = -0.101257459063883D3*t264*t91+0.101257459063883D3*t269*t213
      t273 = t272*t96
      t276 = 1/t99/rho
      t279 = t273*t100-4.D0*t97*t276
      t280 = t69*t279
      t284 = 0.576727D0*rho*(0.5011795824473985D-1*t157
     #+0.626408570946439D-1*t166+0.9690227711544374D-3*t177
     #-0.1899772193293833D-1*t215-0.1899772193293833D-1*t225
     #-0.1899772193293833D-1*t280)
      vrhoa(i) = -0.1329696463223228D1*t4+0.8D-2*t111*t4+0.576727D0
     #*rho*(-0.1899772193293833D-1*t120-0.7599088773175333D-1*t125)
     #+t130+t131+t132-t133+t284
      t286 = t14**2
      t287 = 1/t286
      t288 = sigmabb*t287
      t291 = -t118
      t292 = t57*t291
      t293 = t292*t102
      vrhob(i) = -0.1329696463223228D1*t11+0.8D-2*t288*t11+0.576727D0
     #*rho*(-0.1899772193293833D-1*t293+0.7599088773175333D-1*t125)
     #+t130+t131+t132-t133+t284
      vsigmaaa(i) = -0.6D-2*t8
      vsigmaab(i) = 0.D0
      vsigmabb(i) = -0.6D-2*t15
      t301 = t4**2
      t302 = 1/t301
      t311 = t62**2
      t312 = 1/t311
      t315 = t66**2
      t316 = 1/t315
      t319 = 0.4444444444444444D0*t312*t137+0.4444444444444444D0*t316
     #*t137
      t322 = 0.1899772193293833D-1*t57*t319*t102
      t323 = t119*t124
      t327 = t69*t94*t95*t100
      t328 = 0.22797266319526D0*t327
      t336 = 0.1899772193293833D-1*t213*t118*t102
      t337 = t214*t124
      t338 = 0.7599088773175333D-1*t337
      t341 = 1/t98/rho
      t351 = -0.4444444444444444D0*t312*t59*t341-0.1333333333333333D1
     #*t62*t137-0.4444444444444444D0*t316*t59*t341
     #+0.1333333333333333D1*t66*t137
      t354 = 0.1899772193293833D-1*t57*t351*t102
      t355 = t224*t124
      t356 = 0.7599088773175333D-1*t355
      t358 = 0.1899772193293833D-1*t119*t279
      t360 = t272*t122*t100
      t362 = t123*t276
      t364 = 4.D0*t360-16.D0*t362
      t368 = rho*(-t336-t338-t354-t356-t358-0.1899772193293833D-1*t69
     #*t364)
      t370 = t69*t360
      t372 = t69*t362
      t375 = rho*(-t336-t354-t358-t338-t356-0.7599088773175333D-1*t370
     #+0.3039635509270133D0*t372)
      t377 = 0.5780875940922816D-1*t157
      t378 = 0.7225334717924539D-1*t166
      t379 = 0.111772319147917D-2*t177
      t380 = 0.2191299835443545D-1*t215
      t381 = 0.2191299835443545D-1*t225
      t382 = 0.2191299835443545D-1*t280
      t384 = 1/t134/t18
      t386 = t384*t24*t100
      t395 = 1/t140/t23
      t397 = t151**2
      t401 = 0.1378556646443111D0*t384*t100
      t403 = 0.4135669939329333D0*t135*t341
      t405 = 1/t147/t18
      t406 = t405*t100
      t408 = t148*t341
      t410 = -t401+t403-0.4077525916766971D0*t406+0.978606220024073D0
     #*t408
      t415 = (-0.1378556646443111D0*t386+0.4135669939329333D0*t135
     #*t141*t137*t151+0.4135669939329333D0*t136*t341
     #+0.12407009817988D1*t19*t395*t397-0.6203504908994D0*t142*t410)
     #*t155*t23
      t418 = 1/t19/t18
      t421 = t154*t418*t23*t137
      t423 = t156*t151
      t428 = t100*t164
      t429 = 1/t159/t30*t384*t428
      t432 = t160*t405*t428
      t435 = t161*t341*t164
      t437 = t159**2
      t441 = t163**2
      t444 = 1/t437/t30*t384*t100/t441
      t462 = (0.3446391616107778D-1*t386+0.5250822119331622D0*t36*t141
     #*t149*t151-0.2187842549721509D0*t168*t406+0.5250822119331622D0
     #*t168*t408+2.D0*t37*t395*t397-1.D0*t171*t410)*t175*t23
      t469 = t174/t37/t36*t23*t148*t137
      t471 = t176*t151
      t474 = t384*t43*t100
      t483 = 1/t182/t42
      t485 = t186**2
      t490 = -t401+t403-0.1237301536356754D0*t406+0.2969523687256209D0
     #*t408
      t506 = t100*t198
      t515 = t193**2
      t519 = t197**2
      t551 = 0.161199195401647D1*(-0.1378556646443111D0*t474
     #+0.4135669939329333D0*t135*t183*t137*t186+0.4135669939329333D0
     #*t179*t341+0.12407009817988D1*t19*t483*t485-0.6203504908994D0
     #*t184*t490)*t155*t42+0.5373306513388232D0*t189*t418*t42*t137
     #+0.161199195401647D1*t190*t186+0.3119768427869032D0/t193/t47
     #*t384*t506+0.495123804261555D0*t194*t405*t506
     #-0.1188297130227732D1*t195*t341*t198-0.1582929339795102D2/t515
     #/t47*t384*t100/t519+0.4140337942820627D-3*(0.3446391616107778D-1
     #*t474+0.5250822119331622D0*t52*t183*t149*t186
     #-0.2187842549721509D0*t202*t406+0.5250822119331622D0*t202*t408
     #+2.D0*t53*t483*t485-1.D0*t205*t490)*t209*t42
     #+0.1087008902583527D-3*t208/t53/t52*t42*t148*t137
     #+0.4140337942820627D-3*t210*t186
      t577 = t384*t72*t100
      t586 = 1/t230/t71
      t588 = t234**2
      t593 = -t401+t403-0.7723543647452368D0*t406+0.1853650475388568D1
     #*t408
      t609 = t100*t246
      t618 = t241**2
      t622 = t245**2
      s1 = 0.2505897912236993D-1*(-0.1378556646443111D0*t577
     #+0.4135669939329333D0*t135*t231*t137*t234+0.4135669939329333D0
     #*t227*t341+0.12407009817988D1*t19*t586*t588-0.6203504908994D0
     #*t232*t593)*t155*t71+0.8352993040789975D-2*t237*t418*t71*t137
     #+0.2505897912236993D-1*t238*t234+0.3423410311260694D-1/t241/t77
     #*t384*t609+0.5433133824030049D-1*t242*t405*t609
     #-0.1303952117767212D0*t243*t341*t246-0.7662163788798043D0/t618
     #/t77*t384*t100/t622+0.2247867095542612D-2*(0.3446391616107778D-1
     #*t577+0.5250822119331622D0*t82*t231*t149*t234
     #-0.2187842549721509D0*t250*t406+0.5250822119331622D0*t250*t408
     #+2.D0*t83*t586*t588-1.D0*t253*t593)*t257*t71
     #+0.5901575133296437D-3*t256/t83/t82*t71*t148*t137
     #+0.2247867095542612D-2*t258*t234
      t664 = s1-0.5011795824473985D-1*t415-0.1670598608157995D-1*t421
     #-0.5011795824473985D-1*t423-0.3289159980064473D-1*t429
     #-0.5220071424553658D-1*t432+0.1252817141892878D0*t435
     #+0.1244848083156773D1*t444-0.9690227711544374D-3*t462
     #-0.2544083100456872D-3*t469-0.9690227711544374D-3*t471
      t673 = t213**2
      t690 = 0.5011795824473985D-1*t415+0.1670598608157995D-1*t421
     #+0.5011795824473985D-1*t423+0.3289159980064473D-1*t429
     #+0.5220071424553658D-1*t432-0.1252817141892878D0*t435
     #-0.1244848083156773D1*t444+0.9690227711544374D-3*t462
     #+0.2544083100456872D-3*t469+0.9690227711544374D-3*t471
     #-0.1899772193293833D-1*t551*t68*t102-0.3799544386587666D-1*t213
     #*t223*t102-0.3799544386587666D-1*t214*t279-0.1899772193293833D-1
     #*t57*(0.4444444444444444D0*t312*t95*t100+0.2666666666666667D1
     #*t217*t341+0.4444444444444444D0*t316*t95*t100
     #-0.2666666666666667D1*t220*t341)*t102-0.3799544386587666D-1*t224
     #*t279-0.1899772193293833D-1*t69*((-0.101257459063883D3*t664*t91
     #+0.2025149181277661D3*t264*t268*t213-0.2025149181277661D3*t90
     #/t267/t57*t673+0.101257459063883D3*t269*t551)*t96*t100-8.D0*t273
     #*t276+20.D0*t97/t99/t98)
      t692 = 0.576727D0*rho*t690
      v2rhoa2(i) = -0.4432321544077427D0*t302-0.2133333333333333D-1
     #*sigmaaa/t109/t7*t301+0.2666666666666667D-2*t111*t302+0.576727D0
     #*rho*(-t322-0.1519817754635067D0*t323-t328)
     #-0.2191299835443545D-1*t120-0.876519934177418D-1*t125+0.576727D0
     #*t368+0.576727D0*t375+t377+t378+t379-t380-t381-t382+t692
      t693 = t11**2
      t694 = 1/t693
      t703 = t292*t124
      t712 = 0.1899772193293833D-1*t213*t291*t102
      t713 = 0.7599088773175333D-1*t337
      t717 = -0.1899772193293833D-1*t57*t351*t102
      t718 = 0.7599088773175333D-1*t355
      t720 = 0.1899772193293833D-1*t292*t279
      t725 = rho*(-t712+t713-t717+t718-t720+0.1899772193293833D-1*t69
     #*t364)
      t730 = rho*(-t712-t717-t720+t713+t718+0.7599088773175333D-1*t370
     #-0.3039635509270133D0*t372)
      v2rhob2(i) = -0.4432321544077427D0*t694-0.2133333333333333D-1
     #*sigmabb/t286/t14*t693+0.2666666666666667D-2*t288*t694
     #+0.576727D0*rho*(-t322+0.1519817754635067D0*t703-t328)
     #-0.2191299835443545D-1*t293+0.876519934177418D-1*t125+0.576727D0
     #*t725+0.576727D0*t730+t377+t378+t379-t380-t381-t382+t692
      v2rhoab(i) = 0.576727D0*rho*(0.1899772193293833D-1*t57*t319*t102
     #+0.7599088773175333D-1*t323-0.7599088773175333D-1*t703
     #+0.22797266319526D0*t327)-0.1095649917721773D-1*t293+0.2883635D0
     #*t725-0.1095649917721773D-1*t120+0.2883635D0*t375+t377+t378+t379
     #-t380-t381-t382+t692+0.2883635D0*t368+0.2883635D0*t730
      v2rhoasigmaaa(i) = 0.8D-2*t110*t4
      v2rhoasigmaab(i) = 0.D0
      v2rhoasigmabb(i) = 0.D0
      v2rhobsigmaaa(i) = 0.D0
      v2rhobsigmaab(i) = 0.D0
      v2rhobsigmabb(i) = 0.8D-2*t287*t11
      v2sigmaaa2(i) = 0.D0
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      v2sigmabb2(i) = 0.D0
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      v2rhob2(i) = 0.0d0
      v2rhoab(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2rhoasigmaab(i) = 0.0d0
      v2rhoasigmabb(i) = 0.0d0
      v2rhobsigmaaa(i) = 0.0d0
      v2rhobsigmaab(i) = 0.0d0
      v2rhobsigmabb(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      v2sigmaab2(i) = 0.0d0
      v2sigmabb2(i) = 0.0d0
      v2sigmaaaab(i) = 0.0d0
      v2sigmaaabb(i) = 0.0d0
      v2sigmaabbb(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end
      
      
      subroutine rks_xc_kt2
     & (ideriv,npt,rhoa1,sigmaaa1,
     &  zk,vrhoa,vsigmaaa,
     &  v2rhoa2,v2rhoasigmaaa,v2sigmaaa2)
c
c     T.W. Keal, and D.J. Tozer
c     The exchange-correlation potential in Kohn-Sham nuclear magnetic
c     resonance shielding calculations
c     J. Chem. Phys. 119 (2003) 3015-3024
c
INCLUDE(common/citation)
      implicit REAL (a-h,o-z)
      integer ideriv,npt
      REAL rhoa1(npt)
      REAL sigmaaa1(npt)
      REAL zk(npt),vrhoa(npt),vsigmaaa(npt)
      REAL v2rhoa2(npt),v2rhoasigmaaa(npt),v2sigmaaa2(npt)
      parameter(tol=1.0d-20)
      
      if(ideriv.eq.0) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t3 = t2*rho
      t10 = 1/rho
      t11 = t10**(1.D0/3.D0)
      t13 = t10**(1.D0/6.D0)
      t16 = 1/(0.6203504908994D0*t11+0.2935818660072219D1*t13
     #+0.129352D2)
      t19 = dlog(0.6203504908994D0*t11*t16)
      t25 = datan(0.615199081975908D1/(0.1575246635799487D1*t13
     #+0.372744D1))
      t29 = (0.7876233178997433D0*t13+0.10498D0)**2
      t31 = dlog(t29*t16)
      zk(i) = -0.7915355866946049D0*t3-0.3D-2*sigma/
     #(0.3968502629920499D0*t3+0.1D0)+0.576727D0*rho*(0.310907D-1*t19
     #+0.3878329487811301D-1*t25+0.9690227711544374D-3*t31)
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t3 = t2*rho
      t6 = 0.3968502629920499D0*t3+0.1D0
      t7 = 1/t6
      t10 = 1/rho
      t11 = t10**(1.D0/3.D0)
      t13 = t10**(1.D0/6.D0)
      t15 = 0.6203504908994D0*t11+0.2935818660072219D1*t13+0.129352D2
      t16 = 1/t15
      t19 = dlog(0.6203504908994D0*t11*t16)
      t22 = 0.1575246635799487D1*t13+0.372744D1
      t25 = datan(0.615199081975908D1/t22)
      t28 = 0.7876233178997433D0*t13+0.10498D0
      t29 = t28**2
      t31 = dlog(t29*t16)
      zk(i) = -0.7915355866946049D0*t3-0.3D-2*sigma*t7+0.576727D0*rho*
     #(0.310907D-1*t19+0.3878329487811301D-1*t25+0.9690227711544374D-3
     #*t31)
      t37 = t6**2
      t45 = t11**2
      t46 = 1/t45
      t48 = rho**2
      t49 = 1/t48
      t52 = t15**2
      t53 = 1/t52
      t57 = t13**2
      t58 = t57**2
      t60 = 1/t58/t13
      t61 = t60*t49
      t63 = -0.2067834969664667D0*t46*t49-0.4893031100120365D0*t61
      t71 = t22**2
      t72 = 1/t71
      vrhoa(i) = -0.1055380782259473D1*t2+0.1587401051968199D-2*sigma
     #/t37*t2+0.179308461389D-1*t19+0.2236737330516948D-1*t25
     #+0.5588615957395852D-3*t31+0.576727D0*rho*(0.5011795824473985D-1
     #*(-0.2067834969664667D0*t46*t16*t49-0.6203504908994D0*t11*t53
     #*t63)/t11*t15+0.626408570946439D-1*t72*t60*t49/(1.D0
     #+0.378469910464D2*t72)+0.9690227711544374D-3*(
     #-0.2625411059665811D0*t28*t16*t61-1.D0*t29*t53*t63)/t29*t15)
      vsigmaaa(i) = -0.12D-1*t7
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t3 = t2*rho
      t6 = 0.3968502629920499D0*t3+0.1D0
      t7 = 1/t6
      t10 = 1/rho
      t11 = t10**(1.D0/3.D0)
      t13 = t10**(1.D0/6.D0)
      t15 = 0.6203504908994D0*t11+0.2935818660072219D1*t13+0.129352D2
      t16 = 1/t15
      t19 = dlog(0.6203504908994D0*t11*t16)
      t22 = 0.1575246635799487D1*t13+0.372744D1
      t25 = datan(0.615199081975908D1/t22)
      t28 = 0.7876233178997433D0*t13+0.10498D0
      t29 = t28**2
      t31 = dlog(t29*t16)
      zk(i) = -0.7915355866946049D0*t3-0.3D-2*sigma*t7+0.576727D0*rho*
     #(0.310907D-1*t19+0.3878329487811301D-1*t25+0.9690227711544374D-3
     #*t31)
      t37 = t6**2
      t38 = 1/t37
      t39 = sigma*t38
      t45 = t11**2
      t46 = 1/t45
      t47 = t46*t16
      t48 = rho**2
      t49 = 1/t48
      t52 = t15**2
      t53 = 1/t52
      t54 = t11*t53
      t57 = t13**2
      t58 = t57**2
      t59 = t58*t13
      t60 = 1/t59
      t61 = t60*t49
      t63 = -0.2067834969664667D0*t46*t49-0.4893031100120365D0*t61
      t66 = -0.2067834969664667D0*t47*t49-0.6203504908994D0*t54*t63
      t67 = 1/t11
      t68 = t66*t67
      t69 = t68*t15
      t71 = t22**2
      t72 = 1/t71
      t73 = t72*t60
      t75 = 1.D0+0.378469910464D2*t72
      t76 = 1/t75
      t78 = t73*t49*t76
      t80 = t28*t16
      t83 = t29*t53
      t86 = -0.2625411059665811D0*t80*t61-1.D0*t83*t63
      t87 = 1/t29
      t88 = t86*t87
      t89 = t88*t15
      vrhoa(i) = -0.1055380782259473D1*t2+0.1587401051968199D-2*t39*t2
     #+0.179308461389D-1*t19+0.2236737330516948D-1*t25
     #+0.5588615957395852D-3*t31+0.576727D0*rho*(0.5011795824473985D-1
     #*t69+0.626408570946439D-1*t78+0.9690227711544374D-3*t89)
      vsigmaaa(i) = -0.12D-1*t7
      t95 = t2**2
      t96 = 1/t95
      t109 = 1/t45/t10
      t111 = t48**2
      t112 = 1/t111
      t113 = t109*t16*t112
      t120 = 1/t48/rho
      t124 = 1/t52/t15
      t126 = t63**2
      t134 = 1/t59/t10
      t135 = t134*t112
      t137 = t60*t120
      t139 = -0.1378556646443111D0*t109*t112+0.4135669939329333D0*t46
     #*t120-0.4077525916766971D0*t135+0.978606220024073D0*t137
      t157 = t112*t76
      t166 = t71**2
      t170 = t75**2
      s1 = -0.7035871881729821D0*t96-0.3359789466386328D-2*sigma/t37
     #/t6*t95+0.10582673679788D-2*t39*t96
      s2 = s1+0.1156175188184563D0*t69
      s3 = s2+0.1445066943584908D0*t78
      v2rhoa2(i) = s3+0.2235446382958341D-2*t89+0.1153454D1*rho*
     #(0.5011795824473985D-1*(-0.1378556646443111D0*t113
     #+0.4135669939329333D0*t46*t53*t49*t63+0.4135669939329333D0*t47
     #*t120+0.12407009817988D1*t11*t124*t126-0.6203504908994D0*t54
     #*t139)*t67*t15+0.1670598608157995D-1*t66/t11/t10*t15*t49
     #+0.5011795824473985D-1*t68*t63+0.3289159980064473D-1/t71/t22
     #*t109*t157+0.5220071424553658D-1*t72*t134*t157
     #-0.1252817141892878D0*t73*t120*t76-0.1244848083156773D1/t166/t22
     #*t109*t112/t170+0.9690227711544374D-3*(0.3446391616107778D-1
     #*t113+0.5250822119331622D0*t28*t53*t61*t63-0.2187842549721509D0
     #*t80*t135+0.5250822119331622D0*t80*t137+2.D0*t29*t124*t126-1.D0
     #*t83*t139)*t87*t15+0.2544083100456872D-3*t86/t29/t28*t15*t60*t49
     #+0.9690227711544374D-3*t88*t63)
      v2rhoasigmaaa(i) = 0.6349604207872798D-2*t38*t2
      v2sigmaaa2(i) = 0.D0
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end

c:XC_KT2subrend
_ENDIF
_IF(ccpdft)
      subroutine ver_dft_xc_lib(s,r,d)
      character*80 source
      character*30 revision
      character*60 date
      character s*(*), r*(*), d*(*)
      data source /
     +     "$Source: /c/qcg/cvs/psh/GAMESS-UK/dft/xc_lib.m,v $
     +     "/
      data revision /
     +     "$Revision: 6044 $"
     +      /
      data date /
     +     "$Date: 2009-08-14 23:28:23 +0200 (Fri, 14 Aug 2009) $"
     +     /
      s=source(9:)
      r=revision(11:)
      d=date(7:)
      return
      end
_ENDIF
