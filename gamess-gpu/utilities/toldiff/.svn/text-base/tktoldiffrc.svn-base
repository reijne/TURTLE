# This file was generated by TkDiff 4.1.3
# Tue Feb 27 15:00:40 GMT 2007

set prefsFileVersion {4.1.3}

# Automatically center current diff region
define autocenter {1}

# Automatically select the nearest diff region while  scrolling
define autoselect {0}

# Tag options for characters in line view
define bytetag {-background blue -foreground white}

# Tag options for changed diff region
define chgtag {-background LightSteelBlue}

# Color change bars to match the diff map
define colorcbs {0}

# Tag options for the current diff region
define currtag {-background Khaki}

# Tag options for deleted diff region
define deltag {-background Tomato -font {{Courier} -12 bold}}

# diff command
define diffcmd {sh "toldiff"}

# Tag options for diff regions
define difftag {-background gray}

# Program for editing files
define editor {}

# Windows-style toolbar buttons
define fancyButtons {1}

# Text window size
define geometry {80x30}

# Ignore blanks when diffing
define ignoreblanks {1}

# Ignore blanks option: used here to enforce an output format that tkdiff 
# will understand.
define ignoreblanksopt {--output full --exit 0:0:1}

# Tag options for diff region inline differences
define inlinetag {-background DodgerBlue -font {{Courier} -12 bold}}

# Tag options for inserted diff region
define instag {-background PaleGreen -font {{Courier} -12 bold}}

# Tag options for overlap diff region
define overlaptag {-background yellow}

# Show change bars
define showcbs {1}

# Show inline diffs (byte comparisons)
define showinline1 {0}

# Show inline diffs (recursive matching algorithm)
define showinline2 {1}

# Show current line comparison window
define showlineview {0}

# Show line numbers
define showln {1}

# Show graphical map of diffs
define showmap {1}

# Synchronize scrollbars
define syncscroll {1}

# Tab stops
define tabstops {8}

# Highlight change bars
define tagcbs {0}

# Highlight line numbers
define tagln {0}

# Highlight file contents
define tagtext {1}

# Text widget options
define textopt {-background white -foreground black -font {{Courier} -12} -wrap none}

# Use icons instead of labels in the toolbar
define toolbarIcons {1}

# custom code
# put any custom code you want to be executed in the
# following block. This code will be automatically executed
# after the GUI has been set up but before the diff is 
# performed. Use this code to customize the interface if
# you so desire.
#  
# Even though you can't (as of version 3.09) edit this 
# code via the preferences dialog, it will be automatically
# saved and restored if you do a SAVE from that dialog.

# Unless you really know what you are doing, it is probably
# wise to leave this unmodified.

define customCode {

proc toldiff-rediff {} {
    global opts
    global finfo

    recompute-diff
    show-info "Done"
}

proc toldiff-update {} {
    global opts
    global finfo

    set updatecmd "$opts(diffcmd) --update {$finfo(pth,1)} {$finfo(pth,2)}"
    show-info "Excuting \"$updatecmd\""
    set result [run-command "exec $updatecmd"]
    recompute-diff
    show-info "Done"
}

proc toldiff-transfer {} {
    global opts
    global finfo

    set transfercmd "$opts(diffcmd) --transfer {$finfo(pth,1)} {$finfo(pth,2)}"
    show-info "Excuting \"$transfercmd\""
    set result [run-command "exec $transfercmd"]
    show-info "Done"
}

proc toldiff-show {} {
    global opts
    global finfo
    global textfont

    set outfile [tmpfile 11]
    set showcmd "$opts(diffcmd) --show {$finfo(pth,1)} > $outfile"
    show-info "Excuting \"$showcmd\""
    eval exec $showcmd
    if {[string length [string trim $opts(editor)]] == 0} {
        set textfontorig $textfont
        set textfont {{Courier} -12}
        simpleEd open $outfile
        set textfont $textfontorig
    } elseif {[regexp "\\\$file" "$opts(editor)"] == 1} {
        set line [lindex [extract $g(currdiff)] [expr {($fileno-1) *2+1}]]
        set file $outfile
        eval set commandline \"$opts(editor) &\"
        eval exec $commandline
    } else {
        eval exec $opts(editor) "{$outfile}" &
    }
    show-info "Done"
}

proc do-help-toldiff {} {
    set title "How to use TolDiff through TkDiff"
    set text {
<hdr>What is TolDiff?</hdr>

<itl>TolDiff</itl> is a program that is very similar to <itl>Diff</itl>.\
It reports differences between files, just like <itl>Diff</itl>, except\
that it suppresses differences that have previously been recorded as\
insignificant. 
The program is designed to help with regression testing of\
legacy codes by offering a convenient way to check current results against\
reference results.

<hdr>Concepts and Conventions</hdr>

As <itl>TolDiff</itl> by its very nature compares current results against\
reference results these data sets take centre stage. A reference result is\
referred to as the <bld>reference file</bld> and is shown in the left-hand\
panel on the screen. A current result is referred as the <bld>data file</bld>.\
It appears in the right-hand panel on the screen.

Essential to the operation of <itl>TolDiff</itl> is that it knows which\
differences are insignificant and therefore should be tolerated. These\
differences are recorded in the <bld>tolerance file</bld>. The contents of\
this file are not directly visible but can be inspected through the "show"\
operation (see below). Because <itl>TkDiff</itl> does not know of tolerance\
files <itl>TolDiff</itl> derives its file names from the names of the\
reference files. This is achieved simply by replacing the extension of the\
reference file by either <cmp>.tol</cmp>, <cmp>.tlr</cmp> or <cmp>.tlc</cmp>\
respectively. The particular choice depends on the extensions of the\
reference file and the data file so that a unique file name is guaranteed.

Obviously for the successfull exploitation of <itl>TolDiff</itl> it is\
crucial to keep both the reference files and the tolerance files.

<hdr>Operations</hdr>

<itl>TolDiff</itl> supports four operations to deliver its functionality.\
These operations are <bld>Rediff</bld>, <bld>Update</bld>,\
<bld>Transfer</bld>, and <bld>Show</bld>. These operations can be invoked\
through the buttons following the "Toldiff:" label on the toolbar.\
Alternatively these operations can be found on the "File" menu. Their\
function is explained below.

<hdr>Operation - Rediff</hdr>

The Diff operation is automatically performed when the application starts.\
The Rediff operation performs the same task as the Diff operation. The only\
difference is that Rediff is an explicit request to run the Diff again.

Both Diff and Rediff involve running the tolerant diff procedure on the\
reference and data files, suppressing the insignificant differences as\
stored in the tolerance file. After the diff has completed the results\
are redisplayed.

This operation may be invoked by pressing Cntl-R as an alternative to the\
file menu and toolbar buttons.

<hdr>Operation - Update</hdr>

The Update operation assumes that all differences between the reference file\
and the data file are insignificant. Based on this the operation records\
the differences and updates the tolerance file to add them. Subsequently\
it invokes the Rediff operation to redisplay the difference. (Of course\
after an Update there should not be any remaining differences.)

The operation can be invoked by Cntl-U as well.

<hdr>Operation - Transfer</hdr>

The Transfer operation addresses the issue that the correct output of a program\
changes over time. Reasons for this may be any number of modifications to the\
code. The result of such a change is that the original reference file needs\
to be replaced with a new one. Rather than throwing the original tolerance\
file away and starting again, the Transfer operation creates a tolerance\
file for the new reference file from the old tolerance file. In this process\
as many known tolerances as possible are kept.

This operation may be invoked by Cntl-T as well.

<hdr>Operation - Show</hdr>

The Show operation allows one to inspect the current tolerances. For this the\
tolerances are "painted" on a copy of the reference file. The result is shown\
in a separate window. The Show operation expresses three different kinds of\
tolerances in the following way:

First, tolerated changes in a line are marked with the "#" character. I.e.\
all characters marked with "#" are allowed to change without TolDiff\
reporting the difference. (Hopefully "#" is not a common character in your\
outputs.)

Second, all lines prefixed with a "X" character may not be present in the\
data file. Again if these lines are found to be missing in the data file\
these difference will not be reported.

Third, all lines prefixed with an integer number N may be followed by a\
maximum of N lines in the data file that have no counter part in the\
reference file.

The Show operation is mainly there to help you understand and check how\
<itl>TolDiff</itl> operates. It may be invoked with Cntl-S as well as\
through the menu and toolbar buttons.
    }
    set text [subst -nobackslashes -nocommands $text]
    do-text-info .help $title $text
}

proc do-about-toldiff {} {
    set title "About TolDiff"
    set text {
<itl>TolDiff</itl> is a tolerant diff program. It suppresses differences that \
are deemed insignificant by the user. For usage information run \
<cmp>toldiff --help</cmp>. 
<itl>TolDiff</itl> is Copyright (C) 2006 by \
Huub van Dam, Science and Technology Facilities Council, Daresbury Laboratory.

<bld>
Permission is hereby granted, free of charge, to any person obtaining \
a copy of this software and associated documentation files (the "Software"), \
to deal with the Software without restriction, including without limitation \
the rights to use, copy, modify, merge, publish, distribute, sublicense, \
and/or sell copies of the Software, and to permit persons to whom the \
Software is furnished to do so, subject to the following conditions: 

Redistributions of source code must retain the above copyright notice, this \
list of conditions and the following disclaimers. 
Redistributions in binary form must reproduce the above copyright notice, \
this list of conditions and the following disclaimers in the documentation  \
and/or other materials provided with the distribution. 
Neither the names of Science and Technology Facilities Council, \
Daresbury Laboratory, the Computational Chemistry and Engineering Department, \
the Computational Chemistry Group, nor the \
names of its contributors may be used to endorse or promote products \
derived from this Software without specific prior written permission. 

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \
CONTRIBUTORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING \
FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER \
DEALINGS WITH THE SOFTWARE. 
</bld>
    }
    set text [subst -nobackslashes -nocommands $text]
    do-text-info .about $title $text
}

proc toldiff-toolbar {} {
    global w

    set toolbar $w(toolbar)

    set w(toldiffLabel)     $toolbar.toldiffLbl
    set w(toldiffDiff)      $toolbar.toldiffDiff
    set w(toldiffUpdate)    $toolbar.toldiffUpdate
    set w(toldiffTransfer)  $toolbar.toldiffTransfer
    set w(toldiffShow)      $toolbar.toldiffShow

    # toldiff widgets
    label $toolbar.toldiffLbl  -text "Toldiff:" -pady 0 -bd 2 -relief groove
    toolbutton $toolbar.toldiffDiff     -text "Rediff" -pady 0 -bd 2 \
               -command toldiff-rediff
    toolbutton $toolbar.toldiffUpdate   -text "Update" -pady 0 -bd 2 \
               -command toldiff-update
    toolbutton $toolbar.toldiffTransfer -text "Transfer" -pady 0 -bd 2 \
               -command toldiff-transfer
    toolbutton $toolbar.toldiffShow     -text "Show" -pady 0 -bd 2 \
               -command toldiff-show

    set_tooltips $w(toldiffDiff) {"Recompute the difference with toldiff\nand \
      redisplay the records"}
    set_tooltips $w(toldiffUpdate) {"Update the tolerance file and recompute\n\
      and redisplay the difference records"}
    set_tooltips $w(toldiffTransfer) {"Transfer the tolerances\nfrom the \
      original reference file\nto a new reference file"}
    set_tooltips $w(toldiffShow) {"Paint the tolerances on\na copy of the \
      reference file\nand display the result"}

    pack $toolbar.toldiffLbl      -side left -pady 2 -padx 2
    pack $toolbar.toldiffDiff     -side left -pady 2 -padx 2
    pack $toolbar.toldiffUpdate   -side left -pady 2 -padx 2
    pack $toolbar.toldiffTransfer -side left -pady 2 -padx 2
    pack $toolbar.toldiffShow     -side left -pady 2 -padx 2
}

proc toldiff-menu {} {
    global w
    global g

    #
    # Rebuild the file menu so that we can add the toldiff operations as well.
    #

    set fileMenu $w(fileMenu)

    destroy $fileMenu

    menu $fileMenu

    $fileMenu add command -label "New..." -underline 0 -command {do-new-diff}
    $fileMenu add separator
    $fileMenu add command -label "Write Report..." -underline 0 \
      -accelerator w -command [list write-report popup]
    $fileMenu add command -label "Recompute Diffs" -underline 0 \
      -accelerator r -command toldiff-rediff
    $fileMenu add command -label "Update" -underline 0 \
      -accelerator u -command toldiff-update
    $fileMenu add command -label "Transfer" -underline 0 \
      -accelerator t -command toldiff-transfer
    $fileMenu add command -label "Show" -underline 0 \
      -accelerator s -command toldiff-show
    $fileMenu add separator
    $fileMenu add command -label "Exit" -underline 1 \
      -accelerator q -command do-exit

    set "g(tooltip,Update)" "Update the tolerance file and recompute the diffs"
    set "g(tooltip,Transfer)" "Transfer the tolerances from the left-hand file \
      to the right-hand file"
    set "g(tooltip,Show)" "Paint the tolerances on the reference file and \
      display the result"

    bind $fileMenu <<MenuSelect>> {showTooltip menu %W}
    bind . <Control-n> {do-new-diff}
    bind . <Control-w> [list write-report popup]
    bind . <Control-r> toldiff-rediff
    bind . <Control-u> toldiff-update
    bind . <Control-t> toldiff-transfer
    bind . <Control-s> toldiff-show
    bind . <Control-x> do-exit

    #
    # Rebuild the help menu so that we can add the toldiff help as well.
    #

    set helpMenu $w(helpMenu)

    destroy $helpMenu

    menu $helpMenu

    $helpMenu add command -label "On GUI" -underline 3 -command do-help
    $helpMenu add command -label "On Command Line" -underline 3 \
      -command "do-usage gui"
    $helpMenu add command -label "On Preferences" -underline 3 \
      -command do-help-preferences
    $helpMenu add command -label "On TolDiff" -underline 7 \
      -command do-help-toldiff
    $helpMenu add separator
    $helpMenu add command -label "About $g(name)" -underline 0 -command do-about
    $helpMenu add command -label "About TolDiff" -underline 1 \
      -command do-about-toldiff

    bind $helpMenu <<MenuSelect>> {showTooltip menu %W}
    bind . <Control-g> do-help
    bind . <Control-c> "do-usage gui"
    bind . <Control-p> do-help-preferences
    bind . <Control-i> do-help-toldiff
    bind . <Control-a> do-about
    bind . <Control-b> do-about-toldiff

    set "g(tooltip,On TolDiff)" "Show help on how to use TolDiff through the \
      Graphical User Interface"
    set "g(tooltip,About TolDiff)" "Show information about TolDiff"
}

toldiff-toolbar
toldiff-menu
}

